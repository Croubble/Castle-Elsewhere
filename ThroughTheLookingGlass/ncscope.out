cscope 15 $HOME\source\repos\ThroughTheLookingGlass\ThroughTheLookingGlass"               0000656641
	@AABB.cpp

1 
	~"M©h.h
"

4 
	$m©h_AABB_bªak_öto_b‹dîs
(
AABB
 
box
, AABB* 
ouçut
, 
b‹dî_size
)

7 
ouçut
[0] = 
	`m©h_AABB_¸óã
(
box
.
x
, box.
y
, box.
w
, 
b‹dî_size
);

9 
ouçut
[1] = 
	`m©h_AABB_¸óã
(
box
.
x
, box.
y
 + box.
h
 - 
b‹dî_size
, box.
w
, border_size);

11 
ouçut
[2] = 
	`m©h_AABB_¸óã
(
box
.
x
,box.
y
,
b‹dî_size
,box.
h
);

13 
ouçut
[3] = 
	`m©h_AABB_¸óã
(
box
.
x
 + box.
w
 - 
b‹dî_size
,box.
y
,b‹dî_size, box.
h
);

14 
	}
}

15 
AABB
 
	$m©h_AABB_¸óã
(
x
, 
y
, 
width
, 
height
)

17 
AABB
 
ªsu…
;

18 
ªsu…
.
x
 = x;

19 
ªsu…
.
y
 = y;

20 
ªsu…
.
w
 = 
width
;

21 
ªsu…
.
h
 = 
height
;

22  
ªsu…
;

23 
	}
}

24 
AABB
 
	$m©h_AABB_¸óã_öt
(
x
, 
y
, 
width
, 
height
)

26 
AABB
 
ªsu…
;

27 
ªsu…
.
x
 = () x;

28 
ªsu…
.
y
 = () y;

29 
ªsu…
.
w
 = (Ë
width
;

30 
ªsu…
.
h
 = (Ë
height
;

31  
ªsu…
;

32 
	}
}

34 
boﬁ
 
	$m©h_AABB_is_cﬁlidög
(
AABB
 
ã°
, AABB* 
agaö°_¨øy
, 
Àngth
)

36 
i
 = 0; i < 
Àngth
; i++)

38 
AABB
 
agaö°
 = 
agaö°_¨øy
[
i
];

39 i‡(
ã°
.
x
 < 
agaö°
.x +ágaö°.
w
 &&

40 
ã°
.
x
 +Åe°.
w
 > 
agaö°
.x &&

41 
ã°
.
y
 < 
agaö°
.y +ágaö°.
h
 &&

42 
ã°
.
y
 +Åe°.
h
 > 
agaö°
.y)

44  
åue
;

47  
Ál£
;

48 
	}
}

49 
boﬁ
 
	$m©h_AABB_is_cﬁlidög
(
AABB
 
ã°
, AABB* 
agaö°_¨øy
, 
Àngth
, * 
cﬁlisi⁄_ödex_out
)

51 
i
 = 0; i < 
Àngth
; i++)

53 
AABB
 
agaö°
 = 
agaö°_¨øy
[
i
];

54 i‡(
ã°
.
x
 < 
agaö°
.x +ágaö°.
w
 &&

55 
ã°
.
x
 +Åe°.
w
 > 
agaö°
.x &&

56 
ã°
.
y
 < 
agaö°
.y +ágaö°.
h
 &&

57 
ã°
.
y
 +Åe°.
h
 > 
agaö°
.y)

59  
i
;

62  
Ál£
;

63 
	}
}

64 
boﬁ
 
	$m©h_AABB_is_cﬁlidög
(
AABB
 
ã°
, AABB* 
agaö°_¨øy
, 
Àngth
, * 
cﬁlisi⁄_ödexes_out
, 
max_cﬁlisi⁄s_to_föd
)

66 
cuºít_numbî_of_cﬁlisi⁄s
 = 0;

67 
i
 = 0; i < 
Àngth
; i++)

69 
AABB
 
agaö°
 = 
agaö°_¨øy
[
i
];

70 i‡(
ã°
.
x
 < 
agaö°
.x +ágaö°.
w
 &&

71 
ã°
.
x
 +Åe°.
w
 > 
agaö°
.x &&

72 
ã°
.
y
 < 
agaö°
.y +ágaö°.
h
 &&

73 
ã°
.
y
 +Åe°.
h
 > 
agaö°
.y)

75 
cﬁlisi⁄_ödexes_out
[
cuºít_numbî_of_cﬁlisi⁄s
] = 
i
;

76 
cuºít_numbî_of_cﬁlisi⁄s
++;

77 i‡(
cuºít_numbî_of_cﬁlisi⁄s
 >
max_cﬁlisi⁄s_to_föd
)

78  
åue
;

81  
Ál£
;

82 
	}
}

84 
	$m©h_˛ick_is_öside_AABB_li°
(
˛ickX
, 
˛ickY
, 
AABB
* 
boxes
, 
tŸÆ_boxes
)

86 
i
 = 0; i < 
tŸÆ_boxes
; i++)

88 i‡(
	`m©h_˛ick_is_öside_AABB
(
˛ickX
, 
˛ickY
, 
boxes
[
i
]))

89  
i
;

92 
	}
}

	@Animation.cpp

1 
	~"Anim©i⁄.h
"

	@Animation.h

1 #¥agm®
⁄˚


2 
	~"GameSèã.h
"

3 
	~"M©h.h
"

4 
	~"Mem‹y.h
"

5 c⁄° 
	gZ_POSITION_STARTING_LAYER
 = 2;

6 c⁄° 
	gMAX_CRATE_ANIMATIONS
 = 4;

	@Camera.cpp

1 
	~"M©h.h
"

3 
	~"glm/glm.hµ
"

4 
	~"glm/gtc/m©rix_å™sf‹m.hµ
"

5 
	~"GameSèã.h
"

7 
	gglm
::
m©4
 
	$ˇmîa_make_m©rix
(
GameS∑˚Camîa
 
ˇmîa
)

9  
glm
::
	`‹tho
(
ˇmîa
.
À·
, camîa.
right
, camîa.
down
, camîa.
up
, camîa.
˛o£Poöt
, camîa.
ÁrPoöt
);

10 
	}
}

11 
	$ˇmîa_øtio
(
VõwP‹tCamîa
 
võwp‹t
)

13 
height
 = 
võwp‹t
.
up
 - võwp‹t.
down
;

14 
width
 = 
võwp‹t
.
right
 - võwp‹t.
À·
;

15  (Ë
width
 / (Ë
height
;

16 
	}
}

17 
	$move_ˇµed_di°™˚
(
pos
, 
gﬂl
, 
ˇp
)

19 
di°
 = 
gﬂl
 - 
pos
;

20 i‡(
di°
 < 0)

22 i‡(
di°
 >-
ˇp
)

23  
gﬂl
;

24  
pos
 - 
ˇp
;

26 i‡(
di°
 > 0)

28 i‡(
di°
 <
ˇp
)

29  
gﬂl
;

30  
pos
 + 
ˇp
;

32  
pos
;

33 
	}
}

34 
GameS∑˚Camîa
 
	$m©h_ˇmîa_ªposôi⁄_tow¨ds_öã∫Æ
(
GameS∑˚Camîa
 
movög
, GameS∑˚Camî®
gﬂl
, 
max_di°™˚
)

36 
GameS∑˚Camîa
 
ªsu…
;

37 
À·_move_ªque°
 = 
gﬂl
.
À·
 - 
movög
.left;

38 
right_move_ªque°
 = 
gﬂl
.
right
 - 
movög
.right;

39 
up_move_ªque°
 = 
gﬂl
.
up
 - 
movög
.up;

40 
down_move_ªque°
 = 
gﬂl
.
down
 - 
movög
.down;

41 
x_move
 = (
À·_move_ªque°
 + 
right_move_ªque°
) / 2.0f;

42 
y_move
 = (
up_move_ªque°
 + 
down_move_ªque°
) / 2.0f;

43 i‡(
x_move
 > 0)

44 
x_move
 = 
	`möf
(x_move, 
max_di°™˚
);

45 i‡(
y_move
 > 0)

46 
y_move
 = 
	`möf
(y_move, 
max_di°™˚
);

47 i‡(
x_move
 < 0)

48 
x_move
 = 
	`maxf
(x_move, -
max_di°™˚
);

49 i‡(
y_move
 < 0)

50 
y_move
 = 
	`maxf
(y_move, -
max_di°™˚
);

52 i‡(
x_move
 =0 && 
y_move
 == 0)

53  
movög
;

55 
ªsu…
.
À·
 = 
movög
.À· + 
x_move
;

56 
ªsu…
.
right
 = 
movög
.righà+ 
x_move
;

57 
ªsu…
.
up
 = 
movög
.u∞+ 
y_move
;

58 
ªsu…
.
down
 = 
movög
.dow¿+ 
y_move
;

59 
ªsu…
.
˛o£Poöt
 = 
movög
.closePoint;

60 
ªsu…
.
ÁrPoöt
 = 
movög
.farPoint;

61  
ªsu…
;

62 
	}
}

63 
GameS∑˚Camîa
 
	$m©h_ˇmîa_zoom_tow¨ds_öã∫Æ
(
GameS∑˚Camîa
 
movög
, GameS∑˚Camî®
gﬂl
, 
max_di°™˚
)

65 
GameS∑˚Camîa
 
ªsu…
;

66 
cuºít_height
 = 
movög
.
up
 - movög.
down
;

67 
gﬂl_height_jump
 = 
gﬂl
.
up
 - gﬂl.
down
;

68 
gﬂl_height
;

69 i‡(
gﬂl_height_jump
 - 
cuºít_height
 > 0)

71 
gﬂl_height
 = 
	`möf
(
gﬂl_height_jump
, 
cuºít_height
 + 
max_di°™˚
);

73 i‡(
gﬂl_height_jump
 - 
cuºít_height
 < 0)

75 
gﬂl_height
 = 
	`maxf
(
gﬂl_height_jump
, 
cuºít_height
 - 
max_di°™˚
);

78 
gﬂl_height
 = 
cuºít_height
;

80 
øtio
 = 
gﬂl_height
 / 
cuºít_height
;

81 
ˇmîa_˚¡î_x
 = (
movög
.
À·
 + movög.
right
) / 2.0f;

82 
ˇmîa_˚¡î_y
 = (
movög
.
up
 + movög.
down
) / 2.0f;

83 
ˇmîa_width
 = (
movög
.
right
 - movög.
À·
);

84 
ˇmîa_height
 = (
movög
.
up
 - movög.
down
);

85 
√w_ˇmîa_hÆf_width
 = (
ˇmîa_width
 / 2.0fË* 
øtio
;

86 
√w_ˇmîa_hÆf_height
 = (
ˇmîa_height
 / 2.0fË* 
øtio
;

88 
ªsu…
.
À·
 = 
ˇmîa_˚¡î_x
 - 
√w_ˇmîa_hÆf_width
;

89 
ªsu…
.
right
 = 
ˇmîa_˚¡î_x
 + 
√w_ˇmîa_hÆf_width
;

90 
ªsu…
.
down
 = 
ˇmîa_˚¡î_y
 - 
√w_ˇmîa_hÆf_height
;

91 
ªsu…
.
up
 = 
ˇmîa_˚¡î_y
 + 
√w_ˇmîa_hÆf_height
;

92 
ªsu…
.
˛o£Poöt
 = 
movög
.closePoint;

93 
ªsu…
.
ÁrPoöt
 = 
movög
.farPoint;

94  
ªsu…
;

95 
	}
}

98 
	$smoŸh_°¨t3
(
t
)

100  
t
 *Å *Å;

101 
	}
}

102 
	$smoŸh_°›3
(
t
)

104  1 - (1 - 
t
) * (1 -Å) * (1 -Å);

105 
	}
}

106 
	$mix
(
a
, 
b
, 
weight
, 
t
)

108  
a
 * (1 - 
weight
Ë+ 
b
 * weight;

109 
	}
}

110 
	$smoŸh_°ï3
(
t
)

112  
	`mix
(
	`smoŸh_°¨t3
(
t
), 
	`smoŸh_°›3
(t),Å,Å);

113 
	}
}

115 
GameS∑˚Camîa
 
	$m©h_ˇmîa_move_tow¨ds_ÀΩ
(
GameS∑˚Camîa
 
movög
, GameS∑˚Camî®
gﬂl
, 
cuºít_time
,
gﬂl_time
)

117 
t
 = 
cuºít_time
 / 
gﬂl_time
;

118 
t
 = 
	`möf
(t, 1);

119 
t
 = 
	`maxf
(t, 0);

120 
t
 = 
	`smoŸh_°ï3
(t);

121 
GameS∑˚Camîa
 
ªsu…
;

123 
x_˚¡î_ﬁd
 = (
movög
.
right
 + movög.
À·
) / 2.0f;

124 
y_˚¡î_ﬁd
 = (
movög
.
up
 + movög.
down
 )/ 2.0f;

125 
x_˚¡î_√xt
 = (
gﬂl
.
right
 + gﬂl.
À·
) / 2.0f;

126 
y_˚¡î_√xt
 = (
gﬂl
.
up
 + gﬂl.
down
) / 2.0f;

128 
x_˚¡î_now
 = 
x_˚¡î_ﬁd
 * (1 - 
t
Ë+ 
x_˚¡î_√xt
 *Å;

129 
y_˚¡î_now
 = 
y_˚¡î_ﬁd
 * (1 - 
t
Ë+ 
y_˚¡î_√xt
 *Å;

131 
zoom_ﬁd
 = 
movög
.
up
 - movög.
down
;

132 
zoom_√xt
 = 
gﬂl
.
up
 - gﬂl.
down
;

133 
zoom_now
 = 
zoom_ﬁd
 * (1 - 
t
Ë+ 
zoom_√xt
 *Å;

135 
øtio
 = (
movög
.
right
 - movög.
À·
Ë/ (movög.
up
 - movög.
down
);

136 
ªsu…
.
À·
 = 
x_˚¡î_now
 - (
zoom_now
 * 
øtio
) / 2.0f;

137 
ªsu…
.
right
 = 
x_˚¡î_now
 + (
zoom_now
 * 
øtio
) / 2.0f;

138 
ªsu…
.
up
 = 
y_˚¡î_now
 + 
zoom_now
 / 2.0f;

139 
ªsu…
.
down
 = 
y_˚¡î_now
 - 
zoom_now
 / 2.0f;

140 
ªsu…
.
˛o£Poöt
 = 
movög
.closePoint;

141 
ªsu…
.
ÁrPoöt
 = 
movög
.farPoint;

142  
ªsu…
;

143 
	}
}

144 
GameS∑˚Camîa
 
	$m©h_ˇmîa_buûd
(
ˇmîa_height
, 
s¸ìn_˚¡î_x
, 
s¸ìn_˚¡î_y
, 
VõwP‹tCamîa
 
võwp‹t
)

146 
GameS∑˚Camîa
 
ªsu…
;

148 
ˇmîa_À·_x
;

149 
ˇmîa_bŸtom_y
;

150 
ˇmîa_right_x
;

151 
ˇmîa_t›_y
;

154 
ˇmîa_võw_width
 = 
võwp‹t
.
right
 - võwp‹t.
À·
;

155 
ˇmîa_võw_height
 = 
võwp‹t
.
up
 - võwp‹t.
down
;

156 
øtio
 = ()
ˇmîa_võw_width
 / ()
ˇmîa_võw_height
;

157 
ˇmîa_À·_x
 = 
s¸ìn_˚¡î_x
 - (
ˇmîa_height
 * 
øtio
) / 2.0f;

158 
ˇmîa_bŸtom_y
 = 
s¸ìn_˚¡î_y
 - (
ˇmîa_height
) / 2.0f;

159 
ˇmîa_right_x
 = 
ˇmîa_À·_x
 + 
ˇmîa_height
 * 
øtio
;

160 
ˇmîa_t›_y
 = 
ˇmîa_bŸtom_y
 + 
ˇmîa_height
;

163 
ªsu…
.
À·
 = 
ˇmîa_À·_x
;

164 
ªsu…
.
right
 = 
ˇmîa_right_x
;

165 
ªsu…
.
up
 = 
ˇmîa_t›_y
;

166 
ªsu…
.
down
 = 
ˇmîa_bŸtom_y
;

167 
ªsu…
.
˛o£Poöt
 = -20;

168 
ªsu…
.
ÁrPoöt
 = 20.0f;

169  
ªsu…
;

170 
	}
}

171 
	gglm
::
vec2
 
	$m©h_s¸ìn•a˚_to_pixñ•a˚
(
I¡Paú
 
s¸ìnS∑˚Posôi⁄
, 
GameS∑˚Camîa
 
ˇmîa
, 
VõwP‹tCamîa
 
võw
, 
gameHeight
)

173 
glm
::
vec2
 
ªsu…
;

174 
ªsu…
.
x
 = 
s¸ìnS∑˚Posôi⁄
.x + 
ˇmîa
.
À·
 * 
võw
.
up
 / 
gameHeight
;

175 
ªsu…
.
y
 = 
s¸ìnS∑˚Posôi⁄
.y + 
ˇmîa
.
down
 * 
võw
.
up
 / 
gameHeight
;

176  
ªsu…
;

177 
	}
}

178 
	gglm
::
vec2
 
	$m©h_pixñ•a˚_to_s¸ìn•a˚
(
I¡Paú
 
pixñS∑˚Posôi⁄
, 
GameS∑˚Camîa
 
ˇmîa
, 
VõwP‹tCamîa
 
võw
, 
gameHeight
)

180 
glm
::
vec2
 
ªsu…
;

181 
ªsu…
.
x
 = 
pixñS∑˚Posôi⁄
.x - 
ˇmîa
.
À·
 * 
võw
.
up
 / 
gameHeight
;

182 
ªsu…
.
y
 = 
pixñS∑˚Posôi⁄
.y - 
ˇmîa
.
down
 * 
võw
.
up
 / 
gameHeight
;

183  
ªsu…
;

184 
	}
}

185 
	gglm
::
vec2
 
	$m©h_s¸ìn•a˚_to_game•a˚
(
I¡Paú
 
s¸ìnS∑˚Posôi⁄
, 
GameS∑˚Camîa
 
ˇmîa
, 
VõwP‹tCamîa
 
võw
, 
gameHeight
)

188 
glm
::
vec2
 
pixñ•a˚
 = 
	`m©h_s¸ìn•a˚_to_pixñ•a˚
(
s¸ìnS∑˚Posôi⁄
, 
ˇmîa
, 
võw
, 
gameHeight
);

190 
glm
::
vec2
 
ªsu…
;

191 
divide
 = 
	`m©h_game•a˚_to_pixñ•a˚_mu…ùlõr
(
võw
, 
gameHeight
);

192 
ªsu…
.
x
 = 
pixñ•a˚
.x / 
divide
;

193 
ªsu…
.
y
 = 
pixñ•a˚
.y / 
divide
;

195  
ªsu…
;

196 
	}
}

199 
	gglm
::
m©4
 
	$m©h_å™¶©ed_m©rix
(
glm
::
vec3
 
å™¶©e
)

201 
glm
::
m©4
 
ªsu…
 = glm::
	`m©4
(1.0);

202  
glm
::
	`å™¶©e
(
ªsu…
, 
å™¶©e
);

203 
	}
}

204 
	gglm
::
m©4
 
	$m©h_å™¶©ed_sˇÀd_m©rix
(
glm
::
vec3
 
å™¶©e
, glm::vec3 
sˇÀ
)

206 
glm
::
m©4
 
ªsu…
 = glm::
	`m©4
(1.0f);

207 
ªsu…
 = 
glm
::
	`å™¶©e
‘esu…, 
å™¶©e
);

208 
ªsu…
 = 
glm
::
	`sˇÀ
‘esu…, 
sˇÀ
);

209  
ªsu…
;

210 
	}
}

211 
	$m©h_game•a˚_to_pixñ•a˚_mu…ùlõr
(
VõwP‹tCamîa
 
võw
, 
gameHeight
)

213 
yDi°
 = (Ë
võw
.
up
 - (Ëvõw.
down
;

214 
ªsu…
 = 
yDi°
 / 
gameHeight
;

215  
ªsu…
;

216 
	}
}

217 
	$m©h_pixñ•a˚_to_game•a˚_mu…ùlõr
(
VõwP‹tCamîa
 
võw
, 
gameHeight
)

219  1 / 
	`m©h_game•a˚_to_pixñ•a˚_mu…ùlõr
(
võw
, 
gameHeight
);

220 
	}
}

	@Click.cpp

1 
	~"Click.h
"

2 
	~"C⁄°™ts.h
"

4 
	$buâ⁄_˛ick_°©e_£t_Æl_Ál£
(
buâ⁄_˛ick_°©e
* 
°©e
)

6 
°©e
->
¥es£d
 = 
Ál£
;

7 
°©e
->
¥es£d_this_‰ame
 = 
Ál£
;

8 
°©e
->
ªÀa£d_this_‰ame
 = 
Ál£
;

9 
°©e
->
ªÀa£d_sö˚_¥es£d_œ°
 = 
åue
;

10 
°©e
->
time_¥es£d
 = 0;

11 
	}
}

12 
buâ⁄_˛ick_°©e
 
	$˛ick_ã°_buâ⁄
(
Edô‹UISèã
* 
ui_°©e
, 
GAME_ACTION
 
a˘i⁄
)

17 
M≠pögSèã
 
°©e
;

18 
	}
}

19 
M≠pögSèã
 
	$˛ick_make_deÁu…_m≠pög_°©e
()

21 
M≠pögSèã
 
ªsu…
;

22 
i
 = 0; i < 
G_LENGTH
; i++)

24 
ªsu…
.
¥im¨y_m≠pög
[
i
] = 
SDLK_UNKNOWN
;

25 
ªsu…
.
£c⁄d¨y_m≠pög
[
i
] = 
SDLK_UNKNOWN
;

27 
ªsu…
.
¥im¨y_m≠pög
[
G_UP
] = 
SDLK_UP
;

28 
ªsu…
.
¥im¨y_m≠pög
[
G_DOWN
] = 
SDLK_DOWN
;

29 
ªsu…
.
¥im¨y_m≠pög
[
G_LEFT
] = 
SDLK_LEFT
;

30 
ªsu…
.
¥im¨y_m≠pög
[
G_RIGHT
] = 
SDLK_RIGHT
;

31 
ªsu…
.
¥im¨y_m≠pög
[
G_UNDO
] = 
SDLK_z
;

32 
ªsu…
.
¥im¨y_m≠pög
[
G_RESET
] = 
SDLK_r
;

33 
ªsu…
.
¥im¨y_m≠pög
[
G_EXIT_LEVEL
] = 
SDLK_q
;

34 
ªsu…
.
¥im¨y_m≠pög
[
G_BACK_MENU
] = 
SDLK_BACKSPACE
;

35 
ªsu…
.
¥im¨y_m≠pög
[
G_MENU_UP
] = 
SDLK_w
;

36 
ªsu…
.
¥im¨y_m≠pög
[
G_MENU_DOWN
] = 
SDLK_s
;

37 
ªsu…
.
¥im¨y_m≠pög
[
G_MENU_ENTER
] = 
SDLK_KP_ENTER
;

39 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_UP
] = 
SDLK_w
;

40 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_DOWN
] = 
SDLK_s
;

41 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_LEFT
] = 
SDLK_a
;

42 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_RIGHT
] = 
SDLK_d
;

43 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_UNDO
] = 
SDLK_UNKNOWN
;

44 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_RESET
] = 
SDLK_UNKNOWN
;

45 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_EXIT_LEVEL
] = 
SDLK_UNKNOWN
;

46 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_BACK_MENU
] = 
SDLK_UNKNOWN
;

47 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_MENU_UP
] = 
SDLK_UP
;

48 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_MENU_DOWN
] = 
SDLK_DOWN
;

49 
ªsu…
.
£c⁄d¨y_m≠pög
[
G_MENU_ENTER
] = 
SDLK_UNKNOWN
;

51  
ªsu…
;

52 
	}
}

54 
Edô‹UISèã
 
	$˛ick_ui_öô
(
Mem‹y
* 
≥rm™ít_mem‹y
)

56 
Edô‹UISèã
 
ªsu…
;

58 
ªsu…
.
time_sö˚_s˚√_°¨ãd
 = 0;

59 
ªsu…
.
time_tûl_∂ayî_ˇn_move
 = 0;

60 
ªsu…
.
time_sö˚_œ°_∂ayî_a˘i⁄
 = 0;

62 
ªsu…
.
mo°_ª˚¡ly_¥es£d_dúe˘i⁄
 = ' ';

63 
ªsu…
.
Àâîs
 = (
buâ⁄_˛ick_°©e
*)
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, (buâ⁄_˛ick_°©eË* 
NUM_LETTERS_ON_KEYBOARD
);

64 
ªsu…
.
buâ⁄_m≠pög
 = 
	`˛ick_make_deÁu…_m≠pög_°©e
();

65 
i
 = 0; i < 
NUM_SDLK_KEYCODES
; i++)

67 
ªsu…
.
key_vÆues
[
i
].
¥es£d
 = 
Ál£
;

68 
ªsu…
.
key_vÆues
[
i
].
¥es£d_this_‰ame
 = 
Ál£
;

69 
ªsu…
.
key_vÆues
[
i
].
ªÀa£d_this_‰ame
 = 
Ál£
;

70 
ªsu…
.
key_vÆues
[
i
].
ªÀa£d_sö˚_¥es£d_œ°
 = 
åue
;

71 
ªsu…
.
key_vÆues
[
i
].
time_¥es£d
 = 0;

73 
i
 = 0; i < 
NUM_LETTERS_ON_KEYBOARD
; i++)

75 
ªsu…
.
Àâîs
[
i
].
¥es£d
 = 
Ál£
;

76 
ªsu…
.
Àâîs
[
i
].
¥es£d_this_‰ame
 = 
Ál£
;

77 
ªsu…
.
Àâîs
[
i
].
ªÀa£d_this_‰ame
 = 
Ál£
;

78 
ªsu…
.
Àâîs
[
i
].
ªÀa£d_sö˚_¥es£d_œ°
 = 
åue
;

79 
ªsu…
.
Àâîs
[
i
].
time_¥es£d
 = 0;

81 
	`buâ⁄_˛ick_°©e_£t_Æl_Ál£
(&
ªsu…
.
À·
);

82 
	`buâ⁄_˛ick_°©e_£t_Æl_Ál£
(&
ªsu…
.
right
);

83 
	`buâ⁄_˛ick_°©e_£t_Æl_Ál£
(&
ªsu…
.
down
);

84 
	`buâ⁄_˛ick_°©e_£t_Æl_Ál£
(&
ªsu…
.
up
);

85 
	`buâ⁄_˛ick_°©e_£t_Æl_Ál£
(&
ªsu…
.
•a˚b¨
);

86 
	`buâ⁄_˛ick_°©e_£t_Æl_Ál£
(&
ªsu…
.
íãr
);

87 
x
 = 
SDLK_UNDERSCORE
;

88 
z
 = 
SDLK_RIGHTPAREN
;

89 
ªsu…
.
game_height_cuºít
 = 
GAME_HEIGHT_START
;

90 
ªsu…
.
ty≥
 = 
ECS_NEUTRAL
;

91 
ªsu…
.
mou£GamePos
 = 
glm
::
	`vec2
(0, 0);

92 
ªsu…
.
mou£_œ°_pos
 = 
	`m©h_öçaú_¸óã
(0, 0);

93 
ªsu…
.
mou£Pos
 = 
	`m©h_öçaú_¸óã
(0, 0);

94 
ªsu…
.
tŸÆMove
 = 
	`m©h_öçaú_¸óã
(0, 0);

95 
ªsu…
.
mou£_À·_˛ick_down
 = 
Ál£
;

96 
ªsu…
.
mou£_right_˛ick_down
 = 
Ál£
;

97 
ªsu…
.
un
.
√uåÆ
.
x
 = 0;

98 
ªsu…
.
shi·_key_down_this_‰ame
 = 
Ál£
;

99 
ªsu…
.
shi·_key_up_this_‰ame
 = 
Ál£
;

100 
ªsu…
.
shi·_key_down
 = 
Ál£
;

101 
ªsu…
.
c⁄åﬁ_key_down
 = 
Ál£
;

102 
ªsu…
.
Æt_key_down
 = 
Ál£
;

103 
ªsu…
.
z_key_down_this_‰ame
 = 
Ál£
;

104 
ªsu…
.
back•a˚_key_down_this_‰ame
 = 
Ál£
;

106  
ªsu…
;

107 
	}
}

110 
	$˛ick_sdl_keycode_to_ödex_posôi⁄
(
sdlk_keycode
)

112 
i
 = 0; i < 
NUM_SDLK_KEYCODES
; i++)

114 i‡(
Æl_sdl_keycodes
[
i
] =
sdlk_keycode
)

116  
i
;

119 
	`¸ash_îr
("weÅriedÅoÜookupá sdlk keycode, but it didn't matchány sdlkeycodes we knowábout. This shouldÇever happen. crash!");

121 
	}
}

	@Click.h

1 #¥agm®
⁄˚


2 
	~"M©h.h
"

3 
	~<SDL.h
>

4 c⁄° 
	gGAME_HEIGHT_START
 = 12;

5 c⁄° 
	gNUM_LETTERS_ON_KEYBOARD
 = 
SDLK_z
 - 
SDLK_a
 + 1;

6 c⁄° 
	gNUM_SDLK_KEYCODES
 = 255;

7 c⁄° 
	gNUM_KEYS_TO_TEST
 = 5;

9 
	eEdô‹ClickSèãTy≥


11 
	mECS_NEUTRAL
,

12 
	mECS_BRUSH
,

13 
	mECS_RESIZE_GAMESTATE
,

14 
	mECS_MOVE_GAMESTATE
,

15 
	mECS_CREATE_GAMESTATE
,

16 
	mECS_EDIT_NAME
,

17 
	mECS_COUNT


20 
	eGAME_ACTION


22 
	mG_UP
,

23 
	mG_DOWN
,

24 
	mG_LEFT
,

25 
	mG_RIGHT
,

26 
	mG_UNDO
,

27 
	mG_RESET
,

28 
	mG_EXIT_LEVEL
,

29 
	mG_BACK_MENU
,

30 
	mG_MENU_UP
,

31 
	mG_MENU_DOWN
,

32 
	mG_MENU_ENTER
,

33 
	mG_LENGTH
,

34 
	mG_ERROR


36 
	sNeuåÆClickSèã


38 
	mx
;

40 
	sBrushClickSèã


42 
	my
;

44 
	sResizeClickSèã


46 
boﬁ
 
	mdøggög_À·
;

47 
boﬁ
 
	mdøggög_right
;

48 
boﬁ
 
	mdøggög_up
;

49 
boﬁ
 
	mdøggög_down
;

50 
	mdøggög_game°©e_ödex
;

52 
	sMoveClickSèã


54 
	mmovög_game°©e_ödex
;

55 
	mglm
::
vec2
 
move_°¨t_posôi⁄
;

57 
	sCª©eGame°©eClickSèã


59 
I¡Paú
 
	mgamew‹ld_°¨t_pos
;

62 
	sbuâ⁄_˛ick_°©e


65 
boﬁ
 
	m¥es£d_this_‰ame
;

66 
boﬁ
 
	mªÀa£d_this_‰ame
;

67 
boﬁ
 
	m¥es£d
;

68 
boﬁ
 
	mªÀa£d_sö˚_¥es£d_œ°
;

69 
	mtime_¥es£d
;

72 
	sM≠pögSèã


74 
SDL_KeyCode
 
	m¥im¨y_m≠pög
[
G_LENGTH
];

75 
SDL_KeyCode
 
	m£c⁄d¨y_m≠pög
[
G_LENGTH
];

78 
	sEdô‹UISèã


80 
boﬁ
 
	mupd©e_a˘uÆ_s¸ìn_size
;

81 
	mglm
::
ivec2
 
√xt_ˇmîa_size
;

82 
	mtime_sö˚_s˚√_°¨ãd
;

83 
	mtime_tûl_∂ayî_ˇn_move
;

84 
	mtime_sö˚_œ°_∂ayî_a˘i⁄
;

85 
	mtŸÆ_time_∑s£d
;

86 
	mgame_height_cuºít
;

88 
	mmo°_ª˚¡ly_¥es£d_dúe˘i⁄
;

89 
M≠pögSèã
 
	mbuâ⁄_m≠pög
;

90 
buâ⁄_˛ick_°©e
* 
	mÀâîs
;

91 
buâ⁄_˛ick_°©e
 
	mkey_vÆues
[
NUM_SDLK_KEYCODES
];

92 
buâ⁄_˛ick_°©e
 
	mÀ·
;

93 
buâ⁄_˛ick_°©e
 
	mright
;

94 
buâ⁄_˛ick_°©e
 
	mup
;

95 
buâ⁄_˛ick_°©e
 
	mdown
;

97 
buâ⁄_˛ick_°©e
 
	m•a˚b¨
;

98 
buâ⁄_˛ick_°©e
 
	míãr
;

99 
Edô‹ClickSèãTy≥
 
	mty≥
;

101 
boﬁ
 
	m˛ick_À·_down_this_‰ame
;

102 
boﬁ
 
	m˛ick_À·_up_this_‰ame
;

103 
boﬁ
 
	mmou£_À·_˛ick_down
;

104 
boﬁ
 
	mmou£_right_˛ick_down
;

105 
boﬁ
 
	mshi·_key_down_this_‰ame
;

106 
boﬁ
 
	mshi·_key_up_this_‰ame
;

107 
boﬁ
 
	mshi·_key_down
;

108 
boﬁ
 
	mc⁄åﬁ_key_down
;

109 
boﬁ
 
	mÆt_key_down
;

110 
boﬁ
 
	mz_key_down_this_‰ame
;

111 
	mwhìl_move
;

112 
boﬁ
 
	mback•a˚_key_down_this_‰ame
;

115 
	mglm
::
vec2
 
mou£GamePos
;

116 
I¡Paú
 
	mmou£_œ°_pos
;

117 
I¡Paú
 
	mmou£Pos
;

118 
I¡Paú
 
	mtŸÆMove
;

120 
NeuåÆClickSèã
 
	m√uåÆ
;

121 
BrushClickSèã
 
	mbrush
;

122 
ResizeClickSèã
 
	mªsize
;

123 
MoveClickSèã
 
	mmove
;

124 
Cª©eGame°©eClickSèã
 
	m¸óã
;

125 } 
	mun
;

129 
buâ⁄_˛ick_°©e
 
˛ick_ã°_buâ⁄
(
Edô‹UISèã
* 
ui_°©e
, 
GAME_ACTION
 
a˘i⁄
);

130 
M≠pögSèã
 
˛ick_make_deÁu…_m≠pög_°©e
();

131 
buâ⁄_˛ick_°©e_£t_Æl_Ál£
(
buâ⁄_˛ick_°©e
* 
°©e
);

132 
Edô‹UISèã
 
˛ick_ui_öô
(
Mem‹y
* 
≥rm™ít_mem‹y
);

133 
˛ick_sdl_keycode_to_ödex_posôi⁄
(
sdlk_keycode
);

134 c⁄° 
	gÆl_sdl_keycodes
[] = {

135 
SDLK_0
,

136 
SDLK_1
,

137 
SDLK_2
,

138 
SDLK_3
,

139 
SDLK_4
,

140 
SDLK_5
,

141 
SDLK_6
,

142 
SDLK_7
,

143 
SDLK_8
,

144 
SDLK_9
,

145 
SDLK_a
,

146 
SDLK_AC_BACK
,

147 
SDLK_AC_BOOKMARKS
,

148 
SDLK_AC_FORWARD
,

149 
SDLK_AC_HOME
,

150 
SDLK_AC_REFRESH
,

151 
SDLK_AC_SEARCH
,

152 
SDLK_AC_STOP
,

153 
SDLK_AGAIN
,

154 
SDLK_ALTERASE
,

155 
SDLK_QUOTE
,

156 
SDLK_APPLICATION
,

157 
SDLK_AUDIOMUTE
,

158 
SDLK_AUDIONEXT
,

159 
SDLK_AUDIOPLAY
,

160 
SDLK_AUDIOPREV
,

161 
SDLK_AUDIOSTOP
,

162 
SDLK_b
,

163 
SDLK_BACKSLASH
,

164 
SDLK_BACKSPACE
,

165 
SDLK_BRIGHTNESSDOWN
,

166 
SDLK_BRIGHTNESSUP
,

167 
SDLK_c
,

168 
SDLK_CALCULATOR
,

169 
SDLK_CANCEL
,

170 
SDLK_CAPSLOCK
,

171 
SDLK_CLEAR
,

172 
SDLK_CLEARAGAIN
,

173 
SDLK_COMMA
,

174 
SDLK_COMPUTER
,

175 
SDLK_COPY
,

176 
SDLK_CRSEL
,

177 
SDLK_CURRENCYSUBUNIT
,

178 
SDLK_CURRENCYUNIT
,

179 
SDLK_CUT
,

180 
SDLK_d
,

181 
SDLK_DECIMALSEPARATOR
,

182 
SDLK_DELETE
,

183 
SDLK_DISPLAYSWITCH
,

184 
SDLK_DOWN
,

185 
SDLK_e
,

186 
SDLK_EJECT
,

187 
SDLK_END
,

188 
SDLK_EQUALS
,

189 
SDLK_ESCAPE
,

190 
SDLK_EXECUTE
,

191 
SDLK_EXSEL
,

192 
SDLK_f
,

193 
SDLK_F1
,

194 
SDLK_F10
,

195 
SDLK_F11
,

196 
SDLK_F12
,

197 
SDLK_F13
,

198 
SDLK_F14
,

199 
SDLK_F15
,

200 
SDLK_F16
,

201 
SDLK_F17
,

202 
SDLK_F18
,

203 
SDLK_F19
,

204 
SDLK_F2
,

205 
SDLK_F20
,

206 
SDLK_F21
,

207 
SDLK_F22
,

208 
SDLK_F23
,

209 
SDLK_F24
,

210 
SDLK_F3
,

211 
SDLK_F4
,

212 
SDLK_F5
,

213 
SDLK_F6
,

214 
SDLK_F7
,

215 
SDLK_F8
,

216 
SDLK_F9
,

217 
SDLK_FIND
,

218 
SDLK_g
,

219 
SDLK_BACKQUOTE
,

220 
SDLK_h
,

221 
SDLK_HELP
,

222 
SDLK_HOME
,

223 
SDLK_i
,

224 
SDLK_INSERT
,

225 
SDLK_j
,

226 
SDLK_k
,

227 
SDLK_KBDILLUMDOWN
,

228 
SDLK_KBDILLUMTOGGLE
,

229 
SDLK_KBDILLUMUP
,

230 
SDLK_KP_0
,

231 
SDLK_KP_00
,

232 
SDLK_KP_000
,

233 
SDLK_KP_1
,

234 
SDLK_KP_2
,

235 
SDLK_KP_3
,

236 
SDLK_KP_4
,

237 
SDLK_KP_5
,

238 
SDLK_KP_6
,

239 
SDLK_KP_7
,

240 
SDLK_KP_8
,

241 
SDLK_KP_9
,

242 
SDLK_KP_A
,

243 
SDLK_KP_AMPERSAND
,

244 
SDLK_KP_AT
,

245 
SDLK_KP_B
,

246 
SDLK_KP_BACKSPACE
,

247 
SDLK_KP_BINARY
,

248 
SDLK_KP_C
,

249 
SDLK_KP_CLEAR
,

250 
SDLK_KP_CLEARENTRY
,

251 
SDLK_KP_COLON
,

252 
SDLK_KP_COMMA
,

253 
SDLK_KP_D
,

254 
SDLK_KP_DBLAMPERSAND
,

255 
SDLK_KP_DECIMAL
,

256 
SDLK_KP_DIVIDE
,

257 
SDLK_KP_E
,

258 
SDLK_KP_ENTER
,

259 
SDLK_KP_EQUALS
,

260 
SDLK_KP_EQUALSAS400
,

261 
SDLK_KP_EXCLAM
,

262 
SDLK_KP_F
,

263 
SDLK_KP_GREATER
,

264 
SDLK_KP_HASH
,

265 
SDLK_KP_HEXADECIMAL
,

266 
SDLK_KP_LEFTBRACE
,

267 
SDLK_KP_LEFTPAREN
,

268 
SDLK_KP_LESS
,

269 
SDLK_KP_MEMADD
,

270 
SDLK_KP_MEMCLEAR
,

271 
SDLK_KP_MEMDIVIDE
,

272 
SDLK_KP_MEMMULTIPLY
,

273 
SDLK_KP_MEMRECALL
,

274 
SDLK_KP_MEMSTORE
,

275 
SDLK_KP_MEMSUBTRACT
,

276 
SDLK_KP_MINUS
,

277 
SDLK_KP_MULTIPLY
,

278 
SDLK_KP_OCTAL
,

279 
SDLK_KP_PERCENT
,

280 
SDLK_KP_PERIOD
,

281 
SDLK_KP_PLUS
,

282 
SDLK_KP_PLUSMINUS
,

283 
SDLK_KP_POWER
,

284 
SDLK_KP_RIGHTBRACE
,

285 
SDLK_KP_RIGHTPAREN
,

286 
SDLK_KP_SPACE
,

287 
SDLK_KP_TAB
,

288 
SDLK_KP_VERTICALBAR
,

289 
SDLK_KP_XOR
,

290 
SDLK_l
,

291 
SDLK_LALT
,

292 
SDLK_LCTRL
,

293 
SDLK_LEFT
,

294 
SDLK_LEFTBRACKET
,

295 
SDLK_LGUI
,

296 
SDLK_LSHIFT
,

297 
SDLK_m
,

298 
SDLK_MAIL
,

299 
SDLK_MEDIASELECT
,

300 
SDLK_MENU
,

301 
SDLK_MINUS
,

302 
SDLK_MODE
,

303 
SDLK_MUTE
,

304 
SDLK_n
,

305 
SDLK_NUMLOCKCLEAR
,

306 
SDLK_o
,

307 
SDLK_OPER
,

308 
SDLK_OUT
,

309 
SDLK_p
,

310 
SDLK_PAGEDOWN
,

311 
SDLK_PAGEUP
,

312 
SDLK_PASTE
,

313 
SDLK_PAUSE
,

314 
SDLK_PERIOD
,

315 
SDLK_POWER
,

316 
SDLK_PRINTSCREEN
,

317 
SDLK_PRIOR
,

318 
SDLK_q
,

319 
SDLK_r
,

320 
SDLK_RALT
,

321 
SDLK_RCTRL
,

322 
SDLK_RETURN
,

323 
SDLK_RETURN2
,

324 
SDLK_RGUI
,

325 
SDLK_RIGHT
,

326 
SDLK_RIGHTBRACKET
,

327 
SDLK_RSHIFT
,

328 
SDLK_s
,

329 
SDLK_SCROLLLOCK
,

330 
SDLK_SELECT
,

331 
SDLK_SEMICOLON
,

332 
SDLK_SEPARATOR
,

333 
SDLK_SLASH
,

334 
SDLK_SLEEP
,

335 
SDLK_SPACE
,

336 
SDLK_STOP
,

337 
SDLK_SYSREQ
,

338 
SDLK_t
,

339 
SDLK_TAB
,

340 
SDLK_THOUSANDSSEPARATOR
,

341 
SDLK_u
,

342 
SDLK_UNDO
,

343 
SDLK_UNKNOWN
,

344 
SDLK_UP
,

345 
SDLK_v
,

346 
SDLK_VOLUMEDOWN
,

347 
SDLK_VOLUMEUP
,

348 
SDLK_w
,

349 
SDLK_WWW
,

350 
SDLK_x
,

351 
SDLK_y
,

352 
SDLK_z
,

353 
SDL_SCANCODE_INTERNATIONAL1
,

354 
SDL_SCANCODE_INTERNATIONAL2
,

355 
SDL_SCANCODE_INTERNATIONAL3
,

356 
SDL_SCANCODE_INTERNATIONAL4
,

357 
SDL_SCANCODE_INTERNATIONAL5
,

358 
SDL_SCANCODE_INTERNATIONAL6
,

359 
SDL_SCANCODE_INTERNATIONAL7
,

360 
SDL_SCANCODE_INTERNATIONAL8
,

361 
SDL_SCANCODE_INTERNATIONAL9
,

362 
SDL_SCANCODE_LANG1
,

363 
SDL_SCANCODE_LANG2
,

364 
SDL_SCANCODE_LANG3
,

365 
SDL_SCANCODE_LANG4
,

366 
SDL_SCANCODE_LANG5
,

367 
SDL_SCANCODE_LANG6
,

368 
SDL_SCANCODE_LANG7
,

369 
SDL_SCANCODE_LANG8
,

370 
SDL_SCANCODE_LANG9
,

371 
SDL_SCANCODE_NONUSBACKSLASH
,

372 
SDL_SCANCODE_NONUSHASH
,

373 
SDLK_AMPERSAND
,

374 
SDLK_ASTERISK
,

375 
SDLK_AT
,

376 
SDLK_CARET
,

377 
SDLK_COLON
,

378 
SDLK_DOLLAR
,

379 
SDLK_EXCLAIM
,

380 
SDLK_GREATER
,

381 
SDLK_HASH
,

382 
SDLK_LEFTPAREN
,

383 
SDLK_LESS
,

384 
SDLK_PERCENT
,

385 
SDLK_PLUS
,

386 
SDLK_QUESTION
,

387 
SDLK_QUOTEDBL
,

388 
SDLK_RIGHTPAREN
,

389 
SDLK_UNDERSCORE


	@Clock.h

1 #¥agm®
⁄˚


2 
	~<Wödows.h
>

3 
	~<io°ªam
>

4 
	~"Mem‹y.h
"

5 
	sClock


7 
LARGE_INTEGER
 
	m˛ockFªquícy
;

8 
LARGE_INTEGER
 
	mpos
;

9 
LARGE_INTEGER
 
	míd
;

12 
ölöe
 
Clock
* 
	$˛ock_¸óã
(
Mem‹y
* 
mem‹y
)

14 
Clock
* 
˛ock
 = (Clock*Ë
	`mem‹y_Æloc
(
mem‹y
, (Clock));

15  
˛ock
;

16 
	}
}

17 
ölöe
 
	$˛ock_°¨t
(
Clock
* 
˛ock
)

19 
	`QuîyPîf‹m™˚Fªquícy
(&(
˛ock
->
˛ockFªquícy
));

20 
	`QuîyPîf‹m™˚Cou¡î
(&(
˛ock
->
pos
));

21 
	}
}

23 
ölöe
 
	$˛ock_íd
(
Clock
* 
˛ock
)

25 
	`QuîyPîf‹m™˚Cou¡î
(&(
˛ock
->
íd
));

26 
timeC⁄sumed
 = (Ë(
˛ock
->
íd
.
QuadP¨t
 - clock->
pos
.QuadPart);

27 
time_ö_mûl£c⁄ds
 = ((Ë(1000 * 
timeC⁄sumed
Ë/ (Ë
˛ock
->
˛ockFªquícy
.
QuadP¨t
);

28 
°d
::
cout
 << "Timêc⁄sumed i¿mûli£c⁄ds" << 
time_ö_mûl£c⁄ds
 << std::
ídl
;

29 
	}
}

	@Constants.cpp

1 
	~"C⁄°™ts.h
"

3 
	$fuŒ_¸ash_îr
(c⁄° * 
ãxt
, c⁄° * 
fûe
, 
löe
)

5 
°d
::
cout
 << "FATAL CRASH" << std::
ídl
;

6 
°d
::
cout
 << 
ãxt
 << "öÜöe:" << 
löe
 << ", i¿fûe:" << 
fûe
 << std::
ídl
;

7 
	`ab‹t
();

8 
	}
}

	@Constants.h

1 #¥agm®
⁄˚


2 
	~<io°ªam
>

5 c⁄° 
	gGAME_LEVEL_NAME_MAX_SIZE
 = 64;

7 c⁄° 
	gMAX_EDITOR_ACTIONS
 = 100000;

8 c⁄° 
	gMAX_NUMBER_GAMESTATES
 = 1000;

9 c⁄° 
	gTIME_TO_DISPLAY_LEVEL_NAME
 = 1.5f;

11 
	eSCENE_TYPE


13 
	mST_EDITOR
,

14 
	mST_EDIT_LEVEL
,

15 
	mST_PLAY_WORLD
,

16 
	mST_PLAY_LEVEL
,

17 
	mST_SHOW_TEXT
,

18 
	mST_MENU
,

19 
	mST_COUNT


22 
	eUI_SPRITE_NAME


24 
	mBUTTON_LEFT
,

25 
	mBUTTON_RIGHT
,

26 
	mBUTTON_CENTER
,

27 
	mUP_ARROW
,

28 
	mDOWN_ARROW
,

29 
	mRIGHT_ARROW
,

30 
	mLEFT_ARROW


34 c⁄° 
	gSCREEN_STARTING_WIDTH
 = 800;

35 c⁄° 
	gSCREEN_STARTING_HEIGHT
 = 600;

36 c⁄° 
	gSCREEN_RATIO
 = (()
SCREEN_STARTING_WIDTH
 / ()
SCREEN_STARTING_HEIGHT
);

37 c⁄° 
	gMAX_NUM_FLOOR_SPRITES
 = 5000;

40 c⁄° 
	gCAMERA_LERP_TIME
 = 0.8f;

41 c⁄° 
	gCAMERA_ZOOM_SPEED
 = 3.0f;

42 c⁄° 
	gCAMERA_MOVE_MULT
 = 0.02f;

44 c⁄° 
	gMAX_ZOOM
 = 2.0f;

45 c⁄° 
	gMAX_ZOOM_OUT_TO_STILL_DISPLAY_OUTLINES
 = 22.0f;

46 c⁄° 
	gMAX_NUM_DOTTED_SPRITES
 = 200;

47 c⁄° 
	gMAX_NUM_CHARACTERS
 = 200;

48 c⁄° 
	gOUTLINE_DRAW_SIZE
 = 0.3f;

52 c⁄° 
	gmax_a˘i⁄s_ö_puzzÀ
 = 1024;

54 c⁄° 
	gWAIT_BETWEEN_PLAYER_MOVE_REPEAT
 = 0.13f;

55 c⁄° 
	gDRAW_TITLE_TIME
 = 2.0f;

60 
	#¸ash_îr
(...Ëdÿ{
	`fuŒ_¸ash_îr
(
__VA_ARGS__
, 
__FILE__
, 
__LINE__
);} 0)

	)

61 
fuŒ_¸ash_îr
(c⁄° * 
ãxt
, c⁄° * 
fûe
, 
löe
);

	@Editor.h

1 #¥agm®
⁄˚


2 
	~"M©h.h
"

3 
	~"GameSèã.h
"

4 
	~"C⁄°™ts.h
"

6 
	eTimeMachöeEdô‹A˘i⁄Name


8 
	mTM_APPLY_BRUSH
,

9 
	mTM_MOVE_GAMESTATE
,

10 
	mTM_MERGE_GAMESTATES
,

11 
	mTM_RESIZE_GAMESTATE
,

12 
	mTM_CREATE_GAMESTATE
,

13 
	mTM_DELETE_GAMESTATE
,

14 
	mTM_REPLACE_GAMESTATE
,

15 
	mTM_UPDATE_GAMESTATE
,

16 
	mTM_UNDO
,

17 
	mTM_CHANGE_LEVEL_MODE
,

18 
	mTM_LEVEL_LINKS
,

19 
	mTM_COUNT


21 
	eLevñMode


23 
	mCrumbÀ
,

24 
	mRïót
,

25 
	mOvîw‹ld


28 
	sW‹ldPosôi⁄


30 
	mÀvñ_ödex
;

31 
I¡Paú
 
	mÀvñ_posôi⁄
;

32 
	mÀvñ_posôi⁄_1d
;

35 
	sS∂ôGame°©e


37 
	mèrgë_game°©e_ödex
;

38 
	mèrgë_x
;

39 
	mèrgë_y
;

40 
boﬁ
 
	m•lô_row_nŸ_cﬁumn
;

42 
	sSuºoundWôhWÆls


44 
	mèrgë_game°©e_ödex
;

46 
	sResizeGame°©e


48 
	mèrgë_game°©e_ödex
;

49 
I¡Paú
 
	m√xt_°¨tög_posôi⁄
;

50 
I¡Paú
 
	m√xt_size
;

51 
I¡Paú
 
	mdi•œ˚mít_‰om_öput_to_√xt
;

53 
	sAµlyBrush


55 
	mèrgë_game°©e_ödex
;

56 
I¡Paú
 
	mèrgë_squ¨e
;

57 
Game°©eBrush
 
	mbrush
;

59 
	sMoveGame°©e


61 
	mèrgë_game°©e_ödex
;

62 
I¡Paú
 
	mmoveDi°™˚
;

64 
	sMîgeGame°©e


66 
	mgame°©e_ödex_À·
;

67 
	mgame°©e_ödex_right
;

68 
I¡Paú
 
	mw‹ld•a˚_À·
;

69 
I¡Paú
 
	mw‹ld•a˚_right
;

71 
	sRemoveGame°©e


73 
	mgame°©e_ödex
;

75 
	sCª©eGameSèã
 {

76 
	mx
;

77 
	my
;

78 
	mw
;

79 
	mh
;

81 
	sRïœ˚Game°©e


83 
GameSèã
* 
	mª∂a˚_°©e
;

84 
	mödex_to_ª∂a˚
;

85 
	m«me
[
GAME_LEVEL_NAME_MAX_SIZE
];

87 
	sCh™geLevñMode


89 
	mödex_to_ª∂a˚
;

90 
LevñMode
 
	mª∂a˚_vÆue
;

92 
	sUpd©eGame°©e


94 
GameSèã
* 
	mª∂a˚_°©e
;

95 
	mödex_to_ª∂a˚
;

97 
	sLevñLöks


99 
W‹ldPosôi⁄
 
	mlök_a
;

100 
W‹ldPosôi⁄
 
	mlök_b
;

104 
	sTimeMachöeEdô‹A˘i⁄


106 
TimeMachöeEdô‹A˘i⁄Name
 
	ma˘i⁄
;

108 
RemoveGame°©e
 
	mªmove
;

109 
MoveGame°©e
 
	mmove
;

110 
MîgeGame°©e
 
	mmîge
;

111 
AµlyBrush
 
	mbrush
;

112 
ResizeGame°©e
 
	mªsize
;

113 
Cª©eGameSèã
 
	m¸óã
;

114 
Rïœ˚Game°©e
 
	mª∂a˚
;

115 
Upd©eGame°©e
 
	mupd©e
;

116 
Ch™geLevñMode
 
	mÀvñ
;

117 } 
	mu
;

120 
	sLevñName


122 
	m«me
[
GAME_LEVEL_NAME_MAX_SIZE
];

125 
	sW‹ldSèã


127 
	mnum_Àvñ
;

128 
I¡Paú
 
	mÀvñ_posôi⁄
[
MAX_NUMBER_GAMESTATES
];

129 
GameSèã
* 
	mÀvñ_°©e
[
MAX_NUMBER_GAMESTATES
];

130 
LevñName
 
	mÀvñ_«mes
[
MAX_NUMBER_GAMESTATES
];

131 
LevñMode
 
	mÀvñ_modes
[
MAX_NUMBER_GAMESTATES
];

132 
boﬁ
 
	mÀvñ_sﬁved
[
MAX_NUMBER_GAMESTATES
];

134 
	sTimeMachöeEdô‹


136 
Mem‹y
* 
	mgame°©e_mem‹y
;

137 
	mcuºít_numbî_of_a˘i⁄s
;

138 
TimeMachöeEdô‹A˘i⁄
 
	ma˘i⁄Li°
[
MAX_EDITOR_ACTIONS
];

140 
W‹ldSèã
 
	mw‹ld_°©e
;

142 
W‹ldPosôi⁄
 
game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_fuŒ
(
TimeMachöeEdô‹
* 
timeMachöe
, 
mou£_game_pos_x
, 
mou£_game_pos_y
);

143 
game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_game°©e
(
TimeMachöeEdô‹
* 
timeMachöe
, 
mou£_game_pos_x
, 
mou£_game_pos_y
);

144 
TimeMachöeEdô‹
* 
game°©e_timemachöe_edô‹_¸óã
(
Mem‹y
* 
mem‹y
, Mem‹y* 
Game°©eMem‹y
);

145 
game°©e_timemachöe_edô‹_öôüli£_‰om_°¨t
(
TimeMachöeEdô‹
* 
edô‹
, 
W‹ldSèã
* 
pos
);

146 
game°©e_timemachöe_°¨t°©e_em±y_öô
(
W‹ldSèã
* 
°¨t_°©e
);

147 
game°©e_timemachöe_edô‹_èke_a˘i⁄
(
TimeMachöeEdô‹
* 
edô‹
, 
W‹ldSèã
* 
maybe_°¨t_°©e
, 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
);

151 
W‹ldPosôi⁄
 
w‹ld_make_w‹ld_posôi⁄_övÆid
();

152 
W‹ldPosôi⁄
 
w‹ld_make_w‹ld_posôi⁄
(
Àvñ_ödex
, 
I¡Paú
 
pos_2d
, 
pos_1d
);

158 
TimeMachöeEdô‹A˘i⁄
 
game°©e_timemachöó˘i⁄_¸óã_undo_a˘i⁄
();

159 
TimeMachöeEdô‹A˘i⁄
 
game°©e_timemachöó˘i⁄_¸óã_¸óã_a˘i⁄
(
xSèπ
, 
ySèπ
, 
w
, 
h
);

160 
TimeMachöeEdô‹A˘i⁄
 
game°©e_timemachöó˘i⁄_¸óã_≠∂y_brush
(
Game°©eBrush
 
brush
, 
èrgë_game°©e
, 
I¡Paú
 
èrgë_squ¨e
);

161 
TimeMachöeEdô‹A˘i⁄
 
game°©e_timemachöó˘i⁄_¸óã_ªsize_gam£°©e
(
èrgë_game°©e
,

162 
AABB
 
√xtPosôi⁄
,

163 
I¡Paú
 
di•œ˚mít_‰om_öput_to_√xt
);

164 
TimeMachöeEdô‹A˘i⁄
 
game°©e_timemachöó˘i⁄_¸óã_move_game°©e
(
èrgë_game°©e
, 
I¡Paú
 
movemít
);

165 
TimeMachöeEdô‹A˘i⁄
 
game°©e_timemachöó˘i⁄_¸óã_dñëe_game°©e
(
èrgë_game°©e
);

166 
TimeMachöeEdô‹A˘i⁄
 
game°©e_timemachöó˘i⁄_¸óã_ª∂a˚_game°©e
(
GameSèã
* 
ª∂a˚mít
, 
to_ª∂a˚
, c⁄° * 
«me
);

167 
TimeMachöeEdô‹A˘i⁄
 
game°©e_timemachöó˘i⁄_¸óã_upd©e_game°©e
(
GameSèã
* 
ª∂a˚mít
, 
to_ª∂a˚
, 
LevñName
 
«me
);

168 
TimeMachöeEdô‹A˘i⁄
 
game°©e_timemachöó˘i⁄_¸óã_ch™ge_Àvñ_mode
(
èrgë_game°©e
, 
LevñMode
 
√xt_mode
);

	@EditorScene.h

1 #¥agm®
⁄˚


2 
	~"GameSèã.h
"

3 
	~"Edô‹.h
"

5 c⁄° 
	g∑Àã_Àngth
 = 21;

6 
	sEdô‹S˚√


8 
TimeMachöeEdô‹
* 
	mtimeMachöe
;

9 
W‹ldSèã
* 
	mtime_machöe_°¨t_°©e
;

10 
	mcuºítBrush
 = 0;

11 
Game°©eBrush
* 
	m∑Àã
;

12 
I¡Paú
 
	m∑Àã_s¸ìn_°¨t
;

16 
Edô‹S˚√
* 
	$edô‹s˚√_£tup_wôh_°¨t_°©e
(
Mem‹y
* 
edô‹_mem‹y
, 
VõwP‹tCamîa
 
ˇmîa_võwp‹t
, 
W‹ldSèã
* 
°¨t_°©e
)

18 
Edô‹S˚√
* 
ªsu…
 = (Edô‹S˚√*)
	`mem‹y_Æloc
(
edô‹_mem‹y
, (EditorScene));

19 
ªsu…
->
timeMachöe
 = 
	`game°©e_timemachöe_edô‹_¸óã
(
edô‹_mem‹y
, 
	`mem‹y_¸óã
(50000000));

20 
ªsu…
->
time_machöe_°¨t_°©e
 = 
°¨t_°©e
;

21 
	`game°©e_timemachöe_edô‹_öôüli£_‰om_°¨t
(
ªsu…
->
timeMachöe
,Ñesu…->
time_machöe_°¨t_°©e
);

23 
ªsu…
->
∑Àã
 = (
Game°©eBrush
*)
	`mem‹y_Æloc
(
edô‹_mem‹y
, (Game°©eBrushË* 
∑Àã_Àngth
);

24 
ªsu…
->
cuºítBrush
 = 0;

25 
ªsu…
->
∑Àã_s¸ìn_°¨t
 = 
	`m©h_öçaú_¸óã
(
ˇmîa_võwp‹t
.
À·
, camîa_võwp‹t.
up
 - 120);

27 
i
 = 0;

28 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
åue
, 
F_NONE
,Årue, 
P_NONE
, 
Ál£
, 
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

29 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
åue
, 
F_TARGET
, 
Ál£
, 
P_NONE
, fÆ£, 
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

30 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
åue
, 
F_START
, 
Ál£
, 
P_NONE
, fÆ£, 
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

31 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
åue
, 
F_LURKING_WALL
, 
Ál£
, 
P_NONE
, fÆ£, 
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

32 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
Põ˚
::
P_NONE
, fÆ£, 
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

33 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_WALL
, fÆ£, 
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

34 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
åue
, 
F_GRILL_COLD
,Årue, 
P_NONE
,Årue, 
	`game°©e_põ˚d©a_make
(),
Ál£
,
	`game°©e_Êo‹d©a_make
());

35 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
åue
, 
F_GRILL_HOT
,Årue, 
P_NONE
,Årue, 
	`game°©e_põ˚d©a_make
(),
Ál£
,
	`game°©e_Êo‹d©a_make
());

36 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_WALL_ALT
, fÆ£,
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

37 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_CRUMBLE
, fÆ£,
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

38 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_CRATE
,Årue,
	`game°©e_põ˚d©a_make
(
CP_PUSH
),Ál£,
	`game°©e_Êo‹d©a_make
());

39 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_CRATE
,Årue,
	`game°©e_põ˚d©a_make
(
CP_PULL
),Ál£,
	`game°©e_Êo‹d©a_make
());

40 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_CRATE
,Årue,
	`game°©e_põ˚d©a_make
(
CP_PARALLEL
),Ál£,
	`game°©e_Êo‹d©a_make
());

41 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_CRATE
,Årue,
	`game°©e_põ˚d©a_make
(
CP_MERGE
),Ál£,
	`game°©e_Êo‹d©a_make
());

42 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_CRATE
,Årue,
	`game°©e_põ˚d©a_make
(
CP_PUSH
,
CP_MERGE
),Ál£,
	`game°©e_Êo‹d©a_make
());

43 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_CRATE
,Årue,
	`game°©e_põ˚d©a_make
(
CP_PUSH
,
CP_PULL
),Ál£,
	`game°©e_Êo‹d©a_make
());

44 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_CRATE
,Årue,
	`game°©e_põ˚d©a_make
(
CP_PUSH
,
CP_PARALLEL
),Ál£,
	`game°©e_Êo‹d©a_make
());

45 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
Ál£
, 
F_NONE
, 
åue
, 
P_PLAYER
, fÆ£,
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

46 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
åue
, 
F_EXIT
, 
Ál£
, 
P_NONE
, fÆ£, 
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

47 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
åue
, 
F_STAIRCASE
, 
Ál£
, 
P_NONE
, fÆ£, 
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

48 
ªsu…
->
∑Àã
[
i
++] = 
	`game°©e_brush_¸óã
(
åue
, 
F_STAIRCASE_LEVELSTART
, 
Ál£
, 
P_NONE
, fÆ£, 
	`game°©e_põ˚d©a_make
(),Ál£,
	`game°©e_Êo‹d©a_make
());

49 i‡(
i
 !
∑Àã_Àngth
)

51 
°d
::
cout
 << 
i
 << std::
ídl
;

52 
°d
::
cout
 << 
∑Àã_Àngth
 << std::
ídl
;

53 
	`¸ash_îr
("youÇeedÅheÇumber ofÉlements inÅheÖaleteÅo beÅeh sameásÅheÜength ofÅheÖalete.");

56  
ªsu…
;

58 
	}
}

59 
Edô‹S˚√
* 
	$edô‹s˚√_£tup
(
Mem‹y
* 
edô‹_mem‹y
, 
VõwP‹tCamîa
 
ˇmîa_võwp‹t
)

61 
	`mem‹y_˛ór
(
edô‹_mem‹y
);

62 
W‹ldSèã
* 
∑ss
 = (W‹ldSèã*)
	`mem‹y_Æloc
(
edô‹_mem‹y
, (WorldState));

63 
	`game°©e_timemachöe_°¨t°©e_em±y_öô
(
∑ss
);

64  
	`edô‹s˚√_£tup_wôh_°¨t_°©e
(
edô‹_mem‹y
, 
ˇmîa_võwp‹t
, 
∑ss
);

65 
	}
}

	@EditorThree.h

	@EditorTimeMachine.cpp

1 
	~"Edô‹.h
"

2 
	~<io°ªam
>

5 
	$dñëe_game°©e_‰om_li°_öã∫Æ
(
TimeMachöeEdô‹
* 
edô‹
, 
ödex_to_dñëe
)

7 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
ödex_to_dñëe
] = 
NULL
;

8 
cuºít_numbî_of_game°©es
 = 
edô‹
->
w‹ld_°©e
.
num_Àvñ
;

10 
i
 = 0; i < 
cuºít_numbî_of_game°©es
; i++)

12 i‡(
i
 =
ödex_to_dñëe
)

15 
z
 = 0; z < 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
w
 *Édô‹->w‹ld_°©e.Àvñ_°©e[i]->
h
;z++)

18 i‡(
	`is_°aúˇ£
(
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
Êo‹
[
z
]))

20 
ãÀ_lök
 = 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
Êo‹_d©a
[
z
].
ãÀp‹ãr_id
;

22 i‡(
ãÀ_lök
 =
ödex_to_dñëe
)

24 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
Êo‹_d©a
[
z
].
ãÀp‹ãr_id
 = 0;

25 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
Êo‹_d©a
[
z
].
ãÀp‹ãr_èrgë_squ¨e
 = 
	`m©h_öçaú_¸óã
(0, 0);

26 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
Êo‹
[
z
] = 
Flo‹
::
F_NONE
;

32 if(
ãÀ_lök
 > 
ödex_to_dñëe
)

33 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
Êo‹_d©a
[
z
].
ãÀp‹ãr_id
 -= 1;

39 
i
 = 
ödex_to_dñëe
; i < 
cuºít_numbî_of_game°©es
; i++)

41 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
i
] =Éditor->world_state.level_state[i + 1];

43 
i
 = 
ödex_to_dñëe
; i < 
cuºít_numbî_of_game°©es
; i++)

45 
edô‹
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
] =Éditor->world_state.level_position[i + 1];

47 
i
 = 
ödex_to_dñëe
; i < 
cuºít_numbî_of_game°©es
; i++)

49 
edô‹
->
w‹ld_°©e
.
Àvñ_«mes
[
i
] =Éditor->world_state.level_names[i + 1];

51 
i
 = 
ödex_to_dñëe
; i < 
cuºít_numbî_of_game°©es
; i++)

53 
edô‹
->
w‹ld_°©e
.
Àvñ_modes
[
i
] =Éditor->world_state.level_modes[i + 1];

55 
i
 = 
ödex_to_dñëe
; i < 
cuºít_numbî_of_game°©es
; i++)

57 
edô‹
->
w‹ld_°©e
.
Àvñ_sﬁved
[
i
] =Éditor->world_state.level_solved[i + 1];

59 
edô‹
->
w‹ld_°©e
.
num_Àvñ
--;

60 
	}
}

62 
TimeMachöeEdô‹
* 
	$game°©e_timemachöe_edô‹_¸óã
(
Mem‹y
* 
mem‹y
, Mem‹y* 
game°©e_mem‹y
)

64 
°d
::
cout
 << (
TimeMachöeEdô‹
Ë<< std::
ídl
;

65 
TimeMachöeEdô‹
* 
ªsu…
 = (TimeMachöeEdô‹*Ë
	`mem‹y_Æloc
(
mem‹y
, (TimeMachineEditor));

66 
ªsu…
->
game°©e_mem‹y
 = gamestate_memory;

67 
ªsu…
->
w‹ld_°©e
.
num_Àvñ
 = 0;

68 
ªsu…
->
cuºít_numbî_of_a˘i⁄s
 = 0;

69 
ªsu…
->
w‹ld_°©e
.
Àvñ_°©e
[0] = (
GameSèã
*Ë
	`mem‹y_Æloc
(
game°©e_mem‹y
, (GameSèã*Ë* 
MAX_NUMBER_GAMESTATES
);

70 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
 ; i++)

71 
j
 = 0; j < 
GAME_LEVEL_NAME_MAX_SIZE
;j++)

72 
ªsu…
->
w‹ld_°©e
.
Àvñ_«mes
[
i
].
«me
[
j
] = '\0';

73 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
;i++)

74 
ªsu…
->
w‹ld_°©e
.
Àvñ_sﬁved
[
i
] = 
Ál£
;

75 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
;i++)

76 
ªsu…
->
w‹ld_°©e
.
Àvñ_modes
[
i
] = 
LevñMode
::
CrumbÀ
;

77 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
;i++)

78 
ªsu…
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
] = 
	`m©h_öçaú_¸óã
(0,0);

79  
ªsu…
;

80 
	}
}

81 
	$game°©e_timemachöe_°¨t°©e_em±y_öô
(
W‹ldSèã
* 
°¨t_°©e
)

83 
°¨t_°©e
->
num_Àvñ
 = 0;

84 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

85 
j
 = 0; j < 
GAME_LEVEL_NAME_MAX_SIZE
;j++)

86 
°¨t_°©e
->
Àvñ_«mes
[
i
].
«me
[
j
] = '\0';

87 
	}
}

88 
	$game°©e_timemachöe_edô‹_öôüli£_‰om_°¨t
(
TimeMachöeEdô‹
* 
edô‹
, 
W‹ldSèã
* 
pos
)

90 
	`mem‹y_˛ór
(
edô‹
->
game°©e_mem‹y
);

92 
edô‹
->
w‹ld_°©e
.
num_Àvñ
 = 
pos
->num_level;

93 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

94 
edô‹
->
w‹ld_°©e
.
Àvñ_«mes
[
i
] = 
pos
->level_names[i];

95 
i
 = 0; i < 
pos
->
num_Àvñ
; i++)

97 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
i
] = 
	`game°©e_˛⁄e
(
pos
->Àvñ_°©e[i],Édô‹->
game°©e_mem‹y
);

99 
i
 = 0; i < 
pos
->
num_Àvñ
; i++)

101 
edô‹
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
x
 = 
pos
->level_position[i].x;

102 
edô‹
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
y
 = 
pos
->level_position[i].y;

104 
i
 = 0; i < 
pos
->
num_Àvñ
; i++)

106 
edô‹
->
w‹ld_°©e
.
Àvñ_modes
[
i
] = 
pos
->level_modes[i];

108 
i
 = 0; i < 
pos
->
num_Àvñ
; i++)

110 
edô‹
->
w‹ld_°©e
.
Àvñ_sﬁved
[
i
] = 
pos
->level_solved[i];

112 
	}
}

113 
boﬁ
 
	$èke_u∆ogged_a˘i⁄
(
TimeMachöeEdô‹
* 
edô‹
, 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
)

115 i‡(
a˘i⁄
.a˘i⁄ =
TM_DELETE_GAMESTATE
)

117 
ödex_to_dñëe
 = 
a˘i⁄
.
u
.
ªmove
.
game°©e_ödex
;

118 
	`dñëe_game°©e_‰om_li°_öã∫Æ
(
edô‹
, 
ödex_to_dñëe
);

120 i‡(
a˘i⁄
.a˘i⁄ =
TM_APPLY_BRUSH
)

122 
èrgë_game°©e_ödex
 = 
a˘i⁄
.
u
.
brush
.target_gamestate_index;

123 
GameSèã
* 
game°©e
 = 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
èrgë_game°©e_ödex
];

124 
I¡Paú
 
èrgë_brush_squ¨e
 = 
a˘i⁄
.
u
.
brush
.
èrgë_squ¨e
;

125 
x
 = 
èrgë_brush_squ¨e
.x;

126 
y
 = 
èrgë_brush_squ¨e
.y;

127 
èrgë_brush_squ¨e_1d
 = 
	`f2D
(
x
, 
y
, 
game°©e
->
w
, game°©e->
h
);

128 
Game°©eBrush
 
game°©e_brush
 = 
a˘i⁄
.
u
.
brush
.brush;

130 
boﬁ
 
a˘i⁄_ac˚±ed
 = 
	`game°©e_≠∂y_brush
(
game°©e
, 
game°©e_brush
, 
x
, 
y
);

131 i‡(!
a˘i⁄_ac˚±ed
)

133  
Ál£
;

137 
num_a˘i⁄s
 = 
edô‹
->
cuºít_numbî_of_a˘i⁄s
;

138 
TimeMachöeEdô‹A˘i⁄
 
œ°A˘i⁄
 = 
edô‹
->
a˘i⁄Li°
[
num_a˘i⁄s
 - 1];

139 i‡(
num_a˘i⁄s
 >= 1 &&

140 
œ°A˘i⁄
.
a˘i⁄
 =
TM_APPLY_BRUSH
)

142 
I¡Paú
 
œ°_èrgë_squ¨e
 = 
œ°A˘i⁄
.
u
.
brush
.
èrgë_squ¨e
;

143 
œ°_èrgë_Àvñ
 = 
œ°A˘i⁄
.
u
.
brush
.
èrgë_game°©e_ödex
;

144 
œ°_w
 = 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
œ°_èrgë_Àvñ
]->
w
;

145 
œ°_h
 = 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
œ°_èrgë_Àvñ
]->
h
;

146 
œ°_èrgë_squ¨e_1d
 = 
	`f2D
(
œ°_èrgë_squ¨e
.
x
,Üa°_èrgë_squ¨e.
y
, 
œ°_w
, 
œ°_h
);

147 i‡(
	`is_°aúˇ£
(
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
œ°_èrgë_Àvñ
]->
Êo‹
[
œ°_èrgë_squ¨e_1d
]) &&

148 
	`is_°aúˇ£
(
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
èrgë_game°©e_ödex
]->
Êo‹
[
èrgë_brush_squ¨e_1d
]) &&

149 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
œ°_èrgë_Àvñ
]->
Êo‹_d©a
[
œ°_èrgë_squ¨e_1d
].
ãÀp‹ãr_id
 == -1

152 
èrgë_Àvñ
 = 
a˘i⁄
.
u
.
brush
.
èrgë_game°©e_ödex
;

153 
I¡Paú
 
èrgë_squ¨e
 = 
a˘i⁄
.
u
.
brush
.target_square;

154 
èrgë_w
 = 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
èrgë_Àvñ
]->
w
;

155 
èrgë_h
 = 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
èrgë_Àvñ
]->
h
;

156 
èrgë_squ¨e_1d
 = 
	`f2D
(
èrgë_squ¨e
.
x
,Å¨gë_squ¨e.
y
, 
èrgë_w
, 
èrgë_h
);

157 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
œ°_èrgë_Àvñ
]->
Êo‹_d©a
[
œ°_èrgë_squ¨e_1d
].
ãÀp‹ãr_id
 = 
èrgë_Àvñ
;

159 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
œ°_èrgë_Àvñ
]->
Êo‹_d©a
[
œ°_èrgë_squ¨e_1d
].
ãÀp‹ãr_èrgë_squ¨e
 = 
èrgë_squ¨e
;

160 
°d
::
cout
 << "fú°Åñï‹ã∏id" << 
èrgë_Àvñ
 << ",Å¨gë_Àvñ" <<Å¨gë_Àvñ << std::
ídl
;

161 
°d
::
cout
 << "£c⁄dÅñï‹ã∏id" << 
œ°_èrgë_Àvñ
 << ",œ°Å¨gëÜevñ" <<Üa°_èrgë_Àvñ << std::
ídl
;

162 
°d
::
cout
 << "èrgë squ¨ê1d" << 
èrgë_squ¨e_1d
 << std::
ídl
;

163 
°d
::
cout
 << "œ°Å¨gë squ¨ê1d" << 
œ°_èrgë_squ¨e_1d
 << std::
ídl
;

164 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
èrgë_Àvñ
]->
Êo‹_d©a
[
èrgë_squ¨e_1d
].
ãÀp‹ãr_id
 = 
œ°_èrgë_Àvñ
;

165 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
èrgë_Àvñ
]->
Êo‹_d©a
[
èrgë_squ¨e_1d
].
ãÀp‹ãr_èrgë_squ¨e
 = 
œ°_èrgë_squ¨e
;

166 
edô‹
->
w‹ld_°©e
.
Àvñ_modes
[
èrgë_Àvñ
] = 
LevñMode
::
Rïót
;

172 i‡(
a˘i⁄
.a˘i⁄ =
TM_MERGE_GAMESTATES
)

174 
ödex_À·
 = 
a˘i⁄
.
u
.
mîge
.
game°©e_ödex_À·
;

175 
ödex_right
 = 
a˘i⁄
.
u
.
mîge
.
game°©e_ödex_right
;

176 
GameSèã
* 
À·
 = 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
ödex_À·
];

177 
GameSèã
* 
right
 = 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
ödex_right
];

178 
I¡Paú
 
w‹ld•a˚_À·
 = 
a˘i⁄
.
u
.
mîge
.worldspace_left;

179 
I¡Paú
 
w‹ld•a˚_right
 = 
a˘i⁄
.
u
.
mîge
.worldspace_right;

181 
xSèπ
 = 
	`möi
(
w‹ld•a˚_À·
.
x
, 
w‹ld•a˚_right
.x);

182 
ySèπ
 = 
	`möi
(
w‹ld•a˚_À·
.
y
, 
w‹ld•a˚_right
.y);

183 
I¡Paú
 
À·Off£t
 = 
	`m©h_öçaú_¸óã
(
w‹ld•a˚_À·
.
x
 - 
xSèπ
, w‹ld•a˚_À·.
y
 - 
ySèπ
);

184 
I¡Paú
 
rightOff£t
 = 
	`m©h_öçaú_¸óã
(
w‹ld•a˚_right
.
x
 - 
xSèπ
, w‹ld•a˚_right.
y
 - 
ySèπ
);

186 
ouçut_Àngth_x
 = 
	`maxi
(
À·Off£t
.
x
 + 
À·
->
w
, 
rightOff£t
.x + 
right
->w);

187 
ouçut_Àngth_y
 = 
	`maxi
(
À·Off£t
.
y
 + 
À·
->
h
, 
rightOff£t
.y + 
right
->h);

188 
I¡Paú
 
ouçut_Àngth
 = 
	`m©h_öçaú_¸óã
(
ouçut_Àngth_x
, 
ouçut_Àngth_y
);

189 
GameSèã
* 
√xt
 = 
	`game°©e_mîge_wôh_Æloˇã
(
À·
, 
right
, 
ouçut_Àngth
, 
edô‹
->
game°©e_mem‹y
, 
À·Off£t
, 
rightOff£t
);

191 
	`dñëe_game°©e_‰om_li°_öã∫Æ
(
edô‹
, 
ödex_right
);

192 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
ödex_À·
] = 
√xt
;

193 
edô‹
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
ödex_À·
] = 
	`m©h_öçaú_¸óã
(
xSèπ
, 
ySèπ
);

196 i‡(
a˘i⁄
.a˘i⁄ =
TM_MOVE_GAMESTATE
)

198 
èrgë_game°©e_ödex
 = 
a˘i⁄
.
u
.
move
.target_gamestate_index;

199 
I¡Paú
 
di°™˚
 = 
a˘i⁄
.
u
.
move
.
moveDi°™˚
;

201 
edô‹
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
èrgë_game°©e_ödex
] = 
	`m©h_öçaú_add
”dô‹->w‹ld_°©e.Àvñ_posôi⁄[èrgë_game°©e_ödex], 
di°™˚
);

203 i‡(
a˘i⁄
.a˘i⁄ =
TM_RESIZE_GAMESTATE
)

206 
w
 = 
a˘i⁄
.
u
.
ªsize
.
√xt_size
.
x
;

207 
h
 = 
a˘i⁄
.
u
.
ªsize
.
√xt_size
.
y
;

208 
I¡Paú
 
di•œ˚mít
 = 
a˘i⁄
.
u
.
ªsize
.
di•œ˚mít_‰om_öput_to_√xt
;

211 
èrgë_game°©e
 = 
a˘i⁄
.
u
.
ªsize
.
èrgë_game°©e_ödex
;

212 
GameSèã
* 
ﬁd
 = 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
èrgë_game°©e
];

213 
GameSèã
* 
√xt
 = 
	`game°©e_¸óã
(
edô‹
->
game°©e_mem‹y
, 
w
, 
h
);

216 
	`game°©e_ªsize
(
ﬁd
, 
√xt
, 
di•œ˚mít
);

219 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
èrgë_game°©e
] = 
√xt
;

220 
edô‹
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
èrgë_game°©e
] = 
a˘i⁄
.
u
.
ªsize
.
√xt_°¨tög_posôi⁄
;

225 i‡(
a˘i⁄
.a˘i⁄ =
TM_CREATE_GAMESTATE
)

228 
x
 = 
a˘i⁄
.
u
.
¸óã
.x;

229 
y
 = 
a˘i⁄
.
u
.
¸óã
.y;

230 
I¡Paú
 
bŸtom_À·
 = 
	`m©h_öçaú_¸óã
(
x
, 
y
);

231 
w
 = 
a˘i⁄
.
u
.
¸óã
.w;

232 
h
 = 
a˘i⁄
.
u
.
¸óã
.h;

234 
GameSèã
* 
√xt
 = 
	`game°©e_¸óã
(
edô‹
->
game°©e_mem‹y
, 
w
, 
h
);

238 i‡(
edô‹
->
w‹ld_°©e
.
num_Àvñ
 > 
MAX_NUMBER_GAMESTATES
)

240 
	`¸ash_îr
("we have overflowed ourÜevelÉditor gamestate memory. Rats! This means you should implement someÖroper memoryÅechniquesÅoÜikeÇot haveÅhis happen. ");

243 
	`ab‹t
();

245 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[edô‹->w‹ld_°©e.
num_Àvñ
] = 
√xt
;

246 
edô‹
->
w‹ld_°©e
.
Àvñ_posôi⁄
[edô‹->w‹ld_°©e.
num_Àvñ
] = 
bŸtom_À·
;

247 
edô‹
->
w‹ld_°©e
.
num_Àvñ
++;

249 i‡(
a˘i⁄
.a˘i⁄ =
TM_REPLACE_GAMESTATE
)

251 
pos
 = 
a˘i⁄
.
u
.
ª∂a˚
.
ödex_to_ª∂a˚
;

252 
GameSèã
* 
°©e
 = 
a˘i⁄
.
u
.
ª∂a˚
.
ª∂a˚_°©e
;

253 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
pos
] = 
°©e
;

254 
i
 = 0; i < 
GAME_LEVEL_NAME_MAX_SIZE
; i++)

256 
edô‹
->
w‹ld_°©e
.
Àvñ_«mes
[
pos
].
«me
[
i
] = 
a˘i⁄
.
u
.
ª∂a˚
.name[i];

259 i‡(
a˘i⁄
.a˘i⁄ =
TM_UPDATE_GAMESTATE
)

261 
pos
 = 
a˘i⁄
.
u
.
upd©e
.
ödex_to_ª∂a˚
;

262 
GameSèã
* 
°©e
 = 
a˘i⁄
.
u
.
upd©e
.
ª∂a˚_°©e
;

263 
edô‹
->
w‹ld_°©e
.
Àvñ_°©e
[
pos
] = 
°©e
;

265 i‡(
a˘i⁄
.a˘i⁄ =
TM_CHANGE_LEVEL_MODE
)

267 
edô‹
->
w‹ld_°©e
.
Àvñ_modes
[
a˘i⁄
.
u
.
Àvñ
.
ödex_to_ª∂a˚
] =á˘i⁄.u.Àvñ.
ª∂a˚_vÆue
;

269  
åue
;

270 
	}
}

271 
	$game°©e_timemachöe_edô‹_èke_a˘i⁄
(
TimeMachöeEdô‹
* 
edô‹
, 
W‹ldSèã
* 
maybe_°¨t_°©e
, 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
)

274 i‡(
a˘i⁄
.a˘i⁄ =
TM_UNDO
 && 
edô‹
->
cuºít_numbî_of_a˘i⁄s
 > 0)

276 
edô‹
->
cuºít_numbî_of_a˘i⁄s
--;

279 i‡(!
maybe_°¨t_°©e
)

280 
	`¸ash_îr
("hmm, when doingán undoáction, weÖassed,á NULL when we should have givenáÖos state. Fix it!");

281 
	`game°©e_timemachöe_edô‹_öôüli£_‰om_°¨t
(
edô‹
, 
maybe_°¨t_°©e
);

282 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

283 
j
 = 0; j < 
GAME_LEVEL_NAME_MAX_SIZE
;j++)

284 
edô‹
->
w‹ld_°©e
.
Àvñ_«mes
[
i
].
«me
[
j
] = '\0';

285 
i
 = 0; i < 
edô‹
->
cuºít_numbî_of_a˘i⁄s
; i++)

287 
	`èke_u∆ogged_a˘i⁄
(
edô‹
,Édô‹->
a˘i⁄Li°
[
i
]);

290 if(
a˘i⁄
.a˘i⁄ !
TM_UNDO
)

292 
boﬁ
 
ac˚±ed_a˘i⁄
 = 
	`èke_u∆ogged_a˘i⁄
(
edô‹
, 
a˘i⁄
);

293 i‡(
ac˚±ed_a˘i⁄
)

295 
edô‹
->
a˘i⁄Li°
[edô‹->
cuºít_numbî_of_a˘i⁄s
] = 
a˘i⁄
;

296 
edô‹
->
cuºít_numbî_of_a˘i⁄s
++;

300 
	}
}

302 
W‹ldPosôi⁄
 
	$w‹ld_make_w‹ld_posôi⁄
(
Àvñ_ödex
, 
I¡Paú
 
pos_2d
, 
pos_1d
)

304 
W‹ldPosôi⁄
 
ªsu…
;

305 
ªsu…
.
Àvñ_ödex
 =Üevel_index;

306 
ªsu…
.
Àvñ_posôi⁄
 = 
pos_2d
;

307 
ªsu…
.
Àvñ_posôi⁄_1d
 = 
pos_1d
;

308  
ªsu…
;

309 
	}
}

311 
W‹ldPosôi⁄
 
	$w‹ld_make_w‹ld_posôi⁄_övÆid
()

313  
	`w‹ld_make_w‹ld_posôi⁄
(-1, 
	`m©h_öçaú_¸óã
(-1, -1), -1);

314 
	}
}

316 
W‹ldPosôi⁄
 
	$game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_fuŒ
(
TimeMachöeEdô‹
* 
timeMachöe
, 
mou£_game_pos_x
, 
mou£_game_pos_y
)

318 
glm
::
vec2
 
mou£GamePos
 = glm::
	`vec2
(
mou£_game_pos_x
, 
mou£_game_pos_y
);

319 
ödex_˛icked
 = 
	`game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_game°©e
(
timeMachöe
, 
mou£_game_pos_x
, 
mou£_game_pos_y
);

320 
GameSèã
* 
°©e
 = 
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
ödex_˛icked
];

321 
I¡Paú
 
°©e_°¨t
 = 
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
ödex_˛icked
];

322 
I¡Paú
 
grid_˛icked
;

324 
À·
 = (Ë
°©e_°¨t
.
x
;

325 
right
 = (Ë(
°©e_°¨t
.
x
 + 
°©e
->
w
);

326 
down
 = (Ë
°©e_°¨t
.
y
;

327 
up
 = (Ë(
°©e_°¨t
.
y
 + 
°©e
->
h
);

329 
≥r˚¡ageX
 = 
	`≥r˚¡_bëwìn_two_poöts
(
mou£GamePos
.
x
, 
À·
, 
right
);

330 
≥r˚¡ageY
 = 
	`≥r˚¡_bëwìn_two_poöts
(
mou£GamePos
.
y
, 
down
, 
up
);

331 
x_Êo‹_˚Œ_˛icked
 = ()(
≥r˚¡ageX
 * 
°©e
->
w
);

332 
y_Êo‹_˚Œ_˛icked
 = ()(
≥r˚¡ageY
 * 
°©e
->
h
);

334 
grid_˛icked
 = 
	`m©h_öçaú_¸óã
(
x_Êo‹_˚Œ_˛icked
, 
y_Êo‹_˚Œ_˛icked
);

336 
grid_˛icked_1d
 = 
	`f2D
(
grid_˛icked
.
x
, grid_˛icked.
y
, 
°©e
->
w
, sèã->
h
);

337 
W‹ldPosôi⁄
 
ªsu…
 = 
	`w‹ld_make_w‹ld_posôi⁄
(
ödex_˛icked
, 
grid_˛icked
, 
grid_˛icked_1d
);

338  
ªsu…
;

339 
	}
}

340 
	$game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_game°©e
(
TimeMachöeEdô‹
* 
timeMachöe
, 
mou£_game_pos_x
,
mou£_game_pos_y
)

342 
i
 = 0; i < 
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
; i++)

344 
GameSèã
* 
cuºítSèã
 = 
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
i
];

345 
À·
 = (Ë
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
x
;

346 
right
 = (Ë
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
x
 + 
cuºítSèã
->
w
;

347 
down
 = (Ë
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
y
;

348 
up
 = (Ë
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
y
 + 
cuºítSèã
->
h
;

349 
boﬁ
 
˛ickedFlo‹
 = 
	`m©h_˛ick_is_öside_AABB
(
À·
, 
down
, 
right
, 
up
, 
mou£_game_pos_x
, 
mou£_game_pos_y
);

350 if(
˛ickedFlo‹
)

351  
i
;

354 
	}
}

356 
TimeMachöeEdô‹A˘i⁄
 
	$game°©e_timemachöó˘i⁄_¸óã_undo_a˘i⁄
()

358 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
;

359 
a˘i⁄
.a˘i⁄ = 
TM_UNDO
;

360  
a˘i⁄
;

361 
	}
}

362 
TimeMachöeEdô‹A˘i⁄
 
	$game°©e_timemachöó˘i⁄_¸óã_¸óã_a˘i⁄
(
x
, 
y
, 
w
, 
h
)

364 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
;

365 
a˘i⁄
.a˘i⁄ = 
TM_CREATE_GAMESTATE
;

366 
a˘i⁄
.
u
.
¸óã
.
x
 = x;

367 
a˘i⁄
.
u
.
¸óã
.
y
 = y;

368 
a˘i⁄
.
u
.
¸óã
.
w
 = w;

369 
a˘i⁄
.
u
.
¸óã
.
h
 = h;

370  
a˘i⁄
;

371 
	}
}

372 
TimeMachöeEdô‹A˘i⁄
 
	$game°©e_timemachöó˘i⁄_¸óã_≠∂y_brush
(
Game°©eBrush
 
brush
, 
èrgë_game°©e
, 
I¡Paú
 
èrgë_squ¨e
)

374 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
;

375 
a˘i⁄
.a˘i⁄ = 
TM_APPLY_BRUSH
;

376 
a˘i⁄
.
u
.
brush
.brush = brush;

377 
a˘i⁄
.
u
.
brush
.
èrgë_game°©e_ödex
 = 
èrgë_game°©e
;

378 
a˘i⁄
.
u
.
brush
.
èrgë_squ¨e
 =Åarget_square;

379  
a˘i⁄
;

380 
	}
}

381 
TimeMachöeEdô‹A˘i⁄
 
	$game°©e_timemachöó˘i⁄_¸óã_ªsize_gam£°©e
(
èrgë_game°©e
,

382 
AABB
 
√xtPosôi⁄
,

383 
I¡Paú
 
di•œ˚mít_‰om_öput_to_√xt
)

385 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
;

386 
a˘i⁄
.a˘i⁄ = 
TM_RESIZE_GAMESTATE
;

387 
a˘i⁄
.
u
.
ªsize
.
√xt_°¨tög_posôi⁄
.
x
 = (Ë
√xtPosôi⁄
.x;

388 
a˘i⁄
.
u
.
ªsize
.
√xt_°¨tög_posôi⁄
.
y
 = (Ë
√xtPosôi⁄
.y;

389 
a˘i⁄
.
u
.
ªsize
.
èrgë_game°©e_ödex
 = 
èrgë_game°©e
;

390 
a˘i⁄
.
u
.
ªsize
.
di•œ˚mít_‰om_öput_to_√xt
 = displacement_from_input_to_next;

391 
a˘i⁄
.
u
.
ªsize
.
√xt_size
.
x
 = (Ë
√xtPosôi⁄
.
w
;

392 
a˘i⁄
.
u
.
ªsize
.
√xt_size
.
y
 = (Ë
√xtPosôi⁄
.
h
;

393  
a˘i⁄
;

394 
	}
}

395 
TimeMachöeEdô‹A˘i⁄
 
	$game°©e_timemachöó˘i⁄_¸óã_move_game°©e
(
èrgë_game°©e
, 
I¡Paú
 
movemít
)

397 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
;

398 
a˘i⁄
.a˘i⁄ = 
TM_MOVE_GAMESTATE
;

399 
a˘i⁄
.
u
.
move
.
moveDi°™˚
 = 
movemít
;

400 
a˘i⁄
.
u
.
move
.
èrgë_game°©e_ödex
 = 
èrgë_game°©e
;

401  
a˘i⁄
;

402 
	}
}

403 
TimeMachöeEdô‹A˘i⁄
 
	$game°©e_timemachöó˘i⁄_¸óã_dñëe_game°©e
(
èrgë_game°©e
)

405 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
;

406 
a˘i⁄
.a˘i⁄ = 
TM_DELETE_GAMESTATE
;

407 
a˘i⁄
.
u
.
ªmove
.
game°©e_ödex
 = 
èrgë_game°©e
;

408  
a˘i⁄
;

409 
	}
}

411 
TimeMachöeEdô‹A˘i⁄
 
	$game°©e_timemachöó˘i⁄_¸óã_ª∂a˚_game°©e
(
GameSèã
* 
ª∂a˚mít
, 
to_ª∂a˚
, c⁄° * 
«me
)

413 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
;

414 
a˘i⁄
.a˘i⁄ = 
TM_REPLACE_GAMESTATE
;

415 
a˘i⁄
.
u
.
ª∂a˚
.
ª∂a˚_°©e
 = 
ª∂a˚mít
;

416 
a˘i⁄
.
u
.
ª∂a˚
.
ödex_to_ª∂a˚
 = 
to_ª∂a˚
;

417 
i
 = 0; i < 
GAME_LEVEL_NAME_MAX_SIZE
; i++)

419 
a˘i⁄
.
u
.
ª∂a˚
.
«me
[
i
] =Çame[i];

421  
a˘i⁄
;

422 
	}
}

423 
TimeMachöeEdô‹A˘i⁄
 
	$game°©e_timemachöó˘i⁄_¸óã_upd©e_game°©e
(
GameSèã
* 
ª∂a˚mít
, 
to_ª∂a˚
, 
LevñName
 
«me
)

425 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
;

426 
a˘i⁄
.a˘i⁄ = 
TM_UPDATE_GAMESTATE
;

427 
a˘i⁄
.
u
.
upd©e
.
ª∂a˚_°©e
 = 
ª∂a˚mít
;

428 
a˘i⁄
.
u
.
upd©e
.
ödex_to_ª∂a˚
 = 
to_ª∂a˚
;

429 
i
 = 0; i < 
GAME_LEVEL_NAME_MAX_SIZE
; i++)

431 
a˘i⁄
.
u
.
ª∂a˚
.
«me
[
i
] =Çame.name[i];

433  
a˘i⁄
;

434 
	}
}

435 
TimeMachöeEdô‹A˘i⁄
 
	$game°©e_timemachöó˘i⁄_¸óã_ch™ge_Àvñ_mode
(
èrgë_game°©e
, 
LevñMode
 
√xt_mode
)

437 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
;

438 
a˘i⁄
.a˘i⁄ = 
TM_CHANGE_LEVEL_MODE
;

439 
a˘i⁄
.
u
.
Àvñ
.
ödex_to_ª∂a˚
 = 
èrgë_game°©e
;

440 
a˘i⁄
.
u
.
Àvñ
.
ª∂a˚_vÆue
 = 
√xt_mode
;

441  
a˘i⁄
;

442 
	}
}

	@Fonts.h

1 #¥agm®
⁄˚


	@GameState.cpp

1 
	~"GameSèã.h
"

2 
	~"Mem‹y.h
"

3 
	~<io°ªam
>

4 
	~"M©h.h
"

7 
game°©e_Æloˇã_œyîs
(
GameSèã
* 
ªsu…
, 
Mem‹y
* 
mem‹y
, 
w
, 
h
);

10 
ölöe
 
I¡Paú
 
	$move_pos_wøµed_2d_up
(
I¡Paú
 
pos
, 
w
, 
h
)

12 
pos
.
y
 += 1;

13 
pos
.
y
 -’os.y >
h
) * h;

14  
pos
;

15 
	}
}

16 
ölöe
 
I¡Paú
 
	$move_pos_wøµed_2d_right
(
I¡Paú
 
pos
, 
w
, 
h
) {

17 
pos
.
x
 += 1;

18 
pos
.
x
 -’os.x >
w
) * w;

19  
pos
;

20 
	}
}

21 
ölöe
 
I¡Paú
 
	$move_pos_wøµed_2d_down
(
I¡Paú
 
pos
, 
w
, 
h
) {

22 
pos
.
y
 -= 1;

23 
pos
.
y
 +’os.y < 0Ë* 
h
;

24  
pos
;

25 
	}
}

26 
ölöe
 
I¡Paú
 
	$move_pos_wøµed_2d_À·
(
I¡Paú
 
pos
, 
w
, 
h
) {

27 
pos
.
x
 -= 1;

28 
pos
.
x
 +’os.x < 0Ë* 
w
;

29  
pos
;

30 
	}
}

31 
ölöe
 
I¡Paú
 
	$move_pos_wøµed_2d
(
I¡Paú
 
pos
, 
Dúe˘i⁄
 
dúe˘i⁄
, 
w
, 
h
)

33 
dúe˘i⁄
) {

34 
U
:

35 
pos
.
y
 += 1;

36 
pos
.
y
 -’os.y >
h
) * h;

37  
pos
;

38 
R
:

39 
pos
.
x
 += 1;

40 
pos
.
x
 -’os.x >
w
) * w;

41  
pos
;

42 
D
:

43 
pos
.
y
 -= 1;

44 
pos
.
y
 +’os.y < 0Ë* 
h
;

45  
pos
;

46 
L
:

47 
pos
.
x
 -= 1;

48 
pos
.
x
 +’os.x < 0Ë* 
w
;

49  
pos
;

51  
pos
;

52 
	}
}

54 
	gãm∂©e
 <
˛ass
 
	gT
>

55 
	$≠∂y_moves_to_œyî_SLOW
(
Mem‹y
* 
ãmp_mem‹y
, 
boﬁ
* 
is_movög
, 
T
* 
œyî
, 
w
, 
h
, 
Dúe˘i⁄
 
a˘i⁄
, T 
em±y_vÆ
)

58 
Àngth
 = 
w
 * 
h
;

59 
T
* 
√xt_œyî
 = (T*Ë
	`mem‹y_Æloc
(
ãmp_mem‹y
, (TË* 
Àngth
);

60 * 
shÆl_dñëe
 = (*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (Ë* 
Àngth
);

61 
z
 = 0; z < 
Àngth
; z++)

63 
shÆl_dñëe
[
z
] = 0;

65 
z
 = 0; z < 
Àngth
; z++)

67 
√xt_œyî
[
z
] = 
œyî
[z];

69 
z
 = 0; z < 
Àngth
; z++)

71 
I¡Paú
 
p
 = 
	`t2D
(
z
, 
w
, 
h
);

72 
I¡Paú
 
√xt
 = 
	`move_pos_wøµed_2d
(
p
, 
a˘i⁄
, 
w
, 
h
);

73 
√xt_1d
 = 
	`f2D
(
√xt
.
x
,Çext.
y
, 
w
, 
h
);

74 i‡(
is_movög
[
z
])

76 
√xt_œyî
[
√xt_1d
] = 
œyî
[
z
];

77 
shÆl_dñëe
[
z
]++;

78 
shÆl_dñëe
[
√xt_1d
]--;

82 
z
 = 0; z < 
Àngth
; z++)

84 i‡(
shÆl_dñëe
[
z
] > 0)

85 
√xt_œyî
[
z
] = 
em±y_vÆ
;

87 
z
 = 0; z < 
Àngth
; z++)

89 
œyî
[
z
] = 
√xt_œyî
[z];

91 
	}
}

92 
	$≠∂y_À·_moves_to_œyî
(
Mem‹y
* 
mem‹y
, 
boﬁ
* 
is_movög
, * 
œyî
, 
w
, 
h
)

94 
Àngth
 = 
w
 * 
h
;

95 
j
 = 0; j < 
h
; j++)

97 
föÆ_i
 = 
	`f2D
(
w
 - 1, 
j
, w, 
h
);

98 
°‹ed_vÆue
 = 
œyî
[
föÆ_i
];

100 
i
 = 0; i < 
w
 - 1; i++)

102 
pos
 = 
	`f2D
(
i
, 
j
, 
w
, 
h
);

103 
I¡Paú
 
√xt
 = 
	`move_pos_wøµed_2d_À·
(
	`m©h_öçaú_¸óã
(
i
, 
j
), 
w
, 
h
);

104 
√xt_1d
 = 
	`f2D
(
√xt
.
x
,Çext.
y
, 
w
, 
h
);

105 
œyî
[
√xt_1d
] = (œyî[
pos
] * 
is_movög
[pos]) + (layer[next_1d] * (1 - is_moving[pos]));

107 
I¡Paú
 
√xt_föÆ_2d
 = 
	`move_pos_wøµed_2d_À·
(
	`m©h_öçaú_¸óã
(
w
 - 1, 
j
), w, 
h
);

108 
√xt_föÆ_1d
 = 
	`f2D
(
√xt_föÆ_2d
.
x
,Çext_föÆ_2d.
y
, 
w
, 
h
);

109 
œyî
[
√xt_föÆ_1d
] = (
°‹ed_vÆue
 * 
is_movög
[
föÆ_i
]) + (layer[next_final_1d] * (1 - is_moving[final_i]));

111 
	}
}

112 
	$≠∂y_right_moves_to_œyî
(
Mem‹y
* 
mem‹y
, 
boﬁ
* 
is_movög
, * 
œyî
, 
w
, 
h
)

114 
Àngth
 = 
w
 * 
h
;

115 
z
 = 0;

116 
j
 = 0; j < 
h
; j++)

118 
föÆ_i
 = 
	`f2D
(0, 
j
, 
w
, 
h
);

119 
°‹ed_vÆue
 = 
œyî
[
föÆ_i
];

121 
i
 = 
w
 - 1; i >= 0; i--)

123 
pos
 = 
	`f2D
(
i
, 
j
, 
w
, 
h
);

124 
I¡Paú
 
√xt
 = 
	`move_pos_wøµed_2d_right
(
	`m©h_öçaú_¸óã
(
i
, 
j
), 
w
, 
h
);

125 
√xt_1d
 = 
	`f2D
(
√xt
.
x
,Çext.
y
, 
w
, 
h
);

126 
œyî
[
√xt_1d
] = (œyî[
pos
] * 
is_movög
[pos]) + (layer[next_1d] * (1 - is_moving[pos]));

129 
I¡Paú
 
√xt_föÆ_2d
 = 
	`move_pos_wøµed_2d_right
(
	`m©h_öçaú_¸óã
(0, 
j
), 
w
, 
h
);

130 
√xt_föÆ_1d
 = 
	`f2D
(
√xt_föÆ_2d
.
x
,Çext_föÆ_2d.
y
, 
w
, 
h
);

131 
œyî
[
√xt_föÆ_1d
] = (
°‹ed_vÆue
 * 
is_movög
[
föÆ_i
]) + (layer[next_final_1d] * (1 - is_moving[final_i]));

133 
	}
}

134 
	$≠∂y_up_moves_to_œyî
(
Mem‹y
* 
mem‹y
, 
boﬁ
* 
is_movög
, * 
œyî
, 
w
, 
h
)

136 
Àngth
 = 
w
 * 
h
;

137 
i
 = 0; i < 
w
; i++)

139 
föÆ_i
 = 
	`f2D
(
i
, 
h
 - 1, 
w
, h);

140 
°‹ed_vÆue
 = 
œyî
[
föÆ_i
];

142 
j
 = 1; j < 
h
; j++)

144 
pos
 = 
	`f2D
(
i
, 
j
, 
w
, 
h
);

145 
I¡Paú
 
√xt
 = 
	`move_pos_wøµed_2d_up
(
	`m©h_öçaú_¸óã
(
i
, 
j
), 
w
, 
h
);

146 
√xt_1d
 = 
	`f2D
(
√xt
.
x
,Çext.
y
, 
w
, 
h
);

147 
œyî
[
√xt_1d
] = (œyî[
pos
] * 
is_movög
[pos]) + (layer[next_1d] * (1 - is_moving[pos]));

150 
I¡Paú
 
√xt_föÆ_2d
 = 
	`move_pos_wøµed_2d_up
(
	`m©h_öçaú_¸óã
(
i
, 
h
 - 1), 
w
, h);

151 
√xt_föÆ_1d
 = 
	`f2D
(
√xt_föÆ_2d
.
x
,Çext_föÆ_2d.
y
, 
w
, 
h
);

152 
œyî
[
√xt_föÆ_1d
] = (
°‹ed_vÆue
 * 
is_movög
[
föÆ_i
]) + (layer[next_final_1d] * (1 - is_moving[final_i]));

154 
	}
}

155 
	$≠∂y_down_moves_to_œyî
(
Mem‹y
* 
mem‹y
, 
boﬁ
* 
is_movög
, * 
œyî
, 
w
, 
h
)

157 
Àngth
 = 
w
 * 
h
;

158 
i
 = 0; i < 
w
; i++)

160 
föÆ_i
 = 
	`f2D
(
i
, 
h
 - 1, 
w
, h);

161 
°‹ed_vÆue
 = 
œyî
[
föÆ_i
];

162 
j
 = 0; j < 
h
 - 1; j++)

164 
pos
 = 
	`f2D
(
i
, 
j
, 
w
, 
h
);

165 
I¡Paú
 
√xt
 = 
	`move_pos_wøµed_2d_down
(
	`m©h_öçaú_¸óã
(
i
, 
j
), 
w
, 
h
);

166 
√xt_1d
 = 
	`f2D
(
√xt
.
x
,Çext.
y
, 
w
, 
h
);

167 
œyî
[
√xt_1d
] = (œyî[
pos
] * 
is_movög
[pos]) + (layer[next_1d] * (1 - is_moving[pos]));

170 
I¡Paú
 
√xt_föÆ_2d
 = 
	`move_pos_wøµed_2d_down
(
	`m©h_öçaú_¸óã
(
i
, 
h
 - 1), 
w
, h);

171 
√xt_föÆ_1d
 = 
	`f2D
(
√xt_föÆ_2d
.
x
,Çext_föÆ_2d.
y
, 
w
, 
h
);

172 
œyî
[
√xt_föÆ_1d
] = (
°‹ed_vÆue
 * 
is_movög
[
föÆ_i
]) + (layer[next_final_1d] * (1 - is_moving[final_i]));

174 
	}
}

177 
I¡Paú
 
	$dúe˘i⁄_to_öçaú
(
Dúe˘i⁄
 
a˘i⁄
)

179 i‡(
a˘i⁄
 =
U
)

181  
	`m©h_öçaú_¸óã
(0, 1);

183 i‡(
a˘i⁄
 =
R
)

185  
	`m©h_öçaú_¸óã
(1, 0);

187 i‡(
a˘i⁄
 =
D
)

189  
	`m©h_öçaú_¸óã
(0, -1);

191 i‡(
a˘i⁄
 =
L
)

193  
	`m©h_öçaú_¸óã
(-1, 0);

195  
	`m©h_öçaú_¸óã
(0, 0);

196 
	}
}

197 
Dúe˘i⁄
 
	$a˘i⁄_to_dúe˘i⁄
(
A˘i⁄
 
a˘i⁄
)

199 i‡(
a˘i⁄
 =
A˘i⁄
::
A_UP
)

200  
Dúe˘i⁄
::
U
;

201 i‡(
a˘i⁄
 =
A˘i⁄
::
A_RIGHT
)

202  
Dúe˘i⁄
::
R
;

203 i‡(
a˘i⁄
 =
A˘i⁄
::
A_DOWN
)

204  
Dúe˘i⁄
::
D
;

205 i‡(
a˘i⁄
 =
A˘i⁄
::
A_LEFT
)

206  
Dúe˘i⁄
::
L
;

207  
Dúe˘i⁄
::
NO_DIRECTION
;

208 
	}
}

210 
	$game°©e_timemachöe_ª£t
(
Game°©eTimeMachöe
* 
timeMachöe
, 
Mem‹y
* 
sc›e_mem‹y
)

212 
√xt_pos
 = 
timeMachöe
->
num_game°©es_°‹ed
;

213 
GameSèã
* 
√xt
 = &
timeMachöe
->
°©e_¨øy
[
√xt_pos
];

214 
GameSèã
* 
ﬁd
 = &
timeMachöe
->
°©e_¨øy
[0];

215 
	`game°©e_˛⁄e_to_unôülized
(
ﬁd
, 
√xt
, 
sc›e_mem‹y
);

216 
timeMachöe
->
num_game°©es_°‹ed
++;

217 
	}
}

218 
	$≠∂y_mîge_moves
(
Põ˚D©a
* 
põ˚_d©a
, 
boﬁ
* 
is_movög
, * 
œyî
, 
Dúe˘i⁄
 
d
, 
w
, 
h
, 
GameSèãAnim©i⁄
* 
™im©i⁄
)

220 
boﬁ
 
d⁄e
 = 
Ál£
;

221 !
d⁄e
)

223 
d⁄e
 = 
åue
;

224 
Àngth
 = 
w
 * 
h
;

225 
z
 = 0;

226 
i
 = 0; i < 
w
; i++)

227 
j
 = 0; j < 
h
; j++, 
z
++)

229 i‡(
is_movög
[
z
])

231 
I¡Paú
 
√xt
 = 
	`move_pos_wøµed_2d
(
	`m©h_öçaú_¸óã
(
i
, 
j
), 
d
, 
w
, 
h
);

232 
√xt_1d
 = 
	`f2D
(
√xt
.
x
,Çext.
y
, 
w
, 
h
);

233 
boﬁ
 
we_¨e_mîge
 = 
põ˚_d©a
[
z
].
powîs
[
CP_MERGE
] ||Öõ˚_d©a[
√xt_1d
].powers[CP_MERGE];

234 
boﬁ
 
bŸh_¸©es
 = 
œyî
[
√xt_1d
] =
P_CRATE
 &&Üayî[
z
] == P_CRATE;

235 
boﬁ
 
√xt_is_blocked
 = (
œyî
[
√xt_1d
] !
LN_FLOOR
Ë&& !
is_movög
[next_1d];

236 i‡(
√xt_is_blocked
)

238 i‡(
bŸh_¸©es
 && 
we_¨e_mîge
)

241 
põ˚_d©a
[
√xt_1d
].
powîs
[
CP_PUSH
] =Öõ˚_d©a[√xt_1d].powîs[CP_PUSH] ||Öõ˚_d©a[
z
].powers[CP_PUSH];

242 
põ˚_d©a
[
√xt_1d
].
powîs
[
CP_PULL
] =Öõ˚_d©a[√xt_1d].powîs[CP_PULL] ||Öõ˚_d©a[
z
].powers[CP_PULL];

243 
põ˚_d©a
[
√xt_1d
].
powîs
[
CP_MERGE
] =Öõ˚_d©a[√xt_1d].powîs[CP_MERGE] ||Öõ˚_d©a[
z
].powers[CP_MERGE];

244 
põ˚_d©a
[
√xt_1d
].
powîs
[
CP_PARALLEL
] =Öõ˚_d©a[√xt_1d].powîs[CP_PARALLEL] ||Öõ˚_d©a[
z
].powers[CP_PARALLEL];

245 
œyî
[
z
] = 0;

246 
i
 = 0; i < 
CP_COUNT
;i++)

247 
põ˚_d©a
[
z
].
powîs
[
i
] = 
Ál£
;

248 
is_movög
[
z
] = 
Ál£
;

251 
™im©i⁄
->
symbﬁ_°¨t
.
íd_powîs
[
z
] = 
põ˚_d©a
[
√xt_1d
];

252 
™im©i⁄
->
symbﬁ_°¨t
.
íd_powîs
[
√xt_1d
] = 
põ˚_d©a
[next_1d];

258 
	}
}

259 
	$ˇn˚l_moves_by_rigid
(
RigidD©a
* 
rigids
, 
boﬁ
* 
is_movög
, 
rigid_to_ˇn˚l
, 
Àn
)

261 
k
 = 0; k < 
Àn
; k++)

262 i‡(
rigids
->
grid
[
k
] =
rigid_to_ˇn˚l
)

263 
is_movög
[
k
] = 
Ál£
;

264 
z
 = 0; z < 
rigids
->
num_löks
; z++)

265 i‡(
rigids
->
löks
[
z
].
x
 =
rigid_to_ˇn˚l
)

266 
	`ˇn˚l_moves_by_rigid
(
rigids
, 
is_movög
,Ñigids->
löks
[
z
].
y
, 
Àn
);

267 
	}
}

268 
	$ˇn˚l_blocked_n⁄mîge_moves
(
RigidD©a
* 
rigids
, 
boﬁ
* 
is_movög
, * 
œyî
, 
Põ˚D©a
* 
põ˚_d©a
, 
Dúe˘i⁄
 
d
, 
w
, 
h
)

270 
boﬁ
 
lo›
 = 
Ál£
;

271 
boﬁ
 
d⁄e
 = 
Ál£
;

272 !
d⁄e
)

274 
d⁄e
 = 
åue
;

275 
Àngth
 = 
w
 * 
h
;

276 
z
 = 0;

277 
i
 = 0; i < 
w
; i++)

278 
j
 = 0; j < 
h
; j++, 
z
++)

280 i‡(
is_movög
[
z
])

282 
I¡Paú
 
√xt
 = 
	`move_pos_wøµed_2d
(
	`m©h_öçaú_¸óã
(
i
, 
j
), 
d
, 
w
, 
h
);

283 
√xt_1d
 = 
	`f2D
(
√xt
.
x
,Çext.
y
, 
w
, 
h
);

284 
boﬁ
 
we_¨e_mîge
 = 
põ˚_d©a
[
z
].
powîs
[
CP_MERGE
] ||Öõ˚_d©a[
√xt_1d
].powers[CP_MERGE];

285 
boﬁ
 
bŸh_¸©es
 = 
œyî
[
√xt_1d
] =
P_CRATE
 &&Üayî[
z
] == P_CRATE;

286 
boﬁ
 
√xt_is_blocked
 = (
œyî
[
√xt_1d
] !
LN_FLOOR
Ë&& !
is_movög
[next_1d];

287 i‡(
√xt_is_blocked
)

289 i‡(
bŸh_¸©es
 && 
we_¨e_mîge
)

295 
is_movög
[
z
] = 
Ál£
;

296 
d⁄e
 = 
Ál£
;

297 i‡(
rigids
->
grid
[
z
] != 0)

299 
	`ˇn˚l_moves_by_rigid
(
rigids
,
is_movög
,rigids->
grid
[
z
],
w
*
h
);

300 
lo›
 = 
åue
;

307 i‡(
lo›
)

308 
	`ˇn˚l_blocked_n⁄mîge_moves
(
rigids
, 
is_movög
, 
œyî
, 
põ˚_d©a
, 
d
, 
w
, 
h
);

309 
	}
}

310 
	$ˇn˚l_blocked_moves
(
boﬁ
* 
is_movög
, * 
œyî
, 
Dúe˘i⁄
 
d
, 
w
, 
h
)

312 
boﬁ
 
d⁄e
 = 
Ál£
;

313 !
d⁄e
)

315 
d⁄e
 = 
åue
;

316 
Àngth
 = 
w
 * 
h
;

317 
z
 = 0;

318 
i
 = 0; i < 
w
; i++)

319 
j
 = 0; j < 
h
; j++, 
z
++)

321 i‡(
is_movög
[
z
])

323 
I¡Paú
 
√xt
 = 
	`move_pos_wøµed_2d
(
	`m©h_öçaú_¸óã
(
i
, 
j
), 
d
, 
w
, 
h
);

324 
√xt_1d
 = 
	`f2D
(
√xt
.
x
,Çext.
y
, 
w
, 
h
);

325 
boﬁ
 
√xt_is_blocked
 = (
œyî
[
√xt_1d
] !
LN_FLOOR
Ë&& !
is_movög
[next_1d];

326 i‡(
√xt_is_blocked
)

328 
is_movög
[
z
] = 
Ál£
;

329 
d⁄e
 = 
Ál£
;

335 
	}
}

336 
Game°©eTimeMachöe
* 
	$game°©e_timemachöe_¸óã
(
GameSèã
* 
°¨t_°©e
, 
Mem‹y
* 
mem‹y
, 
max_num_game°©es
)

338 
Game°©eTimeMachöe
* 
ªsu…
 = (Game°©eTimeMachöe*Ë
	`mem‹y_Æloc
(
mem‹y
, (GamestateTimeMachine));

339 
ªsu…
->
°¨t_°©e
 = 
	`game°©e_˛⁄e
(°¨t_°©e, 
mem‹y
);

340 
ªsu…
->
°©e_¨øy
 = (
GameSèã
*)
	`mem‹y_Æloc
(
mem‹y
, (GameSèãË* 
max_num_game°©es
);

342 
	`game°©e_˛⁄e_to_unôülized
(
ªsu…
->
°¨t_°©e
, &‘esu…->
°©e_¨øy
[0]), 
mem‹y
);

344 
ªsu…
->
num_game°©es_°‹ed
 = 1;

345 
ªsu…
->
max_game°©es_°‹abÀ
 = 
max_num_game°©es
;

346  
ªsu…
;

347 
	}
}

348 * 
	$game°©e_timemachöe_undo
(
Game°©eTimeMachöe
* 
timeMachöe
)

351 i‡(
timeMachöe
->
num_game°©es_°‹ed
 > 1)

353 
timeMachöe
->
num_game°©es_°‹ed
--;

355  &
timeMachöe
->
°©e_¨øy
[timeMachöe->
num_game°©es_°‹ed
];

357  
NULL
;

358 
	}
}

359 
GameSèã
* 
	$game°©e_timemachöe_gë_œã°_game°©e
(
Game°©eTimeMachöe
* 
timeMachöe
)

361  &
timeMachöe
->
°©e_¨øy
[timeMachöe->
num_game°©es_°‹ed
 - 1];

362 
	}
}

365 
GameSèã
* 
	$game°©e_¸óã
(
Mem‹y
* 
mem‹y
, 
w
, 
h
)

367 
size
 = (
GameSèã
);

368 
GameSèã
* 
ªsu…
 = (GameSèã*Ë
	`mem‹y_Æloc
(
mem‹y
,
size
);

369 
	`game°©e_Æloˇã_œyîs
(
ªsu…
, 
mem‹y
, 
w
, 
h
);

370  
ªsu…
;

371 
	}
}

372 
GameSèã
* 
	$game°©e_˛⁄e
(
GameSèã
* 
°©e
, 
Mem‹y
* 
mem‹y
)

374 
GameSèã
* 
˛⁄e_to
 = 
	`game°©e_¸óã
(
mem‹y
, 
°©e
->
w
, sèã->
h
);

375 
	`game°©e_˛⁄e_to
(
°©e
, 
˛⁄e_to
);

376  
˛⁄e_to
;

377 
	}
}

378 
GameSèã
* 
	$game°©e_mîge_wôh_Æloˇã
(
GameSèã
* 
fú°
, GameSèã* 
£c⁄d
, 
I¡Paú
 
comböed_size
, 
Mem‹y
* 
ouçut_mem‹y
, I¡Paú 
À·_mîge_off£t
, I¡Paú 
right_mîge_off£t
)

380 
GameSèã
* 
ouçut_°©e
 = 
	`game°©e_¸óã
(
ouçut_mem‹y
, 
comböed_size
.
x
, comböed_size.
y
);

381 
	`game°©e_mîge
(
fú°
, 
£c⁄d
, 
ouçut_°©e
, 
À·_mîge_off£t
, 
right_mîge_off£t
);

382  
ouçut_°©e
;

383 
	}
}

384 
GameSèã
* 
	$game°©e_ªsize_wôh_Æloˇã
(
GameSèã
* 
öput_°©e
, 
Mem‹y
* 
ouçut_mem‹y
, 
ouçut_w
, 
ouçut_h
, 
I¡Paú
 
di•œ˚mít_‰om_öput_to_ouçut
)

386 
GameSèã
* 
ouçut_°©e
 = 
	`game°©e_¸óã
(
ouçut_mem‹y
, 
ouçut_w
, 
ouçut_h
);

387 
	`game°©e_ªsize
(
öput_°©e
, 
ouçut_°©e
, 
di•œ˚mít_‰om_öput_to_ouçut
);

388  
ouçut_°©e
;

389 
	}
}

390 
GameA˘i⁄Jou∫Æ
* 
	$game°©e_timemachöe_èke_a˘i⁄
(
Game°©eTimeMachöe
* 
timeMachöe
, 
Dúe˘i⁄
 
a˘i⁄
, 
Mem‹y
* 
sc›e_mem‹y
, Mem‹y* 
ãmp_mem‹y
)

392 
√xt_pos
 = 
timeMachöe
->
num_game°©es_°‹ed
;

393 
ﬁd_pos
 = 
√xt_pos
 - 1;

394 
GameSèã
* 
ﬁd
 = &
timeMachöe
->
°©e_¨øy
[
ﬁd_pos
];

395 
GameSèã
* 
√xt
 = &
timeMachöe
->
°©e_¨øy
[
√xt_pos
];

396 
	`game°©e_˛⁄e_to_unôülized
(
ﬁd
, 
√xt
, 
sc›e_mem‹y
);

397 
GameA˘i⁄Jou∫Æ
* 
ªsu…
 = 
	`game°©e_a˘i⁄
(
√xt
, 
a˘i⁄
, 
ãmp_mem‹y
);

398 
timeMachöe
->
num_game°©es_°‹ed
++;

399  
ªsu…
;

400 
	}
}

401 
	$game°©e_mîge
(
GameSèã
* 
À·
, GameSèã* 
right
, GameSèã* 
ouçut
, 
I¡Paú
 
À·_mîge_off£t
, I¡Paú 
right_mîge_off£t
)

403 
w_f
 = 
À·
->
w
;

404 
h_f
 = 
À·
->
h
;

405 
w_s
 = 
right
->
w
;

406 
h_s
 = 
right
->
h
;

407 
w_out
 = 
ouçut
->
w
;

408 
h_out
 = 
ouçut
->
h
;

412 
i
 = 0; i < 
w_f
; i++)

413 
j
 = 0; j < 
h_f
; j++)

415 
ödex_ö
 = 
	`f2D
(
i
, 
j
, 
w_f
, 
h_f
);

416 
ödex_out
 = 
	`f2D
(
i
 + 
À·_mîge_off£t
.
x
, 
j
 +Üe·_mîge_off£t.
y
, 
w_out
, 
h_out
);

417 
ouçut
->
Êo‹
[
ödex_out
] = 
À·
->Êo‹[
ödex_ö
];

419 
i
 = 0; i < 
w_s
; i++)

420 
j
 = 0; j < 
h_s
; j++)

422 
ödex_ö
 = 
	`f2D
(
i
, 
j
, 
w_s
, 
h_s
);

423 
ödex_out
 = 
	`f2D
(
i
 + 
right_mîge_off£t
.
x
, 
j
 + 
À·_mîge_off£t
.
y
, 
w_out
, 
h_out
);

424 
ouçut
->
Êo‹
[
ödex_out
] = 
À·
->Êo‹[
ödex_ö
];

429 
i
 = 0; i < 
w_f
; i++)

430 
j
 = 0; j < 
h_f
; j++)

432 
ödex_ö
 = 
	`f2D
(
i
, 
j
, 
w_f
, 
h_f
);

433 
ödex_out
 = 
	`f2D
(
i
 + 
À·_mîge_off£t
.
x
, 
j
 +Üe·_mîge_off£t.
y
, 
w_out
, 
h_out
);

434 
ouçut
->
põ˚
[
ödex_out
] = 
À·
->põ˚[
ödex_ö
];

436 
i
 = 0; i < 
w_s
; i++)

437 
j
 = 0; j < 
h_s
; j++)

439 
ödex_ö
 = 
	`f2D
(
i
, 
j
, 
w_s
, 
h_s
);

440 
ödex_out
 = 
	`f2D
(
i
 + 
right_mîge_off£t
.
x
, 
j
 + 
À·_mîge_off£t
.
y
, 
w_out
, 
h_out
);

441 
ouçut
->
põ˚
[
ödex_out
] = 
À·
->põ˚[
ödex_ö
];

446 
i
 = 0; i < 
w_f
; i++)

447 
j
 = 0; j < 
h_f
; j++)

449 
ödex_ö
 = 
	`f2D
(
i
, 
j
, 
w_f
, 
h_f
);

450 
ödex_out
 = 
	`f2D
(
i
 + 
À·_mîge_off£t
.
x
, 
j
 +Üe·_mîge_off£t.
y
, 
w_out
, 
h_out
);

451 
ouçut
->
Êo‹_d©a
[
ödex_out
] = 
À·
->Êo‹_d©a[
ödex_ö
];

453 
i
 = 0; i < 
w_s
; i++)

454 
j
 = 0; j < 
h_s
; j++)

456 
ödex_ö
 = 
	`f2D
(
i
, 
j
, 
w_s
, 
h_s
);

457 
ödex_out
 = 
	`f2D
(
i
 + 
right_mîge_off£t
.
x
, 
j
 + 
À·_mîge_off£t
.
y
, 
w_out
, 
h_out
);

458 
ouçut
->
Êo‹_d©a
[
ödex_out
] = 
À·
->Êo‹_d©a[
ödex_ö
];

463 
i
 = 0; i < 
w_f
; i++)

464 
j
 = 0; j < 
h_f
; j++)

466 
ödex_ö
 = 
	`f2D
(
i
, 
j
, 
w_f
, 
h_f
);

467 
ödex_out
 = 
	`f2D
(
i
 + 
À·_mîge_off£t
.
x
, 
j
 +Üe·_mîge_off£t.
y
, 
w_out
, 
h_out
);

468 
ouçut
->
põ˚_d©a
[
ödex_out
] = 
À·
->põ˚_d©a[
ödex_ö
];

470 
i
 = 0; i < 
w_s
; i++)

471 
j
 = 0; j < 
h_s
; j++)

473 
ödex_ö
 = 
	`f2D
(
i
, 
j
, 
w_s
, 
h_s
);

474 
ödex_out
 = 
	`f2D
(
i
 + 
right_mîge_off£t
.
x
, 
j
 + 
À·_mîge_off£t
.
y
, 
w_out
, 
h_out
);

475 
ouçut
->
põ˚_d©a
[
ödex_out
] = 
À·
->põ˚_d©a[
ödex_ö
];

479 
	}
}

480 
GameSèã
* 
	$game°©e_add_row
(
GameSèã
* 
öput
, 
Mem‹y
* 
sc›e_mem‹y
, 
èrgë_x
, 
èrgë_y
)

482 
w_ﬁd
 = 
öput
->
w
;

483 
h_ﬁd
 = 
öput
->
h
;

484 
w_√xt
 = 
w_ﬁd
 + 1;

485 
h_√xt
 = 
h_ﬁd
;

486 
GameSèã
* 
ouçut
 = 
	`game°©e_¸óã
(
sc›e_mem‹y
, 
w_√xt
, 
h_√xt
);

487 
i
 = 0; i < 
w_ﬁd
; i++)

488 
j
 = 0; j < 
h_ﬁd
; j++)

490 
out_x
 = 
i
 + (ò>
èrgë_x
);

491 
out_y
 = 
j
;

492 
ö_ödex
 = 
	`f2D
(
i
, 
j
, 
w_ﬁd
, 
h_ﬁd
);

493 
out_ödex
 = 
	`f2D
(
out_x
, 
out_y
, 
w_√xt
, 
h_√xt
);

495 
ouçut
->
Êo‹
[
out_ödex
] = 
öput
->Êo‹[
ö_ödex
];

496 
ouçut
->
põ˚
[
out_ödex
] = 
öput
->põ˚[
ö_ödex
];

497 
ouçut
->
Êo‹_d©a
[
out_ödex
] = 
öput
->Êo‹_d©a[
ö_ödex
];

498 
ouçut
->
põ˚_d©a
[
out_ödex
] = 
öput
->põ˚_d©a[
ö_ödex
];

502  
ouçut
;

503 
	}
}

504 
GameSèã
* 
	$game°©e_add_cﬁumn
(
GameSèã
* 
öput
, 
Mem‹y
* 
sc›e_mem‹y
, 
èrgë_x
, 
èrgë_y
)

506 
w_ﬁd
 = 
öput
->
w
;

507 
h_ﬁd
 = 
öput
->
h
;

508 
w_√xt
 = 
w_ﬁd
;

509 
h_√xt
 = 
h_ﬁd
 + 1;

510 
GameSèã
* 
ouçut
 = 
	`game°©e_¸óã
(
sc›e_mem‹y
, 
w_√xt
, 
h_√xt
);

511 
i
 = 0; i < 
w_ﬁd
; i++)

512 
j
 = 0; j < 
h_ﬁd
; j++)

514 
out_x
 = 
i
;

515 
out_y
 = 
j
 + (j >
èrgë_y
);

516 
ö_ödex
 = 
	`f2D
(
i
, 
j
, 
w_ﬁd
, 
h_ﬁd
);

517 
out_ödex
 = 
	`f2D
(
out_x
, 
out_y
, 
w_√xt
, 
h_√xt
);

519 
ouçut
->
Êo‹
[
out_ödex
] = 
öput
->Êo‹[
ö_ödex
];

520 
ouçut
->
põ˚
[
out_ödex
] = 
öput
->põ˚[
ö_ödex
];

521 
ouçut
->
Êo‹_d©a
[
out_ödex
] = 
öput
->Êo‹_d©a[
ö_ödex
];

522 
ouçut
->
põ˚_d©a
[
out_ödex
] = 
öput
->põ˚_d©a[
ö_ödex
];

525  
ouçut
;

526 
	}
}

527 
GameSèã
* 
	$game°©e_suºound_wôh_wÆls
(
GameSèã
* 
öput
, 
Mem‹y
* 
sc›e_mem‹y
)

529 
ﬁd_w
 = 
öput
->
w
;

530 
ﬁd_h
 = 
öput
->
h
;

531 
√xt_w
 = 
ﬁd_w
 + 2;

532 
√xt_h
 = 
ﬁd_h
 + 2;

533 
GameSèã
* 
ªsu…
 = 
	`game°©e_¸óã
(
sc›e_mem‹y
, 
√xt_w
, 
√xt_h
);

534 
i
 = 0; i < 
√xt_w
; i++)

535 
j
 = 0; j < 
√xt_h
; j++)

536 i‡(
i
 =0 || 
j
 =0 || i =
√xt_w
 - 1 || j =
√xt_h
 - 1)

538 
z
 = 
	`f2D
(
i
, 
j
, 
√xt_w
,
√xt_h
);

539 
ªsu…
->
põ˚
[
z
] = 
P_WALL
;

542 
i
 = 0; i < 
ﬁd_w
; i++)

543 
j
 = 0; j < 
ﬁd_h
; j++)

545 
ö_ödex
 = 
	`f2D
(
i
, 
j
, 
ﬁd_w
, 
ﬁd_h
);

546 
out_ödex
 = 
	`f2D
(
i
 + 1, 
j
 + 1, 
√xt_w
, 
√xt_h
);

547 
ªsu…
->
Êo‹
[
out_ödex
] = 
öput
->Êo‹[
ö_ödex
];

548 
ªsu…
->
põ˚
[
out_ödex
] = 
öput
->põ˚[
ö_ödex
];

549 
ªsu…
->
Êo‹_d©a
[
out_ödex
] = 
öput
->Êo‹_d©a[
ö_ödex
];

550 
ªsu…
->
põ˚_d©a
[
out_ödex
] = 
öput
->põ˚_d©a[
ö_ödex
];

553  
ªsu…
;

554 
	}
}

556 
	$game°©e_Æloˇã_œyîs
(
GameSèã
* 
ªsu…
, 
Mem‹y
* 
mem‹y
, 
w
, 
h
)

558 
ªsu…
->
w
 = w;

559 
ªsu…
->
h
 = h;

560 
ªsu…
->
põ˚
 = (*)
	`mem‹y_Æloc
(
mem‹y
, (Ë* 
w
 * 
h
);

561 
ªsu…
->
Êo‹
 = (*)
	`mem‹y_Æloc
(
mem‹y
, (Ë* 
w
 * 
h
);

562 
ªsu…
->
põ˚_d©a
 = (
Põ˚D©a
*)
	`mem‹y_Æloc
(
mem‹y
, (Põ˚D©aË* 
w
 * 
h
);

563 
ªsu…
->
Êo‹_d©a
 = (
Flo‹D©a
*)
	`mem‹y_Æloc
(
mem‹y
, (Flo‹D©aË* 
w
 * 
h
);

564 
i
 = 0; i < 
w
 * 
h
; i++)

566 
Flo‹
 
f
 = (Floor)0;

567 
ªsu…
->
Êo‹
[
i
] = 
f
;

569 
i
 = 0; i < 
w
 * 
h
; i++)

571 
Põ˚
 
p
 = (Piece)0;

572 
ªsu…
->
põ˚
[
i
] = 
p
;

574 
i
 = 0; i < 
w
 * 
h
; i++)

576 
ªsu…
->
Êo‹_d©a
[
i
] = 
	`game°©e_Êo‹d©a_make
();

578 
i
 = 0; i < 
w
 * 
h
; i++)

580 
ªsu…
->
põ˚_d©a
[
i
] = 
	`game°©e_põ˚d©a_make
();

583 
	}
}

584 
boﬁ
 
	$game°©e_is_ö_wö_c⁄dôi⁄
(
GameSèã
* 
°©e
)

586 
Àn
 = 
°©e
->
w
 * sèã->
h
;

587 
i
 = 0; i < 
Àn
; i++)

589 i‡(
°©e
->
Êo‹
[
i
] =
F_EXIT
 || sèã->Êo‹[i] =
F_START
 || sèã->Êo‹[i] =
F_STAIRCASE_LEVELSTART
)

590 if(!
	`is_∂ayî
(
°©e
->
põ˚
[
i
]))

592  
Ál£
;

595 
i
 = 0; i < 
Àn
; i++)

597 i‡(
°©e
->
Êo‹
[
i
] =
F_TARGET
 && sèã->
põ˚
[i] !
P_CRATE
)

598  
Ál£
;

600  
åue
;

601 
	}
}

603 
	$maybe_föd_exô_‹_ªtu∫_√g1
(
GameSèã
* 
°©e
)

605 
Àn
 = 
°©e
->
w
 * sèã->
h
;

606 
i
 = 0; i < 
Àn
; i++)

608 i‡(
°©e
->
Êo‹
[
i
] =
Flo‹
::
F_EXIT
)

610  
i
;

614 
i
 = 0; i < 
Àn
; i++)

616 i‡(
°©e
->
Êo‹
[
i
] =
Flo‹
::
F_START
)

618  
i
;

622 
i
 = 0; i < 
Àn
; i++)

624 i‡(
°©e
->
Êo‹
[
i
] =
Flo‹
::
F_STAIRCASE_LEVELSTART
)

626  
i
;

631 
	}
}

633 
	$game°©e_maybe_föd_∂ayî
(
GameSèã
* 
°©e
)

635 
i
 = 0; i < 
°©e
->
w
 * sèã->
h
; i++)

636 i‡(
°©e
->
põ˚
[
i
] =
Põ˚
::
P_PLAYER
)

637  
i
;

639 
	}
}

640 
boﬁ
 
	$is_Àvñ_°¨t
(
vÆ
)

642  
vÆ
 =
F_START
 || vÆ =
F_STAIRCASE_LEVELSTART
;

643 
	}
}

644 
boﬁ
 
	$is_°aúˇ£
(
vÆ
)

646  
vÆ
 =
F_STAIRCASE
 || vÆ =
F_STAIRCASE_LEVELSTART
 || vÆ =
F_STAIRCASE_SOLVED
;

647 
	}
}

648 
boﬁ
 
	$is_∂ayî
(
vÆ
)

650  
vÆ
 =
P_PLAYER
;

651 
	}
}

652 
boﬁ
 
	$is_¸©e
(
vÆ
)

654  
vÆ
 =
P_CRATE
;

655 
	}
}

656 
boﬁ
 
	$is_n‹mÆ_¸©e
(
Põ˚D©a
 
vÆ
)

658  
vÆ
.
powîs
[
CP_PUSH
];

659 
	}
}

660 
boﬁ
 
	$is_puŒ_¸©e
(
Põ˚D©a
 
vÆ
)

662  
vÆ
.
powîs
[
CP_PULL
];

663 
	}
}

664 
	$game°©e_ªsize
(
GameSèã
* 
öput_°©e
, GameSèã* 
ouçut_°©e
, 
I¡Paú
 
di•œ˚mít_‰om_öput_to_ouçut
)

666 
w_ö
 = 
öput_°©e
->
w
;

667 
h_ö
 = 
öput_°©e
->
h
;

668 
w_out
 = 
ouçut_°©e
->
w
;

669 
h_out
 = 
ouçut_°©e
->
h
;

670 
i
 = 0; i < 
w_ö
;i++)

671 
j
 = 0; j < 
h_ö
; j++)

673 
out_x
 = 
i
 + 
di•œ˚mít_‰om_öput_to_ouçut
.
x
;

674 
out_y
 = 
j
 + 
di•œ˚mít_‰om_öput_to_ouçut
.
y
;

675 i‡(
out_x
 >0 && out_x < 
w_out
 && 
out_y
 >0 && out_y < 
h_out
)

677 
ö_ödex
 = 
	`f2D
(
i
, 
j
, 
w_ö
, 
h_ö
);

678 
out_ödex
 = 
	`f2D
(
out_x
, 
out_y
, 
w_out
, 
h_out
);

680 
ouçut_°©e
->
Êo‹
[
out_ödex
] = 
öput_°©e
->Êo‹[
ö_ödex
];

681 
ouçut_°©e
->
põ˚
[
out_ödex
] = 
öput_°©e
->põ˚[
ö_ödex
];

682 
ouçut_°©e
->
Êo‹_d©a
[
out_ödex
] = 
öput_°©e
->Êo‹_d©a[
ö_ödex
];

683 
ouçut_°©e
->
põ˚_d©a
[
out_ödex
] = 
öput_°©e
->põ˚_d©a[
ö_ödex
];

688 
	}
}

689 
	$game°©e_˛⁄e_to
(
GameSèã
* 
öput_°©e
, GameSèã* 
ouçut_°©e
)

691 
w
 = 
öput_°©e
->w;

692 
h
 = 
öput_°©e
->h;

693 i‡(
ouçut_°©e
->
w
 !w || ouçut_°©e->
h
 != h)

695 
	`¸ash_îr
("You fool! YouÅriedÅo use gamestate_clone_to onán input_stateÅhat didn't haveÅhe correctámount of memory. This would beá memoryÜeak. It'sÇowá crash. Enjoy.");

697 
ouçut_°©e
->
w
 = w;

698 
ouçut_°©e
->
h
 = h;

699 
i
 = 0; i < 
w
;i++)

700 
j
 = 0; j < 
h
; j++)

703 
ödex
 = 
	`f2D
(
i
, 
j
, 
w
, 
h
);

704 
ouçut_°©e
->
Êo‹
[
ödex
] = 
öput_°©e
->floor[index];

705 
ouçut_°©e
->
põ˚
[
ödex
] = 
öput_°©e
->piece[index];

706 
ouçut_°©e
->
Êo‹_d©a
[
ödex
] = 
öput_°©e
->floor_data[index];

707 
ouçut_°©e
->
põ˚_d©a
[
ödex
] = 
öput_°©e
->piece_data[index];

711 
	}
}

712 
	$game°©e_˛⁄e_to_unôülized
(
GameSèã
* 
öput_°©e
, GameSèã* 
ouçut_°©e
, 
Mem‹y
* 
mem‹y
)

714 
w
 = 
öput_°©e
->w;

715 
h
 = 
öput_°©e
->h;

716 
	`game°©e_Æloˇã_œyîs
(
ouçut_°©e
, 
mem‹y
, 
w
, 
h
);

717 
	`game°©e_˛⁄e_to
(
öput_°©e
, 
ouçut_°©e
);

718 
	}
}

721 
boﬁ
 
	$game°©e_≠∂y_brush
(
GameSèã
* 
°©e
, 
Game°©eBrush
 
brush
, 
x
, 
y
)

723 
boﬁ
 
ac˚±
 = 
Ál£
;

724 i‡(
brush
.
≠∂yFlo‹
)

726 
w
 = 
°©e
->w;

727 
h
 = 
°©e
->h;

728 
èrgë
 = 
	`f2D
(
x
, 
y
, 
w
,
h
);

729 i‡(
°©e
->
Êo‹
[
èrgë
] !
brush
.floor)

731 
°©e
->
Êo‹
[
èrgë
] = 
brush
.floor;

732 
ac˚±
 = 
åue
;

736 i‡(
brush
.
≠∂yPõ˚
)

738 
w
 = 
°©e
->w;

739 
h
 = 
°©e
->h;

740 
èrgë
 = 
	`f2D
(
x
, 
y
, 
w
, 
h
);

741 i‡(
°©e
->
põ˚
[
èrgë
] !
brush
.piece)

743 
°©e
->
põ˚
[
èrgë
] = 
brush
.piece;

744 
ac˚±
 = 
åue
;

747 i‡(
brush
.
≠∂yCøãPowî
)

749 
w
 = 
°©e
->w;

750 
h
 = 
°©e
->h;

751 
èrgë
 = 
	`f2D
(
x
, 
y
, 
w
, 
h
);

752 
i
 = 0; i < 
CP_COUNT
; i++)

753 
°©e
->
põ˚_d©a
[
èrgë
].
powîs
[
i
] = 
brush
.piece_data.powers[i];

755 i‡(
brush
.
≠∂yFlo‹Powî
)

757 
w
 = 
°©e
->w;

758 
h
 = 
°©e
->h;

759 
èrgë
 = 
	`f2D
(
x
, 
y
, 
w
,
h
);

761 
°©e
->
Êo‹_d©a
[
èrgë
] = 
brush
.floor_data;

764  
ac˚±
;

765 
	}
}

766 
Game°©eBrush
 
	$game°©e_brush_¸óã
(
boﬁ
 
≠∂yFlo‹
, 
Flo‹
 
Êo‹
, boﬁ 
≠∂yPõ˚
, 
Põ˚
 
põ˚
, boﬁ 
≠∂yPõ˚D©a
, 
Põ˚D©a
 
põ˚D©a
,boﬁ 
≠∂yFlo‹D©a
, 
Flo‹D©a
 
Êo‹D©a
)

768 
Game°©eBrush
 
ªsu…
;

769 
ªsu…
.
≠∂yFlo‹
 =ápplyFloor;

770 
ªsu…
.
Êo‹
 = floor;

771 
ªsu…
.
≠∂yPõ˚
 =ápplyPiece;

772 
ªsu…
.
põ˚
 =Öiece;

773 
ªsu…
.
≠∂yCøãPowî
 = 
≠∂yPõ˚D©a
;

774 
ªsu…
.
põ˚_d©a
 = 
põ˚D©a
;

775 
ªsu…
.
≠∂yFlo‹Powî
 = 
≠∂yFlo‹D©a
;

776 
ªsu…
.
Êo‹_d©a
 = 
Êo‹D©a
;

777  
ªsu…
;

778 
	}
}

782 
	gãxtuªAs£ts
::
SYMBOLS
 
	$põ˚d©a_to_symbﬁ
(
CøãPowî
 
vÆ
)

784 i‡(
vÆ
 =
CøãPowî
::
CP_PUSH
)

785  
ãxtuªAs£ts
::
SYMBOLS
::
Cú˛e
;

786 i‡(
vÆ
 =
CøãPowî
::
CP_PULL
)

787  
ãxtuªAs£ts
::
SYMBOLS
::
Squ¨e
;

788 i‡(
vÆ
 =
CøãPowî
::
CP_MERGE
)

789  
ãxtuªAs£ts
::
SYMBOLS
::
Plus
;

790 i‡(
vÆ
 =
CøãPowî
::
CP_PARALLEL
)

791  
ãxtuªAs£ts
::
SYMBOLS
::
TrüngÀ
;

792 
	`¸ash_îr
("TriedÅo drawá crate_powerÅhat isÇot drawable");

793  
ãxtuªAs£ts
::
SYMBOLS
::
HÆfCú˛e
;

794 
	}
}

796 
Põ˚D©a
 
	$game°©e_põ˚d©a_make
()

798 
Põ˚D©a
 
ªsu…
;

799 
i
 = 0; i < 
CP_COUNT
; i++)

800 
ªsu…
.
powîs
[
i
] = 
Ál£
;

801  
ªsu…
;

802 
	}
}

803 
Põ˚D©a
 
	$game°©e_põ˚d©a_make
(
CøãPowî
 
powî
)

805 
Põ˚D©a
 
ªsu…
;

806 
i
 = 0; i < 
CP_COUNT
; i++)

807 
ªsu…
.
powîs
[
i
] = 
Ál£
;

808 
ªsu…
.
powîs
[
powî
] = 
åue
;

809  
ªsu…
;

811 
	}
}

812 
Põ˚D©a
 
	$game°©e_põ˚d©a_make
(
CøãPowî
 
powî
,CøãPowî 
powî2
)

814 
Põ˚D©a
 
ªsu…
;

815 
i
 = 0; i < 
CP_COUNT
; i++)

816 
ªsu…
.
powîs
[
i
] = 
Ál£
;

817 
ªsu…
.
powîs
[
powî
] = 
åue
;

818 
ªsu…
.
powîs
[
powî2
] = 
åue
;

819  
ªsu…
;

821 
	}
}

822 
Põ˚D©a
 
	$game°©e_põ˚d©a_make
(
CøãPowî
 
powî
,CøãPowî 
powî2
, CøãPowî 
powî3
)

824 
Põ˚D©a
 
ªsu…
;

825 
i
 = 0; i < 
CP_COUNT
; i++)

826 
ªsu…
.
powîs
[
i
] = 
Ál£
;

827 
ªsu…
.
powîs
[
powî
] = 
åue
;

828 
ªsu…
.
powîs
[
powî2
] = 
åue
;

829 
ªsu…
.
powîs
[
powî3
] = 
åue
;

830  
ªsu…
;

832 
	}
}

833 
Flo‹D©a
 
	$game°©e_Êo‹d©a_make
()

835 
Flo‹D©a
 
ªsu…
;

836 
ªsu…
.
ãÀp‹ãr_id
 = -1;

837  
ªsu…
;

838 
	}
}

843 
	$game°©e_¥öt_°aúˇ£_ãÀ_vÆue
(
GameSèã
** 
game°©e
, 
Àn
)

845 
z
 = 0; z < 
Àn
; z++)

848 
w
 = 
game°©e
[
z
]->w;

849 
h
 = 
game°©e
[
z
]->h;

850 
i
 = 0; i < 
w
 * 
h
; i++)

852 i‡(
	`is_°aúˇ£
(
game°©e
[
z
]->
Êo‹
[
i
]))

854 
°d
::
cout
 << "i" << 
i
 << ",ãÀ_lök" << 
game°©e
[
z
]->
Êo‹_d©a
[i].
ãÀp‹ãr_id
 << std::
ídl
;

859 
	}
}

860 ** 
	$game°©e_gë_œyîs
(
GameSèã
* 
game°©e
, * 
num_œyîs_found
, 
Mem‹y
* 
ãmp_mem‹y
)

862 ** 
ªsu…
 = (**)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (*) * 2);

863 
ªsu…
[0] = 
game°©e
->
Êo‹
;

864 
ªsu…
[1] = 
game°©e
->
põ˚
;

865  
ªsu…
;

866 
	}
}

867 * 
	$game°©e_gë_œyî
(
GameSèã
* 
game°©e
, 
œyî_num
)

869 i‡(
œyî_num
 == 0)

870  
game°©e
->
Êo‹
;

871 i‡(
œyî_num
 == 1)

872  
game°©e
->
põ˚
;

873 
	`¸ash_îr
("uh ohh, weÅriedÅo getáÜayerÅhat doesn'tÉxist!");

874  
game°©e
->
Êo‹
;

875 
	}
}

876 
AABB
* 
	$game°©e_¸óã_cﬁlidîs
(
Mem‹y
* 
mem‹y
, 
GameSèã
** 
°©es
, 
I¡Paú
* 
loˇti⁄s
, 
Àngth
)

878 
AABB
* 
ªsu…
 = (AABB*)
	`mem‹y_Æloc
(
mem‹y
, (AABBË* (
Àngth
 - 1));

879 
i
 = 0; i < 
Àngth
; i++)

881 
ªsu…
[
i
].
w
 = (Ë
°©es
[i]->w;

882 
ªsu…
[
i
].
h
 = (Ë
°©es
[i]->h;

884 
i
 = 0; i < 
Àngth
; i++)

886 
ªsu…
[
i
].
x
 = (Ë
loˇti⁄s
[i].x;

887 
ªsu…
[
i
].
y
 = (Ë
loˇti⁄s
[i].y;

889  
ªsu…
;

890 
	}
}

891 
AABB
* 
	$game°©e_¸óã_cﬁlidîs
(
Mem‹y
* 
mem‹y
, 
GameSèã
** 
°©es
, 
I¡Paú
* 
loˇti⁄s
, 
Àngth
, 
skù_ödex
)

893 
AABB
* 
ªsu…
 = (AABB*Ë
	`mem‹y_Æloc
(
mem‹y
, (AABBË* (
Àngth
 - 1));

894 
i
 = 0; i < 
skù_ödex
; i++)

896 
ªsu…
[
i
].
w
 = (Ë
°©es
[i]->w;

897 
ªsu…
[
i
].
h
 = (Ë
°©es
[i]->h;

899 
i
 = 
skù_ödex
 + 1; i < 
Àngth
; i++)

901 
ªsu…
[
i
 - 1].
w
 = (Ë
°©es
[i]->w;

902 
ªsu…
[
i
 - 1].
h
 = (Ë
°©es
[i]->h;

904 
i
 = 0; i < 
skù_ödex
; i++)

906 
ªsu…
[
i
].
x
 = (Ë
loˇti⁄s
[i].x;

907 
ªsu…
[
i
].
y
 = (Ë
loˇti⁄s
[i].y;

909 
i
 = 
skù_ödex
 + 1; i < 
Àngth
; i++)

911 
ªsu…
[
i
 - 1].
x
 = (Ë
loˇti⁄s
[i].x;

912 
ªsu…
[
i
 - 1].
y
 = (Ë
loˇti⁄s
[i].y;

914  
ªsu…
;

915 
	}
}

916 
	$symbﬁloˇœnim©i⁄_Æloc_öã∫Æ
(
GameSèã
* 
°©e
, 
SymbﬁAnim©i⁄
* 
™im©i⁄
,
w
, 
h
)

918 
z
 = 0;

919 
i
 = 0; i < 
w
; i++)

920 
j
 = 0; j < 
h
;j++,
z
++)

922 
™im©i⁄
->
°¨t_powîs
[
z
] = 
°©e
->
põ˚_d©a
[z];

923 
™im©i⁄
->
íd_powîs
[
z
] = 
°©e
->
põ˚_d©a
[z];

924 
p
 = 0;Ö < 
CP_COUNT
;Ö++)

925 
™im©i⁄
->
Êash_powîs
[
z
].
powîs
[
p
] = 
Ál£
;;

926 
™im©i⁄
->
globÆ_posôi⁄
[
z
] = 
	`m©h_öçaú_¸óã
(
i
, 
j
);

927 
™im©i⁄
->
globÆ_move
[
z
] = 
Dúe˘i⁄
::
NO_DIRECTION
;

929 
	}
}

931 
SymbﬁAnim©i⁄
* 
	$symbﬁloˇœnim©i⁄_¸óã_öã∫Æ
(
num_ñemíts
, 
Mem‹y
* 
ãmp_mem‹y
)

933 
SymbﬁAnim©i⁄
* 
ªsu…
 = 
mem_Æloc
<SymbﬁAnim©i⁄>(
ãmp_mem‹y
, 1);

934 
ªsu…
->
Àn
 = 
num_ñemíts
;

935 
ªsu…
->
globÆ_posôi⁄
 = 
mem_Æloc
<
I¡Paú
>(
ãmp_mem‹y
, 
num_ñemíts
);

936 
ªsu…
->
globÆ_move
 = 
mem_Æloc
<
Dúe˘i⁄
>(
ãmp_mem‹y
,
num_ñemíts
);

937 
ªsu…
->
°¨t_powîs
 = 
mem_Æloc
<
Põ˚D©a
>(
ãmp_mem‹y
,
num_ñemíts
);

938 
ªsu…
->
íd_powîs
 = 
mem_Æloc
<
Põ˚D©a
>(
ãmp_mem‹y
,
num_ñemíts
);

939 
ªsu…
->
Êash_powîs
 = 
mem_Æloc
<
Põ˚D©a
>(
ãmp_mem‹y
,
num_ñemíts
);

940  
ªsu…
;

941 
	}
}

943 
	$symbﬁglobÆ™im©i⁄_Æloc_öã∫Æ
(
SymbﬁGlobÆAnim©i⁄
* 
to_Æloc
, 
Mem‹y
* 
ãmp_mem‹y
,
num_ñemíts
)

945 
to_Æloc
->
Àn
 = 
num_ñemíts
;

946 
to_Æloc
->
img_vÆue
 = 
mem_Æloc
<>(
ãmp_mem‹y
, 
num_ñemíts
);

947 
to_Æloc
->
to_move
 = 
mem_Æloc
<
Dúe˘i⁄
>(
ãmp_mem‹y
, 
num_ñemíts
);

948 
to_Æloc
->
pos
 = 
mem_Æloc
<
I¡Paú
>(
ãmp_mem‹y
, 
num_ñemíts
);

949 
	}
}

950 
	$c›y_põ˚_™im©i⁄_to_symbﬁ_™im©i⁄
(
Põ˚D©a
* 
¸©es
, 
Àn_põ˚s
, 
Àn_symbﬁs
, 
MaskedMovemítAnim©i⁄
* 
põ˚s
, MaskedMovemítAnim©i⁄* 
symbﬁ
)

952 
cuºít_Àn_symbﬁs
 = 0;

953 
i
 = 0; i < 
Àn_põ˚s
; i++)

955 
j
 = 0; j < 
CP_COUNT
;j++)

956 i‡(
¸©es
[
i
].
powîs
[
j
])

958 
symbﬁ
->
pos
[
cuºít_Àn_symbﬁs
] = 
põ˚s
->pos[
i
];

959 
symbﬁ
->
img_vÆue
[
cuºít_Àn_symbﬁs
] = 
j
;

960 
symbﬁ
->
to_move
[
cuºít_Àn_symbﬁs
]
põ˚s
->to_move[
i
];

961 
cuºít_Àn_symbﬁs
++;

964 
	}
}

965 
	$masked_movemít_™im©i⁄_˛⁄e_öã∫Æ
(
Àn
, 
MaskedMovemítAnim©i⁄
* 
c›y
, MaskedMovemítAnim©i⁄* 
‹igöÆ
)

967 
i
 = 0; i < 
Àn
; i++)

969 
c›y
->
img_vÆue
[
i
] = 
‹igöÆ
->img_value[i];

971 
i
 = 0; i < 
Àn
; i++)

973 
c›y
->
pos
[
i
] = 
‹igöÆ
->pos[i];

975 
i
 = 0; i < 
Àn
; i++)

977 
c›y
->
to_move
[
i
] = 
‹igöÆ
->to_move[i];

979 
	}
}

980 
MaskedMovemítAnim©i⁄
* 
	$game°©e_™im©i⁄moveöfo_¸óã_öã∫Æ
(
num_ñemíts
, 
Mem‹y
* 
ãmp_mem‹y
)

982 
MaskedMovemítAnim©i⁄
* 
ªsu…
 = (MaskedMovemítAnim©i⁄*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (MaskedMovementAnimation));

983 
ªsu…
->
pos
 = (
I¡Paú
*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (I¡PaúË* 
num_ñemíts
);

984 
ªsu…
->
to_move
 = (
Dúe˘i⁄
*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (Dúe˘i⁄Ë* 
num_ñemíts
);

985 
ªsu…
->
img_vÆue
 = (*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (Ë* 
num_ñemíts
);

986 
i
 = 0; i < 
num_ñemíts
; i++)

988 
ªsu…
->
pos
[
i
] = 
	`m©h_öçaú_¸óã
(0, 0);

989 
ªsu…
->
to_move
[
i
] = 
Dúe˘i⁄
::
NO_DIRECTION
;

990 
ªsu…
->
img_vÆue
[
i
] = 0;

992  
ªsu…
;

993 
	}
}

994 
	$™im©i⁄moveöfo_£t_deÁu…_posôi⁄s
(
MaskedMovemítAnim©i⁄
* 
öfo
, 
GameSèã
* 
°©e
)

996 
w
 = 
°©e
->w;

997 
h
 = 
°©e
->h;

998 
z
 = 0;

999 
i
 = 0; i < 
w
;i++)

1000 
j
 = 0; j < 
h
; j++, 
z
++)

1002 
öfo
->
pos
[
z
] = 
	`m©h_öçaú_¸óã
(
i
, 
j
);

1004 
	}
}

1005 
	$™im©i⁄moveöfo_c›y_‰om_game°©e_öã∫Æ
(
MaskedMovemítAnim©i⁄
* 
öfo
, 
GameSèã
* 
°©e
)

1007 
num_to_døw
 = 
°©e
->
w
 * sèã->
h
;

1008 
i
 = 0; i < 
num_to_døw
; i++)

1010 
√xt_vÆ
 = 
°©e
->
põ˚
[
i
];

1011 
öfo
->
img_vÆue
[
i
] = 
√xt_vÆ
;

1014 
	}
}

1015 
	$™im©i⁄moveöfo_≠∂y_movemíts
(
GameSèã
* 
°©e
, 
MaskedMovemítAnim©i⁄
* 
°¨t
,MaskedMovemítAnim©i⁄* 
íd
, 
boﬁ
* 
moves
, 
Dúe˘i⁄
 
movemít
, 
num_to_døw
)

1017 
z
 = 0;

1018 
i
 = 0; i < 
°©e
->
w
;i++)

1019 
j
 = 0;j < 
°©e
->
h
;j++,
z
++)

1020 i‡(
moves
[
z
])

1022 
°¨t
->
to_move
[
z
] = 
movemít
;

1023 
íd
->
to_move
[
z
] = 
movemít
;

1024 
I¡Paú
 
√xt_gﬂl
 = 
	`move_pos_wøµed_2d
(
	`m©h_öçaú_¸óã
(
i
,
j
),
movemít
, 
°©e
->
w
, sèã->
h
);

1025 
íd
->
pos
[
z
] = 
√xt_gﬂl
;

1027 
	}
}

1029 
	gglm
::
vec2
 
	$põ˚d©a_ˇlcuœã_sˇÀ
(
Põ˚D©a
 
põ˚
)

1031 
tŸÆ
 = 0;

1032 
i
 = 0; i < 
CP_COUNT
; i++)

1033 
tŸÆ
 +
põ˚
.
powîs
[
i
];

1034 
width
 = ()
	`˚û
(
	`sqπ
(
tŸÆ
));

1035 
glm
::
vec2
 
sˇÀ
;

1036 
sˇÀ
.
x
 = 1.0‡/ ()
width
;

1037 
sˇÀ
.
y
 = 1.0‡/ ()
width
;

1038  
sˇÀ
;

1039 
	}
}

1041 
	$põ˚d©a_ˇlcuœã_loˇl_posôi⁄s
(
Põ˚D©a
 
põ˚
, 
glm
::
vec2
* 
sˇÀ
, glm::vec2* 
out_posôi⁄s
)

1043 
tŸÆ
 = 0;

1044 
i
 = 0; i < 
CP_COUNT
; i++)

1045 
tŸÆ
 +
põ˚
.
powîs
[
i
];

1046 
width
 = ()
	`˚û
(
	`sqπ
(
tŸÆ
));

1048 
num_døwn
 = 0;

1049 
j
 = 0; j < 
CP_COUNT
; j++)

1051 i‡(
põ˚
.
powîs
[
j
])

1053 
out_posôi⁄s
[
num_døwn
].
x
 = “um_døw¿% 
width
);

1054 
out_posôi⁄s
[
num_døwn
].
y
 = “um_døw¿/ 
width
);

1055 
num_døwn
++;

1058 
	}
}

1062 
GameA˘i⁄Jou∫Æ
* 
	$game°©e_a˘i⁄
(
GameSèã
* 
°©e
, 
Dúe˘i⁄
 
a˘i⁄
, 
Mem‹y
* 
ãmp_mem‹y
)

1064 
GameA˘i⁄Jou∫Æ
* 
jou∫Æ
 = (GameA˘i⁄Jou∫Æ*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (GameActionJournal));

1065 
jou∫Æ
->
ﬁd_°©e
 = 
	`game°©e_˛⁄e
(
°©e
, 
ãmp_mem‹y
);

1066 c⁄° 
w
 = 
°©e
->w;

1067 c⁄° 
h
 = 
°©e
->h;

1068 c⁄° 
num_ñemíts
 = 
w
 * 
h
;

1069 * 
põ˚s
 = 
°©e
->
põ˚
;

1072 
GameSèãAnim©i⁄
* 
™im©i⁄
;

1074 
™im©i⁄
 = (
GameSèãAnim©i⁄
*Ë
	`mem‹y_Æloc
(
ãmp_mem‹y
, (GameStateAnimation));

1075 
™im©i⁄
->
°¨ts
 = *
	`game°©e_™im©i⁄moveöfo_¸óã_öã∫Æ
(
w
 * 
h
, 
ãmp_mem‹y
);

1076 
™im©i⁄
->
íds
 = *
	`game°©e_™im©i⁄moveöfo_¸óã_öã∫Æ
(
w
 * 
h
, 
ãmp_mem‹y
);

1077 
™im©i⁄
->
num_to_døw
 = 
w
 * 
h
;

1078 
	`™im©i⁄moveöfo_c›y_‰om_game°©e_öã∫Æ
(&
™im©i⁄
->
°¨ts
, 
°©e
);

1079 
	`™im©i⁄moveöfo_£t_deÁu…_posôi⁄s
(&
™im©i⁄
->
°¨ts
, 
°©e
);

1080 
	`™im©i⁄moveöfo_£t_deÁu…_posôi⁄s
(&
™im©i⁄
->
íds
, 
°©e
);

1083 
∂ayî_1d
 = 0;

1084 
I¡Paú
 
∂ayî_2d
 = 
	`m©h_öçaú_¸óã
(0,0);

1087 
i
 = 0; i < 
num_ñemíts
; i++)

1089 i‡(
	`is_∂ayî
(
põ˚s
[
i
]))

1092 
∂ayî_1d
 = 
i
;

1093 
∂ayî_2d
 = 
	`t2D
(
i
, 
°©e
->
w
, sèã->
h
);

1100 
boﬁ
* 
squ¨e_movög
 = (boﬁ*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (boﬁË* 
num_ñemíts
);

1102 
	`mem£t
(
squ¨e_movög
, 
Ál£
, (Ë* 
num_ñemíts
);

1103 
squ¨e_movög
[
∂ayî_1d
] = 
åue
;

1107 
RigidD©a
 
rigid_d©a
;

1109 
rigid_d©a
.
grid
 = (*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (Ë* 
num_ñemíts
);

1110 
i
 = 0; i < 
num_ñemíts
; i++)

1111 
rigid_d©a
.
grid
[
i
]= 0;

1112 
rigid_d©a
.
löks
 = (
I¡Paú
*Ë
	`mem‹y_Æloc
(
ãmp_mem‹y
, (I¡PaúË* 
num_ñemíts
);

1113 
rigid_d©a
.
num_löks
 = 0;

1114 
rigid_d©a
.
num_rigids
 = 1;

1118 
I¡Paú
 
√xt_squ¨e
 = 
	`move_pos_wøµed_2d
(
∂ayî_2d
, 
a˘i⁄
, 
w
, 
h
);

1119 
I¡Paú
 
back_squ¨e
 = 
	`move_pos_wøµed_2d
(
∂ayî_2d
, 
	`dúe˘i⁄_ªvî£
(
a˘i⁄
), 
w
, 
h
);

1120 
I¡Paú
 
˛ockwi£_squ¨e
 = 
	`move_pos_wøµed_2d
(
∂ayî_2d
, 
	`dúe˘i⁄_rŸ©e_˛ockwi£
(
a˘i⁄
), 
w
, 
h
);

1121 
I¡Paú
 
™ti˛ockwi£_squ¨e
 = 
	`move_pos_wøµed_2d
(
∂ayî_2d
, 
	`dúe˘i⁄_rŸ©e_™ti
(
a˘i⁄
), 
w
, 
h
);

1122 
√xt_squ¨e_1d
 = 
	`f2D
(
√xt_squ¨e
.
x
,Çext_squ¨e.
y
, 
w
, 
h
);

1123 
back_squ¨e_1d
 = 
	`f2D
(
back_squ¨e
.
x
, back_squ¨e.
y
, 
w
, 
h
);

1124 
˛ockwi£_squ¨e_1d
 = 
	`f2D
(
˛ockwi£_squ¨e
.
x
, clockwi£_squ¨e.
y
, 
w
, 
h
);

1125 
™ti˛ockwi£_squ¨e_1d
 = 
	`f2D
(
™ti˛ockwi£_squ¨e
.
x
,á¡i˛ockwi£_squ¨e.
y
, 
w
, 
h
);

1127 
√xt_põ˚
 = 
põ˚s
[
√xt_squ¨e_1d
];

1128 
back_põ˚
 = 
põ˚s
[
back_squ¨e_1d
];

1129 
˛ockwi£_põ˚
 = 
põ˚s
[
˛ockwi£_squ¨e_1d
];

1130 
™ti˛ockwi£_põ˚
 = 
põ˚s
[
™ti˛ockwi£_squ¨e_1d
];

1133 
∂ayî_rigid_numbî
 = 
rigid_d©a
.
num_rigids
;

1134 
rigid_d©a
.
num_rigids
++;

1135 
rigid_d©a
.
grid
[
∂ayî_1d
] = 
∂ayî_rigid_numbî
;

1136 i‡(
√xt_põ˚
 =
P_CRATE
 && 
°©e
->
põ˚_d©a
[
√xt_squ¨e_1d
].
powîs
[
CP_PUSH
])

1138 
squ¨e_movög
[
√xt_squ¨e_1d
] = 
åue
;

1139 
rigid_d©a
.
grid
[
√xt_squ¨e_1d
] =Ñigid_d©a.
num_rigids
;

1140 
rigid_d©a
.
num_rigids
++;

1141 
rigid_d©a
.
löks
[rigid_d©a.
num_löks
] = 
	`m©h_öçaú_¸óã
(
∂ayî_rigid_numbî
,Ñigid_d©a.
grid
[
√xt_squ¨e_1d
]);

1142 
rigid_d©a
.
num_löks
++;

1144 i‡(
back_põ˚
 =
P_CRATE
 && 
°©e
->
põ˚_d©a
[
back_squ¨e_1d
].
powîs
[
CP_PULL
])

1146 
squ¨e_movög
[
back_squ¨e_1d
] = 
åue
;

1147 
rigid_d©a
.
grid
[
back_squ¨e_1d
] =Ñigid_d©a.
num_rigids
;

1148 
rigid_d©a
.
num_rigids
++;

1149 
rigid_d©a
.
löks
[rigid_d©a.
num_löks
] = 
	`m©h_öçaú_¸óã
(
∂ayî_rigid_numbî
,Ñigid_d©a.
grid
[
back_squ¨e_1d
]);

1150 
rigid_d©a
.
num_löks
++;

1152 i‡(
˛ockwi£_põ˚
 =
P_CRATE
 && 
°©e
->
põ˚_d©a
[
˛ockwi£_squ¨e_1d
].
powîs
[
CP_PARALLEL
])

1154 
squ¨e_movög
[
˛ockwi£_squ¨e_1d
] = 
åue
;

1155 
rigid_d©a
.
grid
[
˛ockwi£_squ¨e_1d
] =Ñigid_d©a.
num_rigids
;

1156 
rigid_d©a
.
num_rigids
++;

1157 
rigid_d©a
.
löks
[rigid_d©a.
num_löks
] = 
	`m©h_öçaú_¸óã
(
∂ayî_rigid_numbî
,Ñigid_d©a.
grid
[
˛ockwi£_squ¨e_1d
]);

1158 
rigid_d©a
.
num_löks
++;

1160 i‡(
™ti˛ockwi£_põ˚
 =
P_CRATE
 && 
°©e
->
põ˚_d©a
[
™ti˛ockwi£_squ¨e_1d
].
powîs
[
CP_PARALLEL
])

1162 
squ¨e_movög
[
™ti˛ockwi£_squ¨e_1d
] = 
åue
;

1163 
rigid_d©a
.
grid
[
™ti˛ockwi£_squ¨e_1d
] =Ñigid_d©a.
num_rigids
;

1164 
rigid_d©a
.
num_rigids
++;

1165 
rigid_d©a
.
löks
[rigid_d©a.
num_löks
] = 
	`m©h_öçaú_¸óã
(
∂ayî_rigid_numbî
,Ñigid_d©a.
grid
[
™ti˛ockwi£_squ¨e_1d
]);

1166 
rigid_d©a
.
num_löks
++;

1168 i‡(
°©e
->
Êo‹
[
√xt_squ¨e_1d
] =
F_GRILL_HOT
)

1170 
squ¨e_movög
[
∂ayî_1d
] = 
Ál£
;

1171 
	`ˇn˚l_moves_by_rigid
(&
rigid_d©a
, 
squ¨e_movög
, 
∂ayî_rigid_numbî
, 
°©e
->
w
 * sèã->
h
);

1176 
™im©i⁄
->
symbﬁ_°¨t
 = *
	`symbﬁloˇœnim©i⁄_¸óã_öã∫Æ
(
w
 * 
h
, 
ãmp_mem‹y
);

1177 
™im©i⁄
->
symbﬁ_íd
 = *
	`symbﬁloˇœnim©i⁄_¸óã_öã∫Æ
(
w
 * 
h
, 
ãmp_mem‹y
);

1179 
	`symbﬁloˇœnim©i⁄_Æloc_öã∫Æ
(
°©e
, &
™im©i⁄
->
symbﬁ_°¨t
, 
w
, 
h
);

1180 
	`symbﬁloˇœnim©i⁄_Æloc_öã∫Æ
(
°©e
, &
™im©i⁄
->
symbﬁ_íd
, 
w
, 
h
);

1182 
	`ˇn˚l_blocked_n⁄mîge_moves
(&
rigid_d©a
, 
squ¨e_movög
, 
põ˚s
, 
°©e
->
põ˚_d©a
, 
a˘i⁄
, 
w
, 
h
);

1185 i‡(
squ¨e_movög
[
∂ayî_1d
] && 
°©e
->
Êo‹
[∂ayî_1d] =
F_GRILL_COLD
)

1186 
°©e
->
Êo‹
[
∂ayî_1d
] = 
F_GRILL_HOT
;

1191 
	`≠∂y_mîge_moves
(
°©e
->
põ˚_d©a
, 
squ¨e_movög
, 
põ˚s
, 
a˘i⁄
, 
w
, 
h
,
™im©i⁄
);

1194 
	`™im©i⁄moveöfo_c›y_‰om_game°©e_öã∫Æ
(&
™im©i⁄
->
íds
, 
°©e
);

1197 
	`™im©i⁄moveöfo_≠∂y_movemíts
(
°©e
,&
™im©i⁄
->
°¨ts
, &™im©i⁄->
íds
, 
squ¨e_movög
, 
a˘i⁄
, 
w
 * 
h
);

1200 
≠∂y_moves_to_œyî_SLOW
<>(
ãmp_mem‹y
, 
squ¨e_movög
, 
põ˚s
, 
w
, 
h
, 
a˘i⁄
, 
P_NONE
);

1201 
≠∂y_moves_to_œyî_SLOW
<
Põ˚D©a
>(
ãmp_mem‹y
, 
squ¨e_movög
, 
°©e
->
põ˚_d©a
,
w
,
h
,
a˘i⁄
, 
	`game°©e_põ˚d©a_make
());

1203 
jou∫Æ
->
a˘i⁄_ªsu…
 = 
AR_ACTION_OCCURED
;

1204 
jou∫Æ
->
maybe_™im©i⁄
 = 
™im©i⁄
;

1205  
jou∫Æ
;

1206 
	}
}

1207 
	$game°©e_¸umbÀ
(
GameSèã
* 
°©e
)

1209 
Àn
 = 
°©e
->
w
 * sèã->
h
;

1210 
i
 = 0; i < 
Àn
; i++)

1212 i‡(
°©e
->
põ˚
[
i
] =
P_CRUMBLE
 || sèã->põ˚[i] =
P_CRATE
)

1213 
°©e
->
põ˚
[
i
] = 
P_NONE
;

1215 
i
 = 0; i < 
Àn
; i++)

1217 i‡(
°©e
->
Êo‹
[
i
] =
F_START
 || sèã->Êo‹[i] =
F_TARGET
)

1218 
°©e
->
Êo‹
[
i
] = 
F_NONE
;

1220 
i
 = 0; i < 
Àn
; i++)

1222 i‡(
°©e
->
Êo‹
[
i
] =
F_EXIT
)

1223 
°©e
->
Êo‹
[
i
] = 
F_NONE
;

1225 
	}
}

1226 
	$game°©e_°¨tup
(
GameSèã
* 
°©e
)

1228 
	`game°©e_exåude_lurkög_wÆls
(
°©e
);

1231 
exô
 = 
	`maybe_föd_exô_‹_ªtu∫_√g1
(
°©e
);

1233 i‡(
exô
 == -1)

1235 
	`¸ash_îr
("a gamestate was started up, butánÉxit couldn't be found. Uh oh.");

1238 
i
 = 0; i < 
°©e
->
w
 * sèã->
h
;i++)

1240 i‡(
i
 =
exô
)

1242 i‡(
°©e
->
Êo‹
[
i
] =
F_EXIT
 || sèã->Êo‹[i] =
F_START
 || sèã->Êo‹[i] =
F_STAIRCASE_LEVELSTART
)

1244 
°©e
->
Êo‹
[
i
] = 
F_NONE
;

1248 if(
Ál£
)

1250 
boﬁ
 
found_íå™˚
 = 
Ál£
;

1251 
boﬁ
 
found_exô
 = 
Ál£
;

1252 
íå™˚
 = 0;

1253 
exô
 = 0;

1254 
i
 = 0; i < 
°©e
->
w
 * sèã->
h
; i++)

1256 i‡(
	`is_Àvñ_°¨t
(
°©e
->
Êo‹
[
i
]))

1258 
found_íå™˚
 = 
åue
;

1259 
íå™˚
 = 
i
;

1263 
i
 = 0; i < 
°©e
->
w
 * sèã->
h
; i++)

1266 i‡(
°©e
->
Êo‹
[
i
] =
F_EXIT
)

1268 
found_exô
 = 
åue
;

1269 
exô
 = 
i
;

1274 i‡(
found_íå™˚
 && !
found_exô
)

1276 
°©e
->
Êo‹
[
íå™˚
] = 
F_EXIT
;

1280 
	}
}

1281 
	$game°©e_exåude_lurkög_wÆls
(
GameSèã
* 
°©e
)

1283 
Àn
 = 
°©e
->
w
 * sèã->
h
;

1284 
i
 = 0; i < 
Àn
; i++)

1286 i‡(
°©e
->
Êo‹
[
i
] =
F_LURKING_WALL
)

1288 
°©e
->
põ˚
[
i
] = 
P_WALL
;

1292 
	}
}

	@GameState.h

1 #¥agm®
⁄˚


3 
	~"C⁄°™ts.h
"

4 
	~"Mem‹y.h
"

5 
	~"M©h.h
"

6 
	~<io°ªam
>

7 
	~"ãxtuªAs£ts.h
"

8 
	eLAYER_NAME


10 
	mLN_FLOOR
,

11 
	mLN_PIECE
,

12 
	mLN_COUNT


15 c⁄° 
	gGAME_NUM_LAYERS
 = 
LN_COUNT
;

16 c⁄° 
	gPLAYER_LAYER
 = 
LN_PIECE
;

18 
	ePõ˚
 {

19 
	mP_NONE
,

20 
	mP_PLAYER
,

21 
	mP_CRATE
,

22 
	mP_CRUMBLE
,

23 
	mP_WALL
,

24 
	mP_WALL_ALT
,

25 
	mP_COUNT


28 
	eFlo‹
 {

29 
	mF_NONE
,

30 
	mF_TARGET
,

31 
	mF_OUTLINE
,

32 
	mF_START
,

33 
	mF_ZBLACK
,

34 
	mF_LURKING_WALL
,

35 
	mF_GRILL_COLD
,

36 
	mF_GRILL_HOT
,

37 
	mF_EXIT
,

38 
	mF_STAIRCASE
,

39 
	mF_STAIRCASE_LEVELSTART
,

40 
	mF_STAIRCASE_SOLVED
,

41 
	mF_COUNT


43 
	eCøãPowî
 {

44 
	mCP_PUSH
,

45 
	mCP_PULL
,

46 
	mCP_PARALLEL
,

47 
	mCP_MERGE
,

48 
	mCP_STICKY
,

49 
	mCP_COUNT
,

50 
	mCP_ERROR


52 
	sPõ˚D©a


54 
boﬁ
 
	mpowîs
[
CP_COUNT
];

57 
	gTñï‹ãr_Loˇti⁄
;

58 
	sFlo‹D©a


61 
	mãÀp‹ãr_id
;

62 
I¡Paú
 
	mãÀp‹ãr_èrgë_squ¨e
;

65 
	sGameSèã
 {

66 
	mw
;

67 
	mh
;

68 * 
	mÊo‹
;

69 * 
	mpõ˚
;

70 
Flo‹D©a
* 
	mÊo‹_d©a
;

71 
Põ˚D©a
* 
	mpõ˚_d©a
;

74 
	sGame°©eBrush
 {

75 
boﬁ
 
	m≠∂yFlo‹
;

76 
boﬁ
 
	m≠∂yPõ˚
;

77 
Flo‹
 
	mÊo‹
;

78 
Põ˚
 
	mpõ˚
;

79 
boﬁ
 
	m≠∂yCøãPowî
;

80 
Põ˚D©a
 
	mpõ˚_d©a
;

81 
boﬁ
 
	m≠∂yFlo‹Powî
;

82 
Flo‹D©a
 
	mÊo‹_d©a
;

85 
	sGame°©eTimeMachöe


87 
GameSèã
* 
	m°¨t_°©e
;

88 
GameSèã
* 
	m°©e_¨øy
;

89 
	mnum_game°©es_°‹ed
;

90 
	mmax_game°©es_°‹abÀ
;

92 
	eA˘i⁄
 {

93 
	mA_UP
,

94 
	mA_RIGHT
,

95 
	mA_DOWN
,

96 
	mA_LEFT
,

97 
	mA_UNDO
,

98 
	mA_RESET
,

99 
	mA_NONE
,

100 
	mA_COUNT


104 
	eAnim©i⁄Ty≥
 {

105 
	mAT_NONE
,

106 
	mAT_MOVE
,

107 
	mAT_COUNT


111 
	sSymbﬁGlobÆAnim©i⁄


113 
	mÀn
;

114 
I¡Paú
* 
	mpos
;

115 
Dúe˘i⁄
* 
	mto_move
;

116 * 
	mimg_vÆue
;

118 
	sSymbﬁAnim©i⁄


120 
	mÀn
;

121 * 
	mödex
;

122 
I¡Paú
* 
	mglobÆ_posôi⁄
;

123 
Dúe˘i⁄
* 
	mglobÆ_move
;

124 
Põ˚D©a
* 
	m°¨t_powîs
;

125 
Põ˚D©a
* 
	míd_powîs
;

126 
Põ˚D©a
* 
	mÊash_powîs
;

128 
	sMaskedMovemítAnim©i⁄


130 
I¡Paú
* 
	mpos
;

131 
Dúe˘i⁄
* 
	mto_move
;

133 * 
	mimg_vÆue
;

135 
	sGameSèãAnim©i⁄


137 
	mnum_to_døw
;

139 
MaskedMovemítAnim©i⁄
 
	m°¨ts
;

140 
MaskedMovemítAnim©i⁄
 
	míds
;

142 
SymbﬁAnim©i⁄
 
	msymbﬁ_°¨t
;

143 
SymbﬁAnim©i⁄
 
	msymbﬁ_íd
;

145 
	eA˘i⁄Resu…


147 
	mAR_ACTION_CANCELLED
,

148 
	mAR_ACTION_OCCURED
,

149 
	mAR_COUNT


151 
	sGameA˘i⁄Jou∫Æ


153 
GameSèã
* 
	mﬁd_°©e
;

154 
A˘i⁄Resu…
 
	ma˘i⁄_ªsu…
;

155 
GameSèãAnim©i⁄
* 
	mmaybe_™im©i⁄
;

158 
	sRigidD©a


160 * 
	mgrid
;

161 
	mnum_rigids
;

162 
I¡Paú
* 
	mlöks
;

163 
	mnum_löks
;

165 
Dúe˘i⁄
 
a˘i⁄_to_dúe˘i⁄
(
A˘i⁄
 
a˘i⁄
);

166 
I¡Paú
 
dúe˘i⁄_to_öçaú
(
Dúe˘i⁄
 
dú
);

167 
game°©e_timemachöe_ª£t
(
Game°©eTimeMachöe
* 
timeMachöe
, 
Mem‹y
* 
sc›e_mem‹y
);

171 
game°©e_timemachöe_ª£t
(
Game°©eTimeMachöe
* 
timeMachöe
, 
Mem‹y
* 
sc›e_mem‹y
);

172 * 
game°©e_timemachöe_undo
(
Game°©eTimeMachöe
* 
timeMachöe
);

173 
GameSèã
* 
game°©e_timemachöe_gë_œã°_game°©e
(
Game°©eTimeMachöe
* 
timeMachöe
);

174 
Game°©eTimeMachöe
* 
game°©e_timemachöe_¸óã
(
GameSèã
* 
°¨t_°©e
, 
Mem‹y
* 
mem‹y
, 
max_num_game°©es
);

175 
GameA˘i⁄Jou∫Æ
* 
game°©e_timemachöe_èke_a˘i⁄
(
Game°©eTimeMachöe
* 
timeMachöe
, 
Dúe˘i⁄
 
a˘i⁄
, 
Mem‹y
* 
sc›e_mem‹y
, Mem‹y* 
ãmp_mem‹y
);

178 
Game°©eBrush
 
game°©e_brush_¸óã
(
boﬁ
 
≠∂yFlo‹
, 
Flo‹
 
Êo‹
, boﬁ 
≠∂yPõ˚
, 
Põ˚
 
põ˚
, boﬁ 
≠∂yPõ˚D©a
, 
Põ˚D©a
 
põ˚D©a
, boﬁ 
≠∂yFlo‹D©a
, 
Flo‹D©a
 
Êo‹D©a
);

182 
	gãxtuªAs£ts
::
SYMBOLS
 
põ˚d©a_to_symbﬁ
(
CøãPowî
 
vÆ
);

183 
Põ˚D©a
 
game°©e_põ˚d©a_make
();

184 
Põ˚D©a
 
game°©e_põ˚d©a_make
(
CøãPowî
 
vÆ
);

185 
Põ˚D©a
 
game°©e_põ˚d©a_make
(
CøãPowî
 
vÆ
, CøãPowî 
vÆ2
);

186 
Põ˚D©a
 
game°©e_põ˚d©a_make
(
CøãPowî
 
vÆ
, CøãPowî 
vÆ2
,CøãPowî 
vÆ3
);

187 
Flo‹D©a
 
game°©e_Êo‹d©a_make
();

191 
GameSèã
* 
game°©e_¸óã
(
Mem‹y
* 
mem‹y
, 
w
, 
h
);

192 
GameSèã
* 
game°©e_˛⁄e
(GameSèã* 
°©e
, 
Mem‹y
* 
mem‹y
);

193 
game°©e_˛⁄e_to_unôülized
(
GameSèã
* 
öput
, GameSèã* 
ouçut
, 
Mem‹y
* 
mem‹y
);

194 
game°©e_˛⁄e_to
(
GameSèã
* 
öput_°©e
, GameSèã* 
ouçut_°©e
);

196 
GameSèã
* 
game°©e_add_row
(GameSèã* 
öput
, 
Mem‹y
* 
sc›e_mem‹y
, 
èrgë_x
, 
èrgë_y
);

197 
GameSèã
* 
game°©e_add_cﬁumn
(GameSèã* 
öput
, 
Mem‹y
* 
sc›e_mem‹y
, 
èrgë_x
, 
èrgë_y
);

198 
GameSèã
* 
game°©e_suºound_wôh_wÆls
(GameSèã* 
öput
, 
Mem‹y
* 
sc›e_mem‹y
);

199 
game°©e_ªsize
(
GameSèã
* 
öput_°©e
, GameSèã* 
ouçut_°©e
, 
I¡Paú
 
di•œ˚mít_‰om_öput_to_ouçut
);

200 
GameSèã
* 
game°©e_ªsize_wôh_Æloˇã
(GameSèã* 
öput_°©e
, 
Mem‹y
* 
ouçut_mem‹y
, 
ouçut_w
, 
ouçut_h
, 
I¡Paú
 
di•œ˚mít_‰om_öput_to_ouçut
);

201 
boﬁ
 
game°©e_≠∂y_brush
(
GameSèã
* 
°©e
, 
Game°©eBrush
 
brush
, 
x
, 
y
);

202 
GameSèã
* 
game°©e_mîge_wôh_Æloˇã
(GameSèã* 
fú°
, GameSèã* 
£c⁄d
, 
I¡Paú
 
comböed_size
, 
Mem‹y
* 
ouçut_mem‹y
, I¡Paú 
À·_mîge_off£t
, I¡Paú 
right_mîge_off£t
);

203 
game°©e_mîge
(
GameSèã
* 
À·
, GameSèã* 
right
, GameSèã* 
ouçut
, 
I¡Paú
 
À·_mîge_off£t
, I¡Paú 
right_mîge_off£t
);

206 
game°©e_¥öt_°aúˇ£_ãÀ_vÆue
(
GameSèã
** 
game°©e
,
Àn
);

207 ** 
game°©e_gë_œyîs
(
GameSèã
* 
game°©e
, * 
num_œyîs_found
, 
Mem‹y
* 
ãmp_mem‹y
);

208 * 
game°©e_gë_œyî
(
GameSèã
* 
game°©e
, 
œyî_num
);

210 
AABB
* 
game°©e_¸óã_cﬁlidîs
(
Mem‹y
* 
mem‹y
, 
GameSèã
** 
°©es
, 
I¡Paú
* 
loˇti⁄s
, 
Àngth
);

211 
AABB
* 
game°©e_¸óã_cﬁlidîs
(
Mem‹y
* 
mem‹y
, 
GameSèã
** 
°©es
, 
I¡Paú
* 
loˇti⁄s
, 
Àngth
, 
skù_ödex
);

212 
boﬁ
 
game°©e_is_ö_wö_c⁄dôi⁄
(
GameSèã
* 
°©e
);

214 
game°©e_maybe_föd_∂ayî
(
GameSèã
* 
°©e
);

215 
maybe_föd_exô_‹_ªtu∫_√g1
(
GameSèã
* 
°©e
);

216 
boﬁ
 
is_Àvñ_°¨t
(
vÆ
);

217 
boﬁ
 
is_°aúˇ£
(
vÆ
);

218 
boﬁ
 
is_∂ayî
(
vÆ
);

220 
	gglm
::
vec2
 
põ˚d©a_ˇlcuœã_sˇÀ
(
Põ˚D©a
 
põ˚
);

221 
põ˚d©a_ˇlcuœã_loˇl_posôi⁄s
(
Põ˚D©a
 
põ˚
, 
glm
::
vec2
* 
sˇÀ
, glm::vec2* 
out_posôi⁄s
);

226 
GameA˘i⁄Jou∫Æ
* 
game°©e_a˘i⁄
(
GameSèã
* 
°©e
, 
Dúe˘i⁄
 
a˘i⁄
, 
Mem‹y
* 
ãmp_mem‹y
);

228 
game°©e_°¨tup
(
GameSèã
* 
°©e
);

229 
game°©e_¸umbÀ
(
GameSèã
* 
°©e
);

230 
game°©e_exåude_lurkög_wÆls
(
GameSèã
* 
°©e
);

	@GamestateAI.h

1 #¥agm®
⁄˚


3 
	tw‹d
;

5 
«me•a˚
 
	gGame°©eAI


7 
	sGame°©e


9 
	gw
;

10 
	gh
;

11 
	gnum_¸©es
;

12 
boﬁ
* 
	gh‹iz⁄èl_wÆls
;

13 
boﬁ
* 
	gvîtiˇl_wÆls
;

14 
	gmou£_èrgë
;

17 
	gãm∂©e
<
ty≥«me
 
	gsize_t
>

18 
ex∑nd
(
Game°©e
 
°©e
, c⁄° 
öput_Àngth
, 
size_t
* 
öput
, size_t* 
ouçut
)

21 
	gi
 = 0; i < 
	göput_Àngth
; i++)

26 
	gi
 = 0; i < 
	göput_Àngth
; i++)

31 
	gi
 = 0; i < 
	göput_Àngth
;i++)

36 
	gi
 = 0; i < 
	göput_Àngth
; i++)

	@GenericUtil.h

1 #¥agm®
⁄˚


3 
	gãm∂©e
 <
ty≥«me
 
	gEÀmít
>

4 
	$föd_ñemít
(
EÀmít
* 
li°
, EÀmíà
£ek
, 
Àngth
)

6 
i
 = 0; i < 
Àngth
; i++)

7 i‡(
li°
[
i
] =
£ek
)

8  
i
;

10 
	}
}

	@Grid.cpp

1 
	~"M©h.h
"

3 
I¡Paú
 
	$m©h_grid_move_dúe˘i⁄
(
I¡Paú
 
pos
, I¡Paú 
move
, I¡Paú 
dimísi⁄s
)

5 
x
 = 
pos
.x + 
move
.x;

6 
y
 = 
pos
.y + 
move
.y;

7 i‡(
x
 >
dimísi⁄s
.x)

8 
x
 = 
dimísi⁄s
.x - 1;

9 i‡(
y
 >
dimísi⁄s
.y)

10 
y
 = 
dimísi⁄s
.y - 1;

11 i‡(
x
 < 0)

12 
x
 = 0;

13 i‡(
y
 < 0)

14 
y
 = 0;

15  
	`m©h_öçaú_¸óã
(
x
, 
y
);

16 
	}
}

17 
I¡Paú
 
	$m©h_grid_move_dúe˘i⁄
(
xSèπ
, 
ySèπ
, 
xMove
, 
yMove
, 
w
, 
h
)

19 
x
 = 
xSèπ
 + 
xMove
;

20 
y
 = 
ySèπ
 + 
yMove
;

21 i‡(
x
 >
w
)

22 
x
 = 
w
 - 1;

23 i‡(
y
 >
h
)

24 
y
 = 
h
 - 1;

25 i‡(
x
 < 0)

26 
x
 = 0;

27 i‡(
y
 < 0)

28 
y
 = 0;

29  
	`m©h_öçaú_¸óã
(
x
, 
y
);

30 
	}
}

31 
I¡Paú
 
	$m©h_grid_move_dúe˘i⁄_wøµed
(
I¡Paú
 
pos
, I¡Paú 
move
, I¡Paú 
dimísi⁄s
)

33 
x
 = 
pos
.x + 
move
.x;

34 
y
 = 
pos
.y + 
move
.y;

35 
x
 = x % 
dimísi⁄s
.x;

36 
y
 = y % 
dimísi⁄s
.y;

37 i‡(
x
 < 0)

38 
x
 +
dimísi⁄s
.x;

39 i‡(
y
 < 0)

40 
y
 +
dimísi⁄s
.y;

41  
	`m©h_öçaú_¸óã
(
x
, 
y
);

42 
	}
}

43 
I¡Paú
 
	$m©h_grid_move_dúe˘i⁄_wøµed
(
xSèπ
, 
ySèπ
, 
xMove
, 
yMove
, 
w
, 
h
)

45 
x
 = 
xSèπ
 + 
xMove
;

46 
y
 = 
ySèπ
 + 
yMove
;

47 
x
 = x % 
w
;

48 
y
 = y % y;

49 i‡(
x
 < 0)

50 
x
 +
w
;

51 i‡(
y
 < 0)

52 
y
 +
h
;

53  
	`m©h_öçaú_¸óã
(
x
, 
y
);

54 
	}
}

	@HelperGL.cpp

1 
	~"Hñ≥rGL.h
"

3 
	$gl_gíî©e_™d_böd_VAO
(
GLuöt
* 
loˇti⁄
)

5 
	`glGíVîãxAºays
(1, 
loˇti⁄
);

6 
	`glBödVîãxAºay
(*
loˇti⁄
);

7 
	}
}

9 
	$gl_£tup_deÁu…s
()

12 
	}
}

14 
	$gl_£tup_öt_vîãx
(
GLuöt
* 
buf„r
, GLuöà
gl_©åib_loˇti⁄
, 
ve˘‹_size
, 
max_buf„r_Àngth
)

16 i‡(
ve˘‹_size
 <= 0 || vector_size > 4)

18 
	`¸ash_îr
("öc‹ª˘ly cÆÀd gl_£tup_vîãx wôhá ve˘‹ sizêo‡" + 
ve˘‹_size
);

20 
	`glGíBuf„rs
(1, 
buf„r
);

21 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, *
buf„r
);

22 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (Ë* 
ve˘‹_size
 * 
max_buf„r_Àngth
, 
NULL
, 
GL_DYNAMIC_DRAW
);

24 
	`glVîãxAâribPoöãr
(
gl_©åib_loˇti⁄
, 
ve˘‹_size
, 
GL_FLOAT
, 
Ál£
, vector_size * (), (*)0);

25 
	`glE«bÀVîãxAâribAºay
(
gl_©åib_loˇti⁄
);

26 
	`glVîãxAâribDivis‹
(
gl_©åib_loˇti⁄
, 1);

27 
	}
}

29 
	$gl_£tup_Êﬂt_vîãx
(
GLuöt
* 
buf„r
, GLuöà
gl_©åib_loˇti⁄
, 
ve˘‹_size
, 
max_buf„r_Àngth
)

31 i‡(
ve˘‹_size
 <= 0 || vector_size > 4)

33 
	`¸ash_îr
("öc‹ª˘ly cÆÀd gl_£tup_vîãx wôhá ve˘‹ sizêo‡" + 
ve˘‹_size
);

35 
	`glGíBuf„rs
(1, 
buf„r
);

36 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, *
buf„r
);

37 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (Ë* 
ve˘‹_size
 * 
max_buf„r_Àngth
, 
NULL
, 
GL_DYNAMIC_DRAW
);

39 
	`glVîãxAâribPoöãr
(
gl_©åib_loˇti⁄
, 
ve˘‹_size
, 
GL_FLOAT
, 
Ál£
, vector_size * (), (*)0);

40 
	`glE«bÀVîãxAâribAºay
(
gl_©åib_loˇti⁄
);

41 
	`glVîãxAâribDivis‹
(
gl_©åib_loˇti⁄
, 1);

42 
	}
}

44 
	$gl_check_îr
(c⁄° * 
fûíame
, 
löe
)

46 
îr‹_check
 = 
	`glGëEº‹
();

47 i‡(
îr‹_check
 != 0)

48 
°d
::
cout
 << "wêhavê¥odu˚dá¿›íGLÉº‹ o¿löe" << 
löe
 << " , i¿fûê" << 
fûíame
 << "bëã∏check iàout." << 
îr‹_check
 << std::
ídl
;

49 
	}
}

	@HelperGL.h

1 #¥agm®
⁄˚


3 
	~"C⁄°™ts.h
"

4 
	~<gœd\gœd.h
>

5 
	~"Mem‹y.h
"

6 
	~"glm/glm.hµ
"

8 
gl_gíî©e_™d_böd_VAO
(
GLuöt
* 
loˇti⁄
);

10 
gl_£tup_deÁu…s
();

11 
gl_£tup_öt_vîãx
(
GLuöt
* 
buf„r
, GLuöà
gl_©åib_loˇti⁄
, 
ve˘‹_size
, 
max_buf„r_Àngth
);

12 
gl_£tup_Êﬂt_vîãx
(
GLuöt
* 
buf„r
, GLuöà
gl_©åib_loˇti⁄
, 
ve˘‹_size
, 
max_buf„r_Àngth
);

13 
	#CHK
 dÿ{
	`gl_check_îr
(
__FILE__
,
__LINE__
);} 0);

	)

15 
gl_check_îr
(c⁄° * 
fûíame
, 
löe
);

	@IntPair.cpp

1 
	~"M©h.h
"

3 
Dúe˘i⁄
 
	$dúe˘i⁄_ªvî£
(
Dúe˘i⁄
 
dú
)

5 i‡(
dú
 =
Dúe˘i⁄
::
U
)

6  
Dúe˘i⁄
::
D
;

7 i‡(
dú
 =
Dúe˘i⁄
::
L
)

8  
Dúe˘i⁄
::
R
;

9 i‡(
dú
 =
Dúe˘i⁄
::
D
)

10  
Dúe˘i⁄
::
U
;

11 i‡(
dú
 =
Dúe˘i⁄
::
R
)

12  
Dúe˘i⁄
::
L
;

13  
dú
;

14 
	}
}

16 
Dúe˘i⁄
 
	$dúe˘i⁄_rŸ©e_˛ockwi£
(
Dúe˘i⁄
 
dú
) {

17 i‡(
dú
 >
NO_DIRECTION
)

18  
dú
;

19  (
Dúe˘i⁄
)((()
dú
 + 1) % 4);

20 
	}
}

22 
Dúe˘i⁄
 
	$dúe˘i⁄_rŸ©e_™ti
(
Dúe˘i⁄
 
dú
)

24 i‡(
dú
 =
Dúe˘i⁄
::
U
)

25  
Dúe˘i⁄
::
L
;

26 i‡(
dú
 =
Dúe˘i⁄
::
L
)

27  
Dúe˘i⁄
::
D
;

28 i‡(
dú
 =
Dúe˘i⁄
::
D
)

29  
Dúe˘i⁄
::
R
;

30 i‡(
dú
 =
Dúe˘i⁄
::
R
)

31  
Dúe˘i⁄
::
U
;

32  
dú
;

33 
	}
}

35 
I¡Paú
 
	$m©h_öçaú_¸óã
(
x
, 
y
)

37 
I¡Paú
 
ªsu…
;

38 
ªsu…
.
x
 = x;

39 
ªsu…
.
y
 = y;

40  
ªsu…
;

41 
	}
}

42 
I¡Paú
 
	$m©h_öçaú_add
(
I¡Paú
 
À·
, I¡Paú 
right
)

44 
I¡Paú
 
ªsu…
;

45 
ªsu…
.
x
 = 
À·
.x + 
right
.x;

46 
ªsu…
.
y
 = 
À·
.y + 
right
.y;

47  
ªsu…
;

48 
	}
}

49 
I¡Paú
 
	$m©h_öçaú_sub
(
I¡Paú
 
À·
, I¡Paú 
right
)

51 
I¡Paú
 
ªsu…
;

52 
ªsu…
.
x
 = 
À·
.x - 
right
.x;

53 
ªsu…
.
y
 = 
À·
.y - 
right
.y;

54  
ªsu…
;

55 
	}
}

57 
boﬁ
 
	$m©h_öçaú_eq
(
I¡Paú
 
À·
, I¡Paú 
right
)

59  
À·
.
x
 =
right
.x &&Üe·.
y
 ==Ñight.y;

60 
	}
}

	@MainHelpers.h

1 #¥agm®
⁄˚


2 
	~<c°rög
>

3 
	~"GameSèã.h
"

4 
	~"M©h.h
"

5 
	~"Shadî.h
"

6 
	~"Edô‹.h
"

7 
	~<io°ªam
>

8 
	~"Resour˚.h
"

9 
	~<SDL.h
>

10 
	~"Click.h
"

11 
	~"TrueF⁄tCh¨a˘î.h
"

12 
	~<·2buûd.h
>

13 
	~"P¨£.h
"

14 
	~"W‹ld.h
"

15 
	~"Anim©i⁄.h
"

16 
	~"TextDøw.h
"

17 
	~"Hñ≥rGL.h
"

18 
	~"døw.h
"

19 #ö˛udê
FT_FREETYPE_H


23 
	sPœyS˚√


25 
Game°©eTimeMachöe
* 
	mtimeMachöe
;

26 
Game°©eTimeMachöe
* 
	mtimeMachöe_edô
;

27 
I¡Paú
 
	mloc
;

28 
I¡Paú
 
	mloc_edô
;

29 
	mgame_«me_Àngth
;

30 
	mgame_«me
[
GAME_LEVEL_NAME_MAX_SIZE
];

31 
	medô‹_posôi⁄_ö_time_machöe
;

36 
	sGame•rôeDøwInfo
 {

37 
	mglm
::
vec4
* 
Êo‹_©œs_˝u
;

38 
	mglm
::
vec3
* 
Êo‹_posôi⁄s_˝u
;

39 * 
	mÊo‹_tŸÆ_døwn
;

40 
	mglm
::
vec4
* 
Êo‹_©œs_m≠≥r
;

41 
	mglm
::
vec4
* 
põ˚_©œs_˝u
;

42 
	mglm
::
vec3
* 
põ˚_posôi⁄s_˝u
;

43 * 
	mpõ˚_tŸÆ_døwn
;

44 
	mglm
::
vec4
* 
põ˚_©œs_m≠≥r
;

56 
GameS∑˚Camîa
 
m©h_ˇmîa_buûd_f‹_game°©e
(
GameSèã
* 
game°©e
, 
I¡Paú
 
posôi⁄
, 
VõwP‹tCamîa
 
võwp‹t
, 
x_∑ddög
 = 4, 
y_∑ddög
 = 3);

61 
èke_∂ayî_a˘i⁄
(
Game°©eTimeMachöe
* 
maybe_time_machöe
, 
I¡Paú
 
døw_posôi⁄
, 
Edô‹UISèã
* 
ui_°©e
, 
Dúe˘i⁄
 
a˘i⁄
, 
Mem‹y
* 
Àvñ_mem‹y
, Mem‹y* 
‰ame_mem‹y
, Mem‹y* 
™im©i⁄_mem‹y
);

64 
boﬁ
 
MaybeAµlyBrush
(
Game°©eBrush
* 
∑Àã
, 
cuºítBrush
, 
Edô‹UISèã
* 
ui_°©e
, 
TimeMachöeEdô‹
* 
timeMachöe
, 
glm
::
vec2
 
mou£GamePos
);

65 
boﬁ
 
MaybeAµlyBrushInPœyMode
(
Mem‹y
* 
mem‹y
, 
Game°©eBrush
* 
∑Àã
, 
cuºít_brush
, 
Edô‹UISèã
* 
ui_°©e
, 
Game°©eTimeMachöe
* 
time_machöe
, 
I¡Paú
 
cuºít_°©e_pos
, 
glm
::
vec2
 
mou£GamePos
);

69 
AABB
 
ˇlcuœã_ouéöe_‰om_¸óã_öfo
(
Mem‹y
* 
‰ame_mem‹y
, 
TimeMachöeEdô‹
* 
timeMachöe
, 
Edô‹UISèã
 
ui_°©e
);

70 
AABB
 
ˇlcuœã_ouéöe_posôi⁄_‰om_døg_öfo
(
Mem‹y
* 
‰ame_mem‹y
,

71 
TimeMachöeEdô‹
* 
timeMachöe
,

72 
Edô‹UISèã
 
ui_°©e
,

73 
glm
::
vec2
 
døggög_°¨t_posôi⁄_ö_game•a˚
);

74 
AABB
 
ˇlcuœã_ouéöe_‰om_move_öfo
(
Mem‹y
* 
‰ame_mem‹y
, 
TimeMachöeEdô‹
* 
timeMachöe
, 
Edô‹UISèã
 
ui_°©e
);

	@Math.h

1 #¥agm®
⁄˚


3 
	~"Mem‹y.h
"

4 
	~"glm/glm.hµ
"

5 
	~"glm/gtc/m©rix_å™sf‹m.hµ
"

10 
	sGameS∑˚Camîa


12 
	mÀ·
;

13 
	mright
;

14 
	mup
;

15 
	mdown
;

16 
	m˛o£Poöt
;

17 
	mÁrPoöt
;

21 
	sVõwP‹tCamîa


23 
	mÀ·
;

24 
	mright
;

25 
	mup
;

26 
	mdown
;

28 
	sI¡Paú


30 
	mx
;

31 
	my
;

33 
	eDúe˘i⁄
 {

34 
	mU
, 
	mR
, 
	mD
, 
	mL
, 
	mNO_DIRECTION
, 
	mDIRECTION_COUNT


36 
Dúe˘i⁄
 
dúe˘i⁄_ªvî£
(Dúe˘i⁄ 
dú
);

37 
Dúe˘i⁄
 
dúe˘i⁄_rŸ©e_˛ockwi£
(Dúe˘i⁄ 
dú
);

38 
Dúe˘i⁄
 
dúe˘i⁄_rŸ©e_™ti
(Dúe˘i⁄ 
dú
);

39 
I¡Paú
 
m©h_öçaú_¸óã
(
x
, 
y
);

40 
I¡Paú
 
m©h_öçaú_add
(I¡Paú 
À·
, I¡Paú 
right
);

41 
I¡Paú
 
m©h_öçaú_sub
(I¡Paú 
À·
, I¡Paú 
right
);

42 
boﬁ
 
m©h_öçaú_eq
(
I¡Paú
 
À·
, I¡Paú 
right
);

44 
ˇmîa_øtio
(
VõwP‹tCamîa
 
võwp‹t
);

45 
	gglm
::
m©4
 
ˇmîa_make_m©rix
(
GameS∑˚Camîa
 
ˇmîa
);

46 
GameS∑˚Camîa
 
m©h_ˇmîa_move_tow¨ds_ÀΩ
(GameS∑˚Camî®
movög
, GameS∑˚Camî®
gﬂl
, 
cuºít_time
, 
gﬂl_time
);

47 
GameS∑˚Camîa
 
m©h_ˇmîa_buûd
(
ˇmîa_height
, 
s¸ìn_˚¡î_x
, 
s¸ìn_˚¡î_y
, 
VõwP‹tCamîa
 
võwp‹t
);

48 
m©h_pixñ•a˚_to_game•a˚_mu…ùlõr
(
VõwP‹tCamîa
 
võw
, 
gameHeight
);

49 
m©h_game•a˚_to_pixñ•a˚_mu…ùlõr
(
VõwP‹tCamîa
 
võw
, 
gameHeight
);

50 
	gglm
::
vec2
 
m©h_s¸ìn•a˚_to_pixñ•a˚
(
I¡Paú
 
s¸ìnS∑˚Posôi⁄
, 
GameS∑˚Camîa
 
ˇmîa
, 
VõwP‹tCamîa
 
võw
, 
gameHeight
);

51 
	gglm
::
vec2
 
m©h_pixñ•a˚_to_s¸ìn•a˚
(
I¡Paú
 
pixñS∑˚Posôi⁄
, 
GameS∑˚Camîa
 
ˇmîa
, 
VõwP‹tCamîa
 
võw
, 
gameHeight
);

52 
	gglm
::
vec2
 
m©h_s¸ìn•a˚_to_game•a˚
(
I¡Paú
 
s¸ìnS∑˚Posôi⁄
, 
GameS∑˚Camîa
 
ˇmîa
, 
VõwP‹tCamîa
 
võw
, 
gameHeight
);

57 
	gglm
::
m©4
 
m©h_å™¶©ed_m©rix
(
glm
::
vec3
 
å™¶©e
);

58 
	gglm
::
m©4
 
m©h_å™¶©ed_sˇÀd_m©rix
(
glm
::
vec3
 
å™¶©e
, glm::vec3 
sˇÀ
);

63 
	eSide


65 
	mS_RIGHT
,

66 
	mS_DOWN
,

67 
	mS_LEFT
,

68 
	mS_UP
,

69 
	mS_COUNT


72 
I¡Paú
 
m©h_side_to_dúe˘i⁄
(
Side
 
s
);

73 
Side
 
m©h_side_›posôe
(Sidê
s
);

74 
Side
 
m©h_dúe˘i⁄_to_side
(
I¡Paú
 
∑ú
);

79 
I¡Paú
 
m©h_grid_move_dúe˘i⁄
(I¡Paú 
pos
, I¡Paú 
move
, I¡Paú 
dimísi⁄s
);

80 
I¡Paú
 
m©h_grid_move_dúe˘i⁄
(
xSèπ
, 
ySèπ
, 
xMove
, 
yMove
, 
w
, 
h
);

81 
I¡Paú
 
m©h_grid_move_dúe˘i⁄_wøµed
(I¡Paú 
pos
, I¡Paú 
move
, I¡Paú 
dimísi⁄s
);

82 
I¡Paú
 
m©h_grid_move_dúe˘i⁄_wøµed
(
xSèπ
, 
ySèπ
, 
xMove
, 
yMove
, 
w
, 
h
);

84 
boﬁ
* 
m©h_grid_wÆk_adja˚¡
(
Mem‹y
* 
ªsu…_mem‹y
, Mem‹y* 
ãmp_mem‹y
, * 
öput_grid
, 
°¨t_x
, 
°¨t_y
, 
w
, 
h
);

85 
boﬁ
* 
m©h_grid_wÆk_adja˚¡_wøµed
(
Mem‹y
* 
ªsu…_mem‹y
, Mem‹y* 
ãmp_mem‹y
, * 
öput_grid
, 
°¨t_x
, 
°¨t_y
, 
w
, 
h
);

90 
	sAABB


92 
	mx
;

93 
	my
;

94 
	mw
;

95 
	mh
;

98 
AABB
 
m©h_AABB_¸óã
(
x
, 
y
, 
width
, 
height
);

99 
AABB
 
m©h_AABB_¸óã_öt
(
x
, 
y
, 
width
, 
height
);

100 
m©h_˛ick_is_öside_AABB_li°
(
˛ickX
, 
˛ickY
, 
AABB
* 
boxes
, 
tŸÆ_boxes
);

102 
boﬁ
 
m©h_AABB_is_cﬁlidög
(
AABB
 
ã°
, AABB* 
agaö°_¨øy
, 
Àngth
);

103 
m©h_AABB_bªak_öto_b‹dîs
(
AABB
 
box
, AABB* 
ouçut
, 
b‹dî_size
);

105 
ölöe
 
boﬁ
 
	$m©h_˛ick_is_öside_AABB
(
˛ickX
, 
˛ickY
, 
AABB
 
box
)

107  
˛ickX
 >
box
.
x
 && clickX < (box.x + box.
w
Ë&& 
˛ickY
 >box.
y
 && clickY < (box.y + box.
h
);

108 
	}
}

109 
ölöe
 
	$≥r˚¡_bëwìn_two_poöts
(
poöt
, 
möi
, 
maxi
)

111  (
poöt
 - 
möi
Ë/ (
maxi
 - mini);

112 
	}
}

113 
ölöe
 
boﬁ
 
	$m©h_˛ick_is_öside_AABB
(
À·
, 
bŸtom
, 
right
, 
t›
, 
˛ickX
, 
˛ickY
)

115  
˛ickX
 >
À·
 && clickX < 
right
 && 
˛ickY
 >
bŸtom
 && clickY < 
t›
;

116 
	}
}

117 
ölöe
 
boﬁ
 
	$m©h_˛ick_is_öside_AABB
(
I¡Paú
 
möi
, I¡Paú 
maxi
, I¡Paú 
˛ick
)

119  
˛ick
.
x
 >
möi
.x && click.x <
maxi
.x && click.
y
 >= mini.y && click.y <= maxi.y;

120 
	}
}

133 
ölöe
 
	$f2D
(
x
, 
y
, 
w
, 
h
)

135  
y
 + 
x
 * 
h
;

136 
	}
}

139 
ölöe
 
I¡Paú
 
	$t2D
(
i
, 
w
, 
h
)

141 
I¡Paú
 
ªsu…
;

142 
ªsu…
.
x
 = 
i
 / 
h
;

143 
ªsu…
.
y
 = 
i
 % 
h
;

144  
ªsu…
;

145 
	}
}

147 
ölöe
 
boﬁ
 
	$m©h_wôhö_grid
(
x
, 
y
, 
w
, 
h
)

149  
x
 >0 && 
y
 >0 && x < 
w
 && y < 
h
;

150 
	}
}

153 
ölöe
 
	$ÀΩf
(
À·
, 
right
, 
t
)

155  
À·
 * (1.0‡- 
t
Ë+ 
right
 *Å;

156 
	}
}

157 
ölöe
 
	$˛ampf
(
mö
, 
max
, 
v
)

159 i‡(
v
 < 
mö
)

160  
mö
;

161 i‡(
v
 > 
max
)

162  
max
;

163  
v
;

164 
	}
}

165 
ölöe
 
	$maxf
(
x
, 
y
) {

166 i‡(
x
 < 
y
)

167  
y
;

168  
x
;

169 
	}
}

170 
ölöe
 
	$möf
(
x
, 
y
)

172 i‡(
x
 < 
y
)

173  
x
;

174  
y
;

175 
	}
}

176 
ölöe
 
	$maxi
(
x
, 
y
)

178 i‡(
x
 >
y
)

179  
x
;

180  
y
;

181 
	}
}

182 
ölöe
 
	$möi
(
x
, 
y
)

184 i‡(
x
 <
y
)

185  
x
;

186  
y
;

187 
	}
}

189 
ölöe
 
	$sign
(
x
)

191 i‡(
x
 > 0)

193 i‡(
x
 < 0)

196 
	}
}

	@Maths.h

1 #¥agm®
⁄˚


3 
	svec2


5 
	mx
;

6 
	my
;

9 
	svec3


11 
	mx
;

12 
	my
;

13 
	mz
;

16 
	svec4


18 
	mx
;

19 
	my
;

20 
	mz
;

21 
	mw
;

	@Memory.cpp

1 
	~<°dlib.h
>

2 
	~<io°ªam
>

3 
	~"C⁄°™ts.h
"

4 c⁄° 
	gÆignBound¨y
 = 8;

6 
	sMem‹y


8 
	mcuºítOff£t
;

9 
	msize
;

10 * 
	mmem‹ySèπ
;

13 * 
	$mem‹y_Æloc
(
Mem‹y
* 
mem‹y
, 
numByãs
)

15 
byãsToAddToMem‹yToC⁄£rveAlignmít
 = (
ÆignBound¨y
 - (
numByãs
 %álignBoundary)) %álignBoundary;

16 
föÆByãs
 = 
numByãs
 + 
byãsToAddToMem‹yToC⁄£rveAlignmít
;

19 i‡(
föÆByãs
 + 
mem‹y
->
cuºítOff£t
 >mem‹y->
size
)

21 
	`¸ash_îr
("we have overflowed our memory. Rats!");

22  
nuŒ±r
;

24 * 
ªsu…
 = (*Ë(((*Ë
mem‹y
->
mem‹ySèπ
Ë+ mem‹y->
cuºítOff£t
);

25 
mem‹y
->
cuºítOff£t
 +
föÆByãs
;

26  
ªsu…
;

27 
	}
}

28 
	$mem‹y_˛ór
(
Mem‹y
* 
mem‹y
)

30 
mem‹y
->
cuºítOff£t
 = 0;

31 
	}
}

32 
Mem‹y
* 
	$mem‹y_¸óã
(
numByãs
)

34 
size
 = (
Mem‹y
);

35 
Mem‹y
* 
mem‹y
 = (Mem‹y*Ë
	`mÆloc
(
size
);

36 
mem‹y
->
cuºítOff£t
 = 0;

37 
mem‹y
->
size
 = 
numByãs
;

38 
mem‹y
->
mem‹ySèπ
 = 
	`mÆloc
(
numByãs
);

39  
mem‹y
;

40 
	}
}

42 
	$mem‹y_p›_°ack
(
Mem‹y
* 
mem‹y
, * 
poöãr
)

45 * 
±r_c‹e
 = (*Ë
mem‹y
->
mem‹ySèπ
;

46 * 
±r_biggî
 = (*Ë
poöãr
;

47 
di°™˚
 = (Ë(
±r_biggî
 - 
±r_c‹e
);

48 
ªsu…
 = (Ë
di°™˚
;

49 
mem‹y
->
cuºítOff£t
 -
di°™˚
;

50 
	}
}

	@Memory.h

1 #¥agm®
⁄˚


3 
	gMem‹y
;

8 
	gãm∂©e
<
˛ass
 
	gT
>

9 
T
* 
	$mem_Æloc
(
Mem‹y
* 
mem‹y
, 
num_ñemíts
)

11  (
T
*)
	`mem‹y_Æloc
(
mem‹y
, (TË* 
num_ñemíts
);

12 
	}
}

14 * 
mem‹y_Æloc
(
Mem‹y
* 
mem‹y
, 
numByãs
);

15 
mem‹y_˛ór
(
Mem‹y
* 
mem‹y
);

16 
mem‹y_de°roy_™nihÆ©e_g⁄e_nŸ_eví_the_poöãr_wûl_ªmaö
(
Mem‹y
* 
mem‹y
);

17 
mem‹y_p›_°ack
(
Mem‹y
*, * 
poöt_to_˛ór
);

18 
Mem‹y
* 
mem‹y_¸óã
(
numByãs
);

20 
	gSèckMem‹y
;

22 * 
mem‹y_°ack_Æloc
(
SèckMem‹y
* 
mem‹y
, 
num_byãs
);

	@MenuScene.h

1 #¥agm®
⁄˚


2 
	~<°rög
>

3 
	~"Mem‹y.h
"

4 
	~"TextDøw.h
"

5 (*
	gBuâ⁄CÆlback
)();

7 
	sMíuText


9 
GameS∑˚Camîa
 
	mdøw_¨ó
;

10 * 
	mãxt
;

12 
	sMíuBuâ⁄


14 
GameS∑˚Camîa
 
	mdøw_¨ó
;

15 * 
	mbuâ⁄_ãxt
;

16 
Buâ⁄CÆlback
 
	mˇŒback
;

18 
	sMíuS˚√


20 
	mnum_buâ⁄s
;

21 
	mcuºít_highlighãd_buâ⁄
;

22 
MíuBuâ⁄
* 
	mbuâ⁄s
;

26 * 
	$ch¨_Æloc
(
Mem‹y
* 
mem‹y
, 
°d
::
°rög
 
to_Æloc
)

28 
Àngth
 = 
to_Æloc
.
	`Àngth
() + 1;

29 * 
ªsu…
 = (*Ë
	`mem‹y_Æloc
(
mem‹y
, (Ë* 
Àngth
);

30 
i
 = 0; i < 
to_Æloc
.
	`Àngth
(); i++)

31 
ªsu…
[
i
] = 
to_Æloc
[i];

32 
ªsu…
[
to_Æloc
.
	`Àngth
()] = 
NULL
;

33  
ªsu…
;

34 
	}
}

35 
MíuS˚√
* 
	$£tup_maö_míu
(
Mem‹y
* 
míu_mem‹y
, 
Buâ⁄CÆlback
 
√w_game
, Buâ⁄CÆlback 
c⁄töue_game
, Buâ⁄CÆlback 
Àvñ_edô‹
)

37 
	`mem‹y_˛ór
(
míu_mem‹y
);

39 
MíuS˚√
* 
ªsu…
 = (MíuS˚√*Ë
	`mem‹y_Æloc
(
míu_mem‹y
, (MenuScene));

40 
ªsu…
->
num_buâ⁄s
 = 3;

41 
ªsu…
->
cuºít_highlighãd_buâ⁄
 = 1;

42 
ªsu…
->
buâ⁄s
 = (
MíuBuâ⁄
*Ë
	`mem‹y_Æloc
(
míu_mem‹y
, (MenuButton) * 3);

43 * 
fú°
 = 
	`ch¨_Æloc
(
míu_mem‹y
, "New Game");

44 
ªsu…
->
buâ⁄s
[0].
buâ⁄_ãxt
 = 
fú°
;

45 
ªsu…
->
buâ⁄s
[1].
buâ⁄_ãxt
 = 
	`ch¨_Æloc
(
míu_mem‹y
,"Continuey");

46 
ªsu…
->
buâ⁄s
[2].
buâ⁄_ãxt
 = 
	`ch¨_Æloc
(
míu_mem‹y
,"Level Editor");

47 
ªsu…
->
buâ⁄s
[0].
ˇŒback
 = 
√w_game
;

48 
ªsu…
->
buâ⁄s
[1].
ˇŒback
 = 
c⁄töue_game
;

49 
ªsu…
->
buâ⁄s
[2].
ˇŒback
 = 
Àvñ_edô‹
;

51  
ªsu…
;

52 
	}
}

	@Parse.cpp

1 
	~"P¨£.h
"

2 
	~<io°ªam
>

3 #ifde‡
EMSCRIPTEN


4 
	#•rötf_s
(
¨gs1
,
¨gs2
,...Ë
	`•rötf
◊rgs1,
__VA_ARGS__
)

	)

6 
	$di°™˚_to_ch¨
(c⁄° * 
pos
, c⁄° 
m©ch
)

8 
i
 = 0;

9 ; 
pos
[0] !
m©ch
 ||Öos[0] == '\0';Öos++)

11 
i
++;

13  
i
;

14 
	}
}

16 
	$∑r£_numbî
(c⁄° * 
pos
)

18 
ªsu…
 = 0;

19 ; 
pos
[0] >= '0' &&Öos[0] <= '9';Öos++)

21 
ªsu…
 *= 10;

22 
to_add
 = 
pos
[0] - '0';

23 
ªsu…
 +
to_add
;

25  
ªsu…
;

26 
	}
}

27 
boﬁ
 
	$∑r£_°rögs_m©ch
(c⁄° * 
pos
, c⁄° * 
m©ch
, 
max_Àngth
)

29 
i
 = 0; i < 
max_Àngth
; i++, 
pos
++, 
m©ch
++)

31 i‡(
pos
[0] !
m©ch
[0])

32  
Ál£
;

34  
åue
;

35 
	}
}

37 
	$to_num
(
c
)

39  
c
 - '0';

40 
	}
}

42 
boﬁ
 
	$is_num_n⁄zîo
(
c
)

44  
c
 >= '1' && c <= '9';

45 
	}
}

47 
boﬁ
 
	$is_num
(
c
)

49  
c
 >= '0' && c <= '9';

50 
	}
}

52 
boﬁ
 
	$is_whôe•a˚
(
c
)

54  
c
 == ' ' || c == '\t' || c == '\n' || c == '\v' || c == '\f' || c == '\r';

55 
	}
}

57 * 
	$åy_∑r£_numbî
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
)

59 * 
ªsu…
 = (*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, ());

60 * 
⁄_Áû
 = 
t
->
©
;

61 i‡(
t
->
©
[0] == '0')

63 
t
->
©
++;

64 *
ªsu…
 = 0;

65  
ªsu…
;

67 
boﬁ
 
√g©ive_numbî
 = 
Ál£
;

68 i‡(
t
->
©
[0] == '-')

70 
t
->
©
++;

71 
√g©ive_numbî
 = 
åue
;

73 i‡(
	`is_num_n⁄zîo
(
t
->
©
[0]))

75 
num
 = 
	`to_num
(
t
->
©
[0]);

76 
t
->
©
++;

77 
	`is_num
(
t
->
©
[0]))

79 
num
 *= 10;

80 
num
 +
	`to_num
(
t
->
©
[0]);

81 
t
->
©
++;

83 *
ªsu…
 = 
num
;

84 i‡(
√g©ive_numbî
)

85 *
ªsu…
 = -(*result);

86  
ªsu…
;

89 
t
->
©
 = 
⁄_Áû
;

90  
NULL
;

91 
	}
}

93 
boﬁ
 
	$åy_∑r£_°rög
(
Tokíizî
* 
t
, c⁄° * 
«me
)

95 * 
Áû_ªsu…
 = 
t
->
©
;

97 
t
->
©
[0] && 
«me
[0])

99 i‡(
t
->
©
[0] !
«me
[0])

101 
t
->
©
 = 
Áû_ªsu…
;

102  
Ál£
;

104 
t
->
©
++;

105 
«me
++;

108 i‡(
t
->
©
[0])

110  
åue
;

114 
t
->
©
 = 
Áû_ªsu…
;

115  
Ál£
;

117 
	}
}

119 
boﬁ
 
	$åy_∑r£_ch¨
(
Tokíizî
* 
t
, 
c
)

121 i‡(
t
->
©
[0] =
c
)

123 
t
->
©
++;

124  
åue
;

126  
Ál£
;

127 
	}
}

129 * 
	$åy_∑r£_numbî_ch¨_∑ú
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
, 
c
)

131 * 
⁄_Áû
 = 
t
->
©
;

132 * 
ªsu…
 = 
	`åy_∑r£_numbî
(
t
, 
ãmp_mem‹y
);

133 
boﬁ
 
ch¨_a·î
 = 
	`åy_∑r£_ch¨
(
t
, 
c
);

134 i‡(
ch¨_a·î
 && 
ªsu…
)

136  
ªsu…
;

138 
t
->
©
 = 
⁄_Áû
;

139  
NULL
;

141 
	}
}

142 * 
	$åy_∑r£_numbî_comma_∑ú
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
)

144 * 
⁄_Áû
 = 
t
->
©
;

145 * 
ªsu…
 = 
	`åy_∑r£_numbî
(
t
, 
ãmp_mem‹y
);

146 
boﬁ
 
comma_a·î
 = 
	`åy_∑r£_ch¨
(
t
, ',');

147 i‡(
comma_a·î
 && 
ªsu…
)

149  
ªsu…
;

151 
t
->
©
 = 
⁄_Áû
;

152  
NULL
;

154 
	}
}

155 * 
	$åy_∑r£_numbî_dash_∑ú
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
)

157 * 
⁄_Áû
 = 
t
->
©
;

158 * 
ªsu…
 = 
	`åy_∑r£_numbî
(
t
, 
ãmp_mem‹y
);

159 
boﬁ
 
comma_a·î
 = 
	`åy_∑r£_ch¨
(
t
, '_');

160 i‡(
comma_a·î
 && 
ªsu…
)

162  
ªsu…
;

164 
t
->
©
 = 
⁄_Áû
;

165  
NULL
;

167 
	}
}

168 
Flo‹D©a
* 
	$åy_∑r£_Êo‹_d©a
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
)

171 * 
⁄_Áû
 = 
t
->
©
;

172 
Flo‹D©a
* 
ªsu…
 = (Flo‹D©a*Ë
	`mem‹y_Æloc
(
ãmp_mem‹y
, (FloorData));

173 
num_vÆ
 = 0;

174 * 
fú°
 = 
	`åy_∑r£_numbî_ch¨_∑ú
(
t
, 
ãmp_mem‹y
,'-');

175 * 
£c⁄d
 = 
	`åy_∑r£_numbî_ch¨_∑ú
(
t
, 
ãmp_mem‹y
,'-');

176 * 
thúd
 = 
	`åy_∑r£_numbî
(
t
, 
ãmp_mem‹y
);

177 i‡(!
fú°
 || !
£c⁄d
 || !
thúd
)

179 
t
->
©
 = 
⁄_Áû
;

180  
NULL
;

182 
ªsu…
->
ãÀp‹ãr_id
 = *
fú°
;

183 
ªsu…
->
ãÀp‹ãr_èrgë_squ¨e
.
x
 = *
£c⁄d
;

184 
ªsu…
->
ãÀp‹ãr_èrgë_squ¨e
.
y
 = *
thúd
;

186 
boﬁ
 
found_comma
 = 
	`åy_∑r£_ch¨
(
t
, ',');

187 i‡(!
found_comma
)

189 
	`¸ash_îr
("parsing floor dataÉrror with comma");

191  
ªsu…
;

192 
	}
}

193 
Põ˚D©a
* 
	$åy_∑r£_põ˚_d©a
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
)

195 * 
⁄_Áû
 = 
t
->
©
;

196 
Põ˚D©a
* 
ªsu…
 = (Põ˚D©a*Ë
	`mem‹y_Æloc
(
ãmp_mem‹y
, (PieceData));

197 
num_vÆ
 = 0;

198 * 
√xt_vÆ
 = 
	`åy_∑r£_numbî_dash_∑ú
(
t
, 
ãmp_mem‹y
);

199 i‡(!
√xt_vÆ
)

201 
t
->
©
 = 
⁄_Áû
;

202  
NULL
;

204 
√xt_vÆ
)

206 
ªsu…
->
powîs
[
num_vÆ
] = *
√xt_vÆ
;

207 
√xt_vÆ
 = 
	`åy_∑r£_numbî_dash_∑ú
(
t
, 
ãmp_mem‹y
);

208 
num_vÆ
++;

210 
boﬁ
 
found_comma
 = 
	`åy_∑r£_ch¨
(
t
, ',');

211 i‡(!
found_comma
)

213 
	`¸ash_îr
("parsingÖiece dataÉrror with comma");

215  
ªsu…
;

217 
	}
}

218 
	$c⁄sume_whôe•a˚
(
Tokíizî
* 
t
)

220 
	`is_whôe•a˚
(
t
->
©
[0]))

221 
t
->
©
++;

222 
	}
}

224 * 
	$åy_∑r£_cuºít_Àvñ
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
)

226 * 
⁄_Áû
 = 
t
->
©
;

227 
boﬁ
 
∑r£_föished
 = 
Ál£
;

228 
boﬁ
 
found_num_game°©es
 = 
	`åy_∑r£_°rög
(
t
, "current_level:");

229 i‡(
found_num_game°©es
)

231 * 
maybe_num
 = 
	`åy_∑r£_numbî
(
t
, 
ãmp_mem‹y
);

232 
	`åy_∑r£_ch¨
(
t
, ';');

233 i‡(
maybe_num
)

235  
maybe_num
;

239 
	`¸ash_îr
("we failedÅoÖarseÅhe currentÜevel value, when we'dálready foundÅhe current_levelÅag, uh oh.");

242 
t
->
©
 = 
⁄_Áû
;

243  
NULL
;

244 
	}
}

245 * 
	$åy_∑r£_num_game°©es
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
)

247 * 
⁄_Áû
 = 
t
->
©
;

249 
boﬁ
 
∑r£_föished
 = 
Ál£
;

251 
boﬁ
 
found_num_game°©es
 = 
	`åy_∑r£_°rög
(
t
, "num_gamestates:");

252 i‡(
found_num_game°©es
)

254 * 
maybe_num
 = 
	`åy_∑r£_numbî
(
t
, 
ãmp_mem‹y
);

255 
	`åy_∑r£_ch¨
(
t
, ';');

256 i‡(
maybe_num
)

258  
maybe_num
;

262 
°d
::
cout
 << "FaûedÅÿªadÇumbî o‡game°©e†numbî. OhÇo! Wê¸ashögÇow,Åhi†i†ªÆ bad." << std::
ídl
;

263 
	`ab‹t
();

267 
t
->
©
 = 
⁄_Áû
;

268  
NULL
;

270 
	}
}

272 
boﬁ
 
	$åy_∑r£_posôi⁄s
(
Tokíizî
* 
t
, 
I¡Paú
 * 
ªsu…
, 
Mem‹y
* 
ãmp_mem‹y
)

274 * 
⁄_Áû
 = 
t
->
©
;

275 
boﬁ
 
found_posôi⁄s
 = 
	`åy_∑r£_°rög
(
t
, "positions:");

276 i‡(
found_posôi⁄s
)

278 
boﬁ
 
ªached_íd
 = 
	`åy_∑r£_ch¨
(
t
, ';');

279 
num_posôi⁄s_∑r£d
 = 0;

280 !
ªached_íd
)

282 * 
√xtW
 = 
	`åy_∑r£_numbî_comma_∑ú
(
t
, 
ãmp_mem‹y
);

283 * 
√xtH
 = 
	`åy_∑r£_numbî_comma_∑ú
(
t
, 
ãmp_mem‹y
);

285 i‡(!
√xtW
 || !
√xtH
)

287 
°d
::
cout
 << "okay. Okay. Wow. Ou∏posôi⁄áºay i†û»f‹m©ãd. Somëhög g⁄êwr⁄g. Bëã∏¸ash." << std::
ídl
;

288 
	`ab‹t
();

290 
ªsu…
[
num_posôi⁄s_∑r£d
].
x
 = *
√xtW
;

291 
ªsu…
[
num_posôi⁄s_∑r£d
].
y
 = *
√xtH
;

292 
num_posôi⁄s_∑r£d
++;

294 
ªached_íd
 = 
	`åy_∑r£_ch¨
(
t
, ';');

296  
åue
;

298 
t
->
©
 = 
⁄_Áû
;

299  
Ál£
;

301 
	}
}

303 
boﬁ
 
	$åy_∑r£_vîsi⁄
(
Tokíizî
* 
t
, * 
vîsi⁄_ªsu…
, 
I¡Paú
* 
ªsu…
, 
Mem‹y
* 
ãmp_mem‹y
)

305 
Tokíizî
 
Áû_ªsu…
 = *
t
;

306 
boﬁ
 
some_vÆ
 = 
	`åy_∑r£_°rög
(
t
, "version:");

308 i‡(!
some_vÆ
)

310 *
vîsi⁄_ªsu…
 = 0;

311 *
t
 = 
Áû_ªsu…
;

312  
Ál£
;

314 * 
maybe_vîsi⁄_numbî
 = 
	`åy_∑r£_numbî
(
t
, 
ãmp_mem‹y
);

315 i‡(
maybe_vîsi⁄_numbî
 =
NULL
)

317 
	`¸ash_îr
("uh oh, we'veÉncounteredá 'version:'Åag butÅhere isÇo versionÇumberáttached! ");

319 
vîsi⁄_numbî
 = *
maybe_vîsi⁄_numbî
;

320 
boﬁ
 
suc˚ed
 = 
	`åy_∑r£_ch¨
(
t
, ';');

321 i‡(!
suc˚ed
)

323 
	`¸ash_îr
("uh oh, weÅriedÅoÖarseá ';'Åo head intoÅheÇext section.Åhat didn't work.");

325  
vîsi⁄_numbî
;

327 
	}
}

329 
boﬁ
 
	$åy_∑r£_Êo‹_d©a
(
Tokíizî
* 
t
, 
GameSèã
** 
ªsu…
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
)

332 * 
⁄_Áû
 = 
t
->
©
;

333 
boﬁ
 
found_Êo‹_d©a
 = 
	`åy_∑r£_°rög
(
t
, "floor_data:");

334 i‡(
found_Êo‹_d©a
)

337 
num_game°©es
 = 0;

338 !
	`åy_∑r£_ch¨
(
t
, ';'))

340 * 
wp
 = 
	`åy_∑r£_numbî_comma_∑ú
(
t
, 
ãmp_mem‹y
);

341 * 
hp
 = 
	`åy_∑r£_numbî_comma_∑ú
(
t
, 
ãmp_mem‹y
);

342 i‡(!
wp
 || !
hp
)

344 
°d
::
cout
 << "Êo‹_d©®œyî faûed o¿∑rsög w h." << std::
ídl
;

345 
	`ab‹t
();

347 
w
 = *
wp
;

348 
h
 = *
hp
;

349 
Àn
 = 
w
 * 
h
;

350 i‡(
ªsu…
[
num_game°©es
] =
NULL
)

351 
ªsu…
[
num_game°©es
] = 
	`game°©e_¸óã
(
föÆ_mem‹y
, 
w
, 
h
);

352 
i
 = 0; i < 
Àn
; i++)

354 
Flo‹D©a
* 
√xtf
 = 
	`åy_∑r£_Êo‹_d©a
(
t
, 
ãmp_mem‹y
);

355 i‡(!
√xtf
)

357 
°d
::
cout
 << "∑r£ flo‹ d©®Áûed o¿∑rsögÇumbî." << std::
ídl
;

358 
	`ab‹t
();

360 
Flo‹D©a
 
√xt
 = *
√xtf
;

361 
ªsu…
[
num_game°©es
]->
Êo‹_d©a
[
i
] = 
√xt
;

363 
num_game°©es
++;

365  
åue
;

367  
Ál£
;

368 
	}
}

370 
boﬁ
 
	$åy_∑r£_põ˚_d©a
(
Tokíizî
* 
t
, 
GameSèã
** 
ªsu…
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
)

372 * 
⁄_Áû
 = 
t
->
©
;

373 
boﬁ
 
found_põ˚_d©a
 = 
	`åy_∑r£_°rög
(
t
, "piece_data:");

374 i‡(
found_põ˚_d©a
)

377 
num_game°©es
 = 0;

378 !
	`åy_∑r£_ch¨
(
t
, ';'))

380 * 
wp
 = 
	`åy_∑r£_numbî_comma_∑ú
(
t
, 
ãmp_mem‹y
);

381 * 
hp
 = 
	`åy_∑r£_numbî_comma_∑ú
(
t
, 
ãmp_mem‹y
);

382 i‡(!
wp
 || !
hp
)

384 
°d
::
cout
 << "∑r£Üayî faûed o¿∑rsög w h." << std::
ídl
;

385 
	`ab‹t
();

387 
w
 = *
wp
;

388 
h
 = *
hp
;

389 
Àn
 = 
w
 * 
h
;

390 i‡(
ªsu…
[
num_game°©es
] =
NULL
)

391 
ªsu…
[
num_game°©es
] = 
	`game°©e_¸óã
(
föÆ_mem‹y
, 
w
, 
h
);

392 
i
 = 0; i < 
Àn
; i++)

394 
Põ˚D©a
* 
√xç
 = 
	`åy_∑r£_põ˚_d©a
(
t
, 
ãmp_mem‹y
);

395 i‡(!
√xç
)

397 
°d
::
cout
 << "∑r£Öõ˚ d©®Áûed o¿∑rsögÇumbî." << std::
ídl
;

398 
	`ab‹t
();

400 
Põ˚D©a
 
√xt
 = *
√xç
;

401 
ªsu…
[
num_game°©es
]->
põ˚_d©a
[
i
] = 
√xt
;

404 
num_game°©es
++;

407  
åue
;

409  
Ál£
;

410 
	}
}

411 
boﬁ
 
	$åy_∑r£_œyî
(
Tokíizî
* 
t
, 
GameSèã
** 
ªsu…
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
)

413 * 
⁄_Áû
 = 
t
->
©
;

414 
boﬁ
 
is_œyî_∑r£_°¨t
 = 
	`åy_∑r£_°rög
(
t
, "layer");

415 * 
maybe_œyî_num
 = 
	`åy_∑r£_numbî
(
t
, 
ãmp_mem‹y
);

416 
boﬁ
 
is_£micﬁ⁄_©_íd
 = 
	`åy_∑r£_ch¨
(
t
, ':');

417 i‡(
is_œyî_∑r£_°¨t
 && 
maybe_œyî_num
 && 
is_£micﬁ⁄_©_íd
)

420 
œyî_num
 = *
maybe_œyî_num
;

421 i‡(
œyî_num
 >
GAME_NUM_LAYERS
)

423 
°d
::
cout
 << "wê¨êåyögÅÿwrôêtÿ®œyîÇumbîÅh© i†biggîÅh™ shouldÉxi° i¿ou∏game. CøshögÇow!" << std::
ídl
;

424 
	`ab‹t
();

428 
num_game°©es
 = 0;

429 !
	`åy_∑r£_ch¨
(
t
, ';'))

431 * 
wp
 = 
	`åy_∑r£_numbî_comma_∑ú
(
t
, 
ãmp_mem‹y
);

432 * 
hp
 = 
	`åy_∑r£_numbî_comma_∑ú
(
t
, 
ãmp_mem‹y
);

433 i‡(!
wp
 || !
hp
)

435 
°d
::
cout
 << "∑r£Üayî faûed o¿∑rsög w h." << std::
ídl
;

436 
	`ab‹t
();

438 
w
 = *
wp
;

439 
h
 = *
hp
;

440 
Àn
 = 
w
 * 
h
;

441 i‡(
ªsu…
[
num_game°©es
] =
NULL
)

442 
ªsu…
[
num_game°©es
] = 
	`game°©e_¸óã
(
föÆ_mem‹y
, 
w
, 
h
);

443 
i
 = 0; i < 
Àn
; i++)

445 * 
√xç
 = 
	`åy_∑r£_numbî_comma_∑ú
(
t
, 
ãmp_mem‹y
);

446 i‡(!
√xç
)

448 
°d
::
cout
 << "∑r£Üayî faûed o¿∑rsögÇumbî." << std::
ídl
;

449 
	`ab‹t
();

451 
√xt
 = *
√xç
;

452 * 
cuºít_œyî
 = 
	`game°©e_gë_œyî
(
ªsu…
[
num_game°©es
], 
œyî_num
);

453 
cuºít_œyî
[
i
] = 
√xt
;

456 
num_game°©es
++;

458  
åue
;

461 
t
->
©
 = 
⁄_Áû
;

462  
Ál£
;

463 
	}
}

464 
boﬁ
 
	$åy_∑r£_boﬁs
(
Tokíizî
* 
t
, 
boﬁ
* 
ªsu…
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
)

466 * 
⁄_Áû
 = 
t
->
©
;

467 
boﬁ
 
is_«me_∑r£
 = 
	`åy_∑r£_°rög
(
t
, "solved:");

468 i‡(!
is_«me_∑r£
)

470 
t
->
©
 = 
⁄_Áû
;

471  
Ál£
;

473 
num_game°©es
 = 0;

474 !
	`åy_∑r£_ch¨
(
t
, ';'))

476 * 
boﬁ_vÆ
 = 
	`åy_∑r£_numbî
(
t
, 
ãmp_mem‹y
);

477 i‡(!
boﬁ_vÆ
 || *bool_val > 1 || *bool_val < 0)

479 
	`¸ash_îr
("weÅriedÅoÖarseá comma seperatedÜist of bools, but weÑan into somethingÅhat wasn'tá bool");

481 
boﬁ
 
suc˚ed
 = 
	`åy_∑r£_ch¨
(
t
, ',');

482 i‡(!
suc˚ed
)

483 
	`¸ash_îr
("weÅriedÅoÖarseá comma seperatedÜist of bools, but weÑan into somethingÅhat wasn'tá comma");

485 
ªsu…
[
num_game°©es
] = 
boﬁ_vÆ
;

486 
num_game°©es
++;

488  
åue
;

489 
	}
}

490 
boﬁ
 
	$åy_∑r£_mode
(
Tokíizî
* 
t
, 
LevñMode
* 
ªsu…
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
)

492 * 
⁄_Áû
 = 
t
->
©
;

493 
boﬁ
 
is_mode_∑r£
 = 
	`åy_∑r£_°rög
(
t
, "mode:");

494 i‡(!
is_mode_∑r£
)

496 
t
->
©
 = 
⁄_Áû
;

497  
Ál£
;

499 
num_game°©es
 = 0;

500 !
	`åy_∑r£_ch¨
(
t
, ';'))

502 * 
vÆ
 = 
	`åy_∑r£_numbî
(
t
, 
ãmp_mem‹y
);

503 
boﬁ
 
comma_√xt
 = 
	`åy_∑r£_ch¨
(
t
, ',');

504 i‡(
vÆ
 && 
comma_√xt
)

506 
ªsu…
[
num_game°©es
] = (
LevñMode
Ë*
vÆ
;

510 
	`¸ash_îr
("uh oh, weÅriedÅoÖarse ourselvesáÇumber commaÖair forÖarsing mode, we couldn't find it, ohÇoooooo");

512 
num_game°©es
++;

514  
åue
;

516 
	}
}

517 
boﬁ
 
	$åy_∑r£_«mes
(
Tokíizî
* 
t
, 
LevñName
* 
ªsu…
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
)

519 * 
⁄_Áû
 = 
t
->
©
;

520 
boﬁ
 
is_«mes_∑r£
 = 
	`åy_∑r£_°rög
(
t
, "names:");

521 i‡(!
is_«mes_∑r£
)

523 
t
->
©
 = 
⁄_Áû
;

524  
Ál£
;

528 
num_game°©es
 = 0;

529 !
	`åy_∑r£_ch¨
(
t
, ';'))

531 
i
 = 0;

532 
t
->
©
[0] != ',')

534 i‡(
i
 >
GAME_LEVEL_NAME_MAX_SIZE
)

536 
°d
::
cout
 << "∑r£ faûed, we'vêru¿a¸os†®hideous, hideou†thög, we'vêru¿a¸oss" << std::
ídl
;

537 
	`ab‹t
();

539 
ªsu…
[
num_game°©es
].
«me
[
i
] = 
t
->
©
[0];

540 
i
++;

541 
t
->
©
++;

543 ; 
i
 <
GAME_LEVEL_NAME_MAX_SIZE
; i++)

544 
ªsu…
[
num_game°©es
].
«me
[
i
] = '\0';

546 
t
->
©
++;

547 
num_game°©es
++;

549  
åue
;

550 
	}
}

551 
W‹ldSèã
* 
	$∑r£_de£rülize_timemachöe
(
°d
::
°rög
 
öput_°rög
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
)

557 
°d
::
°rög
::
ôî©‹
 
íd_pos
 = std::
	`ªmove
(
öput_°rög
.
	`begö
(), i≈ut_°rög.
	`íd
(), '\n');

558 
öput_°rög
.
	`îa£
(
íd_pos
, i≈ut_°rög.
	`íd
());

561 
W‹ldSèã
* 
ªsu…
 = (W‹ldSèã*)
	`mem‹y_Æloc
(
föÆ_mem‹y
, (WorldState));

562 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

564 
ªsu…
->
Àvñ_°©e
[
i
] = 
NULL
;

566 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

567 
j
 = 0; j < 
GAME_LEVEL_NAME_MAX_SIZE
;j++)

569 
ªsu…
->
Àvñ_«mes
[
i
].
«me
[
j
] = '\0';

571 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

573 
ªsu…
->
Àvñ_sﬁved
[
i
] = 
Ál£
;

576 * 
öput
 = &(
öput_°rög
[0]);

577 
Tokíizî
 
tokíizî
;

578 
tokíizî
.
©
 = 
öput
;

580 
tokíizî
.
©
[0] !
NULL
)

582 
	`c⁄sume_whôe•a˚
(&
tokíizî
);

583 * 
maybe_num_game°©es
 = 
	`åy_∑r£_num_game°©es
(&
tokíizî
, 
ãmp_mem‹y
);

584 i‡(
maybe_num_game°©es
)

586 
ªsu…
->
num_Àvñ
 = *
maybe_num_game°©es
;

589 
boﬁ
 
∑r£d_posôi⁄s
 = 
	`åy_∑r£_posôi⁄s
(&
tokíizî
, 
ªsu…
->
Àvñ_posôi⁄
, 
ãmp_mem‹y
);

590 
boﬁ
 
∑r£d_œyî
 = 
	`åy_∑r£_œyî
(&
tokíizî
, 
ªsu…
->
Àvñ_°©e
, 
föÆ_mem‹y
, 
ãmp_mem‹y
);

591 
boﬁ
 
∑r£d_põ˚_d©a
 = 
	`åy_∑r£_põ˚_d©a
(&
tokíizî
, 
ªsu…
->
Àvñ_°©e
, 
föÆ_mem‹y
, 
ãmp_mem‹y
);

592 
boﬁ
 
∑r£d_Êo‹_d©a
 = 
	`åy_∑r£_Êo‹_d©a
(&
tokíizî
, 
ªsu…
->
Àvñ_°©e
, 
föÆ_mem‹y
, 
ãmp_mem‹y
);

593 
boﬁ
 
∑r£d_«mes
 = 
	`åy_∑r£_«mes
(&
tokíizî
, 
ªsu…
->
Àvñ_«mes
, 
föÆ_mem‹y
, 
ãmp_mem‹y
);

595 
boﬁ
 
∑r£d_Àvñ_sﬁved
 = 
	`åy_∑r£_boﬁs
(&
tokíizî
, 
ªsu…
->
Àvñ_sﬁved
, 
föÆ_mem‹y
, 
ãmp_mem‹y
);

596 
boﬁ
 
∑r£d_Àvñ_mode
 = 
	`åy_∑r£_mode
(&
tokíizî
, 
ªsu…
->
Àvñ_modes
, 
föÆ_mem‹y
, 
ãmp_mem‹y
);

597 i‡(!
maybe_num_game°©es
 && !
∑r£d_posôi⁄s
 && !
∑r£d_œyî
 && !
∑r£d_«mes
 && !
∑r£d_põ˚_d©a
)

599 
°d
::
cout
 << "uh oh, we'vêÁûedÅÿ∑r£ somëhögándÅhê∑rsög i¢'àovî. Bëã∏¸ash!" << std::
ídl
;

600 
°d
::
cout
 << "ª° o‡tokíizîÇexàlöe:" << std::
ídl
;

601 i‡(
tokíizî
.
©
[0] =
NULL
)

602 
°d
::
cout
 << "tu∫†ouàthîêi†nÿtokíizîÜe·,ánd wê¨êcom∂ëñy d⁄e.Huh ? Wh©†goög o¿thí." << std::
ídl
;

604 
°d
::
cout
 << 
tokíizî
.
©
[0] << std::
ídl
;

605 
°d
::
cout
 << "∑r£d_posôi⁄s:" << 
∑r£d_posôi⁄s
 << std::
ídl
;

606 
°d
::
cout
 << "∑r£d_œyî:" << 
∑r£d_œyî
 << std::
ídl
;

607 
°d
::
cout
 << "∑r£d_«mes:" << 
∑r£d_«mes
 << std::
ídl
;

608 
°d
::
cout
 << "∑r£d_posôi⁄s:" << (
maybe_num_game°©es
 !
NULL
Ë<< std::
ídl
;

609 
	`ab‹t
();

612 
	`c⁄sume_whôe•a˚
(&
tokíizî
);

613 i‡(
tokíizî
.
©
[0] =
NULL
)

614 
°d
::
cout
 << "Wêshould quôÑighànow,Üikê°øighàouèÅown." << std::
ídl
;

616  
ªsu…
;

617 
	}
}

619 
	$∑r£_£rülize_game°©e_œyîs
(* 
ouçut
, * 
ouçut_c⁄sumed
, 
max_ouçut_Àngth
, 
Àngth
, 
GameSèã
** 
°©es
)

621 
z
 = 0; z < 
GAME_NUM_LAYERS
; z++)

623 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, "œyî%i:", 
z
);

624 
i
 = 0; i < 
Àngth
; i++)

626 
GameSèã
* 
°©e
 = 
°©es
[
i
];

629 c⁄° 
w
 = 
°©e
->w;

630 c⁄° 
h
 = 
°©e
->h;

631 c⁄° 
œyî_Àn
 = 
w
 * 
h
;

632 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, "%d,%d", 
w
, 
h
);

633 
j
 = 0; j < 
œyî_Àn
; j++)

635 * 
cuºít_œyî
 = 
	`game°©e_gë_œyî
(
°©e
, 
z
);

636 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, ",%d", 
cuºít_œyî
[
j
]);

638 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, ",");

642 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, ";\n");

645 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, "piece_data:");

646 
i
 = 0; i < 
Àngth
; i++)

648 
GameSèã
* 
°©e
 = 
°©es
[
i
];

649 c⁄° 
w
 = 
°©e
->w;

650 c⁄° 
h
 = 
°©e
->h;

651 c⁄° 
œyî_Àn
 = 
w
 * 
h
;

652 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, "%d,%d,", 
w
, 
h
);

653 
j
 = 0; j < 
w
 * 
h
; j++)

655 
k
 = 0; k < 
CP_COUNT
; k++)

657 
to_¥öt
 = 
°©e
->
põ˚_d©a
[
j
].
powîs
[
k
];

658 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, "%d_", 
to_¥öt
);

660 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, ",");

663 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, ";\n");

665 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, "floor_data:");

666 
i
 = 0; i < 
Àngth
; i++)

668 
GameSèã
* 
°©e
 = 
°©es
[
i
];

669 c⁄° 
w
 = 
°©e
->w;

670 c⁄° 
h
 = 
°©e
->h;

671 c⁄° 
œyî_Àn
 = 
w
 * 
h
;

672 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, "%d,%d,", 
w
, 
h
);

673 
j
 = 0; j < 
w
 * 
h
; j++)

675 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, "%d-%d-%d,",

676 
°©e
->
Êo‹_d©a
[
j
].
ãÀp‹ãr_id
,

677 
°©e
->
Êo‹_d©a
[
j
].
ãÀp‹ãr_èrgë_squ¨e
.
x
,

678 
°©e
->
Êo‹_d©a
[
j
].
ãÀp‹ãr_èrgë_squ¨e
.
y


683 *
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + *ouçut_c⁄sumed, 
max_ouçut_Àngth
, ";\n");

684 
	}
}

685 
	g°d
::
°rög
 
	$∑r£_£rülize_timemachöe
(
W‹ldSèã
* 
w‹ld_°©e
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
)

687 c⁄° 
max_Àngth
 = 60000;

688 
ouçut_c⁄sumed
 = 0;

689 * 
ouçut
 = (*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (Ë* 
max_Àngth
);

690 c⁄° 
num_game°©es
 = 
w‹ld_°©e
->
num_Àvñ
;

694 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "num_game°©es:%d;\n", 
num_game°©es
);

698 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "positions:");

699 
i
 = 0; i < 
num_game°©es
; i++)

701 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "%d,%d,", 
w‹ld_°©e
->
Àvñ_posôi⁄
[
i
].
x
, w‹ld_°©e->Àvñ_posôi⁄[i].
y
);

703 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, ";\n");

706 
	`∑r£_£rülize_game°©e_œyîs
(
ouçut
, &
ouçut_c⁄sumed
, 
max_Àngth
, 
num_game°©es
, 
w‹ld_°©e
->
Àvñ_°©e
);

709 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "names:");

710 
i
 = 0; i < 
num_game°©es
; i++)

712 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "%s,", &
w‹ld_°©e
->
Àvñ_«mes
[
i
].
«me
);

714 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, ";\n");

718 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "solved:");

719 
i
 = 0; i < 
num_game°©es
; i++)

721 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "%d,", 
w‹ld_°©e
->
Àvñ_sﬁved
[
i
]);

723 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, ";\n");

727 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "mode:");

728 
i
 = 0; i < 
num_game°©es
; i++)

730 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "%d,", 
w‹ld_°©e
->
Àvñ_modes
[
i
]);

732 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, ";\n");

735  
°d
::
	`°rög
(
ouçut
);

736 
	}
}

	@Parse.h

1 #¥agm®
⁄˚


2 
	~"Edô‹.h
"

3 
	~<°rög
>

4 
	~"Mem‹y.h
"

5 
	~<ªgex
>

13 
	sTokíizî


15 * 
	m©
;

17 
di°™˚_to_ch¨
(c⁄° * 
pos
, c⁄° 
m©ch
);

18 
∑r£_numbî
(c⁄° * 
pos
);

19 
boﬁ
 
∑r£_°rögs_m©ch
(c⁄° * 
pos
, c⁄° * 
m©ch
, 
max_Àngth
);

21 
to_num
(
c
);

22 
boﬁ
 
is_num_n⁄zîo
(
c
);

23 
boﬁ
 
is_num
(
c
);

24 
boﬁ
 
is_whôe•a˚
(
c
);

25 * 
åy_∑r£_numbî
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
);

26 
boﬁ
 
åy_∑r£_°rög
(
Tokíizî
* 
t
, c⁄° * 
«me
);

27 
boﬁ
 
åy_∑r£_ch¨
(
Tokíizî
* 
t
, 
c
);

28 * 
åy_∑r£_numbî_comma_∑ú
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
);

29 
c⁄sume_whôe•a˚
(
Tokíizî
* 
t
);

31 
boﬁ
 
åy_∑r£_boﬁs
(
Tokíizî
* 
t
, boﬁ* 
ªsu…
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
);

32 * 
åy_∑r£_cuºít_Àvñ
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
);

33 * 
åy_∑r£_num_game°©es
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
);

34 
boﬁ
 
åy_∑r£_posôi⁄s
(
Tokíizî
* 
t
, 
I¡Paú
 * 
ªsu…
, 
Mem‹y
* 
ãmp_mem‹y
);

35 
boﬁ
 
åy_∑r£_œyî
(
Tokíizî
* 
t
, 
GameSèã
** 
ªsu…
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
);

36 
boﬁ
 
åy_∑r£_«mes
(
Tokíizî
* 
t
, 
LevñName
* 
ªsu…
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
);

37 
W‹ldSèã
* 
∑r£_de£rülize_timemachöe
(
°d
::
°rög
 
öput_°rög
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
);

39 
∑r£_£rülize_game°©e_œyîs
(* 
ouçut
, * 
ouçut_c⁄sumed
, 
max_ouçut_Àngth
, 
Àngth
, 
GameSèã
** 
°©es
);

40 
	g°d
::
°rög
 
∑r£_£rülize_timemachöe
(
W‹ldSèã
* 
w‹ld_°©e
, 
Mem‹y
* 
föÆ_mem‹y
, Mem‹y* 
ãmp_mem‹y
);

	@ParticleSystem.h

1 #¥agm®
⁄˚


2 
	~<glm\fwd.hµ
>

3 
	~<gœd\gœd.h
>

5 
	gP¨ti˛eSy°em
;

7 
P¨ti˛eSy°em
 
∑πi˛e_£tup
(
max_num_∑πi˛es
, 
num_∑πi˛es_ty≥s
, 
glm
::
vec4
* 
co‹dö©e_m≠
, 
GLuöt
 
∑πi˛e_ãxtuª
);

10 
∑πi˛e_døw
(
P¨ti˛eSy°em
 
sy°em
, 
ønge_°¨t
,
Àngth
);

	@PreludeIncludes.h

1 #¥agm®
⁄˚


3 #ifde‡
EMSCRIPTEN


4 
	~<ems¸ùãn.h
>

5 
	~<ems¸ùãn/html5.h
>

6 
	#°r˝y_s
 
°r˝y


	)

7 
	~<SDL_image.h
>

8 
	~<SDL_âf.h
>

9 
	#GL_GLES_PROTOTYPES
 1

	)

10 
	#GL_GLEXT_PROTOTYPES
 1

	)

12 
	~<GLES3/gl3.h
>

14 
	#EM_BOOL
 
boﬁ


	)

15 
	~<gœd/gœd.h
>

16 
	~"Clock.h
"

	@Regex.cpp

1 
	~"Regex.h
"

2 
	~"P¨£.h
"

6 
boﬁ
 
	$åy_∑r£_u¡û_°rög
(
Tokíizî
* 
t
, c⁄° * 
«me
)

8 * 
Áû
 = 
t
->
©
;

9 
boﬁ
 
d⁄e
 = 
Ál£
;

10 
t
->
©
[0] != '\0')

12 
boﬁ
 
found_°rög
 = 
	`åy_∑r£_°rög
(
t
, 
«me
);

13 i‡(
found_°rög
)

14  
åue
;

15 
t
->
©
++;

17 
t
->
©
 = 
Áû
;

18  
Ál£
;

19 
	}
}

20 * 
	$åy_∑r£_u¡û_ch¨
(
Tokíizî
* 
t
, 
°›_ch¨
, 
Mem‹y
* 
ãmp_mem‹y
)

23 * 
Áû
 = 
t
->
©
;

24 
Àngth
 = 1;

25 
t
->
©
[0] !
°›_ch¨
)

27 i‡(
t
->
©
[0] == '\0')

29 
t
-> 
©
 = 
Áû
;

30  
NULL
;

32 
Àngth
++;

33 
t
->
©
++;

35 * 
ªsu…
 = (*Ë
	`mem‹y_Æloc
(
ãmp_mem‹y
, (Ë* 
Àngth
);

36 
i
 = 0; i < 
Àngth
 - 1; i++)

37 
ªsu…
[
i
] = 
Áû
[i];

38 
ªsu…
[
Àngth
 - 1] = '\0';

39  
ªsu…
;

40 
	}
}

41 * 
	$åy_∑r£_u¡û_numbî
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
)

43 * 
Áû
 = 
t
->
©
;

44 
boﬁ
 
d⁄e
 = 
Ál£
;

45 
t
->
©
[0] != '\0')

47 * 
maybe_num
 = 
	`åy_∑r£_numbî
(
t
,
ãmp_mem‹y
);

48 i‡(
maybe_num
)

49  
maybe_num
;

50 
t
->
©
++;

52 
t
->
©
 = 
Áû
;

53  
NULL
;

54 
	}
}

55 
	g°d
::
°rög
 
	$∑r£_bëwìn_quŸes
(
Tokíizî
* 
t
, 
Mem‹y
* 
ãmp_mem‹y
)

57 * 
Áû
 = 
t
->
©
;

58 
boﬁ
 
∑ssög
 = 
	`åy_∑r£_ch¨
(
t
, '"');

59 * 
ªsu…
 = 
	`åy_∑r£_u¡û_ch¨
(
t
, '"',
ãmp_mem‹y
);

60 i‡(
ªsu…
 =
NULL
)

62 
°d
::
cout
 << "ÁûedÅÿ∑r£ bëwì¿quŸes.áb‹tög." << std::
ídl
;

63 
	`ab‹t
();

65  
°d
::
	`°rög
(
ªsu…
);

66 
	}
}

71 
AéasD©a
* 
	$GëAéasPosôi⁄
(
Mem‹y
* 
ãmp_mem‹y
, 
°d
::
°rög
 
©œs
, 
gë_©œs_numbî_‰om_«me
 
func_©œs
)

73 * 
öput
 = &(
©œs
[0]);

74 
AéasD©a
* 
ªsu…
 = (AéasD©a*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (AtlasData));

75 
ªsu…
->
Àngth
 = 0;

79 
Tokíizî
 
Àngth_tokíizî
;

80 
Àngth_tokíizî
.
©
 = 
öput
;

82 
boﬁ
 
found_√xt
 = 
åue
;

83 
found_√xt
)

85 
found_√xt
 = 
	`åy_∑r£_u¡û_°rög
(&
Àngth_tokíizî
, "\"filename\":");

86 i‡(
found_√xt
)

87 
ªsu…
->
Àngth
++;

93 
ªsu…
->
íum_c‹ro•odög_vÆues
 = (*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (Ë*Ñesu…->
Àngth
);

94 
ªsu…
->
posôi⁄s
 = (
Posôi⁄
*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (Posôi⁄Ë*Ñesu…->
Àngth
);

95 
Tokíizî
 
t
;

96 
t
.
©
 = 
öput
;

98 
i
 = 0; i < 
ªsu…
->
Àngth
; i++)

101 
boﬁ
 
found_√xt_fûíame
 = 
	`åy_∑r£_u¡û_°rög
(&
t
, "\"filename\": ");

102 
°d
::
°rög
 
quŸed_«me
 = 
	`∑r£_bëwìn_quŸes
(&
t
,
ãmp_mem‹y
);

103 
boﬁ
 
found_√xt_‰ame
 = 
	`åy_∑r£_u¡û_°rög
(&
t
, "\"frame\": {");

104 * 
x
 = 
	`åy_∑r£_u¡û_numbî
(&
t
,
ãmp_mem‹y
);

105 * 
y
 = 
	`åy_∑r£_u¡û_numbî
(&
t
, 
ãmp_mem‹y
);

106 * 
w
 = 
	`åy_∑r£_u¡û_numbî
(&
t
, 
ãmp_mem‹y
);

107 * 
h
 = 
	`åy_∑r£_u¡û_numbî
(&
t
, 
ãmp_mem‹y
);

108 i‡(!
found_√xt_fûíame
 || !
found_√xt_‰ame
 || !
x
 || !
y
 || !
w
 || !
h
)

110 
°d
::
cout
 << "Áûuª i¿ou∏bøndÇewÅextuªáéa†∑r£r, fix it." << std::
ídl
;

111 
	`ab‹t
();

115 
ªsu…
->
íum_c‹ro•odög_vÆues
[
i
] = 
	`func_©œs
(
quŸed_«me
);

117 
ªsu…
->
posôi⁄s
[
i
].
x
 = *x;

118 
ªsu…
->
posôi⁄s
[
i
].
y
 = *y;

119 
ªsu…
->
posôi⁄s
[
i
].
w
 = *w;

120 
ªsu…
->
posôi⁄s
[
i
].
h
 = *h;

126 
boﬁ
 
found_mëa
 = 
	`åy_∑r£_u¡û_°rög
(&
t
, "\"meta\"");

127 
boﬁ
 
found_size
 = 
	`åy_∑r£_u¡û_°rög
(&
t
, "\"w\":");

128 * 
√xtW
 = 
	`åy_∑r£_u¡û_numbî
(&
t
,
ãmp_mem‹y
);

129 * 
√xtH
 = 
	`åy_∑r£_u¡û_numbî
(&
t
,
ãmp_mem‹y
);

131 i‡(
found_mëa
 && 
found_size
 && 
√xtW
 && 
√xtH
)

133 
ªsu…
->
mëaWidth
 = *
√xtW
;

134 
ªsu…
->
mëaHeight
 = *
√xtH
;

138 
°d
::
cout
 << "Më®∑s†Áûed. Ab‹tög." << std::
ídl
;

139 
	`ab‹t
();

141  
ªsu…
;

144 
	}
}

	@Regex.h

1 #¥agm®
⁄˚


3 
	~"Mem‹y.h
"

4 
	~"GameSèã.h
"

5 
	~<io°ªam
>

6 
	~"Resour˚.h
"

7 
	eLAYERNAMEREGEX


9 
	mLNR_FLOOR
,

10 
	mLNR_PIECE
,

11 
	mLNR_COUNT


13 
	sPosôi⁄


15 
	mx
;

16 
	my
;

17 
	mw
;

18 
	mh
;

21 
	s°r


23 
	mÀngth
;

24 * 
	mvÆ
;

27 
	sAéasD©a


29 
	mmëaWidth
;

30 
	mmëaHeight
;

31 
	mÀngth
;

32 * 
	míum_c‹ro•odög_vÆues
;

33 
Posôi⁄
* 
	mposôi⁄s
;

38 
AéasD©a
* 
GëAéasPosôi⁄
(
Mem‹y
* 
ãmp_mem‹y
, 
°d
::
°rög
 
©œs
, 
gë_©œs_numbî_‰om_«me
 
func_©œs
);

	@Resource.h

1 #¥agm®
⁄˚


3 
	~<°rög
>

4 
	~"Mem‹y.h
"

5 
	~"GameSèã.h
"

6 
	~"ãxtuªAs£ts.h
"

7 (*
	tgë_©œs_numbî_‰om_«me
Ë(
	t°d
::
	t°rög
);

11 
ãxtuªAs£ts
::
FLOOR
 
	`ªsour˚_Êo‹_to_•rôe
(
Flo‹
 
Êo‹
);

12 
ãxtuªAs£ts
::
PIECE
 
	`ªsour˚_põ˚_to_•rôe
(
Põ˚
 
põ˚
);

13 
	`ªsour˚_œyî_vÆue_to_œyî_•rôe_vÆue
(
œyî_vÆue
, 
œyî_num
);

14 
°d
::
°rög
 
	`ªsour˚_lﬂd_puzzÀ_fûe
(°d::°rög 
fûeP©h
);

15 
°d
::
°rög
 
	`ªsour˚_lﬂd_ãxt_fûe
(°d::°rög 
fûeP©h
);

16 
	`ªsour˚_lﬂd_image_‰om_fûe_⁄to_gpu
(
°d
::
°rög
 
fûeP©h
);

	@ResourceLoadText.cpp

1 
	~<°rög
>

2 
	~<io°ªam
>

3 
	~<f°ªam
>

4 
	~<s°ªam
>

6 
	~"PªludeIn˛udes.h
"

7 
	~<GLFW/glfw3.h
>

8 
	~"Mem‹y.h
"

9 
	#STB_IMAGE_IMPLEMENTATION


	)

10 
	~"°b_image.h
"

11 
	~<glm\ext\ve˘‹_Êﬂt4.hµ
>

12 
	~"GameSèã.h
"

13 
	~<°rög
>

14 
	~"Regex.h
"

15 
	~"Resour˚.h
"

17 
	gãxtuªAs£ts
::
FLOOR
 
	$ªsour˚_Êo‹_to_•rôe
(
Flo‹
 
Êo‹
)

19 i‡(
Êo‹
 =
F_NONE
)

20  
ãxtuªAs£ts
::
FLOOR
::
Flo‹
;

21 i‡(
Êo‹
 =
F_TARGET
)

22  
ãxtuªAs£ts
::
FLOOR
::
T¨gë
;

23 i‡(
Êo‹
 =
F_START
)

24  
ãxtuªAs£ts
::
FLOOR
::
Sèπ
;

25 i‡(
Êo‹
 =
F_EXIT
)

26  
ãxtuªAs£ts
::
FLOOR
::
ZBZ
;

27 i‡(
Êo‹
 =
F_ZBLACK
)

28  
ãxtuªAs£ts
::
FLOOR
::
ZBœck
;

29 i‡(
Êo‹
 =
F_LURKING_WALL
)

30  
ãxtuªAs£ts
::
FLOOR
::
Flo‹
;

31 i‡(
Êo‹
 =
F_OUTLINE
)

32  
ãxtuªAs£ts
::
FLOOR
::
Flo‹
;

33 i‡(
Êo‹
 =
F_GRILL_COLD
)

34  
ãxtuªAs£ts
::
FLOOR
::
GrûlCŸ
;

35 i‡(
Êo‹
 =
F_GRILL_HOT
)

36  
ãxtuªAs£ts
::
FLOOR
::
GrûlHŸ
;

37 i‡(
Êo‹
 =
F_STAIRCASE
 || flo‹ =
F_STAIRCASE_LEVELSTART
)

38  
ãxtuªAs£ts
::
FLOOR
::
Sèúˇ£
;

39 i‡(
Êo‹
 =
F_STAIRCASE_SOLVED
)

40  
ãxtuªAs£ts
::
FLOOR
::
Tick
;

41  (
ãxtuªAs£ts
::
FLOOR
Ë
Êo‹
;

42 
	}
}

43 
	gãxtuªAs£ts
::
PIECE
 
	$ªsour˚_põ˚_to_•rôe
(
Põ˚
 
põ˚
)

45 i‡(
põ˚
 =
Põ˚
::
P_CRATE
)

46  
ãxtuªAs£ts
::
PIECE
::
Cøã
;

47 i‡(
põ˚
 =
Põ˚
::
P_CRUMBLE
)

48  
ãxtuªAs£ts
::
PIECE
::
CrumbÀ
;

49 i‡(
põ˚
 =
Põ˚
::
P_NONE
)

50  
ãxtuªAs£ts
::
PIECE
::
Em±y
;

51 i‡(
põ˚
 =
Põ˚
::
P_PLAYER
)

52  
ãxtuªAs£ts
::
PIECE
::
Pœyî
;

53 i‡(
põ˚
 =
Põ˚
::
P_WALL_ALT
)

54  
ãxtuªAs£ts
::
PIECE
::
WÆlA…
;

55 i‡(
põ˚
 =
Põ˚
::
P_WALL
)

56  
ãxtuªAs£ts
::
PIECE
::
WÆl
;

57  (
ãxtuªAs£ts
::
PIECE
Ë
põ˚
;

58 
	}
}

59 
	$ªsour˚_œyî_vÆue_to_œyî_•rôe_vÆue
(
œyî_vÆue
, 
œyî_num
)

61 i‡(
œyî_num
 =
LN_FLOOR
)

62  
	`ªsour˚_Êo‹_to_•rôe
((
Flo‹
)
œyî_vÆue
);

64  
	`ªsour˚_põ˚_to_•rôe
((
Põ˚
)
œyî_vÆue
);

65 
	}
}

67 
	g°d
::
°rög
 
	$ªsour˚_lﬂd_puzzÀ_fûe
(
°d
::
°rög
 
puzzÀ«me
)

69 
°d
::
°rög
 
föÆ_∑th
 = "as£ts/puzzÀs/" + 
puzzÀ«me
 + ".puzzle";

70 
°d
::
cout
 << "föÆÖ©h: " << 
föÆ_∑th
 << std::
ídl
;

71 
°d
::
if°ªam
 
	`myFûe
(
föÆ_∑th
);

72 
°d
::
°rög°ªam
 
mySåóm
;

73 
mySåóm
 << 
myFûe
.
	`rdbuf
();

74 
myFûe
.
	`˛o£
();

75 
°d
::
°rög
 
ªsu…
 = 
mySåóm
.
	`°r
();

76  
ªsu…
;

77 
	}
}

78 
	g°d
::
°rög
 
	$ªsour˚_lﬂd_ãxt_fûe
(
°d
::
°rög
 
fûeP©h
)

80 
°d
::
if°ªam
 
	`myFûe
("as£ts/" + 
fûeP©h
);

81 
°d
::
°rög°ªam
 
mySåóm
;

82 
mySåóm
 << 
myFûe
.
	`rdbuf
();

83 
myFûe
.
	`˛o£
();

84 
°d
::
°rög
 
ªsu…
 = 
mySåóm
.
	`°r
();

85  
ªsu…
;

86 
	}
}

88 
	$ªsour˚_lﬂd_image_‰om_fûe_⁄to_gpu
(
°d
::
°rög
 
fûe_∑th
)

90 
°d
::
°rög
 
as£t_fûe_∑th
 = "as£ts//" + 
fûe_∑th
;

91 
ªsu…
;

92 
	`glGíTextuªs
(1, &
ªsu…
);

93 
	`glE«bÀ
(
GL_BLEND
);

94 
	`glBödTextuª
(
GL_TEXTURE_2D
, 
ªsu…
);

96 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_S
, 
GL_CLAMP_TO_EDGE
);

97 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_T
, 
GL_CLAMP_TO_EDGE
);

99 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR
);

100 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_LINEAR
);

102 
	`°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd
(
åue
);

104 
width
;

105 
height
;

106 
num_of_ch™√ls
;

107 * 
d©a
 = 
	`°bi_lﬂd
(
as£t_fûe_∑th
.
	`c_°r
(), &
width
, &
height
, &
num_of_ch™√ls
, 0);

108 
f‹m©
 = 
GL_RGBA
;

109 i‡(
num_of_ch™√ls
 == 3)

110 
f‹m©
 = 
GL_RGB
;

111 i‡(
d©a
)

113 
	`glTexImage2D
(
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
width
, 
height
, 0, 
f‹m©
, 
GL_UNSIGNED_BYTE
, 
d©a
);

118 
°d
::
cout
 << "TextuªÜﬂd faûed,Çamêo‡fûe:" << 
fûe_∑th
.
	`c_°r
(Ë<< "look†likêthê¥ogøm†g⁄« cøshÇow" << std::
ídl
;

120 
	`°bi_image_‰ì
(
d©a
);

122  
ªsu…
;

123 
	}
}

125 
	gglm
::
vec4
* 
	$ªsour˚_lﬂd_öã∫Æ
(
°d
::
°rög
 
fûe_lﬂd
, 
gë_©œs_numbî_‰om_«me
 
func
, 
Mem‹y
* 
mem‹y
, Mem‹y* 
ãmpMem‹y
)

127 
°d
::
°rög
 
fûe
 = 
	`ªsour˚_lﬂd_ãxt_fûe
(
fûe_lﬂd
);

128 
AéasD©a
* 
d©a
 = 
	`GëAéasPosôi⁄
(
mem‹y
, 
fûe
, 
func
);

129 
glm
::
vec4
* 
ªsu…
 = (glm::vec4*Ë
	`mem‹y_Æloc
(
mem‹y
, (glm::vec4Ë* 
d©a
->
Àngth
);

131 
tŸÆW
 = 
d©a
->
mëaWidth
;

132 
tŸÆH
 = 
d©a
->
mëaHeight
;

133 
i
 = 0; i < 
d©a
->
Àngth
; i++)

135 
Posôi⁄
 
p
 = 
d©a
->
posôi⁄s
[
i
];

137 
p
.
y
 = 
tŸÆH
 - 1 -Ö.y;

138 
p
.
y
 -p.
h
 - 1;

141 
p
.
w
 +p.
x
 - 1;

142 
p
.
h
 +p.
y
 - 1;

144 
√xt_ödex
 = 
d©a
->
íum_c‹ro•odög_vÆues
[
i
];

146 
ªsu…
[
√xt_ödex
].
x
 = ()
p
.x / (
tŸÆW
 - 1);

147 
ªsu…
[
√xt_ödex
].
y
 = ()
p
.y / (
tŸÆH
 - 1);

148 
ªsu…
[
√xt_ödex
].
z
 = ()
p
.
w
 / (
tŸÆW
 - 1);

149 
ªsu…
[
√xt_ödex
].
w
 = ()
p
.
h
 / (
tŸÆH
 - 1);

152  
ªsu…
;

153 
	}
}

	@SaveLoad.cpp

1 
	~"SaveLﬂd.h
"

2 
	~"Mem‹y.h
"

4 #i‚de‡
EMSCRIPTEN


5 
	~"töyfûedülogs.h
"

7 
	~<io°ªam
>

8 
	~"C⁄°™ts.h
"

9 
	g°d
::
°rög
 
	$lﬂd_puzzÀ_‰om_as£ts
(
°d
::
°rög
 
Àvñ_«me
)

11 
°d
::
cout
 << "Àvñ fûêwê¨êåyögÅÿ›í:" << 
Àvñ_«me
 << std::
ídl
;

12 
FILE
* 
lIn
;

13 
lIn
 = 
	`f›í
(
Àvñ_«me
.
	`c_°r
(), "r");

14 i‡(!
lIn
)

16 
°d
::
cout
 << "fun˘i⁄Üﬂd_puzzÀ_‰om_as£t†ha†ÁûedÅÿfödÅhê∑th s≥cifõd. (SaveLﬂd.˝p,Üöê17). Check iàout!" << std::
ídl
;

18 c⁄° 
buf„r_size
 = 50000;

19 
buf„r
[
buf„r_size
];

21 
Êí
 =

22 
buf„r
[0] = '\0';

23 
i
 = 0;

24 
z
 = 0; z < 
buf„r_size
; z++)

26 
buf„r
[
z
] = '\0';

28 !
	`„of
(
lIn
Ë&& 
i
 < 
buf„r_size
)

30 
c
 = ()
	`fgëc
(
lIn
);

31 
buf„r
[
i
] = 
c
;

32 
i
++;

34 i‡(
i
 >
buf„r_size
)

36 
	`¸ash_îr
("ourÜevel filesáre finallyÅo big for our buffer in saveloadÜoad function. Go in, implement it using memory_alloc instead ofÅhe current hacky way.");

38 if(
i
 > 0)

39 
buf„r
[
i
 - 1] = '\0';

40 
	`f˛o£
(
lIn
);

41  
°d
::
	`°rög
(
buf„r
);

42 
	}
}

43 #ifde‡
EMSCRIPTEN


44 
	$ßve_puzzÀ_fûe
(
°d
::
°rög
 
to_ßve
)

47 
	}
}

49 
	$ßve_puzzÀ_fûe
(
°d
::
°rög
 
to_ßve
)

51 c⁄°* 
lTheSaveFûeName
;

52 c⁄°* 
lWûlBeGøphicMode
;

53 
FILE
* 
lIn
;

54 
lBuf„r
[1024];

55 c⁄°* 
lFûãrP©ã∫s
[2] = { "*.puzzle", "*.puz" };

57 
lWûlBeGøphicMode
 = 
	`töyfd_öputBox
("töyfd_quîy", 
NULL
, NULL);

59 i‡(
lWûlBeGøphicMode
)

61 
	`°r˝y
(
lBuf„r
, "graphic mode: ");

65 
	`°r˝y
(
lBuf„r
, "console mode: ");

70 
	`°rˇt
(
lBuf„r
, 
töyfd_ª•⁄£
);

73 
lTheSaveFûeName
 = 
	`töyfd_ßveFûeDülog
(

77 
lFûãrP©ã∫s
,

78 
NULL
);

80 i‡(!
lTheSaveFûeName
)

82 
	`töyfd_mesßgeBox
(

91 
lIn
 = 
	`f›í
(
lTheSaveFûeName
, "w");

92 i‡(!
lIn
)

94 
	`töyfd_mesßgeBox
(

102 
	`Âuts
(
to_ßve
.
	`c_°r
(), 
lIn
);

103 
	`f˛o£
(
lIn
);

105 
	}
}

108 
	$ßve_c⁄töue_fûe
(
°d
::
°rög
 
to_ßve
)

110 
FILE
* 
lIn
;

111 c⁄° * 
ßve_«me
 = ".\\assets\\puzzles\\save1.game";

112 
lIn
 = 
	`f›í
(
ßve_«me
, "w");

113 i‡(!
lIn
)

115 
	`¸ash_îr
("triedÅo save continue file. It failed!");

117 
	`Âuts
(
to_ßve
.
	`c_°r
(), 
lIn
);

118 
	`f˛o£
(
lIn
);

119 
	}
}

121 
	g°d
::
°rög
 
	$gë_c⁄töue_fûe
(
Mem‹y
* 
ãmp_mem‹y
)

123 c⁄° * 
to_lﬂd
 = ".\\assets\\puzzles\\save1.game";

124 
FILE
* 
lIn
 = 
	`f›í
(
to_lﬂd
, "r");

125 i‡(!
lIn
)

127 
°d
::
cout
 << "nÿc⁄töuêfûêtÿlﬂd" << std::
ídl
;

130 
size
 = 0;

131 !
	`„of
(
lIn
))

133 
	`fgëc
(
lIn
);

134 
size
++;

136 
	`f£ek
(
lIn
, 0, 
SEEK_SET
);

138 * 
ªsu…
 = (*Ë
	`mem‹y_Æloc
(
ãmp_mem‹y
, (Ë* (
size
 + 1));

139 
i
 = 0; i < 
size
; i++)

141 
ªsu…
[
i
] = ()
	`fgëc
(
lIn
);

142 i‡(
	`„of
(
lIn
))

144 
ªsu…
[
i
] = 
NULL
;

148 
ªsu…
[
size
] = 
NULL
;

149 
°d
::
cout
 << 
ªsu…
 << std::
ídl
;

150  
°d
::
	`°rög
(
ªsu…
);

151 
	}
}

152 #i‚de‡
EMSCRIPTEN


153 
	g°d
::
°rög
 
	$lﬂd_puzzÀ_fûe
()

155 c⁄°* 
lTheO≥nFûeName
;

156 
FILE
* 
lIn
;

157 c⁄°* 
lFûãrP©ã∫s
[2] = { "*.puzzle", "*.puz" };

159 
lTheO≥nFûeName
 = 
	`töyfd_›íFûeDülog
(

164 
lFûãrP©ã∫s
,

165 
NULL
,

168 i‡(!
lTheO≥nFûeName
)

170 
	`töyfd_mesßgeBox
(

178  
	`lﬂd_puzzÀ_‰om_as£ts
(
lTheO≥nFûeName
);

179 
	}
}

181 
	g°d
::
°rög
 
	$lﬂd_puzzÀ_fûe
()

184 
	}
}

	@SaveLoad.h

1 #¥agm®
⁄˚


2 #¥agm®
w¨nög
(
dißbÀ
:4996)

3 
	~<°rög
>

4 
	~"Mem‹y.h
"

6 
	g°d
::
°rög
 
lﬂd_puzzÀ_‰om_as£ts
(
°d
::°rög 
Àvñ_«me
);

7 
ßve_puzzÀ_fûe
(
°d
::
°rög
 
to_ßve
);

8 
	g°d
::
°rög
 
lﬂd_puzzÀ_fûe
();

9 
ßve_game
(
°d
::
°rög
 
to_ßve
);

10 
ßve_c⁄töue_fûe
(
°d
::
°rög
 
to_ßve
);

11 
	g°d
::
°rög
 
gë_c⁄töue_fûe
(
Mem‹y
* 
ãmp_mem‹y
);

	@Scratch.h

	@Shader.cpp

1 
	~<°rög
>

3 
	~"PªludeIn˛udes.h
"

4 
	~<glm/glm.hµ
>

5 
	~<glm/gtc/ty≥_±r.hµ
>

6 
	~"Resour˚.h
"

7 
	~<io°ªam
>

9 
GLuöt
 
	tShadî
;

11 
boﬁ
 
	$ã°_°rögs_°¨t_equÆs_°rög_öã∫Æ
(
°d
::
°rög
 
°¨t_ã°
, std::string string)

13 i‡(
°¨t_ã°
.
	`Àngth
(Ë> 
°rög
.length())

14  
Ál£
;

15 
i
 = 0; i < 
°¨t_ã°
.
	`Àngth
(); i++)

16 i‡(
°¨t_ã°
[
i
] !
°rög
[i])

17  
Ál£
;

18  
åue
;

19 
	}
}

21 
	g°d
::
°rög
 
	$c⁄vît_c‹e_to_es_öã∫Æ
(
°d
::
°rög
 
öput
)

23 
°d
::
°rög
 
to_dñëe
 = "#version 300 core";

24 
°d
::
°rög
 
to_ª∂a˚
 = "#version 300És";

25 
Àn
 = (Ë
to_dñëe
.
	`Àngth
() + 2;

26 
°d
::
°rög
 
ªsu…
 = 
to_ª∂a˚
 + 
öput
.
	`sub°r
(17,°d::°rög::
≈os
);

27  
ªsu…
;

28 
	}
}

30 
	g°d
::
°rög
 
	$c⁄vît_ch¨_c‹e_to_es_öã∫Æ
(c⁄° * 
öput
)

32 
°d
::
°rög
 
ãmp
 = std::
	`°rög
(
öput
);

33  
	`c⁄vît_c‹e_to_es_öã∫Æ
(
ãmp
);

34 
	}
}

36 
Shadî
 
	$shadî_compûe_lﬂded_¥ogøm
(c⁄° * 
vîãxD©aTemp
, c⁄° * 
‰agmítD©aTemp
, c⁄° * 
geomëryD©a
 = 
nuŒ±r
)

38 
	`¥ötf
("NARROWED BUG DOWN TO THIS SEGMENT OF CODE!");

39 #ifde‡
EMSCRIPTEN


40 
°d
::
°rög
 
vîãxD©a°r
 = 
	`c⁄vît_ch¨_c‹e_to_es_öã∫Æ
(
vîãxD©aTemp
);

41 
°d
::
°rög
 
‰agmítD©a°r
 = 
	`c⁄vît_ch¨_c‹e_to_es_öã∫Æ
(
‰agmítD©aTemp
);

42 c⁄° * 
vîãxD©a
 = 
vîãxD©a°r
.
	`c_°r
();

43 c⁄° * 
‰agmítD©a
 = 
‰agmítD©a°r
.
	`c_°r
();

45 c⁄° * 
vîãxD©a
 = 
vîãxD©aTemp
;

46 c⁄° * 
‰agmítD©a
 = 
‰agmítD©aTemp
;

52 
GLuöt
 
vîãxShadî
 = 
	`glCª©eShadî
(
GL_VERTEX_SHADER
);

53 
°d
::
cout
 << "glShadîSour˚ VERT CREATE" << 
	`glGëEº‹
(Ë<< std::
ídl
;

54 
GLuöt
 
‰agmítShadî
 = 
	`glCª©eShadî
(
GL_FRAGMENT_SHADER
);

55 
°d
::
cout
 << "glShadîSour˚ FRAG CREATE" << 
	`glGëEº‹
(Ë<< std::
ídl
;

58 
	`glShadîSour˚
(
vîãxShadî
, 1, &
vîãxD©a
, 
NULL
);

59 
°d
::
cout
 << "glShadîSour˚ VERT LOAD" << 
	`glGëEº‹
(Ë<< std::
ídl
;

60 
	`glCompûeShadî
(
vîãxShadî
);

61 
°d
::
cout
 << "glShadîSour˚ VERT COMPILE" << 
	`glGëEº‹
(Ë<< std::
ídl
;

63 
GLöt
 
suc˚ss
;

64 
öfoLog
[1024];

66 
	`glGëShadîiv
(
vîãxShadî
, 
GL_COMPILE_STATUS
, &
suc˚ss
);

67 
°d
::
cout
 << "glGëShadîiv VERT" << 
	`glGëEº‹
(Ë<< std::
ídl
;

68 i‡(!
suc˚ss
) {

69 
	`glGëShadîInfoLog
(
vîãxShadî
, 1024, 
NULL
, 
öfoLog
);

70 
°d
::
cout
 << "ERROR::SHADER::VERTEX::COMPILATION_FAILED\n" << 
öfoLog
 << std::
ídl
;

71 
°d
::
cout
 << 
öfoLog
 << std::
ídl
;

72 
	`ab‹t
();

76 
°d
::
cout
 << "suc˚ssfuŒyáâached vîãx shadî" << std::
ídl
;

80 
	`glShadîSour˚
(
‰agmítShadî
, 1, &
‰agmítD©a
, 
NULL
);

81 
°d
::
cout
 << "glShadîSour˚ FRAG LOAD" << 
	`glGëEº‹
(Ë<< std::
ídl
;

82 
	`glCompûeShadî
(
‰agmítShadî
);

83 
°d
::
cout
 << "glShadîSour˚ FRAG COMPILE" << 
	`glGëEº‹
(Ë<< std::
ídl
;

85 
	`glGëShadîiv
(
‰agmítShadî
, 
GL_COMPILE_STATUS
, &
suc˚ss
);

87 i‡(!
suc˚ss
) {

88 
	`glGëShadîInfoLog
(
‰agmítShadî
, 1024, 
NULL
, 
öfoLog
);

89 
°d
::
cout
 << "ERROR::SHADER::FRAGMENT::COMPILATION_FAILED\n" << 
öfoLog
 << std::
ídl
;

90 
°d
::
cout
 << 
öfoLog
 << std::
ídl
;

91 
	`ab‹t
();

95 
°d
::
cout
 << "suc˚ssfuŒyáâached føgmíàshadî" << std::
ídl
;

98 
Shadî
 
ªsu…
 = 
	`glCª©eProgøm
();

99 
°d
::
cout
 << "glCª©eProgøm: " << 
	`glGëEº‹
(Ë<< std::
ídl
;

100 
	`glAâachShadî
(
ªsu…
, 
vîãxShadî
);

101 
°d
::
cout
 << "glAâachShadî VERT: " << 
	`glGëEº‹
(Ë<< std::
ídl
;

102 
	`glAâachShadî
(
ªsu…
, 
‰agmítShadî
);

103 
°d
::
cout
 << "glAâachShadî FRAG: " << 
	`glGëEº‹
(Ë<< std::
ídl
;

104 
	`glLökProgøm
(
ªsu…
);

105 
°d
::
cout
 << "LINK: " << 
	`glGëEº‹
(Ë<< std::
ídl
;

106 
	`glGëProgømiv
(
ªsu…
, 
GL_LINK_STATUS
, &
suc˚ss
);

107 i‡(!
suc˚ss
) {

108 
	`glGëProgømInfoLog
(
ªsu…
, 1024, 
NULL
, 
öfoLog
);

109 
°d
::
cout
 << "ERROR::SHADER::PROGRAM::LINKING_FAILED\n" << std::
ídl
;

110 
°d
::
cout
 << 
öfoLog
 << std::
ídl
;

113 
	`glDñëeShadî
(
vîãxShadî
);

114 
	`glDñëeShadî
(
‰agmítShadî
);

115  
ªsu…
;

116 
	}
}

118 
Shadî
 
	$shadî_compûe_¥ogøm
(c⁄° * 
vîãxP©h
, c⁄° * 
‰agmítP©h
, c⁄° * 
geomëryP©h
 = 
nuŒ±r
)

120 
°d
::
°rög
 
vîãxSåög
 = 
	`ªsour˚_lﬂd_ãxt_fûe
(
vîãxP©h
);

121 c⁄° * 
vîãx
 = 
vîãxSåög
.
	`c_°r
();

122 
°d
::
°rög
 
‰agmítSåög
 = 
	`ªsour˚_lﬂd_ãxt_fûe
(
‰agmítP©h
);

123 c⁄° * 
‰ag
 = 
‰agmítSåög
.
	`c_°r
();

124 c⁄° * 
geo
 = 
nuŒ±r
;

125 i‡(
geomëryP©h
 !
nuŒ±r
)

126 
geo
 = 
	`ªsour˚_lﬂd_ãxt_fûe
(
geomëryP©h
).
	`c_°r
();

129  
	`shadî_compûe_lﬂded_¥ogøm
(
vîãx
, 
‰ag
, 
geo
);

131 
	}
}

132 
	$shadî_u£
(
Shadî
 
shadî
)

134 
	`glU£Progøm
(
shadî
);

135 
	}
}

136 
	$shadî_£t_unif‹m_öt
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
vÆue
)

138 
	`glUnif‹m1i
(
	`glGëUnif‹mLoˇti⁄
(
shadî
, 
«me
.
	`c_°r
()), 
vÆue
);

139 
	}
}

140 
	$shadî_£t_unif‹m_Êﬂt
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
vÆue
)

142 
	`glUnif‹m1f
(
	`glGëUnif‹mLoˇti⁄
(
shadî
, 
«me
.
	`c_°r
()), 
vÆue
);

143 
	}
}

144 
	$shadî_£t_unif‹m_vec2
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
vec2
 
vÆue
)

146 
	`glUnif‹m2f
(
	`glGëUnif‹mLoˇti⁄
(
shadî
, 
«me
.
	`c_°r
()), 
vÆue
.
x
, vÆue.
y
);

147 
	}
}

148 
	$shadî_£t_unif‹m_vec3
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
vec3
 
vÆue
)

150 
	`glUnif‹m3f
(
	`glGëUnif‹mLoˇti⁄
(
shadî
, 
«me
.
	`c_°r
()), 
vÆue
.
x
, vÆue.
y
, vÆue.
z
);

151 
	}
}

152 
	$shadî_£t_unif‹m_vec4
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
vec4
 
vÆue
)

154 
	`glUnif‹m4f
(
	`glGëUnif‹mLoˇti⁄
(
shadî
, 
«me
.
	`c_°r
()), 
vÆue
.
x
, vÆue.
y
, vÆue.
z
,vÆue.
w
);

155 
	}
}

156 
	$shadî_£t_unif‹m_m©2
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
m©2
 
vÆue
)

158 
	`glUnif‹mM©rix2fv
(
	`glGëUnif‹mLoˇti⁄
(
shadî
, 
«me
.
	`c_°r
()), 1, 
Ál£
, 
glm
::
	`vÆue_±r
(
vÆue
));

159 
	}
}

160 
	$shadî_£t_unif‹m_m©3
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
m©3
 
vÆue
)

162 
	`glUnif‹mM©rix3fv
(
	`glGëUnif‹mLoˇti⁄
(
shadî
, 
«me
.
	`c_°r
()), 1, 
Ál£
, 
glm
::
	`vÆue_±r
(
vÆue
));

163 
	}
}

164 
	$shadî_£t_unif‹m_m©4
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
m©4
 
vÆue
)

166 
	`glUnif‹mM©rix4fv
(
	`glGëUnif‹mLoˇti⁄
(
shadî
, 
«me
.
	`c_°r
()), 1, 
Ál£
, 
glm
::
	`vÆue_±r
(
vÆue
));

167 
	}
}

	@Shader.h

1 #¥agm®
⁄˚


2 
	~<glm/glm.hµ
>

4 
	~<°rög
>

5 
	~"PªludeIn˛udes.h
"

6 
	~<glm/glm.hµ
>

7 
	~<glm/gtc/ty≥_±r.hµ
>

9 
GLuöt
 
	tShadî
;

11 
Shadî
 
shadî_compûe_¥ogøm
(c⁄° * 
vîãxP©h
, c⁄° * 
‰agmítP©h
, c⁄° * 
geomëryP©h
 = 
nuŒ±r
);

12 
shadî_u£
(
Shadî
 
shadî
);

14 
shadî_£t_unif‹m_öt
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
vÆue
);

15 
shadî_£t_unif‹m_Êﬂt
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
vÆue
);

16 
shadî_£t_unif‹m_vec2
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
vec2
 
vÆue
);

17 
shadî_£t_unif‹m_vec3
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
vec3
 
vÆue
);

18 
shadî_£t_unif‹m_vec4
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
vec4
 
vÆue
);

19 
shadî_£t_unif‹m_m©2
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
m©2
 
vÆue
);

20 
shadî_£t_unif‹m_m©3
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
m©3
 
vÆue
);

21 
shadî_£t_unif‹m_m©4
(
Shadî
 
shadî
, c⁄° 
°d
::
°rög
& 
«me
, 
glm
::
m©4
 
vÆue
);

	@Side.h

1 #¥agm®
⁄˚


3 
	~"M©h.h
"

6 
I¡Paú
 
	$m©h_side_to_dúe˘i⁄
(
Side
 
s
)

8 i‡(
s
 =
S_RIGHT
)

9  
	`m©h_öçaú_¸óã
(1, 0);

10 i‡(
s
 =
S_DOWN
)

11  
	`m©h_öçaú_¸óã
(0, -1);

12 i‡(
s
 =
S_LEFT
)

13  
	`m©h_öçaú_¸óã
(-1, 0);

14 i‡(
s
 =
S_UP
)

15  
	`m©h_öçaú_¸óã
(0, 1);

16  
	`m©h_öçaú_¸óã
(0, 0);

17 
	}
}

18 
Side
 
	$m©h_dúe˘i⁄_to_side
(
I¡Paú
 
∑ú
)

20 i‡(
∑ú
.
x
 == -1)

21  
S_LEFT
;

22 i‡(
∑ú
.
x
 == 1)

23  
S_RIGHT
;

24 i‡(
∑ú
.
y
 == 1)

25  
S_UP
;

26 i‡(
∑ú
.
y
 == -1)

27  
S_DOWN
;

28 
	}
}

29 
Side
 
	$m©h_side_›posôe
(
Side
 
s
)

32 
i
 = ()
s
;

33 
√xt
 = (
i
 + 2) % 4;

34  (
Side
Ë
√xt
;

35 
	}
}

	@Source.cpp

	@Sprites.cpp

1 
	~"S¥ôes.h
"

2 
	~<glm\ext\m©rix_å™sf‹m.hµ
>

4 
	$•rôes_fuŒ•rôe_to_gpu_d©a
(
FuŒS¥ôeAºay
* 
•rôes
, 
glm
::
vec4
* 
ödex_m≠≥r
, glm::vec4* 
©œs_ouçut
, glm::
m©4
* 
m©rix_ouçut
)

6 
Àngth
 = 
•rôes
->length;

7 
i
 = 0; i < 
Àngth
; i++)

9 
©œs_ouçut
[
i
] = 
ödex_m≠≥r
[
•rôes
->
©œsIndex
[i]];

11 
glm
::
vec3
 
å™¶©e_bef‹e_rŸ©e_°¨t
 = glm::
	`vec3
(-0.5f, -0.5f, 0);

12 
glm
::
vec3
 
å™¶©e_a·î_rŸ©e_íd
 = glm::
	`vec3
(0.5f, 0.5f, 0);

13 
glm
::
vec3
 
rŸ©e_vec3
 = glm::
	`vec3
(0, 0, 1);

14 
i
 = 0; i < 
Àngth
; i++)

17 
m©rix_ouçut
[
i
] = 
glm
::
	`m©4
(1.0f);

20 
glm
::
	`å™¶©e
(
m©rix_ouçut
[
i
], glm::
	`vec3
(
•rôes
->
posôi⁄WôhSˇÀ
[i].
x
,•rôes->posôi⁄WôhSˇÀ[i].
y
,0));

23 
glm
::
	`sˇÀ
(
m©rix_ouçut
[
i
], glm::
	`vec3
(
•rôes
->
posôi⁄WôhSˇÀ
[i].
z
, s¥ôes->posôi⁄WôhSˇÀ[i].
w
, 1));

26 
glm
::
	`å™¶©e
(
m©rix_ouçut
[
i
], 
å™¶©e_bef‹e_rŸ©e_°¨t
);

27 
glm
::
	`rŸ©e
(
m©rix_ouçut
[
i
], 
•rôes
->
rŸ©i⁄
[i], 
rŸ©e_vec3
);

28 
glm
::
	`å™¶©e
(
m©rix_ouçut
[
i
], 
å™¶©e_a·î_rŸ©e_íd
);

30 
	}
}

31 
	$•rôes_box•rôe_to_gpu_d©a
(
BoxS¥ôes
* 
•rôes
, 
glm
::
vec4
* 
ödex_m≠≥r
, glm::vec4* 
©œs_ouçut
, glm::
vec2
* 
posôi⁄_ouçut
)

33 
Àngth
 = 
•rôes
->length;

34 
i
 = 0; i < 
Àngth
; i++)

36 
©œs_ouçut
[
i
] = 
ödex_m≠≥r
[
•rôes
->
©œsIndex
[i]];

38 
i
 = 0; i < 
Àngth
; i++)

40 
posôi⁄_ouçut
[
i
] = 
•rôes
->
posôi⁄
[i];

42 
	}
}

	@Sprites.h

1 #¥agm®
⁄˚


2 
	~<glm/glm.hµ
>

3 
	~"M©h.h
"

4 
	sBoxS¥ôes
 {

5 
	mÀngth
;

6 * 
	m©œsIndex
;

7 
	mglm
::
vec2
* 
posôi⁄
;

10 
	sFuŒS¥ôeAºay


12 
	mÀngth
;

13 * 
	m©œsIndex
;

14 
	mglm
::
vec4
* 
posôi⁄WôhSˇÀ
;

15 * 
	mrŸ©i⁄
;

18 
•rôes_fuŒ•rôe_to_Øbb_™d_gpu_d©a
(
FuŒS¥ôeAºay
* 
•rôes
, 
AABB
* 
Øbb_ouçut
, 
glm
::
vec4
* 
©œs_ouçut
, glm::
m©4
* 
m©rix_ouçut
);

19 
•rôes_box•rôe_to_Øbb_™d_gpu_d©a
(
BoxS¥ôes
* 
•rôes
, 
AABB
* 
Øbb_ouçut
, 
glm
::
vec4
* 
©œs_ouçut
, glm::
m©4
* 
m©rix_ouçut
);

	@TextDraw.cpp

1 
	~"TextDøw.h
"

4 
	$gë_h‹iz⁄èl_•a˚_c⁄sumed_by_ãxt
(
glm
::
vec3
 
°¨t_posôi⁄
, glm::
vec2
 
sˇÀ
, c⁄° * 
c_°rög
, 
TextWrôe
* 
öfo
)

7 
glm
::
vec3
 
√xt_posôi⁄
 = 
°¨t_posôi⁄
;

8 
døw
 = *
öfo
->
cuºít_numbî_døwn
;

9 ; 
c_°rög
[0]; c_string++)

11 
c
 = 
c_°rög
[0];

14 
h‹iz⁄èl_•a˚
 = 
öfo
->
ãxt_posôi⁄s
[
c
].
w
 / 
FONT_CHARACTER_HEIGHT
;

16 
x_°¨t
 = (
√xt_posôi⁄
.
x
 + 
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Bórög
.xË/ (
FONT_CHARACTER_HEIGHT
);

17 
y_°¨t
 = (
√xt_posôi⁄
.
y
 - (
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Size
.y - info->åue_f⁄t_ª„ªn˚[c].
Bórög
.y)Ë/ (
FONT_CHARACTER_HEIGHT
);

18 
w
 = (
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Size
.
x
Ë/ (
FONT_CHARACTER_HEIGHT
);

19 
h
 = 
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Size
.
y
 / (
FONT_CHARACTER_HEIGHT
);

22 
x_pixñs_ö_game•a˚
 = (
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
adv™˚
 >> 6Ë/ (
FONT_CHARACTER_HEIGHT
);

23 
√xt_posôi⁄
.
x
 +(
x_pixñs_ö_game•a˚
 * 
sˇÀ
.x);

26 *
öfo
->
cuºít_numbî_døwn
 = 
døw
;

27  
√xt_posôi⁄
.
x
 - 
°¨t_posôi⁄
.x;

28 
	}
}

30 
LöeBounds
 
	$gë_löebounds_•a˚_c⁄sumed_by_ãxt
(
glm
::
vec3
 
°¨t_posôi⁄
, glm::
vec2
 
sˇÀ
, c⁄° * 
c_°rög
, 
TextWrôe
* 
öfo
)

33 
glm
::
vec3
 
√xt_posôi⁄
 = 
°¨t_posôi⁄
;

34 
LöeBounds
 
ªsu…
;

35 
ªsu…
.
y_bŸ
 = 0;

36 
ªsu…
.
y_t›
 = 0;

37 
ªsu…
.
y_di°
 = 0;

38 
døw
 = *
öfo
->
cuºít_numbî_døwn
;

39 ; 
c_°rög
[0]; c_string++)

41 
c
 = 
c_°rög
[0];

44 
h‹iz⁄èl_•a˚
 = 
öfo
->
ãxt_posôi⁄s
[
c
].
w
 / 
FONT_CHARACTER_HEIGHT
;

46 
x_°¨t
 = (
√xt_posôi⁄
.
x
 + 
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Bórög
.xË/ (
FONT_CHARACTER_HEIGHT
);

47 
y_°¨t
 = (
√xt_posôi⁄
.
y
 - (
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Size
.y - info->åue_f⁄t_ª„ªn˚[c].
Bórög
.y)Ë/ (
FONT_CHARACTER_HEIGHT
);

48 
w
 = (
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Size
.
x
Ë/ (
FONT_CHARACTER_HEIGHT
);

49 
h
 = 
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Size
.
y
 / (
FONT_CHARACTER_HEIGHT
);

52 
x_pixñs_ö_game•a˚
 = (
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
adv™˚
 >> 6Ë/ (
FONT_CHARACTER_HEIGHT
);

53 
√xt_posôi⁄
.
x
 +(
x_pixñs_ö_game•a˚
 * 
sˇÀ
.x);

55 
ªsu…
.
y_bŸ
 = 
	`möf
‘esu….y_bŸ, 
y_°¨t
);

56 
ªsu…
.
y_t›
 = 
	`maxf
‘esu….y_t›, 
y_°¨t
 + 
h
);

57 
ªsu…
.
y_di°
 = 
	`maxf
‘esu….y_di°, 
h
);

59 *
öfo
->
cuºít_numbî_døwn
 = 
døw
;

60 
ªsu…
.
löe_Àngth
 = 
√xt_posôi⁄
.
x
 - 
°¨t_posôi⁄
.x;

61  
ªsu…
;

62 
	}
}

64 
	$døw_ãxt_to_s¸ìn
(
glm
::
vec3
 
°¨t_posôi⁄
, glm::
vec2
 
sˇÀ
, c⁄° * 
c_°rög
, 
TextWrôe
* 
öfo
)

67 
glm
::
vec3
 
√xt_posôi⁄
 = 
°¨t_posôi⁄
;

68 
døw
 = *
öfo
->
cuºít_numbî_døwn
;

69 ; 
c_°rög
[0]; c_string++)

71 
c
 = 
c_°rög
[0];

74 
h‹iz⁄èl_•a˚
 = 
öfo
->
ãxt_posôi⁄s
[
c
].
w
 / 
FONT_CHARACTER_HEIGHT
;

76 
x_°¨t
 = (
√xt_posôi⁄
.
x
 + 
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Bórög
.xË/ (
FONT_CHARACTER_HEIGHT
);

77 
y_°¨t
 = (
√xt_posôi⁄
.
y
 - (
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Size
.y - info->åue_f⁄t_ª„ªn˚[c].
Bórög
.yË* 
sˇÀ
.yË/ (
FONT_CHARACTER_HEIGHT
);

78 
w
 = (
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Size
.
x
Ë/ (
FONT_CHARACTER_HEIGHT
);

79 
h
 = 
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
Size
.
y
 / (
FONT_CHARACTER_HEIGHT
);

81 i‡(
c
 != ' ')

83 
glm
::
vec3
 
°¨t_posôi⁄
 = glm::
	`vec3
(
√xt_posôi⁄
.
x
 + 
x_°¨t
,Çext_posôi⁄.
y
 + 
y_°¨t
,Çext_posôi⁄.
z
);

84 
öfo
->
°rög_m©rix_˝u
[
døw
] = 
glm
::
	`m©4
(1.0f);

85 
öfo
->
°rög_m©rix_˝u
[
døw
] = 
glm
::
	`å™¶©e
(öfo->°rög_m©rix_˝u[døw], 
°¨t_posôi⁄
);

86 
öfo
->
°rög_m©rix_˝u
[
døw
] = 
glm
::
	`sˇÀ
(öfo->°rög_m©rix_˝u[døw], glm::
	`vec3
(
w
 * 
sˇÀ
.
x
, 
h
 * sˇÀ.
y
, 1));

87 
öfo
->
°rög_cﬁ‹_˝u
[
døw
] = 
glm
::
	`vec4
(0.5, 0.2, 0.3, 1);

89 
AABB
 
box
 = 
öfo
->
ãxt_posôi⁄s_n‹mÆized
[
c
];

90 
glm
::
vec4
 
to_©œs_ouçut
 = glm::
	`vec4
(
box
.
x
, box.
y
, box.x + box.
w
, box.y + box.
h
);

91 
öfo
->
°rög_©œs_˝u
[
døw
] = 
to_©œs_ouçut
;

93 
døw
++;

97 
x_pixñs_ö_game•a˚
 = (
öfo
->
åue_f⁄t_ª„ªn˚
[
c
].
adv™˚
 >> 6Ë/ (
FONT_CHARACTER_HEIGHT
);

98 
√xt_posôi⁄
.
x
 +(
x_pixñs_ö_game•a˚
 * 
sˇÀ
.x);

101 *
öfo
->
cuºít_numbî_døwn
 = 
døw
;

102  
√xt_posôi⁄
.
x
 - 
°¨t_posôi⁄
.x;

103 
	}
}

105 
	$≥r˚¡age_bëwìn
(
°¨t
, 
íd
, 
poöt
)

107  (
poöt
 - 
°¨t
Ë/ (
íd
 - start);

108 
	}
}

110 
	$ÀΩ
(
°¨t
, 
íd
, 
≥r˚¡age
)

112  
≥r˚¡age
 * 
íd
 + (1.0‡-Öî˚¡ageË* 
°¨t
;

113 
	}
}

115 
	$døw_ãxt_maximized_˚¡îed_to_s¸ìn
(
GameS∑˚Camîa
 
ˇmîa
, c⁄° * 
°rög_to_døw
, 
TextWrôe
* 
ãxt_døw_öfo
)

118 
glm
::
vec3
 
s¸ìn_˚¡î
 = glm::
	`vec3
((
ˇmîa
.
À·
 + camîa.
right
Ë/ 2.0f, (ˇmîa.
up
 + camîa.
down
) / 2.0f, 15);

120 
LöeBounds
 
bounds
 = 
	`gë_löebounds_•a˚_c⁄sumed_by_ãxt
(
s¸ìn_˚¡î
, 
glm
::
	`vec2
(1, 1), 
°rög_to_døw
, 
ãxt_døw_öfo
);

121 
ãxt_width
 = 
	`gë_h‹iz⁄èl_•a˚_c⁄sumed_by_ãxt
(
s¸ìn_˚¡î
, 
glm
::
	`vec2
(1, 1), 
°rög_to_døw
, 
ãxt_døw_öfo
);

122 
ãxt_height
 = 
bounds
.
y_t›
 - bounds.
y_bŸ
;

126 
x_di°
 = 
ˇmîa
.
right
 - camîa.
À·
;

127 
y_di°
 = 
ˇmîa
.
up
 - camîa.
down
;

128 
x_sˇÀ
 = 
x_di°
 / 
ãxt_width
;

129 
y_sˇÀ
 = 
y_di°
 / 
ãxt_height
;

130 
sˇÀ
 = 
	`möf
(
x_sˇÀ
, 
y_sˇÀ
);

132 
°¨t_ãxt_y_åue_°¨t
;

134 
ˇmîa_Àngth
 = 
ˇmîa
.
up
 - camîa.
down
;

135 
unsˇÀd_ãxt_löe_Àngth
 = 
bounds
.
y_t›
 - bounds.
y_bŸ
;

137 
sˇÀd_ãxt_löe_Àngth
 = 
unsˇÀd_ãxt_löe_Àngth
 * 
sˇÀ
;

139 
vîtiˇl_•a˚
 = 
y_di°
 - 
sˇÀd_ãxt_löe_Àngth
;

140 
hÆf_vîtiˇl_•a˚
 = 
vîtiˇl_•a˚
 / 2.0f;

142 
°¨t_øtio
 = 
	`≥r˚¡age_bëwìn
(
bounds
.
y_bŸ
, bounds.
y_t›
, 0);

144 
°¨t_ãxt_bŸtom
 = 
ˇmîa
.
down
 + 
hÆf_vîtiˇl_•a˚
;

145 
°¨t_ãxt_t›
 = 
°¨t_ãxt_bŸtom
 + 
sˇÀd_ãxt_löe_Àngth
;

146 
°¨t_ãxt_y_åue_°¨t
 = 
	`ÀΩ
(
°¨t_ãxt_bŸtom
, 
°¨t_ãxt_t›
, 
°¨t_øtio
);

148 
°¨t_ãxt_x_åue_°¨t
;

150 
åue_width
 = 
ãxt_width
 * 
sˇÀ
;

151 
x_•a˚_À·
 = 
x_di°
 - 
åue_width
;

152 
x_•a˚_À·_hÆf
 = 
x_•a˚_À·
 / 2.0f;

153 
°¨t_ãxt_x_åue_°¨t
 = 
ˇmîa
.
À·
 + 
x_•a˚_À·_hÆf
;

155 
	`døw_ãxt_to_s¸ìn
(
glm
::
	`vec3
(
°¨t_ãxt_x_åue_°¨t
, 
°¨t_ãxt_y_åue_°¨t
, 
s¸ìn_˚¡î
.
z
), glm::
	`vec2
(
x_sˇÀ
, x_sˇÀ), 
°rög_to_døw
, 
ãxt_døw_öfo
);

156 
	}
}

158 
GameS∑˚Camîa
 
	$¨ó_gë_grid_ñemít
(
x
, 
y
, 
width
, 
height
, 
GameS∑˚Camîa
 
¨ó
)

160 
GameS∑˚Camîa
 
ªsu…
;

161 
ªsu…
.
À·
 = 
	`ÀΩ
(
¨ó
.À·,áªa.
right
, 
x
 / 
width
);

162 
ªsu…
.
down
 = 
	`ÀΩ
(
¨ó
.down,áªa.
up
, 
y
 / 
height
);

164 
ªsu…
.
right
 = 
	`ÀΩ
(
¨ó
.
À·
,áªa.right, (
x
 + 1Ë/ 
width
);

165 
ªsu…
.
up
 = 
	`ÀΩ
(
¨ó
.
down
,áªa.up, (
y
 + 1Ë/ 
height
);

167  
ªsu…
;

168 
	}
}

170 
GameS∑˚Camîa
* 
	$bªak_ˇmîa_öto_cﬁumns
(
GameS∑˚Camîa
 
¨ó
, 
cﬁumn
, 
Mem‹y
* 
sc›e_mem‹y
)

172 
GameS∑˚Camîa
* 
ªsu…
 = (GameS∑˚Camîa*)
	`mem‹y_Æloc
(
sc›e_mem‹y
, (GameS∑˚CamîaË* 
cﬁumn
);

173 
Àngth
 = 
¨ó
.
right
 -áªa.
down
;

174 
•lô_Àngth
 = 
Àngth
 / ()
cﬁumn
;

175 
i
 = 0; i < 
cﬁumn
; i++)

177 
ªsu…
[
i
].
up
 = 
¨ó
.up;

178 
ªsu…
[
i
].
down
 = 
¨ó
.down;

179 
ªsu…
[
i
].
À·
 = 
¨ó
.À· + 
•lô_Àngth
 * i;

180 
ªsu…
[
i
].
right
 = 
¨ó
.
À·
 + 
•lô_Àngth
 * (i + 1);

181 
ªsu…
[
i
].
˛o£Poöt
 = 
¨ó
.closePoint;

182 
ªsu…
[
i
].
ÁrPoöt
 = 
¨ó
.farPoint;

184  
ªsu…
;

185 
	}
}

187 
GameS∑˚Camîa
* 
	$bªak_ˇmîa_öto_rows
(
GameS∑˚Camîa
 
¨ó
, 
rows
, 
Mem‹y
* 
sc›e_mem‹y
)

189 
GameS∑˚Camîa
* 
ªsu…
 = (GameS∑˚Camîa*)
	`mem‹y_Æloc
(
sc›e_mem‹y
, (GameS∑˚CamîaË* 
rows
);

190 
Àngth
 = 
¨ó
.
up
 -áªa.
down
;

191 
•lô_Àngth
 = 
Àngth
 / ()
rows
;

192 
i
 = 0; i < 
rows
; i++)

194 
ªsu…
[
i
].
up
 = 
¨ó
.
down
 + 
•lô_Àngth
 * (i + 1);

195 
ªsu…
[
i
].
down
 = 
¨ó
.dow¿+ 
•lô_Àngth
 * i;

196 
ªsu…
[
i
].
À·
 = 
¨ó
.left;

197 
ªsu…
[
i
].
right
 = 
¨ó
.right;

198 
ªsu…
[
i
].
˛o£Poöt
 = 
¨ó
.closePoint;

199 
ªsu…
[
i
].
ÁrPoöt
 = 
¨ó
.farPoint;

201  
ªsu…
;

202 
	}
}

204 
GameS∑˚Camîa
* 
	$bªak_ˇmîa_öto_weighãd_cﬁumns
(
GameS∑˚Camîa
 
¨ó
, * 
cﬁumn_øtio
, 
Àngth
, 
Mem‹y
* 
sc›e_mem‹y
)

206 
GameS∑˚Camîa
* 
ªsu…
 = (GameS∑˚Camîa*)
	`mem‹y_Æloc
(
sc›e_mem‹y
, (GameS∑˚CamîaË* 
Àngth
);

207 
x_width
 = 
¨ó
.
right
 -áªa.
À·
;

208 
y_height
 = 
¨ó
.
up
 -áªa.
down
;

209 
tŸÆ
 = 0;

210 
i
 = 0; i < 
Àngth
; i++)

212 
tŸÆ
 +
cﬁumn_øtio
[
i
];

214 
tŸÆf
 = ()
tŸÆ
;

215 
°¨t
 = 0;

216 
i
 = 0; i < 
Àngth
; i++)

218 
our_°¨t
 = 
°¨t
;

219 
√xt_øtio
 = 
cﬁumn_øtio
[
i
] / 
tŸÆf
;

220 
our_íd
 = 
our_°¨t
 + 
√xt_øtio
 * 
x_width
;

221 
°¨t
 +
√xt_øtio
;

223 
ªsu…
[
i
].
À·
 = 
our_°¨t
;

224 
ªsu…
[
i
].
right
 = 
our_íd
;

225 
ªsu…
[
i
].
up
 = 
¨ó
.up;

226 
ªsu…
[
i
].
down
 = 
¨ó
.down;

227 
ªsu…
[
i
].
ÁrPoöt
 = 
¨ó
.farPoint;

228 
ªsu…
[
i
].
˛o£Poöt
 = 
¨ó
.closePoint;

230  
ªsu…
;

231 
	}
}

233 
GameS∑˚Camîa
* 
	$bªak_ˇmîa_öto_weighãd_rows
(
GameS∑˚Camîa
 
¨ó
, * 
row_øtio
, 
Àngth
, 
Mem‹y
* 
sc›e_mem‹y
)

235 
GameS∑˚Camîa
* 
ªsu…
 = (GameS∑˚Camîa*)
	`mem‹y_Æloc
(
sc›e_mem‹y
, (GameS∑˚CamîaË* 
Àngth
);

236 
x_width
 = 
¨ó
.
right
 -áªa.
À·
;

237 
y_height
 = 
¨ó
.
up
 -áªa.
down
;

238 
tŸÆ
 = 0;

239 
i
 = 0; i < 
Àngth
; i++)

241 
tŸÆ
 +
row_øtio
[
i
];

243 
tŸÆf
 = ()
tŸÆ
;

244 
°¨t
 = 0;

245 
i
 = 0; i < 
Àngth
; i++)

247 
our_°¨t
 = 
°¨t
;

248 
√xt_øtio
 = 
row_øtio
[
i
] / 
tŸÆf
;

249 
our_íd
 = 
our_°¨t
 + 
√xt_øtio
 * 
y_height
;

250 
°¨t
 +
√xt_øtio
;

252 
ªsu…
[
i
].
À·
 = 
¨ó
.left;

253 
ªsu…
[
i
].
right
 = 
¨ó
.
down
;

254 
ªsu…
[
i
].
up
 = 
our_°¨t
;

255 
ªsu…
[
i
].
down
 = 
our_íd
;

256 
ªsu…
[
i
].
ÁrPoöt
 = 
¨ó
.farPoint;

257 
ªsu…
[
i
].
˛o£Poöt
 = 
¨ó
.closePoint;

259  
ªsu…
;

260 
	}
}

	@TextDraw.h

1 #¥agm®
⁄˚


3 
	~"M©h.h
"

4 
	~"TrueF⁄tCh¨a˘î.h
"

5 c⁄° 
	gFONT_CHARACTER_HEIGHT
 = 128;

6 c⁄° 
	gFONT_ATLAS_WIDTH
 = 1024;

7 c⁄° 
	gFONT_ATLAS_HEIGHT
 = 1024;

8 c⁄° 
	gFONT_NUM_CHARACTERS
 = 128;

10 
	sTextWrôe
 {

11 
	mglm
::
m©4
* 
°rög_m©rix_˝u
;

12 
	mglm
::
vec4
* 
°rög_©œs_˝u
;

13 
	mglm
::
vec4
* 
°rög_cﬁ‹_˝u
;

14 
TTF_Ch¨a˘î
* 
	måue_f⁄t_ª„ªn˚
;

15 
AABB
* 
	mãxt_posôi⁄s
;

16 
AABB
* 
	mãxt_posôi⁄s_n‹mÆized
;

17 * 
	mcuºít_numbî_døwn
;

20 
	sLöeBounds


22 
	mlöe_Àngth
;

23 
	my_t›
;

24 
	my_bŸ
;

25 
	my_di°
;

28 
gë_h‹iz⁄èl_•a˚_c⁄sumed_by_ãxt
(
glm
::
vec3
 
°¨t_posôi⁄
, glm::
vec2
 
sˇÀ
, c⁄° * 
c_°rög
, 
TextWrôe
* 
öfo
);

29 
LöeBounds
 
gë_löebounds_•a˚_c⁄sumed_by_ãxt
(
glm
::
vec3
 
°¨t_posôi⁄
, glm::
vec2
 
sˇÀ
, c⁄° * 
c_°rög
, 
TextWrôe
* 
öfo
);

30 
døw_ãxt_to_s¸ìn
(
glm
::
vec3
 
°¨t_posôi⁄
, glm::
vec2
 
sˇÀ
, c⁄° * 
c_°rög
, 
TextWrôe
* 
öfo
);

34 
	sLöe


36 
	m˚¡î
;

37 
	mÀngth
;

38 
	mt›
;

39 
	mbŸ
;

43 
≥r˚¡age_bëwìn
(
°¨t
, 
íd
, 
poöt
);

44 
ÀΩ
(
°¨t
, 
íd
, 
≥r˚¡age
);

45 
døw_ãxt_maximized_˚¡îed_to_s¸ìn
(
GameS∑˚Camîa
 
ˇmîa
, c⁄° * 
°rög_to_døw
, 
TextWrôe
* 
ãxt_døw_öfo
);

47 
GameS∑˚Camîa
 
¨ó_gë_grid_ñemít
(
x
, 
y
, 
width
, 
height
, GameS∑˚Camî®
¨ó
);

48 
GameS∑˚Camîa
* 
bªak_ˇmîa_öto_cﬁumns
(GameS∑˚Camî®
¨ó
, 
cﬁumn
, 
Mem‹y
* 
sc›e_mem‹y
);

50 
GameS∑˚Camîa
* 
bªak_ˇmîa_öto_rows
(GameS∑˚Camî®
¨ó
, 
rows
, 
Mem‹y
* 
sc›e_mem‹y
);

52 
GameS∑˚Camîa
* 
bªak_ˇmîa_öto_weighãd_cﬁumns
(GameS∑˚Camî®
¨ó
, * 
cﬁumn_øtio
, 
Àngth
, 
Mem‹y
* 
sc›e_mem‹y
);

54 
GameS∑˚Camîa
* 
bªak_ˇmîa_öto_weighãd_rows
(GameS∑˚Camî®
¨ó
, * 
row_øtio
, 
Àngth
, 
Mem‹y
* 
sc›e_mem‹y
);

	@TextScene.h

1 #¥agm®
⁄˚


2 
	~"C⁄°™ts.h
"

3 
	~<°rög
>

4 
	~"Mem‹y.h
"

5 
	sTextS˚√


7 * 
	mto_di•œy
;

8 
	m°¨t_time
;

9 
	míd_time
;

10 
SCENE_TYPE
 
	ms˚√_to_ªvît_to
;

13 
TextS˚√
* 
	$buûd_ãxt_s˚√
(
°d
::
°rög
 
to_buûd
, 
SCENE_TYPE
 
œ°_s˚√
, 
Mem‹y
* 
ãxt_mem‹y
, 
°¨t_time
, 
di•œy_time
)

15 
	`mem‹y_˛ór
(
ãxt_mem‹y
);

16 
TextS˚√
* 
ªsu…
 = (TextS˚√*)
	`mem‹y_Æloc
(
ãxt_mem‹y
, (TextScene));

17 
ªsu…
->
to_di•œy
 = (*)
	`mem‹y_Æloc
(
ãxt_mem‹y
, 
to_buûd
.
	`Àngth
() + 1);

18 
i
 = 0; i < 
to_buûd
.
	`Àngth
(); i++)

19 
ªsu…
->
to_di•œy
[
i
] = 
to_buûd
[i];

20 
ªsu…
->
to_di•œy
[
to_buûd
.
	`Àngth
()] = 
NULL
;

21 
ªsu…
->
°¨t_time
 = start_time;

22 
ªsu…
->
íd_time
 = 
°¨t_time
 + 
di•œy_time
;

23 
ªsu…
->
s˚√_to_ªvît_to
 = 
œ°_s˚√
;

24  
ªsu…
;

25 
	}
}

27 
TextS˚√
* 
	$Àvñ_p›up
(
°d
::
°rög
 
Àvñ_«me
, 
Mem‹y
* 
ãxt_mem‹y
, 
cuºít_time
)

29  
	`buûd_ãxt_s˚√
(
Àvñ_«me
, 
SCENE_TYPE
::
ST_PLAY_LEVEL
, 
ãxt_mem‹y
, 
cuºít_time
, 
TIME_TO_DISPLAY_LEVEL_NAME
);

30 
	}
}

32 
TextS˚√
* 
	$Àvñ_p›up_cu°omtime
(
°d
::
°rög
 
Àvñ_«me
, 
Mem‹y
* 
ãxt_mem‹y
, 
cuºít_time
, 
di•œy_time
)

34  
	`buûd_ãxt_s˚√
(
Àvñ_«me
, 
SCENE_TYPE
::
ST_PLAY_LEVEL
, 
ãxt_mem‹y
, 
cuºít_time
, 
di•œy_time
);

35 
	}
}

	@TrueFontCharacter.h

1 #¥agm®
⁄˚


2 
	~<glm\ext\ve˘‹_öt2.hµ
>

4 
	sTTF_Ch¨a˘î


6 
	mglm
::
ivec2
 
Size
;

7 
	mglm
::
ivec2
 
Bórög
;

8 
	madv™˚
;

	@Walk.cpp

1 
	~"M©h.h
"

3 
boﬁ
* 
	$m©h_grid_wÆk_adja˚¡
(
Mem‹y
* 
ªsu…_mem‹y
, Mem‹y* 
ãmp_mem‹y
, * 
öput_grid
, 
°¨t_x
, 
°¨t_y
, 
w
, 
h
)

5  
nuŒ±r
;

6 
	}
}

7 
boﬁ
* 
	$m©h_grid_wÆk_adja˚¡_wøµed
(
Mem‹y
* 
ªsu…_mem‹y
, Mem‹y* 
ãmp_mem‹y
, * 
öput_grid
, 
°¨t_x
, 
°¨t_y
, 
w
, 
h
)

51  
nuŒ±r
;

52 
	}
}

	@World.cpp

1 
	~"W‹ld.h
"

2 
	~"Anim©i⁄.h
"

3 
	~"P¨£.h
"

6 
	$w‹ld_åy_ªvîsög_°aúˇ£
(
W‹ldS˚√
* 
s˚√
)

8 i‡(
s˚√
->
°aúˇ£_we_íãªd_Àvñ_‰om
.
Àvñ_ödex
 >= 0)

10 
s˚√
->
œ°_a˘i⁄_was_ãÀp‹t
 = 
åue
;

11 
W‹ldPosôi⁄
 
cuºít_pos
 = 
	`w‹ld_maybe_föd_∂ayî
(
s˚√
);

12 
W‹ldPosôi⁄
 
ªvît_pos
 = 
s˚√
->
°aúˇ£_we_íãªd_Àvñ_‰om
;

13 i‡(
cuºít_pos
.
Àvñ_ödex
 == -1)

14 
	`¸ash_îr
("uh ohhh, weÅriedÅo findáÖlayer but couldn't find one,Åhat shouldn't have happened");

15 
∂ayî_vÆ
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
cuºít_pos
.
Àvñ_ödex
]->
põ˚
[cuºít_pos.
Àvñ_posôi⁄_1d
];

16 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
ªvît_pos
.
Àvñ_ödex
]->
Êo‹
[ªvît_pos.
Àvñ_posôi⁄_1d
] = 
F_STAIRCASE_SOLVED
;

19 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
cuºít_pos
.
Àvñ_ödex
]->
põ˚
[cuºít_pos.
Àvñ_posôi⁄_1d
] = 
P_NONE
;

20 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
ªvît_pos
.
Àvñ_ödex
]->
põ˚
[ªvît_pos.
Àvñ_posôi⁄_1d
] = 
∂ayî_vÆ
;

21 
s˚√
->
cuºít_Àvñ
 = 
ªvît_pos
.
Àvñ_ödex
;

23 
	}
}

25 
W‹ldPœyS˚√
* 
	$w‹ld_∂ayî_a˘i⁄
(
W‹ldS˚√
* 
s˚√
, 
Dúe˘i⁄
 
a˘i⁄
, 
Mem‹y
* 
Àvñ_mem‹y
)

27 
s˚√
->
œ°_a˘i⁄_was_ãÀp‹t
 = 
Ál£
;

29 
I¡Paú
 
move
 = 
	`dúe˘i⁄_to_öçaú
(
a˘i⁄
);

30 
GameSèã
* 
cuºít_°©e
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[s˚√->
cuºít_Àvñ
];

31 
I¡Paú
 
cuºít_°©e_posôi⁄
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_posôi⁄
[s˚√->
cuºít_Àvñ
];

34 
W‹ldPosôi⁄
 
∂ayî_pos
 = 
	`w‹ld_maybe_föd_∂ayî
(
s˚√
);

35 
cuºít_∂ayî_vÆue
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
∂ayî_pos
.
Àvñ_ödex
]->
põ˚
[∂ayî_pos.
Àvñ_posôi⁄_1d
];

59 
I¡Paú
 
√xt_∂ayî_squ¨e_posôi⁄
;

60 
√xt_squ¨e_Àvñ
;

62 
I¡Paú
 
ã¡©ive_√xt
 = 
	`m©h_öçaú_add
(
move
, 
∂ayî_pos
.
Àvñ_posôi⁄
 );

63 
boﬁ
 
öside_Àvñ
 = 
	`m©h_wôhö_grid
(
ã¡©ive_√xt
.
x
,Åíètive_√xt.
y
, 
cuºít_°©e
->
w
, cuºít_°©e->
h
);

64 i‡(
öside_Àvñ
)

66 
√xt_∂ayî_squ¨e_posôi⁄
 = 
ã¡©ive_√xt
;

67 
√xt_squ¨e_Àvñ
 = 
s˚√
->
cuºít_Àvñ
;

72 
I¡Paú
 
w‹ld_posôi⁄
 = 
	`m©h_öçaú_add
(
ã¡©ive_√xt
, 
cuºít_°©e_posôi⁄
);

74 
boﬁ
 
found_move
 = 
Ál£
;

75 
i
 = 0; i < 
s˚√
->
w‹ld_°©e
.
num_Àvñ
; i++)

77 
I¡Paú
 
grid_loˇti⁄
 = 
	`m©h_öçaú_sub
(
w‹ld_posôi⁄
, 
s˚√
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
]);

78 i‡(
	`m©h_wôhö_grid
(
grid_loˇti⁄
.
x
, grid_loˇti⁄.
y
, 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
w
, s˚√->w‹ld_°©e.Àvñ_°©e[i]->
h
))

80 
√xt_∂ayî_squ¨e_posôi⁄
 = 
grid_loˇti⁄
;

81 
√xt_squ¨e_Àvñ
 = 
i
;

82 
found_move
 = 
åue
;

86 i‡(!
found_move
)

89  
NULL
;

95 
GameSèã
* 
√xt_°©e
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
√xt_squ¨e_Àvñ
];

97 
√xt_squ¨e_posôi⁄_1d
 = 
	`f2D
(
√xt_∂ayî_squ¨e_posôi⁄
.
x
,Çext_∂ayî_squ¨e_posôi⁄.
y
, 
√xt_°©e
->
w
,Çext_°©e->
h
);

98 i‡(
√xt_°©e
->
põ˚
[
√xt_squ¨e_posôi⁄_1d
] !
P_NONE
)

101  
NULL
;

109 
cuºít_°©e_posôi⁄_1d
 = 
	`f2D
(
∂ayî_pos
.
Àvñ_posôi⁄
.
x
,Öœyî_pos.Àvñ_posôi⁄.
y
, 
cuºít_°©e
->
w
, cuºít_°©e->
h
);

110 
cuºít_°©e
->
põ˚
[
cuºít_°©e_posôi⁄_1d
] = 
P_NONE
;

113 
√xt_squ¨e_posôi⁄_1d
 = 
	`f2D
(
√xt_∂ayî_squ¨e_posôi⁄
.
x
,Çext_∂ayî_squ¨e_posôi⁄.
y
, 
√xt_°©e
->
w
,Çext_°©e->
h
);

115 
√xt_°©e
->
põ˚
[
√xt_squ¨e_posôi⁄_1d
] = 
cuºít_∂ayî_vÆue
;

116 
s˚√
->
cuºít_Àvñ
 = 
√xt_squ¨e_Àvñ
;

121 
föÆ_Àvñ_ödex
 = 
√xt_squ¨e_Àvñ
;

122 
föÆ_posôi⁄_1d
 = 
√xt_squ¨e_posôi⁄_1d
;

124 
f
 = 
√xt_°©e
->
Êo‹
[
√xt_squ¨e_posôi⁄_1d
];

125 
boﬁ
 
°™dög_⁄_ãÀp‹ãr
 = 
	`is_°aúˇ£
(
f
);

126 i‡(
°™dög_⁄_ãÀp‹ãr
)

129 
lök_loˇti⁄
;

130 
I¡Paú
 
lök_squ¨e_2d
;

131 
lök_squ¨e_1d
;

133 
Flo‹D©a
 
√xt_Êo‹d©a
 = 
√xt_°©e
->
Êo‹_d©a
[
√xt_squ¨e_posôi⁄_1d
];

134 
lök_loˇti⁄
 = 
√xt_Êo‹d©a
.
ãÀp‹ãr_id
;

135 
lök_squ¨e_2d
 = 
√xt_Êo‹d©a
.
ãÀp‹ãr_èrgë_squ¨e
;

136 
lök_w
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
lök_loˇti⁄
]->
w
;

137 
lök_h
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
lök_loˇti⁄
]->
h
;

138 
lök_squ¨e_1d
 = 
	`f2D
(
lök_squ¨e_2d
.
x
,Üök_squ¨e_2d.
y
, 
lök_w
,
lök_h
);

143 
s˚√
->
œ°_a˘i⁄_was_ãÀp‹t
 = 
Ál£
;

144 
√xt_°©e
->
põ˚
[
√xt_squ¨e_posôi⁄_1d
] = 0;

145 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
lök_loˇti⁄
]->
põ˚
[
lök_squ¨e_1d
] = 
Põ˚
::
P_PLAYER
;

146 
GameSèã
* 
√xt
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
√xt_squ¨e_Àvñ
];

147 
Àvñ_pos_1d
 = 
	`f2D
(
√xt_∂ayî_squ¨e_posôi⁄
.
x
,Çext_∂ayî_squ¨e_posôi⁄.
y
, 
√xt
->
w
,Çext->
h
);

148 
s˚√
->
°aúˇ£_we_íãªd_Àvñ_‰om
 = 
	`w‹ld_make_w‹ld_posôi⁄
(s˚√->
cuºít_Àvñ
, 
√xt_∂ayî_squ¨e_posôi⁄
, 
Àvñ_pos_1d
);

149 
s˚√
->
cuºít_Àvñ
 = 
lök_loˇti⁄
;

150 
föÆ_Àvñ_ödex
 = 
lök_loˇti⁄
;

151 
föÆ_posôi⁄_1d
 = 
lök_squ¨e_1d
;

160 
tûe_∂ayî_°™dög_⁄
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
föÆ_Àvñ_ödex
]->
Êo‹
[
föÆ_posôi⁄_1d
];

161 
boﬁ
 
°™dög_⁄_°¨t_tûe
 = 
tûe_∂ayî_°™dög_⁄
 =
F_START
 ||Åûe_∂ayî_°™dög_⁄ =
F_STAIRCASE_LEVELSTART
;

162 i‡(
°™dög_⁄_°¨t_tûe
)

164 
	`mem‹y_˛ór
(
Àvñ_mem‹y
);

165 
GameSèã
* 
√xt_s˚√_bef‹e_exåude
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[s˚√->
cuºít_Àvñ
];

166 
GameSèã
* 
√xt_s˚√
 = 
	`game°©e_˛⁄e
(
√xt_s˚√_bef‹e_exåude
, 
Àvñ_mem‹y
);

167 
	`game°©e_°¨tup
(
√xt_s˚√
);

168 
W‹ldPœyS˚√
* 
ªsu…
 = (W‹ldPœyS˚√*Ë
	`mem‹y_Æloc
(
Àvñ_mem‹y
, (WorldPlayScene));

169 
ªsu…
->
time_machöe
 = 
	`game°©e_timemachöe_¸óã
(
√xt_s˚√
, 
Àvñ_mem‹y
, 1024);

170 
ªsu…
->
døw_posôi⁄
 = 
s˚√
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
föÆ_Àvñ_ödex
];

171  
ªsu…
;

175 
s˚√
->
°aúˇ£_we_íãªd_Àvñ_‰om
 = 
	`w‹ld_make_w‹ld_posôi⁄
(-1, 
	`m©h_öçaú_¸óã
(-1, -1), -1);

180  
NULL
;

183 
	}
}

184 
W‹ldS˚√
* 
	$£tup_w‹ld_s˚√_c⁄töue
(
W‹ldS˚√
* 
s˚√
, 
SCENE_TYPE
 
go_to_⁄_back•a˚
)

186 
s˚√
->
go_to_⁄_back•a˚
 = go_to_on_backspace;

187 
s˚√
->
œ°_a˘i⁄_was_ãÀp‹t
 = 
Ál£
;

188  
s˚√
;

189 
	}
}

190 
W‹ldS˚√
* 
	$£tup_w‹ld_s˚√
(
TimeMachöeEdô‹
* 
buûd_‰om
, 
Mem‹y
* 
w‹ld_s˚√_mem‹y
, 
SCENE_TYPE
 
go_to_⁄_back•a˚
)

192 
W‹ldS˚√
* 
ªsu…
 = (W‹ldS˚√*)
	`mem‹y_Æloc
(
w‹ld_s˚√_mem‹y
, (WorldScene));

193 
ªsu…
->
go_to_⁄_back•a˚
 = go_to_on_backspace;

194 
ªsu…
->
œ°_a˘i⁄_was_ãÀp‹t
 = 
Ál£
;

195 c⁄° 
num_game°©es
 = 
buûd_‰om
->
w‹ld_°©e
.
num_Àvñ
;

196 
ªsu…
->
w‹ld_°©e
.
num_Àvñ
 = 
num_game°©es
;

197 
i
 = 0; i < 
num_game°©es
; i++)

199 
ªsu…
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
] = 
buûd_‰om
->world_state.level_position[i];

201 
i
 = 0; i < 
num_game°©es
; i++)

203 
ªsu…
->
w‹ld_°©e
.
Àvñ_sﬁved
[
i
] = 
buûd_‰om
->world_state.level_solved[i];

205 
i
 = 0; i < 
num_game°©es
; i++)

207 
ªsu…
->
w‹ld_°©e
.
Àvñ_°©e
[
i
] = 
	`game°©e_˛⁄e
(
buûd_‰om
->w‹ld_°©e.Àvñ_°©e[i], 
w‹ld_s˚√_mem‹y
);

209 
i
 = 0; i < 
num_game°©es
;i++)

211 
ªsu…
->
w‹ld_°©e
.
Àvñ_«mes
[
i
] = 
buûd_‰om
->world_state.level_names[i];

213 
i
 = 0; i < 
num_game°©es
;i++)

215 
ªsu…
->
w‹ld_°©e
.
Àvñ_modes
[
i
] = 
buûd_‰om
->world_state.level_modes[i];

219 
boﬁ
 
d⁄e_födög_∂ayî
 = 
Ál£
;

220 
i
 = 0; i < 
num_game°©es
; i++)

222 
Àn
 = 
ªsu…
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
w
 *Ñesu…->w‹ld_°©e.Àvñ_°©e[i]->
h
;

223 
z
 = 0; z < 
Àn
; z++)

224 i‡(
ªsu…
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
põ˚
[
z
] =
P_PLAYER
)

226 
ªsu…
->
cuºít_Àvñ
 = 
i
;

227 
d⁄e_födög_∂ayî
 = 
åue
;

230 i‡(
d⁄e_födög_∂ayî
)

233 i‡(!
d⁄e_födög_∂ayî
)

235 
°d
::
cout
 << "YouÅrõdÅÿö°™tüãá w‹ldÅh© didn'àc⁄èöáÖœyî, sÿwêˇn'àpo†thêw‹ld. F‹Çow,Åhi†i†®¸ash." << std::
ídl
;

236 
	`ab‹t
();

239  
ªsu…
;

240 
	}
}

241 
boﬁ
 
	$™y_Àvñs_À·_a˘ive
(
W‹ldS˚√
* 
to_check
)

243 
i
 = 0; i < 
to_check
->
w‹ld_°©e
.
num_Àvñ
; i++)

245 
GameSèã
* 
°©e
 = 
to_check
->
w‹ld_°©e
.
Àvñ_°©e
[
i
];

246 
w
 = 
°©e
->w;

247 
h
 = 
°©e
->h;

248 
Àn
 = 
w
 * 
h
;

249 
z
 = 0; z < 
Àn
; z++)

251 i‡(
°©e
->
Êo‹
[
z
] =
Flo‹
::
F_START
 || sèã->Êo‹[z] =Flo‹::
F_STAIRCASE_LEVELSTART
)

252  
åue
;

255  
Ál£
;

256 
	}
}

259 
W‹ldPosôi⁄
 
	$w‹ld_maybe_föd_∂ayî
(
W‹ldS˚√
* 
s˚√
)

261 
z
 = 0; z < 
s˚√
->
w‹ld_°©e
.
num_Àvñ
; z++)

263 
pos_1d
 = 
	`game°©e_maybe_föd_∂ayî
(
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
z
]);

264 i‡(
pos_1d
 != -1)

266 
I¡Paú
 
pos_2d
 = 
	`t2D
(
pos_1d
, 
s˚√
->
w‹ld_°©e
.
Àvñ_°©e
[
z
]->
w
, s˚√->w‹ld_°©e.Àvñ_°©e[z]->
h
);

267 
W‹ldPosôi⁄
 
ªsu…
 = 
	`w‹ld_make_w‹ld_posôi⁄
(
z
,
pos_2d
,
pos_1d
);

268  
	`w‹ld_make_w‹ld_posôi⁄
(
z
,
pos_2d
,
pos_1d
);

271  
	`w‹ld_make_w‹ld_posôi⁄
(-1,
	`m©h_öçaú_¸óã
(-1,-1),-1);

272 
	}
}

274 
	g°d
::
°rög
 
	$w‹ld_£rülize_ﬁd
(
W‹ldS˚√
* 
w‹ld
, 
Mem‹y
* 
sc›e
, Mem‹y* 
ãmp_mem‹y
)

277 c⁄° 
max_Àngth
 = 10000;

278 
ouçut_c⁄sumed
 = 0;

279 * 
ouçut
 = (*)
	`mem‹y_Æloc
(
ãmp_mem‹y
, (Ë* 
max_Àngth
);

280 c⁄° 
num_game°©es
 = 
w‹ld
->
w‹ld_°©e
.
num_Àvñ
;

284 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "num_game°©es:%d;\n", 
num_game°©es
);

293 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "positions:");

294 
i
 = 0; i < 
num_game°©es
; i++)

295 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "%d,%d,", 
w‹ld
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
x
, w‹ld->w‹ld_°©e.Àvñ_posôi⁄[i].
y
);

296 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, ";\n");

300 
	`∑r£_£rülize_game°©e_œyîs
(
ouçut
, &
ouçut_c⁄sumed
, 
max_Àngth
, 
num_game°©es
, 
w‹ld
->
w‹ld_°©e
.
Àvñ_°©e
);

303 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "names:");

304 
i
 = 0; i < 
num_game°©es
; i++)

306 * 
«me
 = 
w‹ld
->
w‹ld_°©e
.
Àvñ_«mes
[
i
].name;

307 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "%s,", 
«me
);

309 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, ";\n");

314 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "solved:");

315 
i
 = 0; i < 
num_game°©es
; i++)

317 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, "%d,", 
w‹ld
->
w‹ld_°©e
.
Àvñ_sﬁved
[
i
]);

319 
ouçut_c⁄sumed
 +
	`•rötf_s
(
ouçut
 + ouçut_c⁄sumed, 
max_Àngth
, ";\n");

321  
°d
::
	`°rög
(
ouçut
);

322 
	}
}

324 
W‹ldS˚√
* 
	$w‹ld_de£rülize
(
°d
::
°rög
 
w‹ld_°rög
, 
Mem‹y
* 
sc›e
, Mem‹y* 
ãmp_mem‹y
)

326 
W‹ldSèã
* 
w‹ld_°©e
 = 
	`∑r£_de£rülize_timemachöe
(
w‹ld_°rög
, 
sc›e
, 
ãmp_mem‹y
);

327 
W‹ldS˚√
* 
ªsu…
 = (W‹ldS˚√*)
	`mem‹y_Æloc
(
sc›e
, (WorldScene));

330 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

332 
ªsu…
->
w‹ld_°©e
.
Àvñ_°©e
[
i
] = 
NULL
;

334 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

335 
j
 = 0; j < 
GAME_LEVEL_NAME_MAX_SIZE
;j++)

337 
ªsu…
->
w‹ld_°©e
.
Àvñ_«mes
[
i
].
«me
[
j
] = '\0';

341 
ªsu…
->
w‹ld_°©e
 = *world_state;

342 
ªsu…
->
cuºít_Àvñ
 = 
	`w‹ld_maybe_föd_∂ayî
‘esu…).
Àvñ_ödex
;

343 
ªsu…
->
°aúˇ£_we_íãªd_Àvñ_‰om
 = 
	`w‹ld_make_w‹ld_posôi⁄_övÆid
();

344 
ªsu…
->
go_to_⁄_back•a˚
 = 
SCENE_TYPE
::
ST_COUNT
;

345  
ªsu…
;

346 
	}
}

	@World.h

1 #¥agm®
⁄˚


2 
	~"M©h.h
"

3 
	~"GameSèã.h
"

4 
	~"Edô‹.h
"

5 
	~"Anim©i⁄.h
"

6 
	~"C⁄°™ts.h
"

7 
	~<io°ªam
>

9 
	sW‹ldS˚√


12 
SCENE_TYPE
 
	mgo_to_⁄_back•a˚
;

13 
W‹ldPosôi⁄
 
	m°aúˇ£_we_íãªd_Àvñ_‰om
;

14 
	mcuºít_Àvñ
;

16 
boﬁ
 
	mœ°_a˘i⁄_was_ãÀp‹t
;

18 
W‹ldSèã
 
	mw‹ld_°©e
;

21 
	sW‹ldPœyS˚√


23 
I¡Paú
 
	mdøw_posôi⁄
;

24 
Game°©eTimeMachöe
* 
	mtime_machöe
;

27 
w‹ld_åy_ªvîsög_°aúˇ£
(
W‹ldS˚√
* 
s˚√
);

28 
W‹ldPœyS˚√
* 
w‹ld_∂ayî_a˘i⁄
(
W‹ldS˚√
* 
s˚√
, 
Dúe˘i⁄
 
a˘i⁄
, 
Mem‹y
* 
Àvñ_mem‹y
);

29 
W‹ldS˚√
* 
£tup_w‹ld_s˚√
(
TimeMachöeEdô‹
* 
buûd_‰om
, 
Mem‹y
* 
w‹ld_s˚√_mem‹y
, 
SCENE_TYPE
 
go_to_⁄_back•a˚
);

30 
boﬁ
 
™y_Àvñs_À·_a˘ive
(
W‹ldS˚√
* 
to_check
);

31 
W‹ldS˚√
* 
w‹ld_de£rülize
(
°d
::
°rög
 
w‹ld
, 
Mem‹y
* 
sc›e
, Mem‹y* 
ãmp
);

32 
W‹ldPosôi⁄
 
w‹ld_maybe_föd_∂ayî
(
W‹ldS˚√
* 
s˚√
);

	@draw.cpp

1 
	~"M©h.h
"

2 
	~"Shadî.h
"

3 
	~<gœd\gœd.h
>

4 
	~"Hñ≥rGL.h
"

5 
	~"døw.h
"

6 
	~"GameSèã.h
"

7 
	~"Resour˚.h
"

8 
	~"•rôe.h
"

10 c⁄° 
	gMAX_NUM_FULL_SPRITES
 = 100;

12 
	$døw_bœck_box_ovî_s¸ìn
(
GameS∑˚Camîa
 
s¸ìn
, 
S¥ôeWrôe
* 
öfo
)

14 
öfo
->
m©rix_˝u
[öfo->
num_døw
] = 
glm
::
	`m©4
(1.0f);

15 
öfo
->
m©rix_˝u
[öfo->
num_døw
] = 
glm
::
	`å™¶©e
(öfo->m©rix_˝u[öfo->num_døw], glm::
	`vec3
(
s¸ìn
.
À·
, s¸ìn.
down
, 10));

16 
height
 = 
s¸ìn
.
up
 - s¸ìn.
down
;

17 
width
 = 
s¸ìn
.
right
 - s¸ìn.
À·
;

18 
öfo
->
m©rix_˝u
[öfo->
num_døw
] = 
glm
::
	`sˇÀ
(öfo->m©rix_˝u[öfo->num_døw], glm::
	`vec3
(
width
, 
height
, 1));

19 
öfo
->
©œs_˝u
[öfo->
num_døw
] = info->
©œs_m≠≥r
[
	`ªsour˚_Êo‹_to_•rôe
(
F_ZBLACK
)];

20 
öfo
->
num_døw
++;

21 
	}
}

22 
	$døw_ouéöe_to_game•a˚
(
AABB
 
ouéöe
, 
S¥ôeWrôe
* 
öfo
)

24 
öfo
->
m©rix_˝u
[öfo->
num_døw
] = 
glm
::
	`m©4
(1.0f);

25 
öfo
->
m©rix_˝u
[öfo->
num_døw
] = 
glm
::
	`å™¶©e
(öfo->m©rix_˝u[öfo->num_døw], glm::
	`vec3
(
ouéöe
.
x
, ouéöe.
y
, 5));

26 
öfo
->
m©rix_˝u
[öfo->
num_døw
] = 
glm
::
	`sˇÀ
(öfo->m©rix_˝u[öfo->num_døw], glm::
	`vec3
(
ouéöe
.
w
, ouéöe.
h
, 1));

27 
öfo
->
©œs_˝u
[öfo->
num_døw
] = info->
©œs_m≠≥r
[
	`ªsour˚_Êo‹_to_•rôe
(
F_ZBLACK
)];

28 
öfo
->
num_døw
++;

29 
	}
}

30 
	$døw_game°©es_ouéöes_to_game•a˚
(
GameSèã
** 
game°©es
, 
I¡Paú
* 
off£ts
, 
Àngth_fun˘i⁄_öput
, 
S¥ôeWrôe
* 
öfo
, 
skù_ödex
)

32 
z
 = 0; z < 
skù_ödex
; z++)

34 
w
 = 
game°©es
[
z
]->w;

35 
h
 = 
game°©es
[
z
]->h;

36 
I¡Paú
 
°¨tPos
 = 
off£ts
[
z
];

37 
glm
::
m©4
 
föÆ
 = glm::
	`m©4
(1.0f);

38 
föÆ
 = 
glm
::
	`å™¶©e
(föÆ, glm::
	`vec3
(
°¨tPos
.
x
 - 
OUTLINE_DRAW_SIZE
, sèπPos.
y
 - OUTLINE_DRAW_SIZE, 0));

39 
föÆ
 = 
glm
::
	`sˇÀ
(föÆ, glm::
	`vec3
(
w
 + 
OUTLINE_DRAW_SIZE
 * 2, 
h
 + OUTLINE_DRAW_SIZE * 2, 1));

40 
öfo
->
m©rix_˝u
[öfo->
num_døw
] = 
föÆ
;

41 
öfo
->
©œs_˝u
[öfo->
num_døw
] = info->
©œs_m≠≥r
[
	`ªsour˚_Êo‹_to_•rôe
(
F_ZBLACK
)];

42 
öfo
->
num_døw
++;

44 
z
 = 
skù_ödex
 + 1; z < 
Àngth_fun˘i⁄_öput
; z++)

46 
w
 = 
game°©es
[
z
]->w;

47 
h
 = 
game°©es
[
z
]->h;

48 
I¡Paú
 
°¨tPos
 = 
off£ts
[
z
];

49 
glm
::
m©4
 
föÆ
 = glm::
	`m©4
(1.0f);

50 
föÆ
 = 
glm
::
	`å™¶©e
(föÆ, glm::
	`vec3
(
°¨tPos
.
x
 - 
OUTLINE_DRAW_SIZE
, sèπPos.
y
 - OUTLINE_DRAW_SIZE, 0));

51 
föÆ
 = 
glm
::
	`sˇÀ
(föÆ, glm::
	`vec3
(
w
 + 
OUTLINE_DRAW_SIZE
 * 2, 
h
 + OUTLINE_DRAW_SIZE * 2, 1));

52 
öfo
->
m©rix_˝u
[öfo->
num_døw
] = 
föÆ
;

53 
öfo
->
©œs_˝u
[öfo->
num_døw
] = info->
©œs_m≠≥r
[
	`ªsour˚_Êo‹_to_•rôe
(
F_ZBLACK
)];

54 
öfo
->
num_døw
++;

56 
	}
}

57 
	$døw_ui_to_game•a˚
(
GameS∑˚Camîa
 
døw_¨ó
, 
ödex
, 
S¥ôeWrôe
* 
døw_öfo
, 
glm
::
vec4
 
cﬁ‹
)

59 
cuºít_døw
 = 
døw_öfo
->
num_døw
;

60 
døw_öfo
->
©œs_˝u
[
cuºít_døw
] = døw_öfo->
©œs_m≠≥r
[
ödex
];

61 
døw_öfo
->
m©rix_˝u
[
cuºít_døw
] = 
glm
::
	`m©4
(1.0f);

62 
døw_öfo
->
m©rix_˝u
[
cuºít_døw
] = 
glm
::
	`å™¶©e
(døw_öfo->m©rix_˝u[cuºít_døw], glm::
	`vec3
(
døw_¨ó
.
À·
, døw_¨ó.
down
, 1));

63 
width
 = 
døw_¨ó
.
right
 - døw_¨ó.
À·
;

64 
height
 = 
døw_¨ó
.
up
 - døw_¨ó.
down
;

65 
døw_öfo
->
m©rix_˝u
[
cuºít_døw
] = 
glm
::
	`sˇÀ
(døw_öfo->m©rix_˝u[cuºít_døw], glm::
	`vec3
(
width
, 
height
, 1));

66 
døw_öfo
->
cﬁ‹_˝u
[
cuºít_døw
] = 
cﬁ‹
;

67 
døw_öfo
->
num_døw
++;

69 
	}
};

70 
	$døw_buâ⁄_to_game•a˚
(
GameS∑˚Camîa
 
døw_¨ó
, 
S¥ôeWrôe
 * 
ui_døw
, 
glm
::
vec4
 
cﬁ‹
)

73 
width
 = 
døw_¨ó
.
right
 - døw_¨ó.
À·
;

74 
height
 = 
døw_¨ó
.
up
 - døw_¨ó.
down
;

75 i‡(
height
 >
width
)

77 
	`¸ash_îr
("we can't drawá button if it isn'tátÜeast 1x1,Åhe draw won't work");

82 
GameS∑˚Camîa
 
À·_døw
 = 
døw_¨ó
;

83 
À·_døw
.
right
 =Üe·_døw.
À·
 + 0.5‡* 
height
;

84 
	`døw_ui_to_game•a˚
(
À·_døw
,
ãxtuªAs£ts
::
UI
::
Buâ⁄Le·HÆf
, 
ui_døw
, 
cﬁ‹
);

88 
GameS∑˚Camîa
 
middÀ_døw
 = 
døw_¨ó
;

89 
middÀ_døw
.
À·
 +0.5‡* 
height
;

90 
middÀ_døw
.
right
 -0.5‡* 
height
;

91 
	`døw_ui_to_game•a˚
(
middÀ_døw
, 
ãxtuªAs£ts
::
UI
::
Buâ⁄Cíãr
, 
ui_døw
, 
cﬁ‹
);

93 i‡(
height
 !
width
)

95 
GameS∑˚Camîa
 
right_døw
 = 
døw_¨ó
;

96 
right_døw
.
À·
 =Ñight_døw.
right
 - 0.5‡* 
height
;

97 
	`døw_ui_to_game•a˚
(
right_døw
,
ãxtuªAs£ts
::
UI
::
Buâ⁄RightHÆf
 ,
ui_døw
, 
cﬁ‹
);

100 
	}
}

102 
	$mask_•rôe_usög_wödow
(
glm
::
vec4
* 
døw_squ¨e
, glm::vec4* 
ãx_co‹d
, glm::vec4 
wödow
, glm::
vec2
 
ãx_movemít
)

104 
glm
::
vec4
 
√xt_døw_squ¨e
;

107 
√xt_døw_squ¨e
.
x
 = 
	`maxf
(
døw_squ¨e
->x, 
wödow
.x);

108 
√xt_døw_squ¨e
.
z
 = 
	`möf
(
døw_squ¨e
->z, 
wödow
.z);

109 
√xt_døw_squ¨e
.
y
 = 
	`maxf
(
døw_squ¨e
->y, 
wödow
.y);

110 
√xt_døw_squ¨e
.
w
 = 
	`möf
(
døw_squ¨e
->w, 
wödow
.w);

113 autÿ
dëîmöe_©œs_ch™ge
 = [](
pos
, 
wödow
, 
Àngth_squ¨e
) -> 

115 
≥r˚¡age_ch™ge
 = (
pos
 - 
wödow
Ë/ 
Àngth_squ¨e
;

116  
≥r˚¡age_ch™ge
;

118 
glm
::
vec4
 
√xt_ãx_co‹d
;

120 
width
 = 
døw_squ¨e
->
z
 - døw_squ¨e->
x
;

121 
height
 = 
døw_squ¨e
->
w
 - døw_squ¨e->
y
;

123 
À·
 = 
	`˛ampf
(0, 1, 0 - 
ãx_movemít
.
x
 / 
width
);

124 
right
 = 
	`˛ampf
(0, 1, 1 - 
ãx_movemít
.
x
 / 
width
);

125 
down
 = 
	`˛ampf
(0, 1, 0 - 
ãx_movemít
.
y
 / 
height
);

126 
up
 = 
	`˛ampf
(0, 1, 1 - 
ãx_movemít
.
y
 / 
height
);

128 
√xt_ãx_co‹d
.
x
 = 
	`ÀΩ
(
ãx_co‹d
->x,Åex_co‹d->
z
, 
À·
);

129 
√xt_ãx_co‹d
.
z
 = 
	`ÀΩ
(
ãx_co‹d
->
x
,Åex_co‹d->z, 
right
);

130 
√xt_ãx_co‹d
.
y
 = 
	`ÀΩ
(
ãx_co‹d
->y,Åex_co‹d->
w
, 
down
);

131 
√xt_ãx_co‹d
.
w
 = 
	`ÀΩ
(
ãx_co‹d
->
y
,Åex_co‹d->w, 
up
);

134 *
døw_squ¨e
 = 
√xt_døw_squ¨e
;

135 *
ãx_co‹d
 = 
√xt_ãx_co‹d
;

136 
	}
}

137 
	$døw_œyî_to_game•a˚
(
GameSèã
** 
game°©es
, 
I¡Paú
* 
off£ts
, 
numbî_of_game°©es
, 
S¥ôeWrôe
* 
öfo
, 
œyî_ödex
)

139 
i
 = 
œyî_ödex
;

141 
z
 = 0; z < 
numbî_of_game°©es
; z++)

143 
GameSèã
* 
game°©e
 = 
game°©es
[
z
];

144 
I¡Paú
 
off£t
 = 
off£ts
[
z
];

145 * 
cuºít_œyî
 = 
	`game°©e_gë_œyî
(
game°©e
,
œyî_ödex
);

146 
num_ñemíts_ö_game°©e
 = 
game°©e
->
w
 * game°©e->
h
;

147 
k
 = 0; k < 
num_ñemíts_ö_game°©e
; k++)

149 
ñe
 = 
cuºít_œyî
[
k
];

150 
ñe_image
 = 
	`ªsour˚_œyî_vÆue_to_œyî_•rôe_vÆue
(
ñe
, 
i
);

151 
öfo
->
©œs_˝u
[öfo->
num_døw
 + 
k
] = info->
©œs_m≠≥r
[
ñe_image
];

152 
I¡Paú
 
p
 = 
	`t2D
(
k
, 
game°©e
->
w
, game°©e->
h
);

153 
glm
::
vec3
 
å™¶©e
 = glm::
	`vec3
(
off£t
.
x
 + 
p
.x, off£t.
y
 +Ö.y, 
Z_POSITION_STARTING_LAYER
 + 
i
);

154 
öfo
->
m©rix_˝u
[öfo->
num_døw
 + 
k
] = 
	`m©h_å™¶©ed_m©rix
(
å™¶©e
);

155 
öfo
->
cﬁ‹_˝u
[öfo->
num_døw
+ 
k
] = 
glm
::
	`vec4
(1, 1, 1, 1);

157 
öfo
->
num_døw
 +
num_ñemíts_ö_game°©e
;

160 
	}
}

161 
	$døw_•rôe
(
©œs_ñe
, 
glm
::
m©4
 
posôi⁄
, 
S¥ôeWrôe
* 
wrôe_to
)

163 
glm
::
vec4
 
©œs_co‹ds
 = 
wrôe_to
->
©œs_m≠≥r
[
©œs_ñe
];

164 
d
 = 
wrôe_to
->
num_døw
;

165 
wrôe_to
->
©œs_˝u
[
d
] = 
©œs_co‹ds
;

166 
wrôe_to
->
m©rix_˝u
[
d
] = 
posôi⁄
;

167 
wrôe_to
->
cﬁ‹_˝u
[
d
] = 
glm
::
	`vec4
(1, 1, 1, 1);

168 
wrôe_to
->
num_døw
++;

169 
	}
}

173 
døw_põ˚_d©a
(
Põ˚D©a
 
põ˚_d©a
, 
glm
::
vec2
 
døw_°¨t
, 
S¥ôeWrôe
* 
symbﬁs
, glm::
vec3
 
globÆ_sˇÀ
 = glm::
	$vec3
(1,1,1))

176 
Àngth
 = 
CP_COUNT
;

177 
tŸÆ
 = 0;

178 
i
 = 0; i < 
Àngth
; i++)

179 
tŸÆ
 +
põ˚_d©a
.
powîs
[
i
];

181 
num_døwn
 = 0;

182 
width
 = (Ë
	`˚û
(
	`sqπ
(
tŸÆ
));

184 
j
 = 0; j < 
Àngth
; j++)

186 i‡(
põ˚_d©a
.
powîs
[
j
])

189 
to_døw
 = 
	`põ˚d©a_to_symbﬁ
((
CøãPowî
Ë
j
);

190 
glm
::
vec3
 
døw_posôi⁄
 = glm::
	`vec3
(
num_døwn
 % 
width
,Çum_drawn / width, 6);

191 
glm
::
vec3
 
sˇÀ
 = glm::
	`vec3
(1.0 / ()
width
, 1.0 / ()width, 1);

192 
sˇÀ
.
x
 -= 0.10f;

193 
sˇÀ
.
y
 -= 0.10f;

194 
døw_posôi⁄
.
x
 /()
width
;

195 
døw_posôi⁄
.
y
 /()
width
;

196 
døw_posôi⁄
.
x
 +
døw_°¨t
.x;

197 
døw_posôi⁄
.
y
 +
døw_°¨t
.y;

198 
døw_posôi⁄
.
x
 += 0.05f;

199 
døw_posôi⁄
.
y
 += 0.05f;

200 
num_døwn
++;

201 
glm
::
m©4
 
m©rix_døwn
 = 
	`m©h_å™¶©ed_sˇÀd_m©rix
(
døw_posôi⁄
, 
sˇÀ
 * 
globÆ_sˇÀ
);

202 
	`døw_•rôe
(
to_døw
, 
m©rix_døwn
, 
symbﬁs
);

206 
	}
};

208 
	$døw_game°©e_põ˚s
(
GameSèã
* 
game°©e
, 
I¡Paú
 
off£t
, 
AŒWrôe
* 
öfo
)

210 
GameSèã
* 
√xt
 = 
game°©e
;

211 
i
 = 0; i < 
√xt
->
w
 *Çext->
h
; i++)

212 i‡(
√xt
->
põ˚
[
i
] =
P_CRATE
)

214 
Põ˚D©a
 
põ˚_d©a
 = 
√xt
->põ˚_d©a[
i
];

215 
I¡Paú
 
°©e_off£t
 = 
off£t
;

216 
I¡Paú
 
grid_off£t
 = 
	`t2D
(
i
, 
√xt
->
w
,Çext->
h
);

217 
glm
::
vec2
 
døw_off£t
 = glm::
	`vec2
(
°©e_off£t
.
x
 + 
grid_off£t
.x, sèã_off£t.
y
 + grid_offset.y);

218 
	`døw_põ˚_d©a
(
põ˚_d©a
, 
døw_off£t
, 
öfo
->
symbﬁ
);

221 
	}
}

223 
	$døw_game•a˚
(
GameSèã
** 
game°©es
, 
I¡Paú
* 
off£ts
, 
numbî_of_game°©es
, 
AŒWrôe
* 
öfo
)

227 
	`døw_œyî_to_game•a˚
(
game°©es
, 
off£ts
, 
numbî_of_game°©es
, 
öfo
->
Êo‹
, 0);

228 
	`døw_œyî_to_game•a˚
(
game°©es
, 
off£ts
, 
numbî_of_game°©es
, 
öfo
->
põ˚
, 1);

230 
z
 = 0; z < 
numbî_of_game°©es
;z++)

232 
GameSèã
* 
√xt
 = 
game°©es
[
z
];

233 
I¡Paú
 
off£t
 = 
off£ts
[
z
];

234 
	`døw_game°©e_põ˚s
(
√xt
, 
off£t
, 
öfo
);

237 
	}
}

239 
	$døw_∑Àâe
(
I¡Paú
 
∑Àã_s¸ìn_°¨t
,

240 
GameS∑˚Camîa
 
ˇmîa_game
,

241 
VõwP‹tCamîa
 
ˇmîa_võwp‹t
,

242 
Edô‹UISèã
* 
ui_°©e
,

243 
∑Àã_Àngth
,

244 
Game°©eBrush
* 
∑Àã
,

245 
AŒWrôe
* 
œyî_døw
)

250 
glm
::
vec2
 
∑Àã_åue_°¨t
 = 
	`m©h_s¸ìn•a˚_to_game•a˚
(
∑Àã_s¸ìn_°¨t
, 
ˇmîa_game
, 
ˇmîa_võwp‹t
, 
ui_°©e
->
game_height_cuºít
);

251 
i
 = 0; i < 
∑Àã_Àngth
; i++)

253 i‡(
∑Àã
[
i
].
≠∂yFlo‹
)

255 
S¥ôeWrôe
* 
Êo‹
 = 
œyî_døw
->floor;

256 
ñe_image
 = 
	`ªsour˚_œyî_vÆue_to_œyî_•rôe_vÆue
(
∑Àã
[
i
].
Êo‹
, 
LN_FLOOR
);

257 
Êo‹
->
©œs_˝u
[Êo‹->
num_døw
] = flo‹->
©œs_m≠≥r
[
ñe_image
];

258 
Êo‹
->
m©rix_˝u
[Êo‹->
num_døw
] = 
	`m©h_å™¶©ed_m©rix
(
glm
::
	`vec3
(
∑Àã_åue_°¨t
.
x
 + 
i
,ÖÆëe_åue_°¨t.
y
,4));

259 
Êo‹
->
cﬁ‹_˝u
[Êo‹->
num_døw
] = 
glm
::
	`vec4
(1, 1, 1, 1);

260 
Êo‹
->
num_døw
++;

262 i‡(
∑Àã
[
i
].
≠∂yPõ˚
)

266 
S¥ôeWrôe
* 
põ˚
 = 
œyî_døw
->piece;

267 
ñe_image
 = 
	`ªsour˚_œyî_vÆue_to_œyî_•rôe_vÆue
(
∑Àã
[
i
].
põ˚
, 
LN_PIECE
);

268 
põ˚
->
©œs_˝u
[põ˚->
num_døw
] =Öõ˚->
©œs_m≠≥r
[
ñe_image
];

269 
põ˚
->
m©rix_˝u
[põ˚->
num_døw
] = 
	`m©h_å™¶©ed_m©rix
(
glm
::
	`vec3
(
∑Àã_åue_°¨t
.
x
 + 
i
,ÖÆëe_åue_°¨t.
y
, 5));

270 
põ˚
->
cﬁ‹_˝u
[põ˚->
num_døw
] = 
glm
::
	`vec4
(1, 1, 1, 1);

271 
põ˚
->
num_døw
++;

274 if(
∑Àã
[
i
].
≠∂yCøãPowî
)

277 
Põ˚D©a
 
põ˚_d©a
 = 
∑Àã
[
i
].piece_data;

278 
	`døw_põ˚_d©a
(
põ˚_d©a
,
glm
::
	`vec2
(
∑Àã_åue_°¨t
.
x
 + 
i
,∑Àã_åue_°¨t.
y
), 
œyî_døw
->
symbﬁ
, glm::
	`vec3
(1,1,1));

282 
	}
}

	@draw.h

1 #¥agm®
⁄˚


2 
	~"Anim©i⁄.h
"

3 
	~"Edô‹.h
"

4 
	~"Click.h
"

5 
	~"•rôe.h
"

6 
	~"ãxtuªAs£ts.h
"

10 
døw_œyî_to_game•a˚
(
GameSèã
** 
game°©es
, 
I¡Paú
* 
off£ts
, 
numbî_of_game°©es
, 
S¥ôeWrôe
* 
öfo
, 
œyî_ödex
);

11 
døw_game•a˚
(
GameSèã
** 
game°©es
, 
I¡Paú
* 
off£ts
, 
numbî_of_game°©es
, 
AŒWrôe
* 
öfo
);

12 
døw_game°©es_ouéöes_to_game•a˚
(

13 
GameSèã
** 
game°©es
,

14 
I¡Paú
* 
off£ts
,

15 
Àngth_fun˘i⁄_öput
,

16 
S¥ôeWrôe
* 
öfo
,

17 
ödex
);

18 
døw_∑Àâe
(
I¡Paú
 
∑Àã_s¸ìn_°¨t
,

19 
GameS∑˚Camîa
 
ˇmîa_game
,

20 
VõwP‹tCamîa
 
ˇmîa_võwp‹t
,

21 
Edô‹UISèã
* 
ui_°©e
,

22 
∑Àã_Àngth
,

23 
Game°©eBrush
* 
∑Àã
,

24 
AŒWrôe
* 
œyî_døw
);

25 
døw_bœck_box_ovî_s¸ìn
(
GameS∑˚Camîa
 
s¸ìn
, 
S¥ôeWrôe
* 
öfo
);

26 
døw_ouéöe_to_game•a˚
(
AABB
 
ouéöe
, 
S¥ôeWrôe
* 
öfo
);

27 
døw_buâ⁄_to_game•a˚
(
GameS∑˚Camîa
 
døw_¨ó
, 
S¥ôeWrôe
* 
ui_døw
, 
glm
::
vec4
 
cﬁ‹
 = glm::vec4(1,1,1,1));

28 
døw_ui_to_game•a˚
(
GameS∑˚Camîa
 
døw_¨ó
, 
ödex
, 
S¥ôeWrôe
* 
døw_öfo
, 
glm
::
vec4
 
cﬁ‹
 = glm::vec4(1, 1, 1, 1));

	@gui.h

1 #¥agm®
⁄˚


2 
	~<°rög
>

3 
	~"glm/glm.hµ
"

5 (*
	tgui_fun˘i⁄
)();

6 
	sGUI


11 
	sGUI_Text


13 
°d
::
°rög
 
ãxt
;

14 
glm
::
vec3
 
posôi⁄
;

15 
glm
::
vec2
 
sˇÀ
;

18 
	sGUI_Buâ⁄


20 
°d
::
°rög
 
ãxt
;

21 
glm
::
vec3
 
posôi⁄
;

22 
glm
::
vec2
 
sˇÀ
;

23 
glm
::
vec4
 
cﬁ‹
;

24 
gui_fun˘i⁄
 
fun˘i⁄
;

26 
	sGUI_Buâ⁄s


28 
°d
::
°rög
* 
ãxts
;

29 
glm
::
vec3
* 
posôi⁄s
;

30 
glm
::
vec2
 
sˇÀs
;

31 
glm
::
vec4
 
cﬁ‹s
;

32 
gui_fun˘i⁄
* 
fun˘i⁄s
;

34 
	sGUI_Míu


36 
Àngth
;

37 
buâ⁄_£À˘ed
;

38 
GUI_Buâ⁄
* 
buâ⁄s
;

41 
	$ˇlcuœã_buâ⁄_˛icked_ªad⁄ly
(
GUI_Buâ⁄
* 
buâ⁄s
, 
glm
::
vec2
 
mou£pos
)

44 
	}
}

	@sprite.cpp

1 
	~"•rôe.h
"

3 
S¥ôeWrôe
* 
	$•rôe_wrôe_make
(
GLuöt
 
©œs_ãxtuª
, 
Shadî
 
shadî
, 
Mem‹y
* 
≥rm™ít_mem‹y
, 
max_døw
, GLuöà
vîti˚s_VBO
, GLuöà
vîti˚s_EBO
, 
glm
::
vec4
* 
©œs_m≠≥r
)

5 
S¥ôeWrôe
* 
ªsu…
 = (S¥ôeWrôe*)
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, (SpriteWrite));

6 
ªsu…
->
shadî
 = shader;

7 
ªsu…
->
©œs_ãxtuª
 =átlas_texture;

8 
ªsu…
->
max_døw
 = 0;

9 
ªsu…
->
num_døw
 = 0;

10 
ªsu…
->
©œs_˝u
 = (
glm
::
vec4
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, 
max_døw
 * (glm::vec4));

11 
ªsu…
->
©œs_m≠≥r
 =átlas_mapper;

12 
ªsu…
->
m©rix_˝u
 = (
glm
::
m©4
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, 
max_døw
 * (glm::mat4));

13 
ªsu…
->
cﬁ‹_˝u
 = (
glm
::
vec4
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, 
max_døw
 * (glm::vec4));

15 
	`shadî_u£
(
shadî
);

18 
	`glGíVîãxAºays
(1, &
ªsu…
->
VAO
);

19 
	`glBödVîãxAºay
(
ªsu…
->
VAO
);

21 
	`glGíVîãxAºays
(1, &
ªsu…
->
VAO
); 
CHK


22 
	`glBödVîãxAºay
(
ªsu…
->
VAO
); 
CHK


24 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
vîti˚s_VBO
); 
CHK


25 
	`glBödBuf„r
(
GL_ELEMENT_ARRAY_BUFFER
, 
vîti˚s_EBO
); 
CHK


27 
posôi⁄
 = 
	`glGëAâribLoˇti⁄
(
shadî
, "pos"); 
CHK


28 
	`glVîãxAâribPoöãr
(
posôi⁄
, 3, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)0); 
CHK


29 
	`glE«bÀVîãxAâribAºay
(
posôi⁄
); 
CHK


31 
ãxCo‹d
 = 
	`glGëAâribLoˇti⁄
(
shadî
, "öputTexCo‹d"); 
CHK


32 
	`glVîãxAâribPoöãr
(
ãxCo‹d
, 2, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)(3 * ())); 
CHK


33 
	`glE«bÀVîãxAâribAºay
(
ãxCo‹d
); 
CHK


35 
	`glGíBuf„rs
(1, &
ªsu…
->
m©rix_buf
); 
CHK


36 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
ªsu…
->
m©rix_buf
); 
CHK


37 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
glm
::
m©4
Ë* 
max_døw
, 
NULL
, 
GL_DYNAMIC_DRAW
); 
CHK


39 
m©rixOff£t
 = 4;

40 
	`glVîãxAâribPoöãr
(
m©rixOff£t
, 4, 
GL_FLOAT
, 
Ál£
, 16 * (), (*)0); 
CHK


41 
	`glVîãxAâribPoöãr
(
m©rixOff£t
 + 1, 4, 
GL_FLOAT
, 
Ál£
, 16 * (), (*)(4 * ())); 
CHK


43 
	`glVîãxAâribPoöãr
(
m©rixOff£t
 + 2, 4, 
GL_FLOAT
, 
Ál£
, 16 * (), (*)(8 * ())); 
CHK


44 
	`glVîãxAâribPoöãr
(
m©rixOff£t
 + 3, 4, 
GL_FLOAT
, 
Ál£
, 16 * (), (*)(12 * ())); 
CHK


45 
	`glE«bÀVîãxAâribAºay
(
m©rixOff£t
); 
CHK


46 
	`glE«bÀVîãxAâribAºay
(
m©rixOff£t
 + 1); 
CHK


47 
	`glE«bÀVîãxAâribAºay
(
m©rixOff£t
 + 2); 
CHK


48 
	`glE«bÀVîãxAâribAºay
(
m©rixOff£t
 + 3); 
CHK


49 
	`glVîãxAâribDivis‹
(
m©rixOff£t
, 1); 
CHK


50 
	`glVîãxAâribDivis‹
(
m©rixOff£t
 + 1, 1); 
CHK


51 
	`glVîãxAâribDivis‹
(
m©rixOff£t
 + 2, 1); 
CHK


52 
	`glVîãxAâribDivis‹
(
m©rixOff£t
 + 3, 1); 
CHK


54 
	`glGíBuf„rs
(1, &
ªsu…
->
©œs_buf
); 
CHK


55 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
ªsu…
->
©œs_buf
); 
CHK


56 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
glm
::
vec4
Ë* 
max_døw
, 
NULL
, 
GL_DYNAMIC_DRAW
); 
CHK


58 
©œsOff£t
 = 
	`glGëAâribLoˇti⁄
(
shadî
, "atlasCoord");

59 
	`glVîãxAâribPoöãr
(
©œsOff£t
, 4, 
GL_FLOAT
, 
Ál£
, 4 * (), (*)(0)); 
CHK


60 
	`glE«bÀVîãxAâribAºay
(
©œsOff£t
); 
CHK


61 
	`glVîãxAâribDivis‹
(
©œsOff£t
, 1); 
CHK


63 
	`glGíBuf„rs
(1, &
ªsu…
->
cﬁ‹_buf
); 
CHK


64 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
ªsu…
->
cﬁ‹_buf
); 
CHK


65 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
glm
::
vec4
Ë* 
max_døw
, 
NULL
, 
GL_DYNAMIC_DRAW
); 
CHK


67 
cﬁ‹Off£t
 = 3;

68 
	`glVîãxAâribPoöãr
(
cﬁ‹Off£t
, 4, 
GL_FLOAT
, 
Ál£
, 4 * (), (*)(0)); 
CHK


69 
	`glE«bÀVîãxAâribAºay
(
cﬁ‹Off£t
); 
CHK


70 
	`glVîãxAâribDivis‹
(
cﬁ‹Off£t
, 1); 
CHK


71 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
vîti˚s_VBO
); 
CHK


72 
	`glBödBuf„r
(
GL_ELEMENT_ARRAY_BUFFER
, 
vîti˚s_EBO
); 
CHK


74  
ªsu…
;

75 
	}
}

77 
	$•rôe_wrôe_out
(
S¥ôeWrôe
* 
out
, 
glm
::
m©4
 
ˇmîa
)

79 
	`shadî_£t_unif‹m_m©4
(
out
->
shadî
, "võwProje˘i⁄M©rix", 
ˇmîa
);

81 
	`glU£Progøm
(
out
->
shadî
);

82 
	`glBödVîãxAºay
(
out
->
VAO
);

83 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
out
->
©œs_buf
);

84 
	`glBuf„rSubD©a
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec4
Ë* 
out
->
num_døw
, out->
©œs_˝u
);

86 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
out
->
m©rix_buf
);

87 
	`glBuf„rSubD©a
(
GL_ARRAY_BUFFER
, 0, (
glm
::
m©4
Ë* 
out
->
num_døw
, out->
m©rix_˝u
);

89 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
out
->
cﬁ‹_buf
);

90 
	`glBuf„rSubD©a
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec4
Ë* 
out
->
num_døw
, out->
cﬁ‹_˝u
);

92 
	`glBödTextuª
(
GL_TEXTURE_2D
, 
out
->
©œs_ãxtuª
);

93 
	`glDøwEÀmítsIn°™˚d
(
GL_TRIANGLES
, 6, 
GL_UNSIGNED_INT
, 0, 
out
->
num_døw
);

94 
	}
}

	@sprite.h

1 #¥agm®
⁄˚


3 #¥agm®
⁄˚


5 
	~"M©h.h
"

6 
	~"Shadî.h
"

7 
	~"Hñ≥rGL.h
"

8 
	~"TextDøw.h
"

11 
	tuöt
;

16 
	sS¥ôeWrôe
 {

17 
Shadî
 
	mshadî
;

18 
uöt
 
	m©œs_ãxtuª
;

20 
uöt
 
	mVAO
;

21 
uöt
 
	mm©rix_buf
;

22 
uöt
 
	m©œs_buf
;

23 
uöt
 
	mcﬁ‹_buf
;

25 
uöt
 
	mmax_døw
;

26 
uöt
 
	mnum_døw
;

27 
	mglm
::
vec4
* 
©œs_m≠≥r
;

28 
	mglm
::
vec4
* 
©œs_˝u
;

29 
	mglm
::
m©4
* 
m©rix_˝u
;

30 
	mglm
::
vec4
* 
cﬁ‹_˝u
;

32 
	sAŒWrôe


34 
S¥ôeWrôe
* 
	mÊo‹
;

35 
S¥ôeWrôe
* 
	mpõ˚
;

36 
S¥ôeWrôe
* 
	msymbﬁ
;

37 
S¥ôeWrôe
* 
	mui
;

38 
TextWrôe
* 
	mãxt
;

41 
S¥ôeWrôe
* 
•rôe_wrôe_make
(
GLuöt
 
©œs_ãxtuª
, 
Shadî
 
shadî
, 
Mem‹y
* 
≥rm™ít_mem‹y
, 
max_døw
, GLuöà
vîti˚s_VBO
, GLuöà
vîti˚s_EBO
, 
glm
::
vec4
* 
©œs_m≠≥r
);

43 
•rôe_wrôe_out
(
S¥ôeWrôe
* 
out
, 
glm
::
m©4
 
ˇmîa
);

	@stb_image.h

114 #i‚de‡
STBI_INCLUDE_STB_IMAGE_H


115 
	#STBI_INCLUDE_STB_IMAGE_H


	)

323 #i‚de‡
STBI_NO_STDIO


324 
	~<°dio.h
>

327 
	#STBI_VERSION
 1

	)

331 
	mSTBI_deÁu…
 = 0,

333 
	mSTBI_gªy
 = 1,

334 
	mSTBI_gªy_Æpha
 = 2,

335 
	mSTBI_rgb
 = 3,

336 
	mSTBI_rgb_Æpha
 = 4

339 
	~<°dlib.h
>

340 
	t°bi_uc
;

341 
	t°bi_us
;

343 #ifde‡
__˝lu•lus


347 #i‚de‡
STBIDEF


348 #ifde‡
STB_IMAGE_STATIC


349 
	#STBIDEF
 

	)

351 
	#STBIDEF
 

	)

366 (*
ªad
Ë(*
u£r
,*
d©a
,
size
);

367 (*
skù
Ë(*
u£r
,
n
);

368 (*
eof
Ë(*
u£r
);

369 } 
	t°bi_io_ˇŒbacks
;

376 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_‰om_mem‹y
 (°bi_u¯c⁄° *
buf„r
, 
Àn
 , *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

377 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
 , *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

379 #i‚de‡
STBI_NO_STDIO


380 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd
 (c⁄° *
fûíame
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

381 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_‰om_fûe
 (
FILE
 *
f
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

385 #i‚de‡
STBI_NO_GIF


386 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_gif_‰om_mem‹y
(°bi_u¯c⁄° *
buf„r
, 
Àn
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
);

389 #ifde‡
STBI_WINDOWS_UTF8


390 
STBIDEF
 
°bi_c⁄vît_wch¨_to_utf8
(*
buf„r
, 
size_t
 
buf„æí
, c⁄° 
wch¨_t
* 
öput
);

398 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_16_‰om_mem‹y
 (
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

399 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_16_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

401 #i‚de‡
STBI_NO_STDIO


402 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_16
 (c⁄° *
fûíame
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

403 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_‰om_fûe_16
(
FILE
 *
f
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

410 #i‚de‡
STBI_NO_LINEAR


411 
STBIDEF
 *
°bi_lﬂdf_‰om_mem‹y
 (
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

412 
STBIDEF
 *
°bi_lﬂdf_‰om_ˇŒbacks
 (
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

414 #i‚de‡
STBI_NO_STDIO


415 
STBIDEF
 *
°bi_lﬂdf
 (c⁄° *
fûíame
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

416 
STBIDEF
 *
°bi_lﬂdf_‰om_fûe
 (
FILE
 *
f
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

420 #i‚de‡
STBI_NO_HDR


421 
STBIDEF
 
°bi_hdr_to_ldr_gamma
(
gamma
);

422 
STBIDEF
 
°bi_hdr_to_ldr_sˇÀ
(
sˇÀ
);

425 #i‚de‡
STBI_NO_LINEAR


426 
STBIDEF
 
°bi_ldr_to_hdr_gamma
(
gamma
);

427 
STBIDEF
 
°bi_ldr_to_hdr_sˇÀ
(
sˇÀ
);

431 
STBIDEF
 
°bi_is_hdr_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
);

432 
STBIDEF
 
°bi_is_hdr_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
);

433 #i‚de‡
STBI_NO_STDIO


434 
STBIDEF
 
°bi_is_hdr
 (c⁄° *
fûíame
);

435 
STBIDEF
 
°bi_is_hdr_‰om_fûe
(
FILE
 *
f
);

441 
STBIDEF
 c⁄° *
°bi_Áûuª_ªas⁄
 ();

444 
STBIDEF
 
°bi_image_‰ì
 (*
ªtvÆ_‰om_°bi_lﬂd
);

447 
STBIDEF
 
°bi_öfo_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
);

448 
STBIDEF
 
°bi_öfo_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
comp
);

449 
STBIDEF
 
°bi_is_16_bô_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
);

450 
STBIDEF
 
°bi_is_16_bô_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
);

452 #i‚de‡
STBI_NO_STDIO


453 
STBIDEF
 
°bi_öfo
 (c⁄° *
fûíame
, *
x
, *
y
, *
comp
);

454 
STBIDEF
 
°bi_öfo_‰om_fûe
 (
FILE
 *
f
, *
x
, *
y
, *
comp
);

455 
STBIDEF
 
°bi_is_16_bô
 (c⁄° *
fûíame
);

456 
STBIDEF
 
°bi_is_16_bô_‰om_fûe
(
FILE
 *
f
);

464 
STBIDEF
 
°bi_£t_u≈ªmu…ùly_⁄_lﬂd
(
Êag_åue_if_should_u≈ªmu…ùly
);

468 
STBIDEF
 
°bi_c⁄vît_ùh⁄e_≤g_to_rgb
(
Êag_åue_if_should_c⁄vît
);

471 
STBIDEF
 
°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd
(
Êag_åue_if_should_Êù
);

476 
STBIDEF
 
°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd_thªad
(
Êag_åue_if_should_Êù
);

480 
STBIDEF
 *
°bi_zlib_decode_mÆloc_guesssize
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
);

481 
STBIDEF
 *
°bi_zlib_decode_mÆloc_guesssize_hódîÊag
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
, 
∑r£_hódî
);

482 
STBIDEF
 *
°bi_zlib_decode_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
);

483 
STBIDEF
 
°bi_zlib_decode_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
);

485 
STBIDEF
 *
°bi_zlib_decode_nohódî_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
);

486 
STBIDEF
 
°bi_zlib_decode_nohódî_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
);

489 #ifde‡
__˝lu•lus


498 #ifde‡
STB_IMAGE_IMPLEMENTATION


500 #i‡
deföed
(
STBI_ONLY_JPEG
Ë|| deföed(
STBI_ONLY_PNG
Ë|| deföed(
STBI_ONLY_BMP
) \

501 || 
deföed
(
STBI_ONLY_TGA
Ë|| deföed(
STBI_ONLY_GIF
Ë|| deföed(
STBI_ONLY_PSD
) \

502 || 
deföed
(
STBI_ONLY_HDR
Ë|| deföed(
STBI_ONLY_PIC
Ë|| deföed(
STBI_ONLY_PNM
) \

503 || 
	$deföed
(
STBI_ONLY_ZLIB
)

504 #i‚de‡
STBI_ONLY_JPEG


505 
	#STBI_NO_JPEG


	)

507 #i‚de‡
STBI_ONLY_PNG


508 
	#STBI_NO_PNG


	)

510 #i‚de‡
STBI_ONLY_BMP


511 
	#STBI_NO_BMP


	)

513 #i‚de‡
STBI_ONLY_PSD


514 
	#STBI_NO_PSD


	)

516 #i‚de‡
STBI_ONLY_TGA


517 
	#STBI_NO_TGA


	)

519 #i‚de‡
STBI_ONLY_GIF


520 
	#STBI_NO_GIF


	)

522 #i‚de‡
STBI_ONLY_HDR


523 
	#STBI_NO_HDR


	)

525 #i‚de‡
STBI_ONLY_PIC


526 
	#STBI_NO_PIC


	)

528 #i‚de‡
STBI_ONLY_PNM


529 
	#STBI_NO_PNM


	)

533 #i‡
	`deföed
(
STBI_NO_PNG
Ë&& !deföed(
STBI_SUPPORT_ZLIB
Ë&& !deföed(
STBI_NO_ZLIB
)

534 
	#STBI_NO_ZLIB


	)

538 
	~<°d¨g.h
>

539 
	~<°ddef.h
>

540 
	~<°dlib.h
>

541 
	~<°rög.h
>

542 
	~<limôs.h
>

544 #i‡!
	`deföed
(
STBI_NO_LINEAR
Ë|| !deföed(
STBI_NO_HDR
)

545 
	~<m©h.h
>

548 #i‚de‡
STBI_NO_STDIO


549 
	~<°dio.h
>

552 #i‚de‡
STBI_ASSERT


553 
	~<as£π.h
>

554 
	#STBI_ASSERT
(
x
Ë
	`as£π
(x)

	)

557 #ifde‡
__˝lu•lus


558 
	#STBI_EXTERN
 "C"

	)

560 
	#STBI_EXTERN
 

	)

564 #i‚de‡
_MSC_VER


565 #ifde‡
__˝lu•lus


566 
	#°bi_ölöe
 
ölöe


	)

568 
	#°bi_ölöe


	)

571 
	#°bi_ölöe
 
__f‹˚ölöe


	)

574 #i‚de‡
STBI_NO_THREAD_LOCALS


575 #i‡
	`deföed
(
__˝lu•lus
) && __cplusplus >= 201103L

576 
	#STBI_THREAD_LOCAL
 
thªad_loˇl


	)

577 #ñi‡
	`deföed
 (
__STDC_VERSION__
) && __STDC_VERSION__ >= 201112L

578 
	#STBI_THREAD_LOCAL
 
_Thªad_loˇl


	)

579 #ñi‡
	`deföed
(
__GNUC__
)

580 
	#STBI_THREAD_LOCAL
 
__thªad


	)

581 #ñi‡
	`deföed
(
_MSC_VER
)

582 
	#STBI_THREAD_LOCAL
 
	`__de˛•ec
(
thªad
)

	)

586 #ifde‡
_MSC_VER


587 
	t°bi__uöt16
;

588 sig√d 
	t°bi__öt16
;

589 
	t°bi__uöt32
;

590 sig√d 
	t°bi__öt32
;

592 
	~<°döt.h
>

593 
uöt16_t
 
	t°bi__uöt16
;

594 
öt16_t
 
	t°bi__öt16
;

595 
uöt32_t
 
	t°bi__uöt32
;

596 
öt32_t
 
	t°bi__öt32
;

600 
	tvÆid©e_uöt32
[(
°bi__uöt32
)==4 ? 1 : -1];

602 #ifde‡
_MSC_VER


603 
	#STBI_NOTUSED
(
v
Ë()(v)

	)

605 
	#STBI_NOTUSED
(
v
Ë()(v)

	)

608 #ifde‡
_MSC_VER


609 
	#STBI_HAS_LROTL


	)

612 #ifde‡
STBI_HAS_LROTL


613 
	#°bi_ÃŸ
(
x
,
y
Ë
	`_ÃŸl
(x,y)

	)

615 
	#°bi_ÃŸ
(
x
,
y
Ë(((xË<< (y)Ë| ((xË>> (32 - (y))))

	)

618 #i‡
	`deföed
(
STBI_MALLOC
Ë&& deföed(
STBI_FREE
Ë&& (deföed(
STBI_REALLOC
Ë|| deföed(
STBI_REALLOC_SIZED
))

620 #ñi‡!
	`deföed
(
STBI_MALLOC
Ë&& !deföed(
STBI_FREE
Ë&& !deföed(
STBI_REALLOC
Ë&& !deföed(
STBI_REALLOC_SIZED
)

626 #i‚de‡
STBI_MALLOC


627 
	#STBI_MALLOC
(
sz
Ë
	`mÆloc
(sz)

	)

628 
	#STBI_REALLOC
(
p
,
√wsz
Ë
	`ªÆloc
’,√wsz)

	)

629 
	#STBI_FREE
(
p
Ë
	`‰ì
’)

	)

632 #i‚de‡
STBI_REALLOC_SIZED


633 
	#STBI_REALLOC_SIZED
(
p
,
ﬁdsz
,
√wsz
Ë
	`STBI_REALLOC
’,√wsz)

	)

637 #i‡
	`deföed
(
__x86_64__
Ë|| deföed(
_M_X64
)

638 
	#STBI__X64_TARGET


	)

639 #ñi‡
	`deföed
(
__i386
Ë|| deföed(
_M_IX86
)

640 
	#STBI__X86_TARGET


	)

643 #i‡
	`deföed
(
__GNUC__
Ë&& deföed(
STBI__X86_TARGET
Ë&& !deföed(
__SSE2__
Ë&& !deföed(
STBI_NO_SIMD
)

651 
	#STBI_NO_SIMD


	)

654 #i‡
	`deföed
(
__MINGW32__
Ë&& deföed(
STBI__X86_TARGET
Ë&& !deföed(
STBI_MINGW_ENABLE_SSE2
Ë&& !deföed(
STBI_NO_SIMD
)

666 
	#STBI_NO_SIMD


	)

669 #i‡!
	`deföed
(
STBI_NO_SIMD
Ë&& (deföed(
STBI__X86_TARGET
Ë|| deföed(
STBI__X64_TARGET
))

670 
	#STBI_SSE2


	)

671 
	~<emmöåö.h
>

673 #ifde‡
_MSC_VER


675 #i‡
_MSC_VER
 >= 1400

676 
	~<öåö.h
>

677 
	$°bi__˝uid3
()

679 
öfo
[4];

680 
	`__˝uid
(
öfo
,1);

681  
öfo
[3];

682 
	}
}

684 
	$°bi__˝uid3
()

686 
ªs
;

687 
__asm
 {

688 
mov
 
óx
,1

689 
˝uid


690 
mov
 
ªs
,
edx


692  
ªs
;

693 
	}
}

696 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ë
	`__de˛•ec
(
	`Æign
(16)Ëty≥ 
	)
name

698 #i‡!
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_SSE2
)

699 
	$°bi__s£2_avaûabÀ
()

701 
öfo3
 = 
	`°bi__˝uid3
();

702  ((
öfo3
 >> 26) & 1) != 0;

703 
	}
}

707 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ëty≥Çamê
	`__©åibuã__
((
	`Æig√d
(16)))

	)

709 #i‡!
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_SSE2
)

710 
	$°bi__s£2_avaûabÀ
()

716 
	}
}

723 #i‡
deföed
(
STBI_NO_SIMD
Ë&& deföed(
STBI_NEON
)

724 #unde‡
STBI_NEON


727 #ifde‡
STBI_NEON


728 
	~<¨m_√⁄.h
>

730 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ëty≥Çamê
	`__©åibuã__
((
	`Æig√d
(16)))

	)

733 #i‚de‡
STBI_SIMD_ALIGN


734 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ëty≥ 
	)
name

745 
°bi__uöt32
 
	mimg_x
, 
	mimg_y
;

746 
	mimg_n
, 
	mimg_out_n
;

748 
°bi_io_ˇŒbacks
 
	mio
;

749 *
	mio_u£r_d©a
;

751 
	mªad_‰om_ˇŒbacks
;

752 
	mbuÊí
;

753 
°bi_uc
 
	mbuf„r_°¨t
[128];

755 
°bi_uc
 *
	mimg_buf„r
, *
	mimg_buf„r_íd
;

756 
°bi_uc
 *
	mimg_buf„r_‹igöÆ
, *
	mimg_buf„r_‹igöÆ_íd
;

757 } 
	t°bi__c⁄ãxt
;

760 
°bi__ªfûl_buf„r
(
°bi__c⁄ãxt
 *
s
);

763 
	$°bi__°¨t_mem
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 c⁄° *
buf„r
, 
Àn
)

765 
s
->
io
.
ªad
 = 
NULL
;

766 
s
->
ªad_‰om_ˇŒbacks
 = 0;

767 
s
->
img_buf„r
 = s->
img_buf„r_‹igöÆ
 = (
°bi_uc
 *Ë
buf„r
;

768 
s
->
img_buf„r_íd
 = s->
img_buf„r_‹igöÆ_íd
 = (
°bi_uc
 *Ë
buf„r
+
Àn
;

769 
	}
}

772 
	$°bi__°¨t_ˇŒbacks
(
°bi__c⁄ãxt
 *
s
, 
°bi_io_ˇŒbacks
 *
c
, *
u£r
)

774 
s
->
io
 = *
c
;

775 
s
->
io_u£r_d©a
 = 
u£r
;

776 
s
->
buÊí
 = (s->
buf„r_°¨t
);

777 
s
->
ªad_‰om_ˇŒbacks
 = 1;

778 
s
->
img_buf„r_‹igöÆ
 = s->
buf„r_°¨t
;

779 
	`°bi__ªfûl_buf„r
(
s
);

780 
s
->
img_buf„r_‹igöÆ_íd
 = s->
img_buf„r_íd
;

781 
	}
}

783 #i‚de‡
STBI_NO_STDIO


785 
	$°bi__°dio_ªad
(*
u£r
, *
d©a
, 
size
)

787  (Ë
	`‰ód
(
d©a
,1,
size
,(
FILE
*Ë
u£r
);

788 
	}
}

790 
	$°bi__°dio_skù
(*
u£r
, 
n
)

792 
	`f£ek
((
FILE
*Ë
u£r
, 
n
, 
SEEK_CUR
);

793 
	}
}

795 
	$°bi__°dio_eof
(*
u£r
)

797  
	`„of
((
FILE
*Ë
u£r
);

798 
	}
}

800 
°bi_io_ˇŒbacks
 
	g°bi__°dio_ˇŒbacks
 =

802 
°bi__°dio_ªad
,

803 
°bi__°dio_skù
,

804 
°bi__°dio_eof
,

807 
	$°bi__°¨t_fûe
(
°bi__c⁄ãxt
 *
s
, 
FILE
 *
f
)

809 
	`°bi__°¨t_ˇŒbacks
(
s
, &
°bi__°dio_ˇŒbacks
, (*Ë
f
);

810 
	}
}

816 
	$°bi__ªwöd
(
°bi__c⁄ãxt
 *
s
)

821 
s
->
img_buf„r
 = s->
img_buf„r_‹igöÆ
;

822 
s
->
img_buf„r_íd
 = s->
img_buf„r_‹igöÆ_íd
;

823 
	}
}

827 
	mSTBI_ORDER_RGB
,

828 
	mSTBI_ORDER_BGR


833 
	mbôs_≥r_ch™√l
;

834 
	mnum_ch™√ls
;

835 
	mch™√l_‹dî
;

836 } 
	t°bi__ªsu…_öfo
;

838 #i‚de‡
STBI_NO_JPEG


839 
°bi__j≥g_ã°
(
°bi__c⁄ãxt
 *
s
);

840 *
°bi__j≥g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

841 
°bi__j≥g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

844 #i‚de‡
STBI_NO_PNG


845 
°bi__≤g_ã°
(
°bi__c⁄ãxt
 *
s
);

846 *
°bi__≤g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

847 
°bi__≤g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

848 
°bi__≤g_is16
(
°bi__c⁄ãxt
 *
s
);

851 #i‚de‡
STBI_NO_BMP


852 
°bi__bmp_ã°
(
°bi__c⁄ãxt
 *
s
);

853 *
°bi__bmp_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

854 
°bi__bmp_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

857 #i‚de‡
STBI_NO_TGA


858 
°bi__tga_ã°
(
°bi__c⁄ãxt
 *
s
);

859 *
°bi__tga_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

860 
°bi__tga_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

863 #i‚de‡
STBI_NO_PSD


864 
°bi__psd_ã°
(
°bi__c⁄ãxt
 *
s
);

865 *
°bi__psd_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
, 
bpc
);

866 
°bi__psd_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

867 
°bi__psd_is16
(
°bi__c⁄ãxt
 *
s
);

870 #i‚de‡
STBI_NO_HDR


871 
°bi__hdr_ã°
(
°bi__c⁄ãxt
 *
s
);

872 *
°bi__hdr_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

873 
°bi__hdr_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

876 #i‚de‡
STBI_NO_PIC


877 
°bi__pic_ã°
(
°bi__c⁄ãxt
 *
s
);

878 *
°bi__pic_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

879 
°bi__pic_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

882 #i‚de‡
STBI_NO_GIF


883 
°bi__gif_ã°
(
°bi__c⁄ãxt
 *
s
);

884 *
°bi__gif_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

885 *
°bi__lﬂd_gif_maö
(
°bi__c⁄ãxt
 *
s
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
);

886 
°bi__gif_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

889 #i‚de‡
STBI_NO_PNM


890 
°bi__≤m_ã°
(
°bi__c⁄ãxt
 *
s
);

891 *
°bi__≤m_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

892 
°bi__≤m_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

896 #ifde‡
STBI_THREAD_LOCAL


897 
	gSTBI_THREAD_LOCAL


899 c⁄° *
	g°bi__g_Áûuª_ªas⁄
;

901 
STBIDEF
 c⁄° *
	$°bi_Áûuª_ªas⁄
()

903  
°bi__g_Áûuª_ªas⁄
;

904 
	}
}

906 #i‚de‡
STBI_NO_FAILURE_STRINGS


907 
	$°bi__îr
(c⁄° *
°r
)

909 
°bi__g_Áûuª_ªas⁄
 = 
°r
;

911 
	}
}

914 *
	$°bi__mÆloc
(
size_t
 
size
)

916  
	`STBI_MALLOC
(
size
);

917 
	}
}

931 
	$°bi__addsizes_vÆid
(
a
, 
b
)

933 i‡(
b
 < 0)  0;

938  
a
 <
INT_MAX
 - 
b
;

939 
	}
}

943 
	$°bi__mul2sizes_vÆid
(
a
, 
b
)

945 i‡(
a
 < 0 || 
b
 < 0)  0;

946 i‡(
b
 == 0)  1;

948  
a
 <
INT_MAX
/
b
;

949 
	}
}

951 #i‡!
deföed
(
STBI_NO_JPEG
Ë|| !deföed(
STBI_NO_PNG
Ë|| !deföed(
STBI_NO_TGA
Ë|| !deföed(
STBI_NO_HDR
)

953 
	$°bi__mad2sizes_vÆid
(
a
, 
b
, 
add
)

955  
	`°bi__mul2sizes_vÆid
(
a
, 
b
Ë&& 
	`°bi__addsizes_vÆid
◊*b, 
add
);

956 
	}
}

960 
	$°bi__mad3sizes_vÆid
(
a
, 
b
, 
c
, 
add
)

962  
	`°bi__mul2sizes_vÆid
(
a
, 
b
Ë&& stbi__mul2sizes_vÆid◊*b, 
c
) &&

963 
	`°bi__addsizes_vÆid
(
a
*
b
*
c
, 
add
);

964 
	}
}

967 #i‡!
deföed
(
STBI_NO_LINEAR
Ë|| !deföed(
STBI_NO_HDR
)

968 
	$°bi__mad4sizes_vÆid
(
a
, 
b
, 
c
, 
d
, 
add
)

970  
	`°bi__mul2sizes_vÆid
(
a
, 
b
Ë&& stbi__mul2sizes_vÆid◊*b, 
c
) &&

971 
	`°bi__mul2sizes_vÆid
(
a
*
b
*
c
, 
d
Ë&& 
	`°bi__addsizes_vÆid
◊*b*c*d, 
add
);

972 
	}
}

975 #i‡!
deföed
(
STBI_NO_JPEG
Ë|| !deföed(
STBI_NO_PNG
Ë|| !deföed(
STBI_NO_TGA
Ë|| !deföed(
STBI_NO_HDR
)

977 *
	$°bi__mÆloc_mad2
(
a
, 
b
, 
add
)

979 i‡(!
	`°bi__mad2sizes_vÆid
(
a
, 
b
, 
add
)Ë 
NULL
;

980  
	`°bi__mÆloc
(
a
*
b
 + 
add
);

981 
	}
}

984 *
	$°bi__mÆloc_mad3
(
a
, 
b
, 
c
, 
add
)

986 i‡(!
	`°bi__mad3sizes_vÆid
(
a
, 
b
, 
c
, 
add
)Ë 
NULL
;

987  
	`°bi__mÆloc
(
a
*
b
*
c
 + 
add
);

988 
	}
}

990 #i‡!
deföed
(
STBI_NO_LINEAR
Ë|| !deföed(
STBI_NO_HDR
)

991 *
	$°bi__mÆloc_mad4
(
a
, 
b
, 
c
, 
d
, 
add
)

993 i‡(!
	`°bi__mad4sizes_vÆid
(
a
, 
b
, 
c
, 
d
, 
add
)Ë 
NULL
;

994  
	`°bi__mÆloc
(
a
*
b
*
c
*
d
 + 
add
);

995 
	}
}

1002 #ifde‡
STBI_NO_FAILURE_STRINGS


1003 
	#°bi__îr
(
x
,
y
Ë0

	)

1004 #ñi‡
deföed
(
STBI_FAILURE_USERMSG
)

1005 
	#°bi__îr
(
x
,
y
Ë
	`°bi__îr
(y)

	)

1007 
	#°bi__îr
(
x
,
y
Ë
	`°bi__îr
(x)

	)

1010 
	#°bi__îΩf
(
x
,
y
Ë((*)(
size_t
Ë(
	`°bi__îr
(x,y)?
NULL
:NULL))

	)

1011 
	#°bi__îΩuc
(
x
,
y
Ë((*)(
size_t
Ë(
	`°bi__îr
(x,y)?
NULL
:NULL))

	)

1013 
STBIDEF
 
	$°bi_image_‰ì
(*
ªtvÆ_‰om_°bi_lﬂd
)

1015 
	`STBI_FREE
(
ªtvÆ_‰om_°bi_lﬂd
);

1016 
	}
}

1018 #i‚de‡
STBI_NO_LINEAR


1019 *
°bi__ldr_to_hdr
(
°bi_uc
 *
d©a
, 
x
, 
y
, 
comp
);

1022 #i‚de‡
STBI_NO_HDR


1023 
°bi_uc
 *
°bi__hdr_to_ldr
(*
d©a
, 
x
, 
y
, 
comp
);

1026 
	g°bi__vîtiˇŒy_Êù_⁄_lﬂd_globÆ
 = 0;

1028 
STBIDEF
 
	$°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd
(
Êag_åue_if_should_Êù
)

1030 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_globÆ
 = 
Êag_åue_if_should_Êù
;

1031 
	}
}

1033 #i‚de‡
STBI_THREAD_LOCAL


1034 
	#°bi__vîtiˇŒy_Êù_⁄_lﬂd
 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_globÆ


	)

1036 
STBI_THREAD_LOCAL
 
	g°bi__vîtiˇŒy_Êù_⁄_lﬂd_loˇl
, 
	g°bi__vîtiˇŒy_Êù_⁄_lﬂd_£t
;

1038 
STBIDEF
 
	$°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd_thªad
(
Êag_åue_if_should_Êù
)

1040 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_loˇl
 = 
Êag_åue_if_should_Êù
;

1041 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_£t
 = 1;

1042 
	}
}

1044 
	#°bi__vîtiˇŒy_Êù_⁄_lﬂd
 (
°bi__vîtiˇŒy_Êù_⁄_lﬂd_£t
 \

1045 ? 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_loˇl
 \

1046 : 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_globÆ
)

	)

1049 *
	$°bi__lﬂd_maö
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
, 
bpc
)

1051 
	`mem£t
(
ri
, 0, (*ri));

1052 
ri
->
bôs_≥r_ch™√l
 = 8;

1053 
ri
->
ch™√l_‹dî
 = 
STBI_ORDER_RGB
;

1054 
ri
->
num_ch™√ls
 = 0;

1056 #i‚de‡
STBI_NO_JPEG


1057 i‡(
	`°bi__j≥g_ã°
(
s
)Ë 
	`°bi__j≥g_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1059 #i‚de‡
STBI_NO_PNG


1060 i‡(
	`°bi__≤g_ã°
(
s
)Ë 
	`°bi__≤g_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1062 #i‚de‡
STBI_NO_BMP


1063 i‡(
	`°bi__bmp_ã°
(
s
)Ë 
	`°bi__bmp_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1065 #i‚de‡
STBI_NO_GIF


1066 i‡(
	`°bi__gif_ã°
(
s
)Ë 
	`°bi__gif_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1068 #i‚de‡
STBI_NO_PSD


1069 i‡(
	`°bi__psd_ã°
(
s
)Ë 
	`°bi__psd_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
, 
bpc
);

1071 
	`STBI_NOTUSED
(
bpc
);

1073 #i‚de‡
STBI_NO_PIC


1074 i‡(
	`°bi__pic_ã°
(
s
)Ë 
	`°bi__pic_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1076 #i‚de‡
STBI_NO_PNM


1077 i‡(
	`°bi__≤m_ã°
(
s
)Ë 
	`°bi__≤m_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1080 #i‚de‡
STBI_NO_HDR


1081 i‡(
	`°bi__hdr_ã°
(
s
)) {

1082 *
hdr
 = 
	`°bi__hdr_lﬂd
(
s
, 
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1083  
	`°bi__hdr_to_ldr
(
hdr
, *
x
, *
y
, 
ªq_comp
 ?Ñeq_com∞: *
comp
);

1087 #i‚de‡
STBI_NO_TGA


1089 i‡(
	`°bi__tga_ã°
(
s
))

1090  
	`°bi__tga_lﬂd
(
s
,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1093  
	`°bi__îΩuc
("unknown imageÅype", "ImageÇot ofány knownÅype, or corrupt");

1094 
	}
}

1096 
°bi_uc
 *
	$°bi__c⁄vît_16_to_8
(
°bi__uöt16
 *
‹ig
, 
w
, 
h
, 
ch™√ls
)

1098 
i
;

1099 
img_Àn
 = 
w
 * 
h
 * 
ch™√ls
;

1100 
°bi_uc
 *
ªdu˚d
;

1102 
ªdu˚d
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(
img_Àn
);

1103 i‡(
ªdu˚d
 =
NULL
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

1105 
i
 = 0; i < 
img_Àn
; ++i)

1106 
ªdu˚d
[
i
] = (
°bi_uc
)((
‹ig
[i] >> 8) & 0xFF);

1108 
	`STBI_FREE
(
‹ig
);

1109  
ªdu˚d
;

1110 
	}
}

1112 
°bi__uöt16
 *
	$°bi__c⁄vît_8_to_16
(
°bi_uc
 *
‹ig
, 
w
, 
h
, 
ch™√ls
)

1114 
i
;

1115 
img_Àn
 = 
w
 * 
h
 * 
ch™√ls
;

1116 
°bi__uöt16
 *
íœrged
;

1118 
íœrged
 = (
°bi__uöt16
 *Ë
	`°bi__mÆloc
(
img_Àn
*2);

1119 i‡(
íœrged
 =
NULL
Ë (
°bi__uöt16
 *Ë
	`°bi__îΩuc
("outofmem", "Out of memory");

1121 
i
 = 0; i < 
img_Àn
; ++i)

1122 
íœrged
[
i
] = (
°bi__uöt16
)((
‹ig
[i] << 8) + orig[i]);

1124 
	`STBI_FREE
(
‹ig
);

1125  
íœrged
;

1126 
	}
}

1128 
	$°bi__vîtiˇl_Êù
(*
image
, 
w
, 
h
, 
byãs_≥r_pixñ
)

1130 
row
;

1131 
size_t
 
byãs_≥r_row
 = (size_t)
w
 * 
byãs_≥r_pixñ
;

1132 
°bi_uc
 
ãmp
[2048];

1133 
°bi_uc
 *
byãs
 = (°bi_u¯*)
image
;

1135 
row
 = 0;Ñow < (
h
>>1);Ñow++) {

1136 
°bi_uc
 *
row0
 = 
byãs
 + 
row
*
byãs_≥r_row
;

1137 
°bi_uc
 *
row1
 = 
byãs
 + (
h
 - 
row
 - 1)*
byãs_≥r_row
;

1139 
size_t
 
byãs_À·
 = 
byãs_≥r_row
;

1140 
byãs_À·
) {

1141 
size_t
 
byãs_c›y
 = (
byãs_À·
 < (
ãmp
)) ? bytes_left : (temp);

1142 
	`mem˝y
(
ãmp
, 
row0
, 
byãs_c›y
);

1143 
	`mem˝y
(
row0
, 
row1
, 
byãs_c›y
);

1144 
	`mem˝y
(
row1
, 
ãmp
, 
byãs_c›y
);

1145 
row0
 +
byãs_c›y
;

1146 
row1
 +
byãs_c›y
;

1147 
byãs_À·
 -
byãs_c›y
;

1150 
	}
}

1152 #i‚de‡
STBI_NO_GIF


1153 
	$°bi__vîtiˇl_Êù_¶i˚s
(*
image
, 
w
, 
h
, 
z
, 
byãs_≥r_pixñ
)

1155 
¶i˚
;

1156 
¶i˚_size
 = 
w
 * 
h
 * 
byãs_≥r_pixñ
;

1158 
°bi_uc
 *
byãs
 = (°bi_u¯*)
image
;

1159 
¶i˚
 = 0; sli˚ < 
z
; ++slice) {

1160 
	`°bi__vîtiˇl_Êù
(
byãs
, 
w
, 
h
, 
byãs_≥r_pixñ
);

1161 
byãs
 +
¶i˚_size
;

1163 
	}
}

1166 *
	$°bi__lﬂd_™d_po°¥o˚ss_8bô
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1168 
°bi__ªsu…_öfo
 
ri
;

1169 *
ªsu…
 = 
	`°bi__lﬂd_maö
(
s
, 
x
, 
y
, 
comp
, 
ªq_comp
, &
ri
, 8);

1171 i‡(
ªsu…
 =
NULL
)

1172  
NULL
;

1174 i‡(
ri
.
bôs_≥r_ch™√l
 != 8) {

1175 
	`STBI_ASSERT
(
ri
.
bôs_≥r_ch™√l
 == 16);

1176 
ªsu…
 = 
	`°bi__c⁄vît_16_to_8
((
°bi__uöt16
 *Ëªsu…, *
x
, *
y
, 
ªq_comp
 =0 ? *
comp
 :Ñeq_comp);

1177 
ri
.
bôs_≥r_ch™√l
 = 8;

1182 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
) {

1183 
ch™√ls
 = 
ªq_comp
 ?Ñeq_com∞: *
comp
;

1184 
	`°bi__vîtiˇl_Êù
(
ªsu…
, *
x
, *
y
, 
ch™√ls
 * (
°bi_uc
));

1187  (*Ë
ªsu…
;

1188 
	}
}

1190 
°bi__uöt16
 *
	$°bi__lﬂd_™d_po°¥o˚ss_16bô
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1192 
°bi__ªsu…_öfo
 
ri
;

1193 *
ªsu…
 = 
	`°bi__lﬂd_maö
(
s
, 
x
, 
y
, 
comp
, 
ªq_comp
, &
ri
, 16);

1195 i‡(
ªsu…
 =
NULL
)

1196  
NULL
;

1198 i‡(
ri
.
bôs_≥r_ch™√l
 != 16) {

1199 
	`STBI_ASSERT
(
ri
.
bôs_≥r_ch™√l
 == 8);

1200 
ªsu…
 = 
	`°bi__c⁄vît_8_to_16
((
°bi_uc
 *Ëªsu…, *
x
, *
y
, 
ªq_comp
 =0 ? *
comp
 :Ñeq_comp);

1201 
ri
.
bôs_≥r_ch™√l
 = 16;

1207 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
) {

1208 
ch™√ls
 = 
ªq_comp
 ?Ñeq_com∞: *
comp
;

1209 
	`°bi__vîtiˇl_Êù
(
ªsu…
, *
x
, *
y
, 
ch™√ls
 * (
°bi__uöt16
));

1212  (
°bi__uöt16
 *Ë
ªsu…
;

1213 
	}
}

1215 #i‡!
deföed
(
STBI_NO_HDR
Ë&& !deföed(
STBI_NO_LINEAR
)

1216 
	$°bi__Êﬂt_po°¥o˚ss
(*
ªsu…
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1218 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
 && 
ªsu…
 !
NULL
) {

1219 
ch™√ls
 = 
ªq_comp
 ?Ñeq_com∞: *
comp
;

1220 
	`°bi__vîtiˇl_Êù
(
ªsu…
, *
x
, *
y
, 
ch™√ls
 * ());

1222 
	}
}

1225 #i‚de‡
STBI_NO_STDIO


1227 #i‡
deföed
(
_MSC_VER
Ë&& deföed(
STBI_WINDOWS_UTF8
)

1228 
STBI_EXTERN
 
	$__de˛•ec
(
dŒimp‹t
Ë
__°dˇŒ
 
	`Mu…iByãToWideCh¨
(
˝
, 
Êags
, c⁄° *
°r
, 
cbmb
, 
wch¨_t
 *
wide°r
, 
cchwide
);

1229 
STBI_EXTERN
 
	$__de˛•ec
(
dŒimp‹t
Ë
__°dˇŒ
 
	`WideCh¨ToMu…iByã
(
˝
, 
Êags
, c⁄° 
wch¨_t
 *
wide°r
, 
cchwide
, *
°r
, 
cbmb
, c⁄° *
defch¨
, *
u£d_deÁu…
);

1232 #i‡
	`deföed
(
_MSC_VER
Ë&& deföed(
STBI_WINDOWS_UTF8
)

1233 
STBIDEF
 
	$°bi_c⁄vît_wch¨_to_utf8
(*
buf„r
, 
size_t
 
buf„æí
, c⁄° 
wch¨_t
* 
öput
)

1235  
	`WideCh¨ToMu…iByã
(65001 , 0, 
öput
, -1, 
buf„r
, (Ë
buf„æí
, 
NULL
, NULL);

1236 
	}
}

1239 
FILE
 *
	$°bi__f›í
(c⁄° *
fûíame
, c⁄° *
mode
)

1241 
FILE
 *
f
;

1242 #i‡
	`deföed
(
_MSC_VER
Ë&& deföed(
STBI_WINDOWS_UTF8
)

1243 
wch¨_t
 
wMode
[64];

1244 
wch¨_t
 
wFûíame
[1024];

1245 i‡(0 =
	`Mu…iByãToWideCh¨
(65001 , 0, 
fûíame
, -1, 
wFûíame
, (wFilename)))

1248 i‡(0 =
	`Mu…iByãToWideCh¨
(65001 , 0, 
mode
, -1, 
wMode
, (wMode)))

1251 #i‡
_MSC_VER
 >= 1400

1252 i‡(0 !
	`_wf›í_s
(&
f
, 
wFûíame
, 
wMode
))

1253 
f
 = 0;

1255 
f
 = 
	`_wf›í
(
wFûíame
, 
wMode
);

1258 #ñi‡
	`deföed
(
_MSC_VER
) && _MSC_VER >= 1400

1259 i‡(0 !
	`f›í_s
(&
f
, 
fûíame
, 
mode
))

1260 
f
=0;

1262 
f
 = 
	`f›í
(
fûíame
, 
mode
);

1264  
f
;

1265 
	}
}

1268 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1270 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1271 *
ªsu…
;

1272 i‡(!
f
Ë 
	`°bi__îΩuc
("can't fopen", "UnableÅo open file");

1273 
ªsu…
 = 
	`°bi_lﬂd_‰om_fûe
(
f
,
x
,
y
,
comp
,
ªq_comp
);

1274 
	`f˛o£
(
f
);

1275  
ªsu…
;

1276 
	}
}

1278 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_‰om_fûe
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1280 *
ªsu…
;

1281 
°bi__c⁄ãxt
 
s
;

1282 
	`°bi__°¨t_fûe
(&
s
,
f
);

1283 
ªsu…
 = 
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1284 i‡(
ªsu…
) {

1286 
	`f£ek
(
f
, - (Ë(
s
.
img_buf„r_íd
 - s.
img_buf„r
), 
SEEK_CUR
);

1288  
ªsu…
;

1289 
	}
}

1291 
STBIDEF
 
°bi__uöt16
 *
	$°bi_lﬂd_‰om_fûe_16
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1293 
°bi__uöt16
 *
ªsu…
;

1294 
°bi__c⁄ãxt
 
s
;

1295 
	`°bi__°¨t_fûe
(&
s
,
f
);

1296 
ªsu…
 = 
	`°bi__lﬂd_™d_po°¥o˚ss_16bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1297 i‡(
ªsu…
) {

1299 
	`f£ek
(
f
, - (Ë(
s
.
img_buf„r_íd
 - s.
img_buf„r
), 
SEEK_CUR
);

1301  
ªsu…
;

1302 
	}
}

1304 
STBIDEF
 
°bi_us
 *
	$°bi_lﬂd_16
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1306 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1307 
°bi__uöt16
 *
ªsu…
;

1308 i‡(!
f
Ë (
°bi_us
 *Ë
	`°bi__îΩuc
("can't fopen", "UnableÅo open file");

1309 
ªsu…
 = 
	`°bi_lﬂd_‰om_fûe_16
(
f
,
x
,
y
,
comp
,
ªq_comp
);

1310 
	`f˛o£
(
f
);

1311  
ªsu…
;

1312 
	}
}

1317 
STBIDEF
 
°bi_us
 *
	$°bi_lﬂd_16_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
)

1319 
°bi__c⁄ãxt
 
s
;

1320 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1321  
	`°bi__lﬂd_™d_po°¥o˚ss_16bô
(&
s
,
x
,
y
,
ch™√ls_ö_fûe
,
desúed_ch™√ls
);

1322 
	}
}

1324 
STBIDEF
 
°bi_us
 *
	$°bi_lﬂd_16_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
)

1326 
°bi__c⁄ãxt
 
s
;

1327 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *)
˛bk
, 
u£r
);

1328  
	`°bi__lﬂd_™d_po°¥o˚ss_16bô
(&
s
,
x
,
y
,
ch™√ls_ö_fûe
,
desúed_ch™√ls
);

1329 
	}
}

1331 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1333 
°bi__c⁄ãxt
 
s
;

1334 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1335  
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1336 
	}
}

1338 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1340 
°bi__c⁄ãxt
 
s
;

1341 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
˛bk
, 
u£r
);

1342  
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1343 
	}
}

1345 #i‚de‡
STBI_NO_GIF


1346 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_gif_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
)

1348 *
ªsu…
;

1349 
°bi__c⁄ãxt
 
s
;

1350 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1352 
ªsu…
 = (*Ë
	`°bi__lﬂd_gif_maö
(&
s
, 
dñays
, 
x
, 
y
, 
z
, 
comp
, 
ªq_comp
);

1353 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
) {

1354 
	`°bi__vîtiˇl_Êù_¶i˚s
–
ªsu…
, *
x
, *
y
, *
z
, *
comp
 );

1357  
ªsu…
;

1358 
	}
}

1361 #i‚de‡
STBI_NO_LINEAR


1362 *
	$°bi__lﬂdf_maö
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1364 *
d©a
;

1365 #i‚de‡
STBI_NO_HDR


1366 i‡(
	`°bi__hdr_ã°
(
s
)) {

1367 
°bi__ªsu…_öfo
 
ri
;

1368 *
hdr_d©a
 = 
	`°bi__hdr_lﬂd
(
s
,
x
,
y
,
comp
,
ªq_comp
, &
ri
);

1369 i‡(
hdr_d©a
)

1370 
	`°bi__Êﬂt_po°¥o˚ss
(
hdr_d©a
,
x
,
y
,
comp
,
ªq_comp
);

1371  
hdr_d©a
;

1374 
d©a
 = 
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(
s
, 
x
, 
y
, 
comp
, 
ªq_comp
);

1375 i‡(
d©a
)

1376  
	`°bi__ldr_to_hdr
(
d©a
, *
x
, *
y
, 
ªq_comp
 ?Ñeq_com∞: *
comp
);

1377  
	`°bi__îΩf
("unknown imageÅype", "ImageÇot ofány knownÅype, or corrupt");

1378 
	}
}

1380 
STBIDEF
 *
	$°bi_lﬂdf_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1382 
°bi__c⁄ãxt
 
s
;

1383 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1384  
	`°bi__lﬂdf_maö
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1385 
	}
}

1387 
STBIDEF
 *
	$°bi_lﬂdf_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1389 
°bi__c⁄ãxt
 
s
;

1390 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
˛bk
, 
u£r
);

1391  
	`°bi__lﬂdf_maö
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1392 
	}
}

1394 #i‚de‡
STBI_NO_STDIO


1395 
STBIDEF
 *
	$°bi_lﬂdf
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1397 *
ªsu…
;

1398 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1399 i‡(!
f
Ë 
	`°bi__îΩf
("can't fopen", "UnableÅo open file");

1400 
ªsu…
 = 
	`°bi_lﬂdf_‰om_fûe
(
f
,
x
,
y
,
comp
,
ªq_comp
);

1401 
	`f˛o£
(
f
);

1402  
ªsu…
;

1403 
	}
}

1405 
STBIDEF
 *
	$°bi_lﬂdf_‰om_fûe
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1407 
°bi__c⁄ãxt
 
s
;

1408 
	`°bi__°¨t_fûe
(&
s
,
f
);

1409  
	`°bi__lﬂdf_maö
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1410 
	}
}

1419 
STBIDEF
 
	$°bi_is_hdr_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
)

1421 #i‚de‡
STBI_NO_HDR


1422 
°bi__c⁄ãxt
 
s
;

1423 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1424  
	`°bi__hdr_ã°
(&
s
);

1426 
	`STBI_NOTUSED
(
buf„r
);

1427 
	`STBI_NOTUSED
(
Àn
);

1430 
	}
}

1432 #i‚de‡
STBI_NO_STDIO


1433 
STBIDEF
 
	$°bi_is_hdr
 (c⁄° *
fûíame
)

1435 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1436 
ªsu…
=0;

1437 i‡(
f
) {

1438 
ªsu…
 = 
	`°bi_is_hdr_‰om_fûe
(
f
);

1439 
	`f˛o£
(
f
);

1441  
ªsu…
;

1442 
	}
}

1444 
STBIDEF
 
	$°bi_is_hdr_‰om_fûe
(
FILE
 *
f
)

1446 #i‚de‡
STBI_NO_HDR


1447 
pos
 = 
	`·ñl
(
f
);

1448 
ªs
;

1449 
°bi__c⁄ãxt
 
s
;

1450 
	`°bi__°¨t_fûe
(&
s
,
f
);

1451 
ªs
 = 
	`°bi__hdr_ã°
(&
s
);

1452 
	`f£ek
(
f
, 
pos
, 
SEEK_SET
);

1453  
ªs
;

1455 
	`STBI_NOTUSED
(
f
);

1458 
	}
}

1461 
STBIDEF
 
	$°bi_is_hdr_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
)

1463 #i‚de‡
STBI_NO_HDR


1464 
°bi__c⁄ãxt
 
s
;

1465 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
˛bk
, 
u£r
);

1466  
	`°bi__hdr_ã°
(&
s
);

1468 
	`STBI_NOTUSED
(
˛bk
);

1469 
	`STBI_NOTUSED
(
u£r
);

1472 
	}
}

1474 #i‚de‡
STBI_NO_LINEAR


1475 
	g°bi__l2h_gamma
=2.2f, 
	g°bi__l2h_sˇÀ
=1.0f;

1477 
STBIDEF
 
	$°bi_ldr_to_hdr_gamma
(
gamma
Ë{ 
°bi__l2h_gamma
 = gamma; 
	}
}

1478 
STBIDEF
 
	$°bi_ldr_to_hdr_sˇÀ
(
sˇÀ
Ë{ 
°bi__l2h_sˇÀ
 = sˇÀ; 
	}
}

1481 
	g°bi__h2l_gamma_i
=1.0f/2.2f, 
	g°bi__h2l_sˇÀ_i
=1.0f;

1483 
STBIDEF
 
	$°bi_hdr_to_ldr_gamma
(
gamma
Ë{ 
°bi__h2l_gamma_i
 = 1/gamma; 
	}
}

1484 
STBIDEF
 
	$°bi_hdr_to_ldr_sˇÀ
(
sˇÀ
Ë{ 
°bi__h2l_sˇÀ_i
 = 1/sˇÀ; 
	}
}

1494 
	mSTBI__SCAN_lﬂd
=0,

1495 
	mSTBI__SCAN_ty≥
,

1496 
	mSTBI__SCAN_hódî


1499 
	$°bi__ªfûl_buf„r
(
°bi__c⁄ãxt
 *
s
)

1501 
n
 = (
s
->
io
.
ªad
)(s->
io_u£r_d©a
,(*)s->
buf„r_°¨t
,s->
buÊí
);

1502 i‡(
n
 == 0) {

1505 
s
->
ªad_‰om_ˇŒbacks
 = 0;

1506 
s
->
img_buf„r
 = s->
buf„r_°¨t
;

1507 
s
->
img_buf„r_íd
 = s->
buf„r_°¨t
+1;

1508 *
s
->
img_buf„r
 = 0;

1510 
s
->
img_buf„r
 = s->
buf„r_°¨t
;

1511 
s
->
img_buf„r_íd
 = s->
buf„r_°¨t
 + 
n
;

1513 
	}
}

1515 
°bi_ölöe
 
°bi_uc
 
	$°bi__gë8
(
°bi__c⁄ãxt
 *
s
)

1517 i‡(
s
->
img_buf„r
 < s->
img_buf„r_íd
)

1518  *
s
->
img_buf„r
++;

1519 i‡(
s
->
ªad_‰om_ˇŒbacks
) {

1520 
	`°bi__ªfûl_buf„r
(
s
);

1521  *
s
->
img_buf„r
++;

1524 
	}
}

1526 #i‡
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_NO_HDR
Ë&& deföed(
STBI_NO_PIC
Ë&& deföed(
STBI_NO_PNM
)

1529 
°bi_ölöe
 
	$°bi__©_eof
(
°bi__c⁄ãxt
 *
s
)

1531 i‡(
s
->
io
.
ªad
) {

1532 i‡(!(
s
->
io
.
eof
)(s->
io_u£r_d©a
))  0;

1535 i‡(
s
->
ªad_‰om_ˇŒbacks
 == 0)  1;

1538  
s
->
img_buf„r
 >s->
img_buf„r_íd
;

1539 
	}
}

1542 #i‡
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_BMP
Ë&& deföed(
STBI_NO_PSD
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_GIF
Ë&& deföed(
STBI_NO_PIC
)

1545 
	$°bi__skù
(
°bi__c⁄ãxt
 *
s
, 
n
)

1547 i‡(
n
 < 0) {

1548 
s
->
img_buf„r
 = s->
img_buf„r_íd
;

1551 i‡(
s
->
io
.
ªad
) {

1552 
bÀn
 = (Ë(
s
->
img_buf„r_íd
 - s->
img_buf„r
);

1553 i‡(
bÀn
 < 
n
) {

1554 
s
->
img_buf„r
 = s->
img_buf„r_íd
;

1555 (
s
->
io
.
skù
)(s->
io_u£r_d©a
, 
n
 - 
bÀn
);

1559 
s
->
img_buf„r
 +
n
;

1560 
	}
}

1563 #i‡
deföed
(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_HDR
Ë&& deföed(
STBI_NO_PNM
)

1566 
	$°bi__gën
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 *
buf„r
, 
n
)

1568 i‡(
s
->
io
.
ªad
) {

1569 
bÀn
 = (Ë(
s
->
img_buf„r_íd
 - s->
img_buf„r
);

1570 i‡(
bÀn
 < 
n
) {

1571 
ªs
, 
cou¡
;

1573 
	`mem˝y
(
buf„r
, 
s
->
img_buf„r
, 
bÀn
);

1575 
cou¡
 = (
s
->
io
.
ªad
)(s->
io_u£r_d©a
, (*Ë
buf„r
 + 
bÀn
, 
n
 - blen);

1576 
ªs
 = (
cou¡
 =(
n
-
bÀn
));

1577 
s
->
img_buf„r
 = s->
img_buf„r_íd
;

1578  
ªs
;

1582 i‡(
s
->
img_buf„r
+
n
 <s->
img_buf„r_íd
) {

1583 
	`mem˝y
(
buf„r
, 
s
->
img_buf„r
, 
n
);

1584 
s
->
img_buf„r
 +
n
;

1588 
	}
}

1591 #i‡
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_PSD
Ë&& deföed(
STBI_NO_PIC
)

1594 
	$°bi__gë16be
(
°bi__c⁄ãxt
 *
s
)

1596 
z
 = 
	`°bi__gë8
(
s
);

1597  (
z
 << 8Ë+ 
	`°bi__gë8
(
s
);

1598 
	}
}

1601 #i‡
deföed
(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_PSD
Ë&& deföed(
STBI_NO_PIC
)

1604 
°bi__uöt32
 
	$°bi__gë32be
(
°bi__c⁄ãxt
 *
s
)

1606 
°bi__uöt32
 
z
 = 
	`°bi__gë16be
(
s
);

1607  (
z
 << 16Ë+ 
	`°bi__gë16be
(
s
);

1608 
	}
}

1611 #i‡
deföed
(
STBI_NO_BMP
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_GIF
)

1614 
	$°bi__gë16À
(
°bi__c⁄ãxt
 *
s
)

1616 
z
 = 
	`°bi__gë8
(
s
);

1617  
z
 + (
	`°bi__gë8
(
s
) << 8);

1618 
	}
}

1621 #i‚de‡
STBI_NO_BMP


1622 
°bi__uöt32
 
	$°bi__gë32À
(
°bi__c⁄ãxt
 *
s
)

1624 
°bi__uöt32
 
z
 = 
	`°bi__gë16À
(
s
);

1625  
z
 + (
	`°bi__gë16À
(
s
) << 16);

1626 
	}
}

1629 
	#STBI__BYTECAST
(
x
Ë((
°bi_uc
) ((x) & 255))

1630 

	)

1631 #i‡
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_BMP
Ë&& deföed(
STBI_NO_PSD
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_GIF
Ë&& deföed(
STBI_NO_PIC
Ë&& deföed(
STBI_NO_PNM
)

1645 
°bi_uc
 
	$°bi__compuã_y
(
r
, 
g
, 
b
)

1647  (
°bi_uc
Ë(((
r
*77Ë+ (
g
*150Ë+ (29*
b
)) >> 8);

1648 
	}
}

1651 #i‡
deföed
(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_BMP
Ë&& deföed(
STBI_NO_PSD
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_GIF
Ë&& deföed(
STBI_NO_PIC
Ë&& deföed(
STBI_NO_PNM
)

1654 *
	$°bi__c⁄vît_f‹m©
(*
d©a
, 
img_n
, 
ªq_comp
, 
x
, 
y
)

1656 
i
,
j
;

1657 *
good
;

1659 i‡(
ªq_comp
 =
img_n
Ë 
d©a
;

1660 
	`STBI_ASSERT
(
ªq_comp
 >= 1 &&Ñeq_comp <= 4);

1662 
good
 = (*Ë
	`°bi__mÆloc_mad3
(
ªq_comp
, 
x
, 
y
, 0);

1663 i‡(
good
 =
NULL
) {

1664 
	`STBI_FREE
(
d©a
);

1665  
	`°bi__îΩuc
("outofmem", "Out of memory");

1668 
j
=0; j < (Ë
y
; ++j) {

1669 *
§c
 = 
d©a
 + 
j
 * 
x
 * 
img_n
 ;

1670 *
de°
 = 
good
 + 
j
 * 
x
 * 
ªq_comp
;

1672 
	#STBI__COMBO
(
a
,
b
Ë(◊)*8+(b))

	)

1673 
	#STBI__CASE
(
a
,
b
Ë
	`STBI__COMBO
◊,b): 
i
=
x
-1; i >0; --i, 
§c
 +a, 
de°
 +b)

	)

1676 
	`STBI__COMBO
(
img_n
, 
ªq_comp
)) {

1677 
	`STBI__CASE
(1,2Ë{ 
de°
[0]=
§c
[0]; dest[1]=255; } ;

1678 
	`STBI__CASE
(1,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1679 
	`STBI__CASE
(1,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=255; } ;

1680 
	`STBI__CASE
(2,1Ë{ 
de°
[0]=
§c
[0]; } ;

1681 
	`STBI__CASE
(2,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1682 
	`STBI__CASE
(2,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=src[1]; } ;

1683 
	`STBI__CASE
(3,4Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2];dest[3]=255; } ;

1684 
	`STBI__CASE
(3,1Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); } ;

1685 
	`STBI__CASE
(3,2Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); dest[1] = 255; } ;

1686 
	`STBI__CASE
(4,1Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); } ;

1687 
	`STBI__CASE
(4,2Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); dest[1] = src[3]; } ;

1688 
	`STBI__CASE
(4,3Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2]; } ;

1689 : 
	`STBI_ASSERT
(0);

1691 #unde‡
STBI__CASE


1694 
	`STBI_FREE
(
d©a
);

1695  
good
;

1696 
	}
}

1699 #i‡
deföed
(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_PSD
)

1702 
°bi__uöt16
 
	$°bi__compuã_y_16
(
r
, 
g
, 
b
)

1704  (
°bi__uöt16
Ë(((
r
*77Ë+ (
g
*150Ë+ (29*
b
)) >> 8);

1705 
	}
}

1708 #i‡
deföed
(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_PSD
)

1711 
°bi__uöt16
 *
	$°bi__c⁄vît_f‹m©16
(
°bi__uöt16
 *
d©a
, 
img_n
, 
ªq_comp
, 
x
, 
y
)

1713 
i
,
j
;

1714 
°bi__uöt16
 *
good
;

1716 i‡(
ªq_comp
 =
img_n
Ë 
d©a
;

1717 
	`STBI_ASSERT
(
ªq_comp
 >= 1 &&Ñeq_comp <= 4);

1719 
good
 = (
°bi__uöt16
 *Ë
	`°bi__mÆloc
(
ªq_comp
 * 
x
 * 
y
 * 2);

1720 i‡(
good
 =
NULL
) {

1721 
	`STBI_FREE
(
d©a
);

1722  (
°bi__uöt16
 *Ë
	`°bi__îΩuc
("outofmem", "Out of memory");

1725 
j
=0; j < (Ë
y
; ++j) {

1726 
°bi__uöt16
 *
§c
 = 
d©a
 + 
j
 * 
x
 * 
img_n
 ;

1727 
°bi__uöt16
 *
de°
 = 
good
 + 
j
 * 
x
 * 
ªq_comp
;

1729 
	#STBI__COMBO
(
a
,
b
Ë(◊)*8+(b))

	)

1730 
	#STBI__CASE
(
a
,
b
Ë
	`STBI__COMBO
◊,b): 
i
=
x
-1; i >0; --i, 
§c
 +a, 
de°
 +b)

	)

1733 
	`STBI__COMBO
(
img_n
, 
ªq_comp
)) {

1734 
	`STBI__CASE
(1,2Ë{ 
de°
[0]=
§c
[0]; dest[1]=0xffff; } ;

1735 
	`STBI__CASE
(1,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1736 
	`STBI__CASE
(1,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=0xffff; } ;

1737 
	`STBI__CASE
(2,1Ë{ 
de°
[0]=
§c
[0]; } ;

1738 
	`STBI__CASE
(2,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1739 
	`STBI__CASE
(2,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=src[1]; } ;

1740 
	`STBI__CASE
(3,4Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2];dest[3]=0xffff; } ;

1741 
	`STBI__CASE
(3,1Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); } ;

1742 
	`STBI__CASE
(3,2Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); dest[1] = 0xffff; } ;

1743 
	`STBI__CASE
(4,1Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); } ;

1744 
	`STBI__CASE
(4,2Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); dest[1] = src[3]; } ;

1745 
	`STBI__CASE
(4,3Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2]; } ;

1746 : 
	`STBI_ASSERT
(0);

1748 #unde‡
STBI__CASE


1751 
	`STBI_FREE
(
d©a
);

1752  
good
;

1753 
	}
}

1756 #i‚de‡
STBI_NO_LINEAR


1757 *
	$°bi__ldr_to_hdr
(
°bi_uc
 *
d©a
, 
x
, 
y
, 
comp
)

1759 
i
,
k
,
n
;

1760 *
ouçut
;

1761 i‡(!
d©a
Ë 
NULL
;

1762 
ouçut
 = (*Ë
	`°bi__mÆloc_mad4
(
x
, 
y
, 
comp
, (), 0);

1763 i‡(
ouçut
 =
NULL
Ë{ 
	`STBI_FREE
(
d©a
);  
	`°bi__îΩf
("outofmem", "Out of memory"); }

1765 i‡(
comp
 & 1Ë
n
 = comp; n = comp-1;

1766 
i
=0; i < 
x
*
y
; ++i) {

1767 
k
=0; k < 
n
; ++k) {

1768 
ouçut
[
i
*
comp
 + 
k
] = (Ë(
	`pow
(
d©a
[i*comp+k]/255.0f, 
°bi__l2h_gamma
Ë* 
°bi__l2h_sˇÀ
);

1771 i‡(
n
 < 
comp
) {

1772 
i
=0; i < 
x
*
y
; ++i) {

1773 
ouçut
[
i
*
comp
 + 
n
] = 
d©a
[i*comp +Ç]/255.0f;

1776 
	`STBI_FREE
(
d©a
);

1777  
ouçut
;

1778 
	}
}

1781 #i‚de‡
STBI_NO_HDR


1782 
	#°bi__Êﬂt2öt
(
x
Ë((Ë(x))

	)

1783 
°bi_uc
 *
	$°bi__hdr_to_ldr
(*
d©a
, 
x
, 
y
, 
comp
)

1785 
i
,
k
,
n
;

1786 
°bi_uc
 *
ouçut
;

1787 i‡(!
d©a
Ë 
NULL
;

1788 
ouçut
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
x
, 
y
, 
comp
, 0);

1789 i‡(
ouçut
 =
NULL
Ë{ 
	`STBI_FREE
(
d©a
);  
	`°bi__îΩuc
("outofmem", "Out of memory"); }

1791 i‡(
comp
 & 1Ë
n
 = comp; n = comp-1;

1792 
i
=0; i < 
x
*
y
; ++i) {

1793 
k
=0; k < 
n
; ++k) {

1794 
z
 = (Ë
	`pow
(
d©a
[
i
*
comp
+
k
]*
°bi__h2l_sˇÀ_i
, 
°bi__h2l_gamma_i
) * 255 + 0.5f;

1795 i‡(
z
 < 0) z = 0;

1796 i‡(
z
 > 255) z = 255;

1797 
ouçut
[
i
*
comp
 + 
k
] = (
°bi_uc
Ë
	`°bi__Êﬂt2öt
(
z
);

1799 i‡(
k
 < 
comp
) {

1800 
z
 = 
d©a
[
i
*
comp
+
k
] * 255 + 0.5f;

1801 i‡(
z
 < 0) z = 0;

1802 i‡(
z
 > 255) z = 255;

1803 
ouçut
[
i
*
comp
 + 
k
] = (
°bi_uc
Ë
	`°bi__Êﬂt2öt
(
z
);

1806 
	`STBI_FREE
(
d©a
);

1807  
ouçut
;

1808 
	}
}

1832 #i‚de‡
STBI_NO_JPEG


1835 
	#FAST_BITS
 9

1836 

	)

1839 
°bi_uc
 
	mÁ°
[1 << 
FAST_BITS
];

1841 
°bi__uöt16
 
	mcode
[256];

1842 
°bi_uc
 
	mvÆues
[256];

1843 
°bi_uc
 
	msize
[257];

1844 
	mmaxcode
[18];

1845 
	mdñè
[17];

1846 } 
	t°bi__huffm™
;

1850 
°bi__c⁄ãxt
 *
	ms
;

1851 
°bi__huffm™
 
	mhuff_dc
[4];

1852 
°bi__huffm™
 
	mhuff_ac
[4];

1853 
°bi__uöt16
 
	mdequ™t
[4][64];

1854 
°bi__öt16
 
	mÁ°_ac
[4][1 << 
FAST_BITS
];

1857 
	mimg_h_max
, 
	mimg_v_max
;

1858 
	mimg_mcu_x
, 
	mimg_mcu_y
;

1859 
	mimg_mcu_w
, 
	mimg_mcu_h
;

1864 
	mid
;

1865 
	mh
,
	mv
;

1866 
	mtq
;

1867 
	mhd
,
	mha
;

1868 
	mdc_¥ed
;

1870 
	mx
,
	my
,
	mw2
,
	mh2
;

1871 
°bi_uc
 *
	md©a
;

1872 *
	møw_d©a
, *
	møw_c€ff
;

1873 
°bi_uc
 *
	mlöebuf
;

1874 *
	mc€ff
;

1875 
	mc€ff_w
, 
	mc€ff_h
;

1876 } 
	mimg_comp
[4];

1878 
°bi__uöt32
 
	mcode_buf„r
;

1879 
	mcode_bôs
;

1880 
	mm¨kî
;

1881 
	mnom‹e
;

1883 
	m¥ogªssive
;

1884 
	m•ec_°¨t
;

1885 
	m•ec_íd
;

1886 
	msucc_high
;

1887 
	msucc_low
;

1888 
	meob_run
;

1889 
	mjfif
;

1890 
	m≠p14_cﬁ‹_å™sf‹m
;

1891 
	mrgb
;

1893 
	msˇn_n
, 
	m‹dî
[4];

1894 
	mª°¨t_öãrvÆ
, 
	mtodo
;

1897 (*
	mid˘_block_kî√l
)(
°bi_uc
 *
	mout
, 
	mout_°ride
, 
	md©a
[64]);

1898 (*
	mYCbCr_to_RGB_kî√l
)(
°bi_uc
 *
	mout
, c⁄° stbi_u¯*
	my
, c⁄° stbi_u¯*
	mpcb
, c⁄° stbi_u¯*
	mp¸
, 
	mcou¡
, 
	m°ï
);

1899 
	m°bi_uc
 *(*
	mªßm∂e_row_hv_2_kî√l
)(
°bi_uc
 *
	mout
, stbi_u¯*
	mö_√¨
, stbi_u¯*
	mö_Ár
, 
	mw
, 
	mhs
);

1900 } 
	t°bi__j≥g
;

1902 
	$°bi__buûd_huffm™
(
°bi__huffm™
 *
h
, *
cou¡
)

1904 
i
,
j
,
k
=0;

1905 
code
;

1907 
i
=0; i < 16; ++i)

1908 
j
=0; j < 
cou¡
[
i
]; ++j)

1909 
h
->
size
[
k
++] = (
°bi_uc
Ë(
i
+1);

1910 
h
->
size
[
k
] = 0;

1913 
code
 = 0;

1914 
k
 = 0;

1915 
j
=1; j <= 16; ++j) {

1917 
h
->
dñè
[
j
] = 
k
 - 
code
;

1918 i‡(
h
->
size
[
k
] =
j
) {

1919 
h
->
size
[
k
] =
j
)

1920 
h
->
code
[
k
++] = (
°bi__uöt16
) (code++);

1921 i‡(
code
-1 >(1u << 
j
)Ë 
	`°bi__îr
("bad codeÜengths","Corrupt JPEG");

1924 
h
->
maxcode
[
j
] = 
code
 << (16-j);

1925 
code
 <<= 1;

1927 
h
->
maxcode
[
j
] = 0xffffffff;

1930 
	`mem£t
(
h
->
Á°
, 255, 1 << 
FAST_BITS
);

1931 
i
=0; i < 
k
; ++i) {

1932 
s
 = 
h
->
size
[
i
];

1933 i‡(
s
 <
FAST_BITS
) {

1934 
c
 = 
h
->
code
[
i
] << (
FAST_BITS
-
s
);

1935 
m
 = 1 << (
FAST_BITS
-
s
);

1936 
j
=0; j < 
m
; ++j) {

1937 
h
->
Á°
[
c
+
j
] = (
°bi_uc
Ë
i
;

1942 
	}
}

1946 
	$°bi__buûd_Á°_ac
(
°bi__öt16
 *
Á°_ac
, 
°bi__huffm™
 *
h
)

1948 
i
;

1949 
i
=0; i < (1 << 
FAST_BITS
); ++i) {

1950 
°bi_uc
 
Á°
 = 
h
->Á°[
i
];

1951 
Á°_ac
[
i
] = 0;

1952 i‡(
Á°
 < 255) {

1953 
rs
 = 
h
->
vÆues
[
Á°
];

1954 
run
 = (
rs
 >> 4) & 15;

1955 
magbôs
 = 
rs
 & 15;

1956 
Àn
 = 
h
->
size
[
Á°
];

1958 i‡(
magbôs
 && 
Àn
 + magbô†<
FAST_BITS
) {

1960 
k
 = ((
i
 << 
Àn
Ë& ((1 << 
FAST_BITS
Ë- 1)Ë>> (FAST_BITS - 
magbôs
);

1961 
m
 = 1 << (
magbôs
 - 1);

1962 i‡(
k
 < 
m
Ëk +(~0U << 
magbôs
) + 1;

1964 i‡(
k
 >= -128 && k <= 127)

1965 
Á°_ac
[
i
] = (
°bi__öt16
Ë((
k
 * 256Ë+ (
run
 * 16Ë+ (
Àn
 + 
magbôs
));

1969 
	}
}

1971 
	$°bi__grow_buf„r_unß„
(
°bi__j≥g
 *
j
)

1974 
b
 = 
j
->
nom‹e
 ? 0 : 
	`°bi__gë8
(j->
s
);

1975 i‡(
b
 == 0xff) {

1976 
c
 = 
	`°bi__gë8
(
j
->
s
);

1977 
c
 =0xffË¯
	`°bi__gë8
(
j
->
s
);

1978 i‡(
c
 != 0) {

1979 
j
->
m¨kî
 = (Ë
c
;

1980 
j
->
nom‹e
 = 1;

1984 
j
->
code_buf„r
 |
b
 << (24 - j->
code_bôs
);

1985 
j
->
code_bôs
 += 8;

1986 } 
j
->
code_bôs
 <= 24);

1987 
	}
}

1990 c⁄° 
°bi__uöt32
 
	g°bi__bmask
[17]={0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535};

1993 
°bi_ölöe
 
	$°bi__j≥g_huff_decode
(
°bi__j≥g
 *
j
, 
°bi__huffm™
 *
h
)

1995 
ãmp
;

1996 
c
,
k
;

1998 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2002 
c
 = (
j
->
code_buf„r
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2003 
k
 = 
h
->
Á°
[
c
];

2004 i‡(
k
 < 255) {

2005 
s
 = 
h
->
size
[
k
];

2006 i‡(
s
 > 
j
->
code_bôs
)

2008 
j
->
code_buf„r
 <<
s
;

2009 
j
->
code_bôs
 -
s
;

2010  
h
->
vÆues
[
k
];

2019 
ãmp
 = 
j
->
code_buf„r
 >> 16;

2020 
k
=
FAST_BITS
+1 ; ; ++k)

2021 i‡(
ãmp
 < 
h
->
maxcode
[
k
])

2023 i‡(
k
 == 17) {

2025 
j
->
code_bôs
 -= 16;

2029 i‡(
k
 > 
j
->
code_bôs
)

2033 
c
 = ((
j
->
code_buf„r
 >> (32 - 
k
)Ë& 
°bi__bmask
[k]Ë+ 
h
->
dñè
[k];

2034 
	`STBI_ASSERT
((((
j
->
code_buf„r
Ë>> (32 - 
h
->
size
[
c
])Ë& 
°bi__bmask
[h->size[c]]Ë=h->
code
[c]);

2037 
j
->
code_bôs
 -
k
;

2038 
j
->
code_buf„r
 <<
k
;

2039  
h
->
vÆues
[
c
];

2040 
	}
}

2043 c⁄° 
	g°bi__jbüs
[16] = {0,-1,-3,-7,-15,-31,-63,-127,-255,-511,-1023,-2047,-4095,-8191,-16383,-32767};

2047 
°bi_ölöe
 
	$°bi__exãnd_ª˚ive
(
°bi__j≥g
 *
j
, 
n
)

2049 
k
;

2050 
sgn
;

2051 i‡(
j
->
code_bôs
 < 
n
Ë
	`°bi__grow_buf„r_unß„
(j);

2053 
sgn
 = (
°bi__öt32
)
j
->
code_buf„r
 >> 31;

2054 
k
 = 
	`°bi_ÃŸ
(
j
->
code_buf„r
, 
n
);

2055 
	`STBI_ASSERT
(
n
 >0 &&Ç < (Ë((
°bi__bmask
)/(*stbi__bmask)));

2056 
j
->
code_buf„r
 = 
k
 & ~
°bi__bmask
[
n
];

2057 
k
 &
°bi__bmask
[
n
];

2058 
j
->
code_bôs
 -
n
;

2059  
k
 + (
°bi__jbüs
[
n
] & ~
sgn
);

2060 
	}
}

2063 
°bi_ölöe
 
	$°bi__j≥g_gë_bôs
(
°bi__j≥g
 *
j
, 
n
)

2065 
k
;

2066 i‡(
j
->
code_bôs
 < 
n
Ë
	`°bi__grow_buf„r_unß„
(j);

2067 
k
 = 
	`°bi_ÃŸ
(
j
->
code_buf„r
, 
n
);

2068 
j
->
code_buf„r
 = 
k
 & ~
°bi__bmask
[
n
];

2069 
k
 &
°bi__bmask
[
n
];

2070 
j
->
code_bôs
 -
n
;

2071  
k
;

2072 
	}
}

2074 
°bi_ölöe
 
	$°bi__j≥g_gë_bô
(
°bi__j≥g
 *
j
)

2076 
k
;

2077 i‡(
j
->
code_bôs
 < 1Ë
	`°bi__grow_buf„r_unß„
(j);

2078 
k
 = 
j
->
code_buf„r
;

2079 
j
->
code_buf„r
 <<= 1;

2080 --
j
->
code_bôs
;

2081  
k
 & 0x80000000;

2082 
	}
}

2086 c⁄° 
°bi_uc
 
	g°bi__j≥g_dezigzag
[64+15] =

2102 
	$°bi__j≥g_decode_block
(
°bi__j≥g
 *
j
, 
d©a
[64], 
°bi__huffm™
 *
hdc
, stbi__huffm™ *
hac
, 
°bi__öt16
 *
Ác
, 
b
, 
°bi__uöt16
 *
dequ™t
)

2104 
diff
,
dc
,
k
;

2105 
t
;

2107 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2108 
t
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hdc
);

2109 i‡(
t
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2112 
	`mem£t
(
d©a
,0,64*(data[0]));

2114 
diff
 = 
t
 ? 
	`°bi__exãnd_ª˚ive
(
j
,Å) : 0;

2115 
dc
 = 
j
->
img_comp
[
b
].
dc_¥ed
 + 
diff
;

2116 
j
->
img_comp
[
b
].
dc_¥ed
 = 
dc
;

2117 
d©a
[0] = (Ë(
dc
 * 
dequ™t
[0]);

2120 
k
 = 1;

2122 
zig
;

2123 
c
,
r
,
s
;

2124 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2125 
c
 = (
j
->
code_buf„r
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2126 
r
 = 
Ác
[
c
];

2127 i‡(
r
) {

2128 
k
 +(
r
 >> 4) & 15;

2129 
s
 = 
r
 & 15;

2130 
j
->
code_buf„r
 <<
s
;

2131 
j
->
code_bôs
 -
s
;

2133 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2134 
d©a
[
zig
] = (Ë((
r
 >> 8Ë* 
dequ™t
[zig]);

2136 
rs
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hac
);

2137 i‡(
rs
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2138 
s
 = 
rs
 & 15;

2139 
r
 = 
rs
 >> 4;

2140 i‡(
s
 == 0) {

2141 i‡(
rs
 != 0xf0) ;

2142 
k
 += 16;

2144 
k
 +
r
;

2146 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2147 
d©a
[
zig
] = (Ë(
	`°bi__exãnd_ª˚ive
(
j
,
s
Ë* 
dequ™t
[zig]);

2150 } 
k
 < 64);

2152 
	}
}

2154 
	$°bi__j≥g_decode_block_¥og_dc
(
°bi__j≥g
 *
j
, 
d©a
[64], 
°bi__huffm™
 *
hdc
, 
b
)

2156 
diff
,
dc
;

2157 
t
;

2158 i‡(
j
->
•ec_íd
 !0Ë 
	`°bi__îr
("can't merge dcándác", "Corrupt JPEG");

2160 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2162 i‡(
j
->
succ_high
 == 0) {

2164 
	`mem£t
(
d©a
,0,64*(data[0]));

2165 
t
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hdc
);

2166 
diff
 = 
t
 ? 
	`°bi__exãnd_ª˚ive
(
j
,Å) : 0;

2168 
dc
 = 
j
->
img_comp
[
b
].
dc_¥ed
 + 
diff
;

2169 
j
->
img_comp
[
b
].
dc_¥ed
 = 
dc
;

2170 
d©a
[0] = (Ë(
dc
 << 
j
->
succ_low
);

2173 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2174 
d©a
[0] +(Ë(1 << 
j
->
succ_low
);

2177 
	}
}

2181 
	$°bi__j≥g_decode_block_¥og_ac
(
°bi__j≥g
 *
j
, 
d©a
[64], 
°bi__huffm™
 *
hac
, 
°bi__öt16
 *
Ác
)

2183 
k
;

2184 i‡(
j
->
•ec_°¨t
 =0Ë 
	`°bi__îr
("can't merge dcándác", "Corrupt JPEG");

2186 i‡(
j
->
succ_high
 == 0) {

2187 
shi·
 = 
j
->
succ_low
;

2189 i‡(
j
->
eob_run
) {

2190 --
j
->
eob_run
;

2194 
k
 = 
j
->
•ec_°¨t
;

2196 
zig
;

2197 
c
,
r
,
s
;

2198 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2199 
c
 = (
j
->
code_buf„r
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2200 
r
 = 
Ác
[
c
];

2201 i‡(
r
) {

2202 
k
 +(
r
 >> 4) & 15;

2203 
s
 = 
r
 & 15;

2204 
j
->
code_buf„r
 <<
s
;

2205 
j
->
code_bôs
 -
s
;

2206 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2207 
d©a
[
zig
] = (Ë((
r
 >> 8Ë<< 
shi·
);

2209 
rs
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hac
);

2210 i‡(
rs
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2211 
s
 = 
rs
 & 15;

2212 
r
 = 
rs
 >> 4;

2213 i‡(
s
 == 0) {

2214 i‡(
r
 < 15) {

2215 
j
->
eob_run
 = (1 << 
r
);

2216 i‡(
r
)

2217 
j
->
eob_run
 +
	`°bi__j≥g_gë_bôs
(j, 
r
);

2218 --
j
->
eob_run
;

2221 
k
 += 16;

2223 
k
 +
r
;

2224 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2225 
d©a
[
zig
] = (Ë(
	`°bi__exãnd_ª˚ive
(
j
,
s
Ë<< 
shi·
);

2228 } 
k
 <
j
->
•ec_íd
);

2232 
bô
 = (Ë(1 << 
j
->
succ_low
);

2234 i‡(
j
->
eob_run
) {

2235 --
j
->
eob_run
;

2236 
k
 = 
j
->
•ec_°¨t
; k <j->
•ec_íd
; ++k) {

2237 *
p
 = &
d©a
[
°bi__j≥g_dezigzag
[
k
]];

2238 i‡(*
p
 != 0)

2239 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2240 i‡((*
p
 & 
bô
)==0) {

2241 i‡(*
p
 > 0)

2242 *
p
 +
bô
;

2244 *
p
 -
bô
;

2248 
k
 = 
j
->
•ec_°¨t
;

2250 
r
,
s
;

2251 
rs
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hac
);

2252 i‡(
rs
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2253 
s
 = 
rs
 & 15;

2254 
r
 = 
rs
 >> 4;

2255 i‡(
s
 == 0) {

2256 i‡(
r
 < 15) {

2257 
j
->
eob_run
 = (1 << 
r
) - 1;

2258 i‡(
r
)

2259 
j
->
eob_run
 +
	`°bi__j≥g_gë_bôs
(j, 
r
);

2260 
r
 = 64;

2267 i‡(
s
 !1Ë 
	`°bi__îr
("bad huffman code", "Corrupt JPEG");

2269 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2270 
s
 = 
bô
;

2272 
s
 = -
bô
;

2276 
k
 <
j
->
•ec_íd
) {

2277 *
p
 = &
d©a
[
°bi__j≥g_dezigzag
[
k
++]];

2278 i‡(*
p
 != 0) {

2279 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2280 i‡((*
p
 & 
bô
)==0) {

2281 i‡(*
p
 > 0)

2282 *
p
 +
bô
;

2284 *
p
 -
bô
;

2287 i‡(
r
 == 0) {

2288 *
p
 = (Ë
s
;

2291 --
r
;

2294 } 
k
 <
j
->
•ec_íd
);

2298 
	}
}

2301 
°bi_ölöe
 
°bi_uc
 
	$°bi__˛amp
(
x
)

2304 i‡((Ë
x
 > 255) {

2305 i‡(
x
 < 0)  0;

2306 i‡(
x
 > 255)  255;

2308  (
°bi_uc
Ë
x
;

2309 
	}
}

2311 
	#°bi__f2f
(
x
Ë((Ë(((xË* 4096 + 0.5)))

	)

2312 
	#°bi__fsh
(
x
Ë((xË* 4096)

	)

2315 
	#STBI__IDCT_1D
(
s0
,
s1
,
s2
,
s3
,
s4
,
s5
,
s6
,
s7
) \

2316 
t0
,
t1
,
t2
,
t3
,
p1
,
p2
,
p3
,
p4
,
p5
,
x0
,
x1
,
x2
,
x3
; \

2317 
p2
 = 
s2
; \

2318 
p3
 = 
s6
; \

2319 
p1
 = (
p2
+
p3
Ë* 
	`°bi__f2f
(0.5411961f); \

2320 
t2
 = 
p1
 + 
p3
*
	`°bi__f2f
(-1.847759065f); \

2321 
t3
 = 
p1
 + 
p2
*
	`°bi__f2f
( 0.765366865f); \

2322 
p2
 = 
s0
; \

2323 
p3
 = 
s4
; \

2324 
t0
 = 
	`°bi__fsh
(
p2
+
p3
); \

2325 
t1
 = 
	`°bi__fsh
(
p2
-
p3
); \

2326 
x0
 = 
t0
+
t3
; \

2327 
x3
 = 
t0
-
t3
; \

2328 
x1
 = 
t1
+
t2
; \

2329 
x2
 = 
t1
-
t2
; \

2330 
t0
 = 
s7
; \

2331 
t1
 = 
s5
; \

2332 
t2
 = 
s3
; \

2333 
t3
 = 
s1
; \

2334 
p3
 = 
t0
+
t2
; \

2335 
p4
 = 
t1
+
t3
; \

2336 
p1
 = 
t0
+
t3
; \

2337 
p2
 = 
t1
+
t2
; \

2338 
p5
 = (
p3
+
p4
)*
	`°bi__f2f
( 1.175875602f); \

2339 
t0
 =Å0*
	`°bi__f2f
( 0.298631336f); \

2340 
t1
 =Å1*
	`°bi__f2f
( 2.053119869f); \

2341 
t2
 =Å2*
	`°bi__f2f
( 3.072711026f); \

2342 
t3
 =Å3*
	`°bi__f2f
( 1.501321110f); \

2343 
p1
 = 
p5
 +Ö1*
	`°bi__f2f
(-0.899976223f); \

2344 
p2
 = 
p5
 +Ö2*
	`°bi__f2f
(-2.562915447f); \

2345 
p3
 =Ö3*
	`°bi__f2f
(-1.961570560f); \

2346 
p4
 =Ö4*
	`°bi__f2f
(-0.390180644f); \

2347 
t3
 +
p1
+
p4
; \

2348 
t2
 +
p2
+
p3
; \

2349 
t1
 +
p2
+
p4
; \

2350 
t0
 +
p1
+
p3
;

	)

2352 
	$°bi__id˘_block
(
°bi_uc
 *
out
, 
out_°ride
, 
d©a
[64])

2354 
i
,
vÆ
[64],*
v
=val;

2355 
°bi_uc
 *
o
;

2356 *
d
 = 
d©a
;

2359 
i
=0; i < 8; ++i,++
d
, ++
v
) {

2361 i‡(
d
[ 8]==0 && d[16]==0 && d[24]==0 && d[32]==0

2362 && 
d
[40]==0 && d[48]==0 && d[56]==0) {

2367 
d˘îm
 = 
d
[0]*4;

2368 
v
[0] = v[8] = v[16] = v[24] = v[32] = v[40] = v[48] = v[56] = 
d˘îm
;

2370 
	`STBI__IDCT_1D
(
d
[ 0],d[ 8],d[16],d[24],d[32],d[40],d[48],d[56])

2373 
x0
 +512; 
x1
 +512; 
x2
 +512; 
x3
 += 512;

2374 
v
[ 0] = (
x0
+
t3
) >> 10;

2375 
v
[56] = (
x0
-
t3
) >> 10;

2376 
v
[ 8] = (
x1
+
t2
) >> 10;

2377 
v
[48] = (
x1
-
t2
) >> 10;

2378 
v
[16] = (
x2
+
t1
) >> 10;

2379 
v
[40] = (
x2
-
t1
) >> 10;

2380 
v
[24] = (
x3
+
t0
) >> 10;

2381 
v
[32] = (
x3
-
t0
) >> 10;

2385 
i
=0, 
v
=
vÆ
, 
o
=
out
; i < 8; ++i,v+=8,o+=
out_°ride
) {

2387 
	`STBI__IDCT_1D
(
v
[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7])

2394 
x0
 += 65536 + (128<<17);

2395 
x1
 += 65536 + (128<<17);

2396 
x2
 += 65536 + (128<<17);

2397 
x3
 += 65536 + (128<<17);

2400 
o
[0] = 
	`°bi__˛amp
((
x0
+
t3
) >> 17);

2401 
o
[7] = 
	`°bi__˛amp
((
x0
-
t3
) >> 17);

2402 
o
[1] = 
	`°bi__˛amp
((
x1
+
t2
) >> 17);

2403 
o
[6] = 
	`°bi__˛amp
((
x1
-
t2
) >> 17);

2404 
o
[2] = 
	`°bi__˛amp
((
x2
+
t1
) >> 17);

2405 
o
[5] = 
	`°bi__˛amp
((
x2
-
t1
) >> 17);

2406 
o
[3] = 
	`°bi__˛amp
((
x3
+
t0
) >> 17);

2407 
o
[4] = 
	`°bi__˛amp
((
x3
-
t0
) >> 17);

2409 
	}
}

2411 #ifde‡
STBI_SSE2


2415 
	$°bi__id˘_simd
(
°bi_uc
 *
out
, 
out_°ride
, 
d©a
[64])

2418 
__m128i
 
row0
, 
row1
, 
row2
, 
row3
, 
row4
, 
row5
, 
row6
, 
row7
;

2419 
__m128i
 
tmp
;

2422 
	#d˘_c⁄°
(
x
,
y
Ë
	`_mm_£å_ïi16
((x),(y),(x),(y),(x),(y),(x),(y))

	)

2426 
	#d˘_rŸ
(
out0
,
out1
, 
x
,
y
,
c0
,
c1
) \

2427 
__m128i
 
c0
##
lo
 = 
	`_mm_u≈acklo_ïi16
((
x
),(
y
)); \

2428 
__m128i
 
c0
##
hi
 = 
	`_mm_u≈ackhi_ïi16
((
x
),(
y
)); \

2429 
__m128i
 
out0
##
_l
 = 
	`_mm_madd_ïi16
(
c0
##
lo
, c0); \

2430 
__m128i
 
out0
##
_h
 = 
	`_mm_madd_ïi16
(
c0
##
hi
, c0); \

2431 
__m128i
 
out1
##
_l
 = 
	`_mm_madd_ïi16
(
c0
##
lo
, 
c1
); \

2432 
__m128i
 
out1
##
_h
 = 
	`_mm_madd_ïi16
(
c0
##
hi
, 
c1
)

	)

2435 
	#d˘_widí
(
out
, 
ö
) \

2436 
__m128i
 
out
##
_l
 = 
	`_mm_§ai_ïi32
(
	`_mm_u≈acklo_ïi16
(
	`_mm_£tzîo_si128
(), (
ö
)), 4); \

2437 
__m128i
 
out
##
_h
 = 
	`_mm_§ai_ïi32
(
	`_mm_u≈ackhi_ïi16
(
	`_mm_£tzîo_si128
(), (
ö
)), 4)

	)

2440 
	#d˘_wadd
(
out
, 
a
, 
b
) \

2441 
__m128i
 
out
##
_l
 = 
	`_mm_add_ïi32
(
a
##_l, 
b
##_l); \

2442 
__m128i
 
out
##
_h
 = 
	`_mm_add_ïi32
(
a
##_h, 
b
##_h)

	)

2445 
	#d˘_wsub
(
out
, 
a
, 
b
) \

2446 
__m128i
 
out
##
_l
 = 
	`_mm_sub_ïi32
(
a
##_l, 
b
##_l); \

2447 
__m128i
 
out
##
_h
 = 
	`_mm_sub_ïi32
(
a
##_h, 
b
##_h)

	)

2450 
	#d˘_bÊy32o
(
out0
, 
out1
, 
a
,
b
,
büs
,
s
) \

2452 
__m128i
 
abü£d_l
 = 
	`_mm_add_ïi32
(
a
##
_l
, 
büs
); \

2453 
__m128i
 
abü£d_h
 = 
	`_mm_add_ïi32
(
a
##
_h
, 
büs
); \

2454 
	`d˘_wadd
(
sum
, 
abü£d
, 
b
); \

2455 
	`d˘_wsub
(
dif
, 
abü£d
, 
b
); \

2456 
out0
 = 
	`_mm_∑cks_ïi32
(
	`_mm_§ai_ïi32
(
sum_l
, 
s
), _mm_§ai_ïi32(
sum_h
, s)); \

2457 
out1
 = 
	`_mm_∑cks_ïi32
(
	`_mm_§ai_ïi32
(
dif_l
, 
s
), _mm_§ai_ïi32(
dif_h
, s)); \

2458 }

	)

2461 
	#d˘_öãæóve8
(
a
, 
b
) \

2462 
tmp
 = 
a
; \

2463 
a
 = 
	`_mm_u≈acklo_ïi8
◊, 
b
); \

2464 
b
 = 
	`_mm_u≈ackhi_ïi8
(
tmp
, b)

	)

2467 
	#d˘_öãæóve16
(
a
, 
b
) \

2468 
tmp
 = 
a
; \

2469 
a
 = 
	`_mm_u≈acklo_ïi16
◊, 
b
); \

2470 
b
 = 
	`_mm_u≈ackhi_ïi16
(
tmp
, b)

	)

2472 
	#d˘_∑ss
(
büs
,
shi·
) \

2475 
	`d˘_rŸ
(
t2e
,
t3e
, 
row2
,
row6
, 
rŸ0_0
,
rŸ0_1
); \

2476 
__m128i
 
sum04
 = 
	`_mm_add_ïi16
(
row0
, 
row4
); \

2477 
__m128i
 
dif04
 = 
	`_mm_sub_ïi16
(
row0
, 
row4
); \

2478 
	`d˘_widí
(
t0e
, 
sum04
); \

2479 
	`d˘_widí
(
t1e
, 
dif04
); \

2480 
	`d˘_wadd
(
x0
, 
t0e
, 
t3e
); \

2481 
	`d˘_wsub
(
x3
, 
t0e
, 
t3e
); \

2482 
	`d˘_wadd
(
x1
, 
t1e
, 
t2e
); \

2483 
	`d˘_wsub
(
x2
, 
t1e
, 
t2e
); \

2485 
	`d˘_rŸ
(
y0o
,
y2o
, 
row7
,
row3
, 
rŸ2_0
,
rŸ2_1
); \

2486 
	`d˘_rŸ
(
y1o
,
y3o
, 
row5
,
row1
, 
rŸ3_0
,
rŸ3_1
); \

2487 
__m128i
 
sum17
 = 
	`_mm_add_ïi16
(
row1
, 
row7
); \

2488 
__m128i
 
sum35
 = 
	`_mm_add_ïi16
(
row3
, 
row5
); \

2489 
	`d˘_rŸ
(
y4o
,
y5o
, 
sum17
,
sum35
, 
rŸ1_0
,
rŸ1_1
); \

2490 
	`d˘_wadd
(
x4
, 
y0o
, 
y4o
); \

2491 
	`d˘_wadd
(
x5
, 
y1o
, 
y5o
); \

2492 
	`d˘_wadd
(
x6
, 
y2o
, 
y5o
); \

2493 
	`d˘_wadd
(
x7
, 
y3o
, 
y4o
); \

2494 
	`d˘_bÊy32o
(
row0
,
row7
, 
x0
,
x7
,
büs
,
shi·
); \

2495 
	`d˘_bÊy32o
(
row1
,
row6
, 
x1
,
x6
,
büs
,
shi·
); \

2496 
	`d˘_bÊy32o
(
row2
,
row5
, 
x2
,
x5
,
büs
,
shi·
); \

2497 
	`d˘_bÊy32o
(
row3
,
row4
, 
x3
,
x4
,
büs
,
shi·
); \

2498 }

	)

2500 
__m128i
 
rŸ0_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(0.5411961f), stbi__f2f(0.5411961f) + stbi__f2f(-1.847759065f));

2501 
__m128i
 
rŸ0_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(0.5411961f) + stbi__f2f( 0.765366865f), stbi__f2f(0.5411961f));

2502 
__m128i
 
rŸ1_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(1.175875602f) + stbi__f2f(-0.899976223f), stbi__f2f(1.175875602f));

2503 
__m128i
 
rŸ1_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(1.175875602f), stbi__f2f(1.175875602f) + stbi__f2f(-2.562915447f));

2504 
__m128i
 
rŸ2_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-1.961570560f) + stbi__f2f( 0.298631336f), stbi__f2f(-1.961570560f));

2505 
__m128i
 
rŸ2_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-1.961570560f), stbi__f2f(-1.961570560f) + stbi__f2f( 3.072711026f));

2506 
__m128i
 
rŸ3_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-0.390180644f) + stbi__f2f( 2.053119869f), stbi__f2f(-0.390180644f));

2507 
__m128i
 
rŸ3_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-0.390180644f), stbi__f2f(-0.390180644f) + stbi__f2f( 1.501321110f));

2510 
__m128i
 
büs_0
 = 
	`_mm_£t1_ïi32
(512);

2511 
__m128i
 
büs_1
 = 
	`_mm_£t1_ïi32
(65536 + (128<<17));

2514 
row0
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 0*8));

2515 
row1
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 1*8));

2516 
row2
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 2*8));

2517 
row3
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 3*8));

2518 
row4
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 4*8));

2519 
row5
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 5*8));

2520 
row6
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 6*8));

2521 
row7
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 7*8));

2524 
	`d˘_∑ss
(
büs_0
, 10);

2528 
	`d˘_öãæóve16
(
row0
, 
row4
);

2529 
	`d˘_öãæóve16
(
row1
, 
row5
);

2530 
	`d˘_öãæóve16
(
row2
, 
row6
);

2531 
	`d˘_öãæóve16
(
row3
, 
row7
);

2534 
	`d˘_öãæóve16
(
row0
, 
row2
);

2535 
	`d˘_öãæóve16
(
row1
, 
row3
);

2536 
	`d˘_öãæóve16
(
row4
, 
row6
);

2537 
	`d˘_öãæóve16
(
row5
, 
row7
);

2540 
	`d˘_öãæóve16
(
row0
, 
row1
);

2541 
	`d˘_öãæóve16
(
row2
, 
row3
);

2542 
	`d˘_öãæóve16
(
row4
, 
row5
);

2543 
	`d˘_öãæóve16
(
row6
, 
row7
);

2547 
	`d˘_∑ss
(
büs_1
, 17);

2551 
__m128i
 
p0
 = 
	`_mm_∑ckus_ïi16
(
row0
, 
row1
);

2552 
__m128i
 
p1
 = 
	`_mm_∑ckus_ïi16
(
row2
, 
row3
);

2553 
__m128i
 
p2
 = 
	`_mm_∑ckus_ïi16
(
row4
, 
row5
);

2554 
__m128i
 
p3
 = 
	`_mm_∑ckus_ïi16
(
row6
, 
row7
);

2557 
	`d˘_öãæóve8
(
p0
, 
p2
);

2558 
	`d˘_öãæóve8
(
p1
, 
p3
);

2561 
	`d˘_öãæóve8
(
p0
, 
p1
);

2562 
	`d˘_öãæóve8
(
p2
, 
p3
);

2565 
	`d˘_öãæóve8
(
p0
, 
p2
);

2566 
	`d˘_öãæóve8
(
p1
, 
p3
);

2569 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p0
); ouà+
out_°ride
;

2570 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p0
, 0x4e)); ouà+
out_°ride
;

2571 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p2
); ouà+
out_°ride
;

2572 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p2
, 0x4e)); ouà+
out_°ride
;

2573 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p1
); ouà+
out_°ride
;

2574 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p1
, 0x4e)); ouà+
out_°ride
;

2575 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p3
); ouà+
out_°ride
;

2576 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p3
, 0x4e));

2579 #unde‡
d˘_c⁄°


2580 #unde‡
d˘_rŸ


2581 #unde‡
d˘_widí


2582 #unde‡
d˘_wadd


2583 #unde‡
d˘_wsub


2584 #unde‡
d˘_bÊy32o


2585 #unde‡
d˘_öãæóve8


2586 #unde‡
d˘_öãæóve16


2587 #unde‡
d˘_∑ss


2588 
	}
}

2592 #ifde‡
STBI_NEON


2596 
	$°bi__id˘_simd
(
°bi_uc
 *
out
, 
out_°ride
, 
põ˚_d©a
[64])

2598 
öt16x8_t
 
row0
, 
row1
, 
row2
, 
row3
, 
row4
, 
row5
, 
row6
, 
row7
;

2600 
öt16x4_t
 
rŸ0_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
(0.5411961f));

2601 
öt16x4_t
 
rŸ0_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-1.847759065f));

2602 
öt16x4_t
 
rŸ0_2
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 0.765366865f));

2603 
öt16x4_t
 
rŸ1_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 1.175875602f));

2604 
öt16x4_t
 
rŸ1_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-0.899976223f));

2605 
öt16x4_t
 
rŸ1_2
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-2.562915447f));

2606 
öt16x4_t
 
rŸ2_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-1.961570560f));

2607 
öt16x4_t
 
rŸ2_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-0.390180644f));

2608 
öt16x4_t
 
rŸ3_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 0.298631336f));

2609 
öt16x4_t
 
rŸ3_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 2.053119869f));

2610 
öt16x4_t
 
rŸ3_2
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 3.072711026f));

2611 
öt16x4_t
 
rŸ3_3
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 1.501321110f));

2613 
	#d˘_l⁄g_mul
(
out
, 
öq
, 
c€ff
) \

2614 
öt32x4_t
 
out
##
_l
 = 
	`vmuŒ_s16
(
	`vgë_low_s16
(
öq
), 
c€ff
); \

2615 
öt32x4_t
 
out
##
_h
 = 
	`vmuŒ_s16
(
	`vgë_high_s16
(
öq
), 
c€ff
)

	)

2617 
	#d˘_l⁄g_mac
(
out
, 
acc
, 
öq
, 
c€ff
) \

2618 
öt32x4_t
 
out
##
_l
 = 
	`vmœl_s16
(
acc
##_l, 
	`vgë_low_s16
(
öq
), 
c€ff
); \

2619 
öt32x4_t
 
out
##
_h
 = 
	`vmœl_s16
(
acc
##_h, 
	`vgë_high_s16
(
öq
), 
c€ff
)

	)

2621 
	#d˘_widí
(
out
, 
öq
) \

2622 
öt32x4_t
 
out
##
_l
 = 
	`vshŒ_n_s16
(
	`vgë_low_s16
(
öq
), 12); \

2623 
öt32x4_t
 
out
##
_h
 = 
	`vshŒ_n_s16
(
	`vgë_high_s16
(
öq
), 12)

	)

2626 
	#d˘_wadd
(
out
, 
a
, 
b
) \

2627 
öt32x4_t
 
out
##
_l
 = 
	`vaddq_s32
(
a
##_l, 
b
##_l); \

2628 
öt32x4_t
 
out
##
_h
 = 
	`vaddq_s32
(
a
##_h, 
b
##_h)

	)

2631 
	#d˘_wsub
(
out
, 
a
, 
b
) \

2632 
öt32x4_t
 
out
##
_l
 = 
	`vsubq_s32
(
a
##_l, 
b
##_l); \

2633 
öt32x4_t
 
out
##
_h
 = 
	`vsubq_s32
(
a
##_h, 
b
##_h)

	)

2636 
	#d˘_bÊy32o
(
out0
,
out1
, 
a
,
b
,
shi·›
,
s
) \

2638 
	`d˘_wadd
(
sum
, 
a
, 
b
); \

2639 
	`d˘_wsub
(
dif
, 
a
, 
b
); \

2640 
out0
 = 
	`vcomböe_s16
(
	`shi·›
(
sum_l
, 
s
), shi·›(
sum_h
, s)); \

2641 
out1
 = 
	`vcomböe_s16
(
	`shi·›
(
dif_l
, 
s
), shi·›(
dif_h
, s)); \

2642 }

	)

2644 
	#d˘_∑ss
(
shi·›
, 
shi·
) \

2647 
öt16x8_t
 
sum26
 = 
	`vaddq_s16
(
row2
, 
row6
); \

2648 
	`d˘_l⁄g_mul
(
p1e
, 
sum26
, 
rŸ0_0
); \

2649 
	`d˘_l⁄g_mac
(
t2e
, 
p1e
, 
row6
, 
rŸ0_1
); \

2650 
	`d˘_l⁄g_mac
(
t3e
, 
p1e
, 
row2
, 
rŸ0_2
); \

2651 
öt16x8_t
 
sum04
 = 
	`vaddq_s16
(
row0
, 
row4
); \

2652 
öt16x8_t
 
dif04
 = 
	`vsubq_s16
(
row0
, 
row4
); \

2653 
	`d˘_widí
(
t0e
, 
sum04
); \

2654 
	`d˘_widí
(
t1e
, 
dif04
); \

2655 
	`d˘_wadd
(
x0
, 
t0e
, 
t3e
); \

2656 
	`d˘_wsub
(
x3
, 
t0e
, 
t3e
); \

2657 
	`d˘_wadd
(
x1
, 
t1e
, 
t2e
); \

2658 
	`d˘_wsub
(
x2
, 
t1e
, 
t2e
); \

2660 
öt16x8_t
 
sum15
 = 
	`vaddq_s16
(
row1
, 
row5
); \

2661 
öt16x8_t
 
sum17
 = 
	`vaddq_s16
(
row1
, 
row7
); \

2662 
öt16x8_t
 
sum35
 = 
	`vaddq_s16
(
row3
, 
row5
); \

2663 
öt16x8_t
 
sum37
 = 
	`vaddq_s16
(
row3
, 
row7
); \

2664 
öt16x8_t
 
sumodd
 = 
	`vaddq_s16
(
sum17
, 
sum35
); \

2665 
	`d˘_l⁄g_mul
(
p5o
, 
sumodd
, 
rŸ1_0
); \

2666 
	`d˘_l⁄g_mac
(
p1o
, 
p5o
, 
sum17
, 
rŸ1_1
); \

2667 
	`d˘_l⁄g_mac
(
p2o
, 
p5o
, 
sum35
, 
rŸ1_2
); \

2668 
	`d˘_l⁄g_mul
(
p3o
, 
sum37
, 
rŸ2_0
); \

2669 
	`d˘_l⁄g_mul
(
p4o
, 
sum15
, 
rŸ2_1
); \

2670 
	`d˘_wadd
(
sump13o
, 
p1o
, 
p3o
); \

2671 
	`d˘_wadd
(
sump24o
, 
p2o
, 
p4o
); \

2672 
	`d˘_wadd
(
sump23o
, 
p2o
, 
p3o
); \

2673 
	`d˘_wadd
(
sump14o
, 
p1o
, 
p4o
); \

2674 
	`d˘_l⁄g_mac
(
x4
, 
sump13o
, 
row7
, 
rŸ3_0
); \

2675 
	`d˘_l⁄g_mac
(
x5
, 
sump24o
, 
row5
, 
rŸ3_1
); \

2676 
	`d˘_l⁄g_mac
(
x6
, 
sump23o
, 
row3
, 
rŸ3_2
); \

2677 
	`d˘_l⁄g_mac
(
x7
, 
sump14o
, 
row1
, 
rŸ3_3
); \

2678 
	`d˘_bÊy32o
(
row0
,
row7
, 
x0
,
x7
,
shi·›
,
shi·
); \

2679 
	`d˘_bÊy32o
(
row1
,
row6
, 
x1
,
x6
,
shi·›
,
shi·
); \

2680 
	`d˘_bÊy32o
(
row2
,
row5
, 
x2
,
x5
,
shi·›
,
shi·
); \

2681 
	`d˘_bÊy32o
(
row3
,
row4
, 
x3
,
x4
,
shi·›
,
shi·
); \

2682 }

	)

2685 
row0
 = 
	`vld1q_s16
(
põ˚_d©a
 + 0*8);

2686 
row1
 = 
	`vld1q_s16
(
põ˚_d©a
 + 1*8);

2687 
row2
 = 
	`vld1q_s16
(
põ˚_d©a
 + 2*8);

2688 
row3
 = 
	`vld1q_s16
(
põ˚_d©a
 + 3*8);

2689 
row4
 = 
	`vld1q_s16
(
põ˚_d©a
 + 4*8);

2690 
row5
 = 
	`vld1q_s16
(
põ˚_d©a
 + 5*8);

2691 
row6
 = 
	`vld1q_s16
(
põ˚_d©a
 + 6*8);

2692 
row7
 = 
	`vld1q_s16
(
põ˚_d©a
 + 7*8);

2695 
row0
 = 
	`vaddq_s16
‘ow0, 
	`v£tq_œ√_s16
(1024, 
	`vdupq_n_s16
(0), 0));

2698 
	`d˘_∑ss
(
vrsh∫_n_s32
, 10);

2704 
	#d˘_ån16
(
x
, 
y
Ë{ 
öt16x8x2_t
 
t
 = 
	`vånq_s16
(x, y); x =Å.
vÆ
[0]; y =Å.vÆ[1]; }

	)

2705 
	#d˘_ån32
(
x
, 
y
Ë{ 
öt32x4x2_t
 
t
 = 
	`vånq_s32
(
	`vªöãΩªtq_s32_s16
(x), vªöãΩªtq_s32_s16(y)); x = 
	`vªöãΩªtq_s16_s32
—.
vÆ
[0]); y = vªöãΩªtq_s16_s32—.vÆ[1]); }

	)

2706 
	#d˘_ån64
(
x
, 
y
Ë{ 
öt16x8_t
 
x0
 = x; i¡16x8_à
y0
 = y; x = 
	`vcomböe_s16
(
	`vgë_low_s16
(x0), vgë_low_s16(y0)); y = vcomböe_s16(
	`vgë_high_s16
(x0), vgë_high_s16(y0)); }

	)

2709 
	`d˘_ån16
(
row0
, 
row1
);

2710 
	`d˘_ån16
(
row2
, 
row3
);

2711 
	`d˘_ån16
(
row4
, 
row5
);

2712 
	`d˘_ån16
(
row6
, 
row7
);

2715 
	`d˘_ån32
(
row0
, 
row2
);

2716 
	`d˘_ån32
(
row1
, 
row3
);

2717 
	`d˘_ån32
(
row4
, 
row6
);

2718 
	`d˘_ån32
(
row5
, 
row7
);

2721 
	`d˘_ån64
(
row0
, 
row4
);

2722 
	`d˘_ån64
(
row1
, 
row5
);

2723 
	`d˘_ån64
(
row2
, 
row6
);

2724 
	`d˘_ån64
(
row3
, 
row7
);

2726 #unde‡
d˘_ån16


2727 #unde‡
d˘_ån32


2728 #unde‡
d˘_ån64


2735 
	`d˘_∑ss
(
vsh∫_n_s32
, 16);

2739 
uöt8x8_t
 
p0
 = 
	`vqrshrun_n_s16
(
row0
, 1);

2740 
uöt8x8_t
 
p1
 = 
	`vqrshrun_n_s16
(
row1
, 1);

2741 
uöt8x8_t
 
p2
 = 
	`vqrshrun_n_s16
(
row2
, 1);

2742 
uöt8x8_t
 
p3
 = 
	`vqrshrun_n_s16
(
row3
, 1);

2743 
uöt8x8_t
 
p4
 = 
	`vqrshrun_n_s16
(
row4
, 1);

2744 
uöt8x8_t
 
p5
 = 
	`vqrshrun_n_s16
(
row5
, 1);

2745 
uöt8x8_t
 
p6
 = 
	`vqrshrun_n_s16
(
row6
, 1);

2746 
uöt8x8_t
 
p7
 = 
	`vqrshrun_n_s16
(
row7
, 1);

2749 
	#d˘_ån8_8
(
x
, 
y
Ë{ 
uöt8x8x2_t
 
t
 = 
	`vån_u8
(x, y); x =Å.
vÆ
[0]; y =Å.vÆ[1]; }

	)

2750 
	#d˘_ån8_16
(
x
, 
y
Ë{ 
uöt16x4x2_t
 
t
 = 
	`vån_u16
(
	`vªöãΩªt_u16_u8
(x), vªöãΩªt_u16_u8(y)); x = 
	`vªöãΩªt_u8_u16
—.
vÆ
[0]); y = vªöãΩªt_u8_u16—.vÆ[1]); }

	)

2751 
	#d˘_ån8_32
(
x
, 
y
Ë{ 
uöt32x2x2_t
 
t
 = 
	`vån_u32
(
	`vªöãΩªt_u32_u8
(x), vªöãΩªt_u32_u8(y)); x = 
	`vªöãΩªt_u8_u32
—.
vÆ
[0]); y = vªöãΩªt_u8_u32—.vÆ[1]); }

	)

2757 
	`d˘_ån8_8
(
p0
, 
p1
);

2758 
	`d˘_ån8_8
(
p2
, 
p3
);

2759 
	`d˘_ån8_8
(
p4
, 
p5
);

2760 
	`d˘_ån8_8
(
p6
, 
p7
);

2763 
	`d˘_ån8_16
(
p0
, 
p2
);

2764 
	`d˘_ån8_16
(
p1
, 
p3
);

2765 
	`d˘_ån8_16
(
p4
, 
p6
);

2766 
	`d˘_ån8_16
(
p5
, 
p7
);

2769 
	`d˘_ån8_32
(
p0
, 
p4
);

2770 
	`d˘_ån8_32
(
p1
, 
p5
);

2771 
	`d˘_ån8_32
(
p2
, 
p6
);

2772 
	`d˘_ån8_32
(
p3
, 
p7
);

2775 
	`v°1_u8
(
out
, 
p0
); ouà+
out_°ride
;

2776 
	`v°1_u8
(
out
, 
p1
); ouà+
out_°ride
;

2777 
	`v°1_u8
(
out
, 
p2
); ouà+
out_°ride
;

2778 
	`v°1_u8
(
out
, 
p3
); ouà+
out_°ride
;

2779 
	`v°1_u8
(
out
, 
p4
); ouà+
out_°ride
;

2780 
	`v°1_u8
(
out
, 
p5
); ouà+
out_°ride
;

2781 
	`v°1_u8
(
out
, 
p6
); ouà+
out_°ride
;

2782 
	`v°1_u8
(
out
, 
p7
);

2784 #unde‡
d˘_ån8_8


2785 #unde‡
d˘_ån8_16


2786 #unde‡
d˘_ån8_32


2789 #unde‡
d˘_l⁄g_mul


2790 #unde‡
d˘_l⁄g_mac


2791 #unde‡
d˘_widí


2792 #unde‡
d˘_wadd


2793 #unde‡
d˘_wsub


2794 #unde‡
d˘_bÊy32o


2795 #unde‡
d˘_∑ss


2796 
	}
}

2800 
	#STBI__MARKER_n⁄e
 0xff

	)

2804 
°bi_uc
 
	$°bi__gë_m¨kî
(
°bi__j≥g
 *
j
)

2806 
°bi_uc
 
x
;

2807 i‡(
j
->
m¨kî
 !
STBI__MARKER_n⁄e
Ë{ 
x
 = j->marker; j->marker = STBI__MARKER_none;  x; }

2808 
x
 = 
	`°bi__gë8
(
j
->
s
);

2809 i‡(
x
 !0xffË 
STBI__MARKER_n⁄e
;

2810 
x
 == 0xff)

2811 
x
 = 
	`°bi__gë8
(
j
->
s
);

2812  
x
;

2813 
	}
}

2817 
	#STBI__RESTART
(
x
Ë((xË>0xd0 && (xË<0xd7)

	)

2821 
	$°bi__j≥g_ª£t
(
°bi__j≥g
 *
j
)

2823 
j
->
code_bôs
 = 0;

2824 
j
->
code_buf„r
 = 0;

2825 
j
->
nom‹e
 = 0;

2826 
j
->
img_comp
[0].
dc_¥ed
 = j->img_comp[1].dc_pred = j->img_comp[2].dc_pred = j->img_comp[3].dc_pred = 0;

2827 
j
->
m¨kî
 = 
STBI__MARKER_n⁄e
;

2828 
j
->
todo
 = j->
ª°¨t_öãrvÆ
 ? j->restart_interval : 0x7fffffff;

2829 
j
->
eob_run
 = 0;

2832 
	}
}

2834 
	$°bi__∑r£_íå›y_coded_d©a
(
°bi__j≥g
 *
z
)

2836 
	`°bi__j≥g_ª£t
(
z
);

2837 i‡(!
z
->
¥ogªssive
) {

2838 i‡(
z
->
sˇn_n
 == 1) {

2839 
i
,
j
;

2840 
	`STBI_SIMD_ALIGN
(, 
d©a
[64]);

2841 
n
 = 
z
->
‹dî
[0];

2846 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2847 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2848 
j
=0; j < 
h
; ++j) {

2849 
i
=0; i < 
w
; ++i) {

2850 
ha
 = 
z
->
img_comp
[
n
].ha;

2851 i‡(!
	`°bi__j≥g_decode_block
(
z
, 
d©a
, z->
huff_dc
+z->
img_comp
[
n
].
hd
, z->
huff_ac
+
ha
, z->
Á°_ac
[ha],Ç, z->
dequ™t
[z->img_comp[n].
tq
]))  0;

2852 
z
->
	`id˘_block_kî√l
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
j
*8+
i
*8, z->img_comp[n].w2, data);

2854 i‡(--
z
->
todo
 <= 0) {

2855 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

2858 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

2859 
	`°bi__j≥g_ª£t
(
z
);

2865 
i
,
j
,
k
,
x
,
y
;

2866 
	`STBI_SIMD_ALIGN
(, 
d©a
[64]);

2867 
j
=0; j < 
z
->
img_mcu_y
; ++j) {

2868 
i
=0; i < 
z
->
img_mcu_x
; ++i) {

2870 
k
=0; k < 
z
->
sˇn_n
; ++k) {

2871 
n
 = 
z
->
‹dî
[
k
];

2874 
y
=0; y < 
z
->
img_comp
[
n
].
v
; ++y) {

2875 
x
=0; x < 
z
->
img_comp
[
n
].
h
; ++x) {

2876 
x2
 = (
i
*
z
->
img_comp
[
n
].
h
 + 
x
)*8;

2877 
y2
 = (
j
*
z
->
img_comp
[
n
].
v
 + 
y
)*8;

2878 
ha
 = 
z
->
img_comp
[
n
].ha;

2879 i‡(!
	`°bi__j≥g_decode_block
(
z
, 
d©a
, z->
huff_dc
+z->
img_comp
[
n
].
hd
, z->
huff_ac
+
ha
, z->
Á°_ac
[ha],Ç, z->
dequ™t
[z->img_comp[n].
tq
]))  0;

2880 
z
->
	`id˘_block_kî√l
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
y2
+
x2
, z->img_comp[n].w2, data);

2886 i‡(--
z
->
todo
 <= 0) {

2887 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

2888 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

2889 
	`°bi__j≥g_ª£t
(
z
);

2896 i‡(
z
->
sˇn_n
 == 1) {

2897 
i
,
j
;

2898 
n
 = 
z
->
‹dî
[0];

2903 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2904 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2905 
j
=0; j < 
h
; ++j) {

2906 
i
=0; i < 
w
; ++i) {

2907 *
d©a
 = 
z
->
img_comp
[
n
].
c€ff
 + 64 * (
i
 + 
j
 * z->img_comp[n].
c€ff_w
);

2908 i‡(
z
->
•ec_°¨t
 == 0) {

2909 i‡(!
	`°bi__j≥g_decode_block_¥og_dc
(
z
, 
d©a
, &z->
huff_dc
[z->
img_comp
[
n
].
hd
],Ç))

2912 
ha
 = 
z
->
img_comp
[
n
].ha;

2913 i‡(!
	`°bi__j≥g_decode_block_¥og_ac
(
z
, 
d©a
, &z->
huff_ac
[
ha
], z->
Á°_ac
[ha]))

2917 i‡(--
z
->
todo
 <= 0) {

2918 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

2919 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

2920 
	`°bi__j≥g_ª£t
(
z
);

2926 
i
,
j
,
k
,
x
,
y
;

2927 
j
=0; j < 
z
->
img_mcu_y
; ++j) {

2928 
i
=0; i < 
z
->
img_mcu_x
; ++i) {

2930 
k
=0; k < 
z
->
sˇn_n
; ++k) {

2931 
n
 = 
z
->
‹dî
[
k
];

2934 
y
=0; y < 
z
->
img_comp
[
n
].
v
; ++y) {

2935 
x
=0; x < 
z
->
img_comp
[
n
].
h
; ++x) {

2936 
x2
 = (
i
*
z
->
img_comp
[
n
].
h
 + 
x
);

2937 
y2
 = (
j
*
z
->
img_comp
[
n
].
v
 + 
y
);

2938 *
d©a
 = 
z
->
img_comp
[
n
].
c€ff
 + 64 * (
x2
 + 
y2
 * z->img_comp[n].
c€ff_w
);

2939 i‡(!
	`°bi__j≥g_decode_block_¥og_dc
(
z
, 
d©a
, &z->
huff_dc
[z->
img_comp
[
n
].
hd
],Ç))

2946 i‡(--
z
->
todo
 <= 0) {

2947 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

2948 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

2949 
	`°bi__j≥g_ª£t
(
z
);

2956 
	}
}

2958 
	$°bi__j≥g_dequ™tize
(*
d©a
, 
°bi__uöt16
 *
dequ™t
)

2960 
i
;

2961 
i
=0; i < 64; ++i)

2962 
d©a
[
i
] *
dequ™t
[i];

2963 
	}
}

2965 
	$°bi__j≥g_föish
(
°bi__j≥g
 *
z
)

2967 i‡(
z
->
¥ogªssive
) {

2969 
i
,
j
,
n
;

2970 
n
=0;Ç < 
z
->
s
->
img_n
; ++n) {

2971 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2972 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2973 
j
=0; j < 
h
; ++j) {

2974 
i
=0; i < 
w
; ++i) {

2975 *
d©a
 = 
z
->
img_comp
[
n
].
c€ff
 + 64 * (
i
 + 
j
 * z->img_comp[n].
c€ff_w
);

2976 
	`°bi__j≥g_dequ™tize
(
d©a
, 
z
->
dequ™t
[z->
img_comp
[
n
].
tq
]);

2977 
z
->
	`id˘_block_kî√l
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
j
*8+
i
*8, z->img_comp[n].w2, data);

2982 
	}
}

2984 
	$°bi__¥o˚ss_m¨kî
(
°bi__j≥g
 *
z
, 
m
)

2986 
L
;

2987 
m
) {

2988 
STBI__MARKER_n⁄e
:

2989  
	`°bi__îr
("expected marker","Corrupt JPEG");

2992 i‡(
	`°bi__gë16be
(
z
->
s
Ë!4Ë 
	`°bi__îr
("bad DRIÜen","Corrupt JPEG");

2993 
z
->
ª°¨t_öãrvÆ
 = 
	`°bi__gë16be
(z->
s
);

2997 
L
 = 
	`°bi__gë16be
(
z
->
s
)-2;

2998 
L
 > 0) {

2999 
q
 = 
	`°bi__gë8
(
z
->
s
);

3000 
p
 = 
q
 >> 4, 
sixãí
 = (p != 0);

3001 
t
 = 
q
 & 15,
i
;

3002 i‡(
p
 !0 &&Ö !1Ë 
	`°bi__îr
("bad DQTÅype","Corrupt JPEG");

3003 i‡(
t
 > 3Ë 
	`°bi__îr
("bad DQTÅable","Corrupt JPEG");

3005 
i
=0; i < 64; ++i)

3006 
z
->
dequ™t
[
t
][
°bi__j≥g_dezigzag
[
i
]] = (
°bi__uöt16
)(
sixãí
 ? 
	`°bi__gë16be
(z->
s
Ë: 
	`°bi__gë8
(z->s));

3007 
L
 -(
sixãí
 ? 129 : 65);

3009  
L
==0;

3012 
L
 = 
	`°bi__gë16be
(
z
->
s
)-2;

3013 
L
 > 0) {

3014 
°bi_uc
 *
v
;

3015 
sizes
[16],
i
,
n
=0;

3016 
q
 = 
	`°bi__gë8
(
z
->
s
);

3017 
tc
 = 
q
 >> 4;

3018 
th
 = 
q
 & 15;

3019 i‡(
tc
 > 1 || 
th
 > 3Ë 
	`°bi__îr
("bad DHT header","Corrupt JPEG");

3020 
i
=0; i < 16; ++i) {

3021 
sizes
[
i
] = 
	`°bi__gë8
(
z
->
s
);

3022 
n
 +
sizes
[
i
];

3024 
L
 -= 17;

3025 i‡(
tc
 == 0) {

3026 i‡(!
	`°bi__buûd_huffm™
(
z
->
huff_dc
+
th
, 
sizes
))  0;

3027 
v
 = 
z
->
huff_dc
[
th
].
vÆues
;

3029 i‡(!
	`°bi__buûd_huffm™
(
z
->
huff_ac
+
th
, 
sizes
))  0;

3030 
v
 = 
z
->
huff_ac
[
th
].
vÆues
;

3032 
i
=0; i < 
n
; ++i)

3033 
v
[
i
] = 
	`°bi__gë8
(
z
->
s
);

3034 i‡(
tc
 != 0)

3035 
	`°bi__buûd_Á°_ac
(
z
->
Á°_ac
[
th
], z->
huff_ac
 +Åh);

3036 
L
 -
n
;

3038  
L
==0;

3042 i‡((
m
 >= 0xE0 && m <= 0xEF) || m == 0xFE) {

3043 
L
 = 
	`°bi__gë16be
(
z
->
s
);

3044 i‡(
L
 < 2) {

3045 i‡(
m
 == 0xFE)

3046  
	`°bi__îr
("bad COMÜen","Corrupt JPEG");

3048  
	`°bi__îr
("bad APPÜen","Corrupt JPEG");

3050 
L
 -= 2;

3052 i‡(
m
 =0xE0 && 
L
 >= 5) {

3053 c⁄° 
èg
[5] = {'J','F','I','F','\0'};

3054 
ok
 = 1;

3055 
i
;

3056 
i
=0; i < 5; ++i)

3057 i‡(
	`°bi__gë8
(
z
->
s
Ë!
èg
[
i
])

3058 
ok
 = 0;

3059 
L
 -= 5;

3060 i‡(
ok
)

3061 
z
->
jfif
 = 1;

3062 } i‡(
m
 =0xEE && 
L
 >= 12) {

3063 c⁄° 
èg
[6] = {'A','d','o','b','e','\0'};

3064 
ok
 = 1;

3065 
i
;

3066 
i
=0; i < 6; ++i)

3067 i‡(
	`°bi__gë8
(
z
->
s
Ë!
èg
[
i
])

3068 
ok
 = 0;

3069 
L
 -= 6;

3070 i‡(
ok
) {

3071 
	`°bi__gë8
(
z
->
s
);

3072 
	`°bi__gë16be
(
z
->
s
);

3073 
	`°bi__gë16be
(
z
->
s
);

3074 
z
->
≠p14_cﬁ‹_å™sf‹m
 = 
	`°bi__gë8
(z->
s
);

3075 
L
 -= 6;

3079 
	`°bi__skù
(
z
->
s
, 
L
);

3083  
	`°bi__îr
("unknown marker","Corrupt JPEG");

3084 
	}
}

3087 
	$°bi__¥o˚ss_sˇn_hódî
(
°bi__j≥g
 *
z
)

3089 
i
;

3090 
Ls
 = 
	`°bi__gë16be
(
z
->
s
);

3091 
z
->
sˇn_n
 = 
	`°bi__gë8
(z->
s
);

3092 i‡(
z
->
sˇn_n
 < 1 || z->sˇn_¿> 4 || z->sˇn_¿> (Ëz->
s
->
img_n
Ë 
	`°bi__îr
("bad SOS component count","Corrupt JPEG");

3093 i‡(
Ls
 !6+2*
z
->
sˇn_n
Ë 
	`°bi__îr
("bad SOSÜen","Corrupt JPEG");

3094 
i
=0; i < 
z
->
sˇn_n
; ++i) {

3095 
id
 = 
	`°bi__gë8
(
z
->
s
), 
which
;

3096 
q
 = 
	`°bi__gë8
(
z
->
s
);

3097 
which
 = 0; which < 
z
->
s
->
img_n
; ++which)

3098 i‡(
z
->
img_comp
[
which
].
id
 == id)

3100 i‡(
which
 =
z
->
s
->
img_n
)  0;

3101 
z
->
img_comp
[
which
].
hd
 = 
q
 >> 4; i‡(z->img_comp[which].hd > 3Ë 
	`°bi__îr
("bad DC huff","Corrupt JPEG");

3102 
z
->
img_comp
[
which
].
ha
 = 
q
 & 15; i‡(z->img_comp[which].h®> 3Ë 
	`°bi__îr
("bad AC huff","Corrupt JPEG");

3103 
z
->
‹dî
[
i
] = 
which
;

3107 
Ø
;

3108 
z
->
•ec_°¨t
 = 
	`°bi__gë8
(z->
s
);

3109 
z
->
•ec_íd
 = 
	`°bi__gë8
(z->
s
);

3110 
Ø
 = 
	`°bi__gë8
(
z
->
s
);

3111 
z
->
succ_high
 = (
Ø
 >> 4);

3112 
z
->
succ_low
 = (
Ø
 & 15);

3113 i‡(
z
->
¥ogªssive
) {

3114 i‡(
z
->
•ec_°¨t
 > 63 || z->
•ec_íd
 > 63 || z->•ec_°¨à> z->•ec_íd || z->
succ_high
 > 13 || z->
succ_low
 > 13)

3115  
	`°bi__îr
("bad SOS", "Corrupt JPEG");

3117 i‡(
z
->
•ec_°¨t
 !0Ë 
	`°bi__îr
("bad SOS","Corrupt JPEG");

3118 i‡(
z
->
succ_high
 !0 || z->
succ_low
 !0Ë 
	`°bi__îr
("bad SOS","Corrupt JPEG");

3119 
z
->
•ec_íd
 = 63;

3124 
	}
}

3126 
	$°bi__‰ì_j≥g_comp⁄íts
(
°bi__j≥g
 *
z
, 
ncomp
, 
why
)

3128 
i
;

3129 
i
=0; i < 
ncomp
; ++i) {

3130 i‡(
z
->
img_comp
[
i
].
øw_d©a
) {

3131 
	`STBI_FREE
(
z
->
img_comp
[
i
].
øw_d©a
);

3132 
z
->
img_comp
[
i
].
øw_d©a
 = 
NULL
;

3133 
z
->
img_comp
[
i
].
d©a
 = 
NULL
;

3135 i‡(
z
->
img_comp
[
i
].
øw_c€ff
) {

3136 
	`STBI_FREE
(
z
->
img_comp
[
i
].
øw_c€ff
);

3137 
z
->
img_comp
[
i
].
øw_c€ff
 = 0;

3138 
z
->
img_comp
[
i
].
c€ff
 = 0;

3140 i‡(
z
->
img_comp
[
i
].
löebuf
) {

3141 
	`STBI_FREE
(
z
->
img_comp
[
i
].
löebuf
);

3142 
z
->
img_comp
[
i
].
löebuf
 = 
NULL
;

3145  
why
;

3146 
	}
}

3148 
	$°bi__¥o˚ss_‰ame_hódî
(
°bi__j≥g
 *
z
, 
sˇn
)

3150 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

3151 
Lf
,
p
,
i
,
q
, 
h_max
=1,
v_max
=1,
c
;

3152 
Lf
 = 
	`°bi__gë16be
(
s
); i‡(L‡< 11Ë 
	`°bi__îr
("bad SOFÜen","Corrupt JPEG");

3153 
p
 = 
	`°bi__gë8
(
s
); i‡’ !8Ë 
	`°bi__îr
("only 8-bit","JPEG formatÇot supported: 8-bit only");

3154 
s
->
img_y
 = 
	`°bi__gë16be
(s); i‡(s->img_y =0Ë 
	`°bi__îr
("no header height", "JPEG formatÇot supported: delayed height");

3155 
s
->
img_x
 = 
	`°bi__gë16be
(s); i‡(s->img_x =0Ë 
	`°bi__îr
("0 width","Corrupt JPEG");

3156 
c
 = 
	`°bi__gë8
(
s
);

3157 i‡(
c
 !3 && c !1 && c !4Ë 
	`°bi__îr
("bad component count","Corrupt JPEG");

3158 
s
->
img_n
 = 
c
;

3159 
i
=0; i < 
c
; ++i) {

3160 
z
->
img_comp
[
i
].
d©a
 = 
NULL
;

3161 
z
->
img_comp
[
i
].
löebuf
 = 
NULL
;

3164 i‡(
Lf
 !8+3*
s
->
img_n
Ë 
	`°bi__îr
("bad SOFÜen","Corrupt JPEG");

3166 
z
->
rgb
 = 0;

3167 
i
=0; i < 
s
->
img_n
; ++i) {

3168 c⁄° 
rgb
[3] = { 'R', 'G', 'B' };

3169 
z
->
img_comp
[
i
].
id
 = 
	`°bi__gë8
(
s
);

3170 i‡(
s
->
img_n
 =3 && 
z
->
img_comp
[
i
].
id
 =
rgb
[i])

3171 ++
z
->
rgb
;

3172 
q
 = 
	`°bi__gë8
(
s
);

3173 
z
->
img_comp
[
i
].
h
 = (
q
 >> 4); i‡(!z->img_comp[i].h || z->img_comp[i].h > 4Ë 
	`°bi__îr
("bad H","Corrupt JPEG");

3174 
z
->
img_comp
[
i
].
v
 = 
q
 & 15; i‡(!z->img_comp[i].v || z->img_comp[i].v > 4Ë 
	`°bi__îr
("bad V","Corrupt JPEG");

3175 
z
->
img_comp
[
i
].
tq
 = 
	`°bi__gë8
(
s
); i‡(z->img_comp[i].tq > 3Ë 
	`°bi__îr
("bad TQ","Corrupt JPEG");

3178 i‡(
sˇn
 !
STBI__SCAN_lﬂd
)  1;

3180 i‡(!
	`°bi__mad3sizes_vÆid
(
s
->
img_x
, s->
img_y
, s->
img_n
, 0)Ë 
	`°bi__îr
("tooÜarge", "ImageÅooÜargeÅo decode");

3182 
i
=0; i < 
s
->
img_n
; ++i) {

3183 i‡(
z
->
img_comp
[
i
].
h
 > 
h_max
) h_max = z->img_comp[i].h;

3184 i‡(
z
->
img_comp
[
i
].
v
 > 
v_max
) v_max = z->img_comp[i].v;

3188 
z
->
img_h_max
 = 
h_max
;

3189 
z
->
img_v_max
 = 
v_max
;

3190 
z
->
img_mcu_w
 = 
h_max
 * 8;

3191 
z
->
img_mcu_h
 = 
v_max
 * 8;

3193 
z
->
img_mcu_x
 = (
s
->
img_x
 + z->
img_mcu_w
-1) / z->img_mcu_w;

3194 
z
->
img_mcu_y
 = (
s
->
img_y
 + z->
img_mcu_h
-1) / z->img_mcu_h;

3196 
i
=0; i < 
s
->
img_n
; ++i) {

3198 
z
->
img_comp
[
i
].
x
 = (
s
->
img_x
 * z->img_comp[i].
h
 + 
h_max
-1) / h_max;

3199 
z
->
img_comp
[
i
].
y
 = (
s
->
img_y
 * z->img_comp[i].
v
 + 
v_max
-1) / v_max;

3207 
z
->
img_comp
[
i
].
w2
 = z->
img_mcu_x
 * z->img_comp[i].
h
 * 8;

3208 
z
->
img_comp
[
i
].
h2
 = z->
img_mcu_y
 * z->img_comp[i].
v
 * 8;

3209 
z
->
img_comp
[
i
].
c€ff
 = 0;

3210 
z
->
img_comp
[
i
].
øw_c€ff
 = 0;

3211 
z
->
img_comp
[
i
].
löebuf
 = 
NULL
;

3212 
z
->
img_comp
[
i
].
øw_d©a
 = 
	`°bi__mÆloc_mad2
(z->img_comp[i].
w2
, z->img_comp[i].
h2
, 15);

3213 i‡(
z
->
img_comp
[
i
].
øw_d©a
 =
NULL
)

3214  
	`°bi__‰ì_j≥g_comp⁄íts
(
z
, 
i
+1, 
	`°bi__îr
("outofmem", "Out of memory"));

3216 
z
->
img_comp
[
i
].
d©a
 = (
°bi_uc
*Ë(((
size_t
Ëz->img_comp[i].
øw_d©a
 + 15) & ~15);

3217 i‡(
z
->
¥ogªssive
) {

3219 
z
->
img_comp
[
i
].
c€ff_w
 = z->img_comp[i].
w2
 / 8;

3220 
z
->
img_comp
[
i
].
c€ff_h
 = z->img_comp[i].
h2
 / 8;

3221 
z
->
img_comp
[
i
].
øw_c€ff
 = 
	`°bi__mÆloc_mad3
(z->img_comp[i].
w2
, z->img_comp[i].
h2
, (), 15);

3222 i‡(
z
->
img_comp
[
i
].
øw_c€ff
 =
NULL
)

3223  
	`°bi__‰ì_j≥g_comp⁄íts
(
z
, 
i
+1, 
	`°bi__îr
("outofmem", "Out of memory"));

3224 
z
->
img_comp
[
i
].
c€ff
 = (*Ë(((
size_t
Ëz->img_comp[i].
øw_c€ff
 + 15) & ~15);

3229 
	}
}

3232 
	#°bi__DNL
(
x
Ë((xË=0xdc)

	)

3233 
	#°bi__SOI
(
x
Ë((xË=0xd8)

	)

3234 
	#°bi__EOI
(
x
Ë((xË=0xd9)

	)

3235 
	#°bi__SOF
(
x
Ë((xË=0xc0 || (xË=0xc1 || (xË=0xc2)

	)

3236 
	#°bi__SOS
(
x
Ë((xË=0xda)

	)

3238 
	#°bi__SOF_¥ogªssive
(
x
Ë((xË=0xc2)

	)

3240 
	$°bi__decode_j≥g_hódî
(
°bi__j≥g
 *
z
, 
sˇn
)

3242 
m
;

3243 
z
->
jfif
 = 0;

3244 
z
->
≠p14_cﬁ‹_å™sf‹m
 = -1;

3245 
z
->
m¨kî
 = 
STBI__MARKER_n⁄e
;

3246 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3247 i‡(!
	`°bi__SOI
(
m
)Ë 
	`°bi__îr
("no SOI","Corrupt JPEG");

3248 i‡(
sˇn
 =
STBI__SCAN_ty≥
)  1;

3249 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3250 !
	`°bi__SOF
(
m
)) {

3251 i‡(!
	`°bi__¥o˚ss_m¨kî
(
z
,
m
))  0;

3252 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3253 
m
 =
STBI__MARKER_n⁄e
) {

3255 i‡(
	`°bi__©_eof
(
z
->
s
)Ë 
	`°bi__îr
("no SOF", "Corrupt JPEG");

3256 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3259 
z
->
¥ogªssive
 = 
	`°bi__SOF_¥ogªssive
(
m
);

3260 i‡(!
	`°bi__¥o˚ss_‰ame_hódî
(
z
, 
sˇn
))  0;

3262 
	}
}

3265 
	$°bi__decode_j≥g_image
(
°bi__j≥g
 *
j
)

3267 
m
;

3268 
m
 = 0; m < 4; m++) {

3269 
j
->
img_comp
[
m
].
øw_d©a
 = 
NULL
;

3270 
j
->
img_comp
[
m
].
øw_c€ff
 = 
NULL
;

3272 
j
->
ª°¨t_öãrvÆ
 = 0;

3273 i‡(!
	`°bi__decode_j≥g_hódî
(
j
, 
STBI__SCAN_lﬂd
))  0;

3274 
m
 = 
	`°bi__gë_m¨kî
(
j
);

3275 !
	`°bi__EOI
(
m
)) {

3276 i‡(
	`°bi__SOS
(
m
)) {

3277 i‡(!
	`°bi__¥o˚ss_sˇn_hódî
(
j
))  0;

3278 i‡(!
	`°bi__∑r£_íå›y_coded_d©a
(
j
))  0;

3279 i‡(
j
->
m¨kî
 =
STBI__MARKER_n⁄e
 ) {

3281 !
	`°bi__©_eof
(
j
->
s
)) {

3282 
x
 = 
	`°bi__gë8
(
j
->
s
);

3283 i‡(
x
 == 255) {

3284 
j
->
m¨kî
 = 
	`°bi__gë8
(j->
s
);

3290 } i‡(
	`°bi__DNL
(
m
)) {

3291 
Ld
 = 
	`°bi__gë16be
(
j
->
s
);

3292 
°bi__uöt32
 
NL
 = 
	`°bi__gë16be
(
j
->
s
);

3293 i‡(
Ld
 !4Ë 
	`°bi__îr
("bad DNLÜen", "Corrupt JPEG");

3294 i‡(
NL
 !
j
->
s
->
img_y
Ë 
	`°bi__îr
("bad DNL height", "Corrupt JPEG");

3296 i‡(!
	`°bi__¥o˚ss_m¨kî
(
j
, 
m
))  0;

3298 
m
 = 
	`°bi__gë_m¨kî
(
j
);

3300 i‡(
j
->
¥ogªssive
)

3301 
	`°bi__j≥g_föish
(
j
);

3303 
	}
}

3307 
	g°bi_uc
 *(*
	tªßm∂e_row_func
)(
	t°bi_uc
 *
	tout
, stbi_u¯*
	tö0
, stbi_u¯*
	tö1
,

3308 
	tw
, 
	ths
);

3310 
	#°bi__div4
(
x
Ë((
°bi_uc
Ë((xË>> 2))

	)

3312 
°bi_uc
 *
	$ªßm∂e_row_1
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3314 
	`STBI_NOTUSED
(
out
);

3315 
	`STBI_NOTUSED
(
ö_Ár
);

3316 
	`STBI_NOTUSED
(
w
);

3317 
	`STBI_NOTUSED
(
hs
);

3318  
ö_√¨
;

3319 
	}
}

3321 
°bi_uc
* 
	$°bi__ªßm∂e_row_v_2
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3324 
i
;

3325 
	`STBI_NOTUSED
(
hs
);

3326 
i
=0; i < 
w
; ++i)

3327 
out
[
i
] = 
	`°bi__div4
(3*
ö_√¨
[i] + 
ö_Ár
[i] + 2);

3328  
out
;

3329 
	}
}

3331 
°bi_uc
* 
	$°bi__ªßm∂e_row_h_2
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3334 
i
;

3335 
°bi_uc
 *
öput
 = 
ö_√¨
;

3337 i‡(
w
 == 1) {

3339 
out
[0] = out[1] = 
öput
[0];

3340  
out
;

3343 
out
[0] = 
öput
[0];

3344 
out
[1] = 
	`°bi__div4
(
öput
[0]*3 + input[1] + 2);

3345 
i
=1; i < 
w
-1; ++i) {

3346 
n
 = 3*
öput
[
i
]+2;

3347 
out
[
i
*2+0] = 
	`°bi__div4
(
n
+
öput
[i-1]);

3348 
out
[
i
*2+1] = 
	`°bi__div4
(
n
+
öput
[i+1]);

3350 
out
[
i
*2+0] = 
	`°bi__div4
(
öput
[
w
-2]*3 + input[w-1] + 2);

3351 
out
[
i
*2+1] = 
öput
[
w
-1];

3353 
	`STBI_NOTUSED
(
ö_Ár
);

3354 
	`STBI_NOTUSED
(
hs
);

3356  
out
;

3357 
	}
}

3359 
	#°bi__div16
(
x
Ë((
°bi_uc
Ë((xË>> 4))

	)

3361 
°bi_uc
 *
	$°bi__ªßm∂e_row_hv_2
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3364 
i
,
t0
,
t1
;

3365 i‡(
w
 == 1) {

3366 
out
[0] = out[1] = 
	`°bi__div4
(3*
ö_√¨
[0] + 
ö_Ár
[0] + 2);

3367  
out
;

3370 
t1
 = 3*
ö_√¨
[0] + 
ö_Ár
[0];

3371 
out
[0] = 
	`°bi__div4
(
t1
+2);

3372 
i
=1; i < 
w
; ++i) {

3373 
t0
 = 
t1
;

3374 
t1
 = 3*
ö_√¨
[
i
]+
ö_Ár
[i];

3375 
out
[
i
*2-1] = 
	`°bi__div16
(3*
t0
 + 
t1
 + 8);

3376 
out
[
i
*2 ] = 
	`°bi__div16
(3*
t1
 + 
t0
 + 8);

3378 
out
[
w
*2-1] = 
	`°bi__div4
(
t1
+2);

3380 
	`STBI_NOTUSED
(
hs
);

3382  
out
;

3383 
	}
}

3385 #i‡
deföed
(
STBI_SSE2
Ë|| deföed(
STBI_NEON
)

3386 
°bi_uc
 *
	$°bi__ªßm∂e_row_hv_2_simd
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3389 
i
=0,
t0
,
t1
;

3391 i‡(
w
 == 1) {

3392 
out
[0] = out[1] = 
	`°bi__div4
(3*
ö_√¨
[0] + 
ö_Ár
[0] + 2);

3393  
out
;

3396 
t1
 = 3*
ö_√¨
[0] + 
ö_Ár
[0];

3400 ; 
i
 < ((
w
-1) & ~7); i += 8) {

3401 #i‡
	`deföed
(
STBI_SSE2
)

3404 
__m128i
 
zîo
 = 
	`_mm_£tzîo_si128
();

3405 
__m128i
 
Árb
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
ö_Ár
 + 
i
));

3406 
__m128i
 
√¨b
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
ö_√¨
 + 
i
));

3407 
__m128i
 
Árw
 = 
	`_mm_u≈acklo_ïi8
(
Árb
, 
zîo
);

3408 
__m128i
 
√¨w
 = 
	`_mm_u≈acklo_ïi8
(
√¨b
, 
zîo
);

3409 
__m128i
 
diff
 = 
	`_mm_sub_ïi16
(
Árw
, 
√¨w
);

3410 
__m128i
 
√¨s
 = 
	`_mm_¶li_ïi16
(
√¨w
, 2);

3411 
__m128i
 
cuº
 = 
	`_mm_add_ïi16
(
√¨s
, 
diff
);

3418 
__m128i
 
¥v0
 = 
	`_mm_¶li_si128
(
cuº
, 2);

3419 
__m128i
 
nxt0
 = 
	`_mm_§li_si128
(
cuº
, 2);

3420 
__m128i
 
¥ev
 = 
	`_mm_ö£π_ïi16
(
¥v0
, 
t1
, 0);

3421 
__m128i
 
√xt
 = 
	`_mm_ö£π_ïi16
(
nxt0
, 3*
ö_√¨
[
i
+8] + 
ö_Ár
[i+8], 7);

3427 
__m128i
 
büs
 = 
	`_mm_£t1_ïi16
(8);

3428 
__m128i
 
curs
 = 
	`_mm_¶li_ïi16
(
cuº
, 2);

3429 
__m128i
 
¥vd
 = 
	`_mm_sub_ïi16
(
¥ev
, 
cuº
);

3430 
__m128i
 
nxtd
 = 
	`_mm_sub_ïi16
(
√xt
, 
cuº
);

3431 
__m128i
 
curb
 = 
	`_mm_add_ïi16
(
curs
, 
büs
);

3432 
__m128i
 
eví
 = 
	`_mm_add_ïi16
(
¥vd
, 
curb
);

3433 
__m128i
 
odd
 = 
	`_mm_add_ïi16
(
nxtd
, 
curb
);

3436 
__m128i
 
öt0
 = 
	`_mm_u≈acklo_ïi16
(
eví
, 
odd
);

3437 
__m128i
 
öt1
 = 
	`_mm_u≈ackhi_ïi16
(
eví
, 
odd
);

3438 
__m128i
 
de0
 = 
	`_mm_§li_ïi16
(
öt0
, 4);

3439 
__m128i
 
de1
 = 
	`_mm_§li_ïi16
(
öt1
, 4);

3442 
__m128i
 
outv
 = 
	`_mm_∑ckus_ïi16
(
de0
, 
de1
);

3443 
	`_mm_°‹eu_si128
((
__m128i
 *Ë(
out
 + 
i
*2), 
outv
);

3444 #ñi‡
	`deföed
(
STBI_NEON
)

3447 
uöt8x8_t
 
Árb
 = 
	`vld1_u8
(
ö_Ár
 + 
i
);

3448 
uöt8x8_t
 
√¨b
 = 
	`vld1_u8
(
ö_√¨
 + 
i
);

3449 
öt16x8_t
 
diff
 = 
	`vªöãΩªtq_s16_u16
(
	`vsubl_u8
(
Árb
, 
√¨b
));

3450 
öt16x8_t
 
√¨s
 = 
	`vªöãΩªtq_s16_u16
(
	`vshŒ_n_u8
(
√¨b
, 2));

3451 
öt16x8_t
 
cuº
 = 
	`vaddq_s16
(
√¨s
, 
diff
);

3458 
öt16x8_t
 
¥v0
 = 
	`vextq_s16
(
cuº
, curr, 7);

3459 
öt16x8_t
 
nxt0
 = 
	`vextq_s16
(
cuº
, curr, 1);

3460 
öt16x8_t
 
¥ev
 = 
	`v£tq_œ√_s16
(
t1
, 
¥v0
, 0);

3461 
öt16x8_t
 
√xt
 = 
	`v£tq_œ√_s16
(3*
ö_√¨
[
i
+8] + 
ö_Ár
[i+8], 
nxt0
, 7);

3467 
öt16x8_t
 
curs
 = 
	`vshlq_n_s16
(
cuº
, 2);

3468 
öt16x8_t
 
¥vd
 = 
	`vsubq_s16
(
¥ev
, 
cuº
);

3469 
öt16x8_t
 
nxtd
 = 
	`vsubq_s16
(
√xt
, 
cuº
);

3470 
öt16x8_t
 
eví
 = 
	`vaddq_s16
(
curs
, 
¥vd
);

3471 
öt16x8_t
 
odd
 = 
	`vaddq_s16
(
curs
, 
nxtd
);

3474 
uöt8x8x2_t
 
o
;

3475 
o
.
vÆ
[0] = 
	`vqrshrun_n_s16
(
eví
, 4);

3476 
o
.
vÆ
[1] = 
	`vqrshrun_n_s16
(
odd
, 4);

3477 
	`v°2_u8
(
out
 + 
i
*2, 
o
);

3481 
t1
 = 3*
ö_√¨
[
i
+7] + 
ö_Ár
[i+7];

3484 
t0
 = 
t1
;

3485 
t1
 = 3*
ö_√¨
[
i
] + 
ö_Ár
[i];

3486 
out
[
i
*2] = 
	`°bi__div16
(3*
t1
 + 
t0
 + 8);

3488 ++
i
; i < 
w
; ++i) {

3489 
t0
 = 
t1
;

3490 
t1
 = 3*
ö_√¨
[
i
]+
ö_Ár
[i];

3491 
out
[
i
*2-1] = 
	`°bi__div16
(3*
t0
 + 
t1
 + 8);

3492 
out
[
i
*2 ] = 
	`°bi__div16
(3*
t1
 + 
t0
 + 8);

3494 
out
[
w
*2-1] = 
	`°bi__div4
(
t1
+2);

3496 
	`STBI_NOTUSED
(
hs
);

3498  
out
;

3499 
	}
}

3502 
°bi_uc
 *
	$°bi__ªßm∂e_row_gíîic
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3505 
i
,
j
;

3506 
	`STBI_NOTUSED
(
ö_Ár
);

3507 
i
=0; i < 
w
; ++i)

3508 
j
=0; j < 
hs
; ++j)

3509 
out
[
i
*
hs
+
j
] = 
ö_√¨
[i];

3510  
out
;

3511 
	}
}

3515 
	#°bi__Êﬂt2fixed
(
x
Ë(((Ë((xË* 4096.0‡+ 0.5f)Ë<< 8)

	)

3516 
	$°bi__YCbCr_to_RGB_row
(
°bi_uc
 *
out
, c⁄° stbi_u¯*
y
, c⁄° stbi_u¯*
pcb
, c⁄° stbi_u¯*
p¸
, 
cou¡
, 
°ï
)

3518 
i
;

3519 
i
=0; i < 
cou¡
; ++i) {

3520 
y_fixed
 = (
y
[
i
] << 20) + (1<<19);

3521 
r
,
g
,
b
;

3522 
¸
 = 
p¸
[
i
] - 128;

3523 
cb
 = 
pcb
[
i
] - 128;

3524 
r
 = 
y_fixed
 + 
¸
* 
	`°bi__Êﬂt2fixed
(1.40200f);

3525 
g
 = 
y_fixed
 + (
¸
*-
	`°bi__Êﬂt2fixed
(0.71414f)Ë+ ((
cb
*-stbi__float2fixed(0.34414f)) & 0xffff0000);

3526 
b
 = 
y_fixed
 + 
cb
* 
	`°bi__Êﬂt2fixed
(1.77200f);

3527 
r
 >>= 20;

3528 
g
 >>= 20;

3529 
b
 >>= 20;

3530 i‡((Ë
r
 > 255) { if (r < 0)Ñ = 0; r = 255; }

3531 i‡((Ë
g
 > 255) { if (g < 0) g = 0; g = 255; }

3532 i‡((Ë
b
 > 255) { if (b < 0) b = 0; b = 255; }

3533 
out
[0] = (
°bi_uc
)
r
;

3534 
out
[1] = (
°bi_uc
)
g
;

3535 
out
[2] = (
°bi_uc
)
b
;

3536 
out
[3] = 255;

3537 
out
 +
°ï
;

3539 
	}
}

3541 #i‡
deföed
(
STBI_SSE2
Ë|| deföed(
STBI_NEON
)

3542 
	$°bi__YCbCr_to_RGB_simd
(
°bi_uc
 *
out
, stbi_u¯c⁄° *
y
, stbi_u¯c⁄° *
pcb
, stbi_u¯c⁄° *
p¸
, 
cou¡
, 
°ï
)

3544 
i
 = 0;

3546 #ifde‡
STBI_SSE2


3550 i‡(
°ï
 == 4) {

3552 
__m128i
 
signÊù
 = 
	`_mm_£t1_ïi8
(-0x80);

3553 
__m128i
 
¸_c⁄°0
 = 
	`_mm_£t1_ïi16
( () ( 1.40200f*4096.0f+0.5f));

3554 
__m128i
 
¸_c⁄°1
 = 
	`_mm_£t1_ïi16
( - () ( 0.71414f*4096.0f+0.5f));

3555 
__m128i
 
cb_c⁄°0
 = 
	`_mm_£t1_ïi16
( - () ( 0.34414f*4096.0f+0.5f));

3556 
__m128i
 
cb_c⁄°1
 = 
	`_mm_£t1_ïi16
( () ( 1.77200f*4096.0f+0.5f));

3557 
__m128i
 
y_büs
 = 
	`_mm_£t1_ïi8
(() () 128);

3558 
__m128i
 
xw
 = 
	`_mm_£t1_ïi16
(255);

3560 ; 
i
+7 < 
cou¡
; i += 8) {

3562 
__m128i
 
y_byãs
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
y
+
i
));

3563 
__m128i
 
¸_byãs
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
p¸
+
i
));

3564 
__m128i
 
cb_byãs
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
pcb
+
i
));

3565 
__m128i
 
¸_bü£d
 = 
	`_mm_x‹_si128
(
¸_byãs
, 
signÊù
);

3566 
__m128i
 
cb_bü£d
 = 
	`_mm_x‹_si128
(
cb_byãs
, 
signÊù
);

3569 
__m128i
 
yw
 = 
	`_mm_u≈acklo_ïi8
(
y_büs
, 
y_byãs
);

3570 
__m128i
 
¸w
 = 
	`_mm_u≈acklo_ïi8
(
	`_mm_£tzîo_si128
(), 
¸_bü£d
);

3571 
__m128i
 
cbw
 = 
	`_mm_u≈acklo_ïi8
(
	`_mm_£tzîo_si128
(), 
cb_bü£d
);

3574 
__m128i
 
yws
 = 
	`_mm_§li_ïi16
(
yw
, 4);

3575 
__m128i
 
¸0
 = 
	`_mm_mulhi_ïi16
(
¸_c⁄°0
, 
¸w
);

3576 
__m128i
 
cb0
 = 
	`_mm_mulhi_ïi16
(
cb_c⁄°0
, 
cbw
);

3577 
__m128i
 
cb1
 = 
	`_mm_mulhi_ïi16
(
cbw
, 
cb_c⁄°1
);

3578 
__m128i
 
¸1
 = 
	`_mm_mulhi_ïi16
(
¸w
, 
¸_c⁄°1
);

3579 
__m128i
 
rws
 = 
	`_mm_add_ïi16
(
¸0
, 
yws
);

3580 
__m128i
 
gwt
 = 
	`_mm_add_ïi16
(
cb0
, 
yws
);

3581 
__m128i
 
bws
 = 
	`_mm_add_ïi16
(
yws
, 
cb1
);

3582 
__m128i
 
gws
 = 
	`_mm_add_ïi16
(
gwt
, 
¸1
);

3585 
__m128i
 
rw
 = 
	`_mm_§ai_ïi16
(
rws
, 4);

3586 
__m128i
 
bw
 = 
	`_mm_§ai_ïi16
(
bws
, 4);

3587 
__m128i
 
gw
 = 
	`_mm_§ai_ïi16
(
gws
, 4);

3590 
__m128i
 
brb
 = 
	`_mm_∑ckus_ïi16
(
rw
, 
bw
);

3591 
__m128i
 
gxb
 = 
	`_mm_∑ckus_ïi16
(
gw
, 
xw
);

3594 
__m128i
 
t0
 = 
	`_mm_u≈acklo_ïi8
(
brb
, 
gxb
);

3595 
__m128i
 
t1
 = 
	`_mm_u≈ackhi_ïi8
(
brb
, 
gxb
);

3596 
__m128i
 
o0
 = 
	`_mm_u≈acklo_ïi16
(
t0
, 
t1
);

3597 
__m128i
 
o1
 = 
	`_mm_u≈ackhi_ïi16
(
t0
, 
t1
);

3600 
	`_mm_°‹eu_si128
((
__m128i
 *Ë(
out
 + 0), 
o0
);

3601 
	`_mm_°‹eu_si128
((
__m128i
 *Ë(
out
 + 16), 
o1
);

3602 
out
 += 32;

3607 #ifde‡
STBI_NEON


3609 i‡(
°ï
 == 4) {

3611 
uöt8x8_t
 
signÊù
 = 
	`vdup_n_u8
(0x80);

3612 
öt16x8_t
 
¸_c⁄°0
 = 
	`vdupq_n_s16
( () ( 1.40200f*4096.0f+0.5f));

3613 
öt16x8_t
 
¸_c⁄°1
 = 
	`vdupq_n_s16
( - () ( 0.71414f*4096.0f+0.5f));

3614 
öt16x8_t
 
cb_c⁄°0
 = 
	`vdupq_n_s16
( - () ( 0.34414f*4096.0f+0.5f));

3615 
öt16x8_t
 
cb_c⁄°1
 = 
	`vdupq_n_s16
( () ( 1.77200f*4096.0f+0.5f));

3617 ; 
i
+7 < 
cou¡
; i += 8) {

3619 
uöt8x8_t
 
y_byãs
 = 
	`vld1_u8
(
y
 + 
i
);

3620 
uöt8x8_t
 
¸_byãs
 = 
	`vld1_u8
(
p¸
 + 
i
);

3621 
uöt8x8_t
 
cb_byãs
 = 
	`vld1_u8
(
pcb
 + 
i
);

3622 
öt8x8_t
 
¸_bü£d
 = 
	`vªöãΩªt_s8_u8
(
	`vsub_u8
(
¸_byãs
, 
signÊù
));

3623 
öt8x8_t
 
cb_bü£d
 = 
	`vªöãΩªt_s8_u8
(
	`vsub_u8
(
cb_byãs
, 
signÊù
));

3626 
öt16x8_t
 
yws
 = 
	`vªöãΩªtq_s16_u16
(
	`vshŒ_n_u8
(
y_byãs
, 4));

3627 
öt16x8_t
 
¸w
 = 
	`vshŒ_n_s8
(
¸_bü£d
, 7);

3628 
öt16x8_t
 
cbw
 = 
	`vshŒ_n_s8
(
cb_bü£d
, 7);

3631 
öt16x8_t
 
¸0
 = 
	`vqdmulhq_s16
(
¸w
, 
¸_c⁄°0
);

3632 
öt16x8_t
 
cb0
 = 
	`vqdmulhq_s16
(
cbw
, 
cb_c⁄°0
);

3633 
öt16x8_t
 
¸1
 = 
	`vqdmulhq_s16
(
¸w
, 
¸_c⁄°1
);

3634 
öt16x8_t
 
cb1
 = 
	`vqdmulhq_s16
(
cbw
, 
cb_c⁄°1
);

3635 
öt16x8_t
 
rws
 = 
	`vaddq_s16
(
yws
, 
¸0
);

3636 
öt16x8_t
 
gws
 = 
	`vaddq_s16
(vaddq_s16(
yws
, 
cb0
), 
¸1
);

3637 
öt16x8_t
 
bws
 = 
	`vaddq_s16
(
yws
, 
cb1
);

3640 
uöt8x8x4_t
 
o
;

3641 
o
.
vÆ
[0] = 
	`vqrshrun_n_s16
(
rws
, 4);

3642 
o
.
vÆ
[1] = 
	`vqrshrun_n_s16
(
gws
, 4);

3643 
o
.
vÆ
[2] = 
	`vqrshrun_n_s16
(
bws
, 4);

3644 
o
.
vÆ
[3] = 
	`vdup_n_u8
(255);

3647 
	`v°4_u8
(
out
, 
o
);

3648 
out
 += 8*4;

3653 ; 
i
 < 
cou¡
; ++i) {

3654 
y_fixed
 = (
y
[
i
] << 20) + (1<<19);

3655 
r
,
g
,
b
;

3656 
¸
 = 
p¸
[
i
] - 128;

3657 
cb
 = 
pcb
[
i
] - 128;

3658 
r
 = 
y_fixed
 + 
¸
* 
	`°bi__Êﬂt2fixed
(1.40200f);

3659 
g
 = 
y_fixed
 + 
¸
*-
	`°bi__Êﬂt2fixed
(0.71414fË+ ((
cb
*-stbi__float2fixed(0.34414f)) & 0xffff0000);

3660 
b
 = 
y_fixed
 + 
cb
* 
	`°bi__Êﬂt2fixed
(1.77200f);

3661 
r
 >>= 20;

3662 
g
 >>= 20;

3663 
b
 >>= 20;

3664 i‡((Ë
r
 > 255) { if (r < 0)Ñ = 0; r = 255; }

3665 i‡((Ë
g
 > 255) { if (g < 0) g = 0; g = 255; }

3666 i‡((Ë
b
 > 255) { if (b < 0) b = 0; b = 255; }

3667 
out
[0] = (
°bi_uc
)
r
;

3668 
out
[1] = (
°bi_uc
)
g
;

3669 
out
[2] = (
°bi_uc
)
b
;

3670 
out
[3] = 255;

3671 
out
 +
°ï
;

3673 
	}
}

3677 
	$°bi__£tup_j≥g
(
°bi__j≥g
 *
j
)

3679 
j
->
id˘_block_kî√l
 = 
°bi__id˘_block
;

3680 
j
->
YCbCr_to_RGB_kî√l
 = 
°bi__YCbCr_to_RGB_row
;

3681 
j
->
ªßm∂e_row_hv_2_kî√l
 = 
°bi__ªßm∂e_row_hv_2
;

3683 #ifde‡
STBI_SSE2


3684 i‡(
	`°bi__s£2_avaûabÀ
()) {

3685 
j
->
id˘_block_kî√l
 = 
°bi__id˘_simd
;

3686 
j
->
YCbCr_to_RGB_kî√l
 = 
°bi__YCbCr_to_RGB_simd
;

3687 
j
->
ªßm∂e_row_hv_2_kî√l
 = 
°bi__ªßm∂e_row_hv_2_simd
;

3691 #ifde‡
STBI_NEON


3692 
j
->
id˘_block_kî√l
 = 
°bi__id˘_simd
;

3693 
j
->
YCbCr_to_RGB_kî√l
 = 
°bi__YCbCr_to_RGB_simd
;

3694 
j
->
ªßm∂e_row_hv_2_kî√l
 = 
°bi__ªßm∂e_row_hv_2_simd
;

3696 
	}
}

3699 
	$°bi__˛ónup_j≥g
(
°bi__j≥g
 *
j
)

3701 
	`°bi__‰ì_j≥g_comp⁄íts
(
j
, j->
s
->
img_n
, 0);

3702 
	}
}

3706 
ªßm∂e_row_func
 
	mªßm∂e
;

3707 
°bi_uc
 *
	mlöe0
,*
	mlöe1
;

3708 
	mhs
,
	mvs
;

3709 
	mw_l‹es
;

3710 
	my°ï
;

3711 
	mypos
;

3712 } 
	t°bi__ªßm∂e
;

3715 
°bi_uc
 
	$°bi__blön_8x8
(
°bi_uc
 
x
, stbi_u¯
y
)

3717 
t
 = 
x
*
y
 + 128;

3718  (
°bi_uc
Ë((
t
 + (t >>8)) >> 8);

3719 
	}
}

3721 
°bi_uc
 *
	$lﬂd_j≥g_image
(
°bi__j≥g
 *
z
, *
out_x
, *
out_y
, *
comp
, 
ªq_comp
)

3723 
n
, 
decode_n
, 
is_rgb
;

3724 
z
->
s
->
img_n
 = 0;

3727 i‡(
ªq_comp
 < 0 ||Ñeq_com∞> 4Ë 
	`°bi__îΩuc
("badÑeq_comp", "InternalÉrror");

3730 i‡(!
	`°bi__decode_j≥g_image
(
z
)Ë{ 
	`°bi__˛ónup_j≥g
(z);  
NULL
; }

3733 
n
 = 
ªq_comp
 ?Ñeq_com∞: 
z
->
s
->
img_n
 >= 3 ? 3 : 1;

3735 
is_rgb
 = 
z
->
s
->
img_n
 =3 && (z->
rgb
 =3 || (z->
≠p14_cﬁ‹_å™sf‹m
 =0 && !z->
jfif
));

3737 i‡(
z
->
s
->
img_n
 =3 && 
n
 < 3 && !
is_rgb
)

3738 
decode_n
 = 1;

3740 
decode_n
 = 
z
->
s
->
img_n
;

3744 
k
;

3745 
i
,
j
;

3746 
°bi_uc
 *
ouçut
;

3747 
°bi_uc
 *
couçut
[4] = { 
NULL
, NULL, NULL, NULL };

3749 
°bi__ªßm∂e
 
ªs_comp
[4];

3751 
k
=0; k < 
decode_n
; ++k) {

3752 
°bi__ªßm∂e
 *
r
 = &
ªs_comp
[
k
];

3756 
z
->
img_comp
[
k
].
löebuf
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(z->
s
->
img_x
 + 3);

3757 i‡(!
z
->
img_comp
[
k
].
löebuf
Ë{ 
	`°bi__˛ónup_j≥g
(z);  
	`°bi__îΩuc
("outofmem", "Out of memory"); }

3759 
r
->
hs
 = 
z
->
img_h_max
 / z->
img_comp
[
k
].
h
;

3760 
r
->
vs
 = 
z
->
img_v_max
 / z->
img_comp
[
k
].
v
;

3761 
r
->
y°ï
 =Ñ->
vs
 >> 1;

3762 
r
->
w_l‹es
 = (
z
->
s
->
img_x
 +Ñ->
hs
-1) /Ñ->hs;

3763 
r
->
ypos
 = 0;

3764 
r
->
löe0
 =Ñ->
löe1
 = 
z
->
img_comp
[
k
].
d©a
;

3766 i‡(
r
->
hs
 =1 &&Ñ->
vs
 =1Ër->
ªßm∂e
 = 
ªßm∂e_row_1
;

3767 i‡(
r
->
hs
 =1 &&Ñ->
vs
 =2Ër->
ªßm∂e
 = 
°bi__ªßm∂e_row_v_2
;

3768 i‡(
r
->
hs
 =2 &&Ñ->
vs
 =1Ër->
ªßm∂e
 = 
°bi__ªßm∂e_row_h_2
;

3769 i‡(
r
->
hs
 =2 &&Ñ->
vs
 =2Ër->
ªßm∂e
 = 
z
->
ªßm∂e_row_hv_2_kî√l
;

3770 
r
->
ªßm∂e
 = 
°bi__ªßm∂e_row_gíîic
;

3774 
ouçut
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
n
, 
z
->
s
->
img_x
, z->s->
img_y
, 1);

3775 i‡(!
ouçut
Ë{ 
	`°bi__˛ónup_j≥g
(
z
);  
	`°bi__îΩuc
("outofmem", "Out of memory"); }

3778 
j
=0; j < 
z
->
s
->
img_y
; ++j) {

3779 
°bi_uc
 *
out
 = 
ouçut
 + 
n
 * 
z
->
s
->
img_x
 * 
j
;

3780 
k
=0; k < 
decode_n
; ++k) {

3781 
°bi__ªßm∂e
 *
r
 = &
ªs_comp
[
k
];

3782 
y_bŸ
 = 
r
->
y°ï
 >‘->
vs
 >> 1);

3783 
couçut
[
k
] = 
r
->
	`ªßm∂e
(
z
->
img_comp
[k].
löebuf
,

3784 
y_bŸ
 ? 
r
->
löe1
 :Ñ->
löe0
,

3785 
y_bŸ
 ? 
r
->
löe0
 :Ñ->
löe1
,

3786 
r
->
w_l‹es
,Ñ->
hs
);

3787 i‡(++
r
->
y°ï
 >r->
vs
) {

3788 
r
->
y°ï
 = 0;

3789 
r
->
löe0
 =Ñ->
löe1
;

3790 i‡(++
r
->
ypos
 < 
z
->
img_comp
[
k
].
y
)

3791 
r
->
löe1
 +
z
->
img_comp
[
k
].
w2
;

3794 i‡(
n
 >= 3) {

3795 
°bi_uc
 *
y
 = 
couçut
[0];

3796 i‡(
z
->
s
->
img_n
 == 3) {

3797 i‡(
is_rgb
) {

3798 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3799 
out
[0] = 
y
[
i
];

3800 
out
[1] = 
couçut
[1][
i
];

3801 
out
[2] = 
couçut
[2][
i
];

3802 
out
[3] = 255;

3803 
out
 +
n
;

3806 
z
->
	`YCbCr_to_RGB_kî√l
(
out
, 
y
, 
couçut
[1], couçut[2], z->
s
->
img_x
, 
n
);

3808 } i‡(
z
->
s
->
img_n
 == 4) {

3809 i‡(
z
->
≠p14_cﬁ‹_å™sf‹m
 == 0) {

3810 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3811 
°bi_uc
 
m
 = 
couçut
[3][
i
];

3812 
out
[0] = 
	`°bi__blön_8x8
(
couçut
[0][
i
], 
m
);

3813 
out
[1] = 
	`°bi__blön_8x8
(
couçut
[1][
i
], 
m
);

3814 
out
[2] = 
	`°bi__blön_8x8
(
couçut
[2][
i
], 
m
);

3815 
out
[3] = 255;

3816 
out
 +
n
;

3818 } i‡(
z
->
≠p14_cﬁ‹_å™sf‹m
 == 2) {

3819 
z
->
	`YCbCr_to_RGB_kî√l
(
out
, 
y
, 
couçut
[1], couçut[2], z->
s
->
img_x
, 
n
);

3820 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3821 
°bi_uc
 
m
 = 
couçut
[3][
i
];

3822 
out
[0] = 
	`°bi__blön_8x8
(255 - out[0], 
m
);

3823 
out
[1] = 
	`°bi__blön_8x8
(255 - out[1], 
m
);

3824 
out
[2] = 
	`°bi__blön_8x8
(255 - out[2], 
m
);

3825 
out
 +
n
;

3828 
z
->
	`YCbCr_to_RGB_kî√l
(
out
, 
y
, 
couçut
[1], couçut[2], z->
s
->
img_x
, 
n
);

3831 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3832 
out
[0] = out[1] = out[2] = 
y
[
i
];

3833 
out
[3] = 255;

3834 
out
 +
n
;

3837 i‡(
is_rgb
) {

3838 i‡(
n
 == 1)

3839 
i
=0; i < 
z
->
s
->
img_x
; ++i)

3840 *
out
++ = 
	`°bi__compuã_y
(
couçut
[0][
i
], coutput[1][i], coutput[2][i]);

3842 
i
=0; i < 
z
->
s
->
img_x
; ++i, 
out
 += 2) {

3843 
out
[0] = 
	`°bi__compuã_y
(
couçut
[0][
i
], coutput[1][i], coutput[2][i]);

3844 
out
[1] = 255;

3847 } i‡(
z
->
s
->
img_n
 =4 && z->
≠p14_cﬁ‹_å™sf‹m
 == 0) {

3848 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3849 
°bi_uc
 
m
 = 
couçut
[3][
i
];

3850 
°bi_uc
 
r
 = 
	`°bi__blön_8x8
(
couçut
[0][
i
], 
m
);

3851 
°bi_uc
 
g
 = 
	`°bi__blön_8x8
(
couçut
[1][
i
], 
m
);

3852 
°bi_uc
 
b
 = 
	`°bi__blön_8x8
(
couçut
[2][
i
], 
m
);

3853 
out
[0] = 
	`°bi__compuã_y
(
r
, 
g
, 
b
);

3854 
out
[1] = 255;

3855 
out
 +
n
;

3857 } i‡(
z
->
s
->
img_n
 =4 && z->
≠p14_cﬁ‹_å™sf‹m
 == 2) {

3858 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3859 
out
[0] = 
	`°bi__blön_8x8
(255 - 
couçut
[0][
i
], coutput[3][i]);

3860 
out
[1] = 255;

3861 
out
 +
n
;

3864 
°bi_uc
 *
y
 = 
couçut
[0];

3865 i‡(
n
 == 1)

3866 
i
=0; i < 
z
->
s
->
img_x
; ++iË
out
[i] = 
y
[i];

3868 
i
=0; i < 
z
->
s
->
img_x
; ++iË{ *
out
++ = 
y
[i]; *out++ = 255; }

3872 
	`°bi__˛ónup_j≥g
(
z
);

3873 *
out_x
 = 
z
->
s
->
img_x
;

3874 *
out_y
 = 
z
->
s
->
img_y
;

3875 i‡(
comp
Ë*com∞
z
->
s
->
img_n
 >= 3 ? 3 : 1;

3876  
ouçut
;

3878 
	}
}

3880 *
	$°bi__j≥g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

3882 * 
ªsu…
;

3883 
°bi__j≥g
* 
j
 = (°bi__j≥g*Ë
	`°bi__mÆloc
((stbi__jpeg));

3884 
	`STBI_NOTUSED
(
ri
);

3885 
j
->
s
 = s;

3886 
	`°bi__£tup_j≥g
(
j
);

3887 
ªsu…
 = 
	`lﬂd_j≥g_image
(
j
, 
x
,
y
,
comp
,
ªq_comp
);

3888 
	`STBI_FREE
(
j
);

3889  
ªsu…
;

3890 
	}
}

3892 
	$°bi__j≥g_ã°
(
°bi__c⁄ãxt
 *
s
)

3894 
r
;

3895 
°bi__j≥g
* 
j
 = (°bi__j≥g*)
	`°bi__mÆloc
((stbi__jpeg));

3896 
j
->
s
 = s;

3897 
	`°bi__£tup_j≥g
(
j
);

3898 
r
 = 
	`°bi__decode_j≥g_hódî
(
j
, 
STBI__SCAN_ty≥
);

3899 
	`°bi__ªwöd
(
s
);

3900 
	`STBI_FREE
(
j
);

3901  
r
;

3902 
	}
}

3904 
	$°bi__j≥g_öfo_øw
(
°bi__j≥g
 *
j
, *
x
, *
y
, *
comp
)

3906 i‡(!
	`°bi__decode_j≥g_hódî
(
j
, 
STBI__SCAN_hódî
)) {

3907 
	`°bi__ªwöd
–
j
->
s
 );

3910 i‡(
x
Ë*x = 
j
->
s
->
img_x
;

3911 i‡(
y
Ë*y = 
j
->
s
->
img_y
;

3912 i‡(
comp
Ë*com∞
j
->
s
->
img_n
 >= 3 ? 3 : 1;

3914 
	}
}

3916 
	$°bi__j≥g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

3918 
ªsu…
;

3919 
°bi__j≥g
* 
j
 = (°bi__j≥g*Ë(
	`°bi__mÆloc
((stbi__jpeg)));

3920 
j
->
s
 = s;

3921 
ªsu…
 = 
	`°bi__j≥g_öfo_øw
(
j
, 
x
, 
y
, 
comp
);

3922 
	`STBI_FREE
(
j
);

3923  
ªsu…
;

3924 
	}
}

3934 #i‚de‡
STBI_NO_ZLIB


3937 
	#STBI__ZFAST_BITS
 9

3938 
	#STBI__ZFAST_MASK
 ((1 << 
STBI__ZFAST_BITS
Ë- 1)

	)

3944 
°bi__uöt16
 
	mÁ°
[1 << 
STBI__ZFAST_BITS
];

3945 
°bi__uöt16
 
	mfú°code
[16];

3946 
	mmaxcode
[17];

3947 
°bi__uöt16
 
	mfú°symbﬁ
[16];

3948 
°bi_uc
 
	msize
[288];

3949 
°bi__uöt16
 
	mvÆue
[288];

3950 } 
	t°bi__zhuffm™
;

3952 
°bi_ölöe
 
	$°bi__bôªvî£16
(
n
)

3954 
n
 = ((n & 0xAAAA) >> 1) | ((n & 0x5555) << 1);

3955 
n
 = ((n & 0xCCCC) >> 2) | ((n & 0x3333) << 2);

3956 
n
 = ((n & 0xF0F0) >> 4) | ((n & 0x0F0F) << 4);

3957 
n
 = ((n & 0xFF00) >> 8) | ((n & 0x00FF) << 8);

3958  
n
;

3959 
	}
}

3961 
°bi_ölöe
 
	$°bi__bô_ªvî£
(
v
, 
bôs
)

3963 
	`STBI_ASSERT
(
bôs
 <= 16);

3966  
	`°bi__bôªvî£16
(
v
Ë>> (16-
bôs
);

3967 
	}
}

3969 
	$°bi__zbuûd_huffm™
(
°bi__zhuffm™
 *
z
, c⁄° 
°bi_uc
 *
sizñi°
, 
num
)

3971 
i
,
k
=0;

3972 
code
, 
√xt_code
[16], 
sizes
[17];

3975 
	`mem£t
(
sizes
, 0, (sizes));

3976 
	`mem£t
(
z
->
Á°
, 0, (z->fast));

3977 
i
=0; i < 
num
; ++i)

3978 ++
sizes
[
sizñi°
[
i
]];

3979 
sizes
[0] = 0;

3980 
i
=1; i < 16; ++i)

3981 i‡(
sizes
[
i
] > (1 << i))

3982  
	`°bi__îr
("bad sizes", "Corrupt PNG");

3983 
code
 = 0;

3984 
i
=1; i < 16; ++i) {

3985 
√xt_code
[
i
] = 
code
;

3986 
z
->
fú°code
[
i
] = (
°bi__uöt16
Ë
code
;

3987 
z
->
fú°symbﬁ
[
i
] = (
°bi__uöt16
Ë
k
;

3988 
code
 = (codê+ 
sizes
[
i
]);

3989 i‡(
sizes
[
i
])

3990 i‡(
code
-1 >(1 << 
i
)Ë 
	`°bi__îr
("bad codelengths","Corrupt PNG");

3991 
z
->
maxcode
[
i
] = 
code
 << (16-i);

3992 
code
 <<= 1;

3993 
k
 +
sizes
[
i
];

3995 
z
->
maxcode
[16] = 0x10000;

3996 
i
=0; i < 
num
; ++i) {

3997 
s
 = 
sizñi°
[
i
];

3998 i‡(
s
) {

3999 
c
 = 
√xt_code
[
s
] - 
z
->
fú°code
[s] + z->
fú°symbﬁ
[s];

4000 
°bi__uöt16
 
Á°v
 = (°bi__uöt16Ë((
s
 << 9Ë| 
i
);

4001 
z
->
size
 [
c
] = (
°bi_uc
 ) 
s
;

4002 
z
->
vÆue
[
c
] = (
°bi__uöt16
Ë
i
;

4003 i‡(
s
 <
STBI__ZFAST_BITS
) {

4004 
j
 = 
	`°bi__bô_ªvî£
(
√xt_code
[
s
],s);

4005 
j
 < (1 << 
STBI__ZFAST_BITS
)) {

4006 
z
->
Á°
[
j
] = 
Á°v
;

4007 
j
 +(1 << 
s
);

4010 ++
√xt_code
[
s
];

4014 
	}
}

4024 
°bi_uc
 *
	mzbuf„r
, *
	mzbuf„r_íd
;

4025 
	mnum_bôs
;

4026 
°bi__uöt32
 
	mcode_buf„r
;

4028 *
	mzout
;

4029 *
	mzout_°¨t
;

4030 *
	mzout_íd
;

4031 
	mz_ex∑ndabÀ
;

4033 
°bi__zhuffm™
 
	mz_Àngth
, 
	mz_di°™˚
;

4034 } 
	t°bi__zbuf
;

4036 
°bi_ölöe
 
°bi_uc
 
	$°bi__zgë8
(
°bi__zbuf
 *
z
)

4038 i‡(
z
->
zbuf„r
 >z->
zbuf„r_íd
)  0;

4039  *
z
->
zbuf„r
++;

4040 
	}
}

4042 
	$°bi__fûl_bôs
(
°bi__zbuf
 *
z
)

4045 
	`STBI_ASSERT
(
z
->
code_buf„r
 < (1U << z->
num_bôs
));

4046 
z
->
code_buf„r
 |(Ë
	`°bi__zgë8
(zË<< z->
num_bôs
;

4047 
z
->
num_bôs
 += 8;

4048 } 
z
->
num_bôs
 <= 24);

4049 
	}
}

4051 
°bi_ölöe
 
	$°bi__zª˚ive
(
°bi__zbuf
 *
z
, 
n
)

4053 
k
;

4054 i‡(
z
->
num_bôs
 < 
n
Ë
	`°bi__fûl_bôs
(z);

4055 
k
 = 
z
->
code_buf„r
 & ((1 << 
n
) - 1);

4056 
z
->
code_buf„r
 >>
n
;

4057 
z
->
num_bôs
 -
n
;

4058  
k
;

4059 
	}
}

4061 
	$°bi__zhuffm™_decode_¶ow∑th
(
°bi__zbuf
 *
a
, 
°bi__zhuffm™
 *
z
)

4063 
b
,
s
,
k
;

4066 
k
 = 
	`°bi__bô_ªvî£
(
a
->
code_buf„r
, 16);

4067 
s
=
STBI__ZFAST_BITS
+1; ; ++s)

4068 i‡(
k
 < 
z
->
maxcode
[
s
])

4070 i‡(
s
 == 16)  -1;

4072 
b
 = (
k
 >> (16-
s
)Ë- 
z
->
fú°code
[s] + z->
fú°symbﬁ
[s];

4073 
	`STBI_ASSERT
(
z
->
size
[
b
] =
s
);

4074 
a
->
code_buf„r
 >>
s
;

4075 
a
->
num_bôs
 -
s
;

4076  
z
->
vÆue
[
b
];

4077 
	}
}

4079 
°bi_ölöe
 
	$°bi__zhuffm™_decode
(
°bi__zbuf
 *
a
, 
°bi__zhuffm™
 *
z
)

4081 
b
,
s
;

4082 i‡(
a
->
num_bôs
 < 16Ë
	`°bi__fûl_bôs
(a);

4083 
b
 = 
z
->
Á°
[
a
->
code_buf„r
 & 
STBI__ZFAST_MASK
];

4084 i‡(
b
) {

4085 
s
 = 
b
 >> 9;

4086 
a
->
code_buf„r
 >>
s
;

4087 
a
->
num_bôs
 -
s
;

4088  
b
 & 511;

4090  
	`°bi__zhuffm™_decode_¶ow∑th
(
a
, 
z
);

4091 
	}
}

4093 
	$°bi__zex∑nd
(
°bi__zbuf
 *
z
, *
zout
, 
n
)

4095 *
q
;

4096 
cur
, 
limô
, 
ﬁd_limô
;

4097 
z
->
zout
 = zout;

4098 i‡(!
z
->
z_ex∑ndabÀ
Ë 
	`°bi__îr
("output bufferÜimit","Corrupt PNG");

4099 
cur
 = (Ë(
z
->
zout
 - z->
zout_°¨t
);

4100 
limô
 = 
ﬁd_limô
 = (Ë(
z
->
zout_íd
 - z->
zout_°¨t
);

4101 
cur
 + 
n
 > 
limô
)

4102 
limô
 *= 2;

4103 
q
 = (*Ë
	`STBI_REALLOC_SIZED
(
z
->
zout_°¨t
, 
ﬁd_limô
, 
limô
);

4104 
	`STBI_NOTUSED
(
ﬁd_limô
);

4105 i‡(
q
 =
NULL
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4106 
z
->
zout_°¨t
 = 
q
;

4107 
z
->
zout
 = 
q
 + 
cur
;

4108 
z
->
zout_íd
 = 
q
 + 
limô
;

4110 
	}
}

4112 c⁄° 
	g°bi__zÀngth_ba£
[31] = {

4117 c⁄° 
	g°bi__zÀngth_exåa
[31]=

4120 c⁄° 
	g°bi__zdi°_ba£
[32] = { 1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,

4123 c⁄° 
	g°bi__zdi°_exåa
[32] =

4126 
	$°bi__∑r£_huffm™_block
(
°bi__zbuf
 *
a
)

4128 *
zout
 = 
a
->zout;

4130 
z
 = 
	`°bi__zhuffm™_decode
(
a
, &a->
z_Àngth
);

4131 i‡(
z
 < 256) {

4132 i‡(
z
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt PNG");

4133 i‡(
zout
 >
a
->
zout_íd
) {

4134 i‡(!
	`°bi__zex∑nd
(
a
, 
zout
, 1))  0;

4135 
zout
 = 
a
->zout;

4137 *
zout
++ = (Ë
z
;

4139 
°bi_uc
 *
p
;

4140 
Àn
,
di°
;

4141 i‡(
z
 == 256) {

4142 
a
->
zout
 = zout;

4145 
z
 -= 257;

4146 
Àn
 = 
°bi__zÀngth_ba£
[
z
];

4147 i‡(
°bi__zÀngth_exåa
[
z
]Ë
Àn
 +
	`°bi__zª˚ive
(
a
, stbi__zlength_extra[z]);

4148 
z
 = 
	`°bi__zhuffm™_decode
(
a
, &a->
z_di°™˚
);

4149 i‡(
z
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt PNG");

4150 
di°
 = 
°bi__zdi°_ba£
[
z
];

4151 i‡(
°bi__zdi°_exåa
[
z
]Ë
di°
 +
	`°bi__zª˚ive
(
a
, stbi__zdist_extra[z]);

4152 i‡(
zout
 - 
a
->
zout_°¨t
 < 
di°
Ë 
	`°bi__îr
("bad dist","Corrupt PNG");

4153 i‡(
zout
 + 
Àn
 > 
a
->
zout_íd
) {

4154 i‡(!
	`°bi__zex∑nd
(
a
, 
zout
, 
Àn
))  0;

4155 
zout
 = 
a
->zout;

4157 
p
 = (
°bi_uc
 *Ë(
zout
 - 
di°
);

4158 i‡(
di°
 == 1) {

4159 
°bi_uc
 
v
 = *
p
;

4160 i‡(
Àn
Ë{ dÿ*
zout
++ = 
v
; --len); }

4162 i‡(
Àn
Ë{ dÿ*
zout
++ = *
p
++; --len); }

4166 
	}
}

4168 
	$°bi__compuã_huffm™_codes
(
°bi__zbuf
 *
a
)

4170 c⁄° 
°bi_uc
 
Àngth_dezigzag
[19] = { 16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15 };

4171 
°bi__zhuffm™
 
z_codñígth
;

4172 
°bi_uc
 
Àncodes
[286+32+137];

4173 
°bi_uc
 
codñígth_sizes
[19];

4174 
i
,
n
;

4176 
hlô
 = 
	`°bi__zª˚ive
(
a
,5) + 257;

4177 
hdi°
 = 
	`°bi__zª˚ive
(
a
,5) + 1;

4178 
h˛í
 = 
	`°bi__zª˚ive
(
a
,4) + 4;

4179 
¡Ÿ
 = 
hlô
 + 
hdi°
;

4181 
	`mem£t
(
codñígth_sizes
, 0, (codelength_sizes));

4182 
i
=0; i < 
h˛í
; ++i) {

4183 
s
 = 
	`°bi__zª˚ive
(
a
,3);

4184 
codñígth_sizes
[
Àngth_dezigzag
[
i
]] = (
°bi_uc
Ë
s
;

4186 i‡(!
	`°bi__zbuûd_huffm™
(&
z_codñígth
, 
codñígth_sizes
, 19))  0;

4188 
n
 = 0;

4189 
n
 < 
¡Ÿ
) {

4190 
c
 = 
	`°bi__zhuffm™_decode
(
a
, &
z_codñígth
);

4191 i‡(
c
 < 0 || c >19Ë 
	`°bi__îr
("bad codelengths", "Corrupt PNG");

4192 i‡(
c
 < 16)

4193 
Àncodes
[
n
++] = (
°bi_uc
Ë
c
;

4195 
°bi_uc
 
fûl
 = 0;

4196 i‡(
c
 == 16) {

4197 
c
 = 
	`°bi__zª˚ive
(
a
,2)+3;

4198 i‡(
n
 =0Ë 
	`°bi__îr
("bad codelengths", "Corrupt PNG");

4199 
fûl
 = 
Àncodes
[
n
-1];

4200 } i‡(
c
 == 17)

4201 
c
 = 
	`°bi__zª˚ive
(
a
,3)+3;

4203 
	`STBI_ASSERT
(
c
 == 18);

4204 
c
 = 
	`°bi__zª˚ive
(
a
,7)+11;

4206 i‡(
¡Ÿ
 - 
n
 < 
c
Ë 
	`°bi__îr
("bad codelengths", "Corrupt PNG");

4207 
	`mem£t
(
Àncodes
+
n
, 
fûl
, 
c
);

4208 
n
 +
c
;

4211 i‡(
n
 !
¡Ÿ
Ë 
	`°bi__îr
("bad codelengths","Corrupt PNG");

4212 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_Àngth
, 
Àncodes
, 
hlô
))  0;

4213 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_di°™˚
, 
Àncodes
+
hlô
, 
hdi°
))  0;

4215 
	}
}

4217 
	$°bi__∑r£_uncom¥es£d_block
(
°bi__zbuf
 *
a
)

4219 
°bi_uc
 
hódî
[4];

4220 
Àn
,
∆í
,
k
;

4221 i‡(
a
->
num_bôs
 & 7)

4222 
	`°bi__zª˚ive
(
a
,á->
num_bôs
 & 7);

4224 
k
 = 0;

4225 
a
->
num_bôs
 > 0) {

4226 
hódî
[
k
++] = (
°bi_uc
Ë(
a
->
code_buf„r
 & 255);

4227 
a
->
code_buf„r
 >>= 8;

4228 
a
->
num_bôs
 -= 8;

4230 
	`STBI_ASSERT
(
a
->
num_bôs
 == 0);

4232 
k
 < 4)

4233 
hódî
[
k
++] = 
	`°bi__zgë8
(
a
);

4234 
Àn
 = 
hódî
[1] * 256 + header[0];

4235 
∆í
 = 
hódî
[3] * 256 + header[2];

4236 i‡(
∆í
 !(
Àn
 ^ 0xffff)Ë 
	`°bi__îr
("zlib corrupt","Corrupt PNG");

4237 i‡(
a
->
zbuf„r
 + 
Àn
 >á->
zbuf„r_íd
Ë 
	`°bi__îr
("readÖast buffer","Corrupt PNG");

4238 i‡(
a
->
zout
 + 
Àn
 >á->
zout_íd
)

4239 i‡(!
	`°bi__zex∑nd
(
a
,á->
zout
, 
Àn
))  0;

4240 
	`mem˝y
(
a
->
zout
,á->
zbuf„r
, 
Àn
);

4241 
a
->
zbuf„r
 +
Àn
;

4242 
a
->
zout
 +
Àn
;

4244 
	}
}

4246 
	$°bi__∑r£_zlib_hódî
(
°bi__zbuf
 *
a
)

4248 
cmf
 = 
	`°bi__zgë8
(
a
);

4249 
cm
 = 
cmf
 & 15;

4251 
Êg
 = 
	`°bi__zgë8
(
a
);

4252 i‡((
cmf
*256+
Êg
Ë% 31 !0Ë 
	`°bi__îr
("bad zlib header","Corrupt PNG");

4253 i‡(
Êg
 & 32Ë 
	`°bi__îr
("noÖreset dict","Corrupt PNG");

4254 i‡(
cm
 !8Ë 
	`°bi__îr
("bad compression","Corrupt PNG");

4257 
	}
}

4259 c⁄° 
°bi_uc
 
	g°bi__zdeÁu…_Àngth
[288] =

4271 c⁄° 
°bi_uc
 
	g°bi__zdeÁu…_di°™˚
[32] =

4288 
	$°bi__∑r£_zlib
(
°bi__zbuf
 *
a
, 
∑r£_hódî
)

4290 
föÆ
, 
ty≥
;

4291 i‡(
∑r£_hódî
)

4292 i‡(!
	`°bi__∑r£_zlib_hódî
(
a
))  0;

4293 
a
->
num_bôs
 = 0;

4294 
a
->
code_buf„r
 = 0;

4296 
föÆ
 = 
	`°bi__zª˚ive
(
a
,1);

4297 
ty≥
 = 
	`°bi__zª˚ive
(
a
,2);

4298 i‡(
ty≥
 == 0) {

4299 i‡(!
	`°bi__∑r£_uncom¥es£d_block
(
a
))  0;

4300 } i‡(
ty≥
 == 3) {

4303 i‡(
ty≥
 == 1) {

4305 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_Àngth
 , 
°bi__zdeÁu…_Àngth
 , 288))  0;

4306 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_di°™˚
, 
°bi__zdeÁu…_di°™˚
, 32))  0;

4308 i‡(!
	`°bi__compuã_huffm™_codes
(
a
))  0;

4310 i‡(!
	`°bi__∑r£_huffm™_block
(
a
))  0;

4312 } !
föÆ
);

4314 
	}
}

4316 
	$°bi__do_zlib
(
°bi__zbuf
 *
a
, *
obuf
, 
ﬁí
, 
exp
, 
∑r£_hódî
)

4318 
a
->
zout_°¨t
 = 
obuf
;

4319 
a
->
zout
 = 
obuf
;

4320 
a
->
zout_íd
 = 
obuf
 + 
ﬁí
;

4321 
a
->
z_ex∑ndabÀ
 = 
exp
;

4323  
	`°bi__∑r£_zlib
(
a
, 
∑r£_hódî
);

4324 
	}
}

4326 
STBIDEF
 *
	$°bi_zlib_decode_mÆloc_guesssize
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
)

4328 
°bi__zbuf
 
a
;

4329 *
p
 = (*Ë
	`°bi__mÆloc
(
öôül_size
);

4330 i‡(
p
 =
NULL
)  NULL;

4331 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
buf„r
;

4332 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
buf„r
 + 
Àn
;

4333 i‡(
	`°bi__do_zlib
(&
a
, 
p
, 
öôül_size
, 1, 1)) {

4334 i‡(
ouéí
Ë*ouéí = (Ë(
a
.
zout
 -á.
zout_°¨t
);

4335  
a
.
zout_°¨t
;

4337 
	`STBI_FREE
(
a
.
zout_°¨t
);

4338  
NULL
;

4340 
	}
}

4342 
STBIDEF
 *
	$°bi_zlib_decode_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
)

4344  
	`°bi_zlib_decode_mÆloc_guesssize
(
buf„r
, 
Àn
, 16384, 
ouéí
);

4345 
	}
}

4347 
STBIDEF
 *
	$°bi_zlib_decode_mÆloc_guesssize_hódîÊag
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
, 
∑r£_hódî
)

4349 
°bi__zbuf
 
a
;

4350 *
p
 = (*Ë
	`°bi__mÆloc
(
öôül_size
);

4351 i‡(
p
 =
NULL
)  NULL;

4352 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
buf„r
;

4353 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
buf„r
 + 
Àn
;

4354 i‡(
	`°bi__do_zlib
(&
a
, 
p
, 
öôül_size
, 1, 
∑r£_hódî
)) {

4355 i‡(
ouéí
Ë*ouéí = (Ë(
a
.
zout
 -á.
zout_°¨t
);

4356  
a
.
zout_°¨t
;

4358 
	`STBI_FREE
(
a
.
zout_°¨t
);

4359  
NULL
;

4361 
	}
}

4363 
STBIDEF
 
	$°bi_zlib_decode_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
)

4365 
°bi__zbuf
 
a
;

4366 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
ibuf„r
;

4367 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
ibuf„r
 + 
ûí
;

4368 i‡(
	`°bi__do_zlib
(&
a
, 
obuf„r
, 
ﬁí
, 0, 1))

4369  (Ë(
a
.
zout
 -á.
zout_°¨t
);

4372 
	}
}

4374 
STBIDEF
 *
	$°bi_zlib_decode_nohódî_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
)

4376 
°bi__zbuf
 
a
;

4377 *
p
 = (*Ë
	`°bi__mÆloc
(16384);

4378 i‡(
p
 =
NULL
)  NULL;

4379 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
buf„r
;

4380 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
buf„r
+
Àn
;

4381 i‡(
	`°bi__do_zlib
(&
a
, 
p
, 16384, 1, 0)) {

4382 i‡(
ouéí
Ë*ouéí = (Ë(
a
.
zout
 -á.
zout_°¨t
);

4383  
a
.
zout_°¨t
;

4385 
	`STBI_FREE
(
a
.
zout_°¨t
);

4386  
NULL
;

4388 
	}
}

4390 
STBIDEF
 
	$°bi_zlib_decode_nohódî_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
)

4392 
°bi__zbuf
 
a
;

4393 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
ibuf„r
;

4394 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
ibuf„r
 + 
ûí
;

4395 i‡(
	`°bi__do_zlib
(&
a
, 
obuf„r
, 
ﬁí
, 0, 0))

4396  (Ë(
a
.
zout
 -á.
zout_°¨t
);

4399 
	}
}

4412 #i‚de‡
STBI_NO_PNG


4415 
°bi__uöt32
 
	mÀngth
;

4416 
°bi__uöt32
 
	mty≥
;

4417 } 
	t°bi__≤gchunk
;

4419 
°bi__≤gchunk
 
	$°bi__gë_chunk_hódî
(
°bi__c⁄ãxt
 *
s
)

4421 
°bi__≤gchunk
 
c
;

4422 
c
.
Àngth
 = 
	`°bi__gë32be
(
s
);

4423 
c
.
ty≥
 = 
	`°bi__gë32be
(
s
);

4424  
c
;

4425 
	}
}

4427 
	$°bi__check_≤g_hódî
(
°bi__c⁄ãxt
 *
s
)

4429 c⁄° 
°bi_uc
 
≤g_sig
[8] = { 137,80,78,71,13,10,26,10 };

4430 
i
;

4431 
i
=0; i < 8; ++i)

4432 i‡(
	`°bi__gë8
(
s
Ë!
≤g_sig
[
i
]Ë 
	`°bi__îr
("badÖng sig","Notá PNG");

4434 
	}
}

4438 
°bi__c⁄ãxt
 *
	ms
;

4439 
°bi_uc
 *
	mid©a
, *
	mex∑nded
, *
	mout
;

4440 
	mdïth
;

4441 } 
	t°bi__≤g
;

4445 
	mSTBI__F_n⁄e
=0,

4446 
	mSTBI__F_sub
=1,

4447 
	mSTBI__F_up
=2,

4448 
	mSTBI__F_avg
=3,

4449 
	mSTBI__F_∑ëh
=4,

4451 
	mSTBI__F_avg_fú°
,

4452 
	mSTBI__F_∑ëh_fú°


4455 
°bi_uc
 
	gfú°_row_fûãr
[5] =

4457 
STBI__F_n⁄e
,

4458 
STBI__F_sub
,

4459 
STBI__F_n⁄e
,

4460 
STBI__F_avg_fú°
,

4461 
STBI__F_∑ëh_fú°


4464 
	$°bi__∑ëh
(
a
, 
b
, 
c
)

4466 
p
 = 
a
 + 
b
 - 
c
;

4467 
∑
 = 
	`abs
(
p
-
a
);

4468 
pb
 = 
	`abs
(
p
-
b
);

4469 
pc
 = 
	`abs
(
p
-
c
);

4470 i‡(
∑
 <
pb
 &&Ö®<
pc
Ë 
a
;

4471 i‡(
pb
 <
pc
Ë 
b
;

4472  
c
;

4473 
	}
}

4475 c⁄° 
°bi_uc
 
	g°bi__dïth_sˇÀ_èbÀ
[9] = { 0, 0xff, 0x55, 0, 0x11, 0,0,0, 0x01 };

4478 
	$°bi__¸óã_≤g_image_øw
(
°bi__≤g
 *
a
, 
°bi_uc
 *
øw
, 
°bi__uöt32
 
øw_Àn
, 
out_n
, stbi__uöt32 
x
, stbi__uöt32 
y
, 
dïth
, 
cﬁ‹
)

4480 
byãs
 = (
dïth
 == 16? 2 : 1);

4481 
°bi__c⁄ãxt
 *
s
 = 
a
->s;

4482 
°bi__uöt32
 
i
,
j
,
°ride
 = 
x
*
out_n
*
byãs
;

4483 
°bi__uöt32
 
img_Àn
, 
img_width_byãs
;

4484 
k
;

4485 
img_n
 = 
s
->img_n;

4487 
ouçut_byãs
 = 
out_n
*
byãs
;

4488 
fûãr_byãs
 = 
img_n
*
byãs
;

4489 
width
 = 
x
;

4491 
	`STBI_ASSERT
(
out_n
 =
s
->
img_n
 || out_n == s->img_n+1);

4492 
a
->
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
x
, 
y
, 
ouçut_byãs
, 0);

4493 i‡(!
a
->
out
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4495 i‡(!
	`°bi__mad3sizes_vÆid
(
img_n
, 
x
, 
dïth
, 7)Ë 
	`°bi__îr
("tooÜarge", "Corrupt PNG");

4496 
img_width_byãs
 = (((
img_n
 * 
x
 * 
dïth
) + 7) >> 3);

4497 
img_Àn
 = (
img_width_byãs
 + 1Ë* 
y
;

4502 i‡(
øw_Àn
 < 
img_Àn
Ë 
	`°bi__îr
("notÉnoughÖixels","Corrupt PNG");

4504 
j
=0; j < 
y
; ++j) {

4505 
°bi_uc
 *
cur
 = 
a
->
out
 + 
°ride
*
j
;

4506 
°bi_uc
 *
¥i‹
;

4507 
fûãr
 = *
øw
++;

4509 i‡(
fûãr
 > 4)

4510  
	`°bi__îr
("invalid filter","Corrupt PNG");

4512 i‡(
dïth
 < 8) {

4513 
	`STBI_ASSERT
(
img_width_byãs
 <
x
);

4514 
cur
 +
x
*
out_n
 - 
img_width_byãs
;

4515 
fûãr_byãs
 = 1;

4516 
width
 = 
img_width_byãs
;

4518 
¥i‹
 = 
cur
 - 
°ride
;

4521 i‡(
j
 =0Ë
fûãr
 = 
fú°_row_fûãr
[filter];

4524 
k
=0; k < 
fûãr_byãs
; ++k) {

4525 
fûãr
) {

4526 
STBI__F_n⁄e
 : 
cur
[
k
] = 
øw
[k]; ;

4527 
STBI__F_sub
 : 
cur
[
k
] = 
øw
[k]; ;

4528 
STBI__F_up
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
¥i‹
[k]); ;

4529 
STBI__F_avg
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + (
¥i‹
[k]>>1)); ;

4530 
STBI__F_∑ëh
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(0,
¥i‹
[k],0)); ;

4531 
STBI__F_avg_fú°
 : 
cur
[
k
] = 
øw
[k]; ;

4532 
STBI__F_∑ëh_fú°
: 
cur
[
k
] = 
øw
[k]; ;

4536 i‡(
dïth
 == 8) {

4537 i‡(
img_n
 !
out_n
)

4538 
cur
[
img_n
] = 255;

4539 
øw
 +
img_n
;

4540 
cur
 +
out_n
;

4541 
¥i‹
 +
out_n
;

4542 } i‡(
dïth
 == 16) {

4543 i‡(
img_n
 !
out_n
) {

4544 
cur
[
fûãr_byãs
] = 255;

4545 
cur
[
fûãr_byãs
+1] = 255;

4547 
øw
 +
fûãr_byãs
;

4548 
cur
 +
ouçut_byãs
;

4549 
¥i‹
 +
ouçut_byãs
;

4551 
øw
 += 1;

4552 
cur
 += 1;

4553 
¥i‹
 += 1;

4557 i‡(
dïth
 < 8 || 
img_n
 =
out_n
) {

4558 
nk
 = (
width
 - 1)*
fûãr_byãs
;

4559 
	#STBI__CASE
(
f
) \

4560 
f
: \

4561 
k
=0; k < 
nk
; ++k)

	)

4562 
fûãr
) {

4564 
STBI__F_n⁄e
: 
	`mem˝y
(
cur
, 
øw
, 
nk
); ;

4565 
	`STBI__CASE
(
STBI__F_sub
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + cur[k-
fûãr_byãs
]); } ;

4566 
	`STBI__CASE
(
STBI__F_up
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
¥i‹
[k]); } ;

4567 
	`STBI__CASE
(
STBI__F_avg
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + ((
¥i‹
[k] + cur[k-
fûãr_byãs
])>>1)); } ;

4568 
	`STBI__CASE
(
STBI__F_∑ëh
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k-
fûãr_byãs
],
¥i‹
[k],prior[k-filter_bytes])); } ;

4569 
	`STBI__CASE
(
STBI__F_avg_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + (cur[k-
fûãr_byãs
] >> 1)); } ;

4570 
	`STBI__CASE
(
STBI__F_∑ëh_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k-
fûãr_byãs
],0,0)); } ;

4572 #unde‡
STBI__CASE


4573 
øw
 +
nk
;

4575 
	`STBI_ASSERT
(
img_n
+1 =
out_n
);

4576 
	#STBI__CASE
(
f
) \

4577 
f
: \

4578 
i
=
x
-1; i >1; --i, 
cur
[
fûãr_byãs
]=255,
øw
+=fûãr_byãs,cur+=
ouçut_byãs
,
¥i‹
+=output_bytes) \

4579 
k
=0; k < 
fûãr_byãs
; ++k)

	)

4580 
fûãr
) {

4581 
	`STBI__CASE
(
STBI__F_n⁄e
Ë{ 
cur
[
k
] = 
øw
[k]; } ;

4582 
	`STBI__CASE
(
STBI__F_sub
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + cur[k- 
ouçut_byãs
]); } ;

4583 
	`STBI__CASE
(
STBI__F_up
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
¥i‹
[k]); } ;

4584 
	`STBI__CASE
(
STBI__F_avg
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + ((
¥i‹
[k] + cur[k- 
ouçut_byãs
])>>1)); } ;

4585 
	`STBI__CASE
(
STBI__F_∑ëh
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k- 
ouçut_byãs
],
¥i‹
[k],prior[k- output_bytes])); } ;

4586 
	`STBI__CASE
(
STBI__F_avg_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + (cur[k- 
ouçut_byãs
] >> 1)); } ;

4587 
	`STBI__CASE
(
STBI__F_∑ëh_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k- 
ouçut_byãs
],0,0)); } ;

4589 #unde‡
STBI__CASE


4593 i‡(
dïth
 == 16) {

4594 
cur
 = 
a
->
out
 + 
°ride
*
j
;

4595 
i
=0; i < 
x
; ++i,
cur
+=
ouçut_byãs
) {

4596 
cur
[
fûãr_byãs
+1] = 255;

4605 i‡(
dïth
 < 8) {

4606 
j
=0; j < 
y
; ++j) {

4607 
°bi_uc
 *
cur
 = 
a
->
out
 + 
°ride
*
j
;

4608 
°bi_uc
 *
ö
 = 
a
->
out
 + 
°ride
*
j
 + 
x
*
out_n
 - 
img_width_byãs
;

4611 
°bi_uc
 
sˇÀ
 = (
cﬁ‹
 =0Ë? 
°bi__dïth_sˇÀ_èbÀ
[
dïth
] : 1;

4619 i‡(
dïth
 == 4) {

4620 
k
=
x
*
img_n
; k >2; k-=2, ++
ö
) {

4621 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) );

4622 *
cur
++ = 
sˇÀ
 * ((*
ö
 ) & 0x0f);

4624 i‡(
k
 > 0Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) );

4625 } i‡(
dïth
 == 2) {

4626 
k
=
x
*
img_n
; k >4; k-=4, ++
ö
) {

4627 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) );

4628 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x03);

4629 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x03);

4630 *
cur
++ = 
sˇÀ
 * ((*
ö
 ) & 0x03);

4632 i‡(
k
 > 0Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) );

4633 i‡(
k
 > 1Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x03);

4634 i‡(
k
 > 2Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x03);

4635 } i‡(
dïth
 == 1) {

4636 
k
=
x
*
img_n
; k >8; k-=8, ++
ö
) {

4637 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 7) );

4638 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) & 0x01);

4639 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 5) & 0x01);

4640 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x01);

4641 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 3) & 0x01);

4642 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x01);

4643 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 1) & 0x01);

4644 *
cur
++ = 
sˇÀ
 * ((*
ö
 ) & 0x01);

4646 i‡(
k
 > 0Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 7) );

4647 i‡(
k
 > 1Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) & 0x01);

4648 i‡(
k
 > 2Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 5) & 0x01);

4649 i‡(
k
 > 3Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x01);

4650 i‡(
k
 > 4Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 3) & 0x01);

4651 i‡(
k
 > 5Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x01);

4652 i‡(
k
 > 6Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 1) & 0x01);

4654 i‡(
img_n
 !
out_n
) {

4655 
q
;

4657 
cur
 = 
a
->
out
 + 
°ride
*
j
;

4658 i‡(
img_n
 == 1) {

4659 
q
=
x
-1; q >= 0; --q) {

4660 
cur
[
q
*2+1] = 255;

4661 
cur
[
q
*2+0] = cur[q];

4664 
	`STBI_ASSERT
(
img_n
 == 3);

4665 
q
=
x
-1; q >= 0; --q) {

4666 
cur
[
q
*4+3] = 255;

4667 
cur
[
q
*4+2] = cur[q*3+2];

4668 
cur
[
q
*4+1] = cur[q*3+1];

4669 
cur
[
q
*4+0] = cur[q*3+0];

4674 } i‡(
dïth
 == 16) {

4679 
°bi_uc
 *
cur
 = 
a
->
out
;

4680 
°bi__uöt16
 *
cur16
 = (°bi__uöt16*)
cur
;

4682 
i
=0; i < 
x
*
y
*
out_n
; ++i,
cur16
++,
cur
+=2) {

4683 *
cur16
 = (
cur
[0] << 8) | cur[1];

4688 
	}
}

4690 
	$°bi__¸óã_≤g_image
(
°bi__≤g
 *
a
, 
°bi_uc
 *
image_d©a
, 
°bi__uöt32
 
image_d©a_Àn
, 
out_n
, 
dïth
, 
cﬁ‹
, 
öãæa˚d
)

4692 
byãs
 = (
dïth
 == 16 ? 2 : 1);

4693 
out_byãs
 = 
out_n
 * 
byãs
;

4694 
°bi_uc
 *
föÆ
;

4695 
p
;

4696 i‡(!
öãæa˚d
)

4697  
	`°bi__¸óã_≤g_image_øw
(
a
, 
image_d©a
, 
image_d©a_Àn
, 
out_n
,á->
s
->
img_x
,á->s->
img_y
, 
dïth
, 
cﬁ‹
);

4700 
föÆ
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
a
->
s
->
img_x
,á->s->
img_y
, 
out_byãs
, 0);

4701 
p
=0;Ö < 7; ++p) {

4702 
x‹ig
[] = { 0,4,0,2,0,1,0 };

4703 
y‹ig
[] = { 0,0,4,0,2,0,1 };

4704 
x•c
[] = { 8,8,4,4,2,2,1 };

4705 
y•c
[] = { 8,8,8,4,4,2,2 };

4706 
i
,
j
,
x
,
y
;

4708 
x
 = (
a
->
s
->
img_x
 - 
x‹ig
[
p
] + 
x•c
[p]-1) / xspc[p];

4709 
y
 = (
a
->
s
->
img_y
 - 
y‹ig
[
p
] + 
y•c
[p]-1) / yspc[p];

4710 i‡(
x
 && 
y
) {

4711 
°bi__uöt32
 
img_Àn
 = ((((
a
->
s
->
img_n
 * 
x
 * 
dïth
Ë+ 7Ë>> 3Ë+ 1Ë* 
y
;

4712 i‡(!
	`°bi__¸óã_≤g_image_øw
(
a
, 
image_d©a
, 
image_d©a_Àn
, 
out_n
, 
x
, 
y
, 
dïth
, 
cﬁ‹
)) {

4713 
	`STBI_FREE
(
föÆ
);

4716 
j
=0; j < 
y
; ++j) {

4717 
i
=0; i < 
x
; ++i) {

4718 
out_y
 = 
j
*
y•c
[
p
]+
y‹ig
[p];

4719 
out_x
 = 
i
*
x•c
[
p
]+
x‹ig
[p];

4720 
	`mem˝y
(
föÆ
 + 
out_y
*
a
->
s
->
img_x
*
out_byãs
 + 
out_x
*out_bytes,

4721 
a
->
out
 + (
j
*
x
+
i
)*
out_byãs
, out_bytes);

4724 
	`STBI_FREE
(
a
->
out
);

4725 
image_d©a
 +
img_Àn
;

4726 
image_d©a_Àn
 -
img_Àn
;

4729 
a
->
out
 = 
föÆ
;

4732 
	}
}

4734 
	$°bi__compuã_å™•¨ícy
(
°bi__≤g
 *
z
, 
°bi_uc
 
tc
[3], 
out_n
)

4736 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4737 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
s
->
img_x
 * s->
img_y
;

4738 
°bi_uc
 *
p
 = 
z
->
out
;

4742 
	`STBI_ASSERT
(
out_n
 == 2 || out_n == 4);

4744 i‡(
out_n
 == 2) {

4745 
i
=0; i < 
pixñ_cou¡
; ++i) {

4746 
p
[1] = (p[0] =
tc
[0] ? 0 : 255);

4747 
p
 += 2;

4750 
i
=0; i < 
pixñ_cou¡
; ++i) {

4751 i‡(
p
[0] =
tc
[0] &&Ö[1] ==Åc[1] &&Ö[2] ==Åc[2])

4752 
p
[3] = 0;

4753 
p
 += 4;

4757 
	}
}

4759 
	$°bi__compuã_å™•¨ícy16
(
°bi__≤g
 *
z
, 
°bi__uöt16
 
tc
[3], 
out_n
)

4761 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4762 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
s
->
img_x
 * s->
img_y
;

4763 
°bi__uöt16
 *
p
 = (°bi__uöt16*Ë
z
->
out
;

4767 
	`STBI_ASSERT
(
out_n
 == 2 || out_n == 4);

4769 i‡(
out_n
 == 2) {

4770 
i
 = 0; i < 
pixñ_cou¡
; ++i) {

4771 
p
[1] = (p[0] =
tc
[0] ? 0 : 65535);

4772 
p
 += 2;

4775 
i
 = 0; i < 
pixñ_cou¡
; ++i) {

4776 i‡(
p
[0] =
tc
[0] &&Ö[1] ==Åc[1] &&Ö[2] ==Åc[2])

4777 
p
[3] = 0;

4778 
p
 += 4;

4782 
	}
}

4784 
	$°bi__ex∑nd_≤g_∑Àâe
(
°bi__≤g
 *
a
, 
°bi_uc
 *
∑Àâe
, 
Àn
, 
∑l_img_n
)

4786 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
a
->
s
->
img_x
 *á->s->
img_y
;

4787 
°bi_uc
 *
p
, *
ãmp_out
, *
‹ig
 = 
a
->
out
;

4789 
p
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad2
(
pixñ_cou¡
, 
∑l_img_n
, 0);

4790 i‡(
p
 =
NULL
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4793 
ãmp_out
 = 
p
;

4795 i‡(
∑l_img_n
 == 3) {

4796 
i
=0; i < 
pixñ_cou¡
; ++i) {

4797 
n
 = 
‹ig
[
i
]*4;

4798 
p
[0] = 
∑Àâe
[
n
 ];

4799 
p
[1] = 
∑Àâe
[
n
+1];

4800 
p
[2] = 
∑Àâe
[
n
+2];

4801 
p
 += 3;

4804 
i
=0; i < 
pixñ_cou¡
; ++i) {

4805 
n
 = 
‹ig
[
i
]*4;

4806 
p
[0] = 
∑Àâe
[
n
 ];

4807 
p
[1] = 
∑Àâe
[
n
+1];

4808 
p
[2] = 
∑Àâe
[
n
+2];

4809 
p
[3] = 
∑Àâe
[
n
+3];

4810 
p
 += 4;

4813 
	`STBI_FREE
(
a
->
out
);

4814 
a
->
out
 = 
ãmp_out
;

4816 
	`STBI_NOTUSED
(
Àn
);

4819 
	}
}

4821 
	g°bi__u≈ªmu…ùly_⁄_lﬂd
 = 0;

4822 
	g°bi__de_ùh⁄e_Êag
 = 0;

4824 
STBIDEF
 
	$°bi_£t_u≈ªmu…ùly_⁄_lﬂd
(
Êag_åue_if_should_u≈ªmu…ùly
)

4826 
°bi__u≈ªmu…ùly_⁄_lﬂd
 = 
Êag_åue_if_should_u≈ªmu…ùly
;

4827 
	}
}

4829 
STBIDEF
 
	$°bi_c⁄vît_ùh⁄e_≤g_to_rgb
(
Êag_åue_if_should_c⁄vît
)

4831 
°bi__de_ùh⁄e_Êag
 = 
Êag_åue_if_should_c⁄vît
;

4832 
	}
}

4834 
	$°bi__de_ùh⁄e
(
°bi__≤g
 *
z
)

4836 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4837 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
s
->
img_x
 * s->
img_y
;

4838 
°bi_uc
 *
p
 = 
z
->
out
;

4840 i‡(
s
->
img_out_n
 == 3) {

4841 
i
=0; i < 
pixñ_cou¡
; ++i) {

4842 
°bi_uc
 
t
 = 
p
[0];

4843 
p
[0] =Ö[2];

4844 
p
[2] = 
t
;

4845 
p
 += 3;

4848 
	`STBI_ASSERT
(
s
->
img_out_n
 == 4);

4849 i‡(
°bi__u≈ªmu…ùly_⁄_lﬂd
) {

4851 
i
=0; i < 
pixñ_cou¡
; ++i) {

4852 
°bi_uc
 
a
 = 
p
[3];

4853 
°bi_uc
 
t
 = 
p
[0];

4854 i‡(
a
) {

4855 
°bi_uc
 
hÆf
 = 
a
 / 2;

4856 
p
[0] = (p[2] * 255 + 
hÆf
Ë/ 
a
;

4857 
p
[1] = (p[1] * 255 + 
hÆf
Ë/ 
a
;

4858 
p
[2] = ( 
t
 * 255 + 
hÆf
Ë/ 
a
;

4860 
p
[0] =Ö[2];

4861 
p
[2] = 
t
;

4863 
p
 += 4;

4867 
i
=0; i < 
pixñ_cou¡
; ++i) {

4868 
°bi_uc
 
t
 = 
p
[0];

4869 
p
[0] =Ö[2];

4870 
p
[2] = 
t
;

4871 
p
 += 4;

4875 
	}
}

4877 
	#STBI__PNG_TYPE
(
a
,
b
,
c
,
d
Ë(((Ë◊Ë<< 24Ë+ ((Ë(bË<< 16Ë+ ((Ë(cË<< 8Ë+ (Ë(d))

	)

4879 
	$°bi__∑r£_≤g_fûe
(
°bi__≤g
 *
z
, 
sˇn
, 
ªq_comp
)

4881 
°bi_uc
 
∑Àâe
[1024], 
∑l_img_n
=0;

4882 
°bi_uc
 
has_å™s
=0, 
tc
[3]={0};

4883 
°bi__uöt16
 
tc16
[3];

4884 
°bi__uöt32
 
ioff
=0, 
id©a_limô
=0, 
i
, 
∑l_Àn
=0;

4885 
fú°
=1,
k
,
öãæa˚
=0, 
cﬁ‹
=0, 
is_ùh⁄e
=0;

4886 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4888 
z
->
ex∑nded
 = 
NULL
;

4889 
z
->
id©a
 = 
NULL
;

4890 
z
->
out
 = 
NULL
;

4892 i‡(!
	`°bi__check_≤g_hódî
(
s
))  0;

4894 i‡(
sˇn
 =
STBI__SCAN_ty≥
)  1;

4897 
°bi__≤gchunk
 
c
 = 
	`°bi__gë_chunk_hódî
(
s
);

4898 
c
.
ty≥
) {

4899 
	`STBI__PNG_TYPE
('C','g','B','I'):

4900 
is_ùh⁄e
 = 1;

4901 
	`°bi__skù
(
s
, 
c
.
Àngth
);

4903 
	`STBI__PNG_TYPE
('I','H','D','R'): {

4904 
comp
,
fûãr
;

4905 i‡(!
fú°
Ë 
	`°bi__îr
("multiple IHDR","Corrupt PNG");

4906 
fú°
 = 0;

4907 i‡(
c
.
Àngth
 !13Ë 
	`°bi__îr
("bad IHDRÜen","Corrupt PNG");

4908 
s
->
img_x
 = 
	`°bi__gë32be
(s); i‡(s->img_x > (1 << 24)Ë 
	`°bi__îr
("tooÜarge","VeryÜarge image (corrupt?)");

4909 
s
->
img_y
 = 
	`°bi__gë32be
(s); i‡(s->img_y > (1 << 24)Ë 
	`°bi__îr
("tooÜarge","VeryÜarge image (corrupt?)");

4910 
z
->
dïth
 = 
	`°bi__gë8
(
s
); i‡(z->dïth !1 && z->dïth !2 && z->dïth !4 && z->dïth !8 && z->dïth !16Ë 
	`°bi__îr
("1/2/4/8/16-bit only","PNGÇot supported: 1/2/4/8/16-bit only");

4911 
cﬁ‹
 = 
	`°bi__gë8
(
s
); i‡(cﬁ‹ > 6Ë 
	`°bi__îr
("bad ctype","Corrupt PNG");

4912 i‡(
cﬁ‹
 =3 && 
z
->
dïth
 =16Ë 
	`°bi__îr
("bad ctype","Corrupt PNG");

4913 i‡(
cﬁ‹
 =3Ë
∑l_img_n
 = 3; i‡(cﬁ‹ & 1Ë 
	`°bi__îr
("bad ctype","Corrupt PNG");

4914 
comp
 = 
	`°bi__gë8
(
s
); i‡(compË 
	`°bi__îr
("bad comp method","Corrupt PNG");

4915 
fûãr

	`°bi__gë8
(
s
); i‡(fûãrË 
	`°bi__îr
("bad filter method","Corrupt PNG");

4916 
öãæa˚
 = 
	`°bi__gë8
(
s
); i‡(öãæa˚>1Ë 
	`°bi__îr
("bad interlace method","Corrupt PNG");

4917 i‡(!
s
->
img_x
 || !s->
img_y
Ë 
	`°bi__îr
("0-pixel image","Corrupt PNG");

4918 i‡(!
∑l_img_n
) {

4919 
s
->
img_n
 = (
cﬁ‹
 & 2 ? 3 : 1) + (color & 4 ? 1 : 0);

4920 i‡((1 << 30Ë/ 
s
->
img_x
 / s->
img_n
 < s->
img_y
Ë 
	`°bi__îr
("tooÜarge", "ImageÅooÜargeÅo decode");

4921 i‡(
sˇn
 =
STBI__SCAN_hódî
)  1;

4925 
s
->
img_n
 = 1;

4926 i‡((1 << 30Ë/ 
s
->
img_x
 / 4 < s->
img_y
Ë 
	`°bi__îr
("tooÜarge","Corrupt PNG");

4932 
	`STBI__PNG_TYPE
('P','L','T','E'): {

4933 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

4934 i‡(
c
.
Àngth
 > 256*3Ë 
	`°bi__îr
("invalid PLTE","Corrupt PNG");

4935 
∑l_Àn
 = 
c
.
Àngth
 / 3;

4936 i‡(
∑l_Àn
 * 3 !
c
.
Àngth
Ë 
	`°bi__îr
("invalid PLTE","Corrupt PNG");

4937 
i
=0; i < 
∑l_Àn
; ++i) {

4938 
∑Àâe
[
i
*4+0] = 
	`°bi__gë8
(
s
);

4939 
∑Àâe
[
i
*4+1] = 
	`°bi__gë8
(
s
);

4940 
∑Àâe
[
i
*4+2] = 
	`°bi__gë8
(
s
);

4941 
∑Àâe
[
i
*4+3] = 255;

4946 
	`STBI__PNG_TYPE
('t','R','N','S'): {

4947 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

4948 i‡(
z
->
id©a
Ë 
	`°bi__îr
("tRNSáfter IDAT","Corrupt PNG");

4949 i‡(
∑l_img_n
) {

4950 i‡(
sˇn
 =
STBI__SCAN_hódî
Ë{ 
s
->
img_n
 = 4;  1; }

4951 i‡(
∑l_Àn
 =0Ë 
	`°bi__îr
("tRNS before PLTE","Corrupt PNG");

4952 i‡(
c
.
Àngth
 > 
∑l_Àn
Ë 
	`°bi__îr
("badÅRNSÜen","Corrupt PNG");

4953 
∑l_img_n
 = 4;

4954 
i
=0; i < 
c
.
Àngth
; ++i)

4955 
∑Àâe
[
i
*4+3] = 
	`°bi__gë8
(
s
);

4957 i‡(!(
s
->
img_n
 & 1)Ë 
	`°bi__îr
("tRNS withálpha","Corrupt PNG");

4958 i‡(
c
.
Àngth
 !(
°bi__uöt32
Ë
s
->
img_n
*2Ë 
	`°bi__îr
("badÅRNSÜen","Corrupt PNG");

4959 
has_å™s
 = 1;

4960 i‡(
z
->
dïth
 == 16) {

4961 
k
 = 0; k < 
s
->
img_n
; ++kË
tc16
[k] = (
°bi__uöt16
)
	`°bi__gë16be
(s);

4963 
k
 = 0; k < 
s
->
img_n
; ++kË
tc
[k] = (
°bi_uc
)(
	`°bi__gë16be
(sË& 255Ë* 
°bi__dïth_sˇÀ_èbÀ
[
z
->
dïth
];

4969 
	`STBI__PNG_TYPE
('I','D','A','T'): {

4970 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

4971 i‡(
∑l_img_n
 && !
∑l_Àn
Ë 
	`°bi__îr
("no PLTE","Corrupt PNG");

4972 i‡(
sˇn
 =
STBI__SCAN_hódî
Ë{ 
s
->
img_n
 = 
∑l_img_n
;  1; }

4973 i‡(()(
ioff
 + 
c
.
Àngth
) < ()ioff)  0;

4974 i‡(
ioff
 + 
c
.
Àngth
 > 
id©a_limô
) {

4975 
°bi__uöt32
 
id©a_limô_ﬁd
 = 
id©a_limô
;

4976 
°bi_uc
 *
p
;

4977 i‡(
id©a_limô
 =0Ëid©a_limô = 
c
.
Àngth
 > 4096 ? c.length : 4096;

4978 
ioff
 + 
c
.
Àngth
 > 
id©a_limô
)

4979 
id©a_limô
 *= 2;

4980 
	`STBI_NOTUSED
(
id©a_limô_ﬁd
);

4981 
p
 = (
°bi_uc
 *Ë
	`STBI_REALLOC_SIZED
(
z
->
id©a
, 
id©a_limô_ﬁd
, 
id©a_limô
); i‡’ =
NULL
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4982 
z
->
id©a
 = 
p
;

4984 i‡(!
	`°bi__gën
(
s
, 
z
->
id©a
+
ioff
,
c
.
Àngth
)Ë 
	`°bi__îr
("outofdata","Corrupt PNG");

4985 
ioff
 +
c
.
Àngth
;

4989 
	`STBI__PNG_TYPE
('I','E','N','D'): {

4990 
°bi__uöt32
 
øw_Àn
, 
b∂
;

4991 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

4992 i‡(
sˇn
 !
STBI__SCAN_lﬂd
)  1;

4993 i‡(
z
->
id©a
 =
NULL
Ë 
	`°bi__îr
("no IDAT","Corrupt PNG");

4995 
b∂
 = (
s
->
img_x
 * 
z
->
dïth
 + 7) / 8;

4996 
øw_Àn
 = 
b∂
 * 
s
->
img_y
 * s->
img_n
 + s->img_y ;

4997 
z
->
ex∑nded
 = (
°bi_uc
 *Ë
	`°bi_zlib_decode_mÆloc_guesssize_hódîÊag
((*Ëz->
id©a
, 
ioff
, 
øw_Àn
, (*Ë&øw_Àn, !
is_ùh⁄e
);

4998 i‡(
z
->
ex∑nded
 =
NULL
)  0;

4999 
	`STBI_FREE
(
z
->
id©a
); z->id©®
NULL
;

5000 i‡((
ªq_comp
 =
s
->
img_n
+1 &&Ñeq_com∞!3 && !
∑l_img_n
Ë|| 
has_å™s
)

5001 
s
->
img_out_n
 = s->
img_n
+1;

5003 
s
->
img_out_n
 = s->
img_n
;

5004 i‡(!
	`°bi__¸óã_≤g_image
(
z
, z->
ex∑nded
, 
øw_Àn
, 
s
->
img_out_n
, z->
dïth
, 
cﬁ‹
, 
öãæa˚
))  0;

5005 i‡(
has_å™s
) {

5006 i‡(
z
->
dïth
 == 16) {

5007 i‡(!
	`°bi__compuã_å™•¨ícy16
(
z
, 
tc16
, 
s
->
img_out_n
))  0;

5009 i‡(!
	`°bi__compuã_å™•¨ícy
(
z
, 
tc
, 
s
->
img_out_n
))  0;

5012 i‡(
is_ùh⁄e
 && 
°bi__de_ùh⁄e_Êag
 && 
s
->
img_out_n
 > 2)

5013 
	`°bi__de_ùh⁄e
(
z
);

5014 i‡(
∑l_img_n
) {

5016 
s
->
img_n
 = 
∑l_img_n
;

5017 
s
->
img_out_n
 = 
∑l_img_n
;

5018 i‡(
ªq_comp
 >3Ë
s
->
img_out_n
 =Ñeq_comp;

5019 i‡(!
	`°bi__ex∑nd_≤g_∑Àâe
(
z
, 
∑Àâe
, 
∑l_Àn
, 
s
->
img_out_n
))

5021 } i‡(
has_å™s
) {

5023 ++
s
->
img_n
;

5025 
	`STBI_FREE
(
z
->
ex∑nded
); z->ex∑nded = 
NULL
;

5027 
	`°bi__gë32be
(
s
);

5033 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

5034 i‡((
c
.
ty≥
 & (1 << 29)) == 0) {

5035 #i‚de‡
STBI_NO_FAILURE_STRINGS


5037 
övÆid_chunk
[] = "XXXX PNG chunkÇot known";

5038 
övÆid_chunk
[0] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 24);

5039 
övÆid_chunk
[1] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 16);

5040 
övÆid_chunk
[2] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 8);

5041 
övÆid_chunk
[3] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 0);

5043  
	`°bi__îr
(
övÆid_chunk
, "PNGÇot supported: unknown PNG chunkÅype");

5045 
	`°bi__skù
(
s
, 
c
.
Àngth
);

5049 
	`°bi__gë32be
(
s
);

5051 
	}
}

5053 *
	$°bi__do_≤g
(
°bi__≤g
 *
p
, *
x
, *
y
, *
n
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5055 *
ªsu…
=
NULL
;

5056 i‡(
ªq_comp
 < 0 ||Ñeq_com∞> 4Ë 
	`°bi__îΩuc
("badÑeq_comp", "InternalÉrror");

5057 i‡(
	`°bi__∑r£_≤g_fûe
(
p
, 
STBI__SCAN_lﬂd
, 
ªq_comp
)) {

5058 i‡(
p
->
dïth
 < 8)

5059 
ri
->
bôs_≥r_ch™√l
 = 8;

5061 
ri
->
bôs_≥r_ch™√l
 = 
p
->
dïth
;

5062 
ªsu…
 = 
p
->
out
;

5063 
p
->
out
 = 
NULL
;

5064 i‡(
ªq_comp
 &&Ñeq_com∞!
p
->
s
->
img_out_n
) {

5065 i‡(
ri
->
bôs_≥r_ch™√l
 == 8)

5066 
ªsu…
 = 
	`°bi__c⁄vît_f‹m©
((*Ëªsu…, 
p
->
s
->
img_out_n
, 
ªq_comp
,Ö->s->
img_x
,Ö->s->
img_y
);

5068 
ªsu…
 = 
	`°bi__c⁄vît_f‹m©16
((
°bi__uöt16
 *Ëªsu…, 
p
->
s
->
img_out_n
, 
ªq_comp
,Ö->s->
img_x
,Ö->s->
img_y
);

5069 
p
->
s
->
img_out_n
 = 
ªq_comp
;

5070 i‡(
ªsu…
 =
NULL
) Ñesult;

5072 *
x
 = 
p
->
s
->
img_x
;

5073 *
y
 = 
p
->
s
->
img_y
;

5074 i‡(
n
Ë*¿
p
->
s
->
img_n
;

5076 
	`STBI_FREE
(
p
->
out
);Ö->ouà
NULL
;

5077 
	`STBI_FREE
(
p
->
ex∑nded
);Ö->ex∑nded = 
NULL
;

5078 
	`STBI_FREE
(
p
->
id©a
);Ö->id©®
NULL
;

5080  
ªsu…
;

5081 
	}
}

5083 *
	$°bi__≤g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5085 
°bi__≤g
 
p
;

5086 
p
.
s
 = s;

5087  
	`°bi__do_≤g
(&
p
, 
x
,
y
,
comp
,
ªq_comp
, 
ri
);

5088 
	}
}

5090 
	$°bi__≤g_ã°
(
°bi__c⁄ãxt
 *
s
)

5092 
r
;

5093 
r
 = 
	`°bi__check_≤g_hódî
(
s
);

5094 
	`°bi__ªwöd
(
s
);

5095  
r
;

5096 
	}
}

5098 
	$°bi__≤g_öfo_øw
(
°bi__≤g
 *
p
, *
x
, *
y
, *
comp
)

5100 i‡(!
	`°bi__∑r£_≤g_fûe
(
p
, 
STBI__SCAN_hódî
, 0)) {

5101 
	`°bi__ªwöd
–
p
->
s
 );

5104 i‡(
x
Ë*x = 
p
->
s
->
img_x
;

5105 i‡(
y
Ë*y = 
p
->
s
->
img_y
;

5106 i‡(
comp
Ë*com∞
p
->
s
->
img_n
;

5108 
	}
}

5110 
	$°bi__≤g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

5112 
°bi__≤g
 
p
;

5113 
p
.
s
 = s;

5114  
	`°bi__≤g_öfo_øw
(&
p
, 
x
, 
y
, 
comp
);

5115 
	}
}

5117 
	$°bi__≤g_is16
(
°bi__c⁄ãxt
 *
s
)

5119 
°bi__≤g
 
p
;

5120 
p
.
s
 = s;

5121 i‡(!
	`°bi__≤g_öfo_øw
(&
p
, 
NULL
, NULL, NULL))

5123 i‡(
p
.
dïth
 != 16) {

5124 
	`°bi__ªwöd
(
p
.
s
);

5128 
	}
}

5133 #i‚de‡
STBI_NO_BMP


5134 
	$°bi__bmp_ã°_øw
(
°bi__c⁄ãxt
 *
s
)

5136 
r
;

5137 
sz
;

5138 i‡(
	`°bi__gë8
(
s
) != 'B')  0;

5139 i‡(
	`°bi__gë8
(
s
) != 'M')  0;

5140 
	`°bi__gë32À
(
s
);

5141 
	`°bi__gë16À
(
s
);

5142 
	`°bi__gë16À
(
s
);

5143 
	`°bi__gë32À
(
s
);

5144 
sz
 = 
	`°bi__gë32À
(
s
);

5145 
r
 = (
sz
 == 12 || sz == 40 || sz == 56 || sz == 108 || sz == 124);

5146  
r
;

5147 
	}
}

5149 
	$°bi__bmp_ã°
(
°bi__c⁄ãxt
 *
s
)

5151 
r
 = 
	`°bi__bmp_ã°_øw
(
s
);

5152 
	`°bi__ªwöd
(
s
);

5153  
r
;

5154 
	}
}

5158 
	$°bi__high_bô
(
z
)

5160 
n
=0;

5161 i‡(
z
 == 0)  -1;

5162 i‡(
z
 >0x10000Ë{ 
n
 += 16; z >>= 16; }

5163 i‡(
z
 >0x00100Ë{ 
n
 += 8; z >>= 8; }

5164 i‡(
z
 >0x00010Ë{ 
n
 += 4; z >>= 4; }

5165 i‡(
z
 >0x00004Ë{ 
n
 += 2; z >>= 2; }

5166 i‡(
z
 >0x00002Ë{ 
n
 += 1; }

5167  
n
;

5168 
	}
}

5170 
	$°bi__bôcou¡
(
a
)

5172 
a
 = (a & 0x55555555) + ((a >> 1) & 0x55555555);

5173 
a
 = (a & 0x33333333) + ((a >> 2) & 0x33333333);

5174 
a
 = (a + (a >> 4)) & 0x0f0f0f0f;

5175 
a
 = (a + (a >> 8));

5176 
a
 = (a + (a >> 16));

5177  
a
 & 0xff;

5178 
	}
}

5183 
	$°bi__shi·sig√d
(
v
, 
shi·
, 
bôs
)

5185 
mul_èbÀ
[9] = {

5190 
shi·_èbÀ
[9] = {

5193 i‡(
shi·
 < 0)

5194 
v
 <<-
shi·
;

5196 
v
 >>
shi·
;

5197 
	`STBI_ASSERT
(
v
 < 256);

5198 
v
 >>(8-
bôs
);

5199 
	`STBI_ASSERT
(
bôs
 >= 0 && bits <= 8);

5200  (Ë((Ë
v
 * 
mul_èbÀ
[
bôs
]Ë>> 
shi·_èbÀ
[bits];

5201 
	}
}

5205 
	mbµ
, 
	moff£t
, 
	mhsz
;

5206 
	mmr
,
	mmg
,
	mmb
,
	mma
, 
	mÆl_a
;

5207 
	mexåa_ªad
;

5208 } 
	t°bi__bmp_d©a
;

5210 *
	$°bi__bmp_∑r£_hódî
(
°bi__c⁄ãxt
 *
s
, 
°bi__bmp_d©a
 *
öfo
)

5212 
hsz
;

5213 i‡(
	`°bi__gë8
(
s
Ë!'B' || stbi__gë8(sË!'M'Ë 
	`°bi__îΩuc
("not BMP", "Corrupt BMP");

5214 
	`°bi__gë32À
(
s
);

5215 
	`°bi__gë16À
(
s
);

5216 
	`°bi__gë16À
(
s
);

5217 
öfo
->
off£t
 = 
	`°bi__gë32À
(
s
);

5218 
öfo
->
hsz
 = hsz = 
	`°bi__gë32À
(
s
);

5219 
öfo
->
mr
 = info->
mg
 = info->
mb
 = info->
ma
 = 0;

5220 
öfo
->
exåa_ªad
 = 14;

5222 i‡(
hsz
 !12 && hsz !40 && hsz !56 && hsz !108 && hsz !124Ë 
	`°bi__îΩuc
("unknown BMP", "BMPÅypeÇot supported: unknown");

5223 i‡(
hsz
 == 12) {

5224 
s
->
img_x
 = 
	`°bi__gë16À
(s);

5225 
s
->
img_y
 = 
	`°bi__gë16À
(s);

5227 
s
->
img_x
 = 
	`°bi__gë32À
(s);

5228 
s
->
img_y
 = 
	`°bi__gë32À
(s);

5230 i‡(
	`°bi__gë16À
(
s
Ë!1Ë 
	`°bi__îΩuc
("bad BMP", "bad BMP");

5231 
öfo
->
bµ
 = 
	`°bi__gë16À
(
s
);

5232 i‡(
hsz
 != 12) {

5233 
com¥ess
 = 
	`°bi__gë32À
(
s
);

5234 i‡(
com¥ess
 =1 || com¥es†=2Ë 
	`°bi__îΩuc
("BMP RLE", "BMPÅypeÇot supported: RLE");

5235 
	`°bi__gë32À
(
s
);

5236 
	`°bi__gë32À
(
s
);

5237 
	`°bi__gë32À
(
s
);

5238 
	`°bi__gë32À
(
s
);

5239 
	`°bi__gë32À
(
s
);

5240 i‡(
hsz
 == 40 || hsz == 56) {

5241 i‡(
hsz
 == 56) {

5242 
	`°bi__gë32À
(
s
);

5243 
	`°bi__gë32À
(
s
);

5244 
	`°bi__gë32À
(
s
);

5245 
	`°bi__gë32À
(
s
);

5247 i‡(
öfo
->
bµ
 == 16 || info->bpp == 32) {

5248 i‡(
com¥ess
 == 0) {

5249 i‡(
öfo
->
bµ
 == 32) {

5250 
öfo
->
mr
 = 0xffu << 16;

5251 
öfo
->
mg
 = 0xffu << 8;

5252 
öfo
->
mb
 = 0xffu << 0;

5253 
öfo
->
ma
 = 0xffu << 24;

5254 
öfo
->
Æl_a
 = 0;

5256 
öfo
->
mr
 = 31u << 10;

5257 
öfo
->
mg
 = 31u << 5;

5258 
öfo
->
mb
 = 31u << 0;

5260 } i‡(
com¥ess
 == 3) {

5261 
öfo
->
mr
 = 
	`°bi__gë32À
(
s
);

5262 
öfo
->
mg
 = 
	`°bi__gë32À
(
s
);

5263 
öfo
->
mb
 = 
	`°bi__gë32À
(
s
);

5264 
öfo
->
exåa_ªad
 += 12;

5266 i‡(
öfo
->
mr
 =öfo->
mg
 && info->mg =öfo->
mb
) {

5268  
	`°bi__îΩuc
("bad BMP", "bad BMP");

5271  
	`°bi__îΩuc
("bad BMP", "bad BMP");

5274 
i
;

5275 i‡(
hsz
 != 108 && hsz != 124)

5276  
	`°bi__îΩuc
("bad BMP", "bad BMP");

5277 
öfo
->
mr
 = 
	`°bi__gë32À
(
s
);

5278 
öfo
->
mg
 = 
	`°bi__gë32À
(
s
);

5279 
öfo
->
mb
 = 
	`°bi__gë32À
(
s
);

5280 
öfo
->
ma
 = 
	`°bi__gë32À
(
s
);

5281 
	`°bi__gë32À
(
s
);

5282 
i
=0; i < 12; ++i)

5283 
	`°bi__gë32À
(
s
);

5284 i‡(
hsz
 == 124) {

5285 
	`°bi__gë32À
(
s
);

5286 
	`°bi__gë32À
(
s
);

5287 
	`°bi__gë32À
(
s
);

5288 
	`°bi__gë32À
(
s
);

5293 
	}
}

5296 *
	$°bi__bmp_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5298 
°bi_uc
 *
out
;

5299 
mr
=0,
mg
=0,
mb
=0,
ma
=0, 
Æl_a
;

5300 
°bi_uc
 
∑l
[256][4];

5301 
psize
=0,
i
,
j
,
width
;

5302 
Êù_vîtiˇŒy
, 
∑d
, 
èrgë
;

5303 
°bi__bmp_d©a
 
öfo
;

5304 
	`STBI_NOTUSED
(
ri
);

5306 
öfo
.
Æl_a
 = 255;

5307 i‡(
	`°bi__bmp_∑r£_hódî
(
s
, &
öfo
Ë=
NULL
)

5308  
NULL
;

5310 
Êù_vîtiˇŒy
 = ((Ë
s
->
img_y
) > 0;

5311 
s
->
img_y
 = 
	`abs
(() s->img_y);

5313 
mr
 = 
öfo
.mr;

5314 
mg
 = 
öfo
.mg;

5315 
mb
 = 
öfo
.mb;

5316 
ma
 = 
öfo
.ma;

5317 
Æl_a
 = 
öfo
.all_a;

5319 i‡(
öfo
.
hsz
 == 12) {

5320 i‡(
öfo
.
bµ
 < 24)

5321 
psize
 = (
öfo
.
off£t
 - info.
exåa_ªad
 - 24) / 3;

5323 i‡(
öfo
.
bµ
 < 16)

5324 
psize
 = (
öfo
.
off£t
 - info.
exåa_ªad
 - info.
hsz
) >> 2;

5326 i‡(
psize
 == 0) {

5327 
	`STBI_ASSERT
(
öfo
.
off£t
 =(
s
->
img_buf„r
 - s->
buf„r_°¨t
));

5330 i‡(
öfo
.
bµ
 =24 && 
ma
 == 0xff000000)

5331 
s
->
img_n
 = 3;

5333 
s
->
img_n
 = 
ma
 ? 4 : 3;

5334 i‡(
ªq_comp
 &&Ñeq_comp >= 3)

5335 
èrgë
 = 
ªq_comp
;

5337 
èrgë
 = 
s
->
img_n
;

5340 i‡(!
	`°bi__mad3sizes_vÆid
(
èrgë
, 
s
->
img_x
, s->
img_y
, 0))

5341  
	`°bi__îΩuc
("tooÜarge", "Corrupt BMP");

5343 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
èrgë
, 
s
->
img_x
, s->
img_y
, 0);

5344 i‡(!
out
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

5345 i‡(
öfo
.
bµ
 < 16) {

5346 
z
=0;

5347 i‡(
psize
 =0 ||Ösizê> 256Ë{ 
	`STBI_FREE
(
out
);  
	`°bi__îΩuc
("invalid", "Corrupt BMP"); }

5348 
i
=0; i < 
psize
; ++i) {

5349 
∑l
[
i
][2] = 
	`°bi__gë8
(
s
);

5350 
∑l
[
i
][1] = 
	`°bi__gë8
(
s
);

5351 
∑l
[
i
][0] = 
	`°bi__gë8
(
s
);

5352 i‡(
öfo
.
hsz
 !12Ë
	`°bi__gë8
(
s
);

5353 
∑l
[
i
][3] = 255;

5355 
	`°bi__skù
(
s
, 
öfo
.
off£t
 - info.
exåa_ªad
 - info.
hsz
 - 
psize
 * (info.hsz == 12 ? 3 : 4));

5356 i‡(
öfo
.
bµ
 =1Ë
width
 = (
s
->
img_x
 + 7) >> 3;

5357 i‡(
öfo
.
bµ
 =4Ë
width
 = (
s
->
img_x
 + 1) >> 1;

5358 i‡(
öfo
.
bµ
 =8Ë
width
 = 
s
->
img_x
;

5359 { 
	`STBI_FREE
(
out
);  
	`°bi__îΩuc
("bad bpp", "Corrupt BMP"); }

5360 
∑d
 = (-
width
)&3;

5361 i‡(
öfo
.
bµ
 == 1) {

5362 
j
=0; j < (Ë
s
->
img_y
; ++j) {

5363 
bô_off£t
 = 7, 
v
 = 
	`°bi__gë8
(
s
);

5364 
i
=0; i < (Ë
s
->
img_x
; ++i) {

5365 
cﬁ‹
 = (
v
>>
bô_off£t
)&0x1;

5366 
out
[
z
++] = 
∑l
[
cﬁ‹
][0];

5367 
out
[
z
++] = 
∑l
[
cﬁ‹
][1];

5368 
out
[
z
++] = 
∑l
[
cﬁ‹
][2];

5369 i‡(
èrgë
 =4Ë
out
[
z
++] = 255;

5370 i‡(
i
+1 =(Ë
s
->
img_x
) ;

5371 if((--
bô_off£t
) < 0) {

5372 
bô_off£t
 = 7;

5373 
v
 = 
	`°bi__gë8
(
s
);

5376 
	`°bi__skù
(
s
, 
∑d
);

5379 
j
=0; j < (Ë
s
->
img_y
; ++j) {

5380 
i
=0; i < (Ë
s
->
img_x
; i += 2) {

5381 
v
=
	`°bi__gë8
(
s
),
v2
=0;

5382 i‡(
öfo
.
bµ
 == 4) {

5383 
v2
 = 
v
 & 15;

5384 
v
 >>= 4;

5386 
out
[
z
++] = 
∑l
[
v
][0];

5387 
out
[
z
++] = 
∑l
[
v
][1];

5388 
out
[
z
++] = 
∑l
[
v
][2];

5389 i‡(
èrgë
 =4Ë
out
[
z
++] = 255;

5390 i‡(
i
+1 =(Ë
s
->
img_x
) ;

5391 
v
 = (
öfo
.
bµ
 =8Ë? 
	`°bi__gë8
(
s
Ë: 
v2
;

5392 
out
[
z
++] = 
∑l
[
v
][0];

5393 
out
[
z
++] = 
∑l
[
v
][1];

5394 
out
[
z
++] = 
∑l
[
v
][2];

5395 i‡(
èrgë
 =4Ë
out
[
z
++] = 255;

5397 
	`°bi__skù
(
s
, 
∑d
);

5401 
rshi·
=0,
gshi·
=0,
bshi·
=0,
ashi·
=0,
rcou¡
=0,
gcou¡
=0,
bcou¡
=0,
acou¡
=0;

5402 
z
 = 0;

5403 
ósy
=0;

5404 
	`°bi__skù
(
s
, 
öfo
.
off£t
 - info.
exåa_ªad
 - info.
hsz
);

5405 i‡(
öfo
.
bµ
 =24Ë
width
 = 3 * 
s
->
img_x
;

5406 i‡(
öfo
.
bµ
 =16Ë
width
 = 2*
s
->
img_x
;

5407 
width
=0;

5408 
∑d
 = (-
width
) & 3;

5409 i‡(
öfo
.
bµ
 == 24) {

5410 
ósy
 = 1;

5411 } i‡(
öfo
.
bµ
 == 32) {

5412 i‡(
mb
 =0xf‡&& 
mg
 =0xff00 && 
mr
 =0x00ff0000 && 
ma
 == 0xff000000)

5413 
ósy
 = 2;

5415 i‡(!
ósy
) {

5416 i‡(!
mr
 || !
mg
 || !
mb
Ë{ 
	`STBI_FREE
(
out
);  
	`°bi__îΩuc
("bad masks", "Corrupt BMP"); }

5418 
rshi·
 = 
	`°bi__high_bô
(
mr
)-7; 
rcou¡
 = 
	`°bi__bôcou¡
(mr);

5419 
gshi·
 = 
	`°bi__high_bô
(
mg
)-7; 
gcou¡
 = 
	`°bi__bôcou¡
(mg);

5420 
bshi·
 = 
	`°bi__high_bô
(
mb
)-7; 
bcou¡
 = 
	`°bi__bôcou¡
(mb);

5421 
ashi·
 = 
	`°bi__high_bô
(
ma
)-7; 
acou¡
 = 
	`°bi__bôcou¡
(ma);

5423 
j
=0; j < (Ë
s
->
img_y
; ++j) {

5424 i‡(
ósy
) {

5425 
i
=0; i < (Ë
s
->
img_x
; ++i) {

5426 
a
;

5427 
out
[
z
+2] = 
	`°bi__gë8
(
s
);

5428 
out
[
z
+1] = 
	`°bi__gë8
(
s
);

5429 
out
[
z
+0] = 
	`°bi__gë8
(
s
);

5430 
z
 += 3;

5431 
a
 = (
ósy
 =2 ? 
	`°bi__gë8
(
s
) : 255);

5432 
Æl_a
 |
a
;

5433 i‡(
èrgë
 =4Ë
out
[
z
++] = 
a
;

5436 
bµ
 = 
öfo
.bpp;

5437 
i
=0; i < (Ë
s
->
img_x
; ++i) {

5438 
°bi__uöt32
 
v
 = (
bµ
 =16 ? (°bi__uöt32Ë
	`°bi__gë16À
(
s
Ë: 
	`°bi__gë32À
(s));

5439 
a
;

5440 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`°bi__shi·sig√d
(
v
 & 
mr
, 
rshi·
, 
rcou¡
));

5441 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`°bi__shi·sig√d
(
v
 & 
mg
, 
gshi·
, 
gcou¡
));

5442 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`°bi__shi·sig√d
(
v
 & 
mb
, 
bshi·
, 
bcou¡
));

5443 
a
 = (
ma
 ? 
	`°bi__shi·sig√d
(
v
 & ma, 
ashi·
, 
acou¡
) : 255);

5444 
Æl_a
 |
a
;

5445 i‡(
èrgë
 =4Ë
out
[
z
++] = 
	`STBI__BYTECAST
(
a
);

5448 
	`°bi__skù
(
s
, 
∑d
);

5453 i‡(
èrgë
 =4 && 
Æl_a
 == 0)

5454 
i
=4*
s
->
img_x
*s->
img_y
-1; i >= 0; i -= 4)

5455 
out
[
i
] = 255;

5457 i‡(
Êù_vîtiˇŒy
) {

5458 
°bi_uc
 
t
;

5459 
j
=0; j < (Ë
s
->
img_y
>>1; ++j) {

5460 
°bi_uc
 *
p1
 = 
out
 + 
j
 *
s
->
img_x
*
èrgë
;

5461 
°bi_uc
 *
p2
 = 
out
 + (
s
->
img_y
-1-
j
)*s->
img_x
*
èrgë
;

5462 
i
=0; i < (Ë
s
->
img_x
*
èrgë
; ++i) {

5463 
t
 = 
p1
[
i
];Ö1[i] = 
p2
[i];Ö2[i] =Å;

5468 i‡(
ªq_comp
 &&Ñeq_com∞!
èrgë
) {

5469 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 
èrgë
, 
ªq_comp
, 
s
->
img_x
, s->
img_y
);

5470 i‡(
out
 =
NULL
)  out;

5473 *
x
 = 
s
->
img_x
;

5474 *
y
 = 
s
->
img_y
;

5475 i‡(
comp
Ë*com∞
s
->
img_n
;

5476  
out
;

5477 
	}
}

5482 #i‚de‡
STBI_NO_TGA


5484 
	$°bi__tga_gë_comp
(
bôs_≥r_pixñ
, 
is_gªy
, * 
is_rgb16
)

5487 i‡(
is_rgb16
) *is_rgb16 = 0;

5488 
bôs_≥r_pixñ
) {

5489 8:  
STBI_gªy
;

5490 16: if(
is_gªy
Ë 
STBI_gªy_Æpha
;

5492 15: if(
is_rgb16
) *is_rgb16 = 1;

5493  
STBI_rgb
;

5495 32:  
bôs_≥r_pixñ
/8;

5498 
	}
}

5500 
	$°bi__tga_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

5502 
tga_w
, 
tga_h
, 
tga_comp
, 
tga_image_ty≥
, 
tga_bôs_≥r_pixñ
, 
tga_cﬁ‹m≠_bµ
;

5503 
sz
, 
tga_cﬁ‹m≠_ty≥
;

5504 
	`°bi__gë8
(
s
);

5505 
tga_cﬁ‹m≠_ty≥
 = 
	`°bi__gë8
(
s
);

5506 if–
tga_cﬁ‹m≠_ty≥
 > 1 ) {

5507 
	`°bi__ªwöd
(
s
);

5510 
tga_image_ty≥
 = 
	`°bi__gë8
(
s
);

5511 i‡–
tga_cﬁ‹m≠_ty≥
 == 1 ) {

5512 i‡(
tga_image_ty≥
 != 1 &&Åga_image_type != 9) {

5513 
	`°bi__ªwöd
(
s
);

5516 
	`°bi__skù
(
s
,4);

5517 
sz
 = 
	`°bi__gë8
(
s
);

5518 i‡–(
sz
 != 8) && (sz != 15) && (sz != 16) && (sz != 24) && (sz != 32) ) {

5519 
	`°bi__ªwöd
(
s
);

5522 
	`°bi__skù
(
s
,4);

5523 
tga_cﬁ‹m≠_bµ
 = 
sz
;

5525 i‡–(
tga_image_ty≥
 != 2) && (tga_image_type != 3) && (tga_image_type != 10) && (tga_image_type != 11) ) {

5526 
	`°bi__ªwöd
(
s
);

5529 
	`°bi__skù
(
s
,9);

5530 
tga_cﬁ‹m≠_bµ
 = 0;

5532 
tga_w
 = 
	`°bi__gë16À
(
s
);

5533 if–
tga_w
 < 1 ) {

5534 
	`°bi__ªwöd
(
s
);

5537 
tga_h
 = 
	`°bi__gë16À
(
s
);

5538 if–
tga_h
 < 1 ) {

5539 
	`°bi__ªwöd
(
s
);

5542 
tga_bôs_≥r_pixñ
 = 
	`°bi__gë8
(
s
);

5543 
	`°bi__gë8
(
s
);

5544 i‡(
tga_cﬁ‹m≠_bµ
 != 0) {

5545 if((
tga_bôs_≥r_pixñ
 != 8) && (tga_bits_per_pixel != 16)) {

5548 
	`°bi__ªwöd
(
s
);

5551 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_cﬁ‹m≠_bµ
, 0, 
NULL
);

5553 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_bôs_≥r_pixñ
, (
tga_image_ty≥
 =3Ë|| (tga_image_ty≥ =11), 
NULL
);

5555 if(!
tga_comp
) {

5556 
	`°bi__ªwöd
(
s
);

5559 i‡(
x
Ë*x = 
tga_w
;

5560 i‡(
y
Ë*y = 
tga_h
;

5561 i‡(
comp
Ë*com∞
tga_comp
;

5563 
	}
}

5565 
	$°bi__tga_ã°
(
°bi__c⁄ãxt
 *
s
)

5567 
ªs
 = 0;

5568 
sz
, 
tga_cﬁ‹_ty≥
;

5569 
	`°bi__gë8
(
s
);

5570 
tga_cﬁ‹_ty≥
 = 
	`°bi__gë8
(
s
);

5571 i‡–
tga_cﬁ‹_ty≥
 > 1 ) 
îr‹End
;

5572 
sz
 = 
	`°bi__gë8
(
s
);

5573 i‡–
tga_cﬁ‹_ty≥
 == 1 ) {

5574 i‡(
sz
 !1 && sz !9Ë
îr‹End
;

5575 
	`°bi__skù
(
s
,4);

5576 
sz
 = 
	`°bi__gë8
(
s
);

5577 i‡–(
sz
 !8Ë&& (sz !15Ë&& (sz !16Ë&& (sz !24Ë&& (sz !32ËË
îr‹End
;

5578 
	`°bi__skù
(
s
,4);

5580 i‡–(
sz
 !2Ë&& (sz !3Ë&& (sz !10Ë&& (sz !11ËË
îr‹End
;

5581 
	`°bi__skù
(
s
,9);

5583 i‡–
	`°bi__gë16À
(
s
Ë< 1 ) 
îr‹End
;

5584 i‡–
	`°bi__gë16À
(
s
Ë< 1 ) 
îr‹End
;

5585 
sz
 = 
	`°bi__gë8
(
s
);

5586 i‡–(
tga_cﬁ‹_ty≥
 =1Ë&& (
sz
 !8Ë&& (sz !16ËË
îr‹End
;

5587 i‡–(
sz
 !8Ë&& (sz !15Ë&& (sz !16Ë&& (sz !24Ë&& (sz !32ËË
îr‹End
;

5589 
ªs
 = 1;

5591 
îr‹End
:

5592 
	`°bi__ªwöd
(
s
);

5593  
ªs
;

5594 
	}
}

5597 
	$°bi__tga_ªad_rgb16
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
* 
out
)

5599 
°bi__uöt16
 
px
 = (°bi__uöt16)
	`°bi__gë16À
(
s
);

5600 
°bi__uöt16
 
fiveBôMask
 = 31;

5602 
r
 = (
px
 >> 10Ë& 
fiveBôMask
;

5603 
g
 = (
px
 >> 5Ë& 
fiveBôMask
;

5604 
b
 = 
px
 & 
fiveBôMask
;

5606 
out
[0] = (
°bi_uc
)((
r
 * 255)/31);

5607 
out
[1] = (
°bi_uc
)((
g
 * 255)/31);

5608 
out
[2] = (
°bi_uc
)((
b
 * 255)/31);

5614 
	}
}

5616 *
	$°bi__tga_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5619 
tga_off£t
 = 
	`°bi__gë8
(
s
);

5620 
tga_ödexed
 = 
	`°bi__gë8
(
s
);

5621 
tga_image_ty≥
 = 
	`°bi__gë8
(
s
);

5622 
tga_is_RLE
 = 0;

5623 
tga_∑Àâe_°¨t
 = 
	`°bi__gë16À
(
s
);

5624 
tga_∑Àâe_Àn
 = 
	`°bi__gë16À
(
s
);

5625 
tga_∑Àâe_bôs
 = 
	`°bi__gë8
(
s
);

5626 
tga_x_‹igö
 = 
	`°bi__gë16À
(
s
);

5627 
tga_y_‹igö
 = 
	`°bi__gë16À
(
s
);

5628 
tga_width
 = 
	`°bi__gë16À
(
s
);

5629 
tga_height
 = 
	`°bi__gë16À
(
s
);

5630 
tga_bôs_≥r_pixñ
 = 
	`°bi__gë8
(
s
);

5631 
tga_comp
, 
tga_rgb16
=0;

5632 
tga_övîãd
 = 
	`°bi__gë8
(
s
);

5635 *
tga_d©a
;

5636 *
tga_∑Àâe
 = 
NULL
;

5637 
i
, 
j
;

5638 
øw_d©a
[4] = {0};

5639 
RLE_cou¡
 = 0;

5640 
RLE_ª≥©ög
 = 0;

5641 
ªad_√xt_pixñ
 = 1;

5642 
	`STBI_NOTUSED
(
ri
);

5643 
	`STBI_NOTUSED
(
tga_x_‹igö
);

5644 
	`STBI_NOTUSED
(
tga_y_‹igö
);

5647 i‡–
tga_image_ty≥
 >= 8 )

5649 
tga_image_ty≥
 -= 8;

5650 
tga_is_RLE
 = 1;

5652 
tga_övîãd
 = 1 - ((tga_inverted >> 5) & 1);

5655 i‡–
tga_ödexed
 ) 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_∑Àâe_bôs
, 0, &
tga_rgb16
);

5656 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_bôs_≥r_pixñ
, (
tga_image_ty≥
 =3), &
tga_rgb16
);

5658 if(!
tga_comp
)

5659  
	`°bi__îΩuc
("bad format", "Can't find out TGAÖixelformat");

5662 *
x
 = 
tga_width
;

5663 *
y
 = 
tga_height
;

5664 i‡(
comp
Ë*com∞
tga_comp
;

5666 i‡(!
	`°bi__mad3sizes_vÆid
(
tga_width
, 
tga_height
, 
tga_comp
, 0))

5667  
	`°bi__îΩuc
("tooÜarge", "Corrupt TGA");

5669 
tga_d©a
 = (*)
	`°bi__mÆloc_mad3
(
tga_width
, 
tga_height
, 
tga_comp
, 0);

5670 i‡(!
tga_d©a
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

5673 
	`°bi__skù
(
s
, 
tga_off£t
 );

5675 i‡–!
tga_ödexed
 && !
tga_is_RLE
 && !
tga_rgb16
 ) {

5676 
i
=0; i < 
tga_height
; ++i) {

5677 
row
 = 
tga_övîãd
 ? 
tga_height
 -
i
 - 1 : i;

5678 
°bi_uc
 *
tga_row
 = 
tga_d©a
 + 
row
*
tga_width
*
tga_comp
;

5679 
	`°bi__gën
(
s
, 
tga_row
, 
tga_width
 * 
tga_comp
);

5683 i‡–
tga_ödexed
)

5686 
	`°bi__skù
(
s
, 
tga_∑Àâe_°¨t
 );

5688 
tga_∑Àâe
 = (*)
	`°bi__mÆloc_mad2
(
tga_∑Àâe_Àn
, 
tga_comp
, 0);

5689 i‡(!
tga_∑Àâe
) {

5690 
	`STBI_FREE
(
tga_d©a
);

5691  
	`°bi__îΩuc
("outofmem", "Out of memory");

5693 i‡(
tga_rgb16
) {

5694 
°bi_uc
 *
∑l_íåy
 = 
tga_∑Àâe
;

5695 
	`STBI_ASSERT
(
tga_comp
 =
STBI_rgb
);

5696 
i
=0; i < 
tga_∑Àâe_Àn
; ++i) {

5697 
	`°bi__tga_ªad_rgb16
(
s
, 
∑l_íåy
);

5698 
∑l_íåy
 +
tga_comp
;

5700 } i‡(!
	`°bi__gën
(
s
, 
tga_∑Àâe
, 
tga_∑Àâe_Àn
 * 
tga_comp
)) {

5701 
	`STBI_FREE
(
tga_d©a
);

5702 
	`STBI_FREE
(
tga_∑Àâe
);

5703  
	`°bi__îΩuc
("badÖalette", "Corrupt TGA");

5707 
i
=0; i < 
tga_width
 * 
tga_height
; ++i)

5710 i‡–
tga_is_RLE
 )

5712 i‡–
RLE_cou¡
 == 0 )

5715 
RLE_cmd
 = 
	`°bi__gë8
(
s
);

5716 
RLE_cou¡
 = 1 + (
RLE_cmd
 & 127);

5717 
RLE_ª≥©ög
 = 
RLE_cmd
 >> 7;

5718 
ªad_√xt_pixñ
 = 1;

5719 } i‡–!
RLE_ª≥©ög
 )

5721 
ªad_√xt_pixñ
 = 1;

5725 
ªad_√xt_pixñ
 = 1;

5728 i‡–
ªad_√xt_pixñ
 )

5731 i‡–
tga_ödexed
 )

5734 
∑l_idx
 = (
tga_bôs_≥r_pixñ
 =8Ë? 
	`°bi__gë8
(
s
Ë: 
	`°bi__gë16À
(s);

5735 i‡–
∑l_idx
 >
tga_∑Àâe_Àn
 ) {

5737 
∑l_idx
 = 0;

5739 
∑l_idx
 *
tga_comp
;

5740 
j
 = 0; j < 
tga_comp
; ++j) {

5741 
øw_d©a
[
j
] = 
tga_∑Àâe
[
∑l_idx
+j];

5743 } if(
tga_rgb16
) {

5744 
	`STBI_ASSERT
(
tga_comp
 =
STBI_rgb
);

5745 
	`°bi__tga_ªad_rgb16
(
s
, 
øw_d©a
);

5748 
j
 = 0; j < 
tga_comp
; ++j) {

5749 
øw_d©a
[
j
] = 
	`°bi__gë8
(
s
);

5753 
ªad_√xt_pixñ
 = 0;

5757 
j
 = 0; j < 
tga_comp
; ++j)

5758 
tga_d©a
[
i
*
tga_comp
+
j
] = 
øw_d©a
[j];

5761 --
RLE_cou¡
;

5764 i‡–
tga_övîãd
 )

5766 
j
 = 0; j*2 < 
tga_height
; ++j)

5768 
ödex1
 = 
j
 * 
tga_width
 * 
tga_comp
;

5769 
ödex2
 = (
tga_height
 - 1 - 
j
Ë* 
tga_width
 * 
tga_comp
;

5770 
i
 = 
tga_width
 * 
tga_comp
; i > 0; --i)

5772 
ãmp
 = 
tga_d©a
[
ödex1
];

5773 
tga_d©a
[
ödex1
] =Åga_d©a[
ödex2
];

5774 
tga_d©a
[
ödex2
] = 
ãmp
;

5775 ++
ödex1
;

5776 ++
ödex2
;

5781 i‡–
tga_∑Àâe
 !
NULL
 )

5783 
	`STBI_FREE
–
tga_∑Àâe
 );

5788 i‡(
tga_comp
 >3 && !
tga_rgb16
)

5790 * 
tga_pixñ
 = 
tga_d©a
;

5791 
i
=0; i < 
tga_width
 * 
tga_height
; ++i)

5793 
ãmp
 = 
tga_pixñ
[0];

5794 
tga_pixñ
[0] =Åga_pixel[2];

5795 
tga_pixñ
[2] = 
ãmp
;

5796 
tga_pixñ
 +
tga_comp
;

5801 i‡(
ªq_comp
 &&Ñeq_com∞!
tga_comp
)

5802 
tga_d©a
 = 
	`°bi__c⁄vît_f‹m©
—ga_d©a, 
tga_comp
, 
ªq_comp
, 
tga_width
, 
tga_height
);

5806 
tga_∑Àâe_°¨t
 = 
tga_∑Àâe_Àn
 = 
tga_∑Àâe_bôs
 =

5807 
tga_x_‹igö
 = 
tga_y_‹igö
 = 0;

5808 
	`STBI_NOTUSED
(
tga_∑Àâe_°¨t
);

5810  
tga_d©a
;

5811 
	}
}

5817 #i‚de‡
STBI_NO_PSD


5818 
	$°bi__psd_ã°
(
°bi__c⁄ãxt
 *
s
)

5820 
r
 = (
	`°bi__gë32be
(
s
) == 0x38425053);

5821 
	`°bi__ªwöd
(
s
);

5822  
r
;

5823 
	}
}

5825 
	$°bi__psd_decode_æe
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 *
p
, 
pixñCou¡
)

5827 
cou¡
, 
∆e·
, 
Àn
;

5829 
cou¡
 = 0;

5830 (
∆e·
 = 
pixñCou¡
 - 
cou¡
) > 0) {

5831 
Àn
 = 
	`°bi__gë8
(
s
);

5832 i‡(
Àn
 == 128) {

5834 } i‡(
Àn
 < 128) {

5836 
Àn
++;

5837 i‡(
Àn
 > 
∆e·
)  0;

5838 
cou¡
 +
Àn
;

5839 
Àn
) {

5840 *
p
 = 
	`°bi__gë8
(
s
);

5841 
p
 += 4;

5842 
Àn
--;

5844 } i‡(
Àn
 > 128) {

5845 
°bi_uc
 
vÆ
;

5848 
Àn
 = 257 -Üen;

5849 i‡(
Àn
 > 
∆e·
)  0;

5850 
vÆ
 = 
	`°bi__gë8
(
s
);

5851 
cou¡
 +
Àn
;

5852 
Àn
) {

5853 *
p
 = 
vÆ
;

5854 
p
 += 4;

5855 
Àn
--;

5861 
	}
}

5863 *
	$°bi__psd_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
, 
bpc
)

5865 
pixñCou¡
;

5866 
ch™√lCou¡
, 
com¥essi⁄
;

5867 
ch™√l
, 
i
;

5868 
bôdïth
;

5869 
w
,
h
;

5870 
°bi_uc
 *
out
;

5871 
	`STBI_NOTUSED
(
ri
);

5874 i‡(
	`°bi__gë32be
(
s
) != 0x38425053)

5875  
	`°bi__îΩuc
("not PSD", "Corrupt PSD image");

5878 i‡(
	`°bi__gë16be
(
s
) != 1)

5879  
	`°bi__îΩuc
("wrong version", "Unsupported version of PSD image");

5882 
	`°bi__skù
(
s
, 6 );

5885 
ch™√lCou¡
 = 
	`°bi__gë16be
(
s
);

5886 i‡(
ch™√lCou¡
 < 0 || channelCount > 16)

5887  
	`°bi__îΩuc
("wrong channel count", "UnsupportedÇumber of channels in PSD image");

5890 
h
 = 
	`°bi__gë32be
(
s
);

5891 
w
 = 
	`°bi__gë32be
(
s
);

5894 
bôdïth
 = 
	`°bi__gë16be
(
s
);

5895 i‡(
bôdïth
 != 8 && bitdepth != 16)

5896  
	`°bi__îΩuc
("unsupported bit depth", "PSD bit depth isÇot 8 or 16 bit");

5908 i‡(
	`°bi__gë16be
(
s
) != 3)

5909  
	`°bi__îΩuc
("wrong color format", "PSD isÇot in RGB color format");

5912 
	`°bi__skù
(
s
,
	`°bi__gë32be
(s) );

5915 
	`°bi__skù
(
s
, 
	`°bi__gë32be
(s) );

5918 
	`°bi__skù
(
s
, 
	`°bi__gë32be
(s) );

5924 
com¥essi⁄
 = 
	`°bi__gë16be
(
s
);

5925 i‡(
com¥essi⁄
 > 1)

5926  
	`°bi__îΩuc
("bad compression", "PSD hasán unknown compression format");

5929 i‡(!
	`°bi__mad3sizes_vÆid
(4, 
w
, 
h
, 0))

5930  
	`°bi__îΩuc
("tooÜarge", "Corrupt PSD");

5934 i‡(!
com¥essi⁄
 && 
bôdïth
 =16 && 
bpc
 == 16) {

5935 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(8, 
w
, 
h
, 0);

5936 
ri
->
bôs_≥r_ch™√l
 = 16;

5938 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(4 * 
w
*
h
);

5940 i‡(!
out
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

5941 
pixñCou¡
 = 
w
*
h
;

5947 i‡(
com¥essi⁄
) {

5958 
	`°bi__skù
(
s
, 
h
 * 
ch™√lCou¡
 * 2 );

5961 
ch™√l
 = 0; channel < 4; channel++) {

5962 
°bi_uc
 *
p
;

5964 
p
 = 
out
+
ch™√l
;

5965 i‡(
ch™√l
 >
ch™√lCou¡
) {

5967 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

5968 *
p
 = (
ch™√l
 == 3 ? 255 : 0);

5971 i‡(!
	`°bi__psd_decode_æe
(
s
, 
p
, 
pixñCou¡
)) {

5972 
	`STBI_FREE
(
out
);

5973  
	`°bi__îΩuc
("corrupt", "bad RLEÖiece_data");

5983 
ch™√l
 = 0; channel < 4; channel++) {

5984 i‡(
ch™√l
 >
ch™√lCou¡
) {

5986 i‡(
bôdïth
 =16 && 
bpc
 == 16) {

5987 
°bi__uöt16
 *
q
 = ((°bi__uöt16 *Ë
out
Ë+ 
ch™√l
;

5988 
°bi__uöt16
 
vÆ
 = 
ch™√l
 == 3 ? 65535 : 0;

5989 
i
 = 0; i < 
pixñCou¡
; i++, 
q
 += 4)

5990 *
q
 = 
vÆ
;

5992 
°bi_uc
 *
p
 = 
out
+
ch™√l
;

5993 
°bi_uc
 
vÆ
 = 
ch™√l
 == 3 ? 255 : 0;

5994 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

5995 *
p
 = 
vÆ
;

5998 i‡(
ri
->
bôs_≥r_ch™√l
 == 16) {

5999 
°bi__uöt16
 *
q
 = ((°bi__uöt16 *Ë
out
Ë+ 
ch™√l
;

6000 
i
 = 0; i < 
pixñCou¡
; i++, 
q
 += 4)

6001 *
q
 = (
°bi__uöt16
Ë
	`°bi__gë16be
(
s
);

6003 
°bi_uc
 *
p
 = 
out
+
ch™√l
;

6004 i‡(
bôdïth
 == 16) {

6005 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

6006 *
p
 = (
°bi_uc
Ë(
	`°bi__gë16be
(
s
) >> 8);

6008 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

6009 *
p
 = 
	`°bi__gë8
(
s
);

6017 i‡(
ch™√lCou¡
 >= 4) {

6018 i‡(
ri
->
bôs_≥r_ch™√l
 == 16) {

6019 
i
=0; i < 
w
*
h
; ++i) {

6020 
°bi__uöt16
 *
pixñ
 = (°bi__uöt16 *Ë
out
 + 4*
i
;

6021 i‡(
pixñ
[3] != 0 &&Öixel[3] != 65535) {

6022 
a
 = 
pixñ
[3] / 65535.0f;

6023 
ø
 = 1.0‡/ 
a
;

6024 
öv_a
 = 65535.0‡* (1 - 
ø
);

6025 
pixñ
[0] = (
°bi__uöt16
Ë’ixñ[0]*
ø
 + 
öv_a
);

6026 
pixñ
[1] = (
°bi__uöt16
Ë’ixñ[1]*
ø
 + 
öv_a
);

6027 
pixñ
[2] = (
°bi__uöt16
Ë’ixñ[2]*
ø
 + 
öv_a
);

6031 
i
=0; i < 
w
*
h
; ++i) {

6032 *
pixñ
 = 
out
 + 4*
i
;

6033 i‡(
pixñ
[3] != 0 &&Öixel[3] != 255) {

6034 
a
 = 
pixñ
[3] / 255.0f;

6035 
ø
 = 1.0‡/ 
a
;

6036 
öv_a
 = 255.0‡* (1 - 
ø
);

6037 
pixñ
[0] = (Ë’ixñ[0]*
ø
 + 
öv_a
);

6038 
pixñ
[1] = (Ë’ixñ[1]*
ø
 + 
öv_a
);

6039 
pixñ
[2] = (Ë’ixñ[2]*
ø
 + 
öv_a
);

6046 i‡(
ªq_comp
 &&Ñeq_comp != 4) {

6047 i‡(
ri
->
bôs_≥r_ch™√l
 == 16)

6048 
out
 = (
°bi_uc
 *Ë
	`°bi__c⁄vît_f‹m©16
((
°bi__uöt16
 *Ëout, 4, 
ªq_comp
, 
w
, 
h
);

6050 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 4, 
ªq_comp
, 
w
, 
h
);

6051 i‡(
out
 =
NULL
)  out;

6054 i‡(
comp
) *comp = 4;

6055 *
y
 = 
h
;

6056 *
x
 = 
w
;

6058  
out
;

6059 
	}
}

6069 #i‚de‡
STBI_NO_PIC


6070 
	$°bi__pic_is4
(
°bi__c⁄ãxt
 *
s
,c⁄° *
°r
)

6072 
i
;

6073 
i
=0; i<4; ++i)

6074 i‡(
	`°bi__gë8
(
s
Ë!(
°bi_uc
)
°r
[
i
])

6078 
	}
}

6080 
	$°bi__pic_ã°_c‹e
(
°bi__c⁄ãxt
 *
s
)

6082 
i
;

6084 i‡(!
	`°bi__pic_is4
(
s
,"\x53\x80\xF6\x34"))

6087 
i
=0;i<84;++i)

6088 
	`°bi__gë8
(
s
);

6090 i‡(!
	`°bi__pic_is4
(
s
,"PICT"))

6094 
	}
}

6098 
°bi_uc
 
	msize
,
	mty≥
,
	mch™√l
;

6099 } 
	t°bi__pic_∑ckë
;

6101 
°bi_uc
 *
	$°bi__ªadvÆ
(
°bi__c⁄ãxt
 *
s
, 
ch™√l
, 
°bi_uc
 *
de°
)

6103 
mask
=0x80, 
i
;

6105 
i
=0; i<4; ++i, 
mask
>>=1) {

6106 i‡(
ch™√l
 & 
mask
) {

6107 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","PIC fileÅoo short");

6108 
de°
[
i
]=
	`°bi__gë8
(
s
);

6112  
de°
;

6113 
	}
}

6115 
	$°bi__c›yvÆ
(
ch™√l
,
°bi_uc
 *
de°
,c⁄° stbi_u¯*
§c
)

6117 
mask
=0x80,
i
;

6119 
i
=0;i<4; ++i, 
mask
>>=1)

6120 i‡(
ch™√l
&
mask
)

6121 
de°
[
i
]=
§c
[i];

6122 
	}
}

6124 
°bi_uc
 *
	$°bi__pic_lﬂd_c‹e
(
°bi__c⁄ãxt
 *
s
,
width
,
height
,*
comp
, 
°bi_uc
 *
ªsu…
)

6126 
a˘_comp
=0,
num_∑ckës
=0,
y
,
chaöed
;

6127 
°bi__pic_∑ckë
 
∑ckës
[10];

6132 
°bi__pic_∑ckë
 *
∑ckë
;

6134 i‡(
num_∑ckës
==(
∑ckës
)/(packets[0]))

6135  
	`°bi__îΩuc
("bad format","too manyÖackets");

6137 
∑ckë
 = &
∑ckës
[
num_∑ckës
++];

6139 
chaöed
 = 
	`°bi__gë8
(
s
);

6140 
∑ckë
->
size
 = 
	`°bi__gë8
(
s
);

6141 
∑ckë
->
ty≥
 = 
	`°bi__gë8
(
s
);

6142 
∑ckë
->
ch™√l
 = 
	`°bi__gë8
(
s
);

6144 
a˘_comp
 |
∑ckë
->
ch™√l
;

6146 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (readingÖackets)");

6147 i‡(
∑ckë
->
size
 !8Ë 
	`°bi__îΩuc
("bad format","packet isn't 8bpp");

6148 } 
chaöed
);

6150 *
comp
 = (
a˘_comp
 & 0x10 ? 4 : 3);

6152 
y
=0; y<
height
; ++y) {

6153 
∑ckë_idx
;

6155 
∑ckë_idx
=0;Öackë_idx < 
num_∑ckës
; ++packet_idx) {

6156 
°bi__pic_∑ckë
 *
∑ckë
 = &
∑ckës
[
∑ckë_idx
];

6157 
°bi_uc
 *
de°
 = 
ªsu…
+
y
*
width
*4;

6159 
∑ckë
->
ty≥
) {

6161  
	`°bi__îΩuc
("bad format","packet has bad compressionÅype");

6164 
x
;

6166 
x
=0;x<
width
;++x, 
de°
+=4)

6167 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
de°
))

6174 
À·
=
width
, 
i
;

6176 
À·
>0) {

6177 
°bi_uc
 
cou¡
,
vÆue
[4];

6179 
cou¡
=
	`°bi__gë8
(
s
);

6180 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (pureÑead count)");

6182 i‡(
cou¡
 > 
À·
)

6183 
cou¡
 = (
°bi_uc
Ë
À·
;

6185 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
vÆue
))  0;

6187 
i
=0; i<
cou¡
; ++i,
de°
+=4)

6188 
	`°bi__c›yvÆ
(
∑ckë
->
ch™√l
,
de°
,
vÆue
);

6189 
À·
 -
cou¡
;

6195 
À·
=
width
;

6196 
À·
>0) {

6197 
cou¡
 = 
	`°bi__gë8
(
s
), 
i
;

6198 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (mixedÑead count)");

6200 i‡(
cou¡
 >= 128) {

6201 
°bi_uc
 
vÆue
[4];

6203 i‡(
cou¡
==128)

6204 
cou¡
 = 
	`°bi__gë16be
(
s
);

6206 
cou¡
 -= 127;

6207 i‡(
cou¡
 > 
À·
)

6208  
	`°bi__îΩuc
("bad file","scanline overrun");

6210 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
vÆue
))

6213 
i
=0;i<
cou¡
;++i, 
de°
 += 4)

6214 
	`°bi__c›yvÆ
(
∑ckë
->
ch™√l
,
de°
,
vÆue
);

6216 ++
cou¡
;

6217 i‡(
cou¡
>
À·
Ë 
	`°bi__îΩuc
("bad file","scanline overrun");

6219 
i
=0;i<
cou¡
;++i, 
de°
+=4)

6220 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
de°
))

6223 
À·
-=
cou¡
;

6231  
ªsu…
;

6232 
	}
}

6234 *
	$°bi__pic_lﬂd
(
°bi__c⁄ãxt
 *
s
,*
px
,*
py
,*
comp
,
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

6236 
°bi_uc
 *
ªsu…
;

6237 
i
, 
x
,
y
, 
öã∫Æ_comp
;

6238 
	`STBI_NOTUSED
(
ri
);

6240 i‡(!
comp
Ëcom∞&
öã∫Æ_comp
;

6242 
i
=0; i<92; ++i)

6243 
	`°bi__gë8
(
s
);

6245 
x
 = 
	`°bi__gë16be
(
s
);

6246 
y
 = 
	`°bi__gë16be
(
s
);

6247 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (pic header)");

6248 i‡(!
	`°bi__mad3sizes_vÆid
(
x
, 
y
, 4, 0)Ë 
	`°bi__îΩuc
("tooÜarge", "PIC imageÅooÜargeÅo decode");

6250 
	`°bi__gë32be
(
s
);

6251 
	`°bi__gë16be
(
s
);

6252 
	`°bi__gë16be
(
s
);

6255 
ªsu…
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
x
, 
y
, 4, 0);

6256 
	`mem£t
(
ªsu…
, 0xff, 
x
*
y
*4);

6258 i‡(!
	`°bi__pic_lﬂd_c‹e
(
s
,
x
,
y
,
comp
, 
ªsu…
)) {

6259 
	`STBI_FREE
(
ªsu…
);

6260 
ªsu…
=0;

6262 *
px
 = 
x
;

6263 *
py
 = 
y
;

6264 i‡(
ªq_comp
 =0Ëªq_com∞*
comp
;

6265 
ªsu…
=
	`°bi__c⁄vît_f‹m©
‘esu…,4,
ªq_comp
,
x
,
y
);

6267  
ªsu…
;

6268 
	}
}

6270 
	$°bi__pic_ã°
(
°bi__c⁄ãxt
 *
s
)

6272 
r
 = 
	`°bi__pic_ã°_c‹e
(
s
);

6273 
	`°bi__ªwöd
(
s
);

6274  
r
;

6275 
	}
}

6281 #i‚de‡
STBI_NO_GIF


6284 
°bi__öt16
 
	m¥efix
;

6285 
°bi_uc
 
	mfú°
;

6286 
°bi_uc
 
	msuffix
;

6287 } 
	t°bi__gif_lzw
;

6291 
	mw
,
	mh
;

6292 
°bi_uc
 *
	mout
;

6293 
°bi_uc
 *
	mbackground
;

6294 
°bi_uc
 *
	mhi°‹y
;

6295 
	mÊags
, 
	mbgödex
, 
	møtio
, 
	må™•¨ít
, 
	meÊags
;

6296 
°bi_uc
 
	m∑l
[256][4];

6297 
°bi_uc
 
	mÕÆ
[256][4];

6298 
°bi__gif_lzw
 
	mcodes
[8192];

6299 
°bi_uc
 *
	mcﬁ‹_èbÀ
;

6300 
	m∑r£
, 
	m°ï
;

6301 
	mlÊags
;

6302 
	m°¨t_x
, 
	m°¨t_y
;

6303 
	mmax_x
, 
	mmax_y
;

6304 
	mcur_x
, 
	mcur_y
;

6305 
	mlöe_size
;

6306 
	mdñay
;

6307 } 
	t°bi__gif
;

6309 
	$°bi__gif_ã°_øw
(
°bi__c⁄ãxt
 *
s
)

6311 
sz
;

6312 i‡(
	`°bi__gë8
(
s
) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')  0;

6313 
sz
 = 
	`°bi__gë8
(
s
);

6314 i‡(
sz
 != '9' && sz != '7')  0;

6315 i‡(
	`°bi__gë8
(
s
) != 'a')  0;

6317 
	}
}

6319 
	$°bi__gif_ã°
(
°bi__c⁄ãxt
 *
s
)

6321 
r
 = 
	`°bi__gif_ã°_øw
(
s
);

6322 
	`°bi__ªwöd
(
s
);

6323  
r
;

6324 
	}
}

6326 
	$°bi__gif_∑r£_cﬁ‹èbÀ
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 
∑l
[256][4], 
num_íåõs
, 
å™•
)

6328 
i
;

6329 
i
=0; i < 
num_íåõs
; ++i) {

6330 
∑l
[
i
][2] = 
	`°bi__gë8
(
s
);

6331 
∑l
[
i
][1] = 
	`°bi__gë8
(
s
);

6332 
∑l
[
i
][0] = 
	`°bi__gë8
(
s
);

6333 
∑l
[
i
][3] = 
å™•
 == i ? 0 : 255;

6335 
	}
}

6337 
	$°bi__gif_hódî
(
°bi__c⁄ãxt
 *
s
, 
°bi__gif
 *
g
, *
comp
, 
is_öfo
)

6339 
°bi_uc
 
vîsi⁄
;

6340 i‡(
	`°bi__gë8
(
s
) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')

6341  
	`°bi__îr
("not GIF", "Corrupt GIF");

6343 
vîsi⁄
 = 
	`°bi__gë8
(
s
);

6344 i‡(
vîsi⁄
 !'7' && vîsi⁄ !'9'Ë 
	`°bi__îr
("not GIF", "Corrupt GIF");

6345 i‡(
	`°bi__gë8
(
s
Ë!'a'Ë 
	`°bi__îr
("not GIF", "Corrupt GIF");

6347 
°bi__g_Áûuª_ªas⁄
 = "";

6348 
g
->
w
 = 
	`°bi__gë16À
(
s
);

6349 
g
->
h
 = 
	`°bi__gë16À
(
s
);

6350 
g
->
Êags
 = 
	`°bi__gë8
(
s
);

6351 
g
->
bgödex
 = 
	`°bi__gë8
(
s
);

6352 
g
->
øtio
 = 
	`°bi__gë8
(
s
);

6353 
g
->
å™•¨ít
 = -1;

6355 i‡(
comp
 != 0) *comp = 4;

6357 i‡(
is_öfo
)  1;

6359 i‡(
g
->
Êags
 & 0x80)

6360 
	`°bi__gif_∑r£_cﬁ‹èbÀ
(
s
,
g
->
∑l
, 2 << (g->
Êags
 & 7), -1);

6363 
	}
}

6365 
	$°bi__gif_öfo_øw
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

6367 
°bi__gif
* 
g
 = (°bi__gif*Ë
	`°bi__mÆloc
((stbi__gif));

6368 i‡(!
	`°bi__gif_hódî
(
s
, 
g
, 
comp
, 1)) {

6369 
	`STBI_FREE
(
g
);

6370 
	`°bi__ªwöd
–
s
 );

6373 i‡(
x
Ë*x = 
g
->
w
;

6374 i‡(
y
Ë*y = 
g
->
h
;

6375 
	`STBI_FREE
(
g
);

6377 
	}
}

6379 
	$°bi__out_gif_code
(
°bi__gif
 *
g
, 
°bi__uöt16
 
code
)

6381 
°bi_uc
 *
p
, *
c
;

6382 
idx
;

6386 i‡(
g
->
codes
[
code
].
¥efix
 >= 0)

6387 
	`°bi__out_gif_code
(
g
, g->
codes
[
code
].
¥efix
);

6389 i‡(
g
->
cur_y
 >g->
max_y
) ;

6391 
idx
 = 
g
->
cur_x
 + g->
cur_y
;

6392 
p
 = &
g
->
out
[
idx
];

6393 
g
->
hi°‹y
[
idx
 / 4] = 1;

6395 
c
 = &
g
->
cﬁ‹_èbÀ
[g->
codes
[
code
].
suffix
 * 4];

6396 i‡(
c
[3] > 128) {

6397 
p
[0] = 
c
[2];

6398 
p
[1] = 
c
[1];

6399 
p
[2] = 
c
[0];

6400 
p
[3] = 
c
[3];

6402 
g
->
cur_x
 += 4;

6404 i‡(
g
->
cur_x
 >g->
max_x
) {

6405 
g
->
cur_x
 = g->
°¨t_x
;

6406 
g
->
cur_y
 +g->
°ï
;

6408 
g
->
cur_y
 >g->
max_y
 && g->
∑r£
 > 0) {

6409 
g
->
°ï
 = (1 << g->
∑r£
Ë* g->
löe_size
;

6410 
g
->
cur_y
 = g->
°¨t_y
 + (g->
°ï
 >> 1);

6411 --
g
->
∑r£
;

6414 
	}
}

6416 
°bi_uc
 *
	$°bi__¥o˚ss_gif_ø°î
(
°bi__c⁄ãxt
 *
s
, 
°bi__gif
 *
g
)

6418 
°bi_uc
 
lzw_cs
;

6419 
°bi__öt32
 
Àn
, 
öô_code
;

6420 
°bi__uöt32
 
fú°
;

6421 
°bi__öt32
 
codesize
, 
codemask
, 
avaû
, 
ﬁdcode
, 
bôs
, 
vÆid_bôs
, 
˛ór
;

6422 
°bi__gif_lzw
 *
p
;

6424 
lzw_cs
 = 
	`°bi__gë8
(
s
);

6425 i‡(
lzw_cs
 > 12Ë 
NULL
;

6426 
˛ór
 = 1 << 
lzw_cs
;

6427 
fú°
 = 1;

6428 
codesize
 = 
lzw_cs
 + 1;

6429 
codemask
 = (1 << 
codesize
) - 1;

6430 
bôs
 = 0;

6431 
vÆid_bôs
 = 0;

6432 
öô_code
 = 0; inô_codê< 
˛ór
; init_code++) {

6433 
g
->
codes
[
öô_code
].
¥efix
 = -1;

6434 
g
->
codes
[
öô_code
].
fú°
 = (
°bi_uc
) init_code;

6435 
g
->
codes
[
öô_code
].
suffix
 = (
°bi_uc
) init_code;

6439 
avaû
 = 
˛ór
+2;

6440 
ﬁdcode
 = -1;

6442 
Àn
 = 0;

6444 i‡(
vÆid_bôs
 < 
codesize
) {

6445 i‡(
Àn
 == 0) {

6446 
Àn
 = 
	`°bi__gë8
(
s
);

6447 i‡(
Àn
 == 0)

6448  
g
->
out
;

6450 --
Àn
;

6451 
bôs
 |(
°bi__öt32
Ë
	`°bi__gë8
(
s
Ë<< 
vÆid_bôs
;

6452 
vÆid_bôs
 += 8;

6454 
°bi__öt32
 
code
 = 
bôs
 & 
codemask
;

6455 
bôs
 >>
codesize
;

6456 
vÆid_bôs
 -
codesize
;

6458 i‡(
code
 =
˛ór
) {

6459 
codesize
 = 
lzw_cs
 + 1;

6460 
codemask
 = (1 << 
codesize
) - 1;

6461 
avaû
 = 
˛ór
 + 2;

6462 
ﬁdcode
 = -1;

6463 
fú°
 = 0;

6464 } i‡(
code
 =
˛ór
 + 1) {

6465 
	`°bi__skù
(
s
, 
Àn
);

6466 (
Àn
 = 
	`°bi__gë8
(
s
)) > 0)

6467 
	`°bi__skù
(
s
,
Àn
);

6468  
g
->
out
;

6469 } i‡(
code
 <
avaû
) {

6470 i‡(
fú°
) {

6471  
	`°bi__îΩuc
("no clear code", "Corrupt GIF");

6474 i‡(
ﬁdcode
 >= 0) {

6475 
p
 = &
g
->
codes
[
avaû
++];

6476 i‡(
avaû
 > 8192) {

6477  
	`°bi__îΩuc
("too many codes", "Corrupt GIF");

6480 
p
->
¥efix
 = (
°bi__öt16
Ë
ﬁdcode
;

6481 
p
->
fú°
 = 
g
->
codes
[
ﬁdcode
].first;

6482 
p
->
suffix
 = (
code
 =
avaû
Ë?Ö->
fú°
 : 
g
->
codes
[code].first;

6483 } i‡(
code
 =
avaû
)

6484  
	`°bi__îΩuc
("illegal code inÑaster", "Corrupt GIF");

6486 
	`°bi__out_gif_code
(
g
, (
°bi__uöt16
Ë
code
);

6488 i‡((
avaû
 & 
codemask
) == 0 &&ávail <= 0x0FFF) {

6489 
codesize
++;

6490 
codemask
 = (1 << 
codesize
) - 1;

6493 
ﬁdcode
 = 
code
;

6495  
	`°bi__îΩuc
("illegal code inÑaster", "Corrupt GIF");

6499 
	}
}

6503 
°bi_uc
 *
	$°bi__gif_lﬂd_√xt
(
°bi__c⁄ãxt
 *
s
, 
°bi__gif
 *
g
, *
comp
, 
ªq_comp
, 
°bi_uc
 *
two_back
)

6505 
di•o£
;

6506 
fú°_‰ame
;

6507 
pi
;

6508 
pcou¡
;

6509 
	`STBI_NOTUSED
(
ªq_comp
);

6512 
fú°_‰ame
 = 0;

6513 i‡(
g
->
out
 == 0) {

6514 i‡(!
	`°bi__gif_hódî
(
s
, 
g
, 
comp
,0))  0;

6515 i‡(!
	`°bi__mad3sizes_vÆid
(4, 
g
->
w
, g->
h
, 0))

6516  
	`°bi__îΩuc
("tooÜarge", "GIF image isÅooÜarge");

6517 
pcou¡
 = 
g
->
w
 * g->
h
;

6518 
g
->
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(4 * 
pcou¡
);

6519 
g
->
background
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(4 * 
pcou¡
);

6520 
g
->
hi°‹y
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(
pcou¡
);

6521 i‡(!
g
->
out
 || !g->
background
 || !g->
hi°‹y
)

6522  
	`°bi__îΩuc
("outofmem", "Out of memory");

6527 
	`mem£t
(
g
->
out
, 0x00, 4 * 
pcou¡
);

6528 
	`mem£t
(
g
->
background
, 0x00, 4 * 
pcou¡
);

6529 
	`mem£t
(
g
->
hi°‹y
, 0x00, 
pcou¡
);

6530 
fú°_‰ame
 = 1;

6533 
di•o£
 = (
g
->
eÊags
 & 0x1C) >> 2;

6534 
pcou¡
 = 
g
->
w
 * g->
h
;

6536 i‡((
di•o£
 =3Ë&& (
two_back
 == 0)) {

6537 
di•o£
 = 2;

6540 i‡(
di•o£
 == 3) {

6541 
pi
 = 0;Öò< 
pcou¡
; ++pi) {

6542 i‡(
g
->
hi°‹y
[
pi
]) {

6543 
	`mem˝y
–&
g
->
out
[
pi
 * 4], &
two_back
[pi * 4], 4 );

6546 } i‡(
di•o£
 == 2) {

6548 
pi
 = 0;Öò< 
pcou¡
; ++pi) {

6549 i‡(
g
->
hi°‹y
[
pi
]) {

6550 
	`mem˝y
–&
g
->
out
[
pi
 * 4], &g->
background
[pi * 4], 4 );

6561 
	`mem˝y
–
g
->
background
, g->
out
, 4 * g->
w
 * g->
h
 );

6565 
	`mem£t
–
g
->
hi°‹y
, 0x00, g->
w
 * g->
h
 );

6568 
èg
 = 
	`°bi__gë8
(
s
);

6569 
èg
) {

6572 
°bi__öt32
 
x
, 
y
, 
w
, 
h
;

6573 
°bi_uc
 *
o
;

6575 
x
 = 
	`°bi__gë16À
(
s
);

6576 
y
 = 
	`°bi__gë16À
(
s
);

6577 
w
 = 
	`°bi__gë16À
(
s
);

6578 
h
 = 
	`°bi__gë16À
(
s
);

6579 i‡(((
x
 + 
w
Ë> (
g
->w)Ë|| ((
y
 + 
h
) > (g->h)))

6580  
	`°bi__îΩuc
("bad Image Descriptor", "Corrupt GIF");

6582 
g
->
löe_size
 = g->
w
 * 4;

6583 
g
->
°¨t_x
 = 
x
 * 4;

6584 
g
->
°¨t_y
 = 
y
 * g->
löe_size
;

6585 
g
->
max_x
 = g->
°¨t_x
 + 
w
 * 4;

6586 
g
->
max_y
 = g->
°¨t_y
 + 
h
 * g->
löe_size
;

6587 
g
->
cur_x
 = g->
°¨t_x
;

6588 
g
->
cur_y
 = g->
°¨t_y
;

6594 i‡(
w
 == 0)

6595 
g
->
cur_y
 = g->
max_y
;

6597 
g
->
lÊags
 = 
	`°bi__gë8
(
s
);

6599 i‡(
g
->
lÊags
 & 0x40) {

6600 
g
->
°ï
 = 8 * g->
löe_size
;

6601 
g
->
∑r£
 = 3;

6603 
g
->
°ï
 = g->
löe_size
;

6604 
g
->
∑r£
 = 0;

6607 i‡(
g
->
lÊags
 & 0x80) {

6608 
	`°bi__gif_∑r£_cﬁ‹èbÀ
(
s
,
g
->
ÕÆ
, 2 << (g->
lÊags
 & 7), g->
eÊags
 & 0x01 ? g->
å™•¨ít
 : -1);

6609 
g
->
cﬁ‹_èbÀ
 = (
°bi_uc
 *Ëg->
ÕÆ
;

6610 } i‡(
g
->
Êags
 & 0x80) {

6611 
g
->
cﬁ‹_èbÀ
 = (
°bi_uc
 *Ëg->
∑l
;

6613  
	`°bi__îΩuc
("missing colorÅable", "Corrupt GIF");

6615 
o
 = 
	`°bi__¥o˚ss_gif_ø°î
(
s
, 
g
);

6616 i‡(!
o
Ë 
NULL
;

6619 
pcou¡
 = 
g
->
w
 * g->
h
;

6620 i‡(
fú°_‰ame
 && (
g
->
bgödex
 > 0)) {

6622 
pi
 = 0;Öò< 
pcou¡
; ++pi) {

6623 i‡(
g
->
hi°‹y
[
pi
] == 0) {

6624 
g
->
∑l
[g->
bgödex
][3] = 255;

6625 
	`mem˝y
–&
g
->
out
[
pi
 * 4], &g->
∑l
[g->
bgödex
], 4 );

6630  
o
;

6635 
Àn
;

6636 
ext
 = 
	`°bi__gë8
(
s
);

6637 i‡(
ext
 == 0xF9) {

6638 
Àn
 = 
	`°bi__gë8
(
s
);

6639 i‡(
Àn
 == 4) {

6640 
g
->
eÊags
 = 
	`°bi__gë8
(
s
);

6641 
g
->
dñay
 = 10 * 
	`°bi__gë16À
(
s
);

6644 i‡(
g
->
å™•¨ít
 >= 0) {

6645 
g
->
∑l
[g->
å™•¨ít
][3] = 255;

6647 i‡(
g
->
eÊags
 & 0x01) {

6648 
g
->
å™•¨ít
 = 
	`°bi__gë8
(
s
);

6649 i‡(
g
->
å™•¨ít
 >= 0) {

6650 
g
->
∑l
[g->
å™•¨ít
][3] = 0;

6654 
	`°bi__skù
(
s
, 1);

6655 
g
->
å™•¨ít
 = -1;

6658 
	`°bi__skù
(
s
, 
Àn
);

6662 (
Àn
 = 
	`°bi__gë8
(
s
)) != 0) {

6663 
	`°bi__skù
(
s
, 
Àn
);

6669  (
°bi_uc
 *Ë
s
;

6672  
	`°bi__îΩuc
("unknown code", "Corrupt GIF");

6675 
	}
}

6677 *
	$°bi__lﬂd_gif_maö
(
°bi__c⁄ãxt
 *
s
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
)

6679 i‡(
	`°bi__gif_ã°
(
s
)) {

6680 
œyîs
 = 0;

6681 
°bi_uc
 *
u
 = 0;

6682 
°bi_uc
 *
out
 = 0;

6683 
°bi_uc
 *
two_back
 = 0;

6684 
°bi__gif
 
g
;

6685 
°ride
;

6686 
	`mem£t
(&
g
, 0, (g));

6687 i‡(
dñays
) {

6688 *
dñays
 = 0;

6692 
u
 = 
	`°bi__gif_lﬂd_√xt
(
s
, &
g
, 
comp
, 
ªq_comp
, 
two_back
);

6693 i‡(
u
 =(
°bi_uc
 *Ë
s
) u = 0;

6695 i‡(
u
) {

6696 *
x
 = 
g
.
w
;

6697 *
y
 = 
g
.
h
;

6698 ++
œyîs
;

6699 
°ride
 = 
g
.
w
 * g.
h
 * 4;

6701 i‡(
out
) {

6702 *
tmp
 = (
°bi_uc
*Ë
	`STBI_REALLOC
–
out
, 
œyîs
 * 
°ride
 );

6703 i‡(
NULL
 =
tmp
) {

6704 
	`STBI_FREE
(
g
.
out
);

6705 
	`STBI_FREE
(
g
.
hi°‹y
);

6706 
	`STBI_FREE
(
g
.
background
);

6707  
	`°bi__îΩuc
("outofmem", "Out of memory");

6710 
out
 = (
°bi_uc
*Ë
tmp
;

6711 i‡(
dñays
) {

6712 *
dñays
 = (*Ë
	`STBI_REALLOC
–*dñays, (Ë* 
œyîs
 );

6715 
out
 = (
°bi_uc
*)
	`°bi__mÆloc
–
œyîs
 * 
°ride
 );

6716 i‡(
dñays
) {

6717 *
dñays
 = (*Ë
	`°bi__mÆloc
–
œyîs
 * () );

6720 
	`mem˝y
–
out
 + ((
œyîs
 - 1Ë* 
°ride
), 
u
, stride );

6721 i‡(
œyîs
 >= 2) {

6722 
two_back
 = 
out
 - 2 * 
°ride
;

6725 i‡(
dñays
) {

6726 (*
dñays
)[
œyîs
 - 1U] = 
g
.
dñay
;

6729 } 
u
 != 0);

6732 
	`STBI_FREE
(
g
.
out
);

6733 
	`STBI_FREE
(
g
.
hi°‹y
);

6734 
	`STBI_FREE
(
g
.
background
);

6737 i‡(
ªq_comp
 &&Ñeq_comp != 4)

6738 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 4, 
ªq_comp
, 
œyîs
 * 
g
.
w
, g.
h
);

6740 *
z
 = 
œyîs
;

6741  
out
;

6743  
	`°bi__îΩuc
("not GIF", "Image wasÇotásá gifÅype.");

6745 
	}
}

6747 *
	$°bi__gif_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

6749 
°bi_uc
 *
u
 = 0;

6750 
°bi__gif
 
g
;

6751 
	`mem£t
(&
g
, 0, (g));

6752 
	`STBI_NOTUSED
(
ri
);

6754 
u
 = 
	`°bi__gif_lﬂd_√xt
(
s
, &
g
, 
comp
, 
ªq_comp
, 0);

6755 i‡(
u
 =(
°bi_uc
 *Ë
s
) u = 0;

6756 i‡(
u
) {

6757 *
x
 = 
g
.
w
;

6758 *
y
 = 
g
.
h
;

6762 i‡(
ªq_comp
 &&Ñeq_comp != 4)

6763 
u
 = 
	`°bi__c⁄vît_f‹m©
(u, 4, 
ªq_comp
, 
g
.
w
, g.
h
);

6764 } i‡(
g
.
out
) {

6766 
	`STBI_FREE
(
g
.
out
);

6770 
	`STBI_FREE
(
g
.
hi°‹y
);

6771 
	`STBI_FREE
(
g
.
background
);

6773  
u
;

6774 
	}
}

6776 
	$°bi__gif_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

6778  
	`°bi__gif_öfo_øw
(
s
,
x
,
y
,
comp
);

6779 
	}
}

6785 #i‚de‡
STBI_NO_HDR


6786 
	$°bi__hdr_ã°_c‹e
(
°bi__c⁄ãxt
 *
s
, c⁄° *
sig«tuª
)

6788 
i
;

6789 
i
=0; 
sig«tuª
[i]; ++i)

6790 i‡(
	`°bi__gë8
(
s
Ë!
sig«tuª
[
i
])

6792 
	`°bi__ªwöd
(
s
);

6794 
	}
}

6796 
	$°bi__hdr_ã°
(
°bi__c⁄ãxt
* 
s
)

6798 
r
 = 
	`°bi__hdr_ã°_c‹e
(
s
, "#?RADIANCE\n");

6799 
	`°bi__ªwöd
(
s
);

6800 if(!
r
) {

6801 
r
 = 
	`°bi__hdr_ã°_c‹e
(
s
, "#?RGBE\n");

6802 
	`°bi__ªwöd
(
s
);

6804  
r
;

6805 
	}
}

6807 
	#STBI__HDR_BUFLEN
 1024

	)

6808 *
	$°bi__hdr_gëtokí
(
°bi__c⁄ãxt
 *
z
, *
buf„r
)

6810 
Àn
=0;

6811 
c
 = '\0';

6813 
c
 = (Ë
	`°bi__gë8
(
z
);

6815 !
	`°bi__©_eof
(
z
Ë&& 
c
 != '\n') {

6816 
buf„r
[
Àn
++] = 
c
;

6817 i‡(
Àn
 =
STBI__HDR_BUFLEN
-1) {

6819 !
	`°bi__©_eof
(
z
Ë&& 
	`°bi__gë8
(z) != '\n')

6823 
c
 = (Ë
	`°bi__gë8
(
z
);

6826 
buf„r
[
Àn
] = 0;

6827  
buf„r
;

6828 
	}
}

6830 
	$°bi__hdr_c⁄vît
(*
ouçut
, 
°bi_uc
 *
öput
, 
ªq_comp
)

6832 i‡–
öput
[3] != 0 ) {

6833 
f1
;

6835 
f1
 = (Ë
	`ldexp
(1.0f, 
öput
[3] - ()(128 + 8));

6836 i‡(
ªq_comp
 <= 2)

6837 
ouçut
[0] = (
öput
[0] + i≈ut[1] + i≈ut[2]Ë* 
f1
 / 3;

6839 
ouçut
[0] = 
öput
[0] * 
f1
;

6840 
ouçut
[1] = 
öput
[1] * 
f1
;

6841 
ouçut
[2] = 
öput
[2] * 
f1
;

6843 i‡(
ªq_comp
 =2Ë
ouçut
[1] = 1;

6844 i‡(
ªq_comp
 =4Ë
ouçut
[3] = 1;

6846 
ªq_comp
) {

6847 4: 
ouçut
[3] = 1;

6848 3: 
ouçut
[0] = output[1] = output[2] = 0;

6850 2: 
ouçut
[1] = 1;

6851 1: 
ouçut
[0] = 0;

6855 
	}
}

6857 *
	$°bi__hdr_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

6859 
buf„r
[
STBI__HDR_BUFLEN
];

6860 *
tokí
;

6861 
vÆid
 = 0;

6862 
width
, 
height
;

6863 
°bi_uc
 *
sˇ∆öe
;

6864 *
hdr_d©a
;

6865 
Àn
;

6866 
cou¡
, 
vÆue
;

6867 
i
, 
j
, 
k
, 
c1
,
c2
, 
z
;

6868 c⁄° *
hódîTokí
;

6869 
	`STBI_NOTUSED
(
ri
);

6872 
hódîTokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

6873 i‡(
	`°rcmp
(
hódîTokí
, "#?RADIANCE") != 0 && strcmp(headerToken, "#?RGBE") != 0)

6874  
	`°bi__îΩf
("not HDR", "Corrupt HDR image");

6878 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

6879 i‡(
tokí
[0] == 0) ;

6880 i‡(
	`°rcmp
(
tokí
, "FORMAT=32-bô_æe_rgbe"Ë=0Ë
vÆid
 = 1;

6883 i‡(!
vÆid
Ë 
	`°bi__îΩf
("unsupported format", "Unsupported HDR format");

6887 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

6888 i‡(
	`°∫cmp
(
tokí
, "-Y ", 3)Ë 
	`°bi__îΩf
("unsupportedÖiece_dataÜayout", "Unsupported HDR format");

6889 
tokí
 += 3;

6890 
height
 = (Ë
	`°πﬁ
(
tokí
, &token, 10);

6891 *
tokí
 == ' ') ++token;

6892 i‡(
	`°∫cmp
(
tokí
, "+X ", 3)Ë 
	`°bi__îΩf
("unsupportedÖiece_dataÜayout", "Unsupported HDR format");

6893 
tokí
 += 3;

6894 
width
 = (Ë
	`°πﬁ
(
tokí
, 
NULL
, 10);

6896 *
x
 = 
width
;

6897 *
y
 = 
height
;

6899 i‡(
comp
) *comp = 3;

6900 i‡(
ªq_comp
 == 0)Ñeq_comp = 3;

6902 i‡(!
	`°bi__mad4sizes_vÆid
(
width
, 
height
, 
ªq_comp
, (), 0))

6903  
	`°bi__îΩf
("tooÜarge", "HDR image isÅooÜarge");

6906 
hdr_d©a
 = (*Ë
	`°bi__mÆloc_mad4
(
width
, 
height
, 
ªq_comp
, (), 0);

6907 i‡(!
hdr_d©a
)

6908  
	`°bi__îΩf
("outofmem", "Out of memory");

6912 i‡–
width
 < 8 || width >= 32768) {

6914 
j
=0; j < 
height
; ++j) {

6915 
i
=0; i < 
width
; ++i) {

6916 
°bi_uc
 
rgbe
[4];

6917 
maö_decode_lo›
:

6918 
	`°bi__gën
(
s
, 
rgbe
, 4);

6919 
	`°bi__hdr_c⁄vît
(
hdr_d©a
 + 
j
 * 
width
 * 
ªq_comp
 + 
i
 *Ñeq_comp, 
rgbe
,Ñeq_comp);

6924 
sˇ∆öe
 = 
NULL
;

6926 
j
 = 0; j < 
height
; ++j) {

6927 
c1
 = 
	`°bi__gë8
(
s
);

6928 
c2
 = 
	`°bi__gë8
(
s
);

6929 
Àn
 = 
	`°bi__gë8
(
s
);

6930 i‡(
c1
 !2 || 
c2
 !2 || (
Àn
 & 0x80)) {

6933 
°bi_uc
 
rgbe
[4];

6934 
rgbe
[0] = (
°bi_uc
Ë
c1
;

6935 
rgbe
[1] = (
°bi_uc
Ë
c2
;

6936 
rgbe
[2] = (
°bi_uc
Ë
Àn
;

6937 
rgbe
[3] = (
°bi_uc
Ë
	`°bi__gë8
(
s
);

6938 
	`°bi__hdr_c⁄vît
(
hdr_d©a
, 
rgbe
, 
ªq_comp
);

6939 
i
 = 1;

6940 
j
 = 0;

6941 
	`STBI_FREE
(
sˇ∆öe
);

6942 
maö_decode_lo›
;

6944 
Àn
 <<= 8;

6945 
Àn
 |
	`°bi__gë8
(
s
);

6946 i‡(
Àn
 !
width
Ë{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sˇ∆öe
);  
	`°bi__îΩf
("invalid decoded scanlineÜength", "corrupt HDR"); }

6947 i‡(
sˇ∆öe
 =
NULL
) {

6948 
sˇ∆öe
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad2
(
width
, 4, 0);

6949 i‡(!
sˇ∆öe
) {

6950 
	`STBI_FREE
(
hdr_d©a
);

6951  
	`°bi__îΩf
("outofmem", "Out of memory");

6955 
k
 = 0; k < 4; ++k) {

6956 
∆e·
;

6957 
i
 = 0;

6958 (
∆e·
 = 
width
 - 
i
) > 0) {

6959 
cou¡
 = 
	`°bi__gë8
(
s
);

6960 i‡(
cou¡
 > 128) {

6962 
vÆue
 = 
	`°bi__gë8
(
s
);

6963 
cou¡
 -= 128;

6964 i‡(
cou¡
 > 
∆e·
Ë{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sˇ∆öe
);  
	`°bi__îΩf
("corrupt", "bad RLEÖiece_data in HDR"); }

6965 
z
 = 0; z < 
cou¡
; ++z)

6966 
sˇ∆öe
[
i
++ * 4 + 
k
] = 
vÆue
;

6969 i‡(
cou¡
 > 
∆e·
Ë{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sˇ∆öe
);  
	`°bi__îΩf
("corrupt", "bad RLEÖiece_data in HDR"); }

6970 
z
 = 0; z < 
cou¡
; ++z)

6971 
sˇ∆öe
[
i
++ * 4 + 
k
] = 
	`°bi__gë8
(
s
);

6975 
i
=0; i < 
width
; ++i)

6976 
	`°bi__hdr_c⁄vît
(
hdr_d©a
+(
j
*
width
 + 
i
)*
ªq_comp
, 
sˇ∆öe
 + i*4,Ñeq_comp);

6978 i‡(
sˇ∆öe
)

6979 
	`STBI_FREE
(
sˇ∆öe
);

6982  
hdr_d©a
;

6983 
	}
}

6985 
	$°bi__hdr_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

6987 
buf„r
[
STBI__HDR_BUFLEN
];

6988 *
tokí
;

6989 
vÆid
 = 0;

6990 
dummy
;

6992 i‡(!
x
Ëx = &
dummy
;

6993 i‡(!
y
Ëy = &
dummy
;

6994 i‡(!
comp
Ëcom∞&
dummy
;

6996 i‡(
	`°bi__hdr_ã°
(
s
) == 0) {

6997 
	`°bi__ªwöd
–
s
 );

7002 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

7003 i‡(
tokí
[0] == 0) ;

7004 i‡(
	`°rcmp
(
tokí
, "FORMAT=32-bô_æe_rgbe"Ë=0Ë
vÆid
 = 1;

7007 i‡(!
vÆid
) {

7008 
	`°bi__ªwöd
–
s
 );

7011 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

7012 i‡(
	`°∫cmp
(
tokí
, "-Y ", 3)) {

7013 
	`°bi__ªwöd
–
s
 );

7016 
tokí
 += 3;

7017 *
y
 = (Ë
	`°πﬁ
(
tokí
, &token, 10);

7018 *
tokí
 == ' ') ++token;

7019 i‡(
	`°∫cmp
(
tokí
, "+X ", 3)) {

7020 
	`°bi__ªwöd
–
s
 );

7023 
tokí
 += 3;

7024 *
x
 = (Ë
	`°πﬁ
(
tokí
, 
NULL
, 10);

7025 *
comp
 = 3;

7027 
	}
}

7030 #i‚de‡
STBI_NO_BMP


7031 
	$°bi__bmp_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7033 *
p
;

7034 
°bi__bmp_d©a
 
öfo
;

7036 
öfo
.
Æl_a
 = 255;

7037 
p
 = 
	`°bi__bmp_∑r£_hódî
(
s
, &
öfo
);

7038 
	`°bi__ªwöd
–
s
 );

7039 i‡(
p
 =
NULL
)

7041 i‡(
x
Ë*x = 
s
->
img_x
;

7042 i‡(
y
Ë*y = 
s
->
img_y
;

7043 i‡(
comp
) {

7044 i‡(
öfo
.
bµ
 =24 && info.
ma
 == 0xff000000)

7045 *
comp
 = 3;

7047 *
comp
 = 
öfo
.
ma
 ? 4 : 3;

7050 
	}
}

7053 #i‚de‡
STBI_NO_PSD


7054 
	$°bi__psd_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7056 
ch™√lCou¡
, 
dummy
, 
dïth
;

7057 i‡(!
x
Ëx = &
dummy
;

7058 i‡(!
y
Ëy = &
dummy
;

7059 i‡(!
comp
Ëcom∞&
dummy
;

7060 i‡(
	`°bi__gë32be
(
s
) != 0x38425053) {

7061 
	`°bi__ªwöd
–
s
 );

7064 i‡(
	`°bi__gë16be
(
s
) != 1) {

7065 
	`°bi__ªwöd
–
s
 );

7068 
	`°bi__skù
(
s
, 6);

7069 
ch™√lCou¡
 = 
	`°bi__gë16be
(
s
);

7070 i‡(
ch™√lCou¡
 < 0 || channelCount > 16) {

7071 
	`°bi__ªwöd
–
s
 );

7074 *
y
 = 
	`°bi__gë32be
(
s
);

7075 *
x
 = 
	`°bi__gë32be
(
s
);

7076 
dïth
 = 
	`°bi__gë16be
(
s
);

7077 i‡(
dïth
 != 8 && depth != 16) {

7078 
	`°bi__ªwöd
–
s
 );

7081 i‡(
	`°bi__gë16be
(
s
) != 3) {

7082 
	`°bi__ªwöd
–
s
 );

7085 *
comp
 = 4;

7087 
	}
}

7089 
	$°bi__psd_is16
(
°bi__c⁄ãxt
 *
s
)

7091 
ch™√lCou¡
, 
dïth
;

7092 i‡(
	`°bi__gë32be
(
s
) != 0x38425053) {

7093 
	`°bi__ªwöd
–
s
 );

7096 i‡(
	`°bi__gë16be
(
s
) != 1) {

7097 
	`°bi__ªwöd
–
s
 );

7100 
	`°bi__skù
(
s
, 6);

7101 
ch™√lCou¡
 = 
	`°bi__gë16be
(
s
);

7102 i‡(
ch™√lCou¡
 < 0 || channelCount > 16) {

7103 
	`°bi__ªwöd
–
s
 );

7106 (Ë
	`°bi__gë32be
(
s
);

7107 (Ë
	`°bi__gë32be
(
s
);

7108 
dïth
 = 
	`°bi__gë16be
(
s
);

7109 i‡(
dïth
 != 16) {

7110 
	`°bi__ªwöd
–
s
 );

7114 
	}
}

7117 #i‚de‡
STBI_NO_PIC


7118 
	$°bi__pic_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7120 
a˘_comp
=0,
num_∑ckës
=0,
chaöed
,
dummy
;

7121 
°bi__pic_∑ckë
 
∑ckës
[10];

7123 i‡(!
x
Ëx = &
dummy
;

7124 i‡(!
y
Ëy = &
dummy
;

7125 i‡(!
comp
Ëcom∞&
dummy
;

7127 i‡(!
	`°bi__pic_is4
(
s
,"\x53\x80\xF6\x34")) {

7128 
	`°bi__ªwöd
(
s
);

7132 
	`°bi__skù
(
s
, 88);

7134 *
x
 = 
	`°bi__gë16be
(
s
);

7135 *
y
 = 
	`°bi__gë16be
(
s
);

7136 i‡(
	`°bi__©_eof
(
s
)) {

7137 
	`°bi__ªwöd
–
s
);

7140 i‡–(*
x
Ë!0 && (1 << 28Ë/ (*xË< (*
y
)) {

7141 
	`°bi__ªwöd
–
s
 );

7145 
	`°bi__skù
(
s
, 8);

7148 
°bi__pic_∑ckë
 *
∑ckë
;

7150 i‡(
num_∑ckës
==(
∑ckës
)/(packets[0]))

7153 
∑ckë
 = &
∑ckës
[
num_∑ckës
++];

7154 
chaöed
 = 
	`°bi__gë8
(
s
);

7155 
∑ckë
->
size
 = 
	`°bi__gë8
(
s
);

7156 
∑ckë
->
ty≥
 = 
	`°bi__gë8
(
s
);

7157 
∑ckë
->
ch™√l
 = 
	`°bi__gë8
(
s
);

7158 
a˘_comp
 |
∑ckë
->
ch™√l
;

7160 i‡(
	`°bi__©_eof
(
s
)) {

7161 
	`°bi__ªwöd
–
s
 );

7164 i‡(
∑ckë
->
size
 != 8) {

7165 
	`°bi__ªwöd
–
s
 );

7168 } 
chaöed
);

7170 *
comp
 = (
a˘_comp
 & 0x10 ? 4 : 3);

7173 
	}
}

7188 #i‚de‡
STBI_NO_PNM


7190 
	$°bi__≤m_ã°
(
°bi__c⁄ãxt
 *
s
)

7192 
p
, 
t
;

7193 
p
 = (Ë
	`°bi__gë8
(
s
);

7194 
t
 = (Ë
	`°bi__gë8
(
s
);

7195 i‡(
p
 !'P' || (
t
 != '5' &&Å != '6')) {

7196 
	`°bi__ªwöd
–
s
 );

7200 
	}
}

7202 *
	$°bi__≤m_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

7204 
°bi_uc
 *
out
;

7205 
	`STBI_NOTUSED
(
ri
);

7207 i‡(!
	`°bi__≤m_öfo
(
s
, (*)&s->
img_x
, (*)&s->
img_y
, (*)&s->
img_n
))

7210 *
x
 = 
s
->
img_x
;

7211 *
y
 = 
s
->
img_y
;

7212 i‡(
comp
Ë*com∞
s
->
img_n
;

7214 i‡(!
	`°bi__mad3sizes_vÆid
(
s
->
img_n
, s->
img_x
, s->
img_y
, 0))

7215  
	`°bi__îΩuc
("tooÜarge", "PNMÅooÜarge");

7217 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
s
->
img_n
, s->
img_x
, s->
img_y
, 0);

7218 i‡(!
out
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

7219 
	`°bi__gën
(
s
, 
out
, s->
img_n
 * s->
img_x
 * s->
img_y
);

7221 i‡(
ªq_comp
 &&Ñeq_com∞!
s
->
img_n
) {

7222 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 
s
->
img_n
, 
ªq_comp
, s->
img_x
, s->
img_y
);

7223 i‡(
out
 =
NULL
)  out;

7225  
out
;

7226 
	}
}

7228 
	$°bi__≤m_is•a˚
(
c
)

7230  
c
 == ' ' || c == '\t' || c == '\n' || c == '\v' || c == '\f' || c == '\r';

7231 
	}
}

7233 
	$°bi__≤m_skù_whôe•a˚
(
°bi__c⁄ãxt
 *
s
, *
c
)

7236 !
	`°bi__©_eof
(
s
Ë&& 
	`°bi__≤m_is•a˚
(*
c
))

7237 *
c
 = (Ë
	`°bi__gë8
(
s
);

7239 i‡(
	`°bi__©_eof
(
s
Ë|| *
c
 != '#')

7242 !
	`°bi__©_eof
(
s
Ë&& *
c
 != '\n' && *c != '\r' )

7243 *
c
 = (Ë
	`°bi__gë8
(
s
);

7245 
	}
}

7247 
	$°bi__≤m_isdigô
(
c
)

7249  
c
 >= '0' && c <= '9';

7250 
	}
}

7252 
	$°bi__≤m_gëöãgî
(
°bi__c⁄ãxt
 *
s
, *
c
)

7254 
vÆue
 = 0;

7256 !
	`°bi__©_eof
(
s
Ë&& 
	`°bi__≤m_isdigô
(*
c
)) {

7257 
vÆue
 = vÆue*10 + (*
c
 - '0');

7258 *
c
 = (Ë
	`°bi__gë8
(
s
);

7261  
vÆue
;

7262 
	}
}

7264 
	$°bi__≤m_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7266 
maxv
, 
dummy
;

7267 
c
, 
p
, 
t
;

7269 i‡(!
x
Ëx = &
dummy
;

7270 i‡(!
y
Ëy = &
dummy
;

7271 i‡(!
comp
Ëcom∞&
dummy
;

7273 
	`°bi__ªwöd
(
s
);

7276 
p
 = (Ë
	`°bi__gë8
(
s
);

7277 
t
 = (Ë
	`°bi__gë8
(
s
);

7278 i‡(
p
 !'P' || (
t
 != '5' &&Å != '6')) {

7279 
	`°bi__ªwöd
(
s
);

7283 *
comp
 = (
t
 == '6') ? 3 : 1;

7285 
c
 = (Ë
	`°bi__gë8
(
s
);

7286 
	`°bi__≤m_skù_whôe•a˚
(
s
, &
c
);

7288 *
x
 = 
	`°bi__≤m_gëöãgî
(
s
, &
c
);

7289 
	`°bi__≤m_skù_whôe•a˚
(
s
, &
c
);

7291 *
y
 = 
	`°bi__≤m_gëöãgî
(
s
, &
c
);

7292 
	`°bi__≤m_skù_whôe•a˚
(
s
, &
c
);

7294 
maxv
 = 
	`°bi__≤m_gëöãgî
(
s
, &
c
);

7296 i‡(
maxv
 > 255)

7297  
	`°bi__îr
("maxi value > 255", "PPM imageÇot 8-bit");

7300 
	}
}

7303 
	$°bi__öfo_maö
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7305 #i‚de‡
STBI_NO_JPEG


7306 i‡(
	`°bi__j≥g_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7309 #i‚de‡
STBI_NO_PNG


7310 i‡(
	`°bi__≤g_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7313 #i‚de‡
STBI_NO_GIF


7314 i‡(
	`°bi__gif_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7317 #i‚de‡
STBI_NO_BMP


7318 i‡(
	`°bi__bmp_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7321 #i‚de‡
STBI_NO_PSD


7322 i‡(
	`°bi__psd_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7325 #i‚de‡
STBI_NO_PIC


7326 i‡(
	`°bi__pic_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7329 #i‚de‡
STBI_NO_PNM


7330 i‡(
	`°bi__≤m_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7333 #i‚de‡
STBI_NO_HDR


7334 i‡(
	`°bi__hdr_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7338 #i‚de‡
STBI_NO_TGA


7339 i‡(
	`°bi__tga_öfo
(
s
, 
x
, 
y
, 
comp
))

7342  
	`°bi__îr
("unknown imageÅype", "ImageÇot ofány knownÅype, or corrupt");

7343 
	}
}

7345 
	$°bi__is_16_maö
(
°bi__c⁄ãxt
 *
s
)

7347 #i‚de‡
STBI_NO_PNG


7348 i‡(
	`°bi__≤g_is16
(
s
))  1;

7351 #i‚de‡
STBI_NO_PSD


7352 i‡(
	`°bi__psd_is16
(
s
))  1;

7356 
	}
}

7358 #i‚de‡
STBI_NO_STDIO


7359 
STBIDEF
 
	$°bi_öfo
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
)

7361 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

7362 
ªsu…
;

7363 i‡(!
f
Ë 
	`°bi__îr
("can't fopen", "UnableÅo open file");

7364 
ªsu…
 = 
	`°bi_öfo_‰om_fûe
(
f
, 
x
, 
y
, 
comp
);

7365 
	`f˛o£
(
f
);

7366  
ªsu…
;

7367 
	}
}

7369 
STBIDEF
 
	$°bi_öfo_‰om_fûe
(
FILE
 *
f
, *
x
, *
y
, *
comp
)

7371 
r
;

7372 
°bi__c⁄ãxt
 
s
;

7373 
pos
 = 
	`·ñl
(
f
);

7374 
	`°bi__°¨t_fûe
(&
s
, 
f
);

7375 
r
 = 
	`°bi__öfo_maö
(&
s
,
x
,
y
,
comp
);

7376 
	`f£ek
(
f
,
pos
,
SEEK_SET
);

7377  
r
;

7378 
	}
}

7380 
STBIDEF
 
	$°bi_is_16_bô
(c⁄° *
fûíame
)

7382 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

7383 
ªsu…
;

7384 i‡(!
f
Ë 
	`°bi__îr
("can't fopen", "UnableÅo open file");

7385 
ªsu…
 = 
	`°bi_is_16_bô_‰om_fûe
(
f
);

7386 
	`f˛o£
(
f
);

7387  
ªsu…
;

7388 
	}
}

7390 
STBIDEF
 
	$°bi_is_16_bô_‰om_fûe
(
FILE
 *
f
)

7392 
r
;

7393 
°bi__c⁄ãxt
 
s
;

7394 
pos
 = 
	`·ñl
(
f
);

7395 
	`°bi__°¨t_fûe
(&
s
, 
f
);

7396 
r
 = 
	`°bi__is_16_maö
(&
s
);

7397 
	`f£ek
(
f
,
pos
,
SEEK_SET
);

7398  
r
;

7399 
	}
}

7402 
STBIDEF
 
	$°bi_öfo_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
)

7404 
°bi__c⁄ãxt
 
s
;

7405 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

7406  
	`°bi__öfo_maö
(&
s
,
x
,
y
,
comp
);

7407 
	}
}

7409 
STBIDEF
 
	$°bi_öfo_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
c
, *
u£r
, *
x
, *
y
, *
comp
)

7411 
°bi__c⁄ãxt
 
s
;

7412 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
c
, 
u£r
);

7413  
	`°bi__öfo_maö
(&
s
,
x
,
y
,
comp
);

7414 
	}
}

7416 
STBIDEF
 
	$°bi_is_16_bô_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
)

7418 
°bi__c⁄ãxt
 
s
;

7419 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

7420  
	`°bi__is_16_maö
(&
s
);

7421 
	}
}

7423 
STBIDEF
 
	$°bi_is_16_bô_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
c
, *
u£r
)

7425 
°bi__c⁄ãxt
 
s
;

7426 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
c
, 
u£r
);

7427  
	`°bi__is_16_maö
(&
s
);

7428 
	}
}

	@textureAssets.cpp

1 
	~"Mem‹y.h
"

2 
	~"ãxtuªAs£ts.h
"

4 
	gglm
::
vec4
* 
ãxtuªAs£ts
::
	$FLOOR_posôi⁄s
(
Mem‹y
* 
mem‹y
) {

5 
glm
::
vec4
* 
ªsu…
 = (glm::vec4*Ë
	`mem‹y_Æloc
(
mem‹y
,(glm::vec4) * 11);

6 
ªsu…
[0] = 
glm
::
	`vec4
(0.000977,0.000977,0.063477,0.063477);

7 
ªsu…
[1] = 
glm
::
	`vec4
(0.065430,0.000977,0.127930,0.063477);

8 
ªsu…
[2] = 
glm
::
	`vec4
(0.129883,0.000977,0.192383,0.063477);

9 
ªsu…
[3] = 
glm
::
	`vec4
(0.194336,0.000977,0.256836,0.063477);

10 
ªsu…
[4] = 
glm
::
	`vec4
(0.258789,0.000977,0.321289,0.063477);

11 
ªsu…
[5] = 
glm
::
	`vec4
(0.323242,0.000977,0.385742,0.063477);

12 
ªsu…
[6] = 
glm
::
	`vec4
(0.387695,0.000977,0.450195,0.063477);

13 
ªsu…
[7] = 
glm
::
	`vec4
(0.452148,0.000977,0.514648,0.063477);

14 
ªsu…
[8] = 
glm
::
	`vec4
(0.516602,0.000977,0.579102,0.063477);

15 
ªsu…
[9] = 
glm
::
	`vec4
(0.581055,0.000977,0.643555,0.063477);

16 
ªsu…
[10] = 
glm
::
	`vec4
(0.645508,0.000977,0.708008,0.063477);Ñesult;

17 
	}
}

19 
	gglm
::
vec4
* 
ãxtuªAs£ts
::
	$PIECE_posôi⁄s
(
Mem‹y
* 
mem‹y
) {

20 
glm
::
vec4
* 
ªsu…
 = (glm::vec4*Ë
	`mem‹y_Æloc
(
mem‹y
,(glm::vec4) * 14);

21 
ªsu…
[0] = 
glm
::
	`vec4
(0.000977,0.000977,0.063477,0.063477);

22 
ªsu…
[1] = 
glm
::
	`vec4
(0.065430,0.000977,0.127930,0.063477);

23 
ªsu…
[2] = 
glm
::
	`vec4
(0.129883,0.000977,0.192383,0.063477);

24 
ªsu…
[3] = 
glm
::
	`vec4
(0.194336,0.000977,0.256836,0.063477);

25 
ªsu…
[4] = 
glm
::
	`vec4
(0.258789,0.000977,0.321289,0.063477);

26 
ªsu…
[5] = 
glm
::
	`vec4
(0.323242,0.000977,0.385742,0.063477);

27 
ªsu…
[6] = 
glm
::
	`vec4
(0.387695,0.000977,0.450195,0.063477);

28 
ªsu…
[7] = 
glm
::
	`vec4
(0.452148,0.000977,0.514648,0.063477);

29 
ªsu…
[8] = 
glm
::
	`vec4
(0.516602,0.000977,0.579102,0.063477);

30 
ªsu…
[9] = 
glm
::
	`vec4
(0.581055,0.000977,0.643555,0.063477);

31 
ªsu…
[10] = 
glm
::
	`vec4
(0.645508,0.000977,0.708008,0.063477);

32 
ªsu…
[11] = 
glm
::
	`vec4
(0.709961,0.000977,0.772461,0.063477);

33 
ªsu…
[12] = 
glm
::
	`vec4
(0.774414,0.000977,0.836914,0.063477);

34 
ªsu…
[13] = 
glm
::
	`vec4
(0.838867,0.000977,0.901367,0.063477);Ñesult;

35 
	}
}

37 
	gglm
::
vec4
* 
ãxtuªAs£ts
::
	$SYMBOLS_posôi⁄s
(
Mem‹y
* 
mem‹y
) {

38 
glm
::
vec4
* 
ªsu…
 = (glm::vec4*Ë
	`mem‹y_Æloc
(
mem‹y
,(glm::vec4) * 5);

39 
ªsu…
[0] = 
glm
::
	`vec4
(0.000977,0.000977,0.063477,0.063477);

40 
ªsu…
[1] = 
glm
::
	`vec4
(0.065430,0.000977,0.127930,0.063477);

41 
ªsu…
[2] = 
glm
::
	`vec4
(0.129883,0.000977,0.192383,0.063477);

42 
ªsu…
[3] = 
glm
::
	`vec4
(0.194336,0.000977,0.256836,0.063477);

43 
ªsu…
[4] = 
glm
::
	`vec4
(0.258789,0.000977,0.321289,0.063477);Ñesult;

44 
	}
}

46 
	gglm
::
vec4
* 
ãxtuªAs£ts
::
	$UI_posôi⁄s
(
Mem‹y
* 
mem‹y
) {

47 
glm
::
vec4
* 
ªsu…
 = (glm::vec4*Ë
	`mem‹y_Æloc
(
mem‹y
,(glm::vec4) * 7);

48 
ªsu…
[0] = 
glm
::
	`vec4
(0.000977,0.000977,0.032227,0.063477);

49 
ªsu…
[1] = 
glm
::
	`vec4
(0.034180,0.000977,0.065430,0.063477);

50 
ªsu…
[2] = 
glm
::
	`vec4
(0.067383,0.000977,0.098633,0.063477);

51 
ªsu…
[3] = 
glm
::
	`vec4
(0.100586,0.000977,0.163086,0.063477);

52 
ªsu…
[4] = 
glm
::
	`vec4
(0.165039,0.000977,0.227539,0.063477);

53 
ªsu…
[5] = 
glm
::
	`vec4
(0.229492,0.000977,0.291992,0.063477);

54 
ªsu…
[6] = 
glm
::
	`vec4
(0.293945,0.000977,0.356445,0.063477);Ñesult;

55 
	}
}

	@textureAssets.h

1 #¥agm®
⁄˚


2 
	~"M©h.h
"

3 
«me•a˚
 
	gãxtuªAs£ts
 {

4 
	eFLOOR


6 
	gFlo‹
,

7 
	gGrûlCŸ
,

8 
	gGrûlHŸ
,

9 
	gOuéöe
,

10 
	gSèú
,

11 
	gSèúˇ£
,

12 
	gSèπ
,

13 
	gT¨gë
,

14 
	gTick
,

15 
	gZBœck
,

16 
	gZBZ


19 
	gglm
::
vec4
* 
FLOOR_posôi⁄s
(
Mem‹y
* 
mem‹y
);

20 
	ePIECE


22 
	gCøã
,

23 
	gCrumbÀ
,

24 
	gCur£dCøã
,

25 
	gCur£dPœyî
,

26 
	gCur£dPuŒCøã
,

27 
	gEm±y
,

28 
	gPœyî
,

29 
	gPuŒCøã
,

30 
	gSt›D
,

31 
	gSt›L
,

32 
	gSt›R
,

33 
	gSt›U
,

34 
	gWÆl
,

35 
	gWÆlA…


38 
	gglm
::
vec4
* 
PIECE_posôi⁄s
(
Mem‹y
* 
mem‹y
);

39 
	eSYMBOLS


41 
	gCú˛e
,

42 
	gHÆfCú˛e
,

43 
	gPlus
,

44 
	gSqu¨e
,

45 
	gTrüngÀ


48 
	gglm
::
vec4
* 
SYMBOLS_posôi⁄s
(
Mem‹y
* 
mem‹y
);

49 
	eUI


51 
	gBuâ⁄Cíãr
,

52 
	gBuâ⁄Le·HÆf
,

53 
	gBuâ⁄RightHÆf
,

54 
	gDownAºow
,

55 
	gLe·Aºow
,

56 
	gRightAºow
,

57 
	gUpAºow


60 
	gglm
::
vec4
* 
UI_posôi⁄s
(
Mem‹y
* 
mem‹y
);

	@tinyfiledialogs.c

98 #i‚de‡
__sun


99 
	#_POSIX_C_SOURCE
 2

	)

102 
	~<°dio.h
>

103 
	~<°dlib.h
>

104 
	~<°rög.h
>

105 
	~<˘y≥.h
>

106 
	~<sys/°©.h
>

108 #ifde‡
_WIN32


109 #ifde‡
__BORLANDC__


110 
	#_gëch
 
gëch


	)

112 #i‚de‡
_WIN32_WINNT


113 
	#_WIN32_WINNT
 0x0500

	)

115 #i‚de‡
TINYFD_NOLIB


116 
	~<wödows.h
>

117 
	~<commdlg.h
>

118 
	~<shlobj.h
>

120 
	~<c⁄io.h
>

121 
	~<dúe˘.h
>

122 
	#TINYFD_NOCCSUNICODE


	)

123 
	#SLASH
 "\\"

	)

125 
	~<limôs.h
>

126 
	~<uni°d.h
>

127 
	~<dúít.h
>

128 
	~<ãrmios.h
>

129 
	~<sys/ut¢ame.h
>

130 
	~<sig«l.h
>

131 
	#SLASH
 "/"

	)

134 
	~"töyfûedülogs.h
"

136 
	#MAX_PATH_OR_CMD
 1024

	)

138 #i‚de‡
MAX_MULTIPLE_FILES


139 
	#MAX_MULTIPLE_FILES
 1024

	)

141 
	#LOW_MULTIPLE_FILES
 32

	)

143 c⁄° 
	gtöyfd_vîsi⁄
[8] = "3.6.3";

148 #ifde‡
_WIN32


151 
	gtöyfd_wöUtf8
 = 1;

158 
	gtöyfd_vîbo£
 = 0 ;

159 
	gtöyfd_sûít
 = 1 ;

160 c⁄° 
	gtöyfd_ÆlowCur£sDülogs
 = 0 ;

162 #i‡
deföed
(
TINYFD_NOLIB
Ë&& deföed(
_WIN32
)

163 
	gtöyfd_f‹˚C⁄sﬁe
 = 1 ;

165 
	gtöyfd_f‹˚C⁄sﬁe
 = 0 ;

173 
	gtöyfd_ª•⁄£
[1024];

187 #i‡
deföed
(
TINYFD_NOLIB
Ë&& deföed(
_WIN32
)

188 
	ggW¨nögDi•œyed
 = 1 ;

190 
	ggW¨nögDi•œyed
 = 0 ;

193 c⁄° 
	ggTôÀ
[]="missing software! (we willÅry basic console input)";

195 #ifde‡
_WIN32


196 c⁄° 
	gtöyfd_√eds
[] = "\
___________\n\
/ \\ \n\
|Åiny file |\n\
| dialogs |\n\
\\_____ ____/\n\
\\|\
\ntiny file dialogs on WindowsÇeeds:\
\ná graphic display\
\nor dialog.exe (enhanced console mode)\
\norá console for basic input";

208 c⁄° 
	gtöyfd_√eds
[] = "\
___________\n\
/ \\ \n\
|Åiny file |\n\
| dialogs |\n\
\\_____ ____/\n\
\\|\
\ntiny file dialogs on UNIXÇeeds:\
\nápplescript\
\nor kdialog\
\nor zenity (or matedialog or qarma)\
\norÖython (2 or 3)\
\n +Åkinter +Öython-dbus (optional)\
\nor dialog (opens console ifÇeeded)\
\nor xterm + bash\
\n (opens console for basic input)\
\norÉxisting console for basic input";

227 #ifde‡
_MSC_VER


228 #¥agm®
w¨nög
(
dißbÀ
:4996)

229 #¥agm®
w¨nög
(
dißbÀ
:4100)

230 #¥agm®
w¨nög
(
dißbÀ
:4706)

233 * 
	$gëCurDú
()

235 
lCurDú
 [
MAX_PATH_OR_CMD
];

236  
	`gëcwd
(
lCurDú
, (lCurDir));

237 
	}
}

239 * 
	$gëP©hWôhoutFöÆSœsh
(

240 * 
aoDe°ö©i⁄
,

241 c⁄° * 
aSour˚
)

243 c⁄° * 
lTmp
 ;

244 i‡–
aSour˚
 )

246 
lTmp
 = 
	`°ºchr
(
aSour˚
, '/');

247 i‡(!
lTmp
)

249 
lTmp
 = 
	`°ºchr
(
aSour˚
, '\\');

251 i‡(
lTmp
)

253 
	`°∫˝y
(
aoDe°ö©i⁄
, 
aSour˚
, 
lTmp
 -áSource );

254 
aoDe°ö©i⁄
[
lTmp
 - 
aSour˚
] = '\0';

258 * 
aoDe°ö©i⁄
 = '\0';

263 * 
aoDe°ö©i⁄
 = '\0';

265  
aoDe°ö©i⁄
;

266 
	}
}

269 * 
	$gëLa°Name
(

270 * 
aoDe°ö©i⁄
,

271 c⁄° * 
aSour˚
)

274 c⁄° * 
lTmp
 ;

275 i‡–
aSour˚
 )

277 
lTmp
 = 
	`°ºchr
(
aSour˚
, '/');

278 i‡(!
lTmp
)

280 
lTmp
 = 
	`°ºchr
(
aSour˚
, '\\');

282 i‡(
lTmp
)

284 
	`°r˝y
(
aoDe°ö©i⁄
, 
lTmp
 + 1);

288 
	`°r˝y
(
aoDe°ö©i⁄
, 
aSour˚
);

293 * 
aoDe°ö©i⁄
 = '\0';

295  
aoDe°ö©i⁄
;

296 
	}
}

299 
	$ísuªFöÆSœsh
–* 
aioSåög
 )

301 i‡–
aioSåög
 && 
	`°æí
(áioString ) )

303 * 
œ°ˇr
 = 
aioSåög
 + 
	`°æí
(áioString ) - 1 ;

304 i‡–
	`°∫cmp
–
œ°ˇr
 , 
SLASH
 , 1 ) )

306 
	`°rˇt
–
œ°ˇr
 , 
SLASH
 ) ;

309 
	}
}

312 
	$Hex2RGB
–c⁄° 
aHexRGB
 [8] ,

313 
aoResu…RGB
 [3] )

315 
lCﬁ‹Ch™√l
 [8] ;

316 i‡–
aoResu…RGB
 )

318 i‡–
aHexRGB
 )

320 
	`°r˝y
(
lCﬁ‹Ch™√l
, 
aHexRGB
 ) ;

321 
aoResu…RGB
[2] = ()
	`°πoul
(
lCﬁ‹Ch™√l
+5,
NULL
,16);

322 
lCﬁ‹Ch™√l
[5] = '\0';

323 
aoResu…RGB
[1] = ()
	`°πoul
(
lCﬁ‹Ch™√l
+3,
NULL
,16);

324 
lCﬁ‹Ch™√l
[3] = '\0';

325 
aoResu…RGB
[0] = ()
	`°πoul
(
lCﬁ‹Ch™√l
+1,
NULL
,16);

330 
aoResu…RGB
[0]=0;

331 
aoResu…RGB
[1]=0;

332 
aoResu…RGB
[2]=0;

335 
	}
}

337 
	$RGB2Hex
–c⁄° 
aRGB
 [3] ,

338 
aoResu…HexRGB
 [8] )

340 i‡–
aoResu…HexRGB
 )

342 i‡–
aRGB
 )

344 #i‡(
	`deföed
(
__˝lu•lus
 ) && __˝lu•lu†>201103LË|| (deföed(
__STDC_VERSION__
Ë&& __STDC_VERSION__ >199901LË|| deföed(
__˛™g__
)

345 
	`•rötf
(
aoResu…HexRGB
, "#%02hhx%02hhx%02hhx", 
aRGB
[0],áRGB[1],áRGB[2]);

347 
	`•rötf
(
aoResu…HexRGB
, "#%02hx%02hx%02hx", 
aRGB
[0],áRGB[1],áRGB[2]);

353 
aoResu…HexRGB
[0]=0;

354 
aoResu…HexRGB
[1]=0;

355 
aoResu…HexRGB
[2]=0;

358 
	}
}

361 
	$ª∂a˚SubSå
–c⁄° * 
aSour˚
 ,

362 c⁄° * 
aOldSubSå
 ,

363 c⁄° * 
aNewSubSå
 ,

364 * 
aoDe°ö©i⁄
 )

366 c⁄° * 
pOccuªn˚
 ;

367 c⁄° * 
p
 ;

368 c⁄° * 
lNewSubSå
 = "" ;

369 
size_t
 
lOldSubLí
 = 
	`°æí
–
aOldSubSå
 ) ;

371 i‡–! 
aSour˚
 )

373 * 
aoDe°ö©i⁄
 = '\0' ;

376 i‡–! 
aOldSubSå
 )

378 
	`°r˝y
–
aoDe°ö©i⁄
 , 
aSour˚
 ) ;

381 i‡–
aNewSubSå
 )

383 
lNewSubSå
 = 
aNewSubSå
 ;

385 
p
 = 
aSour˚
 ;

386 * 
aoDe°ö©i⁄
 = '\0' ;

387  ( 
pOccuªn˚
 = 
	`°r°r
–
p
 , 
aOldSubSå
 ) ) !
NULL
 )

389 
	`°∫ˇt
–
aoDe°ö©i⁄
 , 
p
 , 
pOccuªn˚
 -Ö ) ;

390 
	`°rˇt
–
aoDe°ö©i⁄
 , 
lNewSubSå
 ) ;

391 
p
 = 
pOccuªn˚
 + 
lOldSubLí
 ;

393 
	`°rˇt
–
aoDe°ö©i⁄
 , 
p
 ) ;

394 
	}
}

397 
	$fûíameVÆid
–c⁄° * 
aFûeNameWôhoutP©h
 )

399 i‡–! 
aFûeNameWôhoutP©h


400 || ! 
	`°æí
(
aFûeNameWôhoutP©h
)

401 || 
	`°Ωbrk
(
aFûeNameWôhoutP©h
 , "\\/:*?\"<>|") )

406 
	}
}

408 #i‚de‡
_WIN32


410 
	$fûeExi°s
–c⁄° * 
aFûeP©hAndName
 )

412 
FILE
 * 
lIn
 ;

413 i‡–! 
aFûeP©hAndName
 || ! 
	`°æí
(aFilePathAndName) )

417 
lIn
 = 
	`f›í
–
aFûeP©hAndName
 , "r" ) ;

418 i‡–! 
lIn
 )

422 
	`f˛o£
–
lIn
 ) ;

424 
	}
}

426 #ñi‡
deföed
(
TINYFD_NOLIB
)

428 
	$fûeExi°s
–c⁄° * 
aFûeP©hAndName
 )

430 
FILE
 * 
lIn
 ;

431 i‡–! 
aFûeP©hAndName
 || ! 
	`°æí
(aFilePathAndName) )

436 i‡–
töyfd_wöUtf8
 )

439 
lIn
 = 
	`f›í
–
aFûeP©hAndName
 , "r" ) ;

440 i‡–! 
lIn
 )

444 
	`f˛o£
–
lIn
 ) ;

446 
	}
}

451 
	$wùefûe
(c⁄° * 
aFûíame
)

453 
i
;

454 
°©
 
°
;

455 
FILE
 * 
lIn
;

457 i‡(
	`°©
(
aFûíame
, &
°
) == 0)

459 i‡((
lIn
 = 
	`f›í
(
aFûíame
, "w")))

461 
i
 = 0; i < 
°
.
°_size
; i++)

463 
	`Âutc
('A', 
lIn
);

466 
	`f˛o£
(
lIn
);

468 
	}
}

471 #ifde‡
_WIN32


474 
	$töyfd_£tWöUtf8
(
aIsUtf8
)

476 
töyfd_wöUtf8
 = 
aIsUtf8
;

477 
	}
}

480 
	$ª∂a˚Chr
–* 
aSåög
 ,

481 
aOldChr
 ,

482 
aNewChr
 )

484 * 
p
 ;

485 
lRes
 = 0 ;

487 i‡–! 
aSåög
 )

492 i‡–
aOldChr
 =
aNewChr
 )

497 
p
 = 
aSåög
 ;

498  (
p
 = 
	`°rchr
–∞, 
aOldChr
 )) )

500 * 
p
 = 
aNewChr
 ;

501 
p
 ++ ;

502 
lRes
 = 1 ;

504  
lRes
 ;

505 
	}
}

508 #i‡!
deföed
(
WC_ERR_INVALID_CHARS
)

510 
	#WC_ERR_INVALID_CHARS
 0x00000080

	)

513 
	$sizeUtf16From8
(c⁄° * 
aUtf8°rög
)

515  
	`Mu…iByãToWideCh¨
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
,

516 
aUtf8°rög
, -1, 
NULL
, 0);

517 
	}
}

520 
	$sizeUtf16FromMbcs
(c⁄° * 
aMbcsSåög
)

522  
	`Mu…iByãToWideCh¨
(
CP_ACP
, 
MB_ERR_INVALID_CHARS
,

523 
aMbcsSåög
, -1, 
NULL
, 0);

524 
	}
}

527 
	$sizeUtf8
(
wch¨_t
 c⁄° * 
aUtf16°rög
)

529  
	`WideCh¨ToMu…iByã
(
CP_UTF8
, 
WC_ERR_INVALID_CHARS
,

530 
aUtf16°rög
, -1, 
NULL
, 0, NULL, NULL);

531 
	}
}

534 
	$sizeMbcs
(
wch¨_t
 c⁄° * 
aMbcsSåög
)

536 
lRes
 = 
	`WideCh¨ToMu…iByã
(
CP_ACP
, 0,

537 
aMbcsSåög
, -1, 
NULL
, 0, NULL, NULL);

539  
lRes
;

540 
	}
}

543 
wch¨_t
 * 
	$töyfd_utf8to16
(c⁄° * 
aUtf8°rög
)

545 
wch¨_t
 * 
lUtf16°rög
 = 
NULL
;

546 
lSize
;

548 
	`‰ì
(
lUtf16°rög
);

549 i‡(!
aUtf8°rög
Ë{
lUtf16°rög
 = 
NULL
;  NULL;}

550 
lSize
 = 
	`sizeUtf16From8
(
aUtf8°rög
);

551 
lUtf16°rög
 = (
wch¨_t
 *)
	`mÆloc
(
lSize
 * (wchar_t));

552 
lSize
 = 
	`Mu…iByãToWideCh¨
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
,

553 
aUtf8°rög
, -1, 
lUtf16°rög
, 
lSize
);

554 i‡(
lSize
 == 0)

556 
	`‰ì
(
lUtf16°rög
);

557 
lUtf16°rög
 = 
NULL
;

559  
lUtf16°rög
;

560 
	}
}

563 * 
	$utf16toMbcs
(
wch¨_t
 c⁄° * 
aUtf16°rög
)

565 * 
lMbcsSåög
 = 
NULL
;

566 
lSize
;

568 
	`‰ì
(
lMbcsSåög
);

569 i‡(!
aUtf16°rög
Ë{ 
lMbcsSåög
 = 
NULL
;  NULL; }

570 
lSize
 = 
	`sizeMbcs
(
aUtf16°rög
);

571 
lMbcsSåög
 = (*)
	`mÆloc
(
lSize
);

572 
lSize
 = 
	`WideCh¨ToMu…iByã
(
CP_ACP
, 0,

573 
aUtf16°rög
, -1, 
lMbcsSåög
, 
lSize
, 
NULL
, NULL);

574 i‡(
lSize
 == 0)

576 
	`‰ì
(
lMbcsSåög
);

577 
lMbcsSåög
 = 
NULL
;

579  
lMbcsSåög
;

580 
	}
}

583 * 
	$töyfd_utf8toMbcs
(c⁄° * 
aUtf8°rög
)

585 
wch¨_t
 c⁄° * 
lUtf16°rög
;

586 
lUtf16°rög
 = 
	`töyfd_utf8to16
(
aUtf8°rög
);

587  
	`utf16toMbcs
(
lUtf16°rög
);

588 
	}
}

590 
wch¨_t
 * 
	$mbcsTo16
(c⁄° * 
aMbcsSåög
)

592 
wch¨_t
 * 
lMbcsSåög
 = 
NULL
;

593 
lSize
;

595 
	`‰ì
(
lMbcsSåög
);

596 i‡(!
aMbcsSåög
Ë{ 
lMbcsSåög
 = 
NULL
;  NULL; }

597 
lSize
 = 
	`sizeUtf16FromMbcs
(
aMbcsSåög
);

598 
lMbcsSåög
 = (
wch¨_t
 *)
	`mÆloc
(
lSize
 * (wchar_t));

599 
lSize
 = 
	`Mu…iByãToWideCh¨
(
CP_ACP
, 0,

600 
aMbcsSåög
, -1, 
lMbcsSåög
, 
lSize
);

601 i‡(
lSize
 == 0)

603 
	`‰ì
(
lMbcsSåög
);

604 
lMbcsSåög
 = 
NULL
;

606  
lMbcsSåög
;

607 
	}
}

610 * 
	$töyfd_utf16to8
(
wch¨_t
 c⁄° * 
aUtf16°rög
)

612 * 
lUtf8°rög
 = 
NULL
;

613 
lSize
;

615 
	`‰ì
(
lUtf8°rög
);

616 i‡(!
aUtf16°rög
Ë{ 
lUtf8°rög
 = 
NULL
;  NULL; }

617 
lSize
 = 
	`sizeUtf8
(
aUtf16°rög
);

618 
lUtf8°rög
 = (*)
	`mÆloc
(
lSize
);

619 
lSize
 = 
	`WideCh¨ToMu…iByã
(
CP_UTF8
, 
WC_ERR_INVALID_CHARS
,

620 
aUtf16°rög
, -1, 
lUtf8°rög
, 
lSize
, 
NULL
, NULL);

621 i‡(
lSize
 == 0)

623 
	`‰ì
(
lUtf8°rög
);

624 
lUtf8°rög
 = 
NULL
;

626  
lUtf8°rög
;

627 
	}
}

630 * 
	$mbcsTo8
(c⁄° * 
aMbcsSåög
)

632 
wch¨_t
 c⁄° * 
lUtf16°rög
;

633 
lUtf16°rög
 = 
	`mbcsTo16
(
aMbcsSåög
);

634  
	`töyfd_utf16to8
(
lUtf16°rög
);

635 
	}
}

638 #ifde‡
TINYFD_NOLIB


640 
	$dúExi°s
(c⁄° * 
aDúP©h
)

642 
°©
 
lInfo
;

644 i‡(!
aDúP©h
 || !
	`°æí
(aDirPath))

646 i‡(
	`°©
(
aDúP©h
, &
lInfo
) != 0)

648 i‡–
töyfd_wöUtf8
 )

650 i‡(
lInfo
.
°_mode
 & 
S_IFDIR
)

654 
	}
}

657 
	$töyfd_bìp
()

659 
	`¥ötf
("\a");

660 
	}
}

664 
	$töyfd_bìp
()

666 
	`Bìp
(440,300);

667 
	}
}

670 
	$wùefûeW
(
wch¨_t
 c⁄° * 
aFûíame
)

672 
i
;

673 
_°©
 
°
;

674 
FILE
 * 
lIn
;

676 i‡(
	`_w°©
(
aFûíame
, &
°
) == 0)

678 i‡((
lIn
 = 
	`_wf›í
(
aFûíame
, 
L
"w")))

680 
i
 = 0; i < 
°
.
°_size
; i++)

682 
	`Âutc
('A', 
lIn
);

685 
	`f˛o£
(
lIn
);

687 
	}
}

690 
wch¨_t
 * 
	$gëP©hWôhoutFöÆSœshW
(

691 
wch¨_t
 * 
aoDe°ö©i⁄
,

692 
wch¨_t
 c⁄° * 
aSour˚
)

694 
wch¨_t
 c⁄° * 
lTmp
;

695 i‡(
aSour˚
)

697 
lTmp
 = 
	`wc§chr
(
aSour˚
, 
L
'/');

698 i‡(!
lTmp
)

700 
lTmp
 = 
	`wc§chr
(
aSour˚
, 
L
'\\');

702 i‡(
lTmp
)

704 
	`wc¢˝y
(
aoDe°ö©i⁄
, 
aSour˚
, 
lTmp
 -áSource);

705 
aoDe°ö©i⁄
[
lTmp
 - 
aSour˚
] = 
L
'\0';

709 *
aoDe°ö©i⁄
 = 
L
'\0';

714 *
aoDe°ö©i⁄
 = 
L
'\0';

716  
aoDe°ö©i⁄
;

717 
	}
}

720 
wch¨_t
 * 
	$gëLa°NameW
(

721 
wch¨_t
 * 
aoDe°ö©i⁄
,

722 
wch¨_t
 c⁄° * 
aSour˚
)

725 
wch¨_t
 c⁄° * 
lTmp
;

726 i‡(
aSour˚
)

728 
lTmp
 = 
	`wc§chr
(
aSour˚
, 
L
'/');

729 i‡(!
lTmp
)

731 
lTmp
 = 
	`wc§chr
(
aSour˚
, 
L
'\\');

733 i‡(
lTmp
)

735 
	`wcs˝y
(
aoDe°ö©i⁄
, 
lTmp
 + 1);

739 
	`wcs˝y
(
aoDe°ö©i⁄
, 
aSour˚
);

744 *
aoDe°ö©i⁄
 = 
L
'\0';

746  
aoDe°ö©i⁄
;

747 
	}
}

750 
	$Hex2RGBW
(
wch¨_t
 c⁄° 
aHexRGB
[8],

751 
aoResu…RGB
[3])

753 
wch¨_t
 
lCﬁ‹Ch™√l
[8];

754 i‡(
aoResu…RGB
)

756 i‡(
aHexRGB
)

758 
	`wcs˝y
(
lCﬁ‹Ch™√l
, 
aHexRGB
);

759 
aoResu…RGB
[2] = ()
	`wc°oul
(
lCﬁ‹Ch™√l
 + 5, 
NULL
, 16);

760 
lCﬁ‹Ch™√l
[5] = '\0';

761 
aoResu…RGB
[1] = ()
	`wc°oul
(
lCﬁ‹Ch™√l
 + 3, 
NULL
, 16);

762 
lCﬁ‹Ch™√l
[3] = '\0';

763 
aoResu…RGB
[0] = ()
	`wc°oul
(
lCﬁ‹Ch™√l
 + 1, 
NULL
, 16);

768 
aoResu…RGB
[0] = 0;

769 
aoResu…RGB
[1] = 0;

770 
aoResu…RGB
[2] = 0;

773 
	}
}

776 
	$RGB2HexW
(

777 c⁄° 
aRGB
[3],

778 
wch¨_t
 
aoResu…HexRGB
[8])

780 i‡(
aoResu…HexRGB
)

782 i‡(
aRGB
)

785 
	`sw¥ötf
(
aoResu…HexRGB
,

786 #i‡!
	`deföed
(
__BORLANDC__
Ë&& !deföed(
__TINYC__
Ë&& ( !deföed(
__GNUC__
) || (__GNUC__) >= 5 )

790 #i‡(
	`deföed
(
__˝lu•lus
 ) && __˝lu•lu†>201103LË|| (deföed(
__STDC_VERSION__
Ë&& __STDC_VERSION__ >199901LË|| deföed(
__˛™g__
)

791 
L
"#%02hhx%02hhx%02hhx", 
aRGB
[0],áRGB[1],áRGB[2]);

793 
L
"#%02hx%02hx%02hx", 
aRGB
[0],áRGB[1],áRGB[2]);

798 
aoResu…HexRGB
[0] = 0;

799 
aoResu…HexRGB
[1] = 0;

800 
aoResu…HexRGB
[2] = 0;

803 
	}
}

806 
	$dúExi°s
(c⁄° * 
aDúP©h
)

808 
_°©
 
lInfo
;

809 
wch¨_t
 * 
lTmpWCh¨
;

810 
lSètRë
;

811 
lDúLí
;

813 i‡(!
aDúP©h
)

815 
lDúLí
 = 
	`°æí
(
aDúP©h
);

816 i‡(!
lDúLí
)

818 i‡–(
lDúLí
 =2Ë&& (
aDúP©h
[1] == ':') )

821 i‡(
töyfd_wöUtf8
)

823 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aDúP©h
);

824 
lSètRë
 = 
	`_w°©
(
lTmpWCh¨
, &
lInfo
);

825 i‡(
lSètRë
 != 0)

827 i‡(
lInfo
.
°_mode
 & 
S_IFDIR
)

832 i‡(
	`_°©
(
aDúP©h
, &
lInfo
) != 0)

834 i‡(
lInfo
.
°_mode
 & 
S_IFDIR
)

838 
	}
}

841 
	$fûeExi°s
(c⁄° * 
aFûeP©hAndName
)

843 
_°©
 
lInfo
;

844 
wch¨_t
 * 
lTmpWCh¨
;

845 
lSètRë
;

846 
FILE
 * 
lIn
;

848 i‡(!
aFûeP©hAndName
 || !
	`°æí
(aFilePathAndName))

853 i‡(
töyfd_wöUtf8
)

855 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aFûeP©hAndName
);

856 
lSètRë
 = 
	`_w°©
(
lTmpWCh¨
, &
lInfo
);

857 i‡(
lSètRë
 != 0)

859 i‡(
lInfo
.
°_mode
 & 
_S_IFREG
)

866 
lIn
 = 
	`f›í
(
aFûeP©hAndName
, "r");

867 i‡(!
lIn
)

871 
	`f˛o£
(
lIn
);

874 
	}
}

876 
	$ª∂a˚Wch¨
(
wch¨_t
 * 
aSåög
,

877 
wch¨_t
 
aOldChr
,

878 
wch¨_t
 
aNewChr
)

880 
wch¨_t
 * 
p
;

881 
lRes
 = 0;

883 i‡(!
aSåög
)

888 i‡(
aOldChr
 =
aNewChr
)

893 
p
 = 
aSåög
;

894 (
p
 = 
	`wc§chr
’, 
aOldChr
)))

896 *
p
 = 
aNewChr
;

897 #ifde‡
TINYFD_NOCCSUNICODE


898 
p
++;

900 
p
++;

901 
lRes
 = 1;

903  
lRes
;

904 
	}
}

910 * 
	$ísuªFûesExi°
(* 
aDe°ö©i⁄
,

911 c⁄° * 
aSour˚P©hsAndNames
)

913 * 
lDe°ö©i⁄
 = 
aDe°ö©i⁄
;

914 c⁄° * 
p
;

915 c⁄° * 
p2
;

916 
size_t
 
lLí
;

918 i‡(!
aSour˚P©hsAndNames
)

920  
NULL
;

922 
lLí
 = 
	`°æí
(
aSour˚P©hsAndNames
);

923 i‡(!
lLí
)

925  
NULL
;

928 
p
 = 
aSour˚P©hsAndNames
;

929 (
p2
 = 
	`°rchr
(
p
, '|')Ë!
NULL
)

931 
lLí
 = 
p2
 - 
p
;

932 
	`memmove
(
lDe°ö©i⁄
, 
p
, 
lLí
);

933 
lDe°ö©i⁄
[
lLí
] = '\0';

934 i‡(
	`fûeExi°s
(
lDe°ö©i⁄
))

936 
lDe°ö©i⁄
 +
lLí
;

937 *
lDe°ö©i⁄
 = '|';

938 
lDe°ö©i⁄
++;

940 
p
 = 
p2
 + 1;

942 i‡(
	`fûeExi°s
(
p
))

944 
lLí
 = 
	`°æí
(
p
);

945 
	`memmove
(
lDe°ö©i⁄
, 
p
, 
lLí
);

946 
lDe°ö©i⁄
[
lLí
] = '\0';

950 *(
lDe°ö©i⁄
 - 1) = '\0';

952  
aDe°ö©i⁄
;

953 
	}
}

955 #ifde‡
_WIN32


956 #i‚de‡
TINYFD_NOLIB


958 
__°dˇŒ
 
	$EnumThªadWndProc
(
HWND
 
hwnd
, 
LPARAM
 
lP¨am
)

960 
wch¨_t
 
lTôÀName
[
MAX_PATH
];

961 
	`GëWödowTextW
(
hwnd
, 
lTôÀName
, 
MAX_PATH
);

963 i‡(
	`wcscmp
(
L
"töyfûedülogsT›Wödow", 
lTôÀName
) == 0)

965 
	`SëWödowPos
(
hwnd
, 
HWND_TOPMOST
, 0, 0, 0, 0, 
SWP_NOMOVE
 | 
SWP_NOSIZE
);

969 
	}
}

972 
	$hiddíC⁄sﬁeW
(
wch¨_t
 c⁄° * 
aSåög
, wch¨_àc⁄° * 
aDülogTôÀ
, 
aInFr⁄t
)

974 
STARTUPINFOW
 
SèπupInfo
;

975 
PROCESS_INFORMATION
 
Pro˚ssInfo
;

977 i‡(!
aSåög
 || !
	`wc¶í
(aString) ) ;

979 
	`mem£t
(&
SèπupInfo
, 0, (StartupInfo));

980 
SèπupInfo
.
cb
 = (
STARTUPINFOW
);

981 
SèπupInfo
.
dwFœgs
 = 
STARTF_USESHOWWINDOW
;

982 
SèπupInfo
.
wShowWödow
 = 
SW_HIDE
;

984 i‡(!
	`Cª©ePro˚ssW
(
NULL
, (
LPWSTR
)
aSåög
, NULL, NULL, 
FALSE
,

985 
CREATE_NEW_CONSOLE
, 
NULL
, NULL,

986 &
SèπupInfo
, &
Pro˚ssInfo
))

991 
	`WaôF‹I≈utIdÀ
(
Pro˚ssInfo
.
hPro˚ss
, 
INFINITE
);

992 i‡(
aInFr⁄t
)

994 
	`EnumWödows
(
EnumThªadWndProc
, (
LPARAM
)
NULL
)) {}

995 
	`SëWödowTextW
(
	`GëF‹egroundWödow
(), 
aDülogTôÀ
);

997 
	`WaôF‹SögÀObje˘
(
Pro˚ssInfo
.
hPro˚ss
, 
INFINITE
);

998 
	`Clo£H™dÀ
(
Pro˚ssInfo
.
hThªad
);

999 
	`Clo£H™dÀ
(
Pro˚ssInfo
.
hPro˚ss
);

1000 
	}
}

1003 
	$töyfd_mesßgeBoxW
(

1004 
wch¨_t
 c⁄° * 
aTôÀ
,

1005 
wch¨_t
 c⁄° * 
aMesßge
,

1006 
wch¨_t
 c⁄° * 
aDülogTy≥
,

1007 
wch¨_t
 c⁄° * 
aIc⁄Ty≥
,

1008 
aDeÁu…Buâ⁄
)

1010 
lBoxRëu∫VÆue
;

1011 
UINT
 
aCode
;

1013 i‡(
aTôÀ
&&!
	`wcscmp
◊TôÀ, 
L
"töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "windows_wchar");  1; }

1015 i‡(
aIc⁄Ty≥
 && !
	`wcscmp
(
L
"warning",áIconType))

1017 
aCode
 = 
MB_ICONWARNING
;

1019 i‡(
aIc⁄Ty≥
 && !
	`wcscmp
(
L
"error",áIconType))

1021 
aCode
 = 
MB_ICONERROR
;

1023 i‡(
aIc⁄Ty≥
 && !
	`wcscmp
(
L
"question",áIconType))

1025 
aCode
 = 
MB_ICONQUESTION
;

1029 
aCode
 = 
MB_ICONINFORMATION
;

1032 i‡(
aDülogTy≥
 && !
	`wcscmp
(
L
"okcancel",áDialogType))

1034 
aCode
 +
MB_OKCANCEL
;

1035 i‡(!
aDeÁu…Buâ⁄
)

1037 
aCode
 +
MB_DEFBUTTON2
;

1040 i‡(
aDülogTy≥
 && !
	`wcscmp
(
L
"yesno",áDialogType))

1042 
aCode
 +
MB_YESNO
;

1043 i‡(!
aDeÁu…Buâ⁄
)

1045 
aCode
 +
MB_DEFBUTTON2
;

1050 
aCode
 +
MB_OK
;

1053 
aCode
 +
MB_TOPMOST
;

1055 
lBoxRëu∫VÆue
 = 
	`MesßgeBoxW
(
	`GëF‹egroundWödow
(), 
aMesßge
, 
aTôÀ
, 
aCode
);

1056 i‡(((
aDülogTy≥


1057 && 
	`wcscmp
(
L
"okˇn˚l", 
aDülogTy≥
)

1058 && 
	`wcscmp
(
L
"ye¢o", 
aDülogTy≥
)))

1059 || (
lBoxRëu∫VÆue
 =
IDOK
)

1060 || (
lBoxRëu∫VÆue
 =
IDYES
))

1068 
	}
}

1071 
	$mesßgeBoxWöGui8
(

1072 c⁄° * 
aTôÀ
,

1073 c⁄° * 
aMesßge
,

1074 c⁄° * 
aDülogTy≥
,

1075 c⁄° * 
aIc⁄Ty≥
,

1076 
aDeÁu…Buâ⁄
)

1078 
lI¡RëVÆ
;

1079 
wch¨_t
 
lTôÀ
 [128] = 
L
"";

1080 
wch¨_t
 * 
lMesßge
 = 
NULL
;

1081 
wch¨_t
 
lDülogTy≥
 [16] = 
L
"";

1082 
wch¨_t
 
lIc⁄Ty≥
 [16] = 
L
"";

1083 
wch¨_t
 * 
lTmpWCh¨
;

1085 i‡(
aTôÀ
)

1087 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aTôÀ
);

1088 
	`wcs˝y
(
lTôÀ
, 
lTmpWCh¨
);

1090 i‡(
aMesßge
)

1092 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aMesßge
);

1093 
lMesßge
 = 
	`mÆloc
((
	`wc¶í
(
lTmpWCh¨
Ë+ 1)* (
wch¨_t
));

1094 
	`wcs˝y
(
lMesßge
, 
lTmpWCh¨
);

1096 i‡(
aDülogTy≥
)

1098 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aDülogTy≥
);

1099 
	`wcs˝y
(
lDülogTy≥
, 
lTmpWCh¨
);

1101 i‡(
aIc⁄Ty≥
)

1103 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aIc⁄Ty≥
);

1104 
	`wcs˝y
(
lIc⁄Ty≥
, 
lTmpWCh¨
);

1107 
lI¡RëVÆ
 = 
	`töyfd_mesßgeBoxW
(
lTôÀ
, 
lMesßge
,
lDülogTy≥
, 
lIc⁄Ty≥
, 
aDeÁu…Buâ⁄
 );

1109 
	`‰ì
(
lMesßge
);

1111  
lI¡RëVÆ
 ;

1112 
	}
}

1116 
	$töyfd_nŸifyP›upW
(

1117 
wch¨_t
 c⁄° * 
aTôÀ
,

1118 
wch¨_t
 c⁄° * 
aMesßge
,

1119 
wch¨_t
 c⁄° * 
aIc⁄Ty≥
)

1121 
wch¨_t
 * 
lDülogSåög
;

1122 
size_t
 
lTôÀLí
;

1123 
size_t
 
lMesßgeLí
;

1124 
size_t
 
lDülogSåögLí
;

1126 i‡(
aTôÀ
&&!
	`wcscmp
◊TôÀ, 
L
"töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "windows_wchar");  1; }

1128 
lTôÀLí
 = 
aTôÀ
 ? 
	`wc¶í
(aTitle) : 0;

1129 
lMesßgeLí
 = 
aMesßge
 ? 
	`wc¶í
(aMessage) : 0;

1130 
lDülogSåögLí
 = 3 * 
MAX_PATH_OR_CMD
 + 
lTôÀLí
 + 
lMesßgeLí
;

1131 
lDülogSåög
 = (
wch¨_t
 *)
	`mÆloc
(2 * 
lDülogSåögLí
);

1133 
	`wcs˝y
(
lDülogSåög
, 
L
"powershell.exe -command \"\
 Show-BalloonTip {\
[cmdletbinding()] \
( \
[string]$Title = ' ', \
[string]$Message = ' ', \
[ValidateSet('info', 'warning', 'error')] \
[string]$IconType = 'info');\
[system.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms') | Out-Null ; \
$balloon = New-Object System.Windows.Forms.NotifyIcon ; \
$path = Get-Process -id $pid | Select-Object -ExpandProperty Path ; \
$icon = [System.Drawing.Icon]::ExtractAssociatedIcon($path) ;");

1146 
	`wcsˇt
(
lDülogSåög
, 
L
"\
$balloon.Icon = $icon ; \
$balloon.BalloonTipIcon = $IconType ; \
$balloon.BalloonTipText = $Message ; \
$balloon.BalloonTipTitle = $Title ; \
$balloon.Text = 'lalala' ; \
$balloon.Visible = $true ; \
$balloon.ShowBalloonTip(5000)};\
-BalloonTip");

1156 i‡(
aTôÀ
 && 
	`wc¶í
(aTitle))

1158 
	`wcsˇt
(
lDülogSåög
, 
L
" -Title '");

1159 
	`wcsˇt
(
lDülogSåög
, 
aTôÀ
);

1160 
	`wcsˇt
(
lDülogSåög
, 
L
"'");

1162 i‡(
aMesßge
 && 
	`wc¶í
(aMessage))

1164 
	`wcsˇt
(
lDülogSåög
, 
L
" -Message '");

1165 
	`wcsˇt
(
lDülogSåög
, 
aMesßge
);

1166 
	`wcsˇt
(
lDülogSåög
, 
L
"'");

1168 i‡(
aMesßge
 && 
	`wc¶í
(
aIc⁄Ty≥
))

1170 
	`wcsˇt
(
lDülogSåög
, 
L
" -IconType '");

1171 
	`wcsˇt
(
lDülogSåög
, 
aIc⁄Ty≥
);

1172 
	`wcsˇt
(
lDülogSåög
, 
L
"'");

1174 
	`wcsˇt
(
lDülogSåög
, 
L
"\"");

1178 
	`hiddíC⁄sﬁeW
(
lDülogSåög
, 
aTôÀ
, 0);

1179 
	`‰ì
(
lDülogSåög
);

1181 
	}
}

1184 
	$nŸifyWöGui
(

1185 c⁄° * 
aTôÀ
,

1186 c⁄° * 
aMesßge
,

1187 c⁄° * 
aIc⁄Ty≥
)

1189 
wch¨_t
 
lTôÀ
 [128] = 
L
"";

1190 
wch¨_t
 * 
lMesßge
 = 
NULL
;

1191 
wch¨_t
 
lIc⁄Ty≥
[16] = 
L
"";

1192 
wch¨_t
 * 
lTmpWCh¨
;

1194 i‡(
töyfd_wöUtf8
)

1196 i‡(
aTôÀ
)

1198 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aTôÀ
);

1199 
	`wcs˝y
(
lTôÀ
, 
lTmpWCh¨
);

1201 i‡(
aMesßge
)

1203 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aMesßge
);

1204 
lMesßge
 = 
	`mÆloc
((
	`wc¶í
(
lTmpWCh¨
Ë+ 1)* (
wch¨_t
));

1205 
	`wcs˝y
(
lMesßge
, 
lTmpWCh¨
);

1207 i‡(
aIc⁄Ty≥
)

1209 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aIc⁄Ty≥
);

1210 
	`wcs˝y
(
lIc⁄Ty≥
, 
lTmpWCh¨
);

1215 i‡(
aTôÀ
)

1217 
lTmpWCh¨
 = 
	`mbcsTo16
(
aTôÀ
);

1218 
	`wcs˝y
(
lTôÀ
, 
lTmpWCh¨
);

1220 i‡(
aMesßge
)

1222 
lTmpWCh¨
 = 
	`mbcsTo16
(
aMesßge
);

1223 
lMesßge
 = 
	`mÆloc
((
	`wc¶í
(
lTmpWCh¨
Ë+ 1)* (
wch¨_t
));

1224 
	`wcs˝y
(
lMesßge
, 
lTmpWCh¨
);

1226 i‡(
aIc⁄Ty≥
)

1228 
lTmpWCh¨
 = 
	`mbcsTo16
(
aIc⁄Ty≥
);

1229 
	`wcs˝y
(
lIc⁄Ty≥
, 
lTmpWCh¨
);

1233 
	`töyfd_nŸifyP›upW
–
lTôÀ
, 
lMesßge
, 
lIc⁄Ty≥
);

1235 
	`‰ì
(
lMesßge
);

1238 
	}
}

1241 
wch¨_t
 * 
	$töyfd_öputBoxW
(

1242 
wch¨_t
 c⁄° * 
aTôÀ
,

1243 
wch¨_t
 c⁄° * 
aMesßge
,

1244 
wch¨_t
 c⁄° * 
aDeÁu…I≈ut
)

1246 
wch¨_t
 
lBuff
[
MAX_PATH_OR_CMD
];

1247 
wch¨_t
 * 
lDülogSåög
;

1248 
FILE
 * 
lIn
;

1249 
FILE
 * 
lFûe
;

1250 
lResu…
;

1251 
size_t
 
lTôÀLí
;

1252 
size_t
 
lMesßgeLí
;

1253 
size_t
 
lDülogSåögLí
;

1255 i‡(
aTôÀ
&&!
	`wcscmp
◊TôÀ, 
L
"töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "wödows_wch¨");  (
wch¨_t
 *)1; }

1257 
lTôÀLí
 = 
aTôÀ
 ? 
	`wc¶í
(aTitle) : 0 ;

1258 
lMesßgeLí
 = 
aMesßge
 ? 
	`wc¶í
(aMessage) : 0 ;

1259 
lDülogSåögLí
 = 3 * 
MAX_PATH_OR_CMD
 + 
lTôÀLí
 + 
lMesßgeLí
;

1260 
lDülogSåög
 = (
wch¨_t
 *)
	`mÆloc
(2 * 
lDülogSåögLí
);

1262 i‡(
aDeÁu…I≈ut
)

1264 
	`sw¥ötf
(
lDülogSåög
,

1265 #i‡!
	`deföed
(
__BORLANDC__
Ë&& !deföed(
__TINYC__
Ë&& ( !deföed(
__GNUC__
) || (__GNUC__) >= 5 )

1266 
lDülogSåögLí
,

1268 
L
"%ls\\AµD©a\\Loˇl\\Temp\\töyfd.vbs", 
	`_wgëív
(L"USERPROFILE"));

1272 
	`sw¥ötf
(
lDülogSåög
,

1273 #i‡!
	`deföed
(
__BORLANDC__
Ë&& !deföed(
__TINYC__
Ë&& ( !deföed(
__GNUC__
) || (__GNUC__) >= 5 )

1274 
lDülogSåögLí
,

1276 
L
"%ls\\AµD©a\\Loˇl\\Temp\\töyfd.hè", 
	`_wgëív
(L"USERPROFILE"));

1278 
lIn
 = 
	`_wf›í
(
lDülogSåög
, 
L
"w");

1279 i‡(!
lIn
)

1281 
	`‰ì
(
lDülogSåög
);

1282  
NULL
;

1285 i‡–
aDeÁu…I≈ut
 )

1287 
	`wcs˝y
(
lDülogSåög
, 
L
"DimÑesult:result=InputBox(\"");

1288 i‡(
aMesßge
 && 
	`wc¶í
(aMessage))

1290 
	`wcs˝y
(
lBuff
, 
aMesßge
);

1291 
	`ª∂a˚Wch¨
(
lBuff
, 
L
'\n', L' ');

1292 
	`wcsˇt
(
lDülogSåög
, 
lBuff
);

1294 
	`wcsˇt
(
lDülogSåög
, 
L
"\",\"tinyfiledialogsTopWindow\",\"");

1295 i‡(
aDeÁu…I≈ut
 && 
	`wc¶í
(aDefaultInput))

1297 
	`wcs˝y
(
lBuff
, 
aDeÁu…I≈ut
);

1298 
	`ª∂a˚Wch¨
(
lBuff
, 
L
'\n', L' ');

1299 
	`wcsˇt
(
lDülogSåög
, 
lBuff
);

1301 
	`wcsˇt
(
lDülogSåög
, 
L
"\"):If IsEmpty(result)Åhen:WScript.Echo 0");

1302 
	`wcsˇt
(
lDülogSåög
, 
L
":Else: WScript.Echo \"1\" &Ñesult : End If");

1306 
	`wcs˝y
(
lDülogSåög
, 
L
"\n\
<html>\n\
<head>\n\
<title>");

1311 
	`wcsˇt
(
lDülogSåög
, 
L
"tinyfiledialogsTopWindow");

1312 
	`wcsˇt
(
lDülogSåög
, 
L
"</title>\n\
<HTA:APPLICATION\n\
 = 'tinyfdHTA'\n\
 = 'tinyfd_inputBox'\n\
 = 'no'\n\
 = 'no'\n\
 = 'dialog'\n\
 = 'no'\n\
 = 'yes'\n\
 = 'hidden'>\n\
\n\
<scriptÜanguage = 'VBScript'>\n\
\n\
 = Screen.Width/4\n\
 = Screen.Height/6\n\
 intWidth, intHeight\n\
((Screen.Width/2)-(intWidth/2)),((Screen.Height/2)-(intHeight/2))\n\
 = 0\n\
\n\
 Window_onLoad\n\
_input.Focus\n\
 Sub\n\
\n");

1336 
	`wcsˇt
(
lDülogSåög
, 
L
"\
 Window_onUnload\n\
 objFSO = CreateObject(\"Scripting.FileSystemObject\")\n\
 oShell = CreateObject(\"WScript.Shell\")\n\
 = oShell.ExpandEnvironmentStrings(\"%USERPROFILE%\")\n\
 objFile = objFSO.CreateTextFile(strHomeFolder & \"\\AppData\\Local\\Temp\\tinyfd.txt\",True,True)\n\
Ñesult = 1 Then\n\
.Write 1 &Åxt_input.Value\n\
\n\
.Write 0\n\
 If\n\
.Close\n\
 Sub\n\
\n\
 Run_ProgramOK\n\
 = 1\n\
.Close\n\
 Sub\n\
\n\
 Run_ProgramCancel\n\
.Close\n\
 Sub\n\
\n");

1360 
	`wcsˇt
(
lDülogSåög
, 
L
"Sub Default_Buttons\n\
 Window.Event.KeyCode = 13 Then\n\
_OK.Click\n\
 Window.Event.KeyCode = 27 Then\n\
_Cancel.Click\n\
 If\n\
 Sub\n\
\n\
</script>\n\
</head>\n\
<body style = 'background-color:#EEEEEE' onkeypress = 'vbs:Default_Buttons'álign = 'top'>\n\
<table width = '100%' height = '80%'álign = 'center' border = '0'>\n\
<tr border = '0'>\n\
<tdálign = 'left' valign = 'middle' style='Font-Family:Arial'>\n");

1375 
	`wcsˇt
(
lDülogSåög
, 
aMesßge
 ?áMesßgê: 
L
"");

1377 
	`wcsˇt
(
lDülogSåög
, 
L
"\n\
</td>\n\
<tdálign = 'right' valign = 'middle' style = 'margin-top: 0em'>\n\
<tableálign = 'right' style = 'margin-right: 0em;'>\n\
<trálign = 'right' style = 'margin-top: 5em;'>\n\
<inputÅype = 'button' value = 'OK'Çame = 'btn_OK' onClick = 'vbs:Run_ProgramOK' style = 'width: 5em; margin-top: 2em;'><br>\n\
<inputÅype = 'button' value = 'Cancel'Çame = 'btn_Cancel' onClick = 'vbs:Run_ProgramCancel' style = 'width: 5em;'><br><br>\n\
</tr>\n\
</table>\n\
</td>\n\
</tr>\n\
</table>\n");

1390 
	`wcsˇt
(
lDülogSåög
, 
L
"<table width = '100%' height = '100%'álign = 'center' border = '0'>\n\
<tr>\n\
<tdálign = 'left' valign = 'top'>\n\
<inputÅype = 'password' id = 'txt_input'\n\
 = 'txt_input' value = '' style = 'float:left;width:100%' ><BR>\n\
</td>\n\
</tr>\n\
</table>\n\
</body>\n\
</html>\n\
" ) ;

1402 
	`Âutws
(
lDülogSåög
, 
lIn
);

1403 
	`f˛o£
(
lIn
);

1405 i‡(
aDeÁu…I≈ut
)

1407 
	`sw¥ötf
(
lDülogSåög
,

1408 #i‡!
	`deföed
(
__BORLANDC__
Ë&& !deföed(
__TINYC__
Ë&& ( !deföed(
__GNUC__
) || (__GNUC__) >= 5 )

1409 
lDülogSåögLí
,

1411 
L
"%ls\\AµD©a\\Loˇl\\Temp\\töyfd.txt",
	`_wgëív
(L"USERPROFILE"));

1413 #ifde‡
TINYFD_NOCCSUNICODE


1414 
lFûe
 = 
	`_wf›í
(
lDülogSåög
, 
L
"w");

1415 
	`Âutc
(0xFF, 
lFûe
);

1416 
	`Âutc
(0xFE, 
lFûe
);

1418 
lFûe
 = 
	`_wf›í
(
lDülogSåög
, 
L
"wt, ccs=UNICODE");

1420 
	`f˛o£
(
lFûe
);

1422 
	`wcs˝y
(
lDülogSåög
, 
L
"cmd.exe /c cscript.exe //U //Nologo ");

1423 
	`wcsˇt
(
lDülogSåög
, 
L
"\"%USERPROFILE%\\AppData\\Local\\Temp\\tinyfd.vbs\" ");

1424 
	`wcsˇt
(
lDülogSåög
, 
L
">> \"%USERPROFILE%\\AppData\\Local\\Temp\\tinyfd.txt\"");

1428 
	`wcs˝y
(
lDülogSåög
,

1429 
L
"cmd.exe /c mshta.exe \"%USERPROFILE%\\AppData\\Local\\Temp\\tinyfd.hta\"");

1434 
	`hiddíC⁄sﬁeW
(
lDülogSåög
, 
aTôÀ
, 1);

1436 
	`sw¥ötf
(
lDülogSåög
,

1437 #i‡!
	`deföed
(
__BORLANDC__
Ë&& !deföed(
__TINYC__
Ë&& ( !deföed(
__GNUC__
) || (__GNUC__) >= 5 )

1438 
lDülogSåögLí
,

1440 
L
"%ls\\AµD©a\\Loˇl\\Temp\\töyfd.txt", 
	`_wgëív
(L"USERPROFILE"));

1442 #ifde‡
TINYFD_NOCCSUNICODE


1443 i‡(!(
lIn
 = 
	`_wf›í
(
lDülogSåög
, 
L
"r")))

1445 i‡(!(
lIn
 = 
	`_wf›í
(
lDülogSåög
, 
L
"rt, ccs=UNICODE")))

1448 
	`_wªmove
(
lDülogSåög
);

1449 
	`‰ì
(
lDülogSåög
);

1450  
NULL
;

1453 
	`mem£t
(
lBuff
, 0, 
MAX_PATH_OR_CMD
 * (
wch¨_t
) );

1455 #ifde‡
TINYFD_NOCCSUNICODE


1456 
	`fgës
((*)
lBuff
, 2*
MAX_PATH_OR_CMD
, 
lIn
);

1458 
	`fgëws
(
lBuff
, 
MAX_PATH_OR_CMD
, 
lIn
);

1460 
	`f˛o£
(
lIn
);

1461 
	`wùefûeW
(
lDülogSåög
);

1462 
	`_wªmove
(
lDülogSåög
);

1464 i‡(
aDeÁu…I≈ut
)

1466 
	`sw¥ötf
(
lDülogSåög
,

1467 #i‡!
	`deföed
(
__BORLANDC__
Ë&& !deföed(
__TINYC__
Ë&& ( !deföed(
__GNUC__
) || (__GNUC__) >= 5 )

1468 
lDülogSåögLí
,

1470 
L
"%ls\\AppData\\Local\\Temp\\tinyfd.vbs",

1471 
	`_wgëív
(
L
"USERPROFILE"));

1475 
	`sw¥ötf
(
lDülogSåög
,

1476 #i‡!
	`deföed
(
__BORLANDC__
Ë&& !deföed(
__TINYC__
Ë&& ( !deföed(
__GNUC__
) || (__GNUC__) >= 5 )

1477 
lDülogSåögLí
,

1479 
L
"%ls\\AppData\\Local\\Temp\\tinyfd.hta",

1480 
	`_wgëív
(
L
"USERPROFILE"));

1482 
	`_wªmove
(
lDülogSåög
);

1483 
	`‰ì
(
lDülogSåög
);

1485 #ifde‡
TINYFD_NOCCSUNICODE


1486 
lResu…
 = !
	`wc¢cmp
(
lBuff
+1, 
L
"1", 1);

1488 
lResu…
 = !
	`wc¢cmp
(
lBuff
, 
L
"1", 1);

1492 i‡(!
lResu…
)

1494  
NULL
 ;

1499 #ifde‡
TINYFD_NOCCSUNICODE


1500 i‡(
aDeÁu…I≈ut
)

1502 
lDülogSåögLí
 = 
	`wc¶í
(
lBuff
) ;

1503 
lBuff
[
lDülogSåögLí
 - 1] = 
L
'\0';

1504 
lBuff
[
lDülogSåögLí
 - 2] = 
L
'\0';

1506  
lBuff
 + 2;

1508 i‡(
aDeÁu…I≈ut
Ë
lBuff
[
	`wc¶í
÷BuffË- 1] = 
L
'\0';

1509  
lBuff
 + 1;

1511 
	}
}

1514 
	$öputBoxWöGui
(

1515 * 
aoBuff
,

1516 c⁄° * 
aTôÀ
,

1517 c⁄° * 
aMesßge
,

1518 c⁄° * 
aDeÁu…I≈ut
)

1520 
wch¨_t
 
lTôÀ
 [128] = 
L
"";

1521 
wch¨_t
 * 
lMesßge
 = 
NULL
;

1522 
wch¨_t
 
lDeÁu…I≈ut
[
MAX_PATH_OR_CMD
] = 
L
"";

1523 
wch¨_t
 * 
lTmpWCh¨
;

1524 * 
lTmpCh¨
;

1526 i‡(
töyfd_wöUtf8
)

1528 i‡(
aTôÀ
)

1530 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aTôÀ
);

1531 
	`wcs˝y
(
lTôÀ
, 
lTmpWCh¨
);

1533 i‡(
aMesßge
)

1535 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aMesßge
);

1536 
lMesßge
 = 
	`mÆloc
((
	`wc¶í
(
lTmpWCh¨
Ë+ 1)* (
wch¨_t
));

1537 
	`wcs˝y
(
lMesßge
, 
lTmpWCh¨
);

1539 i‡(
aDeÁu…I≈ut
)

1541 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aDeÁu…I≈ut
);

1542 
	`wcs˝y
(
lDeÁu…I≈ut
, 
lTmpWCh¨
);

1547 i‡(
aTôÀ
)

1549 
lTmpWCh¨
 = 
	`mbcsTo16
(
aTôÀ
);

1550 
	`wcs˝y
(
lTôÀ
, 
lTmpWCh¨
);

1552 i‡(
aMesßge
)

1554 
lTmpWCh¨
 = 
	`mbcsTo16
(
aMesßge
);

1555 
lMesßge
 = 
	`mÆloc
((
	`wc¶í
(
lTmpWCh¨
Ë+ 1)* (
wch¨_t
));

1556 
	`wcs˝y
(
lMesßge
, 
lTmpWCh¨
);

1558 i‡(
aDeÁu…I≈ut
)

1560 
lTmpWCh¨
 = 
	`mbcsTo16
(
aDeÁu…I≈ut
);

1561 
	`wcs˝y
(
lDeÁu…I≈ut
, 
lTmpWCh¨
);

1565 
lTmpWCh¨
 = 
	`töyfd_öputBoxW
–
lTôÀ
, 
lMesßge
, 
lDeÁu…I≈ut
);

1567 
	`‰ì
(
lMesßge
);

1569 i‡(!
lTmpWCh¨
)

1571 
aoBuff
[0] = '\0';

1575 i‡(
töyfd_wöUtf8
)

1577 
lTmpCh¨
 = 
	`töyfd_utf16to8
(
lTmpWCh¨
);

1581 
lTmpCh¨
 = 
	`utf16toMbcs
(
lTmpWCh¨
);

1583 
	`°r˝y
(
aoBuff
, 
lTmpCh¨
);

1586 
	}
}

1589 
wch¨_t
 * 
	$töyfd_ßveFûeDülogW
(

1590 
wch¨_t
 c⁄° * 
aTôÀ
,

1591 
wch¨_t
 c⁄° * 
aDeÁu…P©hAndFûe
,

1592 
aNumOfFûãrP©ã∫s
,

1593 
wch¨_t
 c⁄° * c⁄° * 
aFûãrP©ã∫s
,

1594 
wch¨_t
 c⁄° * 
aSögÀFûãrDes¸ùti⁄
)

1596 
wch¨_t
 
lBuff
[
MAX_PATH_OR_CMD
];

1597 
wch¨_t
 
lDú«me
[
MAX_PATH_OR_CMD
];

1598 
wch¨_t
 
lDülogSåög
[
MAX_PATH_OR_CMD
];

1599 
wch¨_t
 
lFûãrP©ã∫s
[
MAX_PATH_OR_CMD
] = 
L
"";

1600 
wch¨_t
 * 
p
;

1601 
wch¨_t
 * 
lRëvÆ
;

1602 
wch¨_t
 c⁄° * 
ldefExt
 = 
NULL
;

1603 
i
;

1604 
HRESULT
 
lHResu…
;

1605 
OPENFILENAMEW
 
o‚
 = {0};

1607 i‡(
aTôÀ
&&!
	`wcscmp
◊TôÀ, 
L
"töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "wödows_wch¨");  (
wch¨_t
 *)1; }

1609 
lHResu…
 = 
	`CoInôülizeEx
(
NULL
, 0);

1611 
	`gëP©hWôhoutFöÆSœshW
(
lDú«me
, 
aDeÁu…P©hAndFûe
);

1612 
	`gëLa°NameW
(
lBuff
, 
aDeÁu…P©hAndFûe
);

1614 i‡(
aNumOfFûãrP©ã∫s
 > 0)

1616 
ldefExt
 = 
aFûãrP©ã∫s
[0];

1618 i‡(
aSögÀFûãrDes¸ùti⁄
 && 
	`wc¶í
(aSingleFilterDescription))

1620 
	`wcs˝y
(
lFûãrP©ã∫s
, 
aSögÀFûãrDes¸ùti⁄
);

1621 
	`wcsˇt
(
lFûãrP©ã∫s
, 
L
"\n");

1623 
	`wcsˇt
(
lFûãrP©ã∫s
, 
aFûãrP©ã∫s
[0]);

1624 
i
 = 1; i < 
aNumOfFûãrP©ã∫s
; i++)

1626 
	`wcsˇt
(
lFûãrP©ã∫s
, 
L
";");

1627 
	`wcsˇt
(
lFûãrP©ã∫s
, 
aFûãrP©ã∫s
[
i
]);

1629 
	`wcsˇt
(
lFûãrP©ã∫s
, 
L
"\n");

1630 i‡(!(
aSögÀFûãrDes¸ùti⁄
 && 
	`wc¶í
(aSingleFilterDescription)))

1632 
	`wcs˝y
(
lDülogSåög
, 
lFûãrP©ã∫s
);

1633 
	`wcsˇt
(
lFûãrP©ã∫s
, 
lDülogSåög
);

1635 
	`wcsˇt
(
lFûãrP©ã∫s
, 
L
"All Files\n*.*\n");

1636 
p
 = 
lFûãrP©ã∫s
;

1637 (
p
 = 
	`wcschr
’, 
L
'\n')Ë!
NULL
)

1639 *
p
 = 
L
'\0';

1640 
p
++;

1644 
o‚
.
lSåu˘Size
 = (
OPENFILENAMEW
);

1645 
o‚
.
hwndOw√r
 = 
	`GëF‹egroundWödow
();

1646 
o‚
.
hIn°™˚
 = 0;

1647 
o‚
.
Õ°rFûãr
 = 
	`wc¶í
(
lFûãrP©ã∫s
Ë?ÜFûãrP©ã∫†: 
NULL
;

1648 
o‚
.
Õ°rCu°omFûãr
 = 
NULL
;

1649 
o‚
.
nMaxCu°Fûãr
 = 0;

1650 
o‚
.
nFûãrIndex
 = 1;

1651 
o‚
.
Õ°rFûe
 = 
lBuff
;

1653 
o‚
.
nMaxFûe
 = 
MAX_PATH_OR_CMD
;

1654 
o‚
.
Õ°rFûeTôÀ
 = 
NULL
;

1655 
o‚
.
nMaxFûeTôÀ
 = 
MAX_PATH_OR_CMD
/2;

1656 
o‚
.
Õ°rInôülDú
 = 
	`wc¶í
(
lDú«me
Ë?ÜDú«mê: 
NULL
;

1657 
o‚
.
Õ°rTôÀ
 = 
aTôÀ
 && 
	`wc¶í
◊TôÀË?áTôÀ : 
NULL
;

1658 
o‚
.
Fœgs
 = 
OFN_OVERWRITEPROMPT
 | 
OFN_NOCHANGEDIR
 | 
OFN_PATHMUSTEXIST
 ;

1659 
o‚
.
nFûeOff£t
 = 0;

1660 
o‚
.
nFûeExãnsi⁄
 = 0;

1661 
o‚
.
Õ°rDefExt
 = 
ldefExt
;

1662 
o‚
.
lCu°D©a
 = 0L;

1663 
o‚
.
Õ‚Hook
 = 
NULL
;

1664 
o‚
.
ÕTem∂©eName
 = 
NULL
;

1666 i‡(
	`GëSaveFûeNameW
(&
o‚
) == 0)

1668 
lRëvÆ
 = 
NULL
;

1672 
lRëvÆ
 = 
lBuff
;

1675 i‡(
lHResu…
 =
S_OK
 ||ÜHResu… =
S_FALSE
)

1677 
	`CoUnöôülize
();

1679  
lRëvÆ
;

1680 
	}
}

1683 * 
	$ßveFûeDülogWöGui8
(

1684 * 
aoBuff
,

1685 c⁄° * 
aTôÀ
,

1686 c⁄° * 
aDeÁu…P©hAndFûe
,

1687 
aNumOfFûãrP©ã∫s
,

1688 c⁄° * c⁄° * 
aFûãrP©ã∫s
,

1689 c⁄° * 
aSögÀFûãrDes¸ùti⁄
)

1691 
wch¨_t
 
lTôÀ
 [128] = 
L
"";

1692 
wch¨_t
 
lDeÁu…P©hAndFûe
 [
MAX_PATH_OR_CMD
] = 
L
"";

1693 
wch¨_t
 
lSögÀFûãrDes¸ùti⁄
 [128] = 
L
"";

1694 
wch¨_t
 * * 
lFûãrP©ã∫s
;

1695 
wch¨_t
 * 
lTmpWCh¨
;

1696 * 
lTmpCh¨
;

1697 
i
 ;

1699 
lFûãrP©ã∫s
 = (
wch¨_t
 **Ë
	`mÆloc
(
aNumOfFûãrP©ã∫s
*(wchar_t *));

1700 
i
 = 0; i < 
aNumOfFûãrP©ã∫s
; i++)

1702 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aFûãrP©ã∫s
[
i
]);

1703 
lFûãrP©ã∫s
[
i
] = (
wch¨_t
 *)
	`mÆloc
–(
	`wc¶í
(
lTmpWCh¨
)+1) * (wchar_t *));

1704 
	`wcs˝y
(
lFûãrP©ã∫s
[
i
], 
lTmpWCh¨
);

1707 i‡(
aTôÀ
)

1709 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aTôÀ
);

1710 
	`wcs˝y
(
lTôÀ
, 
lTmpWCh¨
);

1713 i‡(
aDeÁu…P©hAndFûe
)

1715 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aDeÁu…P©hAndFûe
);

1716 
	`wcs˝y
(
lDeÁu…P©hAndFûe
, 
lTmpWCh¨
);

1719 i‡(
aSögÀFûãrDes¸ùti⁄
)

1721 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aSögÀFûãrDes¸ùti⁄
);

1722 
	`wcs˝y
(
lSögÀFûãrDes¸ùti⁄
, 
lTmpWCh¨
);

1725 
lTmpWCh¨
 = 
	`töyfd_ßveFûeDülogW
(

1726 
lTôÀ
,

1727 
lDeÁu…P©hAndFûe
,

1728 
aNumOfFûãrP©ã∫s
,

1729 (
wch¨_t
 const** )

1730 
lFûãrP©ã∫s
,

1731 
lSögÀFûãrDes¸ùti⁄
);

1733 
i
 = 0; i < 
aNumOfFûãrP©ã∫s
; i++)

1735 
	`‰ì
(
lFûãrP©ã∫s
[
i
]);

1737 
	`‰ì
(
lFûãrP©ã∫s
);

1739 i‡(!
lTmpWCh¨
)

1741  
NULL
;

1744 
lTmpCh¨
 = 
	`töyfd_utf16to8
(
lTmpWCh¨
);

1745 
	`°r˝y
(
aoBuff
, 
lTmpCh¨
);

1746 (Ë
	`töyfd_utf16to8
(
NULL
);

1748  
aoBuff
;

1749 
	}
}

1752 
wch¨_t
 * 
	$töyfd_›íFûeDülogW
(

1753 
wch¨_t
 c⁄° * 
aTôÀ
,

1754 
wch¨_t
 c⁄° * 
aDeÁu…P©hAndFûe
,

1755 
aNumOfFûãrP©ã∫s
,

1756 
wch¨_t
 c⁄° * c⁄° * 
aFûãrP©ã∫s
,

1757 
wch¨_t
 c⁄° * 
aSögÀFûãrDes¸ùti⁄
,

1758 
aAŒowMu…ùÀSñe˘s
)

1760 
size_t
 
lLígths
[
MAX_MULTIPLE_FILES
];

1761 
wch¨_t
 
lDú«me
[
MAX_PATH_OR_CMD
];

1762 
wch¨_t
 
lFûãrP©ã∫s
[
MAX_PATH_OR_CMD
] = 
L
"";

1763 
wch¨_t
 
lDülogSåög
[
MAX_PATH_OR_CMD
];

1764 
wch¨_t
 * 
lPoöãrs
[
MAX_MULTIPLE_FILES
+1];

1765 
wch¨_t
 * 
p
;

1766 
i
, 
j
;

1767 
size_t
 
lBuffLí
, 
lFuŒBuffLí
;

1768 
HRESULT
 
lHResu…
;

1769 
OPENFILENAMEW
 
o‚
 = { 0 };

1770 
wch¨_t
 * 
lBuff
 = 
NULL
;

1772 
	`‰ì
(
lBuff
);

1773 
lBuff
 = 
NULL
;

1774 i‡(
aAŒowMu…ùÀSñe˘s
 < 0Ë (
wch¨_t
 *)0;

1776 i‡(
aTôÀ
&&!
	`wcscmp
◊TôÀ, 
L
"töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "wödows_wch¨");  (
wch¨_t
 *)1; }

1778 i‡(
aAŒowMu…ùÀSñe˘s
)

1780 
lFuŒBuffLí
 = 
MAX_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

1781 
lBuff
 = (
wch¨_t
*)(
	`mÆloc
(
lFuŒBuffLí
 * (wchar_t)));

1782 i‡(!
lBuff
)

1784 
lFuŒBuffLí
 = 
LOW_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

1785 
lBuff
 = (
wch¨_t
*)–
	`mÆloc
–
lFuŒBuffLí
 * (wchar_t)));

1790 
lFuŒBuffLí
 = 
MAX_PATH_OR_CMD
 + 1;

1791 
lBuff
 = (
wch¨_t
*)(
	`mÆloc
(
lFuŒBuffLí
 * (wchar_t)));

1793 i‡(!
lBuff
Ë 
NULL
;

1795 
lHResu…
 = 
	`CoInôülizeEx
(
NULL
, 0);

1797 
	`gëP©hWôhoutFöÆSœshW
(
lDú«me
, 
aDeÁu…P©hAndFûe
);

1798 
	`gëLa°NameW
(
lBuff
, 
aDeÁu…P©hAndFûe
);

1800 i‡(
aNumOfFûãrP©ã∫s
 > 0)

1802 i‡(
aSögÀFûãrDes¸ùti⁄
 && 
	`wc¶í
(aSingleFilterDescription))

1804 
	`wcs˝y
(
lFûãrP©ã∫s
, 
aSögÀFûãrDes¸ùti⁄
);

1805 
	`wcsˇt
(
lFûãrP©ã∫s
, 
L
"\n");

1807 
	`wcsˇt
(
lFûãrP©ã∫s
, 
aFûãrP©ã∫s
[0]);

1808 
i
 = 1; i < 
aNumOfFûãrP©ã∫s
; i++)

1810 
	`wcsˇt
(
lFûãrP©ã∫s
, 
L
";");

1811 
	`wcsˇt
(
lFûãrP©ã∫s
, 
aFûãrP©ã∫s
[
i
]);

1813 
	`wcsˇt
(
lFûãrP©ã∫s
, 
L
"\n");

1814 i‡(!(
aSögÀFûãrDes¸ùti⁄
 && 
	`wc¶í
(aSingleFilterDescription)))

1816 
	`wcs˝y
(
lDülogSåög
, 
lFûãrP©ã∫s
);

1817 
	`wcsˇt
(
lFûãrP©ã∫s
, 
lDülogSåög
);

1819 
	`wcsˇt
(
lFûãrP©ã∫s
, 
L
"All Files\n*.*\n");

1820 
p
 = 
lFûãrP©ã∫s
;

1821 (
p
 = 
	`wcschr
’, 
L
'\n')Ë!
NULL
)

1823 *
p
 = 
L
'\0';

1824 
p
++;

1828 
o‚
.
lSåu˘Size
 = (
OPENFILENAME
);

1829 
o‚
.
hwndOw√r
 = 
	`GëF‹egroundWödow
();

1830 
o‚
.
hIn°™˚
 = 0;

1831 
o‚
.
Õ°rFûãr
 = 
	`wc¶í
(
lFûãrP©ã∫s
Ë?ÜFûãrP©ã∫†: 
NULL
;

1832 
o‚
.
Õ°rCu°omFûãr
 = 
NULL
;

1833 
o‚
.
nMaxCu°Fûãr
 = 0;

1834 
o‚
.
nFûãrIndex
 = 1;

1835 
o‚
.
Õ°rFûe
 = 
lBuff
;

1836 
o‚
.
nMaxFûe
 = 
lFuŒBuffLí
;

1837 
o‚
.
Õ°rFûeTôÀ
 = 
NULL
;

1838 
o‚
.
nMaxFûeTôÀ
 = 
MAX_PATH_OR_CMD
 / 2;

1839 
o‚
.
Õ°rInôülDú
 = 
	`wc¶í
(
lDú«me
Ë?ÜDú«mê: 
NULL
;

1840 
o‚
.
Õ°rTôÀ
 = 
aTôÀ
 && 
	`wc¶í
◊TôÀË?áTôÀ : 
NULL
;

1841 
o‚
.
Fœgs
 = 
OFN_EXPLORER
 | 
OFN_NOCHANGEDIR
 | 
OFN_PATHMUSTEXIST
 | 
OFN_FILEMUSTEXIST
;

1842 
o‚
.
nFûeOff£t
 = 0;

1843 
o‚
.
nFûeExãnsi⁄
 = 0;

1844 
o‚
.
Õ°rDefExt
 = 
NULL
;

1845 
o‚
.
lCu°D©a
 = 0L;

1846 
o‚
.
Õ‚Hook
 = 
NULL
;

1847 
o‚
.
ÕTem∂©eName
 = 
NULL
;

1849 i‡(
aAŒowMu…ùÀSñe˘s
)

1851 
o‚
.
Fœgs
 |
OFN_ALLOWMULTISELECT
;

1854 i‡(
	`GëO≥nFûeNameW
(&
o‚
) == 0)

1856 
	`‰ì
(
lBuff
);

1857 
lBuff
 = 
NULL
;

1861 
lBuffLí
 = 
	`wc¶í
(
lBuff
);

1862 
lPoöãrs
[0] = 
lBuff
 + 
lBuffLí
 + 1;

1863 i‡(
aAŒowMu…ùÀSñe˘s
 && (
lPoöãrs
[0][0] !
L
'\0'))

1865 
i
 = 0;

1868 
lLígths
[
i
] = 
	`wc¶í
(
lPoöãrs
[i]);

1869 
lPoöãrs
[
i
 + 1] =ÜPoöãrs[i] + 
lLígths
[i] + 1;

1870 
i
++;

1871 } 
lPoöãrs
[
i
][0] !
L
'\0' && i < 
MAX_MULTIPLE_FILES
 );

1872 i‡(
i
 > 
MAX_MULTIPLE_FILES
)

1874 
	`‰ì
(
lBuff
);

1875 
lBuff
 = 
NULL
;

1879 
i
--;

1880 
p
 = 
lBuff
 + 
lFuŒBuffLí
 - 1;

1881 *
p
 = 
L
'\0';

1882 
j
 = 
i
; j >= 0; j--)

1884 
p
 -
lLígths
[
j
];

1885 
	`memmove
(
p
, 
lPoöãrs
[
j
], 
lLígths
[j] * (
wch¨_t
));

1886 
p
--;

1887 *
p
 = 
L
'\\';

1888 
p
 -
lBuffLí
;

1889 
	`memmove
(
p
, 
lBuff
, 
lBuffLí
*(
wch¨_t
));

1890 
p
--;

1891 *
p
 = 
L
'|';

1893 
p
++;

1894 
	`wcs˝y
(
lBuff
, 
p
);

1895 
lBuffLí
 = 
	`wc¶í
(
lBuff
);

1898 i‡(
lBuff
ËlBuf‡(
wch¨_t
*)(
	`ªÆloc
÷Buff, (
lBuffLí
 + 1) * (wchar_t)));

1901 i‡(
lHResu…
 =
S_OK
 ||ÜHResu… =
S_FALSE
)

1903 
	`CoUnöôülize
();

1905  
lBuff
;

1906 
	}
}

1909 * 
	$›íFûeDülogWöGui8
(

1910 c⁄° * 
aTôÀ
,

1911 c⁄° * 
aDeÁu…P©hAndFûe
,

1912 
aNumOfFûãrP©ã∫s
,

1913 c⁄° * c⁄° * 
aFûãrP©ã∫s
,

1914 c⁄° * 
aSögÀFûãrDes¸ùti⁄
,

1915 
aAŒowMu…ùÀSñe˘s
)

1917 
wch¨_t
 
lTôÀ
[128] = 
L
"";

1918 
wch¨_t
 
lDeÁu…P©hAndFûe
[
MAX_PATH_OR_CMD
] = 
L
"";

1919 
wch¨_t
 
lSögÀFûãrDes¸ùti⁄
[128] = 
L
"";

1920 
wch¨_t
 * * 
lFûãrP©ã∫s
;

1921 
wch¨_t
 * 
lTmpWCh¨
;

1922 * 
lTmpCh¨
;

1923 
i
;

1925 
lFûãrP©ã∫s
 = (
wch¨_t
 * *Ë
	`mÆloc
(
aNumOfFûãrP©ã∫s
*(wchar_t *));

1926 
i
 = 0; i < 
aNumOfFûãrP©ã∫s
; i++)

1928 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aFûãrP©ã∫s
[
i
]);

1929 
lFûãrP©ã∫s
[
i
] = (
wch¨_t
 *)
	`mÆloc
((
	`wc¶í
(
lTmpWCh¨
)+1)*(wchar_t *));

1930 
	`wcs˝y
(
lFûãrP©ã∫s
[
i
], 
lTmpWCh¨
);

1933 i‡(
aTôÀ
)

1935 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aTôÀ
);

1936 
	`wcs˝y
(
lTôÀ
, 
lTmpWCh¨
);

1938 i‡(
aDeÁu…P©hAndFûe
)

1940 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aDeÁu…P©hAndFûe
);

1941 
	`wcs˝y
(
lDeÁu…P©hAndFûe
, 
lTmpWCh¨
);

1943 i‡(
aSögÀFûãrDes¸ùti⁄
)

1945 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aSögÀFûãrDes¸ùti⁄
);

1946 
	`wcs˝y
(
lSögÀFûãrDes¸ùti⁄
, 
lTmpWCh¨
);

1949 
lTmpWCh¨
 = 
	`töyfd_›íFûeDülogW
(

1950 
lTôÀ
,

1951 
lDeÁu…P©hAndFûe
,

1952 
aNumOfFûãrP©ã∫s
,

1953 (
wch¨_t
 const**)

1954 
lFûãrP©ã∫s
,

1955 
lSögÀFûãrDes¸ùti⁄
,

1956 
aAŒowMu…ùÀSñe˘s
);

1958 
i
 = 0; i < 
aNumOfFûãrP©ã∫s
; i++)

1960 
	`‰ì
(
lFûãrP©ã∫s
[
i
]);

1962 
	`‰ì
(
lFûãrP©ã∫s
);

1964 i‡(!
lTmpWCh¨
Ë 
NULL
;

1966 
lTmpCh¨
 = 
	`töyfd_utf16to8
(
lTmpWCh¨
);

1967 (Ë
	`töyfd_›íFûeDülogW
(
NULL
,NULL,0,NULL,NULL,-1);

1969  
lTmpCh¨
;

1970 
	}
}

1973 
BOOL
 
CALLBACK
 
	$Brow£CÆlbackProc_íum
(
HWND
 
hWndChûd
, 
LPARAM
 
lP¨am
)

1975 
buf
[255];

1976 
	`GëCœssNameA
(
hWndChûd
, 
buf
, (buf));

1977 i‡(
	`°rcmp
(
buf
, "SysTreeView32") == 0) {

1978 
HTREEITEM
 
hNode
 = 
	`TªeVõw_GëSñe˘i⁄
(
hWndChûd
);

1979 
	`TªeVõw_EnsuªVisibÀ
(
hWndChûd
, 
hNode
);

1980  
FALSE
;

1982  
TRUE
;

1983 
	}
}

1987 
BOOL
 
CALLBACK
 
	$Brow£CÆlbackProcW_íum
(
HWND
 
hWndChûd
, 
LPARAM
 
lP¨am
)

1989 
wch¨_t
 
buf
[255];

1990 
	`GëCœssNameW
(
hWndChûd
, 
buf
, (buf));

1991 i‡(
	`wcscmp
(
buf
, 
L
"SysTreeView32") == 0) {

1992 
HTREEITEM
 
hNode
 = 
	`TªeVõw_GëSñe˘i⁄
(
hWndChûd
);

1993 
	`TªeVõw_EnsuªVisibÀ
(
hWndChûd
, 
hNode
);

1994  
FALSE
;

1996  
TRUE
;

1997 
	}
}

1999 
__°dˇŒ
 
	$Brow£CÆlbackProc
(
HWND
 
hwnd
, 
UINT
 
uMsg
, 
LPARAM
 
Õ
, LPARAM 
pD©a
)

2001 
uMsg
) {

2002 
BFFM_INITIALIZED
:

2003 
	`SídMesßge
(
hwnd
, 
BFFM_SETSELECTION
, 
TRUE
, 
pD©a
);

2005 
BFFM_SELCHANGED
:

2006 
	`EnumChûdWödows
(
hwnd
, 
Brow£CÆlbackProc_íum
, 0);

2009 
	}
}

2012 
__°dˇŒ
 
	$Brow£CÆlbackProcW
(
HWND
 
hwnd
, 
UINT
 
uMsg
, 
LPARAM
 
Õ
, LPARAM 
pD©a
)

2014 
uMsg
) {

2015 
BFFM_INITIALIZED
:

2016 
	`SídMesßge
(
hwnd
, 
BFFM_SETSELECTIONW
, 
TRUE
, (
LPARAM
)
pD©a
);

2018 
BFFM_SELCHANGED
:

2019 
	`EnumChûdWödows
(
hwnd
, 
Brow£CÆlbackProcW_íum
, 0);

2022 
	}
}

2024 
wch¨_t
 * 
	$töyfd_£À˘FﬁdîDülogW
(

2025 
wch¨_t
 c⁄° * 
aTôÀ
,

2026 
wch¨_t
 c⁄° * 
aDeÁu…P©h
)

2028 
wch¨_t
 
lBuff
[
MAX_PATH_OR_CMD
];

2029 
wch¨_t
 * 
lRëvÆ
;

2031 
BROWSEINFOW
 
bInfo
;

2032 
LPITEMIDLIST
 
ÕIãm
;

2033 
HRESULT
 
lHResu…
;

2035 i‡(
aTôÀ
&&!
	`wcscmp
◊TôÀ, 
L
"töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "wödows_wch¨");  (
wch¨_t
 *)1; }

2037 
lHResu…
 = 
	`CoInôülizeEx
(
NULL
, 
COINIT_APARTMENTTHREADED
);

2039 
bInfo
.
hwndOw√r
 = 
	`GëF‹egroundWödow
();

2040 
bInfo
.
pidlRoŸ
 = 
NULL
;

2041 
bInfo
.
pszDi•œyName
 = 
lBuff
;

2042 
bInfo
.
ÕszTôÀ
 = 
aTôÀ
 && 
	`wc¶í
◊TôÀË?áTôÀ : 
NULL
;

2043 i‡(
lHResu…
 =
S_OK
 ||ÜHResu… =
S_FALSE
)

2045 
bInfo
.
ulFœgs
 = 
BIF_USENEWUI
;

2047 
bInfo
.
Õ‚
 = 
Brow£CÆlbackProcW
;

2048 
bInfo
.
lP¨am
 = (
LPARAM
)
aDeÁu…P©h
;

2049 
bInfo
.
iImage
 = -1;

2051 
ÕIãm
 = 
	`SHBrow£F‹FﬁdîW
(&
bInfo
);

2052 i‡(!
ÕIãm
)

2054 
lRëvÆ
 = 
NULL
;

2058 
	`SHGëP©hFromIDLi°W
(
ÕIãm
, 
lBuff
);

2059 
lRëvÆ
 = 
lBuff
 ;

2062 i‡(
lHResu…
 =
S_OK
 ||ÜHResu… =
S_FALSE
)

2064 
	`CoUnöôülize
();

2066  
lRëvÆ
;

2067 
	}
}

2070 * 
	$£À˘FﬁdîDülogWöGui8
(

2071 * 
aoBuff
 ,

2072 c⁄° * 
aTôÀ
 ,

2073 c⁄° * 
aDeÁu…P©h
 )

2075 
wch¨_t
 
lTôÀ
 [128] = 
L
"";

2076 
wch¨_t
 
lDeÁu…P©h
[
MAX_PATH_OR_CMD
] = 
L
"";

2077 
wch¨_t
 * 
lTmpWCh¨
;

2078 * 
lTmpCh¨
;

2080 i‡(
aTôÀ
)

2082 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aTôÀ
);

2083 
	`wcs˝y
(
lTôÀ
, 
lTmpWCh¨
);

2085 i‡(
aDeÁu…P©h
)

2087 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aDeÁu…P©h
);

2088 
	`wcs˝y
(
lDeÁu…P©h
, 
lTmpWCh¨
);

2091 
lTmpWCh¨
 = 
	`töyfd_£À˘FﬁdîDülogW
(

2092 
lTôÀ
,

2093 
lDeÁu…P©h
);

2095 i‡(!
lTmpWCh¨
)

2097  
NULL
;

2100 
lTmpCh¨
 = 
	`töyfd_utf16to8
(
lTmpWCh¨
);

2101 
	`°r˝y
(
aoBuff
, 
lTmpCh¨
);

2103  
aoBuff
;

2104 
	}
}

2107 
wch¨_t
 * 
	$töyfd_cﬁ‹Choo£rW
(

2108 
wch¨_t
 c⁄° * 
aTôÀ
,

2109 
wch¨_t
 c⁄° * 
aDeÁu…HexRGB
,

2110 c⁄° 
aDeÁu…RGB
[3],

2111 
aoResu…RGB
[3])

2113 
wch¨_t
 
lResu…HexRGB
[8];

2114 
CHOOSECOLORW
 
cc
;

2115 
COLORREF
 
¸Cu°Cﬁ‹s
[16];

2116 
lDeÁu…RGB
[3];

2117 
lRë
;

2119 
HRESULT
 
lHResu…
;

2121 i‡(
aTôÀ
&&!
	`wcscmp
◊TôÀ, 
L
"töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "wödows_wch¨");  (
wch¨_t
 *)1; }

2123 
lHResu…
 = 
	`CoInôülizeEx
(
NULL
, 0);

2125 i‡–
aDeÁu…HexRGB
 )

2127 
	`Hex2RGBW
(
aDeÁu…HexRGB
, 
lDeÁu…RGB
);

2131 
lDeÁu…RGB
[0] = 
aDeÁu…RGB
[0];

2132 
lDeÁu…RGB
[1] = 
aDeÁu…RGB
[1];

2133 
lDeÁu…RGB
[2] = 
aDeÁu…RGB
[2];

2137 
cc
.
lSåu˘Size
 = (
CHOOSECOLOR
);

2138 
cc
.
hwndOw√r
 = 
	`GëF‹egroundWödow
();

2139 
cc
.
hIn°™˚
 = 
NULL
;

2140 
cc
.
rgbResu…
 = 
	`RGB
(
lDeÁu…RGB
[0],ÜDefaultRGB[1],ÜDefaultRGB[2]);

2141 
cc
.
ÕCu°Cﬁ‹s
 = 
¸Cu°Cﬁ‹s
;

2142 
cc
.
Fœgs
 = 
CC_RGBINIT
 | 
CC_FULLOPEN
 | 
CC_ANYCOLOR
 ;

2143 
cc
.
lCu°D©a
 = 0;

2144 
cc
.
Õ‚Hook
 = 
NULL
;

2145 
cc
.
ÕTem∂©eName
 = 
NULL
;

2147 
lRë
 = 
	`Choo£Cﬁ‹W
(&
cc
);

2149 i‡(!
lRë
)

2151  
NULL
;

2154 
aoResu…RGB
[0] = 
	`GëRVÆue
(
cc
.
rgbResu…
);

2155 
aoResu…RGB
[1] = 
	`GëGVÆue
(
cc
.
rgbResu…
);

2156 
aoResu…RGB
[2] = 
	`GëBVÆue
(
cc
.
rgbResu…
);

2158 
	`RGB2HexW
(
aoResu…RGB
, 
lResu…HexRGB
);

2160 i‡(
lHResu…
 =
S_OK
 ||ÜHResu… =
S_FALSE
)

2162 
	`CoUnöôülize
();

2165  
lResu…HexRGB
;

2166 
	}
}

2169 * 
	$cﬁ‹Choo£rWöGui8
(

2170 c⁄° * 
aTôÀ
,

2171 c⁄° * 
aDeÁu…HexRGB
,

2172 c⁄° 
aDeÁu…RGB
[3],

2173 
aoResu…RGB
[3])

2175 
lResu…HexRGB
[8];

2177 
wch¨_t
 
lTôÀ
[128];

2178 
wch¨_t
 
lDeÁu…HexRGB
[16];

2179 
wch¨_t
 * 
lTmpWCh¨
;

2180 * 
lTmpCh¨
;

2182 i‡(
aTôÀ
)

2184 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aTôÀ
);

2185 
	`wcs˝y
(
lTôÀ
, 
lTmpWCh¨
);

2187 i‡(
aDeÁu…HexRGB
)

2189 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aDeÁu…HexRGB
);

2190 
	`wcs˝y
(
lDeÁu…HexRGB
, 
lTmpWCh¨
);

2193 
lTmpWCh¨
 = 
	`töyfd_cﬁ‹Choo£rW
(

2194 
lTôÀ
,

2195 
lDeÁu…HexRGB
,

2196 
aDeÁu…RGB
,

2197 
aoResu…RGB
 );

2199 i‡(!
lTmpWCh¨
)

2201  
NULL
;

2204 
lTmpCh¨
 = 
	`töyfd_utf16to8
(
lTmpWCh¨
);

2205 
	`°r˝y
(
lResu…HexRGB
, 
lTmpCh¨
);

2207  
lResu…HexRGB
;

2208 
	}
}

2211 
	$mesßgeBoxWöGuiA
(

2212 c⁄° * 
aTôÀ
 ,

2213 c⁄° * 
aMesßge
 ,

2214 c⁄° * 
aDülogTy≥
 ,

2215 c⁄° * 
aIc⁄Ty≥
 ,

2216 
aDeÁu…Buâ⁄
 )

2218 
lBoxRëu∫VÆue
;

2219 
UINT
 
aCode
 ;

2221 i‡–
aIc⁄Ty≥
 && ! 
	`°rcmp
( "warning" ,áIconType ) )

2223 
aCode
 = 
MB_ICONWARNING
 ;

2225 i‡–
aIc⁄Ty≥
 && ! 
	`°rcmp
("error",áIconType))

2227 
aCode
 = 
MB_ICONERROR
 ;

2229 i‡–
aIc⁄Ty≥
 && ! 
	`°rcmp
("question",áIconType))

2231 
aCode
 = 
MB_ICONQUESTION
 ;

2235 
aCode
 = 
MB_ICONINFORMATION
 ;

2238 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "okcancel" ,áDialogType ) )

2240 
aCode
 +
MB_OKCANCEL
 ;

2241 i‡–! 
aDeÁu…Buâ⁄
 )

2243 
aCode
 +
MB_DEFBUTTON2
 ;

2246 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesno" ,áDialogType ) )

2248 
aCode
 +
MB_YESNO
 ;

2249 i‡–! 
aDeÁu…Buâ⁄
 )

2251 
aCode
 +
MB_DEFBUTTON2
 ;

2254 i‡(
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",áDialogType))

2256 
aCode
 +
MB_YESNOCANCEL
;

2257 i‡(!
aDeÁu…Buâ⁄
)

2259 
aCode
 +
MB_DEFBUTTON3
;

2261 i‡(
aDeÁu…Buâ⁄
 == 2)

2263 
aCode
 +
MB_DEFBUTTON2
;

2268 
aCode
 +
MB_OK
 ;

2271 
aCode
 +
MB_TOPMOST
;

2273 
lBoxRëu∫VÆue
 = 
	`MesßgeBoxA
(
	`GëF‹egroundWödow
(), 
aMesßge
, 
aTôÀ
, 
aCode
);

2275 i‡(((
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",áDialogType))

2276 && (
lBoxRëu∫VÆue
 =
IDNO
)))

2281 i‡–––
aDülogTy≥


2282 && 
	`°rcmp
("ye¢oˇn˚l", 
aDülogTy≥
)

2283 && 
	`°rcmp
("okˇn˚l", 
aDülogTy≥
)

2284 && 
	`°rcmp
("ye¢o", 
aDülogTy≥
)))

2285 || (
lBoxRëu∫VÆue
 =
IDOK
)

2286 || (
lBoxRëu∫VÆue
 =
IDYES
) )

2294 
	}
}

2297 * 
	$ßveFûeDülogWöGuiA
(

2298 * 
aoBuff
 ,

2299 c⁄° * 
aTôÀ
 ,

2300 c⁄° * 
aDeÁu…P©hAndFûe
 ,

2301 
aNumOfFûãrP©ã∫s
 ,

2302 c⁄° * c⁄° * 
aFûãrP©ã∫s
 ,

2303 c⁄° * 
aSögÀFûãrDes¸ùti⁄
 )

2305 
lDú«me
 [
MAX_PATH_OR_CMD
] ;

2306 
lDülogSåög
[
MAX_PATH_OR_CMD
];

2307 
lFûãrP©ã∫s
[
MAX_PATH_OR_CMD
] = "";

2308 
i
 ;

2309 * 
p
;

2310 * 
lRëvÆ
;

2311 
HRESULT
 
lHResu…
;

2312 c⁄° * 
ldefExt
 = 
NULL
;

2313 
OPENFILENAMEA
 
o‚
 = { 0 };

2315 
lHResu…
 = 
	`CoInôülizeEx
(
NULL
,0);

2317 
	`gëP©hWôhoutFöÆSœsh
(
lDú«me
, 
aDeÁu…P©hAndFûe
);

2318 
	`gëLa°Name
(
aoBuff
, 
aDeÁu…P©hAndFûe
);

2320 i‡(
aNumOfFûãrP©ã∫s
 > 0)

2322 
ldefExt
 = 
aFûãrP©ã∫s
[0];

2324 i‡–
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) )

2326 
	`°r˝y
(
lFûãrP©ã∫s
, 
aSögÀFûãrDes¸ùti⁄
);

2327 
	`°rˇt
(
lFûãrP©ã∫s
, "\n");

2329 
	`°rˇt
(
lFûãrP©ã∫s
, 
aFûãrP©ã∫s
[0]);

2330 
i
 = 1; i < 
aNumOfFûãrP©ã∫s
; i++)

2332 
	`°rˇt
(
lFûãrP©ã∫s
, ";");

2333 
	`°rˇt
(
lFûãrP©ã∫s
, 
aFûãrP©ã∫s
[
i
]);

2335 
	`°rˇt
(
lFûãrP©ã∫s
, "\n");

2336 i‡–! (
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) ) )

2338 
	`°r˝y
(
lDülogSåög
, 
lFûãrP©ã∫s
);

2339 
	`°rˇt
(
lFûãrP©ã∫s
, 
lDülogSåög
);

2341 
	`°rˇt
(
lFûãrP©ã∫s
, "All Files\n*.*\n");

2342 
p
 = 
lFûãrP©ã∫s
;

2343 (
p
 = 
	`°rchr
’, '\n')Ë!
NULL
)

2345 *
p
 = '\0';

2346 
p
 ++ ;

2350 
o‚
.
lSåu˘Size
 = (
OPENFILENAME
) ;

2351 
o‚
.
hwndOw√r
 = 
	`GëF‹egroundWödow
();

2352 
o‚
.
hIn°™˚
 = 0 ;

2353 
o‚
.
Õ°rFûãr
 = 
	`°æí
(
lFûãrP©ã∫s
Ë?ÜFûãrP©ã∫†: 
NULL
;

2354 
o‚
.
Õ°rCu°omFûãr
 = 
NULL
 ;

2355 
o‚
.
nMaxCu°Fûãr
 = 0 ;

2356 
o‚
.
nFûãrIndex
 = 1 ;

2357 
o‚
.
Õ°rFûe
 = 
aoBuff
;

2359 
o‚
.
nMaxFûe
 = 
MAX_PATH_OR_CMD
 ;

2360 
o‚
.
Õ°rFûeTôÀ
 = 
NULL
 ;

2361 
o‚
.
nMaxFûeTôÀ
 = 
MAX_PATH_OR_CMD
 / 2;

2362 
o‚
.
Õ°rInôülDú
 = 
	`°æí
(
lDú«me
Ë?ÜDú«mê: 
NULL
;

2363 
o‚
.
Õ°rTôÀ
 = 
aTôÀ
 && 
	`°æí
◊TôÀË?áTôÀ : 
NULL
;

2364 
o‚
.
Fœgs
 = 
OFN_OVERWRITEPROMPT
 | 
OFN_NOCHANGEDIR
 ;

2365 
o‚
.
nFûeOff£t
 = 0 ;

2366 
o‚
.
nFûeExãnsi⁄
 = 0 ;

2367 
o‚
.
Õ°rDefExt
 = 
ldefExt
;

2368 
o‚
.
lCu°D©a
 = 0L ;

2369 
o‚
.
Õ‚Hook
 = 
NULL
 ;

2370 
o‚
.
ÕTem∂©eName
 = 
NULL
 ;

2372 i‡–
	`GëSaveFûeNameA
 ( & 
o‚
 ) == 0 )

2374 
lRëvÆ
 = 
NULL
 ;

2378 
lRëvÆ
 = 
aoBuff
 ;

2381 i‡(
lHResu…
==
S_OK
 ||ÜHResu…==
S_FALSE
)

2383 
	`CoUnöôülize
();

2385  
lRëvÆ
 ;

2386 
	}
}

2389 * 
	$›íFûeDülogWöGuiA
(

2390 c⁄° * 
aTôÀ
 ,

2391 c⁄° * 
aDeÁu…P©hAndFûe
 ,

2392 
aNumOfFûãrP©ã∫s
 ,

2393 c⁄° * c⁄° * 
aFûãrP©ã∫s
 ,

2394 c⁄° * 
aSögÀFûãrDes¸ùti⁄
 ,

2395 
aAŒowMu…ùÀSñe˘s
 )

2397 
lDú«me
 [
MAX_PATH_OR_CMD
] ;

2398 
lFûãrP©ã∫s
[
MAX_PATH_OR_CMD
] = "";

2399 
lDülogSåög
[
MAX_PATH_OR_CMD
] ;

2400 * 
lPoöãrs
[
MAX_MULTIPLE_FILES
+1];

2401 
size_t
 
lLígths
[
MAX_MULTIPLE_FILES
];

2402 
i
 , 
j
 ;

2403 * 
p
;

2404 
size_t
 
lBuffLí
, 
lFuŒBuffLí
;

2405 
HRESULT
 
lHResu…
;

2406 
OPENFILENAMEA
 
o‚
 = {0};

2407 * 
lBuff
 = 
NULL
;

2409 
	`‰ì
(
lBuff
);

2410 
lBuff
 = 
NULL
;

2411 i‡(
aAŒowMu…ùÀSñe˘s
)

2413 
lFuŒBuffLí
 = 
MAX_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

2414 
lBuff
 = (*)(
	`mÆloc
(
lFuŒBuffLí
 * ()));

2415 i‡(!
lBuff
)

2417 
lFuŒBuffLí
 = 
LOW_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

2418 
lBuff
 = (*)(
	`mÆloc
(
lFuŒBuffLí
 * ()));

2423 
lFuŒBuffLí
 = 
MAX_PATH_OR_CMD
 + 1;

2424 
lBuff
 = (*)(
	`mÆloc
(
lFuŒBuffLí
 * ()));

2426 i‡(!
lBuff
Ë 
NULL
;

2428 
lHResu…
 = 
	`CoInôülizeEx
(
NULL
,0);

2430 
	`gëP©hWôhoutFöÆSœsh
(
lDú«me
, 
aDeÁu…P©hAndFûe
);

2431 
	`gëLa°Name
(
lBuff
, 
aDeÁu…P©hAndFûe
);

2433 i‡(
aNumOfFûãrP©ã∫s
 > 0)

2435 i‡–
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) )

2437 
	`°r˝y
(
lFûãrP©ã∫s
, 
aSögÀFûãrDes¸ùti⁄
);

2438 
	`°rˇt
(
lFûãrP©ã∫s
, "\n");

2440 
	`°rˇt
(
lFûãrP©ã∫s
, 
aFûãrP©ã∫s
[0]);

2441 
i
 = 1; i < 
aNumOfFûãrP©ã∫s
; i++)

2443 
	`°rˇt
(
lFûãrP©ã∫s
, ";");

2444 
	`°rˇt
(
lFûãrP©ã∫s
, 
aFûãrP©ã∫s
[
i
]);

2446 
	`°rˇt
(
lFûãrP©ã∫s
, "\n");

2447 i‡–! (
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) ) )

2449 
	`°r˝y
(
lDülogSåög
, 
lFûãrP©ã∫s
);

2450 
	`°rˇt
(
lFûãrP©ã∫s
, 
lDülogSåög
);

2452 
	`°rˇt
(
lFûãrP©ã∫s
, "All Files\n*.*\n");

2453 
p
 = 
lFûãrP©ã∫s
;

2454 (
p
 = 
	`°rchr
’, '\n')Ë!
NULL
)

2456 *
p
 = '\0';

2457 
p
 ++ ;

2461 
o‚
.
lSåu˘Size
 = –
OPENFILENAME
 ) ;

2462 
o‚
.
hwndOw√r
 = 
	`GëF‹egroundWödow
();

2463 
o‚
.
hIn°™˚
 = 0 ;

2464 
o‚
.
Õ°rFûãr
 = 
	`°æí
(
lFûãrP©ã∫s
Ë?ÜFûãrP©ã∫†: 
NULL
;

2465 
o‚
.
Õ°rCu°omFûãr
 = 
NULL
 ;

2466 
o‚
.
nMaxCu°Fûãr
 = 0 ;

2467 
o‚
.
nFûãrIndex
 = 1 ;

2468 
o‚
.
Õ°rFûe
 = 
lBuff
;

2469 
o‚
.
nMaxFûe
 = 
lFuŒBuffLí
;

2470 
o‚
.
Õ°rFûeTôÀ
 = 
NULL
 ;

2471 
o‚
.
nMaxFûeTôÀ
 = 
MAX_PATH_OR_CMD
 / 2;

2472 
o‚
.
Õ°rInôülDú
 = 
	`°æí
(
lDú«me
Ë?ÜDú«mê: 
NULL
;

2473 
o‚
.
Õ°rTôÀ
 = 
aTôÀ
 && 
	`°æí
◊TôÀË?áTôÀ : 
NULL
;

2474 
o‚
.
Fœgs
 = 
OFN_EXPLORER
 | 
OFN_NOCHANGEDIR
 ;

2475 
o‚
.
nFûeOff£t
 = 0 ;

2476 
o‚
.
nFûeExãnsi⁄
 = 0 ;

2477 
o‚
.
Õ°rDefExt
 = 
NULL
 ;

2478 
o‚
.
lCu°D©a
 = 0L ;

2479 
o‚
.
Õ‚Hook
 = 
NULL
 ;

2480 
o‚
.
ÕTem∂©eName
 = 
NULL
 ;

2482 i‡–
aAŒowMu…ùÀSñe˘s
 )

2484 
o‚
.
Fœgs
 |
OFN_ALLOWMULTISELECT
;

2487 i‡–
	`GëO≥nFûeNameA
–& 
o‚
 ) == 0 )

2489 
	`‰ì
(
lBuff
);

2490 
lBuff
 = 
NULL
 ;

2494 
lBuffLí
 = 
	`°æí
(
lBuff
);

2495 
lPoöãrs
[0] = 
lBuff
 + 
lBuffLí
 + 1;

2496 i‡–
aAŒowMu…ùÀSñe˘s
 && (
lPoöãrs
[0][0] != '\0') )

2498 
i
 = 0 ;

2501 
lLígths
[
i
] = 
	`°æí
(
lPoöãrs
[i]);

2502 
lPoöãrs
[
i
+1] =ÜPoöãrs[i] + 
lLígths
[i] + 1 ;

2503 
i
 ++ ;

2504 } 
lPoöãrs
[
i
][0] !
L
'\0' && i < 
MAX_MULTIPLE_FILES
);

2505 i‡(
i
 > 
MAX_MULTIPLE_FILES
)

2507 
	`‰ì
(
lBuff
);

2508 
lBuff
 = 
NULL
;

2512 
i
--;

2513 
p
 = 
lBuff
 + 
MAX_MULTIPLE_FILES
*
MAX_PATH_OR_CMD
 - 1;

2514 *
p
 = '\0';

2515 
j
 = 
i
; j >= 0; j--)

2517 
p
 -
lLígths
[
j
];

2518 
	`memmove
(
p
, 
lPoöãrs
[
j
], 
lLígths
[j]);

2519 
p
--;

2520 *
p
 = '\\';

2521 
p
 -
lBuffLí
;

2522 
	`memmove
(
p
, 
lBuff
, 
lBuffLí
);

2523 
p
--;

2524 *
p
 = '|';

2526 
p
++;

2527 
	`°r˝y
(
lBuff
, 
p
);

2528 
lBuffLí
 = 
	`°æí
(
lBuff
);

2531 i‡(
lBuff
ËlBuf‡(*)(
	`ªÆloc
÷Buff, (
lBuffLí
 + 1) * ()));

2534 i‡(
lHResu…
==
S_OK
 ||ÜHResu…==
S_FALSE
)

2536 
	`CoUnöôülize
();

2538  
lBuff
;

2539 
	}
}

2542 * 
	$£À˘FﬁdîDülogWöGuiA
(

2543 * 
aoBuff
 ,

2544 c⁄° * 
aTôÀ
 ,

2545 c⁄° * 
aDeÁu…P©h
 )

2547 
BROWSEINFOA
 
bInfo
 ;

2548 
LPITEMIDLIST
 
ÕIãm
 ;

2549 
HRESULT
 
lHResu…
 ;

2550 * 
lRëvÆ
 = 
NULL
 ;

2552 
lHResu…
 = 
	`CoInôülizeEx
(
NULL
, 
COINIT_APARTMENTTHREADED
);

2555 
bInfo
.
hwndOw√r
 = 
	`GëF‹egroundWödow
();

2556 
bInfo
.
pidlRoŸ
 = 
NULL
 ;

2557 
bInfo
.
pszDi•œyName
 = 
aoBuff
 ;

2558 
bInfo
.
ÕszTôÀ
 = 
aTôÀ
 && 
	`°æí
◊TôÀË?áTôÀ : 
NULL
;

2559 i‡(
lHResu…
 =
S_OK
 ||ÜHResu… =
S_FALSE
)

2561 
bInfo
.
ulFœgs
 = 
BIF_USENEWUI
;

2563 
bInfo
.
Õ‚
 = 
Brow£CÆlbackProc
;

2564 
bInfo
.
lP¨am
 = (
LPARAM
)
aDeÁu…P©h
;

2565 
bInfo
.
iImage
 = -1 ;

2567 
ÕIãm
 = 
	`SHBrow£F‹FﬁdîA
–& 
bInfo
 ) ;

2568 i‡–
ÕIãm
 )

2570 
	`SHGëP©hFromIDLi°A
–
ÕIãm
 , 
aoBuff
 ) ;

2571 
lRëvÆ
 = 
aoBuff
;

2574 i‡(
lHResu…
==
S_OK
 ||ÜHResu…==
S_FALSE
)

2576 
	`CoUnöôülize
();

2578  
lRëvÆ
;

2579 
	}
}

2582 * 
	$cﬁ‹Choo£rWöGuiA
(

2583 c⁄° * 
aTôÀ
,

2584 c⁄° * 
aDeÁu…HexRGB
,

2585 c⁄° 
aDeÁu…RGB
[3],

2586 
aoResu…RGB
[3])

2588 
lResu…HexRGB
[8];

2590 
CHOOSECOLORA
 
cc
;

2591 
COLORREF
 
¸Cu°Cﬁ‹s
[16];

2592 
lDeÁu…RGB
[3];

2593 
lRë
;

2595 i‡–
aDeÁu…HexRGB
 )

2597 
	`Hex2RGB
(
aDeÁu…HexRGB
, 
lDeÁu…RGB
);

2601 
lDeÁu…RGB
[0]=
aDeÁu…RGB
[0];

2602 
lDeÁu…RGB
[1]=
aDeÁu…RGB
[1];

2603 
lDeÁu…RGB
[2]=
aDeÁu…RGB
[2];

2607 
cc
.
lSåu˘Size
 = –
CHOOSECOLOR
 ) ;

2608 
cc
.
hwndOw√r
 = 
	`GëF‹egroundWödow
();

2609 
cc
.
hIn°™˚
 = 
NULL
 ;

2610 
cc
.
rgbResu…
 = 
	`RGB
(
lDeÁu…RGB
[0],ÜDefaultRGB[1],ÜDefaultRGB[2]);

2611 
cc
.
ÕCu°Cﬁ‹s
 = 
¸Cu°Cﬁ‹s
;

2612 
cc
.
Fœgs
 = 
CC_RGBINIT
 | 
CC_FULLOPEN
;

2613 
cc
.
lCu°D©a
 = 0;

2614 
cc
.
Õ‚Hook
 = 
NULL
;

2615 
cc
.
ÕTem∂©eName
 = 
NULL
;

2617 
lRë
 = 
	`Choo£Cﬁ‹A
(&
cc
);

2619 i‡–! 
lRë
 )

2621  
NULL
;

2624 
aoResu…RGB
[0] = 
	`GëRVÆue
(
cc
.
rgbResu…
);

2625 
aoResu…RGB
[1] = 
	`GëGVÆue
(
cc
.
rgbResu…
);

2626 
aoResu…RGB
[2] = 
	`GëBVÆue
(
cc
.
rgbResu…
);

2628 
	`RGB2Hex
(
aoResu…RGB
, 
lResu…HexRGB
);

2630  
lResu…HexRGB
;

2631 
	}
}

2635 
	$dülogPª£¡
()

2637 
lDülogPª£¡
 = -1 ;

2638 
lBuff
 [
MAX_PATH_OR_CMD
] ;

2639 
FILE
 * 
lIn
 ;

2640 c⁄° * 
lSåög
 = "dialog.exe";

2641 i‡(!
töyfd_ÆlowCur£sDülogs
)  0;

2642 i‡(
lDülogPª£¡
 < 0)

2644 i‡(!(
lIn
 = 
	`_p›í
("where dialog.exe","r")))

2646 
lDülogPª£¡
 = 0 ;

2649  
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

2651 
	`_p˛o£
–
lIn
 ) ;

2652 i‡–
lBuff
[
	`°æí
(ÜBuff ) -1] == '\n' )

2654 
lBuff
[
	`°æí
(ÜBuff ) -1] = '\0' ;

2656 i‡–
	`°rcmp
(
lBuff
+
	`°æí
÷Buff)-°æí(
lSåög
),lString) )

2658 
lDülogPª£¡
 = 0 ;

2662 
lDülogPª£¡
 = 1 ;

2665  
lDülogPª£¡
;

2666 
	}
}

2669 
	$mesßgeBoxWöC⁄sﬁe
(

2670 c⁄° * 
aTôÀ
 ,

2671 c⁄° * 
aMesßge
 ,

2672 c⁄° * 
aDülogTy≥
 ,

2673 c⁄° * 
aIc⁄Ty≥
 ,

2674 
aDeÁu…Buâ⁄
 )

2676 
lDülogSåög
[
MAX_PATH_OR_CMD
];

2677 
lDülogFûe
[
MAX_PATH_OR_CMD
];

2678 
FILE
 * 
lIn
;

2679 
lBuff
 [
MAX_PATH_OR_CMD
] = "";

2681 
	`°r˝y
(
lDülogSåög
, "dialog ");

2682 i‡(
aTôÀ
 && 
	`°æí
(aTitle))

2684 
	`°rˇt
(
lDülogSåög
, "--title \"") ;

2685 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

2686 
	`°rˇt
(
lDülogSåög
, "\" ") ;

2689 i‡–
aDülogTy≥
 && ( !
	`°rcmp
( "okcancel" ,áDialogType )

2690 || !
	`°rcmp
("ye¢o", 
aDülogTy≥
) || !strcmp("yesnocancel",áDialogType) ) )

2692 
	`°rˇt
(
lDülogSåög
, "--backtitle \"") ;

2693 
	`°rˇt
(
lDülogSåög
, "tab: move focus") ;

2694 
	`°rˇt
(
lDülogSåög
, "\" ") ;

2697 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "okcancel" ,áDialogType ) )

2699 i‡–! 
aDeÁu…Buâ⁄
 )

2701 
	`°rˇt
–
lDülogSåög
 , "--defaultno " ) ;

2703 
	`°rˇt
–
lDülogSåög
 ,

2706 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesno" ,áDialogType ) )

2708 i‡–! 
aDeÁu…Buâ⁄
 )

2710 
	`°rˇt
–
lDülogSåög
 , "--defaultno " ) ;

2712 
	`°rˇt
–
lDülogSåög
 , "--yesno " ) ;

2714 i‡(
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",áDialogType))

2716 i‡(!
aDeÁu…Buâ⁄
)

2718 
	`°rˇt
(
lDülogSåög
, "--defaultno ");

2720 
	`°rˇt
(
lDülogSåög
, "--menu ");

2724 
	`°rˇt
–
lDülogSåög
 , "--msgbox " ) ;

2727 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

2728 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

2730 
	`ª∂a˚SubSå
–
aMesßge
 , "\n" , "\\n" , 
lBuff
 ) ;

2731 
	`°rˇt
(
lDülogSåög
, 
lBuff
) ;

2732 
lBuff
[0]='\0';

2734 
	`°rˇt
(
lDülogSåög
, "\" ");

2736 i‡(
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",áDialogType))

2738 
	`°rˇt
(
lDülogSåög
, "0 60 0 Yes \"\" No \"\"");

2739 
	`°rˇt
(
lDülogSåög
, "2>>");

2743 
	`°rˇt
(
lDülogSåög
, "10 60");

2744 
	`°rˇt
(
lDülogSåög
, " &&Écho 1 > ");

2747 
	`°r˝y
(
lDülogFûe
, 
	`gëív
("USERPROFILE"));

2748 
	`°rˇt
(
lDülogFûe
, "\\AppData\\Local\\Temp\\tinyfd.txt");

2749 
	`°rˇt
(
lDülogSåög
, 
lDülogFûe
);

2752 
	`sy°em
–
lDülogSåög
 ) ;

2754 i‡(!(
lIn
 = 
	`f›í
(
lDülogFûe
, "r")))

2756 
	`ªmove
(
lDülogFûe
);

2759 
	`fgës
(
lBuff
, ÷Buff), 
lIn
Ë!
NULL
)

2761 
	`f˛o£
(
lIn
);

2762 
	`ªmove
(
lDülogFûe
);

2763 i‡–
lBuff
[
	`°æí
(ÜBuff ) -1] == '\n' )

2765 
lBuff
[
	`°æí
(ÜBuff ) -1] = '\0' ;

2769 i‡–! 
	`°æí
(
lBuff
) )

2774 i‡(
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",áDialogType))

2776 i‡(
lBuff
[0] == 'Y')  1;

2781 
	}
}

2784 
	$öputBoxWöC⁄sﬁe
(

2785 * 
aoBuff
 ,

2786 c⁄° * 
aTôÀ
 ,

2787 c⁄° * 
aMesßge
 ,

2788 c⁄° * 
aDeÁu…I≈ut
 )

2790 
lDülogSåög
[
MAX_PATH_OR_CMD
];

2791 
lDülogFûe
[
MAX_PATH_OR_CMD
];

2792 
FILE
 * 
lIn
;

2793 
lResu…
;

2795 
	`°r˝y
(
lDülogFûe
, 
	`gëív
("USERPROFILE"));

2796 
	`°rˇt
(
lDülogFûe
, "\\AppData\\Local\\Temp\\tinyfd.txt");

2797 
	`°r˝y
(
lDülogSåög
 , "echo|set /p=1 >" ) ;

2798 
	`°rˇt
(
lDülogSåög
, 
lDülogFûe
);

2799 
	`°rˇt
–
lDülogSåög
 , " & " ) ;

2801 
	`°rˇt
–
lDülogSåög
 , "dialog " ) ;

2802 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

2804 
	`°rˇt
(
lDülogSåög
, "--title \"") ;

2805 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

2806 
	`°rˇt
(
lDülogSåög
, "\" ") ;

2809 
	`°rˇt
(
lDülogSåög
, "--backtitle \"") ;

2810 
	`°rˇt
(
lDülogSåög
, "tab: move focus") ;

2811 i‡–! 
aDeÁu…I≈ut
 )

2813 
	`°rˇt
(
lDülogSåög
, " (sometimesÇothing,Ço blinkÇor star, is shown inÅext field)") ;

2816 
	`°rˇt
(
lDülogSåög
, "\" ") ;

2818 i‡–! 
aDeÁu…I≈ut
 )

2820 
	`°rˇt
–
lDülogSåög
 , "--insecure --passwordbox" ) ;

2824 
	`°rˇt
–
lDülogSåög
 , "--inputbox" ) ;

2826 
	`°rˇt
–
lDülogSåög
 , " \"" ) ;

2827 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

2829 
	`°rˇt
(
lDülogSåög
, 
aMesßge
) ;

2831 
	`°rˇt
(
lDülogSåög
,"\" 10 60 ") ;

2832 i‡–
aDeÁu…I≈ut
 && 
	`°æí
(aDefaultInput) )

2834 
	`°rˇt
(
lDülogSåög
, "\"") ;

2835 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…I≈ut
) ;

2836 
	`°rˇt
(
lDülogSåög
, "\" ") ;

2839 
	`°rˇt
(
lDülogSåög
, "2>>");

2840 
	`°r˝y
(
lDülogFûe
, 
	`gëív
("USERPROFILE"));

2841 
	`°rˇt
(
lDülogFûe
, "\\AppData\\Local\\Temp\\tinyfd.txt");

2842 
	`°rˇt
(
lDülogSåög
, 
lDülogFûe
);

2843 
	`°rˇt
(
lDülogSåög
, " ||Écho 0 > ");

2844 
	`°rˇt
(
lDülogSåög
, 
lDülogFûe
);

2847 
	`sy°em
–
lDülogSåög
 ) ;

2849 i‡(!(
lIn
 = 
	`f›í
(
lDülogFûe
, "r")))

2851 
	`ªmove
(
lDülogFûe
);

2852 
aoBuff
[0] = '\0';

2855 
	`fgës
(
aoBuff
, 
MAX_PATH_OR_CMD
, 
lIn
Ë!
NULL
)

2857 
	`f˛o£
(
lIn
);

2859 
	`wùefûe
(
lDülogFûe
);

2860 
	`ªmove
(
lDülogFûe
);

2861 i‡–
aoBuff
[
	`°æí
(áoBuff ) -1] == '\n' )

2863 
aoBuff
[
	`°æí
(áoBuff ) -1] = '\0' ;

2868 
lResu…
 = 
	`°∫cmp
–
aoBuff
 , "1" , 1) ? 0 : 1 ;

2870 i‡–! 
lResu…
 )

2872 
aoBuff
[0] = '\0';

2876 
	`°r˝y
(
aoBuff
,áoBuff+3);

2878 
	}
}

2881 * 
	$ßveFûeDülogWöC⁄sﬁe
(

2882 * 
aoBuff
 ,

2883 c⁄° * 
aTôÀ
 ,

2884 c⁄° * 
aDeÁu…P©hAndFûe
 )

2886 
lDülogSåög
[
MAX_PATH_OR_CMD
];

2887 
lP©hAndFûe
[
MAX_PATH_OR_CMD
] = "";

2888 
FILE
 * 
lIn
;

2890 
	`°r˝y
–
lDülogSåög
 , "dialog " ) ;

2891 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

2893 
	`°rˇt
(
lDülogSåög
, "--title \"") ;

2894 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

2895 
	`°rˇt
(
lDülogSåög
, "\" ") ;

2898 
	`°rˇt
(
lDülogSåög
, "--backtitle \"") ;

2899 
	`°rˇt
(
lDülogSåög
,

2901 
	`°rˇt
(
lDülogSåög
, "\" ") ;

2903 
	`°rˇt
–
lDülogSåög
 , "--fselect \"" ) ;

2904 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

2907 
	`°r˝y
(
lP©hAndFûe
, 
aDeÁu…P©hAndFûe
);

2908 
	`ª∂a˚Chr
–
lP©hAndFûe
 , '\\' , '/' ) ;

2912 i‡–! 
	`°rchr
(
lP©hAndFûe
, '/') )

2914 
	`°rˇt
(
lDülogSåög
, "./") ;

2916 
	`°rˇt
(
lDülogSåög
, 
lP©hAndFûe
) ;

2917 
	`°rˇt
(
lDülogSåög
, "\" 0 60 2>");

2918 
	`°r˝y
(
lP©hAndFûe
, 
	`gëív
("USERPROFILE"));

2919 
	`°rˇt
(
lP©hAndFûe
, "\\AppData\\Local\\Temp\\tinyfd.txt");

2920 
	`°rˇt
(
lDülogSåög
, 
lP©hAndFûe
);

2923 
	`sy°em
–
lDülogSåög
 ) ;

2925 i‡(!(
lIn
 = 
	`f›í
(
lP©hAndFûe
, "r")))

2927 
	`ªmove
(
lP©hAndFûe
);

2928  
NULL
;

2930 
	`fgës
(
aoBuff
, 
MAX_PATH_OR_CMD
, 
lIn
Ë!
NULL
)

2932 
	`f˛o£
(
lIn
);

2933 
	`ªmove
(
lP©hAndFûe
);

2934 
	`ª∂a˚Chr
–
aoBuff
 , '/' , '\\' ) ;

2936 
	`gëLa°Name
(
lDülogSåög
,
aoBuff
);

2937 i‡–! 
	`°æí
(
lDülogSåög
) )

2939  
NULL
;

2941  
aoBuff
;

2942 
	}
}

2945 * 
	$›íFûeDülogWöC⁄sﬁe
(

2946 c⁄° * 
aTôÀ
 ,

2947 c⁄° * 
aDeÁu…P©hAndFûe
 )

2949 
lFûãrP©ã∫s
[
MAX_PATH_OR_CMD
] = "";

2950 
lDülogSåög
[
MAX_PATH_OR_CMD
] ;

2951 
FILE
 * 
lIn
;

2953 
aoBuff
[
MAX_PATH_OR_CMD
];

2955 
	`°r˝y
–
lDülogSåög
 , "dialog " ) ;

2956 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

2958 
	`°rˇt
(
lDülogSåög
, "--title \"") ;

2959 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

2960 
	`°rˇt
(
lDülogSåög
, "\" ") ;

2963 
	`°rˇt
(
lDülogSåög
, "--backtitle \"") ;

2964 
	`°rˇt
(
lDülogSåög
,

2966 
	`°rˇt
(
lDülogSåög
, "\" ") ;

2968 
	`°rˇt
–
lDülogSåög
 , "--fselect \"" ) ;

2969 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

2972 
	`°r˝y
(
lFûãrP©ã∫s
, 
aDeÁu…P©hAndFûe
);

2973 
	`ª∂a˚Chr
–
lFûãrP©ã∫s
 , '\\' , '/' ) ;

2977 i‡–! 
	`°rchr
(
lFûãrP©ã∫s
, '/') )

2979 
	`°rˇt
(
lDülogSåög
, "./") ;

2981 
	`°rˇt
(
lDülogSåög
, 
lFûãrP©ã∫s
) ;

2982 
	`°rˇt
(
lDülogSåög
, "\" 0 60 2>");

2983 
	`°r˝y
(
lFûãrP©ã∫s
, 
	`gëív
("USERPROFILE"));

2984 
	`°rˇt
(
lFûãrP©ã∫s
, "\\AppData\\Local\\Temp\\tinyfd.txt");

2985 
	`°rˇt
(
lDülogSåög
, 
lFûãrP©ã∫s
);

2988 
	`sy°em
–
lDülogSåög
 ) ;

2990 i‡(!(
lIn
 = 
	`f›í
(
lFûãrP©ã∫s
, "r")))

2992 
	`ªmove
(
lFûãrP©ã∫s
);

2993  
NULL
;

2995 
	`fgës
(
aoBuff
, 
MAX_PATH_OR_CMD
, 
lIn
Ë!
NULL
)

2997 
	`f˛o£
(
lIn
);

2998 
	`ªmove
(
lFûãrP©ã∫s
);

2999 
	`ª∂a˚Chr
–
aoBuff
 , '/' , '\\' ) ;

3001  
aoBuff
;

3002 
	}
}

3005 * 
	$£À˘FﬁdîDülogWöC⁄sﬁe
(

3006 * 
aoBuff
 ,

3007 c⁄° * 
aTôÀ
 ,

3008 c⁄° * 
aDeÁu…P©h
 )

3010 
lDülogSåög
 [
MAX_PATH_OR_CMD
] ;

3011 
lSåög
 [
MAX_PATH_OR_CMD
] ;

3012 
FILE
 * 
lIn
 ;

3014 
	`°r˝y
–
lDülogSåög
 , "dialog " ) ;

3015 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

3017 
	`°rˇt
(
lDülogSåög
, "--title \"") ;

3018 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

3019 
	`°rˇt
(
lDülogSåög
, "\" ") ;

3022 
	`°rˇt
(
lDülogSåög
, "--backtitle \"") ;

3023 
	`°rˇt
(
lDülogSåög
,

3025 
	`°rˇt
(
lDülogSåög
, "\" ") ;

3027 
	`°rˇt
–
lDülogSåög
 , "--dselect \"" ) ;

3028 i‡–
aDeÁu…P©h
 && 
	`°æí
(aDefaultPath) )

3031 
	`°r˝y
(
lSåög
, 
aDeÁu…P©h
) ;

3032 
	`ísuªFöÆSœsh
(
lSåög
);

3033 
	`ª∂a˚Chr
–
lSåög
 , '\\' , '/' ) ;

3034 
	`°rˇt
(
lDülogSåög
, 
lSåög
) ;

3039 
	`°rˇt
(
lDülogSåög
, "./") ;

3041 
	`°rˇt
(
lDülogSåög
, "\" 0 60 2>");

3042 
	`°r˝y
(
lSåög
, 
	`gëív
("USERPROFILE"));

3043 
	`°rˇt
(
lSåög
, "\\AppData\\Local\\Temp\\tinyfd.txt");

3044 
	`°rˇt
(
lDülogSåög
, 
lSåög
);

3047 
	`sy°em
–
lDülogSåög
 ) ;

3049 i‡(!(
lIn
 = 
	`f›í
(
lSåög
, "r")))

3051 
	`ªmove
(
lSåög
);

3052  
NULL
;

3054 
	`fgës
(
aoBuff
, 
MAX_PATH_OR_CMD
, 
lIn
Ë!
NULL
)

3056 
	`f˛o£
(
lIn
);

3057 
	`ªmove
(
lSåög
);

3058 
	`ª∂a˚Chr
–
aoBuff
 , '/' , '\\' ) ;

3060  
aoBuff
;

3061 
	}
}

3063 
	$wrôeUtf8
–c⁄° * 
aUtf8Såög
 )

3065 
lNum
;

3066 * 
lC⁄sﬁeH™dÀ
;

3067 
wch¨_t
 * 
lTmpWCh¨
;

3069 
lC⁄sﬁeH™dÀ
 = 
	`GëStdH™dÀ
(
STD_OUTPUT_HANDLE
);

3070 
lTmpWCh¨
 = 
	`töyfd_utf8to16
(
aUtf8Såög
);

3071 ()
	`WrôeC⁄sﬁeW
(
lC⁄sﬁeH™dÀ
, 
lTmpWCh¨
, 
	`wc¶í
÷TmpWCh¨), &
lNum
, 
NULL
);

3072 
	}
}

3075 
	$töyfd_mesßgeBox
(

3076 c⁄° * 
aTôÀ
 ,

3077 c⁄° * 
aMesßge
 ,

3078 c⁄° * 
aDülogTy≥
 ,

3079 c⁄° * 
aIc⁄Ty≥
 ,

3080 
aDeÁu…Buâ⁄
 )

3082 
lCh¨
 ;

3083 
UINT
 
lOrigöÆCP
;

3084 
UINT
 
lOrigöÆOuçutCP
;

3086 #i‚de‡
TINYFD_NOLIB


3087 i‡((!
töyfd_f‹˚C⁄sﬁe
 || !(
	`GëC⁄sﬁeWödow
(Ë|| 
	`dülogPª£¡
()))

3088 && (!
	`gëív
("SSH_CLIENT") || getenv("DISPLAY")))

3090 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ, "töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "windows");  1; }

3091 i‡(
töyfd_wöUtf8
)

3093  
	`mesßgeBoxWöGui8
(

3094 
aTôÀ
, 
aMesßge
, 
aDülogTy≥
, 
aIc⁄Ty≥
, 
aDeÁu…Buâ⁄
);

3098  
	`mesßgeBoxWöGuiA
(

3099 
aTôÀ
, 
aMesßge
, 
aDülogTy≥
, 
aIc⁄Ty≥
, 
aDeÁu…Buâ⁄
);

3104 i‡–
	`dülogPª£¡
() )

3106 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"dialog"); 0;}

3107  
	`mesßgeBoxWöC⁄sﬁe
(

3108 
aTôÀ
,
aMesßge
,
aDülogTy≥
,
aIc⁄Ty≥
,
aDeÁu…Buâ⁄
);

3112 i‡(!
töyfd_wöUtf8
)

3114 
lOrigöÆCP
 = 
	`GëC⁄sﬁeCP
();

3115 
lOrigöÆOuçutCP
 = 
	`GëC⁄sﬁeOuçutCP
();

3116 ()
	`SëC⁄sﬁeCP
(
	`GëACP
());

3117 ()
	`SëC⁄sﬁeOuçutCP
(
	`GëACP
());

3120 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"basicinput"); 0;}

3121 i‡(!
gW¨nögDi•œyed
 && !
töyfd_f‹˚C⁄sﬁe
 )

3123 
gW¨nögDi•œyed
 = 1;

3124 
	`¥ötf
("\n\n%s\n", 
gTôÀ
);

3125 
	`¥ötf
("%s\n\n", 
töyfd_√eds
);

3128 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

3130 
	`¥ötf
("\n");

3131 i‡(
töyfd_wöUtf8
Ë
	`wrôeUtf8
(
aTôÀ
);

3132 
	`¥ötf
("%s", 
aTôÀ
);

3133 
	`¥ötf
("\n\n");

3135 i‡–
aDülogTy≥
 && !
	`°rcmp
("yesno",aDialogType) )

3139 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

3141 i‡(
töyfd_wöUtf8
Ë
	`wrôeUtf8
(
aMesßge
);

3142 
	`¥ötf
("%s",
aMesßge
);

3143 
	`¥ötf
("\n");

3145 
	`¥ötf
("y/n: ");

3146 
lCh¨
 = (Ë
	`tﬁowî
–
	`_gëch
() ) ;

3147 
	`¥ötf
("\n\n");

3149  
lCh¨
 != 'y' &&ÜChar != 'n' ) ;

3150 i‡(!
töyfd_wöUtf8
Ë{ ()
	`SëC⁄sﬁeCP
(
lOrigöÆCP
); ()
	`SëC⁄sﬁeOuçutCP
(
lOrigöÆOuçutCP
); }

3151  
lCh¨
 == 'y' ? 1 : 0 ;

3153 i‡–
aDülogTy≥
 && !
	`°rcmp
("okcancel",aDialogType) )

3157 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

3159 i‡(
töyfd_wöUtf8
Ë
	`wrôeUtf8
(
aMesßge
);

3160 
	`¥ötf
("%s", 
aMesßge
);

3161 
	`¥ötf
("\n");

3163 
	`¥ötf
("[O]kay/[C]ancel: ");

3164 
lCh¨
 = (Ë
	`tﬁowî
–
	`_gëch
() ) ;

3165 
	`¥ötf
("\n\n");

3167  
lCh¨
 != 'o' &&ÜChar != 'c' ) ;

3168 i‡(!
töyfd_wöUtf8
Ë{ ()
	`SëC⁄sﬁeCP
(
lOrigöÆCP
); ()
	`SëC⁄sﬁeOuçutCP
(
lOrigöÆOuçutCP
); }

3169  
lCh¨
 == 'o' ? 1 : 0 ;

3171 i‡(
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",áDialogType))

3175 i‡(
aMesßge
 && 
	`°æí
(aMessage))

3177 i‡(
töyfd_wöUtf8
Ë
	`wrôeUtf8
(
aMesßge
);

3178 
	`¥ötf
("%s", 
aMesßge
);

3179 
	`¥ötf
("\n");

3181 
	`¥ötf
("[Y]es/[N]o/[C]ancel: ");

3182 
lCh¨
 = ()
	`tﬁowî
(
	`_gëch
());

3183 
	`¥ötf
("\n\n");

3184 } 
lCh¨
 != 'y' &&ÜChar != 'n' &&ÜChar != 'c');

3185 i‡(!
töyfd_wöUtf8
Ë{ ()
	`SëC⁄sﬁeCP
(
lOrigöÆCP
); ()
	`SëC⁄sﬁeOuçutCP
(
lOrigöÆOuçutCP
); }

3186  (
lCh¨
 == 'y') ? 1 : (lChar == 'n') ? 2 : 0 ;

3190 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

3192 i‡(
töyfd_wöUtf8
Ë
	`wrôeUtf8
(
aMesßge
);

3193 
	`¥ötf
("%s", 
aMesßge
);

3194 
	`¥ötf
("\n\n");

3196 
	`¥ötf
("pressÉnterÅo continue ");

3197 
lCh¨
 = (Ë
	`_gëch
() ;

3198 
	`¥ötf
("\n\n");

3199 i‡(!
töyfd_wöUtf8
Ë{ ()
	`SëC⁄sﬁeCP
(
lOrigöÆCP
); ()
	`SëC⁄sﬁeOuçutCP
(
lOrigöÆOuçutCP
); }

3203 
	}
}

3207 
	$töyfd_nŸifyP›up
(

3208 c⁄° * 
aTôÀ
 ,

3209 c⁄° * 
aMesßge
 ,

3210 c⁄° * 
aIc⁄Ty≥
 )

3212 #i‚de‡
TINYFD_NOLIB


3213 i‡((!
töyfd_f‹˚C⁄sﬁe
 || !(

3214 
	`GëC⁄sﬁeWödow
() ||

3215 
	`dülogPª£¡
()))

3216 && ( !
	`gëív
("SSH_CLIENT") || getenv("DISPLAY") ) )

3218 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"windows"); 1;}

3219  
	`nŸifyWöGui
(
aTôÀ
, 
aMesßge
, 
aIc⁄Ty≥
);

3223  
	`töyfd_mesßgeBox
(
aTôÀ
, 
aMesßge
, "ok" , 
aIc⁄Ty≥
, 0);

3224 
	}
}

3228 * 
	$töyfd_öputBox
(

3229 c⁄° * 
aTôÀ
 ,

3230 c⁄° * 
aMesßge
 ,

3231 c⁄° * 
aDeÁu…I≈ut
 )

3233 
lBuff
[
MAX_PATH_OR_CMD
] = "";

3234 * 
lEOF
;

3236 
DWORD
 
mode
 = 0;

3237 
HANDLE
 
hStdö
 = 
	`GëStdH™dÀ
(
STD_INPUT_HANDLE
);

3239 
lNum
;

3240 * 
lC⁄sﬁeH™dÀ
;

3241 * 
lTmpCh¨
;

3242 
wch¨_t
 
lBuffW
[1024];

3244 
UINT
 
lOrigöÆCP
;

3245 
UINT
 
lOrigöÆOuçutCP
;

3248 i‡(!
aTôÀ
 && !
aMesßge
 && !
aDeÁu…I≈ut
Ë 
lBuff
;

3250 #i‚de‡
TINYFD_NOLIB


3251 
mode
 = 0;

3252 
hStdö
 = 
	`GëStdH™dÀ
(
STD_INPUT_HANDLE
);

3254 i‡((!
töyfd_f‹˚C⁄sﬁe
 || !(

3255 
	`GëC⁄sﬁeWödow
() ||

3256 
	`dülogPª£¡
()))

3257 && ( !
	`gëív
("SSH_CLIENT") || getenv("DISPLAY") ) )

3259 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"windows"); (*)1;}

3260 
lBuff
[0]='\0';

3261 i‡(
	`öputBoxWöGui
(
lBuff
, 
aTôÀ
, 
aMesßge
, 
aDeÁu…I≈ut
)) ÜBuff;

3262  
NULL
;

3266 i‡–
	`dülogPª£¡
() )

3268 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"dialog"); (*)0;}

3269 
lBuff
[0]='\0';

3270 i‡(
	`öputBoxWöC⁄sﬁe
(
lBuff
, 
aTôÀ
, 
aMesßge
, 
aDeÁu…I≈ut
) ) ÜBuff;

3271  
NULL
;

3275 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"basicinput"); (*)0;}

3276 
lBuff
[0]='\0';

3277 i‡(!
gW¨nögDi•œyed
 && !
töyfd_f‹˚C⁄sﬁe
)

3279 
gW¨nögDi•œyed
 = 1 ;

3280 
	`¥ötf
("\n\n%s\n", 
gTôÀ
);

3281 
	`¥ötf
("%s\n\n", 
töyfd_√eds
);

3284 i‡(!
töyfd_wöUtf8
)

3286 
lOrigöÆCP
 = 
	`GëC⁄sﬁeCP
();

3287 
lOrigöÆOuçutCP
 = 
	`GëC⁄sﬁeOuçutCP
();

3288 ()
	`SëC⁄sﬁeCP
(
	`GëACP
());

3289 ()
	`SëC⁄sﬁeOuçutCP
(
	`GëACP
());

3292 i‡(
aTôÀ
 && 
	`°æí
(aTitle))

3294 
	`¥ötf
("\n");

3295 i‡(
töyfd_wöUtf8
Ë
	`wrôeUtf8
(
aTôÀ
);

3296 
	`¥ötf
("%s", 
aTôÀ
);

3297 
	`¥ötf
("\n\n");

3299 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

3301 i‡(
töyfd_wöUtf8
Ë
	`wrôeUtf8
(
aMesßge
);

3302 
	`¥ötf
("%s", 
aMesßge
);

3303 
	`¥ötf
("\n");

3305 
	`¥ötf
("(ctrl-Z +ÉnterÅo cancel): ");

3306 i‡–! 
aDeÁu…I≈ut
 )

3308 (Ë
	`GëC⁄sﬁeMode
(
hStdö
, &
mode
);

3309 (Ë
	`SëC⁄sﬁeMode
(
hStdö
, 
mode
 & (~
ENABLE_ECHO_INPUT
));

3311 i‡(
töyfd_wöUtf8
)

3313 
lC⁄sﬁeH™dÀ
 = 
	`GëStdH™dÀ
(
STD_INPUT_HANDLE
);

3314 (Ë
	`RódC⁄sﬁeW
(
lC⁄sﬁeH™dÀ
, 
lBuffW
, 
MAX_PATH_OR_CMD
, &
lNum
, 
NULL
);

3315 i‡(!
aDeÁu…I≈ut
)

3317 ()
	`SëC⁄sﬁeMode
(
hStdö
, 
mode
);

3318 
	`¥ötf
("\n");

3320 
lBuffW
[
lNum
] = '\0';

3321 i‡(
lBuffW
[
	`wc¶í
(lBuffW) - 1] == '\n')ÜBuffW[wcslen(lBuffW) - 1] = '\0';

3322 i‡(
lBuffW
[
	`wc¶í
(lBuffW) - 1] == '\r')ÜBuffW[wcslen(lBuffW) - 1] = '\0';

3323 
lTmpCh¨
 = 
	`töyfd_utf16to8
(
lBuffW
);

3324 i‡(
lTmpCh¨
)

3326 
	`°r˝y
(
lBuff
, 
lTmpCh¨
);

3327  
lBuff
;

3330  
NULL
;

3334 
lEOF
 = 
	`fgës
(
lBuff
, 
MAX_PATH_OR_CMD
, 
°dö
);

3335 i‡(!
aDeÁu…I≈ut
)

3337 ()
	`SëC⁄sﬁeMode
(
hStdö
, 
mode
);

3338 
	`¥ötf
("\n");

3341 i‡(!
töyfd_wöUtf8
)

3343 ()
	`SëC⁄sﬁeCP
(
lOrigöÆCP
);

3344 ()
	`SëC⁄sﬁeOuçutCP
(
lOrigöÆOuçutCP
);

3347 i‡(!
lEOF
)

3349  
NULL
;

3351 
	`¥ötf
("\n");

3352 i‡(
	`°rchr
(
lBuff
, 27))

3354  
NULL
;

3356 i‡(
lBuff
[
	`°æí
(lBuff) - 1] == '\n')

3358 
lBuff
[
	`°æí
(lBuff) - 1] = '\0';

3360  
lBuff
;

3363 
	}
}

3366 * 
	$töyfd_ßveFûeDülog
(

3367 c⁄° * 
aTôÀ
 ,

3368 c⁄° * 
aDeÁu…P©hAndFûe
 ,

3369 
aNumOfFûãrP©ã∫s
 ,

3370 c⁄° * c⁄° * 
aFûãrP©ã∫s
 ,

3371 c⁄° * 
aSögÀFûãrDes¸ùti⁄
 )

3373 
lBuff
 [
MAX_PATH_OR_CMD
] ;

3374 
lSåög
[
MAX_PATH_OR_CMD
] ;

3375 * 
p
 ;

3376 * 
lPoöãrI≈utBox
;

3377 
lBuff
[0]='\0';

3378 #i‚de‡
TINYFD_NOLIB


3379 i‡––!
töyfd_f‹˚C⁄sﬁe
 || !–
	`GëC⁄sﬁeWödow
(Ë|| 
	`dülogPª£¡
() ) )

3380 && ( !
	`gëív
("SSH_CLIENT") || getenv("DISPLAY") ) )

3382 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"windows"); (*)1;}

3383 i‡(
töyfd_wöUtf8
)

3385 
p
 = 
	`ßveFûeDülogWöGui8
(
lBuff
,

3386 
aTôÀ
, 
aDeÁu…P©hAndFûe
, 
aNumOfFûãrP©ã∫s
, 
aFûãrP©ã∫s
, 
aSögÀFûãrDes¸ùti⁄
);

3390 
p
 = 
	`ßveFûeDülogWöGuiA
(
lBuff
,

3391 
aTôÀ
, 
aDeÁu…P©hAndFûe
, 
aNumOfFûãrP©ã∫s
, 
aFûãrP©ã∫s
, 
aSögÀFûãrDes¸ùti⁄
);

3396 i‡(
	`dülogPª£¡
())

3398 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ, "töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "dialog");  (*)0; }

3399 
p
 = 
	`ßveFûeDülogWöC⁄sﬁe
(
lBuff
, 
aTôÀ
, 
aDeÁu…P©hAndFûe
);

3403 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ, "töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "basicinput");  (*)0; }

3404 
	`°r˝y
(
lBuff
, "Save file in ");

3405 
	`°rˇt
(
lBuff
, 
	`gëCurDú
());

3407 
lPoöãrI≈utBox
 = 
	`töyfd_öputBox
(
NULL
,NULL,NULL);

3408 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
(
lSåög
,ÜPointerInputBox);

3409 
p
 = 
	`töyfd_öputBox
(
aTôÀ
, 
lBuff
, "");

3410 i‡(
p
Ë
	`°r˝y
(
lBuff
,Ö); lBuff[0] = '\0';

3411 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
÷PoöãrI≈utBox, 
lSåög
);

3412 
p
 = 
lBuff
;

3416 i‡–! 
p
 || ! 
	`°æí
(Ö ) )

3418  
NULL
;

3420 
	`gëP©hWôhoutFöÆSœsh
–
lSåög
 , 
p
 ) ;

3421 i‡–
	`°æí
–
lSåög
 ) && ! 
	`dúExi°s
(ÜString ) )

3423  
NULL
 ;

3425 
	`gëLa°Name
(
lSåög
,
p
);

3426 i‡–! 
	`fûíameVÆid
(
lSåög
) )

3428  
NULL
;

3430  
p
 ;

3431 
	}
}

3435 * 
	$töyfd_›íFûeDülog
(

3436 c⁄° * 
aTôÀ
 ,

3437 c⁄° * 
aDeÁu…P©hAndFûe
 ,

3438 
aNumOfFûãrP©ã∫s
 ,

3439 c⁄° * c⁄° * 
aFûãrP©ã∫s
 ,

3440 c⁄° * 
aSögÀFûãrDes¸ùti⁄
 ,

3441 
aAŒowMu…ùÀSñe˘s
 )

3443 
lSåög
[
MAX_PATH_OR_CMD
];

3444 
lBuff
[
MAX_PATH_OR_CMD
];

3445 * 
p
;

3446 * 
lPoöãrI≈utBox
;

3448 #i‚de‡
TINYFD_NOLIB


3449 i‡––!
töyfd_f‹˚C⁄sﬁe
 || !–
	`GëC⁄sﬁeWödow
(Ë|| 
	`dülogPª£¡
() ) )

3450 && ( !
	`gëív
("SSH_CLIENT") || getenv("DISPLAY") ) )

3452 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"windows"); (*)1;}

3453 i‡(
töyfd_wöUtf8
)

3455 
p
 = 
	`›íFûeDülogWöGui8
–
aTôÀ
, 
aDeÁu…P©hAndFûe
, 
aNumOfFûãrP©ã∫s
,

3456 
aFûãrP©ã∫s
, 
aSögÀFûãrDes¸ùti⁄
, 
aAŒowMu…ùÀSñe˘s
);

3460 
p
 = 
	`›íFûeDülogWöGuiA
–
aTôÀ
, 
aDeÁu…P©hAndFûe
, 
aNumOfFûãrP©ã∫s
,

3461 
aFûãrP©ã∫s
, 
aSögÀFûãrDes¸ùti⁄
, 
aAŒowMu…ùÀSñe˘s
);

3466 i‡(
	`dülogPª£¡
())

3468 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ, "töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "dialog");  (*)0; }

3469 
p
 = 
	`›íFûeDülogWöC⁄sﬁe
(
aTôÀ
, 
aDeÁu…P©hAndFûe
);

3473 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ, "töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "basicinput");  (*)0; }

3474 
	`°r˝y
(
lBuff
, "Open file from ");

3475 
	`°rˇt
(
lBuff
, 
	`gëCurDú
());

3476 
lPoöãrI≈utBox
 = 
	`töyfd_öputBox
(
NULL
, NULL, NULL);

3477 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
(
lSåög
,ÜPointerInputBox);

3478 
p
 = 
	`töyfd_öputBox
(
aTôÀ
, 
lBuff
, "");

3479 i‡(
p
Ë
	`°r˝y
(
lBuff
,Ö); lBuff[0] = '\0';

3480 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
÷PoöãrI≈utBox, 
lSåög
);

3481 
p
 = 
lBuff
;

3484 i‡–! 
p
 || ! 
	`°æí
(Ö ) )

3486  
NULL
;

3488 i‡–
aAŒowMu…ùÀSñe˘s
 && 
	`°rchr
(
p
, '|') )

3490 
p
 = 
	`ísuªFûesExi°
( (*)Ö ,Ö ) ;

3492 i‡–! 
	`fûeExi°s
(
p
) )

3494  
NULL
 ;

3497  
p
 ;

3498 
	}
}

3501 * 
	$töyfd_£À˘FﬁdîDülog
(

3502 c⁄° * 
aTôÀ
 ,

3503 c⁄° * 
aDeÁu…P©h
 )

3505 
lBuff
[
MAX_PATH_OR_CMD
];

3506 * 
p
;

3507 * 
lPoöãrI≈utBox
;

3508 
lSåög
[
MAX_PATH_OR_CMD
];

3510 #i‚de‡
TINYFD_NOLIB


3511 i‡––!
töyfd_f‹˚C⁄sﬁe
 || !–
	`GëC⁄sﬁeWödow
(Ë|| 
	`dülogPª£¡
() ) )

3512 && ( !
	`gëív
("SSH_CLIENT") || getenv("DISPLAY") ) )

3514 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"windows"); (*)1;}

3515 i‡(
töyfd_wöUtf8
)

3517 
p
 = 
	`£À˘FﬁdîDülogWöGui8
(
lBuff
, 
aTôÀ
, 
aDeÁu…P©h
);

3521 
p
 = 
	`£À˘FﬁdîDülogWöGuiA
(
lBuff
, 
aTôÀ
, 
aDeÁu…P©h
);

3526 i‡(
	`dülogPª£¡
())

3528 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ, "töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "dialog");  (*)0; }

3529 
p
 = 
	`£À˘FﬁdîDülogWöC⁄sﬁe
(
lBuff
, 
aTôÀ
, 
aDeÁu…P©h
);

3533 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ, "töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "basicinput");  (*)0; }

3534 
	`°r˝y
(
lBuff
, "Select folder from ");

3535 
	`°rˇt
(
lBuff
, 
	`gëCurDú
());

3536 
lPoöãrI≈utBox
 = 
	`töyfd_öputBox
(
NULL
, NULL, NULL);

3537 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
(
lSåög
,ÜPointerInputBox);

3538 
p
 = 
	`töyfd_öputBox
(
aTôÀ
, 
lBuff
, "");

3539 i‡(
p
Ë
	`°r˝y
(
lBuff
,Ö); lBuff[0] = '\0';

3540 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
÷PoöãrI≈utBox, 
lSåög
);

3541 
p
 = 
lBuff
;

3544 i‡–! 
p
 || ! 
	`°æí
–∞Ë|| ! 
	`dúExi°s
(Ö ) )

3546  
NULL
 ;

3548  
p
 ;

3549 
	}
}

3556 * 
	$töyfd_cﬁ‹Choo£r
(

3557 c⁄° * 
aTôÀ
,

3558 c⁄° * 
aDeÁu…HexRGB
,

3559 c⁄° 
aDeÁu…RGB
[3],

3560 
aoResu…RGB
[3])

3562 
lDeÁu…HexRGB
[16];

3563 
i
;

3564 * 
p
 ;

3565 * 
lPoöãrI≈utBox
;

3566 
lSåög
[
MAX_PATH_OR_CMD
];

3568 
lDeÁu…HexRGB
[0] = '\0';

3570 #i‚de‡
TINYFD_NOLIB


3571 i‡–(!
töyfd_f‹˚C⁄sﬁe
 || !–
	`GëC⁄sﬁeWödow
(Ë|| 
	`dülogPª£¡
()) )

3572 && (!
	`gëív
("SSH_CLIENT") || getenv("DISPLAY")) )

3574 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"windows"); (*)1;}

3575 i‡(
töyfd_wöUtf8
)

3577 
p
 = 
	`cﬁ‹Choo£rWöGui8
(

3578 
aTôÀ
, 
aDeÁu…HexRGB
, 
aDeÁu…RGB
, 
aoResu…RGB
);

3579 
	`°r˝y
(
lDeÁu…HexRGB
, 
p
);

3583 
p
 = 
	`cﬁ‹Choo£rWöGuiA
(

3584 
aTôÀ
, 
aDeÁu…HexRGB
, 
aDeÁu…RGB
, 
aoResu…RGB
);

3585 
	`°r˝y
(
lDeÁu…HexRGB
, 
p
);

3587  
lDeÁu…HexRGB
;

3592 i‡(
	`dülogPª£¡
())

3594 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ, "töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "dialog");  (*)0; }

3598 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ, "töyfd_quîy")){ 
	`°r˝y
(
töyfd_ª•⁄£
, "basicinput");  (*)0; }

3601 i‡(
aDeÁu…HexRGB
)

3603 
	`°∫˝y
(
lDeÁu…HexRGB
, 
aDeÁu…HexRGB
,7);

3604 
lDeÁu…HexRGB
[7]='\0';

3608 
	`RGB2Hex
(
aDeÁu…RGB
, 
lDeÁu…HexRGB
);

3611 
lPoöãrI≈utBox
 = 
	`töyfd_öputBox
(
NULL
, NULL, NULL);

3612 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
(
lSåög
,ÜPointerInputBox);

3613 
p
 = 
	`töyfd_öputBox
(
aTôÀ
, "E¡î hexÑgb cﬁ‹ (i.e. #f5ˇ20)", 
lDeÁu…HexRGB
);

3615 i‡–!
p
 || (
	`°æí
(p) != 7) || (p[0] != '#') )

3617  
NULL
 ;

3619  
i
 = 1 ; i < 7 ; i ++ )

3621 i‡–! 
	`isxdigô
–(Ë
p
[
i
] ) )

3623  
NULL
 ;

3626 
	`Hex2RGB
(
p
,
aoResu…RGB
);

3628 
	`°r˝y
(
lDeÁu…HexRGB
, 
p
);

3630 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
÷PoöãrI≈utBox, 
lSåög
);

3632  
lDeÁu…HexRGB
;

3633 
	}
}

3638 
	ggPyth⁄2Name
[16];

3639 
	ggPyth⁄3Name
[16];

3640 
	ggPyth⁄Name
[16];

3642 
	$isD¨wö
()

3644 
lsIsD¨wö
 = -1 ;

3645 
ut¢ame
 
lUt¢ame
 ;

3646 i‡–
lsIsD¨wö
 < 0 )

3648 
lsIsD¨wö
 = !
	`u«me
(&
lUt¢ame
Ë&& !
	`°rcmp
÷Ut¢ame.
sy¢ame
,"Darwin") ;

3650  
lsIsD¨wö
 ;

3651 
	}
}

3654 
	$dúExi°s
–c⁄° * 
aDúP©h
 )

3656 
DIR
 * 
lDú
 ;

3657 i‡–! 
aDúP©h
 || ! 
	`°æí
(áDirPath ) )

3659 
lDú
 = 
	`›ídú
–
aDúP©h
 ) ;

3660 i‡–! 
lDú
 )

3664 
	`˛o£dú
–
lDú
 ) ;

3666 
	}
}

3669 
	$dëe˘Pª£n˚
–c⁄° * 
aExecuèbÀ
 )

3671 
lBuff
 [
MAX_PATH_OR_CMD
] ;

3672 
lTe°edSåög
 [
MAX_PATH_OR_CMD
] = "which " ;

3673 
FILE
 * 
lIn
 ;

3675 
	`°rˇt
–
lTe°edSåög
 , 
aExecuèbÀ
 ) ;

3676 
	`°rˇt
–
lTe°edSåög
, " 2>/dev/null ");

3677 
lIn
 = 
	`p›í
–
lTe°edSåög
 , "r" ) ;

3678 i‡––
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

3679 && ( ! 
	`°rchr
–
lBuff
 , ':' ) )

3680 && ( 
	`°∫cmp
(
lBuff
, "no ", 3) ) )

3682 
	`p˛o£
–
lIn
 ) ;

3683 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("dëe˘Pª£n˚ %†%d\n", 
aExecuèbÀ
, 1);

3688 
	`p˛o£
–
lIn
 ) ;

3689 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("dëe˘Pª£n˚ %†%d\n", 
aExecuèbÀ
, 0);

3692 
	}
}

3695 * 
	$gëVîsi⁄
–c⁄° * 
aExecuèbÀ
 )

3697 
lBuff
 [
MAX_PATH_OR_CMD
] ;

3698 
lTe°edSåög
 [
MAX_PATH_OR_CMD
] ;

3699 
FILE
 * 
lIn
 ;

3700 * 
lTmp
 ;

3702 
	`°r˝y
–
lTe°edSåög
 , 
aExecuèbÀ
 ) ;

3703 
	`°rˇt
–
lTe°edSåög
 , " --version" ) ;

3705 
lIn
 = 
	`p›í
–
lTe°edSåög
 , "r" ) ;

3706 
lTmp
 = 
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) ;

3707 
	`p˛o£
–
lIn
 ) ;

3709 
lTmp
 +
	`°rc•n
(lTmp,"0123456789");

3711  
lTmp
 ;

3712 
	}
}

3715 * 
	$gëMaj‹Mö‹P©ch
–c⁄° * 
aExecuèbÀ
 )

3717 
lAºay
 [3] ;

3718 * 
lTmp
 ;

3720 
lTmp
 = (*Ë
	`gëVîsi⁄
(
aExecuèbÀ
);

3721 
lAºay
[0] = 
	`©oi
–
	`°πok
(
lTmp
," ,.-") ) ;

3723 
lAºay
[1] = 
	`©oi
–
	`°πok
(0," ,.-") ) ;

3725 
lAºay
[2] = 
	`©oi
–
	`°πok
(0," ,.-") ) ;

3728 i‡–!
lAºay
[0] && !lAºay[1] && !lAºay[2] )  
NULL
;

3729  
lAºay
 ;

3730 
	}
}

3733 
	$åyComm™d
–c⁄° * 
aComm™d
 )

3735 
lBuff
 [
MAX_PATH_OR_CMD
] ;

3736 
FILE
 * 
lIn
 ;

3738 
lIn
 = 
	`p›í
–
aComm™d
 , "r" ) ;

3739 i‡–
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) =
NULL
 )

3741 
	`p˛o£
–
lIn
 ) ;

3746 
	`p˛o£
–
lIn
 ) ;

3750 
	}
}

3753 
	$isTîmöÆRu¬ög
()

3755 
lIsTîmöÆRu¬ög
 = -1 ;

3756 i‡–
lIsTîmöÆRu¬ög
 < 0 )

3758 
lIsTîmöÆRu¬ög
 = 
	`ißây
(1);

3759 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("isTîmöÆRu¬ög %d\n", 
lIsTîmöÆRu¬ög
 );

3761  
lIsTîmöÆRu¬ög
;

3762 
	}
}

3765 * 
	$dülogNameO∆y
()

3767 
lDülogName
[128] = "*" ;

3768 i‡–
lDülogName
[0] == '*' )

3770 i‡(!
töyfd_ÆlowCur£sDülogs
)

3772 
	`°r˝y
(
lDülogName
 , "" );

3774 i‡–
	`isD¨wö
(Ë&& * 
	`°r˝y
(
lDülogName
 , "/opt/local/bin/dialog" )

3775 && 
	`dëe˘Pª£n˚
–
lDülogName
 ) )

3777 i‡–* 
	`°r˝y
(
lDülogName
 , "dialog" )

3778 && 
	`dëe˘Pª£n˚
–
lDülogName
 ) )

3782 
	`°r˝y
(
lDülogName
 , "" );

3785  
lDülogName
 ;

3786 
	}
}

3789 
	$isDülogVîsi⁄Bëãr09b
()

3791 c⁄° * 
lDülogName
 ;

3792 * 
lVîsi⁄
 ;

3793 
lMaj‹
 ;

3794 
lMö‹
 ;

3795 
lD©e
 ;

3796 
lResu…
 ;

3797 * 
lMö‹P
 ;

3798 * 
lLëãr
 ;

3799 
lBuff
[128] ;

3803 
lDülogName
 = 
	`dülogNameO∆y
() ;

3804 i‡–! 
	`°æí
(
lDülogName
Ë|| !(
lVîsi⁄
 = (*Ë
	`gëVîsi⁄
(lDialogName)) )  0 ;

3807 
	`°r˝y
(
lBuff
,
lVîsi⁄
);

3808 
lMaj‹
 = 
	`©oi
–
	`°πok
(
lVîsi⁄
," ,.-") ) ;

3810 
lMö‹P
 = 
	`°πok
(0," ,.-abcdefghijklmnopqrstuvxyz");

3811 
lMö‹
 = 
	`©oi
–
lMö‹P
 ) ;

3813 
lD©e
 = 
	`©oi
–
	`°πok
(0," ,.-") ) ;

3814 i‡(
lD©e
<0)ÜDate = -ÜDate;

3816 
lLëãr
 = 
lMö‹P
 + 
	`°æí
(lMinorP) ;

3817 
	`°r˝y
(
lVîsi⁄
,
lBuff
);

3818 
	`°πok
(
lLëãr
," ,.-");

3820 
lResu…
 = (
lMaj‹
 > 0Ë|| ( ( 
lMö‹
 =9 ) && (*
lLëãr
 ='b'Ë&& (
lD©e
 >= 20031126) );

3822  
lResu…
;

3823 
	}
}

3826 
	$whùèûPª£¡O∆y
()

3828 
lWhùèûPª£¡
 = -1 ;

3829 i‡(!
töyfd_ÆlowCur£sDülogs
)  0;

3830 i‡–
lWhùèûPª£¡
 < 0 )

3832 
lWhùèûPª£¡
 = 
	`dëe˘Pª£n˚
( "whiptail" ) ;

3834  
lWhùèûPª£¡
 ;

3835 
	}
}

3838 * 
	$ãrmöÆName
()

3840 
lTîmöÆName
[128] = "*" ;

3841 
lShñlName
[64] = "*" ;

3842 * 
lAºay
;

3844 i‡–
lTîmöÆName
[0] == '*' )

3846 i‡–
	`dëe˘Pª£n˚
( "bash" ) )

3848 
	`°r˝y
(
lShñlName
 , "bash -c " ) ;

3850 i‡–
	`°æí
(
	`dülogNameO∆y
()Ë|| 
	`whùèûPª£¡O∆y
() )

3852 
	`°r˝y
(
lShñlName
 , "sh -c " ) ;

3856 
	`°r˝y
(
lTîmöÆName
 , "" ) ;

3857  
NULL
 ;

3860 i‡–
	`isD¨wö
() )

3862 i‡–* 
	`°r˝y
(
lTîmöÆName
 , "/opt/X11/bin/xterm" )

3863 && 
	`dëe˘Pª£n˚
–
lTîmöÆName
 ) )

3865 
	`°rˇt
(
lTîmöÆName
 , " -fa 'DejaVu Sans Mono' -fs 10 -titleÅinyfiledialogs -e " ) ;

3866 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3870 
	`°r˝y
(
lTîmöÆName
 , "" ) ;

3873 i‡–* 
	`°r˝y
(
lTîmöÆName
,"xterm")

3874 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3876 
	`°rˇt
(
lTîmöÆName
 , " -fa 'DejaVu Sans Mono' -fs 10 -titleÅinyfiledialogs -e " ) ;

3877 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3879 i‡–* 
	`°r˝y
(
lTîmöÆName
,"terminator")

3880 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3882 
	`°rˇt
(
lTîmöÆName
 , " -x " ) ;

3883 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3885 i‡–* 
	`°r˝y
(
lTîmöÆName
,"lxterminal")

3886 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3888 
	`°rˇt
(
lTîmöÆName
 , " -e " ) ;

3889 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3891 i‡–* 
	`°r˝y
(
lTîmöÆName
,"konsole")

3892 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3894 
	`°rˇt
(
lTîmöÆName
 , " -e " ) ;

3895 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3897 i‡–* 
	`°r˝y
(
lTîmöÆName
,"kterm")

3898 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3900 
	`°rˇt
(
lTîmöÆName
 , " -e " ) ;

3901 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3903 i‡–* 
	`°r˝y
(
lTîmöÆName
,"tilix")

3904 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3906 
	`°rˇt
(
lTîmöÆName
 , " -e " ) ;

3907 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3909 i‡–* 
	`°r˝y
(
lTîmöÆName
,"xfce4-terminal")

3910 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3912 
	`°rˇt
(
lTîmöÆName
 , " -x " ) ;

3913 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3915 i‡–* 
	`°r˝y
(
lTîmöÆName
,"mate-terminal")

3916 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3918 
	`°rˇt
(
lTîmöÆName
 , " -x " ) ;

3919 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3921 i‡–* 
	`°r˝y
(
lTîmöÆName
,"Eterm")

3922 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3924 
	`°rˇt
(
lTîmöÆName
 , " -e " ) ;

3925 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3927 i‡–* 
	`°r˝y
(
lTîmöÆName
,"evilvte")

3928 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3930 
	`°rˇt
(
lTîmöÆName
 , " -e " ) ;

3931 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3933 i‡–* 
	`°r˝y
(
lTîmöÆName
,"pterm")

3934 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
) )

3936 
	`°rˇt
(
lTîmöÆName
 , " -e " ) ;

3937 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3939 i‡–* 
	`°r˝y
(
lTîmöÆName
,"gnome-terminal")

3940 && 
	`dëe˘Pª£n˚
(
lTîmöÆName
Ë&& (
lAºay
 = 
	`gëMaj‹Mö‹P©ch
(lTerminalName))

3941 && ((
lAºay
[0]<3) || (lArray[0]==3 &&ÜArray[1]<=6)) )

3943 
	`°rˇt
(
lTîmöÆName
 , " --disable-factory -x " ) ;

3944 
	`°rˇt
(
lTîmöÆName
 , 
lShñlName
 ) ;

3948 
	`°r˝y
(
lTîmöÆName
 , "" ) ;

3954 i‡–
	`°æí
(
lTîmöÆName
) )

3956  
lTîmöÆName
 ;

3960  
NULL
 ;

3962 
	}
}

3965 * 
	$dülogName
()

3967 * 
lDülogName
 ;

3968 
lDülogName
 = 
	`dülogNameO∆y
( ) ;

3969 i‡–
	`°æí
(
lDülogName
Ë&& ( 
	`isTîmöÆRu¬ög
(Ë|| 
	`ãrmöÆName
() ) )

3971  
lDülogName
 ;

3975  
NULL
 ;

3977 
	}
}

3980 
	$whùèûPª£¡
()

3982 
lWhùèûPª£¡
 ;

3983 
lWhùèûPª£¡
 = 
	`whùèûPª£¡O∆y
( ) ;

3984 i‡–
lWhùèûPª£¡
 && ( 
	`isTîmöÆRu¬ög
(Ë|| 
	`ãrmöÆName
() ) )

3986  
lWhùèûPª£¡
 ;

3992 
	}
}

3996 
	$gøphicMode
()

3998  !–
töyfd_f‹˚C⁄sﬁe
 && (
	`isTîmöÆRu¬ög
(Ë|| 
	`ãrmöÆName
()) )

3999 && ( 
	`gëív
("DISPLAY")

4000 || (
	`isD¨wö
(Ë&& (!
	`gëív
("SSH_TTY") || getenv("DISPLAY") ) ) ) ;

4001 
	}
}

4004 
	$∑˘lPª£¡
()

4006 
lPa˘lPª£¡
 = -1 ;

4007 i‡–
lPa˘lPª£¡
 < 0 )

4009 
lPa˘lPª£¡
 = 
	`dëe˘Pª£n˚
("pactl") ;

4011  
lPa˘lPª£¡
 ;

4012 
	}
}

4015 
	$•ókîã°Pª£¡
()

4017 
lS≥akîã°Pª£¡
 = -1 ;

4018 i‡–
lS≥akîã°Pª£¡
 < 0 )

4020 
lS≥akîã°Pª£¡
 = 
	`dëe˘Pª£n˚
("speaker-test") ;

4022  
lS≥akîã°Pª£¡
 ;

4023 
	}
}

4026 
	$bì≥xePª£¡
()

4028 
lBì≥xePª£¡
 = -1 ;

4029 i‡–
lBì≥xePª£¡
 < 0 )

4031 
lBì≥xePª£¡
 = 
	`dëe˘Pª£n˚
("beep.exe") ;

4033  
lBì≥xePª£¡
 ;

4034 
	}
}

4037 
	$xmesßgePª£¡
()

4039 
lXmesßgePª£¡
 = -1 ;

4040 i‡–
lXmesßgePª£¡
 < 0 )

4042 
lXmesßgePª£¡
 = 
	`dëe˘Pª£n˚
("xmessage");

4044  
lXmesßgePª£¡
 && 
	`gøphicMode
( ) ;

4045 
	}
}

4048 
	$gxmesßgePª£¡
()

4050 
lGxmesßgePª£¡
 = -1 ;

4051 i‡–
lGxmesßgePª£¡
 < 0 )

4053 
lGxmesßgePª£¡
 = 
	`dëe˘Pª£n˚
("gxmessage") ;

4055  
lGxmesßgePª£¡
 && 
	`gøphicMode
( ) ;

4056 
	}
}

4059 
	$gmesßgePª£¡
()

4061 
lGmesßgePª£¡
 = -1 ;

4062 i‡–
lGmesßgePª£¡
 < 0 )

4064 
lGmesßgePª£¡
 = 
	`dëe˘Pª£n˚
("gmessage") ;

4066  
lGmesßgePª£¡
 && 
	`gøphicMode
( ) ;

4067 
	}
}

4070 
	$nŸify£ndPª£¡
()

4072 
lNŸify£ndPª£¡
 = -1 ;

4073 i‡–
lNŸify£ndPª£¡
 < 0 )

4075 
lNŸify£ndPª£¡
 = 
	`dëe˘Pª£n˚
("notify-send") ;

4077  
lNŸify£ndPª£¡
 && 
	`gøphicMode
( ) ;

4078 
	}
}

4081 
	$≥æPª£¡
()

4083 
lPîlPª£¡
 = -1 ;

4084 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4085 
FILE
 * 
lIn
 ;

4087 i‡–
lPîlPª£¡
 < 0 )

4089 
lPîlPª£¡
 = 
	`dëe˘Pª£n˚
("perl") ;

4090 i‡–
lPîlPª£¡
 )

4092 
lIn
 = 
	`p›í
( "perl -MNet::DBus -e \"Net::DBus->session->get_service('org.freedesktop.Notifications')\" 2>&1" , "r" ) ;

4093 i‡–
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) =
NULL
 )

4095 
lPîlPª£¡
 = 2 ;

4097 
	`p˛o£
–
lIn
 ) ;

4098 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("≥æ-dbu†%d\n", 
lPîlPª£¡
);

4101  
	`gøphicMode
(Ë? 
lPîlPª£¡
 : 0 ;

4102 
	}
}

4105 
	$aÂœyPª£¡
()

4107 
lAÂœyPª£¡
 = -1 ;

4108 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4109 
FILE
 * 
lIn
 ;

4111 i‡–
lAÂœyPª£¡
 < 0 )

4113 
lAÂœyPª£¡
 = 
	`dëe˘Pª£n˚
("afplay") ;

4114 i‡–
lAÂœyPª£¡
 )

4116 
lIn
 = 
	`p›í
( "test -e /System/Library/Sounds/Ping.aiff ||Écho Ping" , "r" ) ;

4117 i‡–
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) =
NULL
 )

4119 
lAÂœyPª£¡
 = 2 ;

4121 
	`p˛o£
–
lIn
 ) ;

4122 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("aÂœy %d\n", 
lAÂœyPª£¡
);

4125  
	`gøphicMode
(Ë? 
lAÂœyPª£¡
 : 0 ;

4126 
	}
}

4129 
	$xdülogPª£¡
()

4131 
lXdülogPª£¡
 = -1 ;

4132 i‡–
lXdülogPª£¡
 < 0 )

4134 
lXdülogPª£¡
 = 
	`dëe˘Pª£n˚
("Xdialog") ;

4136  
lXdülogPª£¡
 && 
	`gøphicMode
( ) ;

4137 
	}
}

4140 
	$gdülogPª£¡
()

4142 
lGdüloglPª£¡
 = -1 ;

4143 i‡–
lGdüloglPª£¡
 < 0 )

4145 
lGdüloglPª£¡
 = 
	`dëe˘Pª£n˚
( "gdialog" ) ;

4147  
lGdüloglPª£¡
 && 
	`gøphicMode
( ) ;

4148 
	}
}

4151 
	$oßs¸ùtPª£¡
()

4153 
lOßs¸ùtPª£¡
 = -1 ;

4154 i‡–
lOßs¸ùtPª£¡
 < 0 )

4156 
gW¨nögDi•œyed
 |!!
	`gëív
("SSH_TTY");

4157 
lOßs¸ùtPª£¡
 = 
	`dëe˘Pª£n˚
( "osascript" ) ;

4159  
lOßs¸ùtPª£¡
 && 
	`gøphicMode
(Ë&& !
	`gëív
("SSH_TTY") ;

4160 
	}
}

4163 
	$q¨maPª£¡
()

4165 
lQ¨maPª£¡
 = -1 ;

4166 i‡–
lQ¨maPª£¡
 < 0 )

4168 
lQ¨maPª£¡
 = 
	`dëe˘Pª£n˚
("qarma") ;

4170  
lQ¨maPª£¡
 && 
	`gøphicMode
( ) ;

4171 
	}
}

4174 
	$m©edülogPª£¡
()

4176 
lM©edülogPª£¡
 = -1 ;

4177 i‡–
lM©edülogPª£¡
 < 0 )

4179 
lM©edülogPª£¡
 = 
	`dëe˘Pª£n˚
("matedialog") ;

4181  
lM©edülogPª£¡
 && 
	`gøphicMode
( ) ;

4182 
	}
}

4185 
	$shñÀmíèryPª£¡
()

4187 
lShñÀmíèryPª£¡
 = -1 ;

4188 i‡–
lShñÀmíèryPª£¡
 < 0 )

4190 
lShñÀmíèryPª£¡
 = 0 ;

4192  
lShñÀmíèryPª£¡
 && 
	`gøphicMode
( ) ;

4193 
	}
}

4196 
	$zíôyPª£¡
()

4198 
lZíôyPª£¡
 = -1 ;

4199 i‡–
lZíôyPª£¡
 < 0 )

4201 
lZíôyPª£¡
 = 
	`dëe˘Pª£n˚
("zenity") ;

4203  
lZíôyPª£¡
 && 
	`gøphicMode
( ) ;

4204 
	}
}

4207 
	$zíôy3Pª£¡
()

4209 
lZíôy3Pª£¡
 = -1 ;

4210 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4211 
FILE
 * 
lIn
 ;

4212 
lI¡Tmp
 ;

4214 i‡–
lZíôy3Pª£¡
 < 0 )

4216 
lZíôy3Pª£¡
 = 0 ;

4217 i‡–
	`zíôyPª£¡
() )

4219 
lIn
 = 
	`p›í
( "zenity --version" , "r" ) ;

4220 i‡–
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

4222 i‡–
	`©oi
(
lBuff
) >= 3 )

4224 
lZíôy3Pª£¡
 = 3 ;

4225 
lI¡Tmp
 = 
	`©oi
(
	`°πok
(
lBuff
,".")+2 ) ;

4226 i‡–
lI¡Tmp
 >= 18 )

4228 
lZíôy3Pª£¡
 = 5 ;

4230 i‡–
lI¡Tmp
 >= 10 )

4232 
lZíôy3Pª£¡
 = 4 ;

4235 i‡––
	`©oi
(
lBuff
Ë=2 ) && (átoi(
	`°πok
(lBuff,".")+2 ) >= 32 ) )

4237 
lZíôy3Pª£¡
 = 2 ;

4239 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("zíôy %d\n", 
lZíôy3Pª£¡
);

4241 
	`p˛o£
–
lIn
 ) ;

4244  
	`gøphicMode
(Ë? 
lZíôy3Pª£¡
 : 0 ;

4245 
	}
}

4248 
	$kdülogPª£¡
()

4250 
lKdülogPª£¡
 = -1 ;

4251 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4252 
FILE
 * 
lIn
 ;

4253 * 
lDeskt›
;

4255 i‡–
lKdülogPª£¡
 < 0 )

4257 i‡–
	`zíôyPª£¡
() )

4259 
lDeskt›
 = 
	`gëív
("XDG_SESSION_DESKTOP");

4260 i‡–!
lDeskt›
 || ( 
	`°rcmp
(lDesktop, "KDE") && strcmp(lDesktop, "lxqt") ) )

4262 
lKdülogPª£¡
 = 0 ;

4263  
lKdülogPª£¡
 ;

4267 
lKdülogPª£¡
 = 
	`dëe˘Pª£n˚
("kdialog") ;

4268 i‡–
lKdülogPª£¡
 && !
	`gëív
("SSH_TTY") )

4270 
lIn
 = 
	`p›í
( "kdialog --attach 2>&1" , "r" ) ;

4271 i‡–
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

4273 i‡–! 
	`°r°r
–"Unknown" , 
lBuff
 ) )

4275 
lKdülogPª£¡
 = 2 ;

4276 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("kdülog-©èch %d\n", 
lKdülogPª£¡
);

4279 
	`p˛o£
–
lIn
 ) ;

4281 i‡(
lKdülogPª£¡
 == 2)

4283 
lKdülogPª£¡
 = 1 ;

4284 
lIn
 = 
	`p›í
( "kdialog --passivepopup 2>&1" , "r" ) ;

4285 i‡–
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

4287 i‡–! 
	`°r°r
–"Unknown" , 
lBuff
 ) )

4289 
lKdülogPª£¡
 = 2 ;

4290 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("kdülog-p›u∞%d\n", 
lKdülogPª£¡
);

4293 
	`p˛o£
–
lIn
 ) ;

4297  
	`gøphicMode
(Ë? 
lKdülogPª£¡
 : 0 ;

4298 
	}
}

4301 
	$osx9‹Bëãr
()

4303 
lOsx9‹Bëãr
 = -1 ;

4304 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4305 
FILE
 * 
lIn
 ;

4306 
V
,
v
;

4308 i‡–
lOsx9‹Bëãr
 < 0 )

4310 
lOsx9‹Bëãr
 = 0 ;

4311 
lIn
 = 
	`p›í
( "osascript -e 'set osverÅo system version of (system info)'" , "r" ) ;

4312 i‡––
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

4313 && ( 2 =
	`ssˇnf
(
lBuff
, "%d.%d", &
V
, &
v
) ) )

4315 
V
 = V * 100 + 
v
;

4316 i‡–
V
 >= 1009 )

4318 
lOsx9‹Bëãr
 = 1 ;

4321 
	`p˛o£
–
lIn
 ) ;

4322 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("Osx10 = %d, %d = %s\n", 
lOsx9‹Bëãr
, 
V
, 
lBuff
) ;

4324  
lOsx9‹Bëãr
 ;

4325 
	}
}

4328 
	$pyth⁄3Pª£¡
()

4330 
lPyth⁄3Pª£¡
 = -1 ;

4331 
i
;

4333 i‡–
lPyth⁄3Pª£¡
 < 0 )

4335 
lPyth⁄3Pª£¡
 = 0 ;

4336 
	`°r˝y
(
gPyth⁄3Name
 , "python3" ) ;

4337 i‡–
	`dëe˘Pª£n˚
(
gPyth⁄3Name
ËË
lPyth⁄3Pª£¡
 = 1;

4340  
i
 = 9 ; i >= 0 ; i -- )

4342 
	`•rötf
–
gPyth⁄3Name
 , "pyth⁄3.%d" , 
i
 ) ;

4343 i‡–
	`dëe˘Pª£n˚
(
gPyth⁄3Name
) )

4345 
lPyth⁄3Pª£¡
 = 1;

4350 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("lPyth⁄3Pª£¡ %d\n", 
lPyth⁄3Pª£¡
) ;

4351 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("gPyth⁄3Namê%s\n", 
gPyth⁄3Name
) ;

4353  
lPyth⁄3Pª£¡
 ;

4354 
	}
}

4357 
	$pyth⁄2Pª£¡
()

4359 
lPyth⁄2Pª£¡
 = -1 ;

4360 
i
;

4362 i‡–
lPyth⁄2Pª£¡
 < 0 )

4364 
lPyth⁄2Pª£¡
 = 0 ;

4365 
	`°r˝y
(
gPyth⁄2Name
 , "python2" ) ;

4366 i‡–
	`dëe˘Pª£n˚
(
gPyth⁄2Name
ËË
lPyth⁄2Pª£¡
 = 1;

4369  
i
 = 9 ; i >= 0 ; i -- )

4371 
	`•rötf
–
gPyth⁄2Name
 , "pyth⁄2.%d" , 
i
 ) ;

4372 i‡–
	`dëe˘Pª£n˚
(
gPyth⁄2Name
) )

4374 
lPyth⁄2Pª£¡
 = 1;

4379 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("lPyth⁄2Pª£¡ %d\n", 
lPyth⁄2Pª£¡
) ;

4380 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("gPyth⁄2Namê%s\n", 
gPyth⁄2Name
) ;

4382  
lPyth⁄2Pª£¡
 ;

4383 
	}
}

4386 
	$tköãr3Pª£¡
()

4388 
lTköãr3Pª£¡
 = -1 ;

4389 
lPyth⁄Comm™d
[256];

4390 
lPyth⁄P¨ams
[128] =

4393 i‡–
lTköãr3Pª£¡
 < 0 )

4395 
lTköãr3Pª£¡
 = 0 ;

4396 i‡–
	`pyth⁄3Pª£¡
() )

4398 
	`•rötf
–
lPyth⁄Comm™d
 , "%†%s" , 
gPyth⁄3Name
 , 
lPyth⁄P¨ams
 ) ;

4399 
lTköãr3Pª£¡
 = 
	`åyComm™d
(
lPyth⁄Comm™d
) ;

4401 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("lTköãr3Pª£¡ %d\n", 
lTköãr3Pª£¡
) ;

4403  
lTköãr3Pª£¡
 && 
	`gøphicMode
(Ë&& !(
	`isD¨wö
(Ë&& 
	`gëív
("SSH_TTY") );

4404 
	}
}

4407 
	$tköãr2Pª£¡
()

4409 
lTköãr2Pª£¡
 = -1 ;

4410 
lPyth⁄Comm™d
[256];

4411 
lPyth⁄P¨ams
[128] =

4414 i‡–
lTköãr2Pª£¡
 < 0 )

4416 
lTköãr2Pª£¡
 = 0 ;

4417 i‡–
	`pyth⁄2Pª£¡
() )

4419 
	`•rötf
–
lPyth⁄Comm™d
 , "%†%s" , 
gPyth⁄2Name
 , 
lPyth⁄P¨ams
 ) ;

4420 
lTköãr2Pª£¡
 = 
	`åyComm™d
(
lPyth⁄Comm™d
) ;

4422 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("lTköãr2Pª£¡ %d\n", 
lTköãr2Pª£¡
) ;

4424  
lTköãr2Pª£¡
 && 
	`gøphicMode
(Ë&& !(
	`isD¨wö
(Ë&& 
	`gëív
("SSH_TTY") );

4425 
	}
}

4428 
	$pyth⁄DbusPª£¡
()

4430 
lDbusPª£¡
 = -1 ;

4431 
lPyth⁄Comm™d
[384];

4432 
lPyth⁄P¨ams
[256] =

4437 i‡–
lDbusPª£¡
 < 0 )

4439 
lDbusPª£¡
 = 0 ;

4440 i‡–
	`pyth⁄2Pª£¡
() )

4442 
	`°r˝y
(
gPyth⁄Name
 , 
gPyth⁄2Name
 ) ;

4443 
	`•rötf
–
lPyth⁄Comm™d
 , "%†%s" , 
gPyth⁄Name
 , 
lPyth⁄P¨ams
 ) ;

4444 
lDbusPª£¡
 = 
	`åyComm™d
(
lPyth⁄Comm™d
) ;

4447 i‡–! 
lDbusPª£¡
 && 
	`pyth⁄3Pª£¡
() )

4449 
	`°r˝y
(
gPyth⁄Name
 , 
gPyth⁄3Name
 ) ;

4450 
	`•rötf
–
lPyth⁄Comm™d
 , "%†%s" , 
gPyth⁄Name
 , 
lPyth⁄P¨ams
 ) ;

4451 
lDbusPª£¡
 = 
	`åyComm™d
(
lPyth⁄Comm™d
) ;

4454 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("lDbusPª£¡ %d\n", 
lDbusPª£¡
) ;

4455 i‡(
töyfd_vîbo£
Ë
	`¥ötf
("gPyth⁄Namê%s\n", 
gPyth⁄Name
) ;

4457  
lDbusPª£¡
 && 
	`gøphicMode
(Ë&& !(
	`isD¨wö
(Ë&& 
	`gëív
("SSH_TTY") );

4458 
	}
}

4461 
	$sigH™dÀr
(
sig
)

4463 
FILE
 * 
lIn
 ;

4464 i‡––
lIn
 = 
	`p›í
( "pactl unload-module module-sine" , "r" ) ) )

4466 
	`p˛o£
–
lIn
 ) ;

4468 
	}
}

4470 
	$töyfd_bìp
()

4472 
lDülogSåög
 [256] ;

4473 
FILE
 * 
lIn
 ;

4475 i‡–
	`oßs¸ùtPª£¡
() )

4477 i‡–
	`aÂœyPª£¡
() >= 2 )

4479 
	`°r˝y
–
lDülogSåög
 , "afplay /System/Library/Sounds/Ping.aiff") ;

4483 
	`°r˝y
–
lDülogSåög
 , "osascript -e 'tellápplication \"System Events\"Åo beep'") ;

4486 i‡–
	`∑˘lPª£¡
() )

4488 
	`sig«l
(
SIGINT
, 
sigH™dÀr
);

4490 
	`°r˝y
–
lDülogSåög
 , "thnum=$(pactlÜoad-module module-sine frequency=440);sleep .3;pactl unload-module $thnum" ) ;

4492 i‡–
	`•ókîã°Pª£¡
() )

4495 
	`°r˝y
–
lDülogSåög
 , "( speaker-test -t sine -f 440 > /dev/tty )&Öid=$!;sleep .3; kill -9 $pid" ) ;

4497 i‡–
	`bì≥xePª£¡
() )

4499 
	`°r˝y
–
lDülogSåög
 , "beep.exe 440 300" ) ;

4503 
	`°r˝y
–
lDülogSåög
 , "printf '\a' > /dev/tty" ) ;

4506 i‡(
töyfd_vîbo£
Ë
	`¥ötf
–"lDülogSåög: %s\n" , 
lDülogSåög
 ) ;

4508 i‡––
lIn
 = 
	`p›í
–
lDülogSåög
 , "r" ) ) )

4510 
	`p˛o£
–
lIn
 ) ;

4513 i‡–
	`∑˘lPª£¡
() )

4515 
	`sig«l
(
SIGINT
, 
SIG_DFL
);

4517 
	}
}

4520 
	$töyfd_mesßgeBox
(

4521 c⁄° * 
aTôÀ
 ,

4522 c⁄° * 
aMesßge
 ,

4523 c⁄° * 
aDülogTy≥
 ,

4524 c⁄° * 
aIc⁄Ty≥
 ,

4525 
aDeÁu…Buâ⁄
 )

4527 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4528 * 
lDülogSåög
 = 
NULL
 ;

4529 * 
ÕDülogSåög
;

4530 
FILE
 * 
lIn
 ;

4531 
lWasGøphicDülog
 = 0 ;

4532 
lWasXãrm
 = 0 ;

4533 
lResu…
 ;

4534 
lCh¨
 ;

4535 
ãrmios
 
öfoOri
;

4536 
ãrmios
 
öfo
;

4537 
size_t
 
lTôÀLí
 ;

4538 
size_t
 
lMesßgeLí
 ;

4540 
lBuff
[0]='\0';

4542 
lTôÀLí
 = 
aTôÀ
 ? 
	`°æí
(aTitle) : 0 ;

4543 
lMesßgeLí
 = 
aMesßge
 ? 
	`°æí
(aMessage) : 0 ;

4544 i‡–!
aTôÀ
 || 
	`°rcmp
(aTitle,"tinyfd_query") )

4546 
lDülogSåög
 = (*Ë
	`mÆloc
–
MAX_PATH_OR_CMD
 + 
lTôÀLí
 + 
lMesßgeLí
 );

4549 i‡–
	`oßs¸ùtPª£¡
( ) )

4551 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"applescript"); 1;}

4553 
	`°r˝y
–
lDülogSåög
 , "osascript ");

4554 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
 , " -e 'tellápplication \"System Events\"' -e 'Activate'");

4555 
	`°rˇt
–
lDülogSåög
 , " -e 'try' -e 'set {vButton}Åo {buttonÑeturned} of ( display dialog \"") ;

4556 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

4558 
	`°rˇt
(
lDülogSåög
, 
aMesßge
) ;

4560 
	`°rˇt
(
lDülogSåög
, "\" ") ;

4561 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

4563 
	`°rˇt
(
lDülogSåög
, "withÅitle \"") ;

4564 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

4565 
	`°rˇt
(
lDülogSåög
, "\" ") ;

4567 
	`°rˇt
(
lDülogSåög
, "with icon ") ;

4568 i‡–
aIc⁄Ty≥
 && ! 
	`°rcmp
( "error" ,áIconType ) )

4570 
	`°rˇt
(
lDülogSåög
, "stop " ) ;

4572 i‡–
aIc⁄Ty≥
 && ! 
	`°rcmp
( "warning" ,áIconType ) )

4574 
	`°rˇt
(
lDülogSåög
, "caution " ) ;

4578 
	`°rˇt
(
lDülogSåög
, "note " ) ;

4580 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "okcancel" ,áDialogType ) )

4582 i‡–! 
aDeÁu…Buâ⁄
 )

4584 
	`°rˇt
–
lDülogSåög
 ,"default button \"Cancel\" " ) ;

4587 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesno" ,áDialogType ) )

4589 
	`°rˇt
–
lDülogSåög
 ,"buttons {\"No\", \"Yes\"} " ) ;

4590 i‡(
aDeÁu…Buâ⁄
)

4592 
	`°rˇt
–
lDülogSåög
 ,"default button \"Yes\" " ) ;

4596 
	`°rˇt
–
lDülogSåög
 ,"default button \"No\" " ) ;

4598 
	`°rˇt
–
lDülogSåög
 ,"cancel button \"No\"" ) ;

4600 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesnocancel" ,áDialogType ) )

4602 
	`°rˇt
–
lDülogSåög
 ,"buttons {\"No\", \"Yes\", \"Cancel\"} " ) ;

4603 
aDeÁu…Buâ⁄
)

4605 1: 
	`°rˇt
–
lDülogSåög
 ,"default button \"Yes\" " ) ; ;

4606 2: 
	`°rˇt
–
lDülogSåög
 ,"default button \"No\" " ) ; ;

4607 0: 
	`°rˇt
–
lDülogSåög
 ,"default button \"Cancel\" " ) ; ;

4609 
	`°rˇt
–
lDülogSåög
 ,"cancel button \"Cancel\"" ) ;

4613 
	`°rˇt
–
lDülogSåög
 ,"buttons {\"OK\"} " ) ;

4614 
	`°rˇt
–
lDülogSåög
 ,"default button \"OK\" " ) ;

4616 
	`°rˇt
–
lDülogSåög
, ")' ") ;

4618 
	`°rˇt
–
lDülogSåög
,

4624 
	`°rˇt
–
lDülogSåög
, "-e 'onÉrrorÇumber -128' " ) ;

4625 
	`°rˇt
–
lDülogSåög
, "-e '0' " );

4627 
	`°rˇt
–
lDülogSåög
, "-e 'endÅry'") ;

4628 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
, " -e 'endÅell'") ;

4630 i‡–
	`kdülogPª£¡
() )

4632 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"kdialog"); 1;}

4634 
	`°r˝y
–
lDülogSåög
 , "kdialog" ) ;

4635 i‡–
	`kdülogPª£¡
() == 2 )

4637 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

4640 
	`°rˇt
–
lDülogSåög
 , " --" ) ;

4641 i‡–
aDülogTy≥
 && ( ! 
	`°rcmp
( "okcancel" ,áDialogType )

4642 || ! 
	`°rcmp
–"ye¢o" , 
aDülogTy≥
 ) || ! strcmp( "yesnocancel" ,áDialogType ) ) )

4644 i‡–
aIc⁄Ty≥
 && ( ! 
	`°rcmp
( "warning" ,áIconType )

4645 || ! 
	`°rcmp
–"îr‹" , 
aIc⁄Ty≥
 ) ) )

4647 
	`°rˇt
–
lDülogSåög
 , "warning" ) ;

4649 i‡–! 
	`°rcmp
–"ye¢oˇn˚l" , 
aDülogTy≥
 ) )

4651 
	`°rˇt
–
lDülogSåög
 , "yesnocancel" ) ;

4655 
	`°rˇt
–
lDülogSåög
 , "yesno" ) ;

4658 i‡–
aIc⁄Ty≥
 && ! 
	`°rcmp
( "error" ,áIconType ) )

4660 
	`°rˇt
–
lDülogSåög
 , "error" ) ;

4662 i‡–
aIc⁄Ty≥
 && ! 
	`°rcmp
( "warning" ,áIconType ) )

4664 
	`°rˇt
–
lDülogSåög
 , "sorry" ) ;

4668 
	`°rˇt
–
lDülogSåög
 , "msgbox" ) ;

4670 
	`°rˇt
–
lDülogSåög
 , " \"" ) ;

4671 i‡–
aMesßge
 )

4673 
	`°rˇt
–
lDülogSåög
 , 
aMesßge
 ) ;

4675 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

4676 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "okcancel" ,áDialogType ) )

4678 
	`°rˇt
–
lDülogSåög
 ,

4681 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

4683 
	`°rˇt
(
lDülogSåög
, " --title \"") ;

4684 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

4685 
	`°rˇt
(
lDülogSåög
, "\"") ;

4688 i‡–! 
	`°rcmp
–"ye¢oˇn˚l" , 
aDülogTy≥
 ) )

4690 
	`°rˇt
–
lDülogSåög
 , "; x=$? ;if [ $x = 0 ] ;thenÉcho 1;elif [ $x = 1 ] ;thenÉcho 2;elseÉcho 0;fi");

4694 
	`°rˇt
–
lDülogSåög
 , ";if [ $? = 0 ];thenÉcho 1;elseÉcho 0;fi");

4697 i‡–
	`zíôyPª£¡
(Ë|| 
	`m©edülogPª£¡
(Ë|| 
	`shñÀmíèryPª£¡
(Ë|| 
	`q¨maPª£¡
() )

4699 i‡–
	`zíôyPª£¡
() )

4701 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"zenity"); 1;}

4702 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(zenity" ) ;

4703 i‡–(
	`zíôy3Pª£¡
(Ë>4Ë&& !
	`gëív
("SSH_TTY") )

4705 
	`°rˇt
(
lDülogSåög
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

4708 i‡–
	`m©edülogPª£¡
() )

4710 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"matedialog"); 1;}

4711 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(matedialog" ) ;

4713 i‡–
	`shñÀmíèryPª£¡
() )

4715 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"shellementary"); 1;}

4716 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(shellementary" ) ;

4720 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"qarma"); 1;}

4721 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(qarma" ) ;

4722 i‡–!
	`gëív
("SSH_TTY") )

4724 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

4727 
	`°rˇt
(
lDülogSåög
, " --");

4729 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "okcancel" ,áDialogType ) )

4731 
	`°rˇt
–
lDülogSåög
 ,

4734 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesno" ,áDialogType ) )

4736 
	`°rˇt
–
lDülogSåög
 , "question" ) ;

4738 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesnocancel" ,áDialogType ) )

4740 
	`°rˇt
–
lDülogSåög
 , "list --column \"\" --hide-header \"Yes\" \"No\"" ) ;

4742 i‡–
aIc⁄Ty≥
 && ! 
	`°rcmp
( "error" ,áIconType ) )

4744 
	`°rˇt
–
lDülogSåög
 , "error" ) ;

4746 i‡–
aIc⁄Ty≥
 && ! 
	`°rcmp
( "warning" ,áIconType ) )

4748 
	`°rˇt
–
lDülogSåög
 , "warning" ) ;

4752 
	`°rˇt
–
lDülogSåög
 , "info" ) ;

4754 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

4756 
	`°rˇt
(
lDülogSåög
, " --title=\"") ;

4757 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

4758 
	`°rˇt
(
lDülogSåög
, "\"") ;

4760 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

4762 
	`°rˇt
(
lDülogSåög
, " --no-wrap --text=\"") ;

4763 
	`°rˇt
(
lDülogSåög
, 
aMesßge
) ;

4764 
	`°rˇt
(
lDülogSåög
, "\"") ;

4766 i‡–(
	`zíôy3Pª£¡
(Ë>3Ë|| (!
	`zíôyPª£¡
(Ë&& (
	`shñÀmíèryPª£¡
(Ë|| 
	`q¨maPª£¡
()) ) )

4768 
	`°rˇt
–
lDülogSåög
 , " --icon-name=dialog-" ) ;

4769 i‡–
aIc⁄Ty≥
 && (! 
	`°rcmp
( "question" ,áIconType )

4770 || ! 
	`°rcmp
–"îr‹" , 
aIc⁄Ty≥
 )

4771 || ! 
	`°rcmp
–"w¨nög" , 
aIc⁄Ty≥
 ) ) )

4773 
	`°rˇt
–
lDülogSåög
 , 
aIc⁄Ty≥
 ) ;

4777 
	`°rˇt
–
lDülogSåög
 , "information" ) ;

4781 i‡(
töyfd_sûít
Ë
	`°rˇt
–
lDülogSåög
 , " 2>/dev/null ");

4783 i‡–! 
	`°rcmp
–"ye¢oˇn˚l" , 
aDülogTy≥
 ) )

4785 
	`°rˇt
–
lDülogSåög
 ,

4790 
	`°rˇt
–
lDülogSåög
 , ");if [ $? = 0 ];thenÉcho 1;elseÉcho 0;fi");

4793 i‡–!
	`gxmesßgePª£¡
(Ë&& !
	`gmesßgePª£¡
(Ë&& !
	`gdülogPª£¡
(Ë&& !
	`xdülogPª£¡
(Ë&& 
	`tköãr3Pª£¡
() )

4795 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python3-tkinter"); 1;}

4797 
	`°r˝y
–
lDülogSåög
 , 
gPyth⁄3Name
 ) ;

4798 
	`°rˇt
–
lDülogSåög
 ,

4801 
	`°rˇt
–
lDülogSåög
 ,"res=messagebox." ) ;

4802 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "okcancel" ,áDialogType ) )

4804 
	`°rˇt
–
lDülogSåög
 , "askokcancel(" ) ;

4805 i‡–
aDeÁu…Buâ⁄
 )

4807 
	`°rˇt
–
lDülogSåög
 , "default=messagebox.OK," ) ;

4811 
	`°rˇt
–
lDülogSåög
 , "default=messagebox.CANCEL," ) ;

4814 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesno" ,áDialogType ) )

4816 
	`°rˇt
–
lDülogSåög
 , "askyesno(" ) ;

4817 i‡–
aDeÁu…Buâ⁄
 )

4819 
	`°rˇt
–
lDülogSåög
 , "default=messagebox.YES," ) ;

4823 
	`°rˇt
–
lDülogSåög
 , "default=messagebox.NO," ) ;

4826 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesnocancel" ,áDialogType ) )

4828 
	`°rˇt
–
lDülogSåög
 , "askyesnocancel(" ) ;

4829  
aDeÁu…Buâ⁄
 )

4831 1: 
	`°rˇt
–
lDülogSåög
 , "default=messagebox.YES," ); ;

4832 2: 
	`°rˇt
–
lDülogSåög
 , "default=messagebox.NO," ); ;

4833 0: 
	`°rˇt
–
lDülogSåög
 , "default=messagebox.CANCEL," ); ;

4838 
	`°rˇt
–
lDülogSåög
 , "showinfo(" ) ;

4841 
	`°rˇt
–
lDülogSåög
 , "icon='" ) ;

4842 i‡–
aIc⁄Ty≥
 && (! 
	`°rcmp
( "question" ,áIconType )

4843 || ! 
	`°rcmp
–"îr‹" , 
aIc⁄Ty≥
 )

4844 || ! 
	`°rcmp
–"w¨nög" , 
aIc⁄Ty≥
 ) ) )

4846 
	`°rˇt
–
lDülogSåög
 , 
aIc⁄Ty≥
 ) ;

4850 
	`°rˇt
–
lDülogSåög
 , "info" ) ;

4853 
	`°rˇt
(
lDülogSåög
, "',") ;

4854 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

4856 
	`°rˇt
(
lDülogSåög
, "title='") ;

4857 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

4858 
	`°rˇt
(
lDülogSåög
, "',") ;

4860 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

4862 
	`°rˇt
(
lDülogSåög
, "message='") ;

4863 
ÕDülogSåög
 = 
lDülogSåög
 + 
	`°æí
(lDialogString);

4864 
	`ª∂a˚SubSå
–
aMesßge
 , "\n" , "\\n" , 
ÕDülogSåög
 ) ;

4865 
	`°rˇt
(
lDülogSåög
, "'") ;

4868 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesnocancel" ,áDialogType ) )

4870 
	`°rˇt
(
lDülogSåög
, ");\n\
Ñes is None :\n\tprint(0)\n\
Ñes is False :\n\tprint(2)\n\
 :\n\tprint 1\n\"" ) ;

4877 
	`°rˇt
(
lDülogSåög
, ");\n\
Ñes is False :\n\tprint(0)\n\
 :\n\tprint(1)\n\"" ) ;

4882 i‡–!
	`gxmesßgePª£¡
(Ë&& !
	`gmesßgePª£¡
(Ë&& !
	`gdülogPª£¡
(Ë&& !
	`xdülogPª£¡
(Ë&& 
	`tköãr2Pª£¡
() )

4884 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python2-tkinter"); 1;}

4885 
	`°r˝y
–
lDülogSåög
 , "export PYTHONIOENCODING=utf-8;" ) ;

4886 
	`°rˇt
–
lDülogSåög
 , 
gPyth⁄2Name
 ) ;

4887 i‡–! 
	`isTîmöÆRu¬ög
–Ë&& 
	`isD¨wö
( ) )

4889 
	`°rˇt
–
lDülogSåög
 , " -i" ) ;

4892 
	`°rˇt
–
lDülogSåög
 ,

4895 i‡–
	`isD¨wö
( ) )

4897 
	`°rˇt
–
lDülogSåög
 ,

4902 
	`°rˇt
–
lDülogSåög
 ,"res=tkMessageBox." ) ;

4903 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "okcancel" ,áDialogType ) )

4905 
	`°rˇt
–
lDülogSåög
 , "askokcancel(" ) ;

4906 i‡–
aDeÁu…Buâ⁄
 )

4908 
	`°rˇt
–
lDülogSåög
 , "default=tkMessageBox.OK," ) ;

4912 
	`°rˇt
–
lDülogSåög
 , "default=tkMessageBox.CANCEL," ) ;

4915 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesno" ,áDialogType ) )

4917 
	`°rˇt
–
lDülogSåög
 , "askyesno(" ) ;

4918 i‡–
aDeÁu…Buâ⁄
 )

4920 
	`°rˇt
–
lDülogSåög
 , "default=tkMessageBox.YES," ) ;

4924 
	`°rˇt
–
lDülogSåög
 , "default=tkMessageBox.NO," ) ;

4927 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesnocancel" ,áDialogType ) )

4929 
	`°rˇt
–
lDülogSåög
 , "askyesnocancel(" ) ;

4930  
aDeÁu…Buâ⁄
 )

4932 1: 
	`°rˇt
–
lDülogSåög
 , "default=tkMessageBox.YES," ); ;

4933 2: 
	`°rˇt
–
lDülogSåög
 , "default=tkMessageBox.NO," ); ;

4934 0: 
	`°rˇt
–
lDülogSåög
 , "default=tkMessageBox.CANCEL," ); ;

4939 
	`°rˇt
–
lDülogSåög
 , "showinfo(" ) ;

4942 
	`°rˇt
–
lDülogSåög
 , "icon='" ) ;

4943 i‡–
aIc⁄Ty≥
 && (! 
	`°rcmp
( "question" ,áIconType )

4944 || ! 
	`°rcmp
–"îr‹" , 
aIc⁄Ty≥
 )

4945 || ! 
	`°rcmp
–"w¨nög" , 
aIc⁄Ty≥
 ) ) )

4947 
	`°rˇt
–
lDülogSåög
 , 
aIc⁄Ty≥
 ) ;

4951 
	`°rˇt
–
lDülogSåög
 , "info" ) ;

4954 
	`°rˇt
(
lDülogSåög
, "',") ;

4955 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

4957 
	`°rˇt
(
lDülogSåög
, "title='") ;

4958 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

4959 
	`°rˇt
(
lDülogSåög
, "',") ;

4961 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

4963 
	`°rˇt
(
lDülogSåög
, "message='") ;

4964 
ÕDülogSåög
 = 
lDülogSåög
 + 
	`°æí
(lDialogString);

4965 
	`ª∂a˚SubSå
–
aMesßge
 , "\n" , "\\n" , 
ÕDülogSåög
 ) ;

4966 
	`°rˇt
(
lDülogSåög
, "'") ;

4969 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesnocancel" ,áDialogType ) )

4971 
	`°rˇt
(
lDülogSåög
, ");\n\
Ñes is None :\n\tprint 0\n\
Ñes is False :\n\tprint 2\n\
 :\n\tprint 1\n\"" ) ;

4978 
	`°rˇt
(
lDülogSåög
, ");\n\
Ñes is False :\n\tprint 0\n\
 :\n\tprint 1\n\"" ) ;

4983 i‡–
	`gxmesßgePª£¡
(Ë|| 
	`gmesßgePª£¡
(Ë|| (!
	`gdülogPª£¡
(Ë&& !
	`xdülogPª£¡
(Ë&& 
	`xmesßgePª£¡
()) )

4985 i‡–
	`gxmesßgePª£¡
() )

4987 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"gxmessage"); 1;}

4988 
	`°r˝y
–
lDülogSåög
 , "gxmessage");

4990 i‡–
	`gmesßgePª£¡
() )

4992 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"gmessage"); 1;}

4993 
	`°r˝y
–
lDülogSåög
 , "gmessage");

4997 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"xmessage"); 1;}

4998 
	`°r˝y
–
lDülogSåög
 , "xmessage");

5001 i‡–
aDülogTy≥
 && ! 
	`°rcmp
("okcancel" ,áDialogType) )

5003 
	`°rˇt
–
lDülogSåög
 , " -buttons Ok:1,Cancel:0");

5004  
aDeÁu…Buâ⁄
 )

5006 1: 
	`°rˇt
–
lDülogSåög
 , " -default Ok"); ;

5007 0: 
	`°rˇt
–
lDülogSåög
 , " -default Cancel"); ;

5010 i‡–
aDülogTy≥
 && ! 
	`°rcmp
("yesno" ,áDialogType) )

5012 
	`°rˇt
–
lDülogSåög
 , " -buttons Yes:1,No:0");

5013  
aDeÁu…Buâ⁄
 )

5015 1: 
	`°rˇt
–
lDülogSåög
 , " -default Yes"); ;

5016 0: 
	`°rˇt
–
lDülogSåög
 , " -default No"); ;

5019 i‡–
aDülogTy≥
 && ! 
	`°rcmp
("yesnocancel" ,áDialogType) )

5021 
	`°rˇt
–
lDülogSåög
 , " -buttons Yes:1,No:2,Cancel:0");

5022  
aDeÁu…Buâ⁄
 )

5024 1: 
	`°rˇt
–
lDülogSåög
 , " -default Yes"); ;

5025 2: 
	`°rˇt
–
lDülogSåög
 , " -default No"); ;

5026 0: 
	`°rˇt
–
lDülogSåög
 , " -default Cancel"); ;

5031 
	`°rˇt
–
lDülogSåög
 , " -buttons Ok:1");

5032 
	`°rˇt
–
lDülogSåög
 , " -default Ok");

5035 
	`°rˇt
–
lDülogSåög
 , " -center \"");

5036 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5038 
	`°rˇt
–
lDülogSåög
 , 
aMesßge
 ) ;

5040 
	`°rˇt
(
lDülogSåög
, "\"" ) ;

5041 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5043 
	`°rˇt
–
lDülogSåög
 , " -title \"");

5044 
	`°rˇt
–
lDülogSåög
 , 
aTôÀ
 ) ;

5045 
	`°rˇt
–
lDülogSåög
, "\"" ) ;

5047 
	`°rˇt
–
lDülogSåög
 , " ;Écho $? ");

5049 i‡–
	`xdülogPª£¡
(Ë|| 
	`gdülogPª£¡
(Ë|| 
	`dülogName
(Ë|| 
	`whùèûPª£¡
() )

5051 i‡–
	`gdülogPª£¡
( ) )

5053 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"gdialog"); 1;}

5054 
lWasGøphicDülog
 = 1 ;

5055 
	`°r˝y
–
lDülogSåög
 , "(gdialog " ) ;

5057 i‡–
	`xdülogPª£¡
( ) )

5059 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"xdialog"); 1;}

5060 
lWasGøphicDülog
 = 1 ;

5061 
	`°r˝y
–
lDülogSåög
 , "(Xdialog " ) ;

5063 i‡–
	`dülogName
( ) )

5065 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"dialog"); 0;}

5066 i‡–
	`isTîmöÆRu¬ög
( ) )

5068 
	`°r˝y
–
lDülogSåög
 , "(dialog " ) ;

5072 
lWasXãrm
 = 1 ;

5073 
	`°r˝y
–
lDülogSåög
 , 
	`ãrmöÆName
() ) ;

5074 
	`°rˇt
–
lDülogSåög
 , "'(" ) ;

5075 
	`°rˇt
–
lDülogSåög
 , 
	`dülogName
() ) ;

5076 
	`°rˇt
–
lDülogSåög
 , " " ) ;

5079 i‡–
	`isTîmöÆRu¬ög
( ) )

5081 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"whiptail"); 0;}

5082 
	`°r˝y
–
lDülogSåög
 , "(whiptail " ) ;

5086 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"whiptail"); 0;}

5087 
lWasXãrm
 = 1 ;

5088 
	`°r˝y
–
lDülogSåög
 , 
	`ãrmöÆName
() ) ;

5089 
	`°rˇt
–
lDülogSåög
 , "'(whiptail " ) ;

5092 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5094 
	`°rˇt
(
lDülogSåög
, "--title \"") ;

5095 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5096 
	`°rˇt
(
lDülogSåög
, "\" ") ;

5099 i‡–!
	`xdülogPª£¡
(Ë&& !
	`gdülogPª£¡
() )

5101 i‡–
aDülogTy≥
 && ( !
	`°rcmp
( "okcancel" ,áDialogType ) || !strcmp( "yesno" ,áDialogType )

5102 || !
	`°rcmp
–"ye¢oˇn˚l" , 
aDülogTy≥
 ) ) )

5104 
	`°rˇt
(
lDülogSåög
, "--backtitle \"") ;

5105 
	`°rˇt
(
lDülogSåög
, "tab: move focus") ;

5106 
	`°rˇt
(
lDülogSåög
, "\" ") ;

5110 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "okcancel" ,áDialogType ) )

5112 i‡–! 
aDeÁu…Buâ⁄
 )

5114 
	`°rˇt
–
lDülogSåög
 , "--defaultno " ) ;

5116 
	`°rˇt
–
lDülogSåög
 ,

5119 i‡–
aDülogTy≥
 && ! 
	`°rcmp
( "yesno" ,áDialogType ) )

5121 i‡–! 
aDeÁu…Buâ⁄
 )

5123 
	`°rˇt
–
lDülogSåög
 , "--defaultno " ) ;

5125 
	`°rˇt
–
lDülogSåög
 , "--yesno " ) ;

5127 i‡(
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",áDialogType))

5129 i‡(!
aDeÁu…Buâ⁄
)

5131 
	`°rˇt
(
lDülogSåög
, "--defaultno ");

5133 
	`°rˇt
(
lDülogSåög
, "--menu ");

5137 
	`°rˇt
–
lDülogSåög
 , "--msgbox " ) ;

5140 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

5141 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5143 
	`°rˇt
(
lDülogSåög
, 
aMesßge
) ;

5145 
	`°rˇt
(
lDülogSåög
, "\" ");

5147 i‡–
lWasGøphicDülog
 )

5149 i‡(
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",áDialogType))

5151 
	`°rˇt
(
lDülogSåög
,"0 60 0 Yes \"\" No \"\") 2>/tmp/tinyfd.txt;\
 [ $? = 0 ];thenÅinyfdBool=1;elseÅinyfdBool=0;fi;\
=$(cat /tmp/tinyfd.txt);echo $tinyfdBool$tinyfdRes") ;

5157 
	`°rˇt
(
lDülogSåög
,

5163 i‡(
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",áDialogType))

5165 
	`°rˇt
(
lDülogSåög
,"0 60 0 Yes \"\" No \"\" >/dev/tty ) 2>/tmp/tinyfd.txt;\
 [ $? = 0 ];thenÅinyfdBool=1;elseÅinyfdBool=0;fi;\
=$(cat /tmp/tinyfd.txt);echo $tinyfdBool$tinyfdRes") ;

5169 i‡–
lWasXãrm
 )

5171 
	`°rˇt
(
lDülogSåög
," >/tmp/tinyfd0.txt';cat /tmp/tinyfd0.txt");

5175 
	`°rˇt
(
lDülogSåög
, "; clear >/dev/tty") ;

5180 
	`°rˇt
(
lDülogSåög
, "10 60 >/dev/tty) 2>&1;if [ $? = 0 ];");

5181 i‡–
lWasXãrm
 )

5183 
	`°rˇt
–
lDülogSåög
 ,

5188 
	`°rˇt
(
lDülogSåög
,

5194 i‡–!
	`isTîmöÆRu¬ög
(Ë&& 
	`ãrmöÆName
() )

5196 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"basicinput"); 0;}

5197 
	`°r˝y
–
lDülogSåög
 , 
	`ãrmöÆName
() ) ;

5198 
	`°rˇt
–
lDülogSåög
 , "'" ) ;

5199 i‡–!
gW¨nögDi•œyed
 && !
töyfd_f‹˚C⁄sﬁe
)

5201 
gW¨nögDi•œyed
 = 1 ;

5202 
	`°rˇt
–
lDülogSåög
 , "echo \"" ) ;

5203 
	`°rˇt
–
lDülogSåög
, 
gTôÀ
) ;

5204 
	`°rˇt
–
lDülogSåög
 , "\";" ) ;

5205 
	`°rˇt
–
lDülogSåög
 , "echo \"" ) ;

5206 
	`°rˇt
–
lDülogSåög
, 
töyfd_√eds
) ;

5207 
	`°rˇt
–
lDülogSåög
 , "\";echo;echo;" ) ;

5209 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5211 
	`°rˇt
–
lDülogSåög
 , "echo \"" ) ;

5212 
	`°rˇt
–
lDülogSåög
, 
aTôÀ
) ;

5213 
	`°rˇt
–
lDülogSåög
 , "\";echo;" ) ;

5215 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5217 
	`°rˇt
–
lDülogSåög
 , "echo \"" ) ;

5218 
	`°rˇt
–
lDülogSåög
, 
aMesßge
) ;

5219 
	`°rˇt
–
lDülogSåög
 , "\"; " ) ;

5221 i‡–
aDülogTy≥
 && !
	`°rcmp
("yesno",aDialogType) )

5223 
	`°rˇt
–
lDülogSåög
 , "echo -n \"y/n: \"; " ) ;

5224 
	`°rˇt
–
lDülogSåög
 , "stty sane -echo;" ) ;

5225 
	`°rˇt
–
lDülogSåög
 ,

5227 
	`°rˇt
–
lDülogSåög
 ,

5229 
	`°rˇt
–
lDülogSåög
 , "\techo 1\nelse\n\techo 0\nfi" ) ;

5231 i‡–
aDülogTy≥
 && !
	`°rcmp
("okcancel",aDialogType) )

5233 
	`°rˇt
–
lDülogSåög
 , "echo -n \"[O]kay/[C]ancel: \"; " ) ;

5234 
	`°rˇt
–
lDülogSåög
 , "stty sane -echo;" ) ;

5235 
	`°rˇt
–
lDülogSåög
 ,

5237 
	`°rˇt
–
lDülogSåög
 ,

5239 
	`°rˇt
–
lDülogSåög
 , "\techo 1\nelse\n\techo 0\nfi" ) ;

5241 i‡–
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",aDialogType) )

5243 
	`°rˇt
–
lDülogSåög
 , "echo -n \"[Y]es/[N]o/[C]ancel: \"; " ) ;

5244 
	`°rˇt
–
lDülogSåög
 , "stty sane -echo;" ) ;

5245 
	`°rˇt
–
lDülogSåög
 ,

5247 
	`°rˇt
–
lDülogSåög
 ,

5249 
	`°rˇt
–
lDülogSåög
 , "elifÉcho \"$answer\" | grep -iq \"^n\";then\n\techo 2\n" ) ;

5250 
	`°rˇt
–
lDülogSåög
 , "else\n\techo 0\nfi" ) ;

5254 
	`°rˇt
(
lDülogSåög
 , "echo -n \"pressÉnterÅo continue \"; ");

5255 
	`°rˇt
–
lDülogSåög
 , "stty sane -echo;" ) ;

5256 
	`°rˇt
–
lDülogSåög
 ,

5259 
	`°rˇt
–
lDülogSåög
 ,

5262 i‡–!
	`isTîmöÆRu¬ög
(Ë&& 
	`pyth⁄DbusPª£¡
(Ë&& !
	`°rcmp
("ok" , 
aDülogTy≥
) )

5264 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python-dbus"); 1;}

5265 
	`°r˝y
–
lDülogSåög
 , 
gPyth⁄Name
 ) ;

5266 
	`°rˇt
–
lDülogSåög
 ," -c \"import dbus;bus=dbus.SessionBus();");

5267 
	`°rˇt
–
lDülogSåög
 ,"notif=bus.get_object('org.freedesktop.Notifications','/org/freedesktop/Notifications');" ) ;

5268 
	`°rˇt
–
lDülogSåög
 ,"notify=dbus.Interface(notif,'org.freedesktop.Notifications');" ) ;

5269 
	`°rˇt
–
lDülogSåög
 ,"notify.Notify('',0,'" ) ;

5270 i‡–
aIc⁄Ty≥
 && 
	`°æí
(aIconType) )

5272 
	`°rˇt
–
lDülogSåög
 , 
aIc⁄Ty≥
 ) ;

5274 
	`°rˇt
(
lDülogSåög
, "','") ;

5275 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5277 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5279 
	`°rˇt
(
lDülogSåög
, "','") ;

5280 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5282 
ÕDülogSåög
 = 
lDülogSåög
 + 
	`°æí
(lDialogString);

5283 
	`ª∂a˚SubSå
–
aMesßge
 , "\n" , "\\n" , 
ÕDülogSåög
 ) ;

5285 
	`°rˇt
(
lDülogSåög
, "','','',5000)\"") ;

5287 i‡–!
	`isTîmöÆRu¬ög
(Ë&& (
	`≥æPª£¡
(Ë>2Ë&& !
	`°rcmp
("ok" , 
aDülogTy≥
) )

5289 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"perl-dbus"); 1;}

5291 
	`°r˝y
–
lDülogSåög
 , "perl -e \"use Net::DBus;\
 \\$sessionBus = Net::DBus->session;\
 \\$notificationsService = \\$sessionBus->get_service('org.freedesktop.Notifications');\
 \\$notificationsObject = \\$notificationsService->get_object('/org/freedesktop/Notifications',\
'org.freedesktop.Notifications');");

5297 
	`•rötf
–
lDülogSåög
 + 
	`°æí
(lDialogString),

5299 
aIc⁄Ty≥
?aIc⁄Ty≥:"", 
aTôÀ
?aTôÀ:"", 
aMesßge
?aMessage:"" ) ;

5301 i‡–!
	`isTîmöÆRu¬ög
(Ë&& 
	`nŸify£ndPª£¡
(Ë&& !
	`°rcmp
("ok" , 
aDülogTy≥
) )

5304 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"notifysend"); 1;}

5305 
	`°r˝y
–
lDülogSåög
 , "notify-send" ) ;

5306 i‡–
aIc⁄Ty≥
 && 
	`°æí
(aIconType) )

5308 
	`°rˇt
–
lDülogSåög
 , " -i '" ) ;

5309 
	`°rˇt
–
lDülogSåög
 , 
aIc⁄Ty≥
 ) ;

5310 
	`°rˇt
–
lDülogSåög
 , "'" ) ;

5312 
	`°rˇt
–
lDülogSåög
 , " \"" ) ;

5313 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5315 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5316 
	`°rˇt
–
lDülogSåög
 , " | " ) ;

5318 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5320 
	`ª∂a˚SubSå
–
aMesßge
 , "\n\t" , " | " , 
lBuff
 ) ;

5321 
	`ª∂a˚SubSå
–
aMesßge
 , "\n" , " | " , 
lBuff
 ) ;

5322 
	`ª∂a˚SubSå
–
aMesßge
 , "\t" , " " , 
lBuff
 ) ;

5323 
	`°rˇt
(
lDülogSåög
, 
lBuff
) ;

5325 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

5329 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"basicinput"); 0;}

5330 i‡–!
gW¨nögDi•œyed
 && !
töyfd_f‹˚C⁄sﬁe
)

5332 
gW¨nögDi•œyed
 = 1 ;

5333 
	`¥ötf
("\n\n%s\n", 
gTôÀ
);

5334 
	`¥ötf
("%s\n\n", 
töyfd_√eds
);

5336 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5338 
	`¥ötf
("\n%s\n", 
aTôÀ
);

5341 
	`tcgë©å
(0, &
öfoOri
);

5342 
	`tcgë©å
(0, &
öfo
);

5343 
öfo
.
c_lÊag
 &~
ICANON
;

5344 
öfo
.
c_cc
[
VMIN
] = 1;

5345 
öfo
.
c_cc
[
VTIME
] = 0;

5346 
	`tc£èâr
(0, 
TCSANOW
, &
öfo
);

5347 i‡–
aDülogTy≥
 && !
	`°rcmp
("yesno",aDialogType) )

5351 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5353 
	`¥ötf
("\n%s\n",
aMesßge
);

5355 
	`¥ötf
("y/n: "); 
	`fÊush
(
°dout
);

5356 
lCh¨
 = 
	`tﬁowî
–
	`gëch¨
() ) ;

5357 
	`¥ötf
("\n\n");

5359  
lCh¨
 != 'y' &&ÜChar != 'n' );

5360 
lResu…
 = 
lCh¨
 == 'y' ? 1 : 0 ;

5362 i‡–
aDülogTy≥
 && !
	`°rcmp
("okcancel",aDialogType) )

5366 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5368 
	`¥ötf
("\n%s\n",
aMesßge
);

5370 
	`¥ötf
("[O]kay/[C]™˚l: "); 
	`fÊush
(
°dout
);

5371 
lCh¨
 = 
	`tﬁowî
–
	`gëch¨
() ) ;

5372 
	`¥ötf
("\n\n");

5374  
lCh¨
 != 'o' &&ÜChar != 'c' );

5375 
lResu…
 = 
lCh¨
 == 'o' ? 1 : 0 ;

5377 i‡–
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",aDialogType) )

5381 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5383 
	`¥ötf
("\n%s\n",
aMesßge
);

5385 
	`¥ötf
("[Y]es/[N]o/[C]™˚l: "); 
	`fÊush
(
°dout
);

5386 
lCh¨
 = 
	`tﬁowî
–
	`gëch¨
() ) ;

5387 
	`¥ötf
("\n\n");

5389  
lCh¨
 != 'y' &&ÜChar != 'n' &&ÜChar != 'c' );

5390 
lResu…
 = (
lCh¨
 == 'y') ? 1 : (lChar == 'n') ? 2 : 0 ;

5394 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5396 
	`¥ötf
("\n%s\n\n",
aMesßge
);

5398 
	`¥ötf
("¥es†íã∏tÿc⁄töuê"); 
	`fÊush
(
°dout
);

5399 
	`gëch¨
() ;

5400 
	`¥ötf
("\n\n");

5401 
lResu…
 = 1 ;

5403 
	`tc£èâr
(0, 
TCSANOW
, &
öfoOri
);

5404 
	`‰ì
(
lDülogSåög
);

5405  
lResu…
 ;

5408 i‡(
töyfd_vîbo£
Ë
	`¥ötf
–"lDülogSåög: %s\n" , 
lDülogSåög
 ) ;

5410 i‡–! ( 
lIn
 = 
	`p›í
–
lDülogSåög
 , "r" ) ) )

5412 
	`‰ì
(
lDülogSåög
);

5415  
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

5418 
	`p˛o£
–
lIn
 ) ;

5421 i‡–
lBuff
[
	`°æí
(ÜBuff ) -1] == '\n' )

5423 
lBuff
[
	`°æí
(ÜBuff ) -1] = '\0' ;

5427 i‡(
aDülogTy≥
 && !
	`°rcmp
("yesnocancel",áDialogType))

5429 i‡–
lBuff
[0]=='1' )

5431 i‡–!
	`°rcmp
–
lBuff
+1 , "Yes" )Ë
	`°r˝y
(lBuff,"1");

5432 i‡–!
	`°rcmp
–
lBuff
+1 , "No" )Ë
	`°r˝y
(lBuff,"2");

5437 
lResu…
 = !
	`°rcmp
–
lBuff
 , "2" ) ? 2 : !strcmp(ÜBuff , "1" ) ? 1 : 0;

5440 
	`‰ì
(
lDülogSåög
);

5441  
lResu…
 ;

5442 
	}
}

5446 
	$töyfd_nŸifyP›up
(

5447 c⁄° * 
aTôÀ
 ,

5448 c⁄° * 
aMesßge
 ,

5449 c⁄° * 
aIc⁄Ty≥
 )

5451 
lBuff
[
MAX_PATH_OR_CMD
];

5452 * 
lDülogSåög
 = 
NULL
 ;

5453 * 
ÕDülogSåög
 ;

5454 
FILE
 * 
lIn
 ;

5455 
size_t
 
lTôÀLí
 ;

5456 
size_t
 
lMesßgeLí
 ;

5458 i‡–
	`gëív
("SSH_TTY") )

5460  
	`töyfd_mesßgeBox
(
aTôÀ
, 
aMesßge
, "ok", 
aIc⁄Ty≥
, 0);

5463 
lTôÀLí
 = 
aTôÀ
 ? 
	`°æí
(aTitle) : 0 ;

5464 
lMesßgeLí
 = 
aMesßge
 ? 
	`°æí
(aMessage) : 0 ;

5465 i‡–!
aTôÀ
 || 
	`°rcmp
(aTitle,"tinyfd_query") )

5467 
lDülogSåög
 = (*Ë
	`mÆloc
–
MAX_PATH_OR_CMD
 + 
lTôÀLí
 + 
lMesßgeLí
 );

5470 i‡–
	`oßs¸ùtPª£¡
( ) )

5472 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"applescript"); 1;}

5474 
	`°r˝y
–
lDülogSåög
 , "osascript ");

5475 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
 , " -e 'tellápplication \"System Events\"' -e 'Activate'");

5476 
	`°rˇt
–
lDülogSåög
 , " -e 'try' -e 'displayÇotification \"") ;

5477 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5479 
	`°rˇt
(
lDülogSåög
, 
aMesßge
) ;

5481 
	`°rˇt
(
lDülogSåög
, " \" ") ;

5482 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5484 
	`°rˇt
(
lDülogSåög
, "withÅitle \"") ;

5485 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5486 
	`°rˇt
(
lDülogSåög
, "\" ") ;

5489 
	`°rˇt
–
lDülogSåög
, "' -e 'endÅry'") ;

5490 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
, " -e 'endÅell'") ;

5492 i‡–
	`kdülogPª£¡
() )

5494 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"kdialog"); 1;}

5495 
	`°r˝y
–
lDülogSåög
 , "kdialog" ) ;

5497 i‡–
aIc⁄Ty≥
 && 
	`°æí
(aIconType) )

5499 
	`°rˇt
–
lDülogSåög
 , " --icon '" ) ;

5500 
	`°rˇt
–
lDülogSåög
 , 
aIc⁄Ty≥
 ) ;

5501 
	`°rˇt
–
lDülogSåög
 , "'" ) ;

5503 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5505 
	`°rˇt
–
lDülogSåög
 , " --title \"" ) ;

5506 
	`°rˇt
–
lDülogSåög
 , 
aTôÀ
 ) ;

5507 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

5510 
	`°rˇt
–
lDülogSåög
 , " --passivepopup" ) ;

5511 
	`°rˇt
–
lDülogSåög
 , " \"" ) ;

5512 i‡–
aMesßge
 )

5514 
	`°rˇt
–
lDülogSåög
 , 
aMesßge
 ) ;

5516 
	`°rˇt
–
lDülogSåög
 , " \" 5" ) ;

5518 i‡–(
	`zíôy3Pª£¡
()>=5Ë|| 
	`m©edülogPª£¡
(Ë|| 
	`shñÀmíèryPª£¡
(Ë|| 
	`q¨maPª£¡
() )

5522 i‡–
	`zíôy3Pª£¡
()>=5 )

5524 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"zenity"); 1;}

5525 
	`°r˝y
–
lDülogSåög
 , "zenity" ) ;

5527 i‡–
	`m©edülogPª£¡
() )

5529 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"matedialog"); 1;}

5530 
	`°r˝y
–
lDülogSåög
 , "matedialog" ) ;

5532 i‡–
	`shñÀmíèryPª£¡
() )

5534 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"shellementary"); 1;}

5535 
	`°r˝y
–
lDülogSåög
 , "shellementary" ) ;

5539 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"qarma"); 1;}

5540 
	`°r˝y
–
lDülogSåög
 , "qarma" ) ;

5543 
	`°rˇt
–
lDülogSåög
 , " --notification");

5545 i‡–
aIc⁄Ty≥
 && 
	`°æí
(áIconType ) )

5547 
	`°rˇt
–
lDülogSåög
 , " --window-icon '");

5548 
	`°rˇt
–
lDülogSåög
 , 
aIc⁄Ty≥
 ) ;

5549 
	`°rˇt
–
lDülogSåög
 , "'" ) ;

5552 
	`°rˇt
–
lDülogSåög
 , " --text \"" ) ;

5553 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5555 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5556 
	`°rˇt
(
lDülogSåög
, "\n") ;

5558 i‡–
aMesßge
 && 
	`°æí
(áMessage ) )

5560 
	`°rˇt
–
lDülogSåög
 , 
aMesßge
 ) ;

5562 
	`°rˇt
–
lDülogSåög
 , " \"" ) ;

5564 i‡–
	`≥æPª£¡
() >= 2 )

5566 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"perl-dbus"); 1;}

5568 
	`°r˝y
–
lDülogSåög
 , "perl -e \"use Net::DBus;\
 \\$sessionBus = Net::DBus->session;\
 \\$notificationsService = \\$sessionBus->get_service('org.freedesktop.Notifications');\
 \\$notificationsObject = \\$notificationsService->get_object('/org/freedesktop/Notifications',\
'org.freedesktop.Notifications');");

5574 
	`•rötf
–
lDülogSåög
 + 
	`°æí
(lDialogString) ,

5576 
aIc⁄Ty≥
?aIc⁄Ty≥:"", 
aTôÀ
?aTôÀ:"", 
aMesßge
?aMessage:"" ) ;

5578 i‡–
	`pyth⁄DbusPª£¡
( ) )

5580 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python-dbus"); 1;}

5581 
	`°r˝y
–
lDülogSåög
 , 
gPyth⁄Name
 ) ;

5582 
	`°rˇt
–
lDülogSåög
 ," -c \"import dbus;bus=dbus.SessionBus();");

5583 
	`°rˇt
–
lDülogSåög
 ,"notif=bus.get_object('org.freedesktop.Notifications','/org/freedesktop/Notifications');" ) ;

5584 
	`°rˇt
–
lDülogSåög
 ,"notify=dbus.Interface(notif,'org.freedesktop.Notifications');" ) ;

5585 
	`°rˇt
–
lDülogSåög
 ,"notify.Notify('',0,'" ) ;

5586 i‡–
aIc⁄Ty≥
 && 
	`°æí
(aIconType) )

5588 
	`°rˇt
–
lDülogSåög
 , 
aIc⁄Ty≥
 ) ;

5590 
	`°rˇt
(
lDülogSåög
, "','") ;

5591 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5593 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5595 
	`°rˇt
(
lDülogSåög
, "','") ;

5596 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5598 
ÕDülogSåög
 = 
lDülogSåög
 + 
	`°æí
(lDialogString);

5599 
	`ª∂a˚SubSå
–
aMesßge
 , "\n" , "\\n" , 
ÕDülogSåög
 ) ;

5601 
	`°rˇt
(
lDülogSåög
, "','','',5000)\"") ;

5603 i‡–
	`nŸify£ndPª£¡
() )

5605 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"notifysend"); 1;}

5606 
	`°r˝y
–
lDülogSåög
 , "notify-send" ) ;

5607 i‡–
aIc⁄Ty≥
 && 
	`°æí
(aIconType) )

5609 
	`°rˇt
–
lDülogSåög
 , " -i '" ) ;

5610 
	`°rˇt
–
lDülogSåög
 , 
aIc⁄Ty≥
 ) ;

5611 
	`°rˇt
–
lDülogSåög
 , "'" ) ;

5613 
	`°rˇt
–
lDülogSåög
 , " \"" ) ;

5614 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5616 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5617 
	`°rˇt
–
lDülogSåög
 , " | " ) ;

5619 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5621 
	`ª∂a˚SubSå
–
aMesßge
 , "\n\t" , " | " , 
lBuff
 ) ;

5622 
	`ª∂a˚SubSå
–
aMesßge
 , "\n" , " | " , 
lBuff
 ) ;

5623 
	`ª∂a˚SubSå
–
aMesßge
 , "\t" , " " , 
lBuff
 ) ;

5624 
	`°rˇt
(
lDülogSåög
, 
lBuff
) ;

5626 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

5630  
	`töyfd_mesßgeBox
(
aTôÀ
, 
aMesßge
, "ok", 
aIc⁄Ty≥
, 0);

5633 i‡(
töyfd_vîbo£
Ë
	`¥ötf
–"lDülogSåög: %s\n" , 
lDülogSåög
 ) ;

5635 i‡–! ( 
lIn
 = 
	`p›í
–
lDülogSåög
 , "r" ) ) )

5637 
	`‰ì
(
lDülogSåög
);

5641 
	`p˛o£
–
lIn
 ) ;

5642 
	`‰ì
(
lDülogSåög
);

5644 
	}
}

5648 * 
	$töyfd_öputBox
(

5649 c⁄° * 
aTôÀ
 ,

5650 c⁄° * 
aMesßge
 ,

5651 c⁄° * 
aDeÁu…I≈ut
 )

5653 
lBuff
[
MAX_PATH_OR_CMD
];

5654 * 
lDülogSåög
 = 
NULL
;

5655 * 
ÕDülogSåög
;

5656 
FILE
 * 
lIn
 ;

5657 
lResu…
 ;

5658 
lWasGdülog
 = 0 ;

5659 
lWasGøphicDülog
 = 0 ;

5660 
lWasXãrm
 = 0 ;

5661 
lWasBasicXãrm
 = 0 ;

5662 
ãrmios
 
ﬁdt
 ;

5663 
ãrmios
 
√wt
 ;

5664 * 
lEOF
;

5665 
size_t
 
lTôÀLí
 ;

5666 
size_t
 
lMesßgeLí
 ;

5668 i‡(!
aTôÀ
 && !
aMesßge
 && !
aDeÁu…I≈ut
Ë 
lBuff
;

5670 
lBuff
[0]='\0';

5672 
lTôÀLí
 = 
aTôÀ
 ? 
	`°æí
(aTitle) : 0 ;

5673 
lMesßgeLí
 = 
aMesßge
 ? 
	`°æí
(aMessage) : 0 ;

5674 i‡–!
aTôÀ
 || 
	`°rcmp
(aTitle,"tinyfd_query") )

5676 
lDülogSåög
 = (*Ë
	`mÆloc
–
MAX_PATH_OR_CMD
 + 
lTôÀLí
 + 
lMesßgeLí
 );

5679 i‡–
	`oßs¸ùtPª£¡
( ) )

5681 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"applescript"); (*)1;}

5682 
	`°r˝y
–
lDülogSåög
 , "osascript ");

5683 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
 , " -e 'tellápplication \"System Events\"' -e 'Activate'");

5684 
	`°rˇt
–
lDülogSåög
 , " -e 'try' -e 'display dialog \"") ;

5685 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5687 
	`°rˇt
(
lDülogSåög
, 
aMesßge
) ;

5689 
	`°rˇt
(
lDülogSåög
, "\" ") ;

5690 
	`°rˇt
(
lDülogSåög
, "defaultánswer \"") ;

5691 i‡–
aDeÁu…I≈ut
 && 
	`°æí
(aDefaultInput) )

5693 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…I≈ut
) ;

5695 
	`°rˇt
(
lDülogSåög
, "\" ") ;

5696 i‡–! 
aDeÁu…I≈ut
 )

5698 
	`°rˇt
(
lDülogSåög
, "hiddenánswerÅrue ") ;

5700 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5702 
	`°rˇt
(
lDülogSåög
, "withÅitle \"") ;

5703 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5704 
	`°rˇt
(
lDülogSåög
, "\" ") ;

5706 
	`°rˇt
(
lDülogSåög
, "with iconÇote' ") ;

5707 
	`°rˇt
(
lDülogSåög
, "-e '\"1\" &ÅextÑeturned ofÑesult' " );

5708 
	`°rˇt
(
lDülogSåög
, "-e 'onÉrrorÇumber -128' " ) ;

5709 
	`°rˇt
(
lDülogSåög
, "-e '0' " );

5710 
	`°rˇt
(
lDülogSåög
, "-e 'endÅry'") ;

5711 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
(
lDülogSåög
, " -e 'endÅell'") ;

5713 i‡–
	`kdülogPª£¡
() )

5715 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"kdialog"); (*)1;}

5716 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(kdialog" ) ;

5718 i‡–
	`kdülogPª£¡
() == 2 )

5720 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

5723 i‡–! 
aDeÁu…I≈ut
 )

5725 
	`°rˇt
(
lDülogSåög
, " --password ") ;

5729 
	`°rˇt
(
lDülogSåög
, " --inputbox ") ;

5732 
	`°rˇt
(
lDülogSåög
, "\"") ;

5733 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5735 
	`°rˇt
(
lDülogSåög
, 
aMesßge
 ) ;

5737 
	`°rˇt
(
lDülogSåög
 , "\" \"" ) ;

5738 i‡–
aDeÁu…I≈ut
 && 
	`°æí
(aDefaultInput) )

5740 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…I≈ut
 ) ;

5742 
	`°rˇt
(
lDülogSåög
 , "\"" ) ;

5743 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5745 
	`°rˇt
(
lDülogSåög
, " --title \"") ;

5746 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5747 
	`°rˇt
(
lDülogSåög
, "\"") ;

5749 
	`°rˇt
–
lDülogSåög
 ,

5752 i‡–
	`zíôyPª£¡
(Ë|| 
	`m©edülogPª£¡
(Ë|| 
	`shñÀmíèryPª£¡
(Ë|| 
	`q¨maPª£¡
() )

5754 i‡–
	`zíôyPª£¡
() )

5756 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"zenity"); (*)1;}

5757 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(zenity" ) ;

5758 i‡–(
	`zíôy3Pª£¡
(Ë>4Ë&& !
	`gëív
("SSH_TTY") )

5760 
	`°rˇt
–
lDülogSåög
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

5763 i‡–
	`m©edülogPª£¡
() )

5765 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"matedialog"); (*)1;}

5766 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(matedialog" ) ;

5768 i‡–
	`shñÀmíèryPª£¡
() )

5770 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"shellementary"); (*)1;}

5771 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(shellementary" ) ;

5775 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"qarma"); (*)1;}

5776 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(qarma" ) ;

5777 i‡–!
	`gëív
("SSH_TTY") )

5779 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

5782 
	`°rˇt
–
lDülogSåög
 ," --entry" ) ;

5784 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5786 
	`°rˇt
(
lDülogSåög
, " --title=\"") ;

5787 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5788 
	`°rˇt
(
lDülogSåög
, "\"") ;

5790 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5792 
	`°rˇt
(
lDülogSåög
, " --text=\"") ;

5793 
	`°rˇt
(
lDülogSåög
, 
aMesßge
) ;

5794 
	`°rˇt
(
lDülogSåög
, "\"") ;

5796 i‡–
aDeÁu…I≈ut
 && 
	`°æí
(aDefaultInput) )

5798 
	`°rˇt
(
lDülogSåög
, " --entry-text=\"") ;

5799 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…I≈ut
) ;

5800 
	`°rˇt
(
lDülogSåög
, "\"") ;

5804 
	`°rˇt
(
lDülogSåög
, " --hide-text") ;

5806 i‡(
töyfd_sûít
Ë
	`°rˇt
–
lDülogSåög
 , " 2>/dev/null ");

5807 
	`°rˇt
–
lDülogSåög
 ,

5810 i‡–
	`gxmesßgePª£¡
(Ë|| 
	`gmesßgePª£¡
() )

5812 i‡–
	`gxmesßgePª£¡
() ) {

5813 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"gxmessage"); (*)1;}

5814 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(gxmessage -buttons Ok:1,Cancel:0 -center \"");

5818 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"gmessage"); (*)1;}

5819 
	`°r˝y
–
lDülogSåög
 , "szAnswer=$(gmessage -buttons Ok:1,Cancel:0 -center \"");

5822 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5824 
	`°rˇt
–
lDülogSåög
 , 
aMesßge
 ) ;

5826 
	`°rˇt
(
lDülogSåög
, "\"" ) ;

5827 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5829 
	`°rˇt
–
lDülogSåög
 , " -title \"");

5830 
	`°rˇt
–
lDülogSåög
 , 
aTôÀ
 ) ;

5831 
	`°rˇt
(
lDülogSåög
, "\" " ) ;

5833 
	`°rˇt
(
lDülogSåög
, " -entrytext \"" ) ;

5834 i‡–
aDeÁu…I≈ut
 && 
	`°æí
(aDefaultInput) )

5836 
	`°rˇt
–
lDülogSåög
 , 
aDeÁu…I≈ut
 ) ;

5838 
	`°rˇt
(
lDülogSåög
, "\"" ) ;

5839 
	`°rˇt
–
lDülogSåög
 , ");echo $?$szAnswer");

5841 i‡–!
	`gdülogPª£¡
(Ë&& !
	`xdülogPª£¡
(Ë&& 
	`tköãr3Pª£¡
( ) )

5843 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python3-tkinter"); (*)1;}

5844 
	`°r˝y
–
lDülogSåög
 , 
gPyth⁄3Name
 ) ;

5845 
	`°rˇt
–
lDülogSåög
 ,

5847 
	`°rˇt
–
lDülogSåög
 ,"res=simpledialog.askstring(" ) ;

5848 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5850 
	`°rˇt
(
lDülogSåög
, "title='") ;

5851 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5852 
	`°rˇt
(
lDülogSåög
, "',") ;

5854 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5857 
	`°rˇt
(
lDülogSåög
, "prompt='") ;

5858 
ÕDülogSåög
 = 
lDülogSåög
 + 
	`°æí
(lDialogString);

5859 
	`ª∂a˚SubSå
–
aMesßge
 , "\n" , "\\n" , 
ÕDülogSåög
 ) ;

5860 
	`°rˇt
(
lDülogSåög
, "',") ;

5862 i‡–
aDeÁu…I≈ut
 )

5864 i‡–
	`°æí
(
aDeÁu…I≈ut
) )

5866 
	`°rˇt
(
lDülogSåög
, "initialvalue='") ;

5867 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…I≈ut
) ;

5868 
	`°rˇt
(
lDülogSåög
, "',") ;

5873 
	`°rˇt
(
lDülogSåög
, "show='*'") ;

5875 
	`°rˇt
(
lDülogSåög
, ");\nifÑes is None :\n\tprint(0)");

5876 
	`°rˇt
(
lDülogSåög
, "\nelse :\n\tprint('1'+res)\n\"" ) ;

5878 i‡–!
	`gdülogPª£¡
(Ë&& !
	`xdülogPª£¡
(Ë&& 
	`tköãr2Pª£¡
( ) )

5880 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python2-tkinter"); (*)1;}

5881 
	`°r˝y
–
lDülogSåög
 , "export PYTHONIOENCODING=utf-8;" ) ;

5882 
	`°rˇt
–
lDülogSåög
 , 
gPyth⁄2Name
 ) ;

5883 i‡–! 
	`isTîmöÆRu¬ög
–Ë&& 
	`isD¨wö
( ) )

5885 
	`°rˇt
–
lDülogSåög
 , " -i" ) ;

5888 
	`°rˇt
–
lDülogSåög
 ,

5891 i‡–
	`isD¨wö
( ) )

5893 
	`°rˇt
–
lDülogSåög
 ,

5898 
	`°rˇt
–
lDülogSåög
 ,"res=tkSimpleDialog.askstring(" ) ;

5899 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5901 
	`°rˇt
(
lDülogSåög
, "title='") ;

5902 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5903 
	`°rˇt
(
lDülogSåög
, "',") ;

5905 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

5908 
	`°rˇt
(
lDülogSåög
, "prompt='") ;

5909 
ÕDülogSåög
 = 
lDülogSåög
 + 
	`°æí
(lDialogString);

5910 
	`ª∂a˚SubSå
–
aMesßge
 , "\n" , "\\n" , 
ÕDülogSåög
 ) ;

5911 
	`°rˇt
(
lDülogSåög
, "',") ;

5913 i‡–
aDeÁu…I≈ut
 )

5915 i‡–
	`°æí
(
aDeÁu…I≈ut
) )

5917 
	`°rˇt
(
lDülogSåög
, "initialvalue='") ;

5918 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…I≈ut
) ;

5919 
	`°rˇt
(
lDülogSåög
, "',") ;

5924 
	`°rˇt
(
lDülogSåög
, "show='*'") ;

5926 
	`°rˇt
(
lDülogSåög
, ");\nifÑes is None :\n\tprint 0");

5927 
	`°rˇt
(
lDülogSåög
, "\nelse :\n\tprint '1'+res\n\"" ) ;

5929 i‡–
	`gdülogPª£¡
(Ë|| 
	`xdülogPª£¡
(Ë|| 
	`dülogName
(Ë|| 
	`whùèûPª£¡
() )

5931 i‡–
	`gdülogPª£¡
( ) )

5933 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"gdialog"); (*)1;}

5934 
lWasGøphicDülog
 = 1 ;

5935 
lWasGdülog
 = 1 ;

5936 
	`°r˝y
–
lDülogSåög
 , "(gdialog " ) ;

5938 i‡–
	`xdülogPª£¡
( ) )

5940 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"xdialog"); (*)1;}

5941 
lWasGøphicDülog
 = 1 ;

5942 
	`°r˝y
–
lDülogSåög
 , "(Xdialog " ) ;

5944 i‡–
	`dülogName
( ) )

5946 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"dialog"); (*)0;}

5947 i‡–
	`isTîmöÆRu¬ög
( ) )

5949 
	`°r˝y
–
lDülogSåög
 , "(dialog " ) ;

5953 
lWasXãrm
 = 1 ;

5954 
	`°r˝y
–
lDülogSåög
 , 
	`ãrmöÆName
() ) ;

5955 
	`°rˇt
–
lDülogSåög
 , "'(" ) ;

5956 
	`°rˇt
–
lDülogSåög
 , 
	`dülogName
() ) ;

5957 
	`°rˇt
–
lDülogSåög
 , " " ) ;

5960 i‡–
	`isTîmöÆRu¬ög
( ) )

5962 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"whiptail"); (*)0;}

5963 
	`°r˝y
–
lDülogSåög
 , "(whiptail " ) ;

5967 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"whiptail"); (*)0;}

5968 
lWasXãrm
 = 1 ;

5969 
	`°r˝y
–
lDülogSåög
 , 
	`ãrmöÆName
() ) ;

5970 
	`°rˇt
–
lDülogSåög
 , "'(whiptail " ) ;

5973 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

5975 
	`°rˇt
(
lDülogSåög
, "--title \"") ;

5976 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

5977 
	`°rˇt
(
lDülogSåög
, "\" ") ;

5980 i‡–!
	`xdülogPª£¡
(Ë&& !
	`gdülogPª£¡
() )

5982 
	`°rˇt
(
lDülogSåög
, "--backtitle \"") ;

5983 
	`°rˇt
(
lDülogSåög
, "tab: move focus") ;

5984 i‡–! 
aDeÁu…I≈ut
 && !
lWasGdülog
 )

5986 
	`°rˇt
(
lDülogSåög
, " (sometimesÇothing,Ço blinkÇor star, is shown inÅext field)") ;

5988 
	`°rˇt
(
lDülogSåög
, "\" ") ;

5991 i‡–
aDeÁu…I≈ut
 || 
lWasGdülog
 )

5993 
	`°rˇt
–
lDülogSåög
 , "--inputbox" ) ;

5997 i‡–!
lWasGøphicDülog
 && 
	`dülogName
(Ë&& 
	`isDülogVîsi⁄Bëãr09b
() )

5999 
	`°rˇt
–
lDülogSåög
 , "--insecure " ) ;

6001 
	`°rˇt
–
lDülogSåög
 , "--passwordbox" ) ;

6003 
	`°rˇt
–
lDülogSåög
 , " \"" ) ;

6004 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

6006 
	`°rˇt
(
lDülogSåög
, 
aMesßge
) ;

6008 
	`°rˇt
(
lDülogSåög
,"\" 10 60 ") ;

6009 i‡–
aDeÁu…I≈ut
 && 
	`°æí
(aDefaultInput) )

6011 
	`°rˇt
(
lDülogSåög
, "\"") ;

6012 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…I≈ut
) ;

6013 
	`°rˇt
(
lDülogSåög
, "\" ") ;

6015 i‡–
lWasGøphicDülog
 )

6017 
	`°rˇt
(
lDülogSåög
,") 2>/tmp/tinyfd.txt;\
 [ $? = 0 ];thenÅinyfdBool=1;elseÅinyfdBool=0;fi;\
=$(cat /tmp/tinyfd.txt);echo $tinyfdBool$tinyfdRes") ;

6023 
	`°rˇt
(
lDülogSåög
,">/dev/tty ) 2>/tmp/tinyfd.txt;\
 [ $? = 0 ];thenÅinyfdBool=1;elseÅinyfdBool=0;fi;\
=$(cat /tmp/tinyfd.txt);echo $tinyfdBool$tinyfdRes") ;

6027 i‡–
lWasXãrm
 )

6029 
	`°rˇt
(
lDülogSåög
," >/tmp/tinyfd0.txt';cat /tmp/tinyfd0.txt");

6033 
	`°rˇt
(
lDülogSåög
, "; clear >/dev/tty") ;

6037 i‡–! 
	`isTîmöÆRu¬ög
–Ë&& 
	`ãrmöÆName
() )

6039 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"basicinput"); (*)0;}

6040 
lWasBasicXãrm
 = 1 ;

6041 
	`°r˝y
–
lDülogSåög
 , 
	`ãrmöÆName
() ) ;

6042 
	`°rˇt
–
lDülogSåög
 , "'" ) ;

6043 i‡–!
gW¨nögDi•œyed
 && !
töyfd_f‹˚C⁄sﬁe
)

6045 
gW¨nögDi•œyed
 = 1 ;

6046 
	`töyfd_mesßgeBox
(
gTôÀ
,
töyfd_√eds
,"ok","warning",0);

6048 i‡–
aTôÀ
 && 
	`°æí
◊TôÀË&& !
töyfd_f‹˚C⁄sﬁe
)

6050 
	`°rˇt
–
lDülogSåög
 , "echo \"" ) ;

6051 
	`°rˇt
–
lDülogSåög
, 
aTôÀ
) ;

6052 
	`°rˇt
–
lDülogSåög
 , "\";echo;" ) ;

6055 
	`°rˇt
–
lDülogSåög
 , "echo \"" ) ;

6056 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

6058 
	`°rˇt
–
lDülogSåög
, 
aMesßge
) ;

6060 
	`°rˇt
–
lDülogSåög
 , "\";read " ) ;

6061 i‡–! 
aDeÁu…I≈ut
 )

6063 
	`°rˇt
–
lDülogSåög
 , "-s " ) ;

6065 
	`°rˇt
–
lDülogSåög
 , "-p \"" ) ;

6066 
	`°rˇt
–
lDülogSåög
 , "(esc+enterÅo cancel): \" ANSWER " ) ;

6067 
	`°rˇt
–
lDülogSåög
 , ";echo 1$ANSWER >/tmp/tinyfd.txt';" ) ;

6068 
	`°rˇt
–
lDülogSåög
 , "cat -v /tmp/tinyfd.txt");

6070 i‡–!
gW¨nögDi•œyed
 && ! 
	`isTîmöÆRu¬ög
–Ë&& ! 
	`ãrmöÆName
() ) {

6071 
gW¨nögDi•œyed
 = 1 ;

6072 
	`töyfd_mesßgeBox
(
gTôÀ
,
töyfd_√eds
,"ok","warning",0);

6073 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"no_solution"); (*)0;}

6074 
	`‰ì
(
lDülogSåög
);

6075  
NULL
;

6079 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"basicinput"); (*)0;}

6080 i‡–!
gW¨nögDi•œyed
 && !
töyfd_f‹˚C⁄sﬁe
)

6082 
gW¨nögDi•œyed
 = 1 ;

6083 
	`töyfd_mesßgeBox
(
gTôÀ
,
töyfd_√eds
,"ok","warning",0);

6085 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6087 
	`¥ötf
("\n%s\n", 
aTôÀ
);

6089 i‡–
aMesßge
 && 
	`°æí
(aMessage) )

6091 
	`¥ötf
("\n%s\n",
aMesßge
);

6093 
	`¥ötf
("”sc+íã∏tÿˇn˚l): "); 
	`fÊush
(
°dout
);

6094 i‡–! 
aDeÁu…I≈ut
 )

6096 
	`tcgë©å
(
STDIN_FILENO
, & 
ﬁdt
) ;

6097 
√wt
 = 
ﬁdt
 ;

6098 
√wt
.
c_lÊag
 &~
ECHO
 ;

6099 
	`tc£èâr
(
STDIN_FILENO
, 
TCSANOW
, & 
√wt
);

6102 
lEOF
 = 
	`fgës
(
lBuff
, 
MAX_PATH_OR_CMD
, 
°dö
);

6104 i‡–! 
lEOF
 || (
lBuff
[0] == '\0') )

6106 
	`‰ì
(
lDülogSåög
);

6107  
NULL
;

6110 i‡–
lBuff
[0] == '\n' )

6112 
lEOF
 = 
	`fgës
(
lBuff
, 
MAX_PATH_OR_CMD
, 
°dö
);

6114 i‡–! 
lEOF
 || (
lBuff
[0] == '\0') )

6116 
	`‰ì
(
lDülogSåög
);

6117  
NULL
;

6121 i‡–! 
aDeÁu…I≈ut
 )

6123 
	`tc£èâr
(
STDIN_FILENO
, 
TCSANOW
, & 
ﬁdt
);

6124 
	`¥ötf
("\n");

6126 
	`¥ötf
("\n");

6127 i‡–
	`°rchr
(
lBuff
,27) )

6129 
	`‰ì
(
lDülogSåög
);

6130  
NULL
 ;

6132 i‡–
lBuff
[
	`°æí
(ÜBuff ) -1] == '\n' )

6134 
lBuff
[
	`°æí
(ÜBuff ) -1] = '\0' ;

6136 
	`‰ì
(
lDülogSåög
);

6137  
lBuff
 ;

6140 i‡(
töyfd_vîbo£
Ë
	`¥ötf
–"lDülogSåög: %s\n" , 
lDülogSåög
 ) ;

6141 
lIn
 = 
	`p›í
–
lDülogSåög
 , "r" );

6142 i‡–! 
lIn
 )

6144 i‡–
	`fûeExi°s
("/tmp/tinyfd.txt") )

6146 
	`wùefûe
("/tmp/tinyfd.txt");

6147 
	`ªmove
("/tmp/tinyfd.txt");

6149 i‡–
	`fûeExi°s
("/tmp/tinyfd0.txt") )

6151 
	`wùefûe
("/tmp/tinyfd0.txt");

6152 
	`ªmove
("/tmp/tinyfd0.txt");

6154 
	`‰ì
(
lDülogSåög
);

6155  
NULL
 ;

6157  
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

6160 
	`p˛o£
–
lIn
 ) ;

6162 i‡–
	`fûeExi°s
("/tmp/tinyfd.txt") )

6164 
	`wùefûe
("/tmp/tinyfd.txt");

6165 
	`ªmove
("/tmp/tinyfd.txt");

6167 i‡–
	`fûeExi°s
("/tmp/tinyfd0.txt") )

6169 
	`wùefûe
("/tmp/tinyfd0.txt");

6170 
	`ªmove
("/tmp/tinyfd0.txt");

6175 i‡–
lBuff
[
	`°æí
(ÜBuff ) -1] == '\n' )

6177 
lBuff
[
	`°æí
(ÜBuff ) -1] = '\0' ;

6180 i‡–
lWasBasicXãrm
 )

6182 i‡–
	`°r°r
(
lBuff
,"^[") )

6184 
	`‰ì
(
lDülogSåög
);

6185  
NULL
 ;

6189 
lResu…
 = 
	`°∫cmp
–
lBuff
 , "1" , 1) ? 0 : 1 ;

6191 i‡–! 
lResu…
 )

6193 
	`‰ì
(
lDülogSåög
);

6194  
NULL
 ;

6198 
	`‰ì
(
lDülogSåög
);

6199  
lBuff
+1 ;

6200 
	}
}

6203 * 
	$töyfd_ßveFûeDülog
(

6204 c⁄° * 
aTôÀ
 ,

6205 c⁄° * 
aDeÁu…P©hAndFûe
 ,

6206 
aNumOfFûãrP©ã∫s
 ,

6207 c⁄° * c⁄° * 
aFûãrP©ã∫s
 ,

6208 c⁄° * 
aSögÀFûãrDes¸ùti⁄
 )

6210 
lBuff
 [
MAX_PATH_OR_CMD
] ;

6211 
lDülogSåög
 [
MAX_PATH_OR_CMD
] ;

6212 
lSåög
 [
MAX_PATH_OR_CMD
] ;

6213 
i
 ;

6214 
lWasGøphicDülog
 = 0 ;

6215 
lWasXãrm
 = 0 ;

6216 * 
p
 ;

6217 * 
lPoöãrI≈utBox
 ;

6218 
FILE
 * 
lIn
 ;

6219 
lBuff
[0]='\0';

6221 i‡–
	`oßs¸ùtPª£¡
( ) )

6223 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"applescript"); (*)1;}

6224 
	`°r˝y
–
lDülogSåög
 , "osascript ");

6225 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
 , " -e 'tellápplication \"Finder\"' -e 'Activate'");

6226 
	`°rˇt
–
lDülogSåög
 , " -e 'try' -e 'POSIXÖath of ( choose fileÇame " );

6227 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6229 
	`°rˇt
(
lDülogSåög
, "withÖrompt \"") ;

6230 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6231 
	`°rˇt
(
lDülogSåög
, "\" ") ;

6233 
	`gëP©hWôhoutFöÆSœsh
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6234 i‡–
	`°æí
(
lSåög
) )

6236 
	`°rˇt
(
lDülogSåög
, "defaultÜocation \"") ;

6237 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6238 
	`°rˇt
(
lDülogSåög
 , "\" " ) ;

6240 
	`gëLa°Name
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6241 i‡–
	`°æí
(
lSåög
) )

6243 
	`°rˇt
(
lDülogSåög
, "defaultÇame \"") ;

6244 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6245 
	`°rˇt
(
lDülogSåög
 , "\" " ) ;

6247 
	`°rˇt
–
lDülogSåög
 , ")' " ) ;

6248 
	`°rˇt
(
lDülogSåög
, "-e 'onÉrrorÇumber -128' " ) ;

6249 
	`°rˇt
(
lDülogSåög
, "-e 'endÅry'") ;

6250 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
, " -e 'endÅell'") ;

6252 i‡–
	`kdülogPª£¡
() )

6254 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"kdialog"); (*)1;}

6256 
	`°r˝y
–
lDülogSåög
 , "kdialog" ) ;

6257 i‡–
	`kdülogPª£¡
() == 2 )

6259 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6261 
	`°rˇt
–
lDülogSåög
 , " --getsavefilename " ) ;

6263 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

6265 i‡–
aDeÁu…P©hAndFûe
[0] != '/' )

6267 
	`°rˇt
(
lDülogSåög
, "$PWD/") ;

6269 
	`°rˇt
(
lDülogSåög
, "\"") ;

6270 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©hAndFûe
 ) ;

6271 
	`°rˇt
(
lDülogSåög
 , "\"" ) ;

6275 
	`°rˇt
(
lDülogSåög
, "$PWD/") ;

6278 i‡–
aNumOfFûãrP©ã∫s
 > 0 )

6280 
	`°rˇt
(
lDülogSåög
 , " \"" ) ;

6281  
i
 = 0 ; i < 
aNumOfFûãrP©ã∫s
 ; i ++ )

6283 
	`°rˇt
–
lDülogSåög
 , 
aFûãrP©ã∫s
 [
i
] ) ;

6284 
	`°rˇt
–
lDülogSåög
 , " " ) ;

6286 i‡–
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) )

6288 
	`°rˇt
–
lDülogSåög
 , " | " ) ;

6289 
	`°rˇt
–
lDülogSåög
 , 
aSögÀFûãrDes¸ùti⁄
 ) ;

6291 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

6293 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6295 
	`°rˇt
(
lDülogSåög
, " --title \"") ;

6296 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6297 
	`°rˇt
(
lDülogSåög
, "\"") ;

6300 i‡–
	`zíôyPª£¡
(Ë|| 
	`m©edülogPª£¡
(Ë|| 
	`shñÀmíèryPª£¡
(Ë|| 
	`q¨maPª£¡
() )

6302 i‡–
	`zíôyPª£¡
() )

6304 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"zenity"); (*)1;}

6305 
	`°r˝y
–
lDülogSåög
 , "zenity" ) ;

6306 i‡–(
	`zíôy3Pª£¡
(Ë>4Ë&& !
	`gëív
("SSH_TTY") )

6308 
	`°rˇt
–
lDülogSåög
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6311 i‡–
	`m©edülogPª£¡
() )

6313 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"matedialog"); (*)1;}

6314 
	`°r˝y
–
lDülogSåög
 , "matedialog" ) ;

6316 i‡–
	`shñÀmíèryPª£¡
() )

6318 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"shellementary"); (*)1;}

6319 
	`°r˝y
–
lDülogSåög
 , "shellementary" ) ;

6323 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"qarma"); (*)1;}

6324 
	`°r˝y
–
lDülogSåög
 , "qarma" ) ;

6325 i‡–!
	`gëív
("SSH_TTY") )

6327 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6330 
	`°rˇt
(
lDülogSåög
, " --file-selection --save --confirm-overwrite" ) ;

6332 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6334 
	`°rˇt
(
lDülogSåög
, " --title=\"") ;

6335 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6336 
	`°rˇt
(
lDülogSåög
, "\"") ;

6338 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

6340 
	`°rˇt
(
lDülogSåög
, " --filename=\"") ;

6341 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©hAndFûe
) ;

6342 
	`°rˇt
(
lDülogSåög
, "\"") ;

6344 i‡–
aNumOfFûãrP©ã∫s
 > 0 )

6346 
	`°rˇt
–
lDülogSåög
 , " --file-filter='" ) ;

6347 i‡–
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) )

6349 
	`°rˇt
–
lDülogSåög
 , 
aSögÀFûãrDes¸ùti⁄
 ) ;

6350 
	`°rˇt
–
lDülogSåög
 , " | " ) ;

6352  
i
 = 0 ; i < 
aNumOfFûãrP©ã∫s
 ; i ++ )

6354 
	`°rˇt
–
lDülogSåög
 , 
aFûãrP©ã∫s
 [
i
] ) ;

6355 
	`°rˇt
–
lDülogSåög
 , " " ) ;

6357 
	`°rˇt
–
lDülogSåög
 , "' --file-filter='All files | *'" ) ;

6359 i‡(
töyfd_sûít
Ë
	`°rˇt
–
lDülogSåög
 , " 2>/dev/null ");

6361 i‡–!
	`xdülogPª£¡
(Ë&& 
	`tköãr3Pª£¡
( ) )

6363 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python3-tkinter"); (*)1;}

6364 
	`°r˝y
–
lDülogSåög
 , 
gPyth⁄3Name
 ) ;

6365 
	`°rˇt
–
lDülogSåög
 ,

6367 
	`°rˇt
–
lDülogSåög
 , "res=filedialog.asksaveasfilename(");

6368 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6370 
	`°rˇt
(
lDülogSåög
, "title='") ;

6371 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6372 
	`°rˇt
(
lDülogSåög
, "',") ;

6374 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

6376 
	`gëP©hWôhoutFöÆSœsh
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6377 i‡–
	`°æí
(
lSåög
) )

6379 
	`°rˇt
(
lDülogSåög
, "initialdir='") ;

6380 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6381 
	`°rˇt
(
lDülogSåög
 , "'," ) ;

6383 
	`gëLa°Name
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6384 i‡–
	`°æí
(
lSåög
) )

6386 
	`°rˇt
(
lDülogSåög
, "initialfile='") ;

6387 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6388 
	`°rˇt
(
lDülogSåög
 , "'," ) ;

6391 i‡––
aNumOfFûãrP©ã∫s
 > 1 )

6392 || ( (
aNumOfFûãrP©ã∫s
 == 1)

6393 && ( 
aFûãrP©ã∫s
[0][
	`°æí
(aFilterPatterns[0])-1] != '*' ) ) )

6395 
	`°rˇt
(
lDülogSåög
 , "filetypes=(" ) ;

6396 
	`°rˇt
–
lDülogSåög
 , "('" ) ;

6397 i‡–
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) )

6399 
	`°rˇt
–
lDülogSåög
 , 
aSögÀFûãrDes¸ùti⁄
 ) ;

6401 
	`°rˇt
–
lDülogSåög
 , "',(" ) ;

6402  
i
 = 0 ; i < 
aNumOfFûãrP©ã∫s
 ; i ++ )

6404 
	`°rˇt
–
lDülogSåög
 , "'" ) ;

6405 
	`°rˇt
–
lDülogSåög
 , 
aFûãrP©ã∫s
 [
i
] ) ;

6406 
	`°rˇt
–
lDülogSåög
 , "'," ) ;

6408 
	`°rˇt
–
lDülogSåög
 , "))," ) ;

6409 
	`°rˇt
–
lDülogSåög
 , "('All files','*'))" ) ;

6411 
	`°rˇt
–
lDülogSåög
, ");\nifÇot isinstance(res,Åuple):\n\tprint(res)\n\"" ) ;

6413 i‡–!
	`xdülogPª£¡
(Ë&& 
	`tköãr2Pª£¡
( ) )

6415 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python2-tkinter"); (*)1;}

6416 
	`°r˝y
–
lDülogSåög
 , "export PYTHONIOENCODING=utf-8;" ) ;

6417 
	`°rˇt
–
lDülogSåög
 , 
gPyth⁄2Name
 ) ;

6418 i‡–! 
	`isTîmöÆRu¬ög
–Ë&& 
	`isD¨wö
( ))

6420 
	`°rˇt
–
lDülogSåög
 , " -i" ) ;

6422 
	`°rˇt
–
lDülogSåög
 ,

6425 i‡–
	`isD¨wö
( ) )

6427 
	`°rˇt
–
lDülogSåög
 ,

6432 
	`°rˇt
–
lDülogSåög
 , "res=tkFileDialog.asksaveasfilename(");

6433 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6435 
	`°rˇt
(
lDülogSåög
, "title='") ;

6436 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6437 
	`°rˇt
(
lDülogSåög
, "',") ;

6439 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

6441 
	`gëP©hWôhoutFöÆSœsh
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6442 i‡–
	`°æí
(
lSåög
) )

6444 
	`°rˇt
(
lDülogSåög
, "initialdir='") ;

6445 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6446 
	`°rˇt
(
lDülogSåög
 , "'," ) ;

6448 
	`gëLa°Name
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6449 i‡–
	`°æí
(
lSåög
) )

6451 
	`°rˇt
(
lDülogSåög
, "initialfile='") ;

6452 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6453 
	`°rˇt
(
lDülogSåög
 , "'," ) ;

6456 i‡––
aNumOfFûãrP©ã∫s
 > 1 )

6457 || ( (
aNumOfFûãrP©ã∫s
 == 1)

6458 && ( 
aFûãrP©ã∫s
[0][
	`°æí
(aFilterPatterns[0])-1] != '*' ) ) )

6460 
	`°rˇt
(
lDülogSåög
 , "filetypes=(" ) ;

6461 
	`°rˇt
–
lDülogSåög
 , "('" ) ;

6462 i‡–
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) )

6464 
	`°rˇt
–
lDülogSåög
 , 
aSögÀFûãrDes¸ùti⁄
 ) ;

6466 
	`°rˇt
–
lDülogSåög
 , "',(" ) ;

6467  
i
 = 0 ; i < 
aNumOfFûãrP©ã∫s
 ; i ++ )

6469 
	`°rˇt
–
lDülogSåög
 , "'" ) ;

6470 
	`°rˇt
–
lDülogSåög
 , 
aFûãrP©ã∫s
 [
i
] ) ;

6471 
	`°rˇt
–
lDülogSåög
 , "'," ) ;

6473 
	`°rˇt
–
lDülogSåög
 , "))," ) ;

6474 
	`°rˇt
–
lDülogSåög
 , "('All files','*'))" ) ;

6476 
	`°rˇt
–
lDülogSåög
, ");\nifÇot isinstance(res,Åuple):\n\tprintÑes \n\"" ) ;

6478 i‡–
	`xdülogPª£¡
(Ë|| 
	`dülogName
() )

6480 i‡–
	`xdülogPª£¡
( ) )

6482 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"xdialog"); (*)1;}

6483 
lWasGøphicDülog
 = 1 ;

6484 
	`°r˝y
–
lDülogSåög
 , "(Xdialog " ) ;

6486 i‡–
	`isTîmöÆRu¬ög
( ) )

6488 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"dialog"); (*)0;}

6489 
	`°r˝y
–
lDülogSåög
 , "(dialog " ) ;

6493 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"dialog"); (*)0;}

6494 
lWasXãrm
 = 1 ;

6495 
	`°r˝y
–
lDülogSåög
 , 
	`ãrmöÆName
() ) ;

6496 
	`°rˇt
–
lDülogSåög
 , "'(" ) ;

6497 
	`°rˇt
–
lDülogSåög
 , 
	`dülogName
() ) ;

6498 
	`°rˇt
–
lDülogSåög
 , " " ) ;

6501 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6503 
	`°rˇt
(
lDülogSåög
, "--title \"") ;

6504 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6505 
	`°rˇt
(
lDülogSåög
, "\" ") ;

6508 i‡–!
	`xdülogPª£¡
(Ë&& !
	`gdülogPª£¡
() )

6510 
	`°rˇt
(
lDülogSåög
, "--backtitle \"") ;

6511 
	`°rˇt
(
lDülogSåög
,

6513 
	`°rˇt
(
lDülogSåög
, "\" ") ;

6516 
	`°rˇt
–
lDülogSåög
 , "--fselect \"" ) ;

6517 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

6519 i‡–! 
	`°rchr
(
aDeÁu…P©hAndFûe
, '/') )

6521 
	`°rˇt
(
lDülogSåög
, "./") ;

6523 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©hAndFûe
) ;

6525 i‡–! 
	`isTîmöÆRu¬ög
–Ë&& !
lWasGøphicDülog
 )

6527 
	`°rˇt
(
lDülogSåög
, 
	`gëív
("HOME")) ;

6528 
	`°rˇt
(
lDülogSåög
, "/") ;

6532 
	`°rˇt
(
lDülogSåög
, "./") ;

6535 i‡–
lWasGøphicDülog
 )

6537 
	`°rˇt
(
lDülogSåög
, "\" 0 60 ) 2>&1 ") ;

6541 
	`°rˇt
(
lDülogSåög
, "\" 0 60 >/dev/tty) ") ;

6542 i‡–
lWasXãrm
 )

6544 
	`°rˇt
–
lDülogSåög
 ,

6549 
	`°rˇt
(
lDülogSåög
, "2>&1 ; clear >/dev/tty") ;

6555 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){ 
	`töyfd_öputBox
◊TôÀ,
NULL
,NULL);}

6556 
	`°r˝y
(
lBuff
, "Save file in ");

6557 
	`°rˇt
(
lBuff
, 
	`gëCurDú
());

6558 
lPoöãrI≈utBox
 = 
	`töyfd_öputBox
(
NULL
, NULL, NULL);

6559 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
(
lSåög
,ÜPointerInputBox);

6560 
p
 = 
	`töyfd_öputBox
(
aTôÀ
, 
lBuff
, "");

6561 i‡(
p
Ë
	`°r˝y
(
lBuff
,Ö); lBuff[0] = '\0';

6562 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
÷PoöãrI≈utBox, 
lSåög
);

6563 
p
 = 
lBuff
;

6565 
	`gëP©hWôhoutFöÆSœsh
–
lSåög
 , 
p
 ) ;

6566 i‡–
	`°æí
–
lSåög
 ) && ! 
	`dúExi°s
(ÜString ) )

6568  
NULL
 ;

6570 
	`gëLa°Name
(
lSåög
,
p
);

6571 i‡–! 
	`°æí
(
lSåög
) )

6573  
NULL
;

6575  
p
 ;

6578 i‡(
töyfd_vîbo£
Ë
	`¥ötf
–"lDülogSåög: %s\n" , 
lDülogSåög
 ) ;

6579 i‡–! ( 
lIn
 = 
	`p›í
–
lDülogSåög
 , "r" ) ) )

6581  
NULL
 ;

6583  
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

6585 
	`p˛o£
–
lIn
 ) ;

6586 i‡–
lBuff
[
	`°æí
(ÜBuff ) -1] == '\n' )

6588 
lBuff
[
	`°æí
(ÜBuff ) -1] = '\0' ;

6591 i‡–! 
	`°æí
(
lBuff
) )

6593  
NULL
;

6595 
	`gëP©hWôhoutFöÆSœsh
–
lSåög
 , 
lBuff
 ) ;

6596 i‡–
	`°æí
–
lSåög
 ) && ! 
	`dúExi°s
(ÜString ) )

6598  
NULL
 ;

6600 
	`gëLa°Name
(
lSåög
,
lBuff
);

6601 i‡–! 
	`fûíameVÆid
(
lSåög
) )

6603  
NULL
;

6605  
lBuff
 ;

6606 
	}
}

6610 * 
	$töyfd_›íFûeDülog
(

6611 c⁄° * 
aTôÀ
 ,

6612 c⁄° * 
aDeÁu…P©hAndFûe
 ,

6613 
aNumOfFûãrP©ã∫s
 ,

6614 c⁄° * c⁄° * 
aFûãrP©ã∫s
 ,

6615 c⁄° * 
aSögÀFûãrDes¸ùti⁄
 ,

6616 
aAŒowMu…ùÀSñe˘s
 )

6618 
lDülogSåög
 [
MAX_PATH_OR_CMD
] ;

6619 
lSåög
 [
MAX_PATH_OR_CMD
] ;

6620 
i
 ;

6621 
FILE
 * 
lIn
 ;

6622 * 
p
 ;

6623 * 
p2
 ;

6624 * 
lPoöãrI≈utBox
 ;

6625 
lWasKdülog
 = 0 ;

6626 
lWasGøphicDülog
 = 0 ;

6627 
lWasXãrm
 = 0 ;

6628 
size_t
 
lFuŒBuffLí
 ;

6629 * 
lBuff
 = 
NULL
;

6631 
	`‰ì
(
lBuff
);

6632 i‡(
aTôÀ
&&!
	`°rcmp
(aTitle,"tinyfd_query"))

6634 
lBuff
 = 
NULL
;

6638 i‡(
aAŒowMu…ùÀSñe˘s
)

6640 
lFuŒBuffLí
 = 
MAX_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

6641 
lBuff
 = (*)(
	`mÆloc
(
lFuŒBuffLí
 * ()));

6642 i‡(!
lBuff
)

6644 
lFuŒBuffLí
 = 
LOW_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

6645 
lBuff
 = (*)–
	`mÆloc
–
lFuŒBuffLí
 * ()));

6650 
lFuŒBuffLí
 = 
MAX_PATH_OR_CMD
 + 1;

6651 
lBuff
 = (*)(
	`mÆloc
(
lFuŒBuffLí
 * ()));

6653 i‡(!
lBuff
Ë 
NULL
;

6654 
lBuff
[0]='\0';

6657 i‡–
	`oßs¸ùtPª£¡
( ) )

6659 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"applescript"); (*)1;}

6660 
	`°r˝y
–
lDülogSåög
 , "osascript ");

6661 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
 , " -e 'tellápplication \"System Events\"' -e 'Activate'");

6662 
	`°rˇt
–
lDülogSåög
 , " -e 'try' -e '" );

6663 i‡–! 
aAŒowMu…ùÀSñe˘s
 )

6667 
	`°rˇt
–
lDülogSåög
 , "POSIXÖath of ( " );

6671 
	`°rˇt
–
lDülogSåög
 , "set mylistÅo " );

6673 
	`°rˇt
–
lDülogSåög
 , "choose file " );

6674 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6676 
	`°rˇt
(
lDülogSåög
, "withÖrompt \"") ;

6677 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6678 
	`°rˇt
(
lDülogSåög
, "\" ") ;

6680 
	`gëP©hWôhoutFöÆSœsh
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6681 i‡–
	`°æí
(
lSåög
) )

6683 
	`°rˇt
(
lDülogSåög
, "defaultÜocation \"") ;

6684 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6685 
	`°rˇt
(
lDülogSåög
 , "\" " ) ;

6687 i‡–
aNumOfFûãrP©ã∫s
 > 0 )

6689 
	`°rˇt
(
lDülogSåög
 , "ofÅype {\"" );

6690 
	`°rˇt
–
lDülogSåög
 , 
aFûãrP©ã∫s
 [0] + 2 ) ;

6691 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

6692  
i
 = 1 ; i < 
aNumOfFûãrP©ã∫s
 ; i ++ )

6694 
	`°rˇt
–
lDülogSåög
 , ",\"" ) ;

6695 
	`°rˇt
–
lDülogSåög
 , 
aFûãrP©ã∫s
 [
i
] + 2) ;

6696 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

6698 
	`°rˇt
–
lDülogSåög
 , "} " ) ;

6700 i‡–
aAŒowMu…ùÀSñe˘s
 )

6702 
	`°rˇt
–
lDülogSåög
 , "multiple selectionsállowedÅrue ' " ) ;

6703 
	`°rˇt
–
lDülogSåög
 ,

6705 
	`°rˇt
–
lDülogSåög
 ,

6707 
	`°rˇt
–
lDülogSåög
 , "-e 'set mystringÅo mystring & \"|\"' " );

6708 
	`°rˇt
–
lDülogSåög
 ,

6710 
	`°rˇt
–
lDülogSåög
 , "-e 'endÑepeat' " );

6711 
	`°rˇt
–
lDülogSåög
 , "-e 'mystring' " );

6715 
	`°rˇt
–
lDülogSåög
 , ")' " ) ;

6717 
	`°rˇt
(
lDülogSåög
, "-e 'onÉrrorÇumber -128' " ) ;

6718 
	`°rˇt
(
lDülogSåög
, "-e 'endÅry'") ;

6719 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
, " -e 'endÅell'") ;

6721 i‡–
	`kdülogPª£¡
() )

6723 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"kdialog"); (*)1;}

6724 
lWasKdülog
 = 1 ;

6726 
	`°r˝y
–
lDülogSåög
 , "kdialog" ) ;

6727 i‡–
	`kdülogPª£¡
() == 2 )

6729 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6731 
	`°rˇt
–
lDülogSåög
 , " --getopenfilename " ) ;

6733 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

6735 i‡–
aDeÁu…P©hAndFûe
[0] != '/' )

6737 
	`°rˇt
(
lDülogSåög
, "$PWD/") ;

6739 
	`°rˇt
(
lDülogSåög
, "\"") ;

6740 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©hAndFûe
 ) ;

6741 
	`°rˇt
(
lDülogSåög
 , "\"" ) ;

6745 
	`°rˇt
(
lDülogSåög
, "$PWD/") ;

6748 i‡–
aNumOfFûãrP©ã∫s
 > 0 )

6750 
	`°rˇt
(
lDülogSåög
 , " \"" ) ;

6751  
i
 = 0 ; i < 
aNumOfFûãrP©ã∫s
 ; i ++ )

6753 
	`°rˇt
–
lDülogSåög
 , 
aFûãrP©ã∫s
 [
i
] ) ;

6754 
	`°rˇt
–
lDülogSåög
 , " " ) ;

6756 i‡–
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) )

6758 
	`°rˇt
–
lDülogSåög
 , " | " ) ;

6759 
	`°rˇt
–
lDülogSåög
 , 
aSögÀFûãrDes¸ùti⁄
 ) ;

6761 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

6763 i‡–
aAŒowMu…ùÀSñe˘s
 )

6765 
	`°rˇt
–
lDülogSåög
 , " --multiple --separate-output" ) ;

6767 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6769 
	`°rˇt
(
lDülogSåög
, " --title \"") ;

6770 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6771 
	`°rˇt
(
lDülogSåög
, "\"") ;

6774 i‡–
	`zíôyPª£¡
(Ë|| 
	`m©edülogPª£¡
(Ë|| 
	`shñÀmíèryPª£¡
(Ë|| 
	`q¨maPª£¡
() )

6776 i‡–
	`zíôyPª£¡
() )

6778 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"zenity"); (*)1;}

6779 
	`°r˝y
–
lDülogSåög
 , "zenity" ) ;

6780 i‡–(
	`zíôy3Pª£¡
(Ë>4Ë&& !
	`gëív
("SSH_TTY") )

6782 
	`°rˇt
–
lDülogSåög
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6785 i‡–
	`m©edülogPª£¡
() )

6787 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"matedialog"); (*)1;}

6788 
	`°r˝y
–
lDülogSåög
 , "matedialog" ) ;

6790 i‡–
	`shñÀmíèryPª£¡
() )

6792 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"shellementary"); (*)1;}

6793 
	`°r˝y
–
lDülogSåög
 , "shellementary" ) ;

6797 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"qarma"); (*)1;}

6798 
	`°r˝y
–
lDülogSåög
 , "qarma" ) ;

6799 i‡–!
	`gëív
("SSH_TTY") )

6801 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6804 
	`°rˇt
–
lDülogSåög
 , " --file-selection" ) ;

6806 i‡–
aAŒowMu…ùÀSñe˘s
 )

6808 
	`°rˇt
–
lDülogSåög
 , " --multiple" ) ;

6810 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6812 
	`°rˇt
(
lDülogSåög
, " --title=\"") ;

6813 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6814 
	`°rˇt
(
lDülogSåög
, "\"") ;

6816 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

6818 
	`°rˇt
(
lDülogSåög
, " --filename=\"") ;

6819 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©hAndFûe
) ;

6820 
	`°rˇt
(
lDülogSåög
, "\"") ;

6822 i‡–
aNumOfFûãrP©ã∫s
 > 0 )

6824 
	`°rˇt
–
lDülogSåög
 , " --file-filter='" ) ;

6825 i‡–
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) )

6827 
	`°rˇt
–
lDülogSåög
 , 
aSögÀFûãrDes¸ùti⁄
 ) ;

6828 
	`°rˇt
–
lDülogSåög
 , " | " ) ;

6830  
i
 = 0 ; i < 
aNumOfFûãrP©ã∫s
 ; i ++ )

6832 
	`°rˇt
–
lDülogSåög
 , 
aFûãrP©ã∫s
 [
i
] ) ;

6833 
	`°rˇt
–
lDülogSåög
 , " " ) ;

6835 
	`°rˇt
–
lDülogSåög
 , "' --file-filter='All files | *'" ) ;

6837 i‡(
töyfd_sûít
Ë
	`°rˇt
–
lDülogSåög
 , " 2>/dev/null ");

6839 i‡–
	`tköãr3Pª£¡
( ) )

6841 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python3-tkinter"); (*)1;}

6842 
	`°r˝y
–
lDülogSåög
 , 
gPyth⁄3Name
 ) ;

6843 
	`°rˇt
–
lDülogSåög
 ,

6845 
	`°rˇt
–
lDülogSåög
 , "lFiles=filedialog.askopenfilename(");

6846 i‡–
aAŒowMu…ùÀSñe˘s
 )

6848 
	`°rˇt
–
lDülogSåög
 , "multiple=1," ) ;

6850 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6852 
	`°rˇt
(
lDülogSåög
, "title='") ;

6853 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6854 
	`°rˇt
(
lDülogSåög
, "',") ;

6856 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

6858 
	`gëP©hWôhoutFöÆSœsh
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6859 i‡–
	`°æí
(
lSåög
) )

6861 
	`°rˇt
(
lDülogSåög
, "initialdir='") ;

6862 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6863 
	`°rˇt
(
lDülogSåög
 , "'," ) ;

6865 
	`gëLa°Name
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6866 i‡–
	`°æí
(
lSåög
) )

6868 
	`°rˇt
(
lDülogSåög
, "initialfile='") ;

6869 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6870 
	`°rˇt
(
lDülogSåög
 , "'," ) ;

6873 i‡––
aNumOfFûãrP©ã∫s
 > 1 )

6874 || ( ( 
aNumOfFûãrP©ã∫s
 == 1 )

6875 && ( 
aFûãrP©ã∫s
[0][
	`°æí
(aFilterPatterns[0])-1] != '*' ) ) )

6877 
	`°rˇt
(
lDülogSåög
 , "filetypes=(" ) ;

6878 
	`°rˇt
–
lDülogSåög
 , "('" ) ;

6879 i‡–
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) )

6881 
	`°rˇt
–
lDülogSåög
 , 
aSögÀFûãrDes¸ùti⁄
 ) ;

6883 
	`°rˇt
–
lDülogSåög
 , "',(" ) ;

6884  
i
 = 0 ; i < 
aNumOfFûãrP©ã∫s
 ; i ++ )

6886 
	`°rˇt
–
lDülogSåög
 , "'" ) ;

6887 
	`°rˇt
–
lDülogSåög
 , 
aFûãrP©ã∫s
 [
i
] ) ;

6888 
	`°rˇt
–
lDülogSåög
 , "'," ) ;

6890 
	`°rˇt
–
lDülogSåög
 , "))," ) ;

6891 
	`°rˇt
–
lDülogSåög
 , "('All files','*'))" ) ;

6893 
	`°rˇt
–
lDülogSåög
 , ");\
\nifÇot isinstance(lFiles,Åuple):\n\tprint(lFiles)\nelse:\
\n\tlFilesString=''\n\tforÜFile inÜFiles:\n\t\tlFilesString+=str(lFile)+'|'\
\n\tprint(lFilesString[:-1])\n\"" ) ;

6898 i‡–
	`tköãr2Pª£¡
( ) )

6900 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python2-tkinter"); (*)1;}

6901 
	`°r˝y
–
lDülogSåög
 , "export PYTHONIOENCODING=utf-8;" ) ;

6902 
	`°rˇt
–
lDülogSåög
 , 
gPyth⁄2Name
 ) ;

6903 i‡–! 
	`isTîmöÆRu¬ög
–Ë&& 
	`isD¨wö
( ) )

6905 
	`°rˇt
–
lDülogSåög
 , " -i" ) ;

6907 
	`°rˇt
–
lDülogSåög
 ,

6910 i‡–
	`isD¨wö
( ) )

6912 
	`°rˇt
–
lDülogSåög
 ,

6916 
	`°rˇt
–
lDülogSåög
 , "lFiles=tkFileDialog.askopenfilename(");

6917 i‡–
aAŒowMu…ùÀSñe˘s
 )

6919 
	`°rˇt
–
lDülogSåög
 , "multiple=1," ) ;

6921 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6923 
	`°rˇt
(
lDülogSåög
, "title='") ;

6924 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6925 
	`°rˇt
(
lDülogSåög
, "',") ;

6927 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

6929 
	`gëP©hWôhoutFöÆSœsh
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6930 i‡–
	`°æí
(
lSåög
) )

6932 
	`°rˇt
(
lDülogSåög
, "initialdir='") ;

6933 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6934 
	`°rˇt
(
lDülogSåög
 , "'," ) ;

6936 
	`gëLa°Name
–
lSåög
 , 
aDeÁu…P©hAndFûe
 ) ;

6937 i‡–
	`°æí
(
lSåög
) )

6939 
	`°rˇt
(
lDülogSåög
, "initialfile='") ;

6940 
	`°rˇt
(
lDülogSåög
, 
lSåög
 ) ;

6941 
	`°rˇt
(
lDülogSåög
 , "'," ) ;

6944 i‡––
aNumOfFûãrP©ã∫s
 > 1 )

6945 || ( ( 
aNumOfFûãrP©ã∫s
 == 1 )

6946 && ( 
aFûãrP©ã∫s
[0][
	`°æí
(aFilterPatterns[0])-1] != '*' ) ) )

6948 
	`°rˇt
(
lDülogSåög
 , "filetypes=(" ) ;

6949 
	`°rˇt
–
lDülogSåög
 , "('" ) ;

6950 i‡–
aSögÀFûãrDes¸ùti⁄
 && 
	`°æí
(aSingleFilterDescription) )

6952 
	`°rˇt
–
lDülogSåög
 , 
aSögÀFûãrDes¸ùti⁄
 ) ;

6954 
	`°rˇt
–
lDülogSåög
 , "',(" ) ;

6955  
i
 = 0 ; i < 
aNumOfFûãrP©ã∫s
 ; i ++ )

6957 
	`°rˇt
–
lDülogSåög
 , "'" ) ;

6958 
	`°rˇt
–
lDülogSåög
 , 
aFûãrP©ã∫s
 [
i
] ) ;

6959 
	`°rˇt
–
lDülogSåög
 , "'," ) ;

6961 
	`°rˇt
–
lDülogSåög
 , "))," ) ;

6962 
	`°rˇt
–
lDülogSåög
 , "('All files','*'))" ) ;

6964 
	`°rˇt
–
lDülogSåög
 , ");\
\nifÇot isinstance(lFiles,Åuple):\n\tprintÜFiles\nelse:\
\n\tlFilesString=''\n\tforÜFile inÜFiles:\n\t\tlFilesString+=str(lFile)+'|'\
\n\tprintÜFilesString[:-1]\n\"" ) ;

6969 i‡–
	`xdülogPª£¡
(Ë|| 
	`dülogName
() )

6971 i‡–
	`xdülogPª£¡
( ) )

6973 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"xdialog"); (*)1;}

6974 
lWasGøphicDülog
 = 1 ;

6975 
	`°r˝y
–
lDülogSåög
 , "(Xdialog " ) ;

6977 i‡–
	`isTîmöÆRu¬ög
( ) )

6979 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"dialog"); (*)0;}

6980 
	`°r˝y
–
lDülogSåög
 , "(dialog " ) ;

6984 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"dialog"); (*)0;}

6985 
lWasXãrm
 = 1 ;

6986 
	`°r˝y
–
lDülogSåög
 , 
	`ãrmöÆName
() ) ;

6987 
	`°rˇt
–
lDülogSåög
 , "'(" ) ;

6988 
	`°rˇt
–
lDülogSåög
 , 
	`dülogName
() ) ;

6989 
	`°rˇt
–
lDülogSåög
 , " " ) ;

6992 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

6994 
	`°rˇt
(
lDülogSåög
, "--title \"") ;

6995 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

6996 
	`°rˇt
(
lDülogSåög
, "\" ") ;

6999 i‡–!
	`xdülogPª£¡
(Ë&& !
	`gdülogPª£¡
() )

7001 
	`°rˇt
(
lDülogSåög
, "--backtitle \"") ;

7002 
	`°rˇt
(
lDülogSåög
,

7004 
	`°rˇt
(
lDülogSåög
, "\" ") ;

7007 
	`°rˇt
–
lDülogSåög
 , "--fselect \"" ) ;

7008 i‡–
aDeÁu…P©hAndFûe
 && 
	`°æí
(aDefaultPathAndFile) )

7010 i‡–! 
	`°rchr
(
aDeÁu…P©hAndFûe
, '/') )

7012 
	`°rˇt
(
lDülogSåög
, "./") ;

7014 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©hAndFûe
) ;

7016 i‡–! 
	`isTîmöÆRu¬ög
–Ë&& !
lWasGøphicDülog
 )

7018 
	`°rˇt
(
lDülogSåög
, 
	`gëív
("HOME")) ;

7019 
	`°rˇt
(
lDülogSåög
, "/");

7023 
	`°rˇt
(
lDülogSåög
, "./") ;

7026 i‡–
lWasGøphicDülog
 )

7028 
	`°rˇt
(
lDülogSåög
, "\" 0 60 ) 2>&1 ") ;

7032 
	`°rˇt
(
lDülogSåög
, "\" 0 60 >/dev/tty) ") ;

7033 i‡–
lWasXãrm
 )

7035 
	`°rˇt
–
lDülogSåög
 ,

7040 
	`°rˇt
(
lDülogSåög
, "2>&1 ; clear >/dev/tty") ;

7046 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){ 
	`töyfd_öputBox
◊TôÀ,
NULL
,NULL);}

7047 
	`°r˝y
(
lBuff
, "Open file from ");

7048 
	`°rˇt
(
lBuff
, 
	`gëCurDú
());

7049 
lPoöãrI≈utBox
 = 
	`töyfd_öputBox
(
NULL
, NULL, NULL);

7050 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
(
lDülogSåög
,ÜPointerInputBox);

7051 
p2
 = 
	`töyfd_öputBox
(
aTôÀ
, 
lBuff
, "");

7052 i‡(
p2
Ë
	`°r˝y
(
lBuff
,Ö2); lBuff[0] = '\0';

7053 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
÷PoöãrI≈utBox, 
lDülogSåög
);

7054 
p2
 = 
lBuff
;

7056 i‡–! 
	`fûeExi°s
(
p2
) )

7058 
	`‰ì
(
lBuff
);

7059 
lBuff
 = 
NULL
;

7063 
	`°r˝y
(
lBuff
, 
p2
);

7064 
lBuff
 = (*)–
	`ªÆloc
–lBuff, (
	`°æí
(lBuff)+1) * ()));

7066  
lBuff
 ;

7069 i‡(
töyfd_vîbo£
Ë
	`¥ötf
–"lDülogSåög: %s\n" , 
lDülogSåög
 ) ;

7070 i‡–! ( 
lIn
 = 
	`p›í
–
lDülogSåög
 , "r" ) ) )

7072 
	`‰ì
(
lBuff
);

7073 
lBuff
 = 
NULL
;

7074  
NULL
 ;

7076 
lBuff
[0]='\0';

7077 
p
=
lBuff
;

7078  
	`fgës
–
p
 , –
lBuff
 ) , 
lIn
 ) !
NULL
 )

7080 
p
 +
	`°æí
(Ö );

7082 
	`p˛o£
–
lIn
 ) ;

7083 i‡–
lBuff
[
	`°æí
(ÜBuff ) -1] == '\n' )

7085 
lBuff
[
	`°æí
(ÜBuff ) -1] = '\0' ;

7088 i‡–
lWasKdülog
 && 
aAŒowMu…ùÀSñe˘s
 )

7090 
p
 = 
lBuff
 ;

7091  ( 
p
 = 
	`°rchr
(Ö , '\n' ) ) )

7092 * 
p
 = '|' ;

7095 i‡–! 
	`°æí
–
lBuff
 ) )

7097 
	`‰ì
(
lBuff
);

7098 
lBuff
 = 
NULL
;

7099  
NULL
;

7101 i‡–
aAŒowMu…ùÀSñe˘s
 && 
	`°rchr
(
lBuff
, '|') )

7103 if–! 
	`ísuªFûesExi°
–
lBuff
 ,ÜBuff ) )

7105 
	`‰ì
(
lBuff
);

7106 
lBuff
 = 
NULL
;

7107  
NULL
;

7110 i‡–!
	`fûeExi°s
(
lBuff
) )

7112 
	`‰ì
(
lBuff
);

7113 
lBuff
 = 
NULL
;

7114  
NULL
;

7117 
lBuff
 = (*)–
	`ªÆloc
–lBuff, (
	`°æí
(lBuff)+1) * ()));

7120  
lBuff
 ;

7121 
	}
}

7124 * 
	$töyfd_£À˘FﬁdîDülog
(

7125 c⁄° * 
aTôÀ
 ,

7126 c⁄° * 
aDeÁu…P©h
 )

7128 
lBuff
 [
MAX_PATH_OR_CMD
] ;

7129 
lDülogSåög
 [
MAX_PATH_OR_CMD
] ;

7130 
FILE
 * 
lIn
 ;

7131 * 
p
 ;

7132 * 
lPoöãrI≈utBox
 ;

7133 
lWasGøphicDülog
 = 0 ;

7134 
lWasXãrm
 = 0 ;

7135 
lBuff
[0]='\0';

7137 i‡–
	`oßs¸ùtPª£¡
( ))

7139 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"applescript"); (*)1;}

7140 
	`°r˝y
–
lDülogSåög
 , "osascript ");

7141 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
 , " -e 'tellápplication \"System Events\"' -e 'Activate'");

7142 
	`°rˇt
–
lDülogSåög
 , " -e 'try' -e 'POSIXÖath of ( choose folder ");

7143 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7145 
	`°rˇt
(
lDülogSåög
, "withÖrompt \"") ;

7146 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7147 
	`°rˇt
(
lDülogSåög
, "\" ") ;

7149 i‡–
aDeÁu…P©h
 && 
	`°æí
(aDefaultPath) )

7151 
	`°rˇt
(
lDülogSåög
, "defaultÜocation \"") ;

7152 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©h
 ) ;

7153 
	`°rˇt
(
lDülogSåög
 , "\" " ) ;

7155 
	`°rˇt
–
lDülogSåög
 , ")' " ) ;

7156 
	`°rˇt
(
lDülogSåög
, "-e 'onÉrrorÇumber -128' " ) ;

7157 
	`°rˇt
(
lDülogSåög
, "-e 'endÅry'") ;

7158 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
, " -e 'endÅell'") ;

7160 i‡–
	`kdülogPª£¡
() )

7162 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"kdialog"); (*)1;}

7163 
	`°r˝y
–
lDülogSåög
 , "kdialog" ) ;

7164 i‡–
	`kdülogPª£¡
() == 2 )

7166 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7168 
	`°rˇt
–
lDülogSåög
 , " --getexistingdirectory " ) ;

7170 i‡–
aDeÁu…P©h
 && 
	`°æí
(aDefaultPath) )

7172 i‡–
aDeÁu…P©h
[0] != '/' )

7174 
	`°rˇt
(
lDülogSåög
, "$PWD/") ;

7176 
	`°rˇt
(
lDülogSåög
, "\"") ;

7177 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©h
 ) ;

7178 
	`°rˇt
(
lDülogSåög
 , "\"" ) ;

7182 
	`°rˇt
(
lDülogSåög
, "$PWD/") ;

7185 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7187 
	`°rˇt
(
lDülogSåög
, " --title \"") ;

7188 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7189 
	`°rˇt
(
lDülogSåög
, "\"") ;

7192 i‡–
	`zíôyPª£¡
(Ë|| 
	`m©edülogPª£¡
(Ë|| 
	`shñÀmíèryPª£¡
(Ë|| 
	`q¨maPª£¡
() )

7194 i‡–
	`zíôyPª£¡
() )

7196 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"zenity"); (*)1;}

7197 
	`°r˝y
–
lDülogSåög
 , "zenity" ) ;

7198 i‡–(
	`zíôy3Pª£¡
(Ë>4Ë&& !
	`gëív
("SSH_TTY") )

7200 
	`°rˇt
–
lDülogSåög
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7203 i‡–
	`m©edülogPª£¡
() )

7205 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"matedialog"); (*)1;}

7206 
	`°r˝y
–
lDülogSåög
 , "matedialog" ) ;

7208 i‡–
	`shñÀmíèryPª£¡
() )

7210 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"shellementary"); (*)1;}

7211 
	`°r˝y
–
lDülogSåög
 , "shellementary" ) ;

7215 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"qarma"); (*)1;}

7216 
	`°r˝y
–
lDülogSåög
 , "qarma" ) ;

7217 i‡–!
	`gëív
("SSH_TTY") )

7219 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7222 
	`°rˇt
–
lDülogSåög
 , " --file-selection --directory" ) ;

7224 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7226 
	`°rˇt
(
lDülogSåög
, " --title=\"") ;

7227 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7228 
	`°rˇt
(
lDülogSåög
, "\"") ;

7230 i‡–
aDeÁu…P©h
 && 
	`°æí
(aDefaultPath) )

7232 
	`°rˇt
(
lDülogSåög
, " --filename=\"") ;

7233 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©h
) ;

7234 
	`°rˇt
(
lDülogSåög
, "\"") ;

7236 i‡(
töyfd_sûít
Ë
	`°rˇt
–
lDülogSåög
 , " 2>/dev/null ");

7238 i‡–!
	`xdülogPª£¡
(Ë&& 
	`tköãr3Pª£¡
( ) )

7240 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python3-tkinter"); (*)1;}

7241 
	`°r˝y
–
lDülogSåög
 , 
gPyth⁄3Name
 ) ;

7242 
	`°rˇt
–
lDülogSåög
 ,

7244 
	`°rˇt
–
lDülogSåög
 , "res=filedialog.askdirectory(");

7245 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7247 
	`°rˇt
(
lDülogSåög
, "title='") ;

7248 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7249 
	`°rˇt
(
lDülogSåög
, "',") ;

7251 i‡–
aDeÁu…P©h
 && 
	`°æí
(aDefaultPath) )

7253 
	`°rˇt
(
lDülogSåög
, "initialdir='") ;

7254 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©h
 ) ;

7255 
	`°rˇt
(
lDülogSåög
 , "'" ) ;

7257 
	`°rˇt
–
lDülogSåög
, ");\nifÇot isinstance(res,Åuple):\n\tprint(res)\n\"" ) ;

7259 i‡–!
	`xdülogPª£¡
(Ë&& 
	`tköãr2Pª£¡
( ) )

7261 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python2-tkinter"); (*)1;}

7262 
	`°r˝y
–
lDülogSåög
 , "export PYTHONIOENCODING=utf-8;" ) ;

7263 
	`°rˇt
–
lDülogSåög
 , 
gPyth⁄2Name
 ) ;

7264 i‡–! 
	`isTîmöÆRu¬ög
–Ë&& 
	`isD¨wö
( ) )

7266 
	`°rˇt
–
lDülogSåög
 , " -i" ) ;

7268 
	`°rˇt
–
lDülogSåög
 ,

7271 i‡–
	`isD¨wö
( ) )

7273 
	`°rˇt
–
lDülogSåög
 ,

7278 
	`°rˇt
–
lDülogSåög
 , "printÅkFileDialog.askdirectory(");

7279 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7281 
	`°rˇt
(
lDülogSåög
, "title='") ;

7282 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7283 
	`°rˇt
(
lDülogSåög
, "',") ;

7285 i‡–
aDeÁu…P©h
 && 
	`°æí
(aDefaultPath) )

7287 
	`°rˇt
(
lDülogSåög
, "initialdir='") ;

7288 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©h
 ) ;

7289 
	`°rˇt
(
lDülogSåög
 , "'" ) ;

7291 
	`°rˇt
–
lDülogSåög
 , ")\"" ) ;

7293 i‡–
	`xdülogPª£¡
(Ë|| 
	`dülogName
() )

7295 i‡–
	`xdülogPª£¡
( ) )

7297 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"xdialog"); (*)1;}

7298 
lWasGøphicDülog
 = 1 ;

7299 
	`°r˝y
–
lDülogSåög
 , "(Xdialog " ) ;

7301 i‡–
	`isTîmöÆRu¬ög
( ) )

7303 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"dialog"); (*)0;}

7304 
	`°r˝y
–
lDülogSåög
 , "(dialog " ) ;

7308 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"dialog"); (*)0;}

7309 
lWasXãrm
 = 1 ;

7310 
	`°r˝y
–
lDülogSåög
 , 
	`ãrmöÆName
() ) ;

7311 
	`°rˇt
–
lDülogSåög
 , "'(" ) ;

7312 
	`°rˇt
–
lDülogSåög
 , 
	`dülogName
() ) ;

7313 
	`°rˇt
–
lDülogSåög
 , " " ) ;

7316 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7318 
	`°rˇt
(
lDülogSåög
, "--title \"") ;

7319 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7320 
	`°rˇt
(
lDülogSåög
, "\" ") ;

7323 i‡–!
	`xdülogPª£¡
(Ë&& !
	`gdülogPª£¡
() )

7325 
	`°rˇt
(
lDülogSåög
, "--backtitle \"") ;

7326 
	`°rˇt
(
lDülogSåög
,

7328 
	`°rˇt
(
lDülogSåög
, "\" ") ;

7331 
	`°rˇt
–
lDülogSåög
 , "--dselect \"" ) ;

7332 i‡–
aDeÁu…P©h
 && 
	`°æí
(aDefaultPath) )

7334 
	`°rˇt
(
lDülogSåög
, 
aDeÁu…P©h
) ;

7335 
	`ísuªFöÆSœsh
(
lDülogSåög
);

7337 i‡–! 
	`isTîmöÆRu¬ög
–Ë&& !
lWasGøphicDülog
 )

7339 
	`°rˇt
(
lDülogSåög
, 
	`gëív
("HOME")) ;

7340 
	`°rˇt
(
lDülogSåög
, "/");

7344 
	`°rˇt
(
lDülogSåög
, "./") ;

7347 i‡–
lWasGøphicDülog
 )

7349 
	`°rˇt
(
lDülogSåög
, "\" 0 60 ) 2>&1 ") ;

7353 
	`°rˇt
(
lDülogSåög
, "\" 0 60 >/dev/tty) ") ;

7354 i‡–
lWasXãrm
 )

7356 
	`°rˇt
–
lDülogSåög
 ,

7361 
	`°rˇt
(
lDülogSåög
, "2>&1 ; clear >/dev/tty") ;

7367 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){ 
	`töyfd_öputBox
◊TôÀ,
NULL
,NULL);}

7368 
	`°r˝y
(
lBuff
, "Select folder from ");

7369 
	`°rˇt
(
lBuff
, 
	`gëCurDú
());

7370 
lPoöãrI≈utBox
 = 
	`töyfd_öputBox
(
NULL
, NULL, NULL);

7371 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
(
lDülogSåög
,ÜPointerInputBox);

7372 
p
 = 
	`töyfd_öputBox
(
aTôÀ
, 
lBuff
, "");

7373 i‡(
p
Ë
	`°r˝y
(
lBuff
,Ö); lBuff[0] = '\0';

7374 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
÷PoöãrI≈utBox, 
lDülogSåög
);

7375 
p
 = 
lBuff
;

7377 i‡–!
p
 || ! 
	`°æí
–∞Ë|| ! 
	`dúExi°s
(Ö ) )

7379  
NULL
 ;

7381  
p
 ;

7383 i‡(
töyfd_vîbo£
Ë
	`¥ötf
–"lDülogSåög: %s\n" , 
lDülogSåög
 ) ;

7384 i‡–! ( 
lIn
 = 
	`p›í
–
lDülogSåög
 , "r" ) ) )

7386  
NULL
 ;

7388  
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

7390 
	`p˛o£
–
lIn
 ) ;

7391 i‡–
lBuff
[
	`°æí
(ÜBuff ) -1] == '\n' )

7393 
lBuff
[
	`°æí
(ÜBuff ) -1] = '\0' ;

7396 i‡–! 
	`°æí
–
lBuff
 ) || ! 
	`dúExi°s
(ÜBuff ) )

7398  
NULL
 ;

7400  
lBuff
 ;

7401 
	}
}

7408 * 
	$töyfd_cﬁ‹Choo£r
(

7409 c⁄° * 
aTôÀ
 ,

7410 c⁄° * 
aDeÁu…HexRGB
 ,

7411 c⁄° 
aDeÁu…RGB
[3] ,

7412 
aoResu…RGB
[3] )

7414 
lDeÁu…HexRGB
[16];

7415 
lBuff
 [128] ;

7417 
lTmp
 [128] ;

7418 #i‡!((
	`deföed
(
__˝lu•lus
 ) && __˝lu•lu†>201103LË|| (deföed(
__STDC_VERSION__
Ë&& __STDC_VERSION__ >199901LË|| deföed(
__˛™g__
))

7419 * 
lTmp2
 ;

7421 
lDülogSåög
 [
MAX_PATH_OR_CMD
] ;

7422 
lDeÁu…RGB
[3];

7423 * 
p
;

7424 * 
lPoöãrI≈utBox
;

7425 
FILE
 * 
lIn
 ;

7426 
i
 ;

7427 
lWasZíôy3
 = 0 ;

7428 
lWasOßs¸ùt
 = 0 ;

7429 
lWasXdülog
 = 0 ;

7430 
lBuff
[0]='\0';

7432 i‡(
aDeÁu…HexRGB
)

7434 
	`Hex2RGB
(
aDeÁu…HexRGB
, 
lDeÁu…RGB
);

7438 
lDeÁu…RGB
[0] = 
aDeÁu…RGB
[0];

7439 
lDeÁu…RGB
[1] = 
aDeÁu…RGB
[1];

7440 
lDeÁu…RGB
[2] = 
aDeÁu…RGB
[2];

7443 i‡–
	`oßs¸ùtPª£¡
( ) )

7445 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"applescript"); (*)1;}

7446 
lWasOßs¸ùt
 = 1 ;

7447 
	`°r˝y
–
lDülogSåög
 , "osascript");

7449 i‡–! 
	`osx9‹Bëãr
() )

7451 
	`°rˇt
–
lDülogSåög
 , " -e 'tellápplication \"System Events\"' -e 'Activate'");

7452 
	`°rˇt
–
lDülogSåög
 , " -e 'try' -e 'set mycolorÅo choose color default color {");

7456 
	`°rˇt
–
lDülogSåög
 ,

7461 
	`•rötf
(
lTmp
, "%d", 256 * 
lDeÁu…RGB
[0] ) ;

7462 
	`°rˇt
(
lDülogSåög
, 
lTmp
 ) ;

7463 
	`°rˇt
(
lDülogSåög
, "," ) ;

7464 
	`•rötf
(
lTmp
, "%d", 256 * 
lDeÁu…RGB
[1] ) ;

7465 
	`°rˇt
(
lDülogSåög
, 
lTmp
 ) ;

7466 
	`°rˇt
(
lDülogSåög
, "," ) ;

7467 
	`•rötf
(
lTmp
, "%d", 256 * 
lDeÁu…RGB
[2] ) ;

7468 
	`°rˇt
(
lDülogSåög
, 
lTmp
 ) ;

7469 
	`°rˇt
(
lDülogSåög
, "}' " ) ;

7470 
	`°rˇt
–
lDülogSåög
 ,

7472 
	`°rˇt
–
lDülogSåög
 ,

7474 
	`°rˇt
–
lDülogSåög
 ,

7476 
	`°rˇt
–
lDülogSåög
 , "-e 'endÑepeat' " );

7477 
	`°rˇt
–
lDülogSåög
 , "-e 'mystring' ");

7478 
	`°rˇt
(
lDülogSåög
, "-e 'onÉrrorÇumber -128' " ) ;

7479 
	`°rˇt
(
lDülogSåög
, "-e 'endÅry'") ;

7480 i‡–! 
	`osx9‹Bëãr
(ËË
	`°rˇt
–
lDülogSåög
, " -e 'endÅell'") ;

7482 i‡–
	`kdülogPª£¡
() )

7484 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"kdialog"); (*)1;}

7485 
	`°r˝y
–
lDülogSåög
 , "kdialog" ) ;

7486 i‡–
	`kdülogPª£¡
() == 2 )

7488 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7490 
	`•rötf
–
lDülogSåög
 + 
	`°æí
÷DülogSåögË, " --gëcﬁ‹ --deÁu… '%s'" , 
lDeÁu…HexRGB
 ) ;

7492 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7494 
	`°rˇt
(
lDülogSåög
, " --title \"") ;

7495 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7496 
	`°rˇt
(
lDülogSåög
, "\"") ;

7499 i‡–
	`zíôy3Pª£¡
(Ë|| 
	`m©edülogPª£¡
(Ë|| 
	`shñÀmíèryPª£¡
(Ë|| 
	`q¨maPª£¡
() )

7501 
lWasZíôy3
 = 1 ;

7502 i‡–
	`zíôy3Pª£¡
() )

7504 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"zenity3"); (*)1;}

7505 
	`°r˝y
–
lDülogSåög
 , "zenity" );

7506 i‡–(
	`zíôy3Pª£¡
(Ë>4Ë&& !
	`gëív
("SSH_TTY") )

7508 
	`°rˇt
–
lDülogSåög
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7511 i‡–
	`m©edülogPª£¡
() )

7513 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"matedialog"); (*)1;}

7514 
	`°r˝y
–
lDülogSåög
 , "matedialog" ) ;

7516 i‡–
	`shñÀmíèryPª£¡
() )

7518 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"shellementary"); (*)1;}

7519 
	`°r˝y
–
lDülogSåög
 , "shellementary" ) ;

7523 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"qarma"); (*)1;}

7524 
	`°r˝y
–
lDülogSåög
 , "qarma" ) ;

7525 i‡–!
	`gëív
("SSH_TTY") )

7527 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7530 
	`°rˇt
–
lDülogSåög
 , " --color-selection --show-palette" ) ;

7531 
	`•rötf
–
lDülogSåög
 + 
	`°æí
÷DülogSåög), " --cﬁ‹=%s" , 
lDeÁu…HexRGB
 ) ;

7533 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7535 
	`°rˇt
(
lDülogSåög
, " --title=\"") ;

7536 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7537 
	`°rˇt
(
lDülogSåög
, "\"") ;

7539 i‡(
töyfd_sûít
Ë
	`°rˇt
–
lDülogSåög
 , " 2>/dev/null ");

7541 i‡–
	`xdülogPª£¡
() )

7543 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"xdialog"); (*)1;}

7544 
lWasXdülog
 = 1 ;

7545 
	`°r˝y
–
lDülogSåög
 , "Xdialog --colorsel \"" ) ;

7546 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7548 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7550 
	`°rˇt
(
lDülogSåög
, "\" 0 60 ") ;

7551 #i‡(
	`deföed
(
__˝lu•lus
 ) && __˝lu•lu†>201103LË|| (deföed(
__STDC_VERSION__
Ë&& __STDC_VERSION__ >199901LË|| deföed(
__˛™g__
)

7552 
	`•rötf
(
lTmp
,"%hhu %hhu %hhu",
lDeÁu…RGB
[0],lDefaultRGB[1],lDefaultRGB[2]);

7554 
	`•rötf
(
lTmp
,"%hu %hu %hu",
lDeÁu…RGB
[0],lDefaultRGB[1],lDefaultRGB[2]);

7556 
	`°rˇt
(
lDülogSåög
, 
lTmp
) ;

7557 
	`°rˇt
(
lDülogSåög
, " 2>&1");

7559 i‡–
	`tköãr3Pª£¡
( ) )

7561 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python3-tkinter"); (*)1;}

7562 
	`°r˝y
–
lDülogSåög
 , 
gPyth⁄3Name
 ) ;

7563 
	`°rˇt
–
lDülogSåög
 ,

7565 
	`°rˇt
–
lDülogSåög
 , "res=colorchooser.askcolor(color='" ) ;

7566 
	`°rˇt
(
lDülogSåög
, 
lDeÁu…HexRGB
 ) ;

7567 
	`°rˇt
(
lDülogSåög
, "'") ;

7569 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7571 
	`°rˇt
(
lDülogSåög
, ",title='") ;

7572 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7573 
	`°rˇt
(
lDülogSåög
, "'") ;

7575 
	`°rˇt
–
lDülogSåög
 , ");\
\nifÑes[1] isÇot None:\n\tprint(res[1])\"" ) ;

7578 i‡–
	`tköãr2Pª£¡
( ) )

7580 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"python2-tkinter"); (*)1;}

7581 
	`°r˝y
–
lDülogSåög
 , "export PYTHONIOENCODING=utf-8;" ) ;

7582 
	`°rˇt
–
lDülogSåög
 , 
gPyth⁄2Name
 ) ;

7583 i‡–! 
	`isTîmöÆRu¬ög
–Ë&& 
	`isD¨wö
( ) )

7585 
	`°rˇt
–
lDülogSåög
 , " -i" ) ;

7588 
	`°rˇt
–
lDülogSåög
 ,

7591 i‡–
	`isD¨wö
( ) )

7593 
	`°rˇt
–
lDülogSåög
 ,

7598 
	`°rˇt
–
lDülogSåög
 , "res=tkColorChooser.askcolor(color='" ) ;

7599 
	`°rˇt
(
lDülogSåög
, 
lDeÁu…HexRGB
 ) ;

7600 
	`°rˇt
(
lDülogSåög
, "'") ;

7603 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7605 
	`°rˇt
(
lDülogSåög
, ",title='") ;

7606 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7607 
	`°rˇt
(
lDülogSåög
, "'") ;

7609 
	`°rˇt
–
lDülogSåög
 , ");\
\nifÑes[1] isÇot None:\n\tprintÑes[1]\"" ) ;

7614 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){ 
	`töyfd_öputBox
◊TôÀ,
NULL
,NULL);}

7615 
lPoöãrI≈utBox
 = 
	`töyfd_öputBox
(
NULL
, NULL, NULL);

7616 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
(
lDülogSåög
,ÜPointerInputBox);

7617 
p
 = 
	`töyfd_öputBox
(
aTôÀ
, "E¡î hexÑgb cﬁ‹ (i.e. #f5ˇ20)", 
lDeÁu…HexRGB
);

7619 i‡–!
p
 || (
	`°æí
(p) != 7) || (p[0] != '#') )

7621  
NULL
 ;

7623  
i
 = 1 ; i < 7 ; i ++ )

7625 i‡–! 
	`isxdigô
–(Ë
p
[
i
] ) )

7627  
NULL
 ;

7630 
	`Hex2RGB
(
p
,
aoResu…RGB
);

7631 
	`°r˝y
(
lDeÁu…HexRGB
, 
p
);

7632 i‡(
lPoöãrI≈utBox
Ë
	`°r˝y
÷PoöãrI≈utBox, 
lDülogSåög
);

7633  
lDeÁu…HexRGB
;

7636 i‡(
töyfd_vîbo£
Ë
	`¥ötf
–"lDülogSåög: %s\n" , 
lDülogSåög
 ) ;

7637 i‡–! ( 
lIn
 = 
	`p›í
–
lDülogSåög
 , "r" ) ) )

7639  
NULL
 ;

7641  
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

7644 
	`p˛o£
–
lIn
 ) ;

7645 i‡–! 
	`°æí
–
lBuff
 ) )

7647  
NULL
 ;

7651 i‡–
lBuff
[
	`°æí
(ÜBuff ) -1] == '\n' )

7653 
lBuff
[
	`°æí
(ÜBuff ) -1] = '\0' ;

7656 i‡–
lWasZíôy3
 )

7658 i‡–
lBuff
[0] == '#' )

7660 i‡–
	`°æí
(
lBuff
)>7 )

7662 
lBuff
[3]=lBuff[5];

7663 
lBuff
[4]=lBuff[6];

7664 
lBuff
[5]=lBuff[9];

7665 
lBuff
[6]=lBuff[10];

7666 
lBuff
[7]='\0';

7668 
	`Hex2RGB
(
lBuff
,
aoResu…RGB
);

7670 i‡–
lBuff
[3] == '(' ) {

7671 #i‡(
	`deföed
(
__˝lu•lus
 ) && __˝lu•lu†>201103LË|| (deföed(
__STDC_VERSION__
Ë&& __STDC_VERSION__ >199901LË|| deföed(
__˛™g__
)

7672 
	`ssˇnf
(
lBuff
,"rgb(%hhu,%hhu,%hhu", & 
aoResu…RGB
[0], &áoResultRGB[1],&áoResultRGB[2]);

7674 
aoResu…RGB
[0] = 
	`°πﬁ
(
lBuff
+4, & 
lTmp2
, 10 );

7675 
aoResu…RGB
[1] = 
	`°πﬁ
(
lTmp2
+1, &ÜTmp2, 10 );

7676 
aoResu…RGB
[2] = 
	`°πﬁ
(
lTmp2
+1, 
NULL
, 10 );

7678 
	`RGB2Hex
(
aoResu…RGB
,
lBuff
);

7680 i‡–
lBuff
[4] == '(' ) {

7681 #i‡(
	`deföed
(
__˝lu•lus
 ) && __˝lu•lu†>201103LË|| (deföed(
__STDC_VERSION__
Ë&& __STDC_VERSION__ >199901LË|| deföed(
__˛™g__
)

7682 
	`ssˇnf
(
lBuff
,"rgba(%hhu,%hhu,%hhu", & 
aoResu…RGB
[0], &áoResultRGB[1],&áoResultRGB[2]);

7684 
aoResu…RGB
[0] = 
	`°πﬁ
(
lBuff
+5, & 
lTmp2
, 10 );

7685 
aoResu…RGB
[1] = 
	`°πﬁ
(
lTmp2
+1, &ÜTmp2, 10 );

7686 
aoResu…RGB
[2] = 
	`°πﬁ
(
lTmp2
+1, 
NULL
, 10 );

7688 
	`RGB2Hex
(
aoResu…RGB
,
lBuff
);

7691 i‡–
lWasOßs¸ùt
 || 
lWasXdülog
 )

7694 #i‡(
	`deföed
(
__˝lu•lus
 ) && __˝lu•lu†>201103LË|| (deföed(
__STDC_VERSION__
Ë&& __STDC_VERSION__ >199901LË|| deföed(
__˛™g__
)

7695 
	`ssˇnf
(
lBuff
,"%hhu %hhu %hhu", & 
aoResu…RGB
[0], &áoResultRGB[1],&áoResultRGB[2]);

7697 
aoResu…RGB
[0] = 
	`°πﬁ
(
lBuff
, & 
lTmp2
, 10 );

7698 
aoResu…RGB
[1] = 
	`°πﬁ
(
lTmp2
+1, &ÜTmp2, 10 );

7699 
aoResu…RGB
[2] = 
	`°πﬁ
(
lTmp2
+1, 
NULL
, 10 );

7701 
	`RGB2Hex
(
aoResu…RGB
,
lBuff
);

7705 
	`Hex2RGB
(
lBuff
,
aoResu…RGB
);

7710 
	`°r˝y
(
lDeÁu…HexRGB
,
lBuff
);

7711  
lDeÁu…HexRGB
 ;

7712 
	}
}

7717 * 
	$töyfd_¨øyDülog
(

7718 c⁄° * 
aTôÀ
 ,

7719 
aNumOfCﬁumns
 ,

7720 c⁄° * c⁄° * 
aCﬁumns
 ,

7721 
aNumOfRows
 ,

7722 c⁄° * c⁄° * 
aCñls
 )

7725 
lBuff
 [
MAX_PATH_OR_CMD
] ;

7726 
lDülogSåög
 [
MAX_PATH_OR_CMD
] ;

7727 
FILE
 * 
lIn
 ;

7728 
i
 ;

7730 
lBuff
[0]='\0';

7732 i‡–
	`zíôyPª£¡
(Ë|| 
	`m©edülogPª£¡
(Ë|| 
	`shñÀmíèryPª£¡
(Ë|| 
	`q¨maPª£¡
() )

7734 i‡–
	`zíôyPª£¡
() )

7736 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"zenity"); (*)1;}

7737 
	`°r˝y
–
lDülogSåög
 , "zenity" ) ;

7738 i‡–(
	`zíôy3Pª£¡
(Ë>4Ë&& !
	`gëív
("SSH_TTY") )

7740 
	`°rˇt
–
lDülogSåög
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7743 i‡–
	`m©edülogPª£¡
() )

7745 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"matedialog"); (*)1;}

7746 
	`°r˝y
–
lDülogSåög
 , "matedialog" ) ;

7748 i‡–
	`shñÀmíèryPª£¡
() )

7750 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"shellementary"); (*)1;}

7751 
	`°r˝y
–
lDülogSåög
 , "shellementary" ) ;

7755 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,"qarma"); (*)1;}

7756 
	`°r˝y
–
lDülogSåög
 , "qarma" ) ;

7757 i‡–!
	`gëív
("SSH_TTY") )

7759 
	`°rˇt
(
lDülogSåög
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7762 
	`°rˇt
–
lDülogSåög
 , " --list --print-column=ALL" ) ;

7764 i‡–
aTôÀ
 && 
	`°æí
(aTitle) )

7766 
	`°rˇt
(
lDülogSåög
, " --title=\"") ;

7767 
	`°rˇt
(
lDülogSåög
, 
aTôÀ
) ;

7768 
	`°rˇt
(
lDülogSåög
, "\"") ;

7771 i‡–
aCﬁumns
 && (
aNumOfCﬁumns
 > 0) )

7773  
i
 = 0 ; i < 
aNumOfCﬁumns
 ; i ++ )

7775 
	`°rˇt
–
lDülogSåög
 , " --column=\"" ) ;

7776 
	`°rˇt
–
lDülogSåög
 , 
aCﬁumns
 [
i
] ) ;

7777 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

7781 i‡–
aCñls
 && (
aNumOfRows
 > 0) )

7783 
	`°rˇt
–
lDülogSåög
 , " " ) ;

7784  
i
 = 0 ; i < 
aNumOfRows
*
aNumOfCﬁumns
 ; i ++ )

7786 
	`°rˇt
–
lDülogSåög
 , "\"" ) ;

7787 
	`°rˇt
–
lDülogSåög
 , 
aCñls
 [
i
] ) ;

7788 
	`°rˇt
–
lDülogSåög
 , "\" " ) ;

7794 i‡(
aTôÀ
&&!
	`°rcmp
◊TôÀ,"töyfd_quîy")){
	`°r˝y
(
töyfd_ª•⁄£
,""); (*)0;}

7795  
NULL
 ;

7798 i‡(
töyfd_vîbo£
Ë
	`¥ötf
–"lDülogSåög: %s\n" , 
lDülogSåög
 ) ;

7799 i‡–! ( 
lIn
 = 
	`p›í
–
lDülogSåög
 , "r" ) ) )

7801  
NULL
 ;

7803  
	`fgës
–
lBuff
 , –lBuf‡Ë, 
lIn
 ) !
NULL
 )

7805 
	`p˛o£
–
lIn
 ) ;

7806 i‡–
lBuff
[
	`°æí
(ÜBuff ) -1] == '\n' )

7808 
lBuff
[
	`°æí
(ÜBuff ) -1] = '\0' ;

7811 i‡–! 
	`°æí
–
lBuff
 ) )

7813  
NULL
 ;

7815  
lBuff
 ;

7816 
	}
}

7985 #ifde‡
_MSC_VER


7986 #¥agm®
w¨nög
(:4996)

7987 #¥agm®
w¨nög
(:4100)

7988 #¥agm®
w¨nög
(:4706)

	@tinyfiledialogs.h

94 #i‚de‡
TINYFILEDIALOGS_H


95 
	#TINYFILEDIALOGS_H


	)

97 #ifdef 
__˝lu•lus


105 #ifde‡
_WIN32


108 
töyfd_wöUtf8
;

112 * 
töyfd_utf8toMbcs
(c⁄° * 
aUtf8°rög
);

113 
wch¨_t
 * 
töyfd_utf8to16
(c⁄° * 
aUtf8°rög
);

114 * 
töyfd_utf16to8
(
wch¨_t
 c⁄° * 
aUtf16°rög
);

115 
töyfd_£tWöUtf8
(
aIsUtf8
);

121 c⁄° 
töyfd_vîsi⁄
[8];

122 c⁄° 
töyfd_√eds
[];

123 
töyfd_vîbo£
;

124 
töyfd_sûít
;

129 
töyfd_f‹˚C⁄sﬁe
;

136 
töyfd_ª•⁄£
[1024];

150 
töyfd_bìp
();

152 
töyfd_nŸifyP›up
(

153 c⁄° * 
aTôÀ
,

154 c⁄° * 
aMesßge
,

155 c⁄° * 
aIc⁄Ty≥
);

158 
töyfd_mesßgeBox
(

159 c⁄° * 
aTôÀ
 ,

160 c⁄° * 
aMesßge
 ,

161 c⁄° * 
aDülogTy≥
 ,

162 c⁄° * 
aIc⁄Ty≥
 ,

163 
aDeÁu…Buâ⁄
 ) ;

166 * 
töyfd_öputBox
(

167 c⁄° * 
aTôÀ
 ,

168 c⁄° * 
aMesßge
 ,

169 c⁄° * 
aDeÁu…I≈ut
 ) ;

172 * 
töyfd_ßveFûeDülog
(

173 c⁄° * 
aTôÀ
 ,

174 c⁄° * 
aDeÁu…P©hAndFûe
 ,

175 
aNumOfFûãrP©ã∫s
 ,

176 c⁄° * c⁄° * 
aFûãrP©ã∫s
 ,

177 c⁄° * 
aSögÀFûãrDes¸ùti⁄
 ) ;

180 * 
töyfd_›íFûeDülog
(

181 c⁄° * 
aTôÀ
 ,

182 c⁄° * 
aDeÁu…P©hAndFûe
 ,

183 
aNumOfFûãrP©ã∫s
 ,

184 c⁄° * c⁄° * 
aFûãrP©ã∫s
 ,

185 c⁄° * 
aSögÀFûãrDes¸ùti⁄
 ,

186 
aAŒowMu…ùÀSñe˘s
 ) ;

190 * 
töyfd_£À˘FﬁdîDülog
(

191 c⁄° * 
aTôÀ
 ,

192 c⁄° * 
aDeÁu…P©h
 ) ;

195 * 
töyfd_cﬁ‹Choo£r
(

196 c⁄° * 
aTôÀ
 ,

197 c⁄° * 
aDeÁu…HexRGB
 ,

198 c⁄° 
aDeÁu…RGB
[3] ,

199 
aoResu…RGB
[3] ) ;

208 #ifde‡
_WIN32


211 
töyfd_nŸifyP›upW
(

212 
wch¨_t
 c⁄° * 
aTôÀ
,

213 
wch¨_t
 c⁄° * 
aMesßge
,

214 
wch¨_t
 c⁄° * 
aIc⁄Ty≥
);

217 
töyfd_mesßgeBoxW
(

218 
wch¨_t
 c⁄° * 
aTôÀ
 ,

219 
wch¨_t
 c⁄° * 
aMesßge
,

220 
wch¨_t
 c⁄° * 
aDülogTy≥
,

221 
wch¨_t
 c⁄° * 
aIc⁄Ty≥
,

222 
aDeÁu…Buâ⁄
 );

226 
wch¨_t
 * 
töyfd_öputBoxW
(

227 
wch¨_t
 c⁄° * 
aTôÀ
,

228 
wch¨_t
 c⁄° * 
aMesßge
,

229 
wch¨_t
 c⁄° * 
aDeÁu…I≈ut
 );

232 
wch¨_t
 * 
töyfd_ßveFûeDülogW
(

233 
wch¨_t
 c⁄° * 
aTôÀ
,

234 
wch¨_t
 c⁄° * 
aDeÁu…P©hAndFûe
,

235 
aNumOfFûãrP©ã∫s
,

236 
wch¨_t
 c⁄° * c⁄° * 
aFûãrP©ã∫s
,

237 
wch¨_t
 c⁄° * 
aSögÀFûãrDes¸ùti⁄
);

241 
wch¨_t
 * 
töyfd_›íFûeDülogW
(

242 
wch¨_t
 c⁄° * 
aTôÀ
,

243 
wch¨_t
 c⁄° * 
aDeÁu…P©hAndFûe
,

244 
aNumOfFûãrP©ã∫s
 ,

245 
wch¨_t
 c⁄° * c⁄° * 
aFûãrP©ã∫s
,

246 
wch¨_t
 c⁄° * 
aSögÀFûãrDes¸ùti⁄
,

247 
aAŒowMu…ùÀSñe˘s
 ) ;

252 
wch¨_t
 * 
töyfd_£À˘FﬁdîDülogW
(

253 
wch¨_t
 c⁄° * 
aTôÀ
,

254 
wch¨_t
 c⁄° * 
aDeÁu…P©h
);

258 
wch¨_t
 * 
töyfd_cﬁ‹Choo£rW
(

259 
wch¨_t
 c⁄° * 
aTôÀ
,

260 
wch¨_t
 c⁄° * 
aDeÁu…HexRGB
,

261 c⁄° 
aDeÁu…RGB
[3] ,

262 
aoResu…RGB
[3] ) ;

272 * 
töyfd_¨øyDülog
(

273 c⁄° * 
aTôÀ
 ,

274 
aNumOfCﬁumns
 ,

275 c⁄° * c⁄° * 
aCﬁumns
,

276 
aNumOfRows
,

277 c⁄° * c⁄° * 
aCñls
);

282 #ifdef 
__˝lu•lus


	@win32_platform.cpp

1 
	~"MaöHñ≥rs.h
"

2 
	~<io°ªam
>

3 
	~<s°ªam
>

4 
	~"°rög.h
"

5 
	~"SaveLﬂd.h
"

6 
	~"TextS˚√.h
"

7 
	~"MíuS˚√.h
"

8 
	~"Edô‹S˚√.h
"

9 
	~"•rôe.h
"

11 
	$H™dÀSh¨edEvíts
(
Edô‹UISèã
* 
ui_°©e
, 
GameS∑˚Camîa
* 
ˇmîa_game
, 
glm
::
m©4
* 
ˇmîa
, 
boﬁ
 
mou£_moved_this_‰ame
, 
SCENE_TYPE
 
s˚√
)

13 
boﬁ
 
À·_˛ick_a˘i⁄_ªsﬁved
 = 
Ál£
;

14 i‡(
ui_°©e
->
whìl_move
 !0 && (
s˚√
 =
SCENE_TYPE
::
ST_EDITOR
 || s˚√ =SCENE_TYPE::
ST_EDIT_LEVEL
))

17 
°d
::
cout
 << "begöÖrötög zoom info" << std::
ídl
;

18 
game_height_ﬁd
 = 
ui_°©e
->
game_height_cuºít
;

19 
ui_°©e
->
game_height_cuºít
 -ui_°©e->
whìl_move
;

20 
ui_°©e
->
game_height_cuºít
 = 
	`maxf
(
MAX_ZOOM
, ui_state->game_height_current);

21 
øtio
 = 
ui_°©e
->
game_height_cuºít
 / 
game_height_ﬁd
;

22 
ˇmîa_˚¡î_x
 = (
ˇmîa_game
->
À·
 + camîa_game->
right
) / 2.0f;

23 
ˇmîa_˚¡î_y
 = (
ˇmîa_game
->
up
 + camîa_game->
down
) / 2.0f;

24 
ˇmîa_width
 = (
ˇmîa_game
->
right
 - camîa_game->
À·
);

25 
ˇmîa_height
 = (
ˇmîa_game
->
up
 - camîa_game->
down
);

26 
√w_ˇmîa_hÆf_width
 = (
ˇmîa_width
 / 2.0fË* 
øtio
;

27 
√w_ˇmîa_hÆf_height
 = (
ˇmîa_height
 / 2.0fË* 
øtio
;

29 
ˇmîa_game
->
À·
 = 
ˇmîa_˚¡î_x
 - 
√w_ˇmîa_hÆf_width
;

30 
ˇmîa_game
->
right
 = 
ˇmîa_˚¡î_x
 + 
√w_ˇmîa_hÆf_width
;

31 
ˇmîa_game
->
down
 = 
ˇmîa_˚¡î_y
 - 
√w_ˇmîa_hÆf_height
;

32 
ˇmîa_game
->
up
 = 
ˇmîa_˚¡î_y
 + 
√w_ˇmîa_hÆf_height
;

35 i‡(
mou£_moved_this_‰ame
 && 
ui_°©e
->
mou£_right_˛ick_down
 && (
s˚√
 =
SCENE_TYPE
::
ST_EDITOR
 || s˚√ =SCENE_TYPE::
ST_EDIT_LEVEL
))

37 
ui_°©e
->
tŸÆMove
 = 
	`m©h_öçaú_sub
(ui_°©e->
mou£_œ°_pos
, ui_°©e->
mou£Pos
);

38 
ˇmîa_game
->
À·
 +
ui_°©e
->
tŸÆMove
.
x
 * 
CAMERA_MOVE_MULT
;

39 
ˇmîa_game
->
right
 +
ui_°©e
->
tŸÆMove
.
x
 * 
CAMERA_MOVE_MULT
;

40 
ˇmîa_game
->
down
 +
ui_°©e
->
tŸÆMove
.
y
 * 
CAMERA_MOVE_MULT
;

41 
ˇmîa_game
->
up
 +
ui_°©e
->
tŸÆMove
.
y
 * 
CAMERA_MOVE_MULT
;

43 
	}
}

45 #¥agm®
ªgi⁄
 
EMBARASSINGLY
 
GLOBAL
 
VARIABLES


49 
AŒWrôe
* 
	gÆl_wrôe
;

50 
S¥ôeWrôe
* 
	gÊo‹_wrôe
;

51 
S¥ôeWrôe
* 
	gpõ˚_wrôe
;

52 
S¥ôeWrôe
* 
	gsymbﬁ_wrôe
;

53 
S¥ôeWrôe
* 
	gui_wrôe
;

55 
boﬁ
 
	gkìp_ru¬ög_öföôe_lo›
 = 
Ál£
;

57 
Mem‹y
* 
	g‰ame_mem‹y
;

58 
Mem‹y
* 
	g≥rm™ít_mem‹y
;

59 
Mem‹y
* 
	gmíu_mem‹y
;

60 
Mem‹y
* 
	gedô‹_mem‹y
;

61 
Mem‹y
* 
	g∂ay_mem‹y
;

62 
Mem‹y
* 
	gw‹ld_mem‹y
;

63 
Mem‹y
* 
	gÀvñ_mem‹y
;

64 
Mem‹y
* 
	g™im©i⁄_mem‹y
;

65 
Mem‹y
* 
	gãxt_mem‹y
;

67 
SCENE_TYPE
 
	gs˚√
;

68 
Edô‹S˚√
* 
	gedô‹_s˚√_°©e
;

69 
PœyS˚√
 
	g∂ay_s˚√_°©e
;

70 
W‹ldS˚√
* 
	gw‹ld_s˚√_°©e
;

71 
W‹ldPœyS˚√
* 
	gw‹ld_∂ay_s˚√_°©e
;

72 
TextS˚√
* 
	gãxt_s˚√_°©e
;

73 
MíuS˚√
* 
	gmíu_s˚√_°©e
;

74 
Dúe˘i⁄
 
	gœ°_move_èkí
 = 
NO_DIRECTION
;

75 
	gs¸ìn_width
 = 800;

76 
	gs¸ìn_height
 = 600;

77 
	gw‹ld_ˇmîa_ÀΩ
;

78 
SDL_Evít
 
	gevít
;

79 
boﬁ
 
	gru¬ög
 = 
åue
;

80 
Edô‹UISèã
 
	gui_°©e
;

82 
GameS∑˚Camîa
 
	gw‹ld_ˇmîa
;

83 
GameS∑˚Camîa
 
	gw‹ld_ˇmîa_°¨t
;

84 
GameS∑˚Camîa
 
	gw‹ld_ˇmîa_gﬂl
;

87 
GameS∑˚Camîa
 
	gˇmîa_game
;

88 
VõwP‹tCamîa
 
	gˇmîa_võwp‹t
;

89 
	gglm
::
m©4
 
ˇmîa
;

93 
	gglm
::
vec2
 
døggög_°¨t_posôi⁄_ö_game•a˚
 = 
glm
::vec2(0, 0);

96 
Uöt32
 
	g°¨t_time_ms
;

97 
Uöt32
 
	gœ°_‰ame_time_ms
;

102 
Shadî
 
	g•rôeShadî
;

103 
Shadî
 
	gfuŒS¥ôeShadî
;

104 
Shadî
 
	gdŸãdShadî
;

105 
Shadî
 
	gãxtShadî
;

106 
Shadî
 
	g°rögShadî
;

107 
	gglm
::
vec4
* 
ui_©œs_m≠≥r
;

109 
GLuöt
 
	gdŸãd_VAO
;

110 
GLuöt
 
	gdŸãd_posôi⁄s_buf„r
;

111 
GLuöt
 
	gdŸãd_sˇÀ_buf„r
;

112 
	gdŸãd_tŸÆ_døwn
;

113 
	gglm
::
vec3
* 
dŸãd_posôi⁄s_˝u
;

114 
	gglm
::
vec2
* 
dŸãd_sˇÀ_˝u
;

116 
GLuöt
 
	g°rög_VAO
;

117 
GLuöt
 
	g°rög_©œs_buf„r
;

118 
GLuöt
 
	g°rög_m©rix_buf„r
;

119 
GLuöt
 
	g°rög_cﬁ‹_buf„r
;

120 
TextWrôe
 
	gãxt_døw_öfo
;

123 
	g°rög_ãxtuª
;

125 
SDL_Wödow
* 
	gwödow
;

127 #¥agm®
ídªgi⁄


130 
	$lﬂd_edô‹_Àvñ_°©eful
(
°d
::
°rög
 
to_lﬂd
)

132 
b¨
 = 3;

134 
b¨
 = 4;

135 
b¨
++;

137 
	`mem‹y_˛ór
(
edô‹_mem‹y
);

138 
W‹ldSèã
* 
ªs
 = 
	`∑r£_de£rülize_timemachöe
(
to_lﬂd
, 
edô‹_mem‹y
, 
‰ame_mem‹y
);

139 
edô‹_s˚√_°©e
 = 
	`edô‹s˚√_£tup_wôh_°¨t_°©e
(
edô‹_mem‹y
, 
ˇmîa_võwp‹t
, 
ªs
);

140 
edô‹_s˚√_°©e
->
timeMachöe
->
cuºít_numbî_of_a˘i⁄s
 = 0;

141 
°d
::
cout
 << "ALL DONE!" << std::
ídl
;

142 
	}
}

143 
	$ªsize_s¸ìn_°©eful
(
√xt_width
, 
√xt_height
)

145 
ﬁd_s¸ìn_width
 = (Ë
s¸ìn_width
;

146 
ﬁd_s¸ìn_height
 = (Ë
s¸ìn_height
;

147 
ﬁd_øtio
 = 
ﬁd_s¸ìn_width
 / 
ﬁd_s¸ìn_height
;

148 
s¸ìn_width
 = 
√xt_width
;

149 
s¸ìn_height
 = 
√xt_height
;

150 
	`glVõwp‹t
(0, 0, 
√xt_width
, 
√xt_height
);

156 
ˇmîa_võwp‹t
.
right
 = 
√xt_width
;

157 
ˇmîa_võwp‹t
.
up
 = 
√xt_height
;

161 
√xt_øtio
 = (Ë
s¸ìn_width
 / 
s¸ìn_height
;

162 
ex∑nd_øtio
 = 
√xt_øtio
 / 
ﬁd_øtio
;

163 
˚¡î
 = (
ˇmîa_game
.
À·
 + camîa_game.
right
) / 2.0f;

164 
ﬁd_di°™˚
 = 
ˇmîa_game
.
right
 - camîa_game.
À·
;

165 
√xt_di°™˚
 = 
ﬁd_di°™˚
 * 
ex∑nd_øtio
;

166 
ˇmîa_game
.
À·
 = 
˚¡î
 - 
√xt_di°™˚
 / 2.0f;

167 
ˇmîa_game
.
right
 = 
˚¡î
 + 
√xt_di°™˚
 / 2.0f;

173 
	}
}

174 
	$£tup_w‹ld_s¸ìn_°©eful
(
SCENE_TYPE
 
go_to_⁄_back•a˚
)

176 
	`mem‹y_˛ór
(
w‹ld_mem‹y
);

177 
w‹ld_s˚√_°©e
 = 
	`£tup_w‹ld_s˚√
(
edô‹_s˚√_°©e
->
timeMachöe
, 
w‹ld_mem‹y
, 
go_to_⁄_back•a˚
);

178 
s˚√
 = 
ST_PLAY_WORLD
;

179 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 = 0;

182 
cuºít_num
 = 
w‹ld_s˚√_°©e
->
cuºít_Àvñ
;

183 
GameSèã
* 
cuºít_game°©e
 = 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_°©e
[
cuºít_num
];

184 
I¡Paú
 
game°©e_pos
 = 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
cuºít_num
];

185 
w‹ld_ˇmîa
 = 
	`m©h_ˇmîa_buûd_f‹_game°©e
(
cuºít_game°©e
, 
game°©e_pos
, 
ˇmîa_võwp‹t
);

187 
w‹ld_ˇmîa_°¨t
 = 
w‹ld_ˇmîa
;

188 
w‹ld_ˇmîa_gﬂl
 = 
w‹ld_ˇmîa
;

189 
w‹ld_ˇmîa_ÀΩ
 = 
CAMERA_LERP_TIME
;

190 
	}
}

191 
	$£tup_w‹ld_s¸ìn_c⁄töue_°©eful
(
°d
::
°rög
 
to_lﬂd
)

193 
	`mem‹y_˛ór
(
w‹ld_mem‹y
);

194 
w‹ld_s˚√_°©e
 = 
	`w‹ld_de£rülize
(
to_lﬂd
, 
w‹ld_mem‹y
, 
‰ame_mem‹y
);

195 
w‹ld_s˚√_°©e
->
go_to_⁄_back•a˚
 = 
ST_MENU
;

197 
s˚√
 = 
ST_PLAY_WORLD
;

198 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 = 0;

201 
cuºít_num
 = 
w‹ld_s˚√_°©e
->
cuºít_Àvñ
;

202 
GameSèã
* 
cuºít_game°©e
 = 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_°©e
[
cuºít_num
];

203 
I¡Paú
 
game°©e_pos
 = 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
cuºít_num
];

204 
w‹ld_ˇmîa
 = 
	`m©h_ˇmîa_buûd_f‹_game°©e
(
cuºít_game°©e
, 
game°©e_pos
, 
ˇmîa_võwp‹t
);

205 
w‹ld_ˇmîa_°¨t
 = 
w‹ld_ˇmîa
;

206 
w‹ld_ˇmîa_gﬂl
 = 
w‹ld_ˇmîa
;

207 
w‹ld_ˇmîa_ÀΩ
 = 
CAMERA_LERP_TIME
;

209 
	}
}

211 
	$ãxt_s˚√_ª£t
()

213 
s˚√
 = 
ãxt_s˚√_°©e
->
s˚√_to_ªvît_to
;

214 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 = 0;

215 
ui_°©e
.
time_sö˚_œ°_∂ayî_a˘i⁄
 = 0;

217 i‡(
s˚√
 =
SCENE_TYPE
::
ST_PLAY_LEVEL
)

219 
cuºít_Àvñ
 = 
w‹ld_s˚√_°©e
->current_level;

220 
GameSèã
* 
cuºít_game°©e
 = 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_°©e
[
cuºít_Àvñ
];

221 
I¡Paú
 
game°©e_pos
 = 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
cuºít_Àvñ
];

222 
w‹ld_ˇmîa_gﬂl
 = 
	`m©h_ˇmîa_buûd_f‹_game°©e
(
cuºít_game°©e
, 
game°©e_pos
, 
ˇmîa_võwp‹t
);

223 
w‹ld_ˇmîa_°¨t
 = 
w‹ld_ˇmîa
;

225 
	}
}

226 
	$míu_a˘i⁄_√w_game
()

231 
°d
::
°rög
 
to_lﬂd
 = 
	`ªsour˚_lﬂd_puzzÀ_fûe
("world3");

232 
	`lﬂd_edô‹_Àvñ_°©eful
(
to_lﬂd
);

233 
	`£tup_w‹ld_s¸ìn_°©eful
(
SCENE_TYPE
::
ST_MENU
);

234 
°d
::
cout
 << "TRIGGERING NEW GAME" << std::
ídl
;

235 
	}
}

236 
	$míu_a˘i⁄_c⁄töue_game
()

240 
°d
::
°rög
 
to_lﬂd
 = 
	`gë_c⁄töue_fûe
(
‰ame_mem‹y
);

241 
	`£tup_w‹ld_s¸ìn_c⁄töue_°©eful
(
to_lﬂd
);

242 
°d
::
cout
 << "TRIGGERING COUNTINUE GAME" << std::
ídl
;

243 
	}
}

244 
	$míu_a˘i⁄_Àvñ_edô‹
()

247 
°d
::
cout
 << "TRIGGERING LEVEL EDITOR" << std::
ídl
;

248 
s˚√
 = 
SCENE_TYPE
::
ST_EDITOR
;

249 
edô‹_s˚√_°©e
 = 
	`edô‹s˚√_£tup
(
edô‹_mem‹y
, 
ˇmîa_võwp‹t
);

250 
	}
}

254 
A˘i⁄
 
	$ˇlcuœã_wh©_a˘i⁄_to_èke_√xt_°©eful
()

257 
Àâî_¥i‹ôy
 = 
ui_°©e
.
mo°_ª˚¡ly_¥es£d_dúe˘i⁄
;

261 
buâ⁄_«mes
[4] = { 'w', 'a', 's', 'd' };

262 
Dúe˘i⁄
 
buâ⁄_a˘i⁄s
[4] = { 
U
, 
L
, 
D
, 
R
 };

263 
boﬁ
 
buâ⁄_¥es£d
 = 
Ál£
;

264 
buâ⁄_¥ess_ödex
 = -1;

265 
time_buâ⁄_¥es£d
 = -1;

266 
i
 = 0; i < 4; i++)

268 i‡(
ui_°©e
.
Àâîs
[
buâ⁄_«mes
[
i
] - 'a'].
¥es£d
)

269 i‡(
ui_°©e
.
Àâîs
[
buâ⁄_«mes
[
i
] - 'a'].
time_¥es£d
 > 
time_buâ⁄_¥es£d
 || !
buâ⁄_¥es£d
)

271 
buâ⁄_¥es£d
 = 
åue
;

272 
buâ⁄_¥ess_ödex
 = 
i
;

273 
time_buâ⁄_¥es£d
 = 
ui_°©e
.
Àâîs
[
buâ⁄_«mes
[
i
] - 'a'].
time_¥es£d
;

276 i‡(
buâ⁄_¥es£d
)

278 i‡(
ui_°©e
.
time_tûl_∂ayî_ˇn_move
 <0 || 
buâ⁄_a˘i⁄s
[
buâ⁄_¥ess_ödex
] !
œ°_move_èkí
)

280 
œ°_move_èkí
 = (
Dúe˘i⁄
)
buâ⁄_a˘i⁄s
[
buâ⁄_¥ess_ödex
];

281  (
A˘i⁄
Ë
buâ⁄_a˘i⁄s
[
buâ⁄_¥ess_ödex
];

285 i‡(
ui_°©e
.
Àâîs
['z' - 'a'].
¥es£d_this_‰ame
 ||

286 (
ui_°©e
.
Àâîs
['z' - 'a'].
¥es£d
 && ui_°©e.
time_tûl_∂ayî_ˇn_move
 <= 0))

288 
œ°_move_èkí
 = 
Dúe˘i⁄
::
NO_DIRECTION
;

289  (
A˘i⁄
Ë
A_UNDO
;

292 i‡(
ui_°©e
.
Àâîs
['r' - 'a'].
¥es£d_this_‰ame
)

294 
œ°_move_èkí
 = 
Dúe˘i⁄
::
NO_DIRECTION
;

295  (
A˘i⁄
)
A_RESET
;

297  (
A˘i⁄
Ë
A_NONE
;

298 
	}
}

299 
	$h™dÀ_√xt_a˘i⁄_°©eful
(
Game°©eTimeMachöe
* 
maybe_time_machöe
, 
I¡Paú
 
døw_posôi⁄
)

301 
A˘i⁄
 
√xt_a˘i⁄
 = 
	`ˇlcuœã_wh©_a˘i⁄_to_èke_√xt_°©eful
();

303 
Dúe˘i⁄
 
to_èke
 = 
	`a˘i⁄_to_dúe˘i⁄
(
√xt_a˘i⁄
);

305 i‡(
to_èke
 !
NO_DIRECTION
)

306 
	`èke_∂ayî_a˘i⁄
(

307 
maybe_time_machöe
,

308 
døw_posôi⁄
,

309 &
ui_°©e
,

310 
to_èke
,

311 
Àvñ_mem‹y
,

312 
‰ame_mem‹y
,

313 
™im©i⁄_mem‹y
);

316 i‡(
√xt_a˘i⁄
 =
A_UNDO
)

319 * 
mem‹y_˛óªd
 = 
	`game°©e_timemachöe_undo
(
maybe_time_machöe
);

320 
	`mem‹y_p›_°ack
(
Àvñ_mem‹y
, 
mem‹y_˛óªd
);

321 
ui_°©e
.
time_tûl_∂ayî_ˇn_move
 = 
WAIT_BETWEEN_PLAYER_MOVE_REPEAT
;

323 i‡(
√xt_a˘i⁄
 =
A_RESET
)

325 
	`game°©e_timemachöe_ª£t
(
maybe_time_machöe
, 
Àvñ_mem‹y
);

327 
	}
}

329 
	$h™dÀ_edô‹_öput
()

332 
	}
}

333 
	$maölo›fun˘i⁄
()

335 #¥agm®
ªgi⁄
 
Lo›
 
Sèπup


338 
i
 = 0; i < 
NUM_LETTERS_ON_KEYBOARD
; i++)

340 
ui_°©e
.
Àâîs
[
i
].
¥es£d_this_‰ame
 = 
Ál£
;

341 
ui_°©e
.
Àâîs
[
i
].
ªÀa£d_this_‰ame
 = 
Ál£
;

343 
i
 = 0; i < 
NUM_SDLK_KEYCODES
; i++)

345 
ui_°©e
.
key_vÆues
[
i
].
¥es£d_this_‰ame
 = 
Ál£
;

346 
ui_°©e
.
key_vÆues
[
i
].
ªÀa£d_this_‰ame
 = 
Ál£
;

348 
ui_°©e
.
upd©e_a˘uÆ_s¸ìn_size
 = 
Ál£
;

349 
ui_°©e
.
mou£_œ°_pos
 = ui_°©e.
mou£Pos
;

350 
ui_°©e
.
shi·_key_down_this_‰ame
 = 
Ál£
;

351 
ui_°©e
.
˛ick_À·_down_this_‰ame
 = 
Ál£
;

352 
ui_°©e
.
˛ick_À·_up_this_‰ame
 = 
Ál£
;

353 
ui_°©e
.
whìl_move
 = 0;

354 
ui_°©e
.
tŸÆMove
 = 
	`m©h_öçaú_¸óã
(0, 0);

355 
ui_°©e
.
z_key_down_this_‰ame
 = 
Ál£
;

356 
ui_°©e
.
back•a˚_key_down_this_‰ame
 = 
Ál£
;

357 
ui_°©e
.
right
.
¥es£d_this_‰ame
 = 
Ál£
;

358 
ui_°©e
.
up
.
¥es£d_this_‰ame
 = 
Ál£
;

359 
ui_°©e
.
down
.
¥es£d_this_‰ame
 = 
Ál£
;

360 
ui_°©e
.
À·
.
¥es£d_this_‰ame
 = 
Ál£
;

361 
ui_°©e
.
•a˚b¨
.
¥es£d_this_‰ame
 = 
Ál£
;

362 
ui_°©e
.
íãr
.
¥es£d_this_‰ame
 = 
Ál£
;

366 
	`SDL_PﬁlEvít
(&
evít
))

368 i‡(
evít
.
ty≥
 =
SDL_WINDOWEVENT
)

370 i‡(
evít
.
wödow
.evíà=
SDL_WINDOWEVENT_RESIZED
)

372 
ui_°©e
.
upd©e_a˘uÆ_s¸ìn_size
 = 
åue
;

373 
ui_°©e
.
√xt_ˇmîa_size
 = 
glm
::
	`ivec2
(
evít
.
wödow
.
d©a1
,Évít.wödow.
d©a2
);

376 i‡(
evít
.
ty≥
 =
SDL_KEYDOWN
)

378 
i
 = 0; i < 
NUM_LETTERS_ON_KEYBOARD
; i++)

380 i‡(
evít
.
key
.
keysym
.
sym
 =(
SDLK_a
 + 
i
))

382 
ui_°©e
.
Àâîs
[
i
].
¥es£d
 = 
åue
;

383 i‡(
ui_°©e
.
Àâîs
[
i
].
ªÀa£d_sö˚_¥es£d_œ°
)

385 
ui_°©e
.
Àâîs
[
i
].
¥es£d_this_‰ame
 = 
åue
;

386 
ui_°©e
.
Àâîs
[
i
].
time_¥es£d
 = ui_°©e.
tŸÆ_time_∑s£d
;

388 
ui_°©e
.
Àâîs
[
i
].
ªÀa£d_sö˚_¥es£d_œ°
 = 
Ál£
;

391 
i
 = 0; i < 
NUM_SDLK_KEYCODES
; i++)

393 
ödex
 = 
	`˛ick_sdl_keycode_to_ödex_posôi⁄
(
evít
.
key
.
keysym
.
sym
);

395 
ui_°©e
.
key_vÆues
[
ödex
].
¥es£d
 = 
åue
;

396 i‡(
ui_°©e
.
key_vÆues
[
ödex
].
ªÀa£d_sö˚_¥es£d_œ°
)

398 
ui_°©e
.
key_vÆues
[
ödex
].
¥es£d_this_‰ame
 = 
åue
;

399 
ui_°©e
.
key_vÆues
[
ödex
].
time_¥es£d
 = ui_°©e.
tŸÆ_time_∑s£d
;

401 
ui_°©e
.
key_vÆues
[
ödex
].
ªÀa£d_sö˚_¥es£d_œ°
 = 
Ál£
;

403 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_LSHIFT
)

405 
ui_°©e
.
shi·_key_down_this_‰ame
 = 
åue
;

406 
ui_°©e
.
shi·_key_down
 = 
åue
;

408 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_LALT
)

410 
ui_°©e
.
Æt_key_down
 = 
åue
;

412 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_LCTRL
)

414 
ui_°©e
.
c⁄åﬁ_key_down
 = 
åue
;

416 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_z
)

418 
ui_°©e
.
z_key_down_this_‰ame
 = 
åue
;

420 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_BACKSPACE
)

422 
ui_°©e
.
back•a˚_key_down_this_‰ame
 = 
åue
;

424 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_d
)

426 
ui_°©e
.
right
.
¥es£d
 = 
åue
;

427 
ui_°©e
.
right
.
¥es£d_this_‰ame
 = 
åue
;

429 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_w
)

431 
ui_°©e
.
up
.
¥es£d
 = 
åue
;

432 
ui_°©e
.
up
.
¥es£d_this_‰ame
 = 
åue
;

434 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_a
)

436 
ui_°©e
.
À·
.
¥es£d
 = 
åue
;

437 
ui_°©e
.
À·
.
¥es£d_this_‰ame
 = 
åue
;

439 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_s
)

441 
ui_°©e
.
down
.
¥es£d
 = 
åue
;

442 
ui_°©e
.
down
.
¥es£d_this_‰ame
 = 
åue
;

444 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_SPACE
)

446 
ui_°©e
.
•a˚b¨
.
¥es£d
 = 
åue
;

447 
ui_°©e
.
•a˚b¨
.
¥es£d_this_‰ame
 = 
åue
;

449 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_RETURN
)

451 
ui_°©e
.
íãr
.
¥es£d
 = 
åue
;

452 
ui_°©e
.
íãr
.
¥es£d_this_‰ame
 = 
åue
;

455 i‡(
evít
.
ty≥
 =
SDL_KEYUP
)

457 
i
 = 0; i < 
NUM_LETTERS_ON_KEYBOARD
; i++)

459 i‡(
evít
.
key
.
keysym
.
sym
 =(
SDLK_a
 + 
i
))

461 
ui_°©e
.
Àâîs
[
i
].
¥es£d
 = 
Ál£
;

462 
ui_°©e
.
Àâîs
[
i
].
ªÀa£d_this_‰ame
 = 
åue
;

463 
ui_°©e
.
Àâîs
[
i
].
ªÀa£d_sö˚_¥es£d_œ°
 = 
åue
;

466 
i
 = 0; i < 
NUM_SDLK_KEYCODES
; i++)

468 
ödex
 = 
	`˛ick_sdl_keycode_to_ödex_posôi⁄
(
evít
.
key
.
keysym
.
sym
);

470 
ui_°©e
.
Àâîs
[
ödex
].
¥es£d
 = 
Ál£
;

471 
ui_°©e
.
Àâîs
[
ödex
].
ªÀa£d_this_‰ame
 = 
åue
;

472 
ui_°©e
.
Àâîs
[
ödex
].
ªÀa£d_sö˚_¥es£d_œ°
 = 
åue
;

474 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_LSHIFT
)

476 
ui_°©e
.
shi·_key_down
 = 
Ál£
;

478 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_LALT
)

480 
ui_°©e
.
Æt_key_down
 = 
Ál£
;

482 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_LCTRL
)

484 
ui_°©e
.
c⁄åﬁ_key_down
 = 
Ál£
;

486 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_d
)

488 
ui_°©e
.
right
.
¥es£d
 = 
Ál£
;

490 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_w
)

492 
ui_°©e
.
up
.
¥es£d
 = 
Ál£
;

494 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_a
)

496 
ui_°©e
.
À·
.
¥es£d
 = 
Ál£
;

498 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_s
)

500 
ui_°©e
.
down
.
¥es£d
 = 
Ál£
;

502 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_SPACE
)

504 
ui_°©e
.
•a˚b¨
.
¥es£d
 = 
Ál£
;

506 i‡(
evít
.
key
.
keysym
.
sym
 =
SDLK_RETURN
)

508 
ui_°©e
.
íãr
.
¥es£d
 = 
Ál£
;

509 
ui_°©e
.
íãr
.
ªÀa£d_this_‰ame
 = 
åue
;

510 
ui_°©e
.
íãr
.
ªÀa£d_sö˚_¥es£d_œ°
 = 
åue
;

513 i‡(
evít
.
ty≥
 =
SDL_MOUSEMOTION
 ||Évít.ty≥ =
SDL_MOUSEBUTTONDOWN
 ||Évít.ty≥ =
SDL_MOUSEBUTTONUP
)

517 
mou£X
;

518 
mou£Y
;

519 
	`SDL_GëMou£Sèã
(&
mou£X
, &
mou£Y
);

520 
mou£Y
 = 
ˇmîa_võwp‹t
.
up
 - mouseY;

521 
ui_°©e
.
mou£Pos
 = 
	`m©h_öçaú_¸óã
(
mou£X
, 
mou£Y
);

522 
ui_°©e
.
mou£GamePos
 = 
	`m©h_s¸ìn•a˚_to_game•a˚
(ui_°©e.
mou£Pos
, 
ˇmîa_game
, 
ˇmîa_võwp‹t
, ui_°©e.
game_height_cuºít
);

526 i‡(
evít
.
ty≥
 =
SDL_MOUSEBUTTONDOWN
)

528 i‡(
evít
.
buâ⁄
.buâ⁄ =
SDL_BUTTON_RIGHT
)

529 
ui_°©e
.
mou£_right_˛ick_down
 = 
åue
;

530 i‡(
evít
.
buâ⁄
.buâ⁄ =
SDL_BUTTON_LEFT
)

532 
ui_°©e
.
˛ick_À·_down_this_‰ame
 = 
åue
;

533 
ui_°©e
.
mou£_À·_˛ick_down
 = 
åue
;

537 i‡(
evít
.
ty≥
 =
SDL_MOUSEBUTTONUP
)

539 i‡(
evít
.
buâ⁄
.buâ⁄ =
SDL_BUTTON_RIGHT
)

540 
ui_°©e
.
mou£_right_˛ick_down
 = 
Ál£
;

541 i‡(
evít
.
buâ⁄
.buâ⁄ =
SDL_BUTTON_LEFT
)

543 
ui_°©e
.
˛ick_À·_up_this_‰ame
 = 
åue
;

544 
ui_°©e
.
mou£_À·_˛ick_down
 = 
Ál£
;

548 i‡(
evít
.
ty≥
 =
SDL_QUIT
)

550 
ru¬ög
 = 
Ál£
;

552 i‡(
evít
.
ty≥
 =
SDL_MOUSEWHEEL
)

554 i‡(
evít
.
whìl
.
y
 != 0)

556 
ui_°©e
.
whìl_move
 = (Ë
evít
.
whìl
.
y
;

557 #ifde‡
EMSCRIPTEN


559 
ui_°©e
.
whìl_move
 /= 100.0f;

565 
boﬁ
 
mou£_moved_this_‰ame
 = 
ui_°©e
.
mou£Pos
.
x
 !ui_°©e.
mou£_œ°_pos
.x || ui_°©e.mou£Pos.
y
 != ui_state.mouse_last_pos.y;

566 
boﬁ
 
À·_˛ick_a˘i⁄_ªsﬁved
 = 
Ál£
;

568 
	`H™dÀSh¨edEvíts
(&
ui_°©e
, &
ˇmîa_game
, &
ˇmîa
, 
mou£_moved_this_‰ame
, 
s˚√
);

570 i‡(
ui_°©e
.
˛ick_À·_down_this_‰ame
 && !ui_°©e.
shi·_key_down
 && !
À·_˛ick_a˘i⁄_ªsﬁved
 && 
s˚√
 =
SCENE_TYPE
::
ST_EDITOR
)

572 
glm
::
vec2
 
∑Àã_game•a˚_°¨t
 = 
	`m©h_s¸ìn•a˚_to_game•a˚
(
edô‹_s˚√_°©e
->
∑Àã_s¸ìn_°¨t
, 
ˇmîa_game
, 
ˇmîa_võwp‹t
, 
ui_°©e
.
game_height_cuºít
);

573 
boﬁ
 
˛ickedPÆëe
 = 
	`m©h_˛ick_is_öside_AABB
(

574 
∑Àã_game•a˚_°¨t
.
x
,

575 
∑Àã_game•a˚_°¨t
.
y
,

576 
∑Àã_game•a˚_°¨t
.
x
 + 
∑Àã_Àngth
,

577 
∑Àã_game•a˚_°¨t
.
y
 + 1,

578 
ui_°©e
.
mou£GamePos
.
x
,

579 
ui_°©e
.
mou£GamePos
.
y
);

580 i‡(
˛ickedPÆëe
)

583 
≥r˚¡ageX
 = 
	`≥r˚¡_bëwìn_two_poöts
(
ui_°©e
.
mou£GamePos
.
x
, 
∑Àã_game•a˚_°¨t
.x,ÖÆëe_game•a˚_°¨t.x + 
∑Àã_Àngth
);

584 
∑Àã_˚Œ_˛icked
 = ()(
≥r˚¡ageX
 * 
∑Àã_Àngth
);

585 
edô‹_s˚√_°©e
->
cuºítBrush
 = 
∑Àã_˚Œ_˛icked
;

587 
À·_˛ick_a˘i⁄_ªsﬁved
 = 
åue
;

593 #¥agm®
ídªgi⁄


594 #¥agm®
ªgi⁄
 
GLCÀ¨
 
And
 
Upd©e
 
Dñè
 
Time


595 
	`glCÀ¨
(
GL_COLOR_BUFFER_BIT
 | 
GL_DEPTH_BUFFER_BIT
);

596 
	`glCÀ¨Cﬁ‹
(0.1f, 0.1f, 0.1f, 1.0f);

598 
dñè
 = 0;

599 
tŸÆ_time
;

601 
cuºít_time_ms
 = 
	`SDL_GëTicks
();

602 
dñè_ms
 = (Ë(
cuºít_time_ms
 - 
œ°_‰ame_time_ms
);

603 
œ°_‰ame_time_ms
 = 
cuºít_time_ms
;

604 
dñè
 = 
dñè_ms
 / 1000.0f;

605 
tŸÆ_time
 = (
cuºít_time_ms
 - 
°¨t_time_ms
) / 1000.0f;

607 
ui_°©e
.
time_tûl_∂ayî_ˇn_move
 = 
	`maxf
(0, ui_°©e.time_tûl_∂ayî_ˇn_movê- 
dñè
);

608 
ui_°©e
.
time_sö˚_œ°_∂ayî_a˘i⁄
 +
dñè
;

609 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 +
dñè
;

610 
ui_°©e
.
tŸÆ_time_∑s£d
 = 
tŸÆ_time
;

612 #¥agm®
ídªgi⁄


614 i‡(
s˚√
 =
ST_EDITOR
)

616 #¥agm®
ªgi⁄
 
h™dÀ_evíts


618 
boﬁ
 
mou£_moved_this_‰ame
 = 
ui_°©e
.
mou£Pos
.
x
 !ui_°©e.
mou£_œ°_pos
.x || ui_°©e.mou£Pos.
y
 != ui_state.mouse_last_pos.y;

619 i‡(
ui_°©e
.
back•a˚_key_down_this_‰ame
)

621 
s˚√
 = 
SCENE_TYPE
::
ST_MENU
;

622 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 = 0;

623 
ui_°©e
.
time_sö˚_œ°_∂ayî_a˘i⁄
 = 0;

625 i‡(
ui_°©e
.
upd©e_a˘uÆ_s¸ìn_size
)

628 
	`ªsize_s¸ìn_°©eful
(
ui_°©e
.
√xt_ˇmîa_size
.
x
, ui_°©e.√xt_ˇmîa_size.
y
);

630 i‡(
ui_°©e
.
Àâîs
['k' - 'a'].
¥es£d_this_‰ame
)

632 
	`SDL_SëWödowSize
(
wödow
,1200, 900);

633 
	`ªsize_s¸ìn_°©eful
(1200, 900);

636 i‡(
ui_°©e
.
ty≥
 =
ECS_BRUSH
)

638 i‡(
ui_°©e
.
mou£_À·_˛ick_down
)

639 
	`MaybeAµlyBrush
(
edô‹_s˚√_°©e
->
∑Àã
,edô‹_s˚√_°©e->
cuºítBrush
, &
ui_°©e
,edô‹_s˚√_°©e->
timeMachöe
, ui_°©e.
mou£GamePos
);

641 
ui_°©e
.
ty≥
 = 
ECS_NEUTRAL
;

643 i‡(
ui_°©e
.
ty≥
 =
ECS_NEUTRAL
)

646 i‡(
ui_°©e
.
Àâîs
['y' - 'a'].
¥es£d_this_‰ame
)

648 
ödex_˛icked
 = 
	`game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_game°©e
(
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
);

649 i‡(
ödex_˛icked
 >= 0)

652 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_ch™ge_Àvñ_mode
(
ödex_˛icked
,
LevñMode
::
CrumbÀ
);

653 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

656 i‡(
ui_°©e
.
Àâîs
['u' - 'a'].
¥es£d_this_‰ame
)

658 
ödex_˛icked
 = 
	`game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_game°©e
(
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
);

659 i‡(
ödex_˛icked
 >= 0)

662 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_ch™ge_Àvñ_mode
(
ödex_˛icked
,
LevñMode
::
Rïót
);

663 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

666 i‡(
ui_°©e
.
Àâîs
['i' - 'a'].
¥es£d_this_‰ame
)

668 
ödex_˛icked
 = 
	`game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_game°©e
(
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
);

669 i‡(
ödex_˛icked
 >= 0)

672 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_ch™ge_Àvñ_mode
(
ödex_˛icked
,
LevñMode
::
Ovîw‹ld
);

673 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

677 i‡(
ui_°©e
.
Àâîs
['m' - 'a'].
¥es£d_this_‰ame
)

679 
	`£tup_w‹ld_s¸ìn_°©eful
(
SCENE_TYPE
::
ST_EDITOR
);

682 i‡(
ui_°©e
.
Àâîs
['o' - 'a'].
¥es£d_this_‰ame
)

684 
°d
::
°rög
 
to_lﬂd
 = 
	`lﬂd_puzzÀ_fûe
();

685 i‡(
to_lﬂd
 == "")

687 
°d
::
cout
 << "uh oh, ourÜoad ofá game didn't work,Çothings happened!";

691 
	`lﬂd_edô‹_Àvñ_°©eful
(
to_lﬂd
);

695 i‡(
ui_°©e
.
Àâîs
['p' - 'a'].
¥es£d_this_‰ame
)

698 
°d
::
°rög
 
to_¥öt
 = 
	`∑r£_£rülize_timemachöe
(&(
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
), 
‰ame_mem‹y
, frame_memory);

699 
	`ßve_puzzÀ_fûe
(
to_¥öt
);

700 
°d
::
cout
 << 
to_¥öt
 << std::
ídl
;

708 i‡(
ui_°©e
.
Àâîs
['w' - 'a'].
¥es£d_this_‰ame
)

710 
W‹ldPosôi⁄
 
posôi⁄_˛icked
 = 
	`game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_fuŒ
(
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
);

711 i‡(
posôi⁄_˛icked
.
Àvñ_ödex
 >0 &&Öosôi⁄_˛icked.
Àvñ_posôi⁄_1d
 >= 0)

713 
GameSèã
* 
°©e
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
posôi⁄_˛icked
.
Àvñ_ödex
];

715 
GameSèã
* 
√xt
 = 
	`game°©e_add_row
(
°©e
, 
edô‹_s˚√_°©e
->
timeMachöe
->
game°©e_mem‹y
, 
posôi⁄_˛icked
.
Àvñ_posôi⁄
.
x
,Öosôi⁄_˛icked.Àvñ_posôi⁄.
y
);

716 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_upd©e_game°©e
(
√xt
, 
posôi⁄_˛icked
.
Àvñ_ödex
, 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_«mes
[position_clicked.level_index]);

717 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

722 i‡(
ui_°©e
.
Àâîs
['h' - 'a'].
¥es£d_this_‰ame
)

725 
W‹ldPosôi⁄
 
posôi⁄_˛icked
 = 
	`game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_fuŒ
(
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
);

726 
ödex_˛icked
 = 
posôi⁄_˛icked
.
Àvñ_ödex
;

727 
I¡Paú
 
grid_˛icked
 = 
posôi⁄_˛icked
.
Àvñ_posôi⁄
;

728 i‡(
ödex_˛icked
 >= 0)

730 
GameSèã
* 
°©e
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
ödex_˛icked
];

732 
GameSèã
* 
√xt
 = 
	`game°©e_add_cﬁumn
(
°©e
, 
≥rm™ít_mem‹y
, 
grid_˛icked
.
x
, grid_˛icked.
y
);

733 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_upd©e_game°©e
(
√xt
, 
ödex_˛icked
, 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_«mes
[index_clicked]);

734 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

738 i‡(
ui_°©e
.
Àâîs
['c' - 'a'].
¥es£d_this_‰ame
)

740 
ödex_˛icked
 = 
	`game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_game°©e
(
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
);

741 i‡(
ödex_˛icked
 >= 0)

743 
GameSèã
* 
°©e
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
ödex_˛icked
];

744 
GameSèã
* 
√xt
 = 
	`game°©e_suºound_wôh_wÆls
(
°©e
, 
≥rm™ít_mem‹y
);

745 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_upd©e_game°©e
(
√xt
, 
ödex_˛icked
, 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_«mes
[index_clicked ]);

746 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

750 i‡(
ui_°©e
.
˛ick_À·_down_this_‰ame
 && ui_°©e.
c⁄åﬁ_key_down
)

752 
ödex_˛icked
 = 
	`game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_game°©e
(
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
);

753 i‡(
ödex_˛icked
 >= 0)

755 
GameSèã
* 
cuºítSèã
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
ödex_˛icked
];

756 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_dñëe_game°©e
(
ödex_˛icked
);

757 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

758 
À·_˛ick_a˘i⁄_ªsﬁved
 = 
åue
;

762 i‡(
ui_°©e
.
˛ick_À·_down_this_‰ame
 && ui_°©e.
Æt_key_down
 && !
À·_˛ick_a˘i⁄_ªsﬁved
)

764 
ödex_˛icked
 = 
	`game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_game°©e
(
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
);

765 i‡(
ödex_˛icked
 >= 0)

768 
GameSèã
* 
°¨t_°©e
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
ödex_˛icked
];

771 
∂ay_s˚√_°©e
.
timeMachöe
 = 
	`game°©e_timemachöe_¸óã
(
°¨t_°©e
, 
∂ay_mem‹y
, 
max_a˘i⁄s_ö_puzzÀ
);

772 
∂ay_s˚√_°©e
.
timeMachöe_edô
 = 
	`game°©e_timemachöe_¸óã
(
°¨t_°©e
, 
∂ay_mem‹y
, 
max_a˘i⁄s_ö_puzzÀ
);

773 
∂ay_s˚√_°©e
.
loc
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
ödex_˛icked
];

774 
∂ay_s˚√_°©e
.
loc_edô
 =Öœy_s˚√_°©e.
loc
;

775 
∂ay_s˚√_°©e
.
loc_edô
.
x
 +(
°¨t_°©e
->
w
 + 2);

776 
∂ay_s˚√_°©e
.
edô‹_posôi⁄_ö_time_machöe
 = 
ödex_˛icked
;

777 
i
 = 0; i < 
GAME_LEVEL_NAME_MAX_SIZE
; i++)

779 
∂ay_s˚√_°©e
.
game_«me
[
i
] = 0;

781 
∂ay_s˚√_°©e
.
game_«me_Àngth
 = 0;

783 
i
 = 0; i < 
GAME_LEVEL_NAME_MAX_SIZE
; i++)

784 
∂ay_s˚√_°©e
.
game_«me
[
i
] = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_«mes
[
ödex_˛icked
].
«me
[i];

785 
∂ay_s˚√_°©e
.
game_«me_Àngth
 = (Ë
	`°æí
(
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_«mes
[
ödex_˛icked
].
«me
);

787 
s˚√
 = 
ST_EDIT_LEVEL
;

788 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 = 0;

793 i‡(
ui_°©e
.
˛ick_À·_down_this_‰ame
 && !ui_°©e.
shi·_key_down
 && !
À·_˛ick_a˘i⁄_ªsﬁved
)

795 
À·_˛ick_a˘i⁄_ªsﬁved
 = 
	`MaybeAµlyBrush
(
edô‹_s˚√_°©e
->
∑Àã
,Édô‹_s˚√_°©e->
cuºítBrush
, &
ui_°©e
,Édô‹_s˚√_°©e->
timeMachöe
, ui_°©e.
mou£GamePos
);

798 i‡(
ui_°©e
.
mou£_À·_˛ick_down
 && !ui_°©e.
shi·_key_down
 && !
À·_˛ick_a˘i⁄_ªsﬁved
)

801 
i
 = 0; i < 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
; i++)

803 
box_À·
 = ()
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
x
;

804 
box_width
 = ()
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
w
;

805 
box_right
 = 
box_À·
 + 
box_width
;

806 
box_down
 = ()
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
y
;

807 
box_height
 = ()
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
h
;

808 
box_up
 = 
box_down
 + 
box_height
;

809 
AABB
 
À·
 = 
	`m©h_AABB_¸óã
(
box_À·
 - 
OUTLINE_DRAW_SIZE
,

810 
box_down
 - 
OUTLINE_DRAW_SIZE
,

811 
OUTLINE_DRAW_SIZE
,

812 
box_height
 + 
OUTLINE_DRAW_SIZE
 * 2);

813 
AABB
 
right
 = 
	`m©h_AABB_¸óã
(
box_right
,

814 
box_down
 - 
OUTLINE_DRAW_SIZE
,

815 
OUTLINE_DRAW_SIZE
,

816 
box_height
 + 
OUTLINE_DRAW_SIZE
 * 2);

817 
AABB
 
up
 = 
	`m©h_AABB_¸óã
(
box_À·
 - 
OUTLINE_DRAW_SIZE
,

818 
box_up
,

819 
box_width
 + 
OUTLINE_DRAW_SIZE
 * 2,

820 
OUTLINE_DRAW_SIZE
);

821 
AABB
 
down
 = 
	`m©h_AABB_¸óã
(
box_À·
 - 
OUTLINE_DRAW_SIZE
,

822 
box_down
 - 
OUTLINE_DRAW_SIZE
,

823 
box_width
 + 
OUTLINE_DRAW_SIZE
 * 2,

824 
OUTLINE_DRAW_SIZE
);

826 
boﬁ
 
˛ick_À·
 = 
	`m©h_˛ick_is_öside_AABB
(
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
, 
À·
);

827 
boﬁ
 
˛ick_right
 = 
	`m©h_˛ick_is_öside_AABB
(
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
, 
right
);

828 
boﬁ
 
˛ick_up
 = 
	`m©h_˛ick_is_öside_AABB
(
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
, 
up
);

829 
boﬁ
 
˛ick_down
 = 
	`m©h_˛ick_is_öside_AABB
(
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
, 
down
);

830 i‡(
˛ick_À·
 || 
˛ick_right
 || 
˛ick_up
 || 
˛ick_down
)

832 
ui_°©e
.
ty≥
 = 
ECS_RESIZE_GAMESTATE
;

833 
ui_°©e
.
un
.
ªsize
.
døggög_À·
 = 
Ál£
;

834 
ui_°©e
.
un
.
ªsize
.
døggög_right
 = 
Ál£
;

835 
ui_°©e
.
un
.
ªsize
.
døggög_up
 = 
Ál£
;

836 
ui_°©e
.
un
.
ªsize
.
døggög_down
 = 
Ál£
;

837 i‡(
˛ick_À·
)

838 
ui_°©e
.
un
.
ªsize
.
døggög_À·
 = 
åue
;

839 i‡(
˛ick_right
)

840 
ui_°©e
.
un
.
ªsize
.
døggög_right
 = 
åue
;

841 i‡(
˛ick_up
)

842 
ui_°©e
.
un
.
ªsize
.
døggög_up
 = 
åue
;

843 i‡(
˛ick_down
)

844 
ui_°©e
.
un
.
ªsize
.
døggög_down
 = 
åue
;

846 
ui_°©e
.
un
.
ªsize
.
døggög_game°©e_ödex
 = 
i
;

847 
À·_˛ick_a˘i⁄_ªsﬁved
 = 
åue
;

848 
døggög_°¨t_posôi⁄_ö_game•a˚
 = 
ui_°©e
.
mou£GamePos
;

853 i‡(
ui_°©e
.
mou£_À·_˛ick_down
 && ui_°©e.
shi·_key_down
)

855 
ödex_˛icked
 = 
	`game°©e_timemachöe_gë_˛ick_cﬁlisi⁄_game°©e
(
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
.
mou£GamePos
.
x
, ui_°©e.mou£GamePos.
y
);

856 i‡(
ödex_˛icked
 >= 0)

858 
ui_°©e
.
ty≥
 = 
ECS_MOVE_GAMESTATE
;

859 
ui_°©e
.
un
.
move
.
movög_game°©e_ödex
 = 
ödex_˛icked
;

860 
ui_°©e
.
un
.
move
.
move_°¨t_posôi⁄
 = ui_°©e.
mou£GamePos
;

861 
À·_˛ick_a˘i⁄_ªsﬁved
 = 
åue
;

865 i‡(
ui_°©e
.
˛ick_À·_down_this_‰ame
 && !ui_°©e.
shi·_key_down
 && !
À·_˛ick_a˘i⁄_ªsﬁved
)

868 
I¡Paú
 
game_w‹ld_˛ick
 = 
	`m©h_öçaú_¸óã
((Ë
	`Êo‹
(
ui_°©e
.
mou£GamePos
.
x
),(ËÊo‹(ui_°©e.mou£GamePos.
y
));

869 
ui_°©e
.
ty≥
 = 
ECS_CREATE_GAMESTATE
;

870 
ui_°©e
.
un
.
¸óã
.
gamew‹ld_°¨t_pos
 = 
game_w‹ld_˛ick
;

872 i‡(
ui_°©e
.
z_key_down_this_‰ame
 && !
À·_˛ick_a˘i⁄_ªsﬁved
)

874 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
;

875 
a˘i⁄
.a˘i⁄ = 
TM_UNDO
;

876 
a˘i⁄
.
u
.
ªmove
.
game°©e_ödex
 = -1;

877 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
,Édô‹_s˚√_°©e->
time_machöe_°¨t_°©e
, 
a˘i⁄
);

878 
À·_˛ick_a˘i⁄_ªsﬁved
 = 
åue
;

882 i‡(
ui_°©e
.
ty≥
 =
ECS_RESIZE_GAMESTATE
)

885 i‡(
ui_°©e
.
˛ick_À·_up_this_‰ame
)

888 
glm
::
vec2
 
off£t
 = 
ui_°©e
.
mou£GamePos
 - 
døggög_°¨t_posôi⁄_ö_game•a˚
;

890 
I¡Paú
 
èrgëãd_game°©e_posôi⁄
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
ui_°©e
.
un
.
ªsize
.
døggög_game°©e_ödex
];

891 
GameSèã
* 
èrgëãd_game°©e
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
ui_°©e
.
un
.
ªsize
.
døggög_game°©e_ödex
];

892 
èrgëãd_game°©e_width
 = 
èrgëãd_game°©e
->
w
;

893 
èrgëãd_game°©e_height
 = 
èrgëãd_game°©e
->
h
;

895 
AABB
 
ﬁd
 = 
	`m©h_AABB_¸óã
((Ë
èrgëãd_game°©e_posôi⁄
.
x
,

896 (Ë
èrgëãd_game°©e_posôi⁄
.
y
,

897 (Ë
èrgëãd_game°©e_width
,

898 (Ë
èrgëãd_game°©e_height
);

899 
AABB
 
√xt
 = 
ﬁd
;

905 
off£t_x
 = 
	`sign
(
off£t
.
x
) * 0.5f;

906 
off£t_y
 = 
	`sign
(
off£t
.
y
) * 0.5f;

907 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_À·
)

909 
À·_movemít
 = ()(
ui_°©e
.
mou£GamePos
.
x
 - (()
√xt
.xË+ 
off£t_x
);

910 i‡(
À·_movemít
 != 0)

912 
√xt
.
x
 +
À·_movemít
;

913 
√xt
.
w
 -
À·_movemít
;

916 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_right
)

918 
right_movemít
 = ()(
ui_°©e
.
mou£GamePos
.
x
 - (()
√xt
.x +Çext.
w
Ë+ 
off£t_x
);

919 i‡(
right_movemít
 != 0)

920 
√xt
.
w
 +
right_movemít
;

922 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_down
)

924 
down_movemít
 = ()(
ui_°©e
.
mou£GamePos
.
y
 - (()
√xt
.yË+ 
off£t_y
);

925 i‡(
down_movemít
 != 0)

927 
√xt
.
y
 +
down_movemít
;

928 
√xt
.
h
 -
down_movemít
;

931 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_up
)

933 
up_movemít
 = ()(
ui_°©e
.
mou£GamePos
.
y
 - (()
√xt
.y +Çext.
h
Ë+ 
off£t_y
);

934 i‡(
up_movemít
 != 0)

935 
√xt
.
h
 +
up_movemít
;

938 
boﬁ
 
ch™geOccuªd
 = 
√xt
.
x
 !
èrgëãd_game°©e_posôi⁄
.x

939 || 
√xt
.
y
 !
èrgëãd_game°©e_posôi⁄
.y

940 || 
√xt
.
w
 !
èrgëãd_game°©e
->w

941 || 
√xt
.
h
 !
èrgëãd_game°©e
->h;

944 i‡(
√xt
.
w
 <= 0)

946 
go_back
 = (Ë
√xt
.
w
 - 1;

947 
√xt
.
w
 = 1;

948 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_À·
)

950 
√xt
.
x
 +
go_back
;

954 i‡(
√xt
.
h
 <= 0)

956 
go_back
 = (Ë
√xt
.
h
 - 1;

957 
√xt
.
h
 = 1;

958 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_down
)

960 
√xt
.
y
 +
go_back
;

965 i‡(
ch™geOccuªd
)

967 
AABB
* 
boxes
 = 
	`game°©e_¸óã_cﬁlidîs
(
‰ame_mem‹y
,

968 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
,

969 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
,

970 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
,

971 
ui_°©e
.
un
.
ªsize
.
døggög_game°©e_ödex
);

972 
boﬁ
 
ch™geVÆid
 = !
	`m©h_AABB_is_cﬁlidög
(
√xt
, 
boxes
, 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
 - 1);

973 i‡(
ch™geVÆid
)

975 
I¡Paú
 
√xt_size
;

976 
√xt_size
.
x
 = (Ë
√xt
.
w
;

977 
√xt_size
.
y
 = (Ë
√xt
.
h
;

978 
I¡Paú
 
di•œ˚mít
;

979 
di•œ˚mít
.
x
 = (Ë(-
√xt
.x + 
èrgëãd_game°©e_posôi⁄
.x);

980 
di•œ˚mít
.
y
 = (Ë(-
√xt
.y + 
èrgëãd_game°©e_posôi⁄
.y);

981 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 =

982 
	`game°©e_timemachöó˘i⁄_¸óã_ªsize_gam£°©e
(
ui_°©e
.
un
.
ªsize
.
døggög_game°©e_ödex
, 
√xt
, 
di•œ˚mít
);

983 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

988 
ui_°©e
.
ty≥
 = 
ECS_NEUTRAL
;

991 i‡(
ui_°©e
.
ty≥
 =
ECS_MOVE_GAMESTATE
 && ui_°©e.
˛ick_À·_up_this_‰ame
)

994 
AABB
 
√xt
 = 
	`ˇlcuœã_ouéöe_‰om_move_öfo
(
‰ame_mem‹y
, 
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
);

995 
AABB
* 
boxes
 = 
	`game°©e_¸óã_cﬁlidîs
(
‰ame_mem‹y
,

996 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
,

997 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
,

998 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
,

999 
ui_°©e
.
un
.
move
.
movög_game°©e_ödex
);

1000 
boﬁ
 
ch™geVÆid
 = !
	`m©h_AABB_is_cﬁlidög
(
√xt
, 
boxes
, 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
 - 1);

1001 i‡(
ch™geVÆid
)

1004 
glm
::
vec2
 
di°™˚
 = 
ui_°©e
.
mou£GamePos
 - ui_°©e.
un
.
move
.
move_°¨t_posôi⁄
;

1006 
I¡Paú
 
off£t
 = 
	`m©h_öçaú_¸óã
(()
di°™˚
.
x
, ()di°™˚.
y
);

1008 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_move_game°©e
(
ui_°©e
.
un
.
move
.
movög_game°©e_ödex
, 
off£t
);

1009 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

1013 
ui_°©e
.
ty≥
 = 
ECS_NEUTRAL
;

1015 i‡(
ui_°©e
.
ty≥
 =
ECS_CREATE_GAMESTATE
 && !ui_°©e.
˛ick_À·_down_this_‰ame
)

1018 i‡(
ui_°©e
.
˛ick_À·_up_this_‰ame
)

1021 
AABB
 
√xt
 = 
	`ˇlcuœã_ouéöe_‰om_¸óã_öfo
(
‰ame_mem‹y
, 
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
);

1022 
AABB
* 
boxes
 = 
	`game°©e_¸óã_cﬁlidîs
(
‰ame_mem‹y
,

1023 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
,

1024 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
,

1025 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
);

1026 
boﬁ
 
suc˚ssful_∂™t
 = !
	`m©h_AABB_is_cﬁlidög
(
√xt
, 
boxes
, 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
);

1027 i‡(
suc˚ssful_∂™t
)

1029 
AABB
 
cuºít_ouéöe
 = 
	`ˇlcuœã_ouéöe_‰om_¸óã_öfo
(
‰ame_mem‹y
, 
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
);

1030 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_¸óã_a˘i⁄
((Ë
cuºít_ouéöe
.
x
, (Ëcuºít_ouéöe.
y
, (Ëcuºít_ouéöe.
w
, (Ëcuºít_ouéöe.
h
);

1031 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

1033 
ui_°©e
.
ty≥
 = 
ECS_NEUTRAL
;

1038 #¥agm®
ídªgi⁄


1040 i‡(
s˚√
 =
ST_EDIT_LEVEL
)

1042 #¥agm®
ªgi⁄
 
h™dÀ_evíts


1043 i‡(
ui_°©e
.
ty≥
 =
ECS_BRUSH
)

1045 i‡(
ui_°©e
.
mou£_À·_˛ick_down
)

1046 
boﬁ
 
À·_˛ick_a˘i⁄_ªsﬁved
 = 
	`MaybeAµlyBrushInPœyMode
(
∂ay_mem‹y
, 
edô‹_s˚√_°©e
->
∑Àã
,Édô‹_s˚√_°©e->
cuºítBrush
, &
ui_°©e
, 
∂ay_s˚√_°©e
.
timeMachöe_edô
,Öœy_s˚√_°©e.
loc_edô
, ui_°©e.
mou£GamePos
);

1048 
ui_°©e
.
ty≥
 = 
ECS_NEUTRAL
;

1050 i‡(
ui_°©e
.
ty≥
 =
ECS_NEUTRAL
)

1052 
	`h™dÀ_√xt_a˘i⁄_°©eful
(
∂ay_s˚√_°©e
.
timeMachöe
,Öœy_s˚√_°©e.
loc
);

1053 i‡(
ui_°©e
.
•a˚b¨
.
¥es£d_this_‰ame
)

1055 
GameSèã
* 
cuºít_edô_°©e
 = &
∂ay_s˚√_°©e
.
timeMachöe_edô
->
°©e_¨øy
[∂ay_s˚√_°©e.timeMachöe_edô->
num_game°©es_°‹ed
 - 1];

1056 
∂ay_s˚√_°©e
.
timeMachöe
 = 
	`game°©e_timemachöe_¸óã
(
cuºít_edô_°©e
, 
∂ay_mem‹y
, 
MAX_NUMBER_GAMESTATES
);

1059 i‡(
ui_°©e
.
mou£_À·_˛ick_down
)

1061 
boﬁ
 
À·_˛ick_a˘i⁄_ªsﬁved
 = 
	`MaybeAµlyBrushInPœyMode
(
∂ay_mem‹y
, 
edô‹_s˚√_°©e
->
∑Àã
,Édô‹_s˚√_°©e->
cuºítBrush
, &
ui_°©e
, 
∂ay_s˚√_°©e
.
timeMachöe_edô
,Öœy_s˚√_°©e.
loc_edô
, ui_°©e.
mou£GamePos
);

1062 i‡(
À·_˛ick_a˘i⁄_ªsﬁved
)

1063 
ui_°©e
.
ty≥
 = 
ECS_BRUSH
;

1065 i‡(
ui_°©e
.
back•a˚_key_down_this_‰ame
)

1067 
s˚√
 = 
ST_EDITOR
;

1068 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 = 0;

1069 
num_°©es
 = 
∂ay_s˚√_°©e
.
timeMachöe_edô
->
num_game°©es_°‹ed
;

1070 
GameSèã
* 
°©e_to_ö£π
 = 
	`game°©e_˛⁄e
(&
∂ay_s˚√_°©e
.
timeMachöe_edô
->
°©e_¨øy
[
num_°©es
 - 1], 
≥rm™ít_mem‹y
);

1071 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_ª∂a˚_game°©e
(
°©e_to_ö£π
, 
∂ay_s˚√_°©e
.
edô‹_posôi⁄_ö_time_machöe
,Öœy_s˚√_°©e.
game_«me
);

1072 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
edô‹_s˚√_°©e
->
timeMachöe
, 
NULL
, 
a˘i⁄
);

1074 i‡(
ui_°©e
.
shi·_key_down_this_‰ame
)

1076 
ui_°©e
.
ty≥
 = 
ECS_EDIT_NAME
;

1078 i‡(
ui_°©e
.
z_key_down_this_‰ame
)

1080 
	`game°©e_timemachöe_undo
(
∂ay_s˚√_°©e
.
timeMachöe
);

1083 i‡(
ui_°©e
.
ty≥
 =
ECS_EDIT_NAME
)

1085 i‡(
∂ay_s˚√_°©e
.
game_«me_Àngth
 < 
GAME_LEVEL_NAME_MAX_SIZE
)

1087 
i
 = 0; i < 
NUM_LETTERS_ON_KEYBOARD
 - 1; i++)

1089 i‡(
ui_°©e
.
Àâîs
[
i
].
¥es£d_this_‰ame
)

1092 
Àngth
 = 
∂ay_s˚√_°©e
.
game_«me_Àngth
;

1093 
∂ay_s˚√_°©e
.
game_«me
[
Àngth
] = ('a' + (Ë
i
);

1094 
∂ay_s˚√_°©e
.
game_«me
[
Àngth
 + 1] = 0;

1095 
∂ay_s˚√_°©e
.
game_«me_Àngth
++;

1098 i‡(
ui_°©e
.
•a˚b¨
.
¥es£d_this_‰ame
)

1100 
Àngth
 = 
∂ay_s˚√_°©e
.
game_«me_Àngth
;

1101 
∂ay_s˚√_°©e
.
game_«me
[
Àngth
] = ' ';

1102 
∂ay_s˚√_°©e
.
game_«me
[
Àngth
 + 1] = 0;

1103 
∂ay_s˚√_°©e
.
game_«me_Àngth
++;

1106 i‡(
∂ay_s˚√_°©e
.
game_«me_Àngth
 > 0)

1108 i‡(
ui_°©e
.
back•a˚_key_down_this_‰ame
)

1110 
Àngth
 = 
∂ay_s˚√_°©e
.
game_«me_Àngth
;

1111 
∂ay_s˚√_°©e
.
game_«me
[
Àngth
 - 1] = 0;

1112 
∂ay_s˚√_°©e
.
game_«me_Àngth
--;

1115 i‡(
ui_°©e
.
íãr
.
¥es£d_this_‰ame
)

1117 
ui_°©e
.
ty≥
 = 
ECS_NEUTRAL
;

1121 #¥agm®
ídªgi⁄


1124 i‡(
s˚√
 =
ST_PLAY_WORLD
)

1126 #¥agm®
ªgi⁄
 
ßve
 
°©e
 
öfo
 
bef‹e
 
evíts


1127 
ﬁd_game°©e_num_∂ayî_°™dög_⁄
 = 
w‹ld_s˚√_°©e
->
cuºít_Àvñ
;

1128 #¥agm®
ídªgi⁄


1129 #¥agm®
ªgi⁄
 
h™dÀ_evíts


1130 
boﬁ
 
w‹ld_a˘i⁄_èkí
 = 
Ál£
;

1131 
A˘i⁄
 
a˘i⁄
 = 
	`ˇlcuœã_wh©_a˘i⁄_to_èke_√xt_°©eful
();

1132 
Dúe˘i⁄
 
to_èke
 = 
	`a˘i⁄_to_dúe˘i⁄
(
a˘i⁄
);

1133 i‡(
to_èke
 !
Dúe˘i⁄
::
NO_DIRECTION
)

1135 
w‹ld_∂ay_s˚√_°©e
 = 
	`w‹ld_∂ayî_a˘i⁄
(
w‹ld_s˚√_°©e
, 
to_èke
, 
Àvñ_mem‹y
);

1136 
ui_°©e
.
time_tûl_∂ayî_ˇn_move
 = 
WAIT_BETWEEN_PLAYER_MOVE_REPEAT
;

1137 
ui_°©e
.
time_sö˚_œ°_∂ayî_a˘i⁄
 = 0;

1139 i‡(
ui_°©e
.
back•a˚_key_down_this_‰ame
)

1141 
s˚√
 = 
w‹ld_s˚√_°©e
->
go_to_⁄_back•a˚
;

1142 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 = 0;

1143 
ui_°©e
.
time_sö˚_œ°_∂ayî_a˘i⁄
 = 0;

1145 i‡(
ui_°©e
.
Àâîs
['p' - 'a'].
¥es£d_this_‰ame
)

1148 
°d
::
°rög
 
∑r£d
 = 
	`∑r£_£rülize_timemachöe
(&
w‹ld_s˚√_°©e
->
w‹ld_°©e
, 
≥rm™ít_mem‹y
, 
‰ame_mem‹y
);

1149 
	`ßve_c⁄töue_fûe
(
∑r£d
);

1154 i‡(!
	`™y_Àvñs_À·_a˘ive
(
w‹ld_s˚√_°©e
))

1156 
s˚√
 = 
SCENE_TYPE
::
ST_SHOW_TEXT
;

1157 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 = 0;

1158 
ui_°©e
.
time_sö˚_œ°_∂ayî_a˘i⁄
 = 0;

1159 
ãxt_s˚√_°©e
 = 
	`buûd_ãxt_s˚√
("Wö√r! Th™k†f‹Öœyög.", 
SCENE_TYPE
::
ST_MENU
, 
ãxt_mem‹y
, 
ui_°©e
.
tŸÆ_time_∑s£d
, 5.0f);

1162 i‡(
w‹ld_∂ay_s˚√_°©e
 !
NULL
)

1164 
s˚√
 = 
SCENE_TYPE
::
ST_PLAY_LEVEL
;

1165 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 = 0;

1166 
ui_°©e
.
time_sö˚_œ°_∂ayî_a˘i⁄
 = 0;

1171 #¥agm®
ídªgi⁄


1172 #¥agm®
ªgi⁄
 
h™dÀ_°©e_upd©e


1175 
cuºít_num_∂ayî_°™dög_⁄
 = 
w‹ld_s˚√_°©e
->
cuºít_Àvñ
;

1176 i‡(
ﬁd_game°©e_num_∂ayî_°™dög_⁄
 !
cuºít_num_∂ayî_°™dög_⁄
)

1178 
w‹ld_ˇmîa_ÀΩ
 = 0;

1179 
GameSèã
* 
cuºít_game°©e
 = 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_°©e
[
cuºít_num_∂ayî_°™dög_⁄
];

1180 
I¡Paú
 
game°©e_pos
 = 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
cuºít_num_∂ayî_°™dög_⁄
];

1181 
w‹ld_ˇmîa_gﬂl
 = 
	`m©h_ˇmîa_buûd_f‹_game°©e
(
cuºít_game°©e
, 
game°©e_pos
, 
ˇmîa_võwp‹t
);

1183 i‡(
w‹ld_s˚√_°©e
->
œ°_a˘i⁄_was_ãÀp‹t
)

1184 
w‹ld_ˇmîa_°¨t
 = 
w‹ld_ˇmîa_gﬂl
;

1186 
w‹ld_ˇmîa_°¨t
 = 
w‹ld_ˇmîa
;

1190 
w‹ld_ˇmîa_ÀΩ
 +
dñè
;

1192 
w‹ld_ˇmîa
 = 
	`m©h_ˇmîa_move_tow¨ds_ÀΩ
(
w‹ld_ˇmîa_°¨t
, 
w‹ld_ˇmîa_gﬂl
, 
w‹ld_ˇmîa_ÀΩ
, 
CAMERA_LERP_TIME
);

1194 #¥agm®
ídªgi⁄


1197 i‡(
s˚√
 =
ST_PLAY_LEVEL
)

1199 #¥agm®
ªgi⁄
 
ßve
 
°©e
 
öfo
 
bef‹e
 
evíts


1200 
ﬁd_game°©e_num_∂ayî_°™dög_⁄
 = 
w‹ld_s˚√_°©e
->
cuºít_Àvñ
;

1201 #¥agm®
ídªgi⁄


1202 #¥agm®
ªgi⁄
 
h™dÀ
 
evíts


1204 
	`h™dÀ_√xt_a˘i⁄_°©eful
(
w‹ld_∂ay_s˚√_°©e
->
time_machöe
,w‹ld_∂ay_s˚√_°©e->
døw_posôi⁄
);

1207 #¥agm®
ídªgi⁄


1208 #¥agm®
ªgi⁄
 
h™dÀ_°©e_upd©e


1210 i‡(
	`game°©e_is_ö_wö_c⁄dôi⁄
(&
w‹ld_∂ay_s˚√_°©e
->
time_machöe
->
°©e_¨øy
[w‹ld_∂ay_s˚√_°©e->time_machöe->
num_game°©es_°‹ed
 - 1]))

1212 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_sﬁved
[w‹ld_s˚√_°©e->
cuºít_Àvñ
] = 
åue
;

1213 i‡(
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_modes
[w‹ld_s˚√_°©e->
cuºít_Àvñ
] =
LevñMode
::
CrumbÀ
)

1215 
num_°©es
 = 
w‹ld_∂ay_s˚√_°©e
->
time_machöe
->
num_game°©es_°‹ed
;

1216 
GameSèã
* 
cuºít_°©e
 = &
w‹ld_∂ay_s˚√_°©e
->
time_machöe
->
°©e_¨øy
[
num_°©es
 - 1];

1217 
GameSèã
* 
˛⁄ed_°©e
 = 
	`game°©e_˛⁄e
(
cuºít_°©e
, 
w‹ld_mem‹y
);

1218 
	`game°©e_¸umbÀ
(
˛⁄ed_°©e
);

1219 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_°©e
[w‹ld_s˚√_°©e->
cuºít_Àvñ
] = 
˛⁄ed_°©e
;

1222 i‡(
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_modes
[w‹ld_s˚√_°©e->
cuºít_Àvñ
] =
LevñMode
::
Rïót
)

1224 
	`w‹ld_åy_ªvîsög_°aúˇ£
(
w‹ld_s˚√_°©e
);

1226 i‡(
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_modes
[w‹ld_s˚√_°©e->
cuºít_Àvñ
] =
LevñMode
::
Ovîw‹ld
)

1230 
w‹ld_s˚√_°©e
->
°aúˇ£_we_íãªd_Àvñ_‰om
.
Àvñ_ödex
 = -1;

1231 
w‹ld_∂ay_s˚√_°©e
->
time_machöe
 = 
NULL
;

1235 
cuºít_num_∂ayî_°™dög_⁄
 = 
w‹ld_s˚√_°©e
->
cuºít_Àvñ
;

1236 i‡(
ﬁd_game°©e_num_∂ayî_°™dög_⁄
 !
cuºít_num_∂ayî_°™dög_⁄
)

1238 
w‹ld_ˇmîa_ÀΩ
 = 0;

1239 
GameSèã
* 
cuºít_game°©e
 = 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_°©e
[
cuºít_num_∂ayî_°™dög_⁄
];

1240 
I¡Paú
 
game°©e_pos
 = 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
cuºít_num_∂ayî_°™dög_⁄
];

1241 
w‹ld_ˇmîa_gﬂl
 = 
	`m©h_ˇmîa_buûd_f‹_game°©e
(
cuºít_game°©e
, 
game°©e_pos
, 
ˇmîa_võwp‹t
);

1242 
w‹ld_ˇmîa_°¨t
 = 
w‹ld_ˇmîa_gﬂl
;

1247 
w‹ld_ˇmîa_ÀΩ
 +
dñè
;

1251 
w‹ld_ˇmîa
 = 
	`m©h_ˇmîa_move_tow¨ds_ÀΩ
(
w‹ld_ˇmîa_°¨t
, 
w‹ld_ˇmîa_gﬂl
, 
w‹ld_ˇmîa_ÀΩ
, 
CAMERA_LERP_TIME
);

1255 i‡(
ui_°©e
.
back•a˚_key_down_this_‰ame
)

1257 
	`w‹ld_åy_ªvîsög_°aúˇ£
(
w‹ld_s˚√_°©e
);

1258 
w‹ld_∂ay_s˚√_°©e
->
time_machöe
 = 
NULL
;

1261 i‡(!
w‹ld_∂ay_s˚√_°©e
->
time_machöe
)

1263 
s˚√
 = 
SCENE_TYPE
::
ST_PLAY_WORLD
;

1264 
w‹ld_∂ay_s˚√_°©e
 = 
NULL
;

1265 
ui_°©e
.
time_sö˚_s˚√_°¨ãd
 = 0;

1267 #¥agm®
ídªgi⁄


1269 i‡(
s˚√
 =
ST_SHOW_TEXT
)

1271 #¥agm®
ªgi⁄
 
upd©e


1272 i‡(
ãxt_s˚√_°©e
->
íd_time
 <
ui_°©e
.
tŸÆ_time_∑s£d
)

1274 
	`ãxt_s˚√_ª£t
();

1277 #¥agm®
ídªgi⁄


1278 #¥agm®
ªgi⁄
 
h™dÀ_evíts


1279 i‡(
ui_°©e
.
Àâîs
['x' - 'a'].
¥es£d_this_‰ame
)

1281 
	`ãxt_s˚√_ª£t
();

1283 #¥agm®
ídªgi⁄


1285 i‡(
s˚√
 =
ST_MENU
)

1287 #¥agm®
ªgi⁄
 
h™dÀ_evíts


1289 i‡(
ui_°©e
.
Àâîs
['w' - 'a'].
¥es£d_this_‰ame
)

1291 
míu_s˚√_°©e
->
cuºít_highlighãd_buâ⁄
 += 1;

1292 
míu_s˚√_°©e
->
cuºít_highlighãd_buâ⁄
 = 
	`möi
(míu_s˚√_°©e->cuºít_highlighãd_buâ⁄, míu_s˚√_°©e->
num_buâ⁄s
 - 1);

1296 i‡(
ui_°©e
.
Àâîs
['s' - 'a'].
¥es£d_this_‰ame
)

1298 
míu_s˚√_°©e
->
cuºít_highlighãd_buâ⁄
 -= 1;

1299 
míu_s˚√_°©e
->
cuºít_highlighãd_buâ⁄
 = 
	`maxi
(menu_scene_state->current_highlighted_button, 0);

1301 i‡(
ui_°©e
.
Àâîs
['x' - 'a'].
¥es£d_this_‰ame
)

1303 
cuºít_buâ⁄
 = 
míu_s˚√_°©e
->
cuºít_highlighãd_buâ⁄
;

1304 
míu_s˚√_°©e
->
buâ⁄s
[
cuºít_buâ⁄
].
	`ˇŒback
();

1306 #¥agm®
ídªgi⁄


1309 i‡(
s˚√
 =
ST_EDITOR
)

1311 #¥agm®
ªgi⁄
 
£nd
 
døw
 
d©a
 
to
 
gpu


1313 
skù_ödex
 = -1;

1314 
AABB
 
ouéöe
 = 
	`m©h_AABB_¸óã
(0, 0, 0, 0);

1316 i‡(
ui_°©e
.
ty≥
 =
ECS_RESIZE_GAMESTATE
)

1318 
skù_ödex
 = 
ui_°©e
.
un
.
ªsize
.
døggög_game°©e_ödex
;

1319 
ouéöe
 = 
	`ˇlcuœã_ouéöe_posôi⁄_‰om_døg_öfo
(
‰ame_mem‹y
, 
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
, 
døggög_°¨t_posôi⁄_ö_game•a˚
);

1321 i‡(
ui_°©e
.
ty≥
 =
ECS_MOVE_GAMESTATE
)

1323 
ouéöe
 = 
	`ˇlcuœã_ouéöe_‰om_move_öfo
(
‰ame_mem‹y
, 
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
);

1324 
skù_ödex
 = 
ui_°©e
.
un
.
move
.
movög_game°©e_ödex
;

1326 i‡(
ui_°©e
.
ty≥
 =
ECS_CREATE_GAMESTATE
)

1328 
ouéöe
 = 
	`ˇlcuœã_ouéöe_‰om_¸óã_öfo
(
‰ame_mem‹y
, 
edô‹_s˚√_°©e
->
timeMachöe
, 
ui_°©e
);

1330 i‡(
skù_ödex
 >0 || 
ui_°©e
.
ty≥
 =
ECS_CREATE_GAMESTATE
)

1332 
ouéöe
.
x
 -= 0.1f;

1333 
ouéöe
.
y
 -= 0.1f;

1334 
ouéöe
.
w
 += 0.2f;

1335 
ouéöe
.
h
 += 0.2f;

1336 
AABB
* 
ouéöes_brokí
 = (AABB*)
	`mem‹y_Æloc
(
‰ame_mem‹y
, (AABB) * 4);

1337 
	`m©h_AABB_bªak_öto_b‹dîs
(
ouéöe
, 
ouéöes_brokí
, 0.2f);

1338 
	`døw_ouéöe_to_game•a˚
(
ouéöes_brokí
[0], 
Êo‹_wrôe
);

1339 
	`døw_ouéöe_to_game•a˚
(
ouéöes_brokí
[1], 
Êo‹_wrôe
);

1340 
	`døw_ouéöe_to_game•a˚
(
ouéöes_brokí
[2], 
Êo‹_wrôe
);

1341 
	`døw_ouéöe_to_game•a˚
(
ouéöes_brokí
[3], 
Êo‹_wrôe
);

1346 
	`døw_game°©es_ouéöes_to_game•a˚
(

1347 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
,

1348 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
,

1349 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
,

1350 
Êo‹_wrôe
,

1351 
skù_ödex
);

1356 
	`game°©e_¥öt_°aúˇ£_ãÀ_vÆue
(
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
,edô‹_s˚√_°©e->timeMachöe->w‹ld_°©e.
num_Àvñ
);

1357 
	`døw_game•a˚
(

1358 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
,

1359 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
,

1360 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
,

1361 
Æl_wrôe
);

1364 
	`døw_∑Àâe
(
edô‹_s˚√_°©e
->
∑Àã_s¸ìn_°¨t
, 
ˇmîa_game
, 
ˇmîa_võwp‹t
, &
ui_°©e
, 
∑Àã_Àngth
,Édô‹_s˚√_°©e->
∑Àã
, 
Æl_wrôe
);

1367 
z
 = 0; z < 
skù_ödex
; z++)

1369 
w
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
z
]->w;

1370 
h
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
z
]->h;

1371 
I¡Paú
 
°¨tPos
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
z
];

1372 
dŸãd_posôi⁄s_˝u
[
dŸãd_tŸÆ_døwn
] = 
glm
::
	`vec3
(
°¨tPos
.
x
 - 0.15f, sèπPos.
y
 - 0.15f, 8);

1373 
dŸãd_sˇÀ_˝u
[
dŸãd_tŸÆ_døwn
] = 
glm
::
	`vec2
(
w
 + 0.30f, 
h
 + 0.30f);

1374 
dŸãd_tŸÆ_døwn
++;

1376 
z
 = 
skù_ödex
 + 1; z < 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
; z++)

1378 
w
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
z
]->w;

1379 
h
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
z
]->h;

1380 
I¡Paú
 
°¨tPos
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
z
];

1381 
dŸãd_posôi⁄s_˝u
[
dŸãd_tŸÆ_døwn
] = 
glm
::
	`vec3
(
°¨tPos
.
x
 - 0.15f, sèπPos.
y
 - 0.15f, 8);

1382 
dŸãd_sˇÀ_˝u
[
dŸãd_tŸÆ_døwn
] = 
glm
::
	`vec2
(
w
 + 0.30f, 
h
 + 0.30f);

1383 
dŸãd_tŸÆ_døwn
++;

1389 
Àn
 = 
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
;

1390 
i
 = 0; i < 
Àn
; i++)

1392 * 
«me
 = &
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_«mes
[
i
].name[0];

1393 
x_pos
 = ()
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
x
;

1394 
y_pos
 = ()(
edô‹_s˚√_°©e
->
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
y
 +Édô‹_s˚√_°©e->timeMachöe->w‹ld_°©e.
Àvñ_°©e
[i]->
h
) + 0.2f;

1395 
glm
::
vec3
 
døw_pos
 = glm::
	`vec3
(
x_pos
, 
y_pos
, 0);

1397 
	`døw_ãxt_to_s¸ìn
(
døw_pos
, 
glm
::
	`vec2
(1, 1), 
«me
, &
ãxt_døw_öfo
);

1400 #¥agm®
ídªgi⁄


1402 i‡(
s˚√
 =
ST_EDIT_LEVEL
)

1404 #¥agm®
ªgi⁄
 
£nd
 
døw
 
d©a
 
to
 
gpu


1406 
	`døw_∑Àâe
(
edô‹_s˚√_°©e
->
∑Àã_s¸ìn_°¨t
, 
ˇmîa_game
, 
ˇmîa_võwp‹t
, &
ui_°©e
, 
∑Àã_Àngth
,Édô‹_s˚√_°©e->
∑Àã
, 
Æl_wrôe
);

1408 
GameSèã
* 
∂ay_døw
 = &
∂ay_s˚√_°©e
.
timeMachöe
->
°©e_¨øy
[∂ay_s˚√_°©e.timeMachöe->
num_game°©es_°‹ed
 - 1];

1409 
GameSèã
* 
edô_døw
 = &
∂ay_s˚√_°©e
.
timeMachöe_edô
->
°©e_¨øy
[∂ay_s˚√_°©e.timeMachöe_edô->
num_game°©es_°‹ed
 - 1];

1410 
I¡Paú
 
°¨t_posôi⁄
 = 
∂ay_s˚√_°©e
.
loc
;

1411 
I¡Paú
 
√xt_posôi⁄
 = 
∂ay_s˚√_°©e
.
loc_edô
;

1412 
	`døw_game•a˚
(

1413 &(
∂ay_døw
),

1414 &(
∂ay_s˚√_°©e
.
loc
),

1416 
Æl_wrôe
);

1417 
	`døw_game•a˚
(

1418 &(
edô_døw
),

1419 &(
√xt_posôi⁄
),

1421 
Æl_wrôe
);

1422 
glm
::
vec3
 
ãxt_°¨t_pos
 = glm::
	`vec3
(
√xt_posôi⁄
.
x
,Çext_posôi⁄.
y
 + 
edô_døw
->
h
, 0);

1423 
	`døw_ãxt_to_s¸ìn
(
ãxt_°¨t_pos
, 
glm
::
	`vec2
(1, 1), 
∂ay_s˚√_°©e
.
game_«me
, &
ãxt_døw_öfo
);

1426 #¥agm®
ídªgi⁄


1428 i‡(
s˚√
 =
ST_PLAY_WORLD
)

1430 #¥agm®
ªgi⁄
 
£nd
 
døw
 
d©a
 
to
 
gpu


1431 
	`døw_game•a˚
(

1432 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_°©e
,

1433 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
Àvñ_posôi⁄
,

1434 
w‹ld_s˚√_°©e
->
w‹ld_°©e
.
num_Àvñ
,

1435 
Æl_wrôe
);

1436 #¥agm®
ídªgi⁄


1438 i‡(
s˚√
 =
ST_PLAY_LEVEL
)

1440 #¥agm®
ªgi⁄
 
£nd
 
døw
 
d©a
 
to
 
gpu


1441 
w‹ld_ödex_to_døw
 = 
w‹ld_s˚√_°©e
->
cuºít_Àvñ
;

1444 
game°©e_ödex_to_døw
 = 
w‹ld_∂ay_s˚√_°©e
->
time_machöe
->
num_game°©es_°‹ed
;

1445 
GameSèã
* 
to_døw
 = &
w‹ld_∂ay_s˚√_°©e
->
time_machöe
->
°©e_¨øy
[
game°©e_ödex_to_døw
 - 1];

1446 
cuºít_Àvñ
 = 
w‹ld_s˚√_°©e
->current_level;

1447 
I¡Paú
* 
to_døw_posôi⁄
 = &
w‹ld_∂ay_s˚√_°©e
->
døw_posôi⁄
;

1449 
	`døw_game•a˚
(

1450 &
to_døw
,

1451 
to_døw_posôi⁄
,

1453 
Æl_wrôe
);

1455 #¥agm®
ídªgi⁄


1457 i‡(
s˚√
 =
ST_SHOW_TEXT
)

1459 #¥agm®
ªgi⁄
 
£nd
 
døw
 
d©a
 
to
 
gpu


1460 
	`døw_ãxt_maximized_˚¡îed_to_s¸ìn
(
w‹ld_ˇmîa
, 
ãxt_s˚√_°©e
->
to_di•œy
, &
ãxt_døw_öfo
);

1461 
	`døw_bœck_box_ovî_s¸ìn
(
w‹ld_ˇmîa
, 
Êo‹_wrôe
);

1462 #¥agm®
ídªgi⁄


1464 i‡(
s˚√
 =
ST_MENU
)

1466 #¥agm®
ªgi⁄
 
£nd
 
døw
 
d©a
 
to
 
gpu


1468 
GameS∑˚Camîa
 
ˇmîa_fi·h
;

1469 
fi·h_w
 = (
ˇmîa_game
.
À·
 + camîa_game.
right
) / 5.0f;

1470 
ˇmîa_fi·h
.
À·
 = 
ˇmîa_game
.À· + 
fi·h_w
;

1471 
ˇmîa_fi·h
.
right
 = 
ˇmîa_game
.righà- 
fi·h_w
;

1472 
fi·h_h
 = (
ˇmîa_game
.
up
 - camîa_game.
down
) / 5.0f;

1473 
ˇmîa_fi·h
.
down
 = 
ˇmîa_game
.dow¿+ 
fi·h_h
;

1474 
ˇmîa_fi·h
.
up
 = camîa_fi·h.
down
 + 
fi·h_h
;

1478 
GameS∑˚Camîa
 
bŸtom_fi·h
 = 
ˇmîa_game
;

1479 
ˇmîa_width
 = 
ˇmîa_game
.
right
 - camîa_game.
À·
;

1480 
ˇmîa_height
 = 
ˇmîa_game
.
up
 - camîa_game.
down
;

1481 
bŸtom_fi·h
.
right
 = bŸtom_fi·h.
À·
 + 
ˇmîa_width
 / 5.0f;

1482 
bŸtom_fi·h
.
up
 = bŸtom_fi·h.
down
 + 
ˇmîa_height
 / 5.0f;

1484 
w
 = 
bŸtom_fi·h
.
right
 - bŸtom_fi·h.
À·
;

1485 
h
 = 
bŸtom_fi·h
.
up
 - bŸtom_fi·h.
down
;

1487 
gﬂl_w
 = (
h
 * 5.0f) / 4.0f;

1489 i‡(
gﬂl_w
 > 
w
)

1491 
	`¸ash_îr
("foolish mortal, you have madeánássumption in your code base (namely,Åhat you will onlyÇeedÅoÑeduceÅhe width, butÇeverÑeduceÅhe height),ándÅhatássumption has failed. Now weáre crashingÅo save youáÑeally mean debug session.");

1493 
width_adju°mít
 = (
w
 - 
gﬂl_w
);

1494 
bŸtom_fi·h
.
right
 -
width_adju°mít
;

1498 
GameS∑˚Camîa
 
ãmp_pos
 = 
	`¨ó_gë_grid_ñemít
(1, 1, 5, 4, 
bŸtom_fi·h
);

1499 
	`døw_ãxt_maximized_˚¡îed_to_s¸ìn
(
ãmp_pos
, "A", &
ãxt_døw_öfo
);

1502 
GameS∑˚Camîa
 
ãmp_pos
 = 
	`¨ó_gë_grid_ñemít
(0, 1, 5, 4, 
bŸtom_fi·h
);

1503 
	`døw_ui_to_game•a˚
(
ãmp_pos
, 
ãxtuªAs£ts
::
UI
::
Le·Aºow
, 
ui_wrôe
);

1507 
GameS∑˚Camîa
 
ãmp_pos
 = 
	`¨ó_gë_grid_ñemít
(2, 2, 5, 4, 
bŸtom_fi·h
);

1508 
	`døw_ãxt_maximized_˚¡îed_to_s¸ìn
(
ãmp_pos
, "W", &
ãxt_døw_öfo
);

1511 
GameS∑˚Camîa
 
ãmp_pos
 = 
	`¨ó_gë_grid_ñemít
(2, 3, 5, 4, 
bŸtom_fi·h
);

1512 
	`døw_ui_to_game•a˚
(
ãmp_pos
, 
ãxtuªAs£ts
::
UI
::
UpAºow
, 
ui_wrôe
);

1516 
GameS∑˚Camîa
 
ãmp_pos
 = 
	`¨ó_gë_grid_ñemít
(2, 1, 5, 4, 
bŸtom_fi·h
);

1517 
	`døw_ãxt_maximized_˚¡îed_to_s¸ìn
(
ãmp_pos
, "S", &
ãxt_døw_öfo
);

1520 
GameS∑˚Camîa
 
ãmp_pos
 = 
	`¨ó_gë_grid_ñemít
(2, 0, 5, 4, 
bŸtom_fi·h
);

1521 
	`døw_ui_to_game•a˚
(
ãmp_pos
, 
ãxtuªAs£ts
::
UI
::
DownAºow
, 
ui_wrôe
);

1525 
GameS∑˚Camîa
 
ãmp_pos
 = 
	`¨ó_gë_grid_ñemít
(3, 1, 5, 4, 
bŸtom_fi·h
);

1526 
	`døw_ãxt_maximized_˚¡îed_to_s¸ìn
(
ãmp_pos
, "D", &
ãxt_døw_öfo
);

1529 
GameS∑˚Camîa
 
ãmp_pos
 = 
	`¨ó_gë_grid_ñemít
(4, 1, 5, 4, 
bŸtom_fi·h
);

1530 
	`døw_ui_to_game•a˚
(
ãmp_pos
, 
ãxtuªAs£ts
::
UI
::
RightAºow
, 
ui_wrôe
);

1534 
i
 = 0; i < 
míu_s˚√_°©e
->
num_buâ⁄s
; i++)

1536 
GameS∑˚Camîa
 
ˇmîa_fi·h_smÆÀr
 = 
ˇmîa_fi·h
;

1537 
width
 = 
ˇmîa_fi·h_smÆÀr
.
right
 - camîa_fi·h_smÆÀr.
À·
;

1538 
height
 = 
ˇmîa_fi·h_smÆÀr
.
up
 - camîa_fi·h_smÆÀr.
down
;

1539 
ˇmîa_fi·h_smÆÀr
.
À·
 +(
width
 / 5.0f);

1540 
ˇmîa_fi·h_smÆÀr
.
right
 -(
width
 / 5.0f);

1541 
ˇmîa_fi·h_smÆÀr
.
up
 -(
height
 / 10.0f);

1542 
ˇmîa_fi·h_smÆÀr
.
down
 +(
height
 / 10.0f);

1543 i‡(
i
 =
míu_s˚√_°©e
->
cuºít_highlighãd_buâ⁄
)

1544 
	`døw_buâ⁄_to_game•a˚
(
ˇmîa_fi·h
, 
ui_wrôe
, 
glm
::
	`vec4
(0.7, 0.7, 1, 1));

1546 
	`døw_buâ⁄_to_game•a˚
(
ˇmîa_fi·h
, 
ui_wrôe
);

1547 
	`døw_ãxt_maximized_˚¡îed_to_s¸ìn
(
ˇmîa_fi·h_smÆÀr
, 
míu_s˚√_°©e
->
buâ⁄s
[
i
].
buâ⁄_ãxt
, &
ãxt_døw_öfo
);

1548 
ˇmîa_fi·h
.
down
 +
fi·h_h
;

1549 
ˇmîa_fi·h
.
up
 +
fi·h_h
;

1551 #¥agm®
ídªgi⁄


1553 #¥agm®
ªgi⁄
 
døw
 
gpu
 
d©a


1557 i‡(
s˚√
 =
ST_PLAY_WORLD
 || s˚√ =
ST_PLAY_LEVEL
 || s˚√ =
ST_SHOW_TEXT
)

1558 
ˇmîa
 = 
	`ˇmîa_make_m©rix
(
w‹ld_ˇmîa
);

1559 i‡(
s˚√
 =
ST_EDITOR
 || s˚√ =
ST_EDIT_LEVEL
 || s˚√ =
ST_MENU
)

1560 
ˇmîa
 = 
	`ˇmîa_make_m©rix
(
ˇmîa_game
);

1561 
	`glU£Progøm
(
•rôeShadî
);

1562 
	`shadî_£t_unif‹m_m©4
(
•rôeShadî
, "võwProje˘i⁄M©rix", 
ˇmîa
);

1563 
	`glU£Progøm
(
fuŒS¥ôeShadî
);

1564 
	`shadî_£t_unif‹m_m©4
(
fuŒS¥ôeShadî
, "võwProje˘i⁄M©rix", 
ˇmîa
);

1565 
	`glU£Progøm
(
dŸãdShadî
);

1566 
	`shadî_£t_unif‹m_m©4
(
dŸãdShadî
, "võwProje˘i⁄M©rix", 
ˇmîa
);

1567 
	`shadî_£t_unif‹m_Êﬂt
(
dŸãdShadî
, "time", 
tŸÆ_time
);

1568 
	`glU£Progøm
(
°rögShadî
);

1569 
	`shadî_£t_unif‹m_m©4
(
°rögShadî
, "võwProje˘i⁄M©rix", 
ˇmîa
);

1573 
	`•rôe_wrôe_out
(
Êo‹_wrôe
, 
ˇmîa
);

1574 
	`•rôe_wrôe_out
(
põ˚_wrôe
, 
ˇmîa
);

1575 
	`•rôe_wrôe_out
(
symbﬁ_wrôe
, 
ˇmîa
);

1576 
	`•rôe_wrôe_out
(
ui_wrôe
, 
ˇmîa
);

1581 
	`glU£Progøm
(
dŸãdShadî
);

1582 
	`glBödVîãxAºay
(
dŸãd_VAO
);

1583 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
dŸãd_posôi⁄s_buf„r
);

1584 
	`glBuf„rSubD©a
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec3
Ë* 
dŸãd_tŸÆ_døwn
, 
dŸãd_posôi⁄s_˝u
);

1585 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
dŸãd_sˇÀ_buf„r
);

1586 
	`glBuf„rSubD©a
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec2
Ë* 
dŸãd_tŸÆ_døwn
, 
dŸãd_sˇÀ_˝u
);

1588 
	`glDøwEÀmítsIn°™˚d
(
GL_TRIANGLES
, 6, 
GL_UNSIGNED_INT
, 0, 
dŸãd_tŸÆ_døwn
);

1593 
	`glU£Progøm
(
°rögShadî
);

1595 
	`glBödVîãxAºay
(
°rög_VAO
);

1597 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
°rög_©œs_buf„r
);

1598 
	`glBuf„rSubD©a
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec4
Ë* *
ãxt_døw_öfo
.
cuºít_numbî_døwn
,Åext_døw_öfo.
°rög_©œs_˝u
);

1599 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
°rög_m©rix_buf„r
);

1600 
	`glBuf„rSubD©a
(
GL_ARRAY_BUFFER
, 0, (
glm
::
m©4
Ë* *
ãxt_døw_öfo
.
cuºít_numbî_døwn
,Åext_døw_öfo.
°rög_m©rix_˝u
);

1601 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
°rög_cﬁ‹_buf„r
);

1602 
	`glBuf„rSubD©a
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec4
)** 
ãxt_døw_öfo
.
cuºít_numbî_døwn
,Åext_døw_öfo.
°rög_cﬁ‹_˝u
);

1603 
	`glBödTextuª
(
GL_TEXTURE_2D
, 
°rög_ãxtuª
);

1604 
	`glDøwEÀmítsIn°™˚d
(
GL_TRIANGLES
, 6, 
GL_UNSIGNED_INT
, 0, *
ãxt_døw_öfo
.
cuºít_numbî_døwn
);

1608 #¥agm®
ídªgi⁄


1609 #¥agm®
ªgi⁄
 
Föish
 
™d
 
ª£t
 
√xt
 
‰ame
.

1610 
	`SDL_GL_Sw≠Wödow
(
wödow
);

1612 
dŸãd_tŸÆ_døwn
 = 0;

1613 *
ãxt_døw_öfo
.
cuºít_numbî_døwn
 = 0;

1615 
Êo‹_wrôe
->
num_døw
 = 0;

1616 
põ˚_wrôe
->
num_døw
 = 0;

1617 
symbﬁ_wrôe
->
num_døw
 = 0;

1618 
ui_wrôe
->
num_døw
 = 0;

1619 
	`mem‹y_˛ór
(
‰ame_mem‹y
);

1620 #¥agm®
ídªgi⁄


1622 
kìp_ru¬ög_öföôe_lo›
 = 
ru¬ög
;

1623 
	}
}

1625 
	$maö
(
¨gc
, *
¨gv
[])

1627 #¥agm®
ªgi⁄
 
SDL_Sëup


1629 
	`SDL_Inô
(
SDL_INIT_AUDIO
 | 
SDL_INIT_VIDEO
 | 
SDL_INIT_TIMER
 | 
SDL_WINDOW_RESIZABLE
);

1631 
	`SDL_GL_SëAâribuã
(
SDL_GL_CONTEXT_MAJOR_VERSION
, 3);

1632 
	`SDL_GL_SëAâribuã
(
SDL_GL_CONTEXT_MINOR_VERSION
, 0);

1635 
	`SDL_GL_SëAâribuã
(
SDL_GL_DOUBLEBUFFER
, 1);

1636 
	`SDL_GL_SëAâribuã
(
SDL_GL_DEPTH_SIZE
, 24);

1646 
SDL_GLC⁄ãxt
 
maöC⁄ãxt
;

1647 
wödow
 = 
	`SDL_Cª©eWödow
("Ca°À El£whîe", 
SDL_WINDOWPOS_CENTERED
,SDL_WINDOWPOS_CENTERED, 
SCREEN_STARTING_WIDTH
, 
SCREEN_STARTING_HEIGHT
, 
SDL_WINDOW_OPENGL
 | 
SDL_WINDOW_SHOWN
);

1648 
maöC⁄ãxt
 = 
	`SDL_GL_Cª©eC⁄ãxt
(
wödow
);

1649 i‡(
maöC⁄ãxt
 =
NULL
)

1651 
	`¥ötf
("we have failedÅo initialiseÅhe gl context");

1653 autÿ
rdr
 = 
	`SDL_Cª©eRídîî
(

1654 
wödow
, -1, 
SDL_RENDERER_ACCELERATED
 | 
SDL_RENDERER_TARGETTEXTURE
);

1655 #i‚de‡
EMSCRIPTEN


1656 i‡(!
	`gœdLﬂdGLLﬂdî
((
GLADlﬂd¥oc
)
SDL_GL_GëProcAddªss
))

1662 #¥agm®
ídªgi⁄


1664 #¥agm®
ªgi⁄
 
Mem‹y_AND_TimeMachöe_AND_Clock_Sëup


1665 
	`¥ötf
("Hello worldábc\n");

1666 
‰ame_mem‹y
 = 
	`mem‹y_¸óã
(3000000);

1667 
≥rm™ít_mem‹y
 = 
	`mem‹y_¸óã
(30000000);

1668 
míu_mem‹y
 = 
	`mem‹y_¸óã
(3000000);

1669 
edô‹_mem‹y
 = 
	`mem‹y_¸óã
(30000000);

1670 
∂ay_mem‹y
 = 
	`mem‹y_¸óã
(3000000);

1671 
w‹ld_mem‹y
 = 
	`mem‹y_¸óã
(30000000);

1672 
Àvñ_mem‹y
 = 
	`mem‹y_¸óã
(30000000);

1673 
™im©i⁄_mem‹y
 = 
	`mem‹y_¸óã
(3000000);

1674 
ãxt_mem‹y
 = 
	`mem‹y_¸óã
(300000);

1677 #¥agm®
ídªgi⁄


1678 #¥agm®
ªgi⁄
 
Ne°ed
 
GPU
 
Sëup


1680 #¥agm®
ªgi⁄
 
Basic
 
Sëup


1681 
vîti˚s
[] = {

1687 
posôi⁄s
[] = {

1695 
©œs
[] = {

1703 
ödi˚s
[] = {

1708 
	`¥ötf
("HellloooÇo?\n/n)");

1709 
	`glE«bÀ
(
GL_DEPTH_TEST
);

1710 
	`¥ötf
("HELL YEAH!\n/n");

1711 
	`glDïthFunc
(
GL_LESS
);

1712 
	`glE«bÀ
(
GL_BLEND
);

1713 
	`glBÀndFunc
(
GL_SRC_ALPHA
, 
GL_ONE_MINUS_SRC_ALPHA
);

1715 
•rôeShadî
 = 
	`shadî_compûe_¥ogøm
("movesprite.vs", "movesprite.f");

1716 
fuŒS¥ôeShadî
 = 
	`shadî_compûe_¥ogøm
("fullsprite.vs", "color_sprite.f");

1717 
dŸãdShadî
 = 
	`shadî_compûe_¥ogøm
("dottedlines.vs", "dottedlines.f");

1718 
ãxtShadî
 = 
	`shadî_compûe_¥ogøm
("text.vs", "sprite.f");

1719 
°rögShadî
 = 
	`shadî_compûe_¥ogøm
("string.vs", "string.f");

1721 
Êo‹_©œs_2
 = 
	`ªsour˚_lﬂd_image_‰om_fûe_⁄to_gpu
("floor.png");

1722 
põ˚_©œs_2
 = 
	`ªsour˚_lﬂd_image_‰om_fûe_⁄to_gpu
("piece.png");

1723 
symbﬁ_©œs_2
 = 
	`ªsour˚_lﬂd_image_‰om_fûe_⁄to_gpu
("symbols.png");

1724 
ui_©œs_2
 = 
	`ªsour˚_lﬂd_image_‰om_fûe_⁄to_gpu
("ui.png");

1729 
	`glU£Progøm
(
•rôeShadî
);

1731 
vîti˚s_VBO
;

1732 
vîti˚s_EBO
;

1735 
	`glGíBuf„rs
(1, &
vîti˚s_VBO
);

1736 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
vîti˚s_VBO
);

1737 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
vîti˚s
), vîti˚s, 
GL_STATIC_DRAW
);

1739 
	`glGíBuf„rs
(1, &
vîti˚s_EBO
);

1740 
	`glBödBuf„r
(
GL_ELEMENT_ARRAY_BUFFER
, 
vîti˚s_EBO
);

1741 
	`glBuf„rD©a
(
GL_ELEMENT_ARRAY_BUFFER
, (
ödi˚s
), indi˚s, 
GL_STATIC_DRAW
);

1746 
Êo‹_wrôe
 = 
•rôe_wrôe_make


1748 
Êo‹_©œs_2
,

1749 
fuŒS¥ôeShadî
,

1750 
≥rm™ít_mem‹y
,

1752 
vîti˚s_VBO
,

1753 
vîti˚s_EBO
,

1754 
ãxtuªAs£ts
::
	`FLOOR_posôi⁄s
(
≥rm™ít_mem‹y
)

1756 
põ˚_wrôe
 = 
•rôe_wrôe_make


1758 
põ˚_©œs_2
,

1759 
fuŒS¥ôeShadî
,

1760 
≥rm™ít_mem‹y
,

1762 
vîti˚s_VBO
,

1763 
vîti˚s_EBO
,

1764 
ãxtuªAs£ts
::
	`PIECE_posôi⁄s
(
≥rm™ít_mem‹y
)

1766 
symbﬁ_wrôe
 = 
•rôe_wrôe_make


1768 
symbﬁ_©œs_2
,

1769 
fuŒS¥ôeShadî
,

1770 
≥rm™ít_mem‹y
,

1772 
vîti˚s_VBO
,

1773 
vîti˚s_EBO
,

1774 
ãxtuªAs£ts
::
	`SYMBOLS_posôi⁄s
(
≥rm™ít_mem‹y
)

1776 
ui_wrôe
 = 
•rôe_wrôe_make


1778 
ui_©œs_2
,

1779 
fuŒS¥ôeShadî
,

1780 
≥rm™ít_mem‹y
,

1782 
vîti˚s_VBO
,

1783 
vîti˚s_EBO
,

1784 
ãxtuªAs£ts
::
	`UI_posôi⁄s
(
≥rm™ít_mem‹y
)

1786 
Æl_wrôe
 = (
AŒWrôe
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, (AllWrite));

1787 
Æl_wrôe
->
Êo‹
 = 
Êo‹_wrôe
;

1788 
Æl_wrôe
->
põ˚
 = 
põ˚_wrôe
;

1789 
Æl_wrôe
->
symbﬁ
 = 
symbﬁ_wrôe
;

1790 
Æl_wrôe
->
ui
 = 
ui_wrôe
;

1791 
Æl_wrôe
->
ãxt
 = &
ãxt_døw_öfo
;

1795 #¥agm®
ídªgi⁄


1796 #¥agm®
ªgi⁄
 
dŸãd
 
GPU
 
£tup


1797 
dŸãd_VAO
;

1798 
dŸãd_posôi⁄s_buf„r
;

1799 
dŸãd_sˇÀ_buf„r
;

1800 
dŸãd_tŸÆ_døwn
 = 0;

1801 
dŸãd_posôi⁄s_˝u
 = (
glm
::
vec3
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, 
MAX_NUM_DOTTED_SPRITES
 * (glm::vec3));

1802 
dŸãd_sˇÀ_˝u
 = (
glm
::
vec2
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, 
MAX_NUM_DOTTED_SPRITES
 * (glm::vec2));

1804 
	`glGíVîãxAºays
(1, &
dŸãd_VAO
);

1805 
	`glBödVîãxAºay
(
dŸãd_VAO
);

1807 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
vîti˚s_VBO
);

1808 
	`glBödBuf„r
(
GL_ELEMENT_ARRAY_BUFFER
, 
vîti˚s_EBO
);

1810 
posôi⁄
 = 
	`glGëAâribLoˇti⁄
(
dŸãdShadî
, "pos");

1811 
	`glVîãxAâribPoöãr
(
posôi⁄
, 3, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)0);

1812 
	`glE«bÀVîãxAâribAºay
(
posôi⁄
);

1814 
	`glGíBuf„rs
(1, &
dŸãd_posôi⁄s_buf„r
);

1815 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
dŸãd_posôi⁄s_buf„r
);

1816 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
glm
::
vec3
)* 
MAX_NUM_DOTTED_SPRITES
, 
NULL
, 
GL_DYNAMIC_DRAW
);

1818 
posôi⁄_off£t
 = 
	`glGëAâribLoˇti⁄
(
dŸãdShadî
, "positionOffset");

1819 
	`glVîãxAâribPoöãr
(
posôi⁄_off£t
, 3, 
GL_FLOAT
, 
GL_FALSE
, 3 * (), (*)0);

1820 
	`glE«bÀVîãxAâribAºay
(
posôi⁄_off£t
);

1821 
	`glVîãxAâribDivis‹
(
posôi⁄_off£t
, 1);

1822 
°d
::
cout
 << "po†√w stuff" << std::
ídl
;

1823 
	`glGíBuf„rs
(1, &
dŸãd_sˇÀ_buf„r
);

1824 
°d
::
cout
 << 
	`glGëEº‹
(Ë<< std::
ídl
;

1825 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
dŸãd_sˇÀ_buf„r
);

1826 
°d
::
cout
 << 
	`glGëEº‹
(Ë<< std::
ídl
;

1827 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
glm
::
vec2
)* 
MAX_NUM_DOTTED_SPRITES
, 
NULL
, 
GL_DYNAMIC_DRAW
);

1828 
°d
::
cout
 << 
	`glGëEº‹
(Ë<< std::
ídl
;

1830 
sˇÀ
 = 
	`glGëAâribLoˇti⁄
(
dŸãdShadî
, "scale");

1831 
°d
::
cout
 << 
	`glGëEº‹
(Ë<< std::
ídl
;

1832 
	`glVîãxAâribPoöãr
(
sˇÀ
, 2, 
GL_FLOAT
, 
GL_FALSE
, 2 * (), (*)0);

1833 
°d
::
cout
 << 
	`glGëEº‹
(Ë<< std::
ídl
;

1834 
	`glE«bÀVîãxAâribAºay
(
sˇÀ
);

1835 
°d
::
cout
 << 
	`glGëEº‹
(Ë<< std::
ídl
;

1836 
	`glVîãxAâribDivis‹
(
sˇÀ
, 1);

1837 
°d
::
cout
 << 
	`glGëEº‹
(Ë<< std::
ídl
;

1840 #¥agm®
ídªgi⁄


1841 #¥agm®
ªgi⁄
 
°rög
 
GPU
 
£tup


1842 
	`shadî_u£
(
°rögShadî
);

1844 
ãxt_døw_öfo
.
cuºít_numbî_døwn
 = (*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
,());

1845 *
ãxt_døw_öfo
.
cuºít_numbî_døwn
 = 0;

1846 
ãxt_døw_öfo
.
°rög_©œs_˝u
 = (
glm
::
vec4
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, 
MAX_NUM_CHARACTERS
 * (glm::vec4));

1847 
ãxt_døw_öfo
.
°rög_m©rix_˝u
 = (
glm
::
m©4
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, 
MAX_NUM_CHARACTERS
 * (glm::mat4));

1848 
ãxt_døw_öfo
.
°rög_cﬁ‹_˝u
 = (
glm
::
vec4
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, 
MAX_NUM_CHARACTERS
 * (glm::vec4));

1850 
	`glGíVîãxAºays
(1, &
°rög_VAO
);

1851 
°d
::
cout
 << 
	`glGëEº‹
(Ë<< ":261" << std::
ídl
;

1852 
	`glBödVîãxAºay
(
°rög_VAO
);

1854 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
vîti˚s_VBO
);

1855 
	`glBödBuf„r
(
GL_ELEMENT_ARRAY_BUFFER
, 
vîti˚s_EBO
);

1857 
posôi⁄
 = 0;

1858 
	`glVîãxAâribPoöãr
(
posôi⁄
, 3, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)0);

1859 
	`glE«bÀVîãxAâribAºay
(
posôi⁄
);

1861 
ãxCo‹d
 = 1;

1862 
	`glVîãxAâribPoöãr
(
ãxCo‹d
, 2, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)(3 * ()));

1863 
	`glE«bÀVîãxAâribAºay
(
ãxCo‹d
);

1865 
	`glGíBuf„rs
(1, &
°rög_m©rix_buf„r
);

1866 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
°rög_m©rix_buf„r
);

1867 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
glm
::
m©4
)* 
MAX_NUM_CHARACTERS
, 
NULL
, 
GL_DYNAMIC_DRAW
);

1869 
m©rixOff£t
 = 4;

1870 
	`glVîãxAâribPoöãr
(
m©rixOff£t
, 4, 
GL_FLOAT
, 
Ál£
, 16 * (), (*)0);

1871 
	`glVîãxAâribPoöãr
(
m©rixOff£t
 + 1, 4, 
GL_FLOAT
, 
Ál£
, 16 * (), (*)(4 * ()));

1873 
	`glVîãxAâribPoöãr
(
m©rixOff£t
 + 2, 4, 
GL_FLOAT
, 
Ál£
, 16 * (), (*)(8 * ()));

1874 
	`glVîãxAâribPoöãr
(
m©rixOff£t
 + 3, 4, 
GL_FLOAT
, 
Ál£
, 16 * (), (*)(12 * ()));

1875 
	`glE«bÀVîãxAâribAºay
(
m©rixOff£t
);

1876 
	`glE«bÀVîãxAâribAºay
(
m©rixOff£t
 + 1);

1877 
	`glE«bÀVîãxAâribAºay
(
m©rixOff£t
 + 2);

1878 
	`glE«bÀVîãxAâribAºay
(
m©rixOff£t
 + 3);

1879 
	`glVîãxAâribDivis‹
(
m©rixOff£t
, 1);

1880 
	`glVîãxAâribDivis‹
(
m©rixOff£t
 + 1, 1);

1881 
	`glVîãxAâribDivis‹
(
m©rixOff£t
 + 2, 1);

1882 
	`glVîãxAâribDivis‹
(
m©rixOff£t
 + 3, 1);

1884 
©œsOff£t
 = 2;

1886 
	`glGíBuf„rs
(1, &
°rög_©œs_buf„r
);

1887 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
°rög_©œs_buf„r
);

1888 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
glm
::
vec4
)* 
MAX_NUM_CHARACTERS
, 
NULL
, 
GL_DYNAMIC_DRAW
);

1890 
	`glVîãxAâribPoöãr
(
©œsOff£t
, 4, 
GL_FLOAT
, 
Ál£
, 4 * (), (*)(0));

1891 
	`glE«bÀVîãxAâribAºay
(
©œsOff£t
);

1892 
	`glVîãxAâribDivis‹
(
©œsOff£t
, 1);

1894 
ãxtCﬁ‹
 = 3;

1896 
	`glGíBuf„rs
(1, &
°rög_cﬁ‹_buf„r
);

1897 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
°rög_cﬁ‹_buf„r
);

1898 
	`glBuf„rD©a
(
GL_ARRAY_BUFFER
, (
glm
::
vec4
)* 
MAX_NUM_CHARACTERS
, 
NULL
, 
GL_DYNAMIC_DRAW
);

1900 
	`glVîãxAâribPoöãr
(
ãxtCﬁ‹
, 4, 
GL_FLOAT
, 
Ál£
, 4 * (), (*)(0));

1901 
	`glE«bÀVîãxAâribAºay
(
ãxtCﬁ‹
);

1903 #¥agm®
ídªgi⁄


1904 #¥agm®
ªgi⁄
 
Camîa
 
Sëup
 
And
 
UtûSåu˘s


1910 
ˇmîa_À·_x
 = 0;

1911 
ˇmîa_bŸtom_y
 = 0;

1912 
ˇmîa_right_x
;

1913 
ˇmîa_t›_y
;

1916 
ˇmîa_width
 = 
s¸ìn_width
;

1917 
ˇmîa_height
 = 
s¸ìn_height
;

1918 
øtio
 = ()
ˇmîa_width
 / ()
ˇmîa_height
;

1919 
ˇmîa_right_x
 = 
GAME_HEIGHT_START
 * 
øtio
;

1920 
ˇmîa_t›_y
 = 
GAME_HEIGHT_START
;

1923 
ˇmîa_game
.
À·
 = 
ˇmîa_À·_x
;

1924 
ˇmîa_game
.
right
 = 
ˇmîa_right_x
;

1925 
ˇmîa_game
.
up
 = 
ˇmîa_t›_y
;

1926 
ˇmîa_game
.
down
 = 
ˇmîa_bŸtom_y
;

1927 
ˇmîa_game
.
˛o£Poöt
 = -20;

1928 
ˇmîa_game
.
ÁrPoöt
 = 20.0f;

1930 
ˇmîa_võwp‹t
.
À·
 = 0;

1931 
ˇmîa_võwp‹t
.
right
 = 
s¸ìn_width
;

1932 
ˇmîa_võwp‹t
.
down
 = 0;

1933 
ˇmîa_võwp‹t
.
up
 = 
s¸ìn_height
;

1936 
ˇmîa
 = 
	`ˇmîa_make_m©rix
(
ˇmîa_game
);

1938 #¥agm®
ídªgi⁄


1939 #¥agm®
ªgi⁄
 
TTF
 
f⁄t
 
£tup


1941 
FT_Libøry
 
·
;

1942 if(
	`FT_Inô_FªeTy≥
(&
·
))

1943 
°d
::
cout
 << "ERROR - fªëy≥ÜibøryÜﬂd faûed.áœs." << std::
ídl
;

1945 
°d
::
cout
 << "suc˚ssfuŒyÜﬂded fªëy≥Üibøry" << std::
ídl
;

1946 
FT_Fa˚
 
Á˚
;

1947 i‡(
	`FT_New_Fa˚
(
·
, "as£ts/¨ül.âf", 0, &
Á˚
))

1948 
°d
::
cout
 << "ERROR - fªëy≥ faûedÅÿlﬂd f⁄t." << std::
ídl
;

1950 
°d
::
cout
 << "suc˚ssfuŒyÜﬂded fªëy≥ f⁄t." << std::
ídl
;

1951 
	`FT_Së_Pixñ_Sizes
(
Á˚
, 0, 
FONT_CHARACTER_HEIGHT
);

1953 
GLuöt
 
ãxt_VAO
;

1955 
	`glGíVîãxAºays
(1, &
ãxt_VAO
);

1956 
	`glBödVîãxAºay
(
ãxt_VAO
);

1958 
	`glBödBuf„r
(
GL_ARRAY_BUFFER
, 
vîti˚s_VBO
);

1959 
	`glBödBuf„r
(
GL_ELEMENT_ARRAY_BUFFER
, 
vîti˚s_EBO
);

1961 
GLöt
 
posôi⁄
 = 
	`glGëAâribLoˇti⁄
(
ãxtShadî
, "pos");

1962 
	`glVîãxAâribPoöãr
(
posôi⁄
, 3, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)0);

1963 
	`glE«bÀVîãxAâribAºay
(
posôi⁄
);

1965 
GLöt
 
ãxCo‹d
 = 
	`glGëAâribLoˇti⁄
(
ãxtShadî
, "texCoords");

1966 
	`glVîãxAâribPoöãr
(
ãxCo‹d
, 2, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)(3 * ()));

1967 
	`glE«bÀVîãxAâribAºay
(
ãxCo‹d
);

1970 
°rög_ãxtuª
;

1971 
ãxt_døw_öfo
.
ãxt_posôi⁄s
 = (
AABB
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, (AABBË* 
FONT_NUM_CHARACTERS
);

1972 
ãxt_døw_öfo
.
ãxt_posôi⁄s_n‹mÆized
 = (
AABB
*Ë
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, (AABBË* 
FONT_NUM_CHARACTERS
);

1973 * 
ch¨_ãxtuª
 = (*)
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, (Ë* 
FONT_NUM_CHARACTERS
);

1974 
ãxt_døw_öfo
.
åue_f⁄t_ª„ªn˚
 = (
TTF_Ch¨a˘î
*)
	`mem‹y_Æloc
(
≥rm™ít_mem‹y
, (TTF_Ch¨a˘îË* 
FONT_NUM_CHARACTERS
);

1976 
cuºít_width_wrôãn
 = 0;

1977 
cuºít_height_wrôãn
 = 0;

1978 
ãxt_FBO
;

1979 
	`glGíFømebuf„rs
(1, &
ãxt_FBO
);

1980 
	`glBödFømebuf„r
(
GL_FRAMEBUFFER
, 
ãxt_FBO
);

1982 
	`glGíTextuªs
(1,&
°rög_ãxtuª
);

1983 
	`glBödTextuª
(
GL_TEXTURE_2D
, 
°rög_ãxtuª
);

1984 
	`glTexImage2D
(
GL_TEXTURE_2D
, 0, 
GL_RGB
, 
FONT_ATLAS_WIDTH
, 
FONT_ATLAS_HEIGHT
, 0, GL_RGB, 
GL_UNSIGNED_BYTE
, 
NULL
);

1985 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR
);

1986 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_LINEAR
);

1988 
	`glFømebuf„rTextuª2D
(
GL_FRAMEBUFFER
, 
GL_COLOR_ATTACHMENT0
, 
GL_TEXTURE_2D
, 
°rög_ãxtuª
, 0);

1990 
	`glGíTextuªs
(
FONT_NUM_CHARACTERS
, 
ch¨_ãxtuª
);

1991 
	`glBödVîãxAºay
(
ãxt_VAO
);

1992 
	`glU£Progøm
(
ãxtShadî
);

1994 
	`FT_Së_Pixñ_Sizes
(
Á˚
, 0, 
FONT_CHARACTER_HEIGHT
);

1995 
	`glPixñSt‹ei
(
GL_UNPACK_ALIGNMENT
, 1);

1997 
	`glVõwp‹t
(0, 0, 
FONT_ATLAS_WIDTH
, 
FONT_ATLAS_HEIGHT
);

1998 i‡(
	`glCheckFømebuf„rSètus
(
GL_FRAMEBUFFER
Ë!
GL_FRAMEBUFFER_COMPLETE
)

1999 
°d
::
cout
 << "ERROR - Fømebuf„∏i†nŸ com∂ëe!" << std::
ídl
;

2001 
°d
::
cout
 << "‰amebuf„∏com∂ëe!" << std::
ídl
;

2003 
c
 = 0; c < 
FONT_NUM_CHARACTERS
; c++)

2005 i‡(
	`FT_Lﬂd_Ch¨
(
Á˚
, 
c
, 
FT_LOAD_RENDER
))

2007 
°d
::
cout
 << "ERROR - uh oh, faûedÅÿlﬂd ch¨a˘î glyph" << std::
ídl
;

2012 
Á˚_width
 = 
Á˚
->
glyph
->
bôm≠
.
width
;

2013 
Á˚_height
 = 
Á˚
->
glyph
->
bôm≠
.
rows
;

2015 
ãxtuªID
 = 
ch¨_ãxtuª
[
c
];

2016 
	`glBödTextuª
(
GL_TEXTURE_2D
, 
ch¨_ãxtuª
[
c
]);

2017 
	`glTexImage2D
(

2018 
GL_TEXTURE_2D
,

2020 
GL_R8
,

2021 
Á˚
->
glyph
->
bôm≠
.
width
,

2022 
Á˚
->
glyph
->
bôm≠
.
rows
,

2024 
GL_RED
,

2025 
GL_UNSIGNED_BYTE
,

2026 
Á˚
->
glyph
->
bôm≠
.
buf„r
);

2027 
°d
::
cout
 << 
	`glGëEº‹
(Ë<< std::
ídl
;

2028 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_S
, 
GL_CLAMP_TO_EDGE
);

2029 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_T
, 
GL_CLAMP_TO_EDGE
);

2030 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR
);

2031 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_LINEAR
);

2036 
wrôe_width
 = 
Á˚_width
 + 2;

2037 
boﬁ
 
room_to_wrôe
 = 
wrôe_width
 + 
cuºít_width_wrôãn
 < 
FONT_ATLAS_WIDTH
;

2038 i‡(!
room_to_wrôe
)

2040 
cuºít_width_wrôãn
 = 0;

2041 
cuºít_height_wrôãn
 +
FONT_CHARACTER_HEIGHT
 + 2;

2045 
AABB
 
ãmp
 = 
	`m©h_AABB_¸óã
((Ë(
cuºít_width_wrôãn
 + 1), (Ë(
cuºít_height_wrôãn
 + 1), (Ë
Á˚_width
, (Ë
Á˚_height
);

2046 
ãxt_døw_öfo
.
ãxt_posôi⁄s
[
c
] = 
ãmp
;

2047 
ãxt_døw_öfo
.
ãxt_posôi⁄s_n‹mÆized
[
c
] =Åext_døw_öfo.
ãxt_posôi⁄s
[c];

2048 
ãxt_døw_öfo
.
ãxt_posôi⁄s_n‹mÆized
[
c
].
x
 =Åext_døw_öfo.
ãxt_posôi⁄s
[c].x / 
FONT_ATLAS_WIDTH
;

2049 
ãxt_døw_öfo
.
ãxt_posôi⁄s_n‹mÆized
[
c
].
y
 =Åext_døw_öfo.
ãxt_posôi⁄s
[c].y / 
FONT_ATLAS_HEIGHT
;

2050 
ãxt_døw_öfo
.
ãxt_posôi⁄s_n‹mÆized
[
c
].
w
 =Åext_døw_öfo.
ãxt_posôi⁄s
[c].w / 
FONT_ATLAS_WIDTH
;

2051 
ãxt_døw_öfo
.
ãxt_posôi⁄s_n‹mÆized
[
c
].
h
 =Åext_døw_öfo.
ãxt_posôi⁄s
[c].h / 
FONT_ATLAS_HEIGHT
;

2054 
AABB
 
ãmp2
 = 
ãxt_døw_öfo
.
ãxt_posôi⁄s_n‹mÆized
[
c
];

2055 
glm
::
vec4
 
ãmp3
 = *(glm::vec4*Ë& 
ãmp2
;

2056 
	`shadî_£t_unif‹m_vec4
(
ãxtShadî
, "off£t", 
ãmp3
);

2057 
cuºít_width_wrôãn
 +
wrôe_width
;

2058 
	`glDøwEÀmíts
(
GL_TRIANGLES
, 6, 
GL_UNSIGNED_INT
, 0);

2060 
ãxt_døw_öfo
.
åue_f⁄t_ª„ªn˚
[
c
].
Size
 = 
glm
::
	`ivec2
(
Á˚
->
glyph
->
bôm≠
.
width
, fa˚->glyph->bôm≠.
rows
);

2061 
ãxt_døw_öfo
.
åue_f⁄t_ª„ªn˚
[
c
].
Bórög
 = 
glm
::
	`ivec2
(
Á˚
->
glyph
->
bôm≠_À·
, fa˚->glyph->
bôm≠_t›
);

2062 
ãxt_døw_öfo
.
åue_f⁄t_ª„ªn˚
[
c
].
adv™˚
 = (
Á˚
->
glyph
->adv™˚.
x
);

2064 
	`glBödTextuª
(
GL_TEXTURE_2D
, 0);

2068 
	`glDñëeFømebuf„rs
(1,&
ãxt_FBO
);

2069 
	`glBödFømebuf„r
(
GL_FRAMEBUFFER
, 0);

2070 
	`glVõwp‹t
(0, 0, 
s¸ìn_width
, 
s¸ìn_height
);

2072 #¥agm®
ídªgi⁄


2074 #¥agm®
ídªgi⁄


2075 #¥agm®
ªgi⁄
 
MAIN_LOOP_INIT


2076 
s˚√
 = 
ST_MENU
;

2077 
míu_s˚√_°©e
 = 
	`£tup_maö_míu
(
míu_mem‹y
, 
míu_a˘i⁄_√w_game
, 
míu_a˘i⁄_c⁄töue_game
, 
míu_a˘i⁄_Àvñ_edô‹
);

2079 
ui_°©e
 = 
	`˛ick_ui_öô
(
≥rm™ít_mem‹y
);

2080 #¥agm®
ídªgi⁄


2082 #ifde‡
EMSCRIPTEN


2084 
	`ems¸ùãn_£t_maö_lo›
(
maölo›fun˘i⁄
, 0, 0);

2086 
åue
)

2088 
	`maölo›fun˘i⁄
();

2089 i‡(!
kìp_ru¬ög_öföôe_lo›
)

2094 
	`¥ötf
("%s\n", 
	`glGëSåög
(
GL_VERSION
));

2095 
	`SDL_De°royWödow
(
wödow
);

2096 
	`SDL_Quô
();

2100 
	}
}

2102 
	$èke_∂ayî_a˘i⁄
(
Game°©eTimeMachöe
* 
maybe_time_machöe
, 
I¡Paú
 
døw_posôi⁄
, 
Edô‹UISèã
* 
ui_°©e
, 
Dúe˘i⁄
 
a˘i⁄
, 
Mem‹y
* 
Àvñ_mem‹y
, Mem‹y* 
‰ame_mem‹y
, Mem‹y* 
™im©i⁄_mem‹y
)

2104 
GameA˘i⁄Jou∫Æ
* 
jou∫Æ
 = 
	`game°©e_timemachöe_èke_a˘i⁄
(
maybe_time_machöe
, 
a˘i⁄
, 
Àvñ_mem‹y
, 
‰ame_mem‹y
);

2105 
GameSèãAnim©i⁄
* 
™im©i⁄
 = 
jou∫Æ
->
maybe_™im©i⁄
;

2106 
ui_°©e
->
time_tûl_∂ayî_ˇn_move
 = 
WAIT_BETWEEN_PLAYER_MOVE_REPEAT
;

2107 
ui_°©e
->
time_sö˚_œ°_∂ayî_a˘i⁄
 = 0;

2108 
	}
}

2160 
AABB
 
	$ˇlcuœã_ouéöe_‰om_¸óã_öfo
(
Mem‹y
* 
‰ame_mem‹y
, 
TimeMachöeEdô‹
* 
timeMachöe
, 
Edô‹UISèã
 
ui_°©e
)

2162 
I¡Paú
 
cuºít_posôi⁄
 = 
	`m©h_öçaú_¸óã
((Ë
	`Êo‹
(
ui_°©e
.
mou£GamePos
.
x
), (ËÊo‹(ui_°©e.mou£GamePos.
y
));

2163 
I¡Paú
 
bŸtom_À·
 = 
	`m©h_öçaú_¸óã
(
	`möi
(
cuºít_posôi⁄
.
x
, 
ui_°©e
.
un
.
¸óã
.
gamew‹ld_°¨t_pos
.x),

2164 
	`möi
(
cuºít_posôi⁄
.
y
, 
ui_°©e
.
un
.
¸óã
.
gamew‹ld_°¨t_pos
.y));

2165 
I¡Paú
 
t›_right
 = 
	`m©h_öçaú_¸óã
(
	`maxi
(
cuºít_posôi⁄
.
x
, 
ui_°©e
.
un
.
¸óã
.
gamew‹ld_°¨t_pos
.x),

2166 
	`maxi
(
cuºít_posôi⁄
.
y
, 
ui_°©e
.
un
.
¸óã
.
gamew‹ld_°¨t_pos
.y));

2167 
w
 = 
t›_right
.
x
 - 
bŸtom_À·
.x + 1;

2168 
h
 = 
t›_right
.
y
 - 
bŸtom_À·
.y + 1;

2169 
AABB
 
√xt_size
 = 
	`m©h_AABB_¸óã
((Ë
bŸtom_À·
.
x
, (ËbŸtom_À·.
y
, (Ë
w
, (Ë
h
);

2170  
√xt_size
;

2171 
	}
}

2172 
AABB
 
	$ˇlcuœã_ouéöe_‰om_move_öfo
(
Mem‹y
* 
‰ame_mem‹y
, 
TimeMachöeEdô‹
* 
timeMachöe
, 
Edô‹UISèã
 
ui_°©e
)

2175 
glm
::
vec2
 
di°™˚
 = 
ui_°©e
.
mou£GamePos
 - ui_°©e.
un
.
move
.
move_°¨t_posôi⁄
;

2177 
I¡Paú
 
off£t
 = 
	`m©h_öçaú_¸óã
(()
di°™˚
.
x
, ()di°™˚.
y
);

2178 
game°©e_ödex
 = 
ui_°©e
.
un
.
move
.
movög_game°©e_ödex
;

2179 
GameSèã
* 
cuºít_game°©e
 = 
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
game°©e_ödex
];

2180 
I¡Paú
 
°¨tPosôi⁄
 = 
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
game°©e_ödex
];

2181 
AABB
 
ouéöe
 = 
	`m©h_AABB_¸óã
((Ë(
°¨tPosôi⁄
.
x
 + 
off£t
.x), (Ë(°¨tPosôi⁄.
y
 + off£t.y), (Ë
cuºít_game°©e
->
w
, (Ëcuºít_game°©e->
h
);

2182  
ouéöe
;

2183 
	}
}

2184 
AABB
 
	$ˇlcuœã_ouéöe_posôi⁄_‰om_døg_öfo
(
Mem‹y
* 
‰ame_mem‹y
,

2185 
TimeMachöeEdô‹
* 
timeMachöe
,

2186 
Edô‹UISèã
 
ui_°©e
,

2187 
glm
::
vec2
 
døggög_°¨t_posôi⁄_ö_game•a˚
)

2190 
glm
::
vec2
 
off£t
 = 
ui_°©e
.
mou£GamePos
 - 
døggög_°¨t_posôi⁄_ö_game•a˚
;

2192 
I¡Paú
 
èrgëãd_game°©e_posôi⁄
 = 
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
ui_°©e
.
un
.
ªsize
.
døggög_game°©e_ödex
];

2193 
GameSèã
* 
èrgëãd_game°©e
 = 
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
ui_°©e
.
un
.
ªsize
.
døggög_game°©e_ödex
];

2194 
èrgëãd_game°©e_width
 = 
èrgëãd_game°©e
->
w
;

2195 
èrgëãd_game°©e_height
 = 
èrgëãd_game°©e
->
h
;

2197 
AABB
 
ﬁd
 = 
	`m©h_AABB_¸óã_öt
(
èrgëãd_game°©e_posôi⁄
.
x
,

2198 
èrgëãd_game°©e_posôi⁄
.
y
,

2199 
èrgëãd_game°©e_width
,

2200 
èrgëãd_game°©e_height
);

2201 
AABB
 
√xt
 = 
ﬁd
;

2203 
off£t_x
 = 
	`sign
(
off£t
.
x
) * 0.5f;

2204 
off£t_y
 = 
	`sign
(
off£t
.
y
) * 0.5f;

2205 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_À·
)

2207 
À·_movemít
 = ()(
ui_°©e
.
mou£GamePos
.
x
 - (()
√xt
.xË+ 
off£t_x
);

2208 i‡(
À·_movemít
 != 0)

2210 
√xt
.
x
 +
À·_movemít
;

2211 
√xt
.
w
 -
À·_movemít
;

2214 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_right
)

2216 
right_movemít
 = ()(
ui_°©e
.
mou£GamePos
.
x
 - (()
√xt
.x +Çext.
w
Ë+ 
off£t_x
);

2217 i‡(
right_movemít
 != 0)

2218 
√xt
.
w
 +
right_movemít
;

2220 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_down
)

2222 
down_movemít
 = ()(
ui_°©e
.
mou£GamePos
.
y
 - (()
√xt
.yË+ 
off£t_y
);

2223 i‡(
down_movemít
 != 0)

2225 
√xt
.
y
 +
down_movemít
;

2226 
√xt
.
h
 -
down_movemít
;

2229 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_up
)

2231 
up_movemít
 = ()(
ui_°©e
.
mou£GamePos
.
y
 - (()
√xt
.y +Çext.
h
Ë+ 
off£t_y
);

2232 i‡(
up_movemít
 != 0)

2233 
√xt
.
h
 +
up_movemít
;

2236 
boﬁ
 
ch™geOccuªd
 = 
√xt
.
x
 !
èrgëãd_game°©e_posôi⁄
.x

2237 || 
√xt
.
y
 !
èrgëãd_game°©e_posôi⁄
.y

2238 || 
√xt
.
w
 !
èrgëãd_game°©e
->w

2239 || 
√xt
.
h
 !
èrgëãd_game°©e
->h;

2242 i‡(
√xt
.
w
 <= 0)

2244 
go_back
 = (Ë
√xt
.
w
 - 1;

2245 
√xt
.
w
 = 1;

2246 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_À·
)

2248 
√xt
.
x
 +
go_back
;

2252 i‡(
√xt
.
h
 <= 0)

2254 
go_back
 = (Ë
√xt
.
h
 - 1;

2255 
√xt
.
h
 = 1;

2256 i‡(
ui_°©e
.
un
.
ªsize
.
døggög_down
)

2258 
√xt
.
y
 +
go_back
;

2261  
√xt
;

2262 
	}
}

2265 
boﬁ
 
	$MaybeAµlyBrush
(
Game°©eBrush
* 
∑Àã
,
cuºítBrush
, 
Edô‹UISèã
* 
ui_°©e
, 
TimeMachöeEdô‹
* 
timeMachöe
,
glm
::
vec2
 
mou£GamePos
)

2267 
i
 = 0; i < 
timeMachöe
->
w‹ld_°©e
.
num_Àvñ
; i++)

2269 
GameSèã
* 
cuºítSèã
 = 
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
i
];

2270 
À·
 = (Ë
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
x
;

2271 
right
 = (Ë(
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
x
 + 
cuºítSèã
->
w
);

2272 
down
 = (Ë
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
y
;

2273 
up
 = (Ë(
timeMachöe
->
w‹ld_°©e
.
Àvñ_posôi⁄
[
i
].
y
 + 
cuºítSèã
->
h
);

2274 
boﬁ
 
˛ickedFlo‹
 = 
	`m©h_˛ick_is_öside_AABB
(
À·
, 
down
, 
right
, 
up
, 
mou£GamePos
.
x
, mou£GamePos.
y
);

2275 i‡(
˛ickedFlo‹
)

2278 
≥r˚¡ageX
 = 
	`≥r˚¡_bëwìn_two_poöts
(
mou£GamePos
.
x
, 
À·
, 
right
);

2279 
≥r˚¡ageY
 = 
	`≥r˚¡_bëwìn_two_poöts
(
mou£GamePos
.
y
, 
down
, 
up
);

2280 
x_Êo‹_˚Œ_˛icked
 = ()(
≥r˚¡ageX
 * 
cuºítSèã
->
w
);

2281 
y_Êo‹_˚Œ_˛icked
 = ()(
≥r˚¡ageY
 * 
cuºítSèã
->
h
);

2283 
I¡Paú
 
èrgë_squ¨e
 = 
	`m©h_öçaú_¸óã
(
x_Êo‹_˚Œ_˛icked
, 
y_Êo‹_˚Œ_˛icked
);

2284 
èrgë_squ¨e_1d
 = 
	`f2D
(
èrgë_squ¨e
.
x
,Å¨gë_squ¨e.
y
, 
timeMachöe
->
w‹ld_°©e
.
Àvñ_°©e
[
i
]->
w
,ÅimeMachöe->w‹ld_°©e.Àvñ_°©e[i]->
h
);

2285 
TimeMachöeEdô‹A˘i⁄
 
a˘i⁄
 = 
	`game°©e_timemachöó˘i⁄_¸óã_≠∂y_brush
(
∑Àã
[
cuºítBrush
], 
i
, 
èrgë_squ¨e
);

2287 
	`game°©e_timemachöe_edô‹_èke_a˘i⁄
(
timeMachöe
, 
NULL
, 
a˘i⁄
);

2288 
ui_°©e
->
ty≥
 = 
ECS_BRUSH
;

2289  
åue
;

2292  
Ál£
;

2293 
	}
}

2295 
GameS∑˚Camîa
 
	$m©h_ˇmîa_buûd_f‹_game°©e
(
GameSèã
* 
game°©e
, 
I¡Paú
 
posôi⁄
, 
VõwP‹tCamîa
 
võwp‹t
, 
x_∑ddög
, 
y_∑ddög
)

2297 
øtio
 = 
	`ˇmîa_øtio
(
võwp‹t
);

2298 
°¨t_x
 = (Ë
posôi⁄
.
x
;

2299 
°¨t_y
 = (Ë
posôi⁄
.
y
;

2300 
˚¡î_x
 = 
°¨t_x
 + ((
game°©e
->
w
) / 2.0f);

2301 
˚¡î_y
 = 
°¨t_y
 + ((
game°©e
->
h
) / 2.0f);

2302 
x_ªquúe
 = (
game°©e
->
w
 + 
x_∑ddög
Ë/ 
øtio
;

2303 
y_ªquúe
 = 
game°©e
->
h
 + 
y_∑ddög
;

2304 
ˇmîa_height
 = 
	`maxf
(
x_ªquúe
, 
y_ªquúe
);

2305  
	`m©h_ˇmîa_buûd
(
ˇmîa_height
, 
˚¡î_x
, 
˚¡î_y
, 
võwp‹t
);

2306 
	}
}

2307 
boﬁ
 
	$MaybeAµlyBrushInPœyMode
(
Mem‹y
* 
mem‹y
, 
Game°©eBrush
* 
∑Àã
,
cuºít_brush
, 
Edô‹UISèã
* 
ui_°©e
, 
Game°©eTimeMachöe
* 
time_machöe
, 
I¡Paú
 
cuºít_°©e_pos
, 
glm
::
vec2
 
mou£GamePos
)

2309 
GameSèã
* 
cuºít_°©e
 = &
time_machöe
->
°©e_¨øy
[time_machöe->
num_game°©es_°‹ed
 - 1];

2310 
GameSèã
* 
√xt_°©e
 = &
time_machöe
->
°©e_¨øy
[time_machöe->
num_game°©es_°‹ed
];

2311 
À·
 = (Ë
cuºít_°©e_pos
.
x
;

2312 
right
 = (Ë(
cuºít_°©e_pos
.
x
 + 
cuºít_°©e
->
w
);

2313 
down
 = (Ë
cuºít_°©e_pos
.
y
;

2314 
up
 = (Ë(
cuºít_°©e_pos
.
y
 + 
cuºít_°©e
->
h
);

2315 
boﬁ
 
˛ickedFlo‹
 = 
	`m©h_˛ick_is_öside_AABB
(
À·
, 
down
, 
right
, 
up
, 
mou£GamePos
.
x
, mou£GamePos.
y
);

2316 i‡(
˛ickedFlo‹
)

2319 
≥r˚¡ageX
 = 
	`≥r˚¡_bëwìn_two_poöts
(
mou£GamePos
.
x
, 
À·
, 
right
);

2320 
≥r˚¡ageY
 = 
	`≥r˚¡_bëwìn_two_poöts
(
mou£GamePos
.
y
, 
down
, 
up
);

2321 
x_Êo‹_˚Œ_˛icked
 = ()(
≥r˚¡ageX
 * 
cuºít_°©e
->
w
);

2322 
y_Êo‹_˚Œ_˛icked
 = ()(
≥r˚¡ageY
 * 
cuºít_°©e
->
h
);

2324 
I¡Paú
 
èrgë_squ¨e
 = 
	`m©h_öçaú_¸óã
(
x_Êo‹_˚Œ_˛icked
, 
y_Êo‹_˚Œ_˛icked
);

2326 
	`game°©e_˛⁄e_to_unôülized
(
cuºít_°©e
, 
√xt_°©e
,
mem‹y
);

2327 
	`game°©e_≠∂y_brush
(
√xt_°©e
, 
∑Àã
[
cuºít_brush
], 
x_Êo‹_˚Œ_˛icked
, 
y_Êo‹_˚Œ_˛icked
);

2328 
time_machöe
->
num_game°©es_°‹ed
++;

2329 
ui_°©e
->
ty≥
 = 
ECS_BRUSH
;

2330  
åue
;

2332  
Ál£
;

2333 
	}
}

	@
1
.
0
63
748
AABB.cpp
Animation.cpp
Animation.h
Camera.cpp
Click.cpp
Click.h
Clock.h
Constants.cpp
Constants.h
Editor.h
EditorScene.h
EditorThree.h
EditorTimeMachine.cpp
Fonts.h
GameState.cpp
GameState.h
GamestateAI.h
GenericUtil.h
Grid.cpp
HelperGL.cpp
HelperGL.h
IntPair.cpp
MainHelpers.h
Math.h
Maths.h
Memory.cpp
Memory.h
MenuScene.h
Parse.cpp
Parse.h
ParticleSystem.h
PreludeIncludes.h
Regex.cpp
Regex.h
Resource.h
ResourceLoadText.cpp
SaveLoad.cpp
SaveLoad.h
Scratch.h
Shader.cpp
Shader.h
Side.h
Source.cpp
Sprites.cpp
Sprites.h
TextDraw.cpp
TextDraw.h
TextScene.h
TrueFontCharacter.h
Walk.cpp
World.cpp
World.h
draw.cpp
draw.h
gui.h
sprite.cpp
sprite.h
stb_image.h
textureAssets.cpp
textureAssets.h
tinyfiledialogs.c
tinyfiledialogs.h
win32_platform.cpp

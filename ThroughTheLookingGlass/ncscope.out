cscope 15 $HOME\source\repos\ThroughTheLookingGlass\ThroughTheLookingGlass"               0000656641
	@AABB.cpp

1 
	~"Mh.h
"

4 
	$mh_AABB_bak_to_bds
(
AABB
 
box
, AABB* 
ouut
, 
bd_size
)

7 
ouut
[0] = 
	`mh_AABB_
(
box
.
x
, box.
y
, box.
w
, 
bd_size
);

9 
ouut
[1] = 
	`mh_AABB_
(
box
.
x
, box.
y
 + box.
h
 - 
bd_size
, box.
w
, border_size);

11 
ouut
[2] = 
	`mh_AABB_
(
box
.
x
,box.
y
,
bd_size
,box.
h
);

13 
ouut
[3] = 
	`mh_AABB_
(
box
.
x
 + box.
w
 - 
bd_size
,box.
y
,bd_size, box.
h
);

14 
	}
}

15 
AABB
 
	$mh_AABB_
(
x
, 
y
, 
width
, 
height
)

17 
AABB
 
su
;

18 
su
.
x
 = x;

19 
su
.
y
 = y;

20 
su
.
w
 = 
width
;

21 
su
.
h
 = 
height
;

22  
su
;

23 
	}
}

24 
AABB
 
	$mh_AABB__t
(
x
, 
y
, 
width
, 
height
)

26 
AABB
 
su
;

27 
su
.
x
 = () x;

28 
su
.
y
 = () y;

29 
su
.
w
 = (
width
;

30 
su
.
h
 = (
height
;

31  
su
;

32 
	}
}

34 
bo
 
	$mh_AABB_is_clidg
(
AABB
 

, AABB* 
aga_y
, 
ngth
)

36 
i
 = 0; i < 
ngth
; i++)

38 
AABB
 
aga
 = 
aga_y
[
i
];

39 i(

.
x
 < 
aga
.x +ga.
w
 &&

40 

.
x
 +e.
w
 > 
aga
.x &&

41 

.
y
 < 
aga
.y +ga.
h
 &&

42 

.
y
 +e.
h
 > 
aga
.y)

44  
ue
;

47  
l
;

48 
	}
}

49 
bo
 
	$mh_AABB_is_clidg
(
AABB
 

, AABB* 
aga_y
, 
ngth
, * 
clisi_dex_out
)

51 
i
 = 0; i < 
ngth
; i++)

53 
AABB
 
aga
 = 
aga_y
[
i
];

54 i(

.
x
 < 
aga
.x +ga.
w
 &&

55 

.
x
 +e.
w
 > 
aga
.x &&

56 

.
y
 < 
aga
.y +ga.
h
 &&

57 

.
y
 +e.
h
 > 
aga
.y)

59  
i
;

62  
l
;

63 
	}
}

64 
bo
 
	$mh_AABB_is_clidg
(
AABB
 

, AABB* 
aga_y
, 
ngth
, * 
clisi_dexes_out
, 
max_clisis_to_fd
)

66 
cut_numb_of_clisis
 = 0;

67 
i
 = 0; i < 
ngth
; i++)

69 
AABB
 
aga
 = 
aga_y
[
i
];

70 i(

.
x
 < 
aga
.x +ga.
w
 &&

71 

.
x
 +e.
w
 > 
aga
.x &&

72 

.
y
 < 
aga
.y +ga.
h
 &&

73 

.
y
 +e.
h
 > 
aga
.y)

75 
clisi_dexes_out
[
cut_numb_of_clisis
] = 
i
;

76 
cut_numb_of_clisis
++;

77 i(
cut_numb_of_clisis
 >
max_clisis_to_fd
)

78  
ue
;

81  
l
;

82 
	}
}

84 
	$mh_ick_is_side_AABB_li
(
ickX
, 
ickY
, 
AABB
* 
boxes
, 
tٮ_boxes
)

86 
i
 = 0; i < 
tٮ_boxes
; i++)

88 i(
	`mh_ick_is_side_AABB
(
ickX
, 
ickY
, 
boxes
[
i
]))

89  
i
;

92 
	}
}

	@Animation.cpp

1 
	~"Animi.h
"

	@Animation.h

1 #agm



2 
	~"GameS.h
"

3 
	~"Mh.h
"

4 
	~"Memy.h
"

5 cڡ 
	gZ_POSITION_STARTING_LAYER
 = 2;

6 cڡ 
	gMAX_CRATE_ANIMATIONS
 = 4;

	@Camera.cpp

1 
	~"Mh.h
"

3 
	~"glm/glm.h
"

4 
	~"glm/gtc/mrix_sfm.h
"

5 
	~"GameS.h
"

7 
	gglm
::
m4
 
	$ma_make_mrix
(
GameSCama
 
ma
)

9  
glm
::
	`tho
(
ma
.

, cama.
right
, cama.
down
, cama.
up
, cama.
oPot
, cama.
rPot
);

10 
	}
}

11 
	$ma_tio
(
VwPtCama
 
vwpt
)

13 
height
 = 
vwpt
.
up
 - vwpt.
down
;

14 
width
 = 
vwpt
.
right
 - vwpt.

;

15  (
width
 / (
height
;

16 
	}
}

17 
	$move_ed_di
(
pos
, 
gl
, 
p
)

19 
di
 = 
gl
 - 
pos
;

20 i(
di
 < 0)

22 i(
di
 >-
p
)

23  
gl
;

24  
pos
 - 
p
;

26 i(
di
 > 0)

28 i(
di
 <
p
)

29  
gl
;

30  
pos
 + 
p
;

32  
pos
;

33 
	}
}

34 
GameSCama
 
	$mh_ma_posi_towds_
(
GameSCama
 
movg
, GameSCam
gl
, 
max_di
)

36 
GameSCama
 
su
;

37 
_move_que
 = 
gl
.

 - 
movg
.left;

38 
right_move_que
 = 
gl
.
right
 - 
movg
.right;

39 
up_move_que
 = 
gl
.
up
 - 
movg
.up;

40 
down_move_que
 = 
gl
.
down
 - 
movg
.down;

41 
x_move
 = (
_move_que
 + 
right_move_que
) / 2.0f;

42 
y_move
 = (
up_move_que
 + 
down_move_que
) / 2.0f;

43 i(
x_move
 > 0)

44 
x_move
 = 
	`mf
(x_move, 
max_di
);

45 i(
y_move
 > 0)

46 
y_move
 = 
	`mf
(y_move, 
max_di
);

47 i(
x_move
 < 0)

48 
x_move
 = 
	`maxf
(x_move, -
max_di
);

49 i(
y_move
 < 0)

50 
y_move
 = 
	`maxf
(y_move, -
max_di
);

52 i(
x_move
 =0 && 
y_move
 == 0)

53  
movg
;

55 
su
.

 = 
movg
. + 
x_move
;

56 
su
.
right
 = 
movg
.righ+ 
x_move
;

57 
su
.
up
 = 
movg
.u+ 
y_move
;

58 
su
.
down
 = 
movg
.dow+ 
y_move
;

59 
su
.
oPot
 = 
movg
.closePoint;

60 
su
.
rPot
 = 
movg
.farPoint;

61  
su
;

62 
	}
}

63 
GameSCama
 
	$mh_ma_zoom_towds_
(
GameSCama
 
movg
, GameSCam
gl
, 
max_di
)

65 
GameSCama
 
su
;

66 
cut_height
 = 
movg
.
up
 - movg.
down
;

67 
gl_height_jump
 = 
gl
.
up
 - gl.
down
;

68 
gl_height
;

69 i(
gl_height_jump
 - 
cut_height
 > 0)

71 
gl_height
 = 
	`mf
(
gl_height_jump
, 
cut_height
 + 
max_di
);

73 i(
gl_height_jump
 - 
cut_height
 < 0)

75 
gl_height
 = 
	`maxf
(
gl_height_jump
, 
cut_height
 - 
max_di
);

78 
gl_height
 = 
cut_height
;

80 
tio
 = 
gl_height
 / 
cut_height
;

81 
ma__x
 = (
movg
.

 + movg.
right
) / 2.0f;

82 
ma__y
 = (
movg
.
up
 + movg.
down
) / 2.0f;

83 
ma_width
 = (
movg
.
right
 - movg.

);

84 
ma_height
 = (
movg
.
up
 - movg.
down
);

85 
w_ma_hf_width
 = (
ma_width
 / 2.0f* 
tio
;

86 
w_ma_hf_height
 = (
ma_height
 / 2.0f* 
tio
;

88 
su
.

 = 
ma__x
 - 
w_ma_hf_width
;

89 
su
.
right
 = 
ma__x
 + 
w_ma_hf_width
;

90 
su
.
down
 = 
ma__y
 - 
w_ma_hf_height
;

91 
su
.
up
 = 
ma__y
 + 
w_ma_hf_height
;

92 
su
.
oPot
 = 
movg
.closePoint;

93 
su
.
rPot
 = 
movg
.farPoint;

94  
su
;

95 
	}
}

98 
	$smoh_t3
(
t
)

100  
t
 * *;

101 
	}
}

102 
	$smoh_3
(
t
)

104  1 - (1 - 
t
) * (1 -) * (1 -);

105 
	}
}

106 
	$mix
(
a
, 
b
, 
weight
, 
t
)

108  
a
 * (1 - 
weight
+ 
b
 * weight;

109 
	}
}

110 
	$smoh_3
(
t
)

112  
	`mix
(
	`smoh_t3
(
t
), 
	`smoh_3
(t),,);

113 
	}
}

115 
GameSCama
 
	$mh_ma_move_towds_˽
(
GameSCama
 
movg
, GameSCam
gl
, 
cut_time
,
gl_time
)

117 
t
 = 
cut_time
 / 
gl_time
;

118 
t
 = 
	`mf
(t, 1);

119 
t
 = 
	`maxf
(t, 0);

120 
t
 = 
	`smoh_3
(t);

121 
GameSCama
 
su
;

123 
x__d
 = (
movg
.
right
 + movg.

) / 2.0f;

124 
y__d
 = (
movg
.
up
 + movg.
down
 )/ 2.0f;

125 
x__xt
 = (
gl
.
right
 + gl.

) / 2.0f;

126 
y__xt
 = (
gl
.
up
 + gl.
down
) / 2.0f;

128 
x__now
 = 
x__d
 * (1 - 
t
+ 
x__xt
 *;

129 
y__now
 = 
y__d
 * (1 - 
t
+ 
y__xt
 *;

131 
zoom_d
 = 
movg
.
up
 - movg.
down
;

132 
zoom_xt
 = 
gl
.
up
 - gl.
down
;

133 
zoom_now
 = 
zoom_d
 * (1 - 
t
+ 
zoom_xt
 *;

135 
tio
 = (
movg
.
right
 - movg.

/ (movg.
up
 - movg.
down
);

136 
su
.

 = 
x__now
 - (
zoom_now
 * 
tio
) / 2.0f;

137 
su
.
right
 = 
x__now
 + (
zoom_now
 * 
tio
) / 2.0f;

138 
su
.
up
 = 
y__now
 + 
zoom_now
 / 2.0f;

139 
su
.
down
 = 
y__now
 - 
zoom_now
 / 2.0f;

140 
su
.
oPot
 = 
movg
.closePoint;

141 
su
.
rPot
 = 
movg
.farPoint;

142  
su
;

143 
	}
}

144 
GameSCama
 
	$mh_ma_bud
(
ma_height
, 
sn__x
, 
sn__y
, 
VwPtCama
 
vwpt
)

146 
GameSCama
 
su
;

148 
ma__x
;

149 
ma_btom_y
;

150 
ma_right_x
;

151 
ma_t_y
;

154 
ma_vw_width
 = 
vwpt
.
right
 - vwpt.

;

155 
ma_vw_height
 = 
vwpt
.
up
 - vwpt.
down
;

156 
tio
 = ()
ma_vw_width
 / ()
ma_vw_height
;

157 
ma__x
 = 
sn__x
 - (
ma_height
 * 
tio
) / 2.0f;

158 
ma_btom_y
 = 
sn__y
 - (
ma_height
) / 2.0f;

159 
ma_right_x
 = 
ma__x
 + 
ma_height
 * 
tio
;

160 
ma_t_y
 = 
ma_btom_y
 + 
ma_height
;

163 
su
.

 = 
ma__x
;

164 
su
.
right
 = 
ma_right_x
;

165 
su
.
up
 = 
ma_t_y
;

166 
su
.
down
 = 
ma_btom_y
;

167 
su
.
oPot
 = -20;

168 
su
.
rPot
 = 20.0f;

169  
su
;

170 
	}
}

171 
	gglm
::
vec2
 
	$mh_sna_to_pixa
(
IPa
 
snSPosi
, 
GameSCama
 
ma
, 
VwPtCama
 
vw
, 
gameHeight
)

173 
glm
::
vec2
 
su
;

174 
su
.
x
 = 
snSPosi
.x + 
ma
.

 * 
vw
.
up
 / 
gameHeight
;

175 
su
.
y
 = 
snSPosi
.y + 
ma
.
down
 * 
vw
.
up
 / 
gameHeight
;

176  
su
;

177 
	}
}

178 
	gglm
::
vec2
 
	$mh_pixa_to_sna
(
IPa
 
pixSPosi
, 
GameSCama
 
ma
, 
VwPtCama
 
vw
, 
gameHeight
)

180 
glm
::
vec2
 
su
;

181 
su
.
x
 = 
pixSPosi
.x - 
ma
.

 * 
vw
.
up
 / 
gameHeight
;

182 
su
.
y
 = 
pixSPosi
.y - 
ma
.
down
 * 
vw
.
up
 / 
gameHeight
;

183  
su
;

184 
	}
}

185 
	gglm
::
vec2
 
	$mh_sna_to_gamea
(
IPa
 
snSPosi
, 
GameSCama
 
ma
, 
VwPtCama
 
vw
, 
gameHeight
)

188 
glm
::
vec2
 
pixa
 = 
	`mh_sna_to_pixa
(
snSPosi
, 
ma
, 
vw
, 
gameHeight
);

190 
glm
::
vec2
 
su
;

191 
divide
 = 
	`mh_gamea_to_pixa_muɝlr
(
vw
, 
gameHeight
);

192 
su
.
x
 = 
pixa
.x / 
divide
;

193 
su
.
y
 = 
pixa
.y / 
divide
;

195  
su
;

196 
	}
}

199 
	gglm
::
m4
 
	$mh_ed_mrix
(
glm
::
vec3
 
e
)

201 
glm
::
m4
 
su
 = glm::
	`m4
(1.0);

202  
glm
::
	`e
(
su
, 
e
);

203 
	}
}

204 
	gglm
::
m4
 
	$mh_ed_sd_mrix
(
glm
::
vec3
 
e
, glm::vec3 
s
)

206 
glm
::
m4
 
su
 = glm::
	`m4
(1.0f);

207 
su
 = 
glm
::
	`e
esu, 
e
);

208 
su
 = 
glm
::
	`s
esu, 
s
);

209  
su
;

210 
	}
}

211 
	$mh_gamea_to_pixa_muɝlr
(
VwPtCama
 
vw
, 
gameHeight
)

213 
yDi
 = (
vw
.
up
 - (vw.
down
;

214 
su
 = 
yDi
 / 
gameHeight
;

215  
su
;

216 
	}
}

217 
	$mh_pixa_to_gamea_muɝlr
(
VwPtCama
 
vw
, 
gameHeight
)

219  1 / 
	`mh_gamea_to_pixa_muɝlr
(
vw
, 
gameHeight
);

220 
	}
}

	@Click.cpp

1 
	~"Click.h
"

2 
	~"Cڡts.h
"

4 
	$bu_ick_e_t_l_l
(
bu_ick_e
* 
e
)

6 
e
->
esd
 = 
l
;

7 
e
->
esd_this_ame
 = 
l
;

8 
e
->
ad_this_ame
 = 
l
;

9 
e
->
ad_s_esd_ϡ
 = 
ue
;

10 
e
->
time_esd
 = 0;

11 
	}
}

12 
bu_ick_e
 
	$ick__bu
(
EdUIS
* 
ui_e
, 
GAME_ACTION
 
ai
)

17 
MpgS
 
e
;

18 
	}
}

19 
MpgS
 
	$ick_make_deu_mpg_e
()

21 
MpgS
 
su
;

22 
i
 = 0; i < 
G_LENGTH
; i++)

24 
su
.
imy_mpg
[
i
] = 
SDLK_UNKNOWN
;

25 
su
.
cdy_mpg
[
i
] = 
SDLK_UNKNOWN
;

27 
su
.
imy_mpg
[
G_UP
] = 
SDLK_UP
;

28 
su
.
imy_mpg
[
G_DOWN
] = 
SDLK_DOWN
;

29 
su
.
imy_mpg
[
G_LEFT
] = 
SDLK_LEFT
;

30 
su
.
imy_mpg
[
G_RIGHT
] = 
SDLK_RIGHT
;

31 
su
.
imy_mpg
[
G_UNDO
] = 
SDLK_z
;

32 
su
.
imy_mpg
[
G_RESET
] = 
SDLK_r
;

33 
su
.
imy_mpg
[
G_EXIT_LEVEL
] = 
SDLK_q
;

34 
su
.
imy_mpg
[
G_BACK_MENU
] = 
SDLK_BACKSPACE
;

35 
su
.
imy_mpg
[
G_MENU_UP
] = 
SDLK_w
;

36 
su
.
imy_mpg
[
G_MENU_DOWN
] = 
SDLK_s
;

37 
su
.
imy_mpg
[
G_MENU_ENTER
] = 
SDLK_KP_ENTER
;

39 
su
.
cdy_mpg
[
G_UP
] = 
SDLK_w
;

40 
su
.
cdy_mpg
[
G_DOWN
] = 
SDLK_s
;

41 
su
.
cdy_mpg
[
G_LEFT
] = 
SDLK_a
;

42 
su
.
cdy_mpg
[
G_RIGHT
] = 
SDLK_d
;

43 
su
.
cdy_mpg
[
G_UNDO
] = 
SDLK_UNKNOWN
;

44 
su
.
cdy_mpg
[
G_RESET
] = 
SDLK_UNKNOWN
;

45 
su
.
cdy_mpg
[
G_EXIT_LEVEL
] = 
SDLK_UNKNOWN
;

46 
su
.
cdy_mpg
[
G_BACK_MENU
] = 
SDLK_UNKNOWN
;

47 
su
.
cdy_mpg
[
G_MENU_UP
] = 
SDLK_UP
;

48 
su
.
cdy_mpg
[
G_MENU_DOWN
] = 
SDLK_DOWN
;

49 
su
.
cdy_mpg
[
G_MENU_ENTER
] = 
SDLK_UNKNOWN
;

51  
su
;

52 
	}
}

54 
EdUIS
 
	$ick_ui_
(
Memy
* 
rmt_memy
)

56 
EdUIS
 
su
;

58 
su
.
time_s_s_d
 = 0;

59 
su
.
time_tl_ay_n_move
 = 0;

60 
su
.
time_s_ϡ_ay_ai
 = 0;

62 
su
.
mo_ly_esd_dei
 = ' ';

63 
su
.
ˉs
 = (
bu_ick_e
*)
	`memy_loc
(
rmt_memy
, (bu_ick_e* 
NUM_LETTERS_ON_KEYBOARD
);

64 
su
.
bu_mpg
 = 
	`ick_make_deu_mpg_e
();

65 
i
 = 0; i < 
NUM_SDLK_KEYCODES
; i++)

67 
su
.
key_vues
[
i
].
esd
 = 
l
;

68 
su
.
key_vues
[
i
].
esd_this_ame
 = 
l
;

69 
su
.
key_vues
[
i
].
ad_this_ame
 = 
l
;

70 
su
.
key_vues
[
i
].
ad_s_esd_ϡ
 = 
ue
;

71 
su
.
key_vues
[
i
].
time_esd
 = 0;

73 
i
 = 0; i < 
NUM_LETTERS_ON_KEYBOARD
; i++)

75 
su
.
ˉs
[
i
].
esd
 = 
l
;

76 
su
.
ˉs
[
i
].
esd_this_ame
 = 
l
;

77 
su
.
ˉs
[
i
].
ad_this_ame
 = 
l
;

78 
su
.
ˉs
[
i
].
ad_s_esd_ϡ
 = 
ue
;

79 
su
.
ˉs
[
i
].
time_esd
 = 0;

81 
	`bu_ick_e_t_l_l
(&
su
.

);

82 
	`bu_ick_e_t_l_l
(&
su
.
right
);

83 
	`bu_ick_e_t_l_l
(&
su
.
down
);

84 
	`bu_ick_e_t_l_l
(&
su
.
up
);

85 
	`bu_ick_e_t_l_l
(&
su
.
ab
);

86 
	`bu_ick_e_t_l_l
(&
su
.
r
);

87 
x
 = 
SDLK_UNDERSCORE
;

88 
z
 = 
SDLK_RIGHTPAREN
;

89 
su
.
game_height_cut
 = 
GAME_HEIGHT_START
;

90 
su
.
ty
 = 
ECS_NEUTRAL
;

91 
su
.
mouGamePos
 = 
glm
::
	`vec2
(0, 0);

92 
su
.
mou_ϡ_pos
 = 
	`mh_a_
(0, 0);

93 
su
.
mouPos
 = 
	`mh_a_
(0, 0);

94 
su
.
tٮMove
 = 
	`mh_a_
(0, 0);

95 
su
.
mou__ick_down
 = 
l
;

96 
su
.
mou_right_ick_down
 = 
l
;

97 
su
.
un
.
u
.
x
 = 0;

98 
su
.
shi_key_down_this_ame
 = 
l
;

99 
su
.
shi_key_up_this_ame
 = 
l
;

100 
su
.
shi_key_down
 = 
l
;

101 
su
.
cڌ_key_down
 = 
l
;

102 
su
.
t_key_down
 = 
l
;

103 
su
.
z_key_down_this_ame
 = 
l
;

104 
su
.
backa_key_down_this_ame
 = 
l
;

106  
su
;

107 
	}
}

110 
	$ick_sdl_keycode_to_dex_posi
(
sdlk_keycode
)

112 
i
 = 0; i < 
NUM_SDLK_KEYCODES
; i++)

114 i(
l_sdl_keycodes
[
i
] =
sdlk_keycode
)

116  
i
;

119 
	`ash_r
("weriedoookup sdlk keycode, but it didn't matchny sdlkeycodes we knowbout. This shouldever happen. crash!");

121 
	}
}

	@Click.h

1 #agm



2 
	~"Mh.h
"

3 
	~<SDL.h
>

4 cڡ 
	gGAME_HEIGHT_START
 = 12;

5 cڡ 
	gNUM_LETTERS_ON_KEYBOARD
 = 
SDLK_z
 - 
SDLK_a
 + 1;

6 cڡ 
	gNUM_SDLK_KEYCODES
 = 255;

7 cڡ 
	gNUM_KEYS_TO_TEST
 = 5;

9 
	eEdClickSTy


11 
	mECS_NEUTRAL
,

12 
	mECS_BRUSH
,

13 
	mECS_RESIZE_GAMESTATE
,

14 
	mECS_MOVE_GAMESTATE
,

15 
	mECS_CREATE_GAMESTATE
,

16 
	mECS_EDIT_NAME
,

17 
	mECS_COUNT


20 
	eGAME_ACTION


22 
	mG_UP
,

23 
	mG_DOWN
,

24 
	mG_LEFT
,

25 
	mG_RIGHT
,

26 
	mG_UNDO
,

27 
	mG_RESET
,

28 
	mG_EXIT_LEVEL
,

29 
	mG_BACK_MENU
,

30 
	mG_MENU_UP
,

31 
	mG_MENU_DOWN
,

32 
	mG_MENU_ENTER
,

33 
	mG_LENGTH
,

34 
	mG_ERROR


36 
	sNeuClickS


38 
	mx
;

40 
	sBrushClickS


42 
	my
;

44 
	sResizeClickS


46 
bo
 
	mdggg_
;

47 
bo
 
	mdggg_right
;

48 
bo
 
	mdggg_up
;

49 
bo
 
	mdggg_down
;

50 
	mdggg_gamee_dex
;

52 
	sMoveClickS


54 
	mmovg_gamee_dex
;

55 
	mglm
::
vec2
 
move_t_posi
;

57 
	sCeGameeClickS


59 
IPa
 
	mgamewld_t_pos
;

62 
	sbu_ick_e


65 
bo
 
	mesd_this_ame
;

66 
bo
 
	mad_this_ame
;

67 
bo
 
	mesd
;

68 
bo
 
	mad_s_esd_ϡ
;

69 
	mtime_esd
;

72 
	sMpgS


74 
SDL_KeyCode
 
	mimy_mpg
[
G_LENGTH
];

75 
SDL_KeyCode
 
	mcdy_mpg
[
G_LENGTH
];

78 
	sEdUIS


80 
bo
 
	mupde_au_sn_size
;

81 
	mglm
::
ivec2
 
xt_ma_size
;

82 
	mtime_s_s_d
;

83 
	mtime_tl_ay_n_move
;

84 
	mtime_s_ϡ_ay_ai
;

85 
	mtٮ_time_sd
;

86 
	mgame_height_cut
;

88 
	mmo_ly_esd_dei
;

89 
MpgS
 
	mbu_mpg
;

90 
bu_ick_e
* 
	mˉs
;

91 
bu_ick_e
 
	mkey_vues
[
NUM_SDLK_KEYCODES
];

92 
bu_ick_e
 
	m
;

93 
bu_ick_e
 
	mright
;

94 
bu_ick_e
 
	mup
;

95 
bu_ick_e
 
	mdown
;

97 
bu_ick_e
 
	mab
;

98 
bu_ick_e
 
	mr
;

99 
EdClickSTy
 
	mty
;

101 
bo
 
	mick__down_this_ame
;

102 
bo
 
	mick__up_this_ame
;

103 
bo
 
	mmou__ick_down
;

104 
bo
 
	mmou_right_ick_down
;

105 
bo
 
	mshi_key_down_this_ame
;

106 
bo
 
	mshi_key_up_this_ame
;

107 
bo
 
	mshi_key_down
;

108 
bo
 
	mcڌ_key_down
;

109 
bo
 
	mt_key_down
;

110 
bo
 
	mz_key_down_this_ame
;

111 
	mwhl_move
;

112 
bo
 
	mbacka_key_down_this_ame
;

115 
	mglm
::
vec2
 
mouGamePos
;

116 
IPa
 
	mmou_ϡ_pos
;

117 
IPa
 
	mmouPos
;

118 
IPa
 
	mtٮMove
;

120 
NeuClickS
 
	mu
;

121 
BrushClickS
 
	mbrush
;

122 
ResizeClickS
 
	msize
;

123 
MoveClickS
 
	mmove
;

124 
CeGameeClickS
 
	m
;

125 } 
	mun
;

129 
bu_ick_e
 
ick__bu
(
EdUIS
* 
ui_e
, 
GAME_ACTION
 
ai
);

130 
MpgS
 
ick_make_deu_mpg_e
();

131 
bu_ick_e_t_l_l
(
bu_ick_e
* 
e
);

132 
EdUIS
 
ick_ui_
(
Memy
* 
rmt_memy
);

133 
ick_sdl_keycode_to_dex_posi
(
sdlk_keycode
);

134 cڡ 
	gl_sdl_keycodes
[] = {

135 
SDLK_0
,

136 
SDLK_1
,

137 
SDLK_2
,

138 
SDLK_3
,

139 
SDLK_4
,

140 
SDLK_5
,

141 
SDLK_6
,

142 
SDLK_7
,

143 
SDLK_8
,

144 
SDLK_9
,

145 
SDLK_a
,

146 
SDLK_AC_BACK
,

147 
SDLK_AC_BOOKMARKS
,

148 
SDLK_AC_FORWARD
,

149 
SDLK_AC_HOME
,

150 
SDLK_AC_REFRESH
,

151 
SDLK_AC_SEARCH
,

152 
SDLK_AC_STOP
,

153 
SDLK_AGAIN
,

154 
SDLK_ALTERASE
,

155 
SDLK_QUOTE
,

156 
SDLK_APPLICATION
,

157 
SDLK_AUDIOMUTE
,

158 
SDLK_AUDIONEXT
,

159 
SDLK_AUDIOPLAY
,

160 
SDLK_AUDIOPREV
,

161 
SDLK_AUDIOSTOP
,

162 
SDLK_b
,

163 
SDLK_BACKSLASH
,

164 
SDLK_BACKSPACE
,

165 
SDLK_BRIGHTNESSDOWN
,

166 
SDLK_BRIGHTNESSUP
,

167 
SDLK_c
,

168 
SDLK_CALCULATOR
,

169 
SDLK_CANCEL
,

170 
SDLK_CAPSLOCK
,

171 
SDLK_CLEAR
,

172 
SDLK_CLEARAGAIN
,

173 
SDLK_COMMA
,

174 
SDLK_COMPUTER
,

175 
SDLK_COPY
,

176 
SDLK_CRSEL
,

177 
SDLK_CURRENCYSUBUNIT
,

178 
SDLK_CURRENCYUNIT
,

179 
SDLK_CUT
,

180 
SDLK_d
,

181 
SDLK_DECIMALSEPARATOR
,

182 
SDLK_DELETE
,

183 
SDLK_DISPLAYSWITCH
,

184 
SDLK_DOWN
,

185 
SDLK_e
,

186 
SDLK_EJECT
,

187 
SDLK_END
,

188 
SDLK_EQUALS
,

189 
SDLK_ESCAPE
,

190 
SDLK_EXECUTE
,

191 
SDLK_EXSEL
,

192 
SDLK_f
,

193 
SDLK_F1
,

194 
SDLK_F10
,

195 
SDLK_F11
,

196 
SDLK_F12
,

197 
SDLK_F13
,

198 
SDLK_F14
,

199 
SDLK_F15
,

200 
SDLK_F16
,

201 
SDLK_F17
,

202 
SDLK_F18
,

203 
SDLK_F19
,

204 
SDLK_F2
,

205 
SDLK_F20
,

206 
SDLK_F21
,

207 
SDLK_F22
,

208 
SDLK_F23
,

209 
SDLK_F24
,

210 
SDLK_F3
,

211 
SDLK_F4
,

212 
SDLK_F5
,

213 
SDLK_F6
,

214 
SDLK_F7
,

215 
SDLK_F8
,

216 
SDLK_F9
,

217 
SDLK_FIND
,

218 
SDLK_g
,

219 
SDLK_BACKQUOTE
,

220 
SDLK_h
,

221 
SDLK_HELP
,

222 
SDLK_HOME
,

223 
SDLK_i
,

224 
SDLK_INSERT
,

225 
SDLK_j
,

226 
SDLK_k
,

227 
SDLK_KBDILLUMDOWN
,

228 
SDLK_KBDILLUMTOGGLE
,

229 
SDLK_KBDILLUMUP
,

230 
SDLK_KP_0
,

231 
SDLK_KP_00
,

232 
SDLK_KP_000
,

233 
SDLK_KP_1
,

234 
SDLK_KP_2
,

235 
SDLK_KP_3
,

236 
SDLK_KP_4
,

237 
SDLK_KP_5
,

238 
SDLK_KP_6
,

239 
SDLK_KP_7
,

240 
SDLK_KP_8
,

241 
SDLK_KP_9
,

242 
SDLK_KP_A
,

243 
SDLK_KP_AMPERSAND
,

244 
SDLK_KP_AT
,

245 
SDLK_KP_B
,

246 
SDLK_KP_BACKSPACE
,

247 
SDLK_KP_BINARY
,

248 
SDLK_KP_C
,

249 
SDLK_KP_CLEAR
,

250 
SDLK_KP_CLEARENTRY
,

251 
SDLK_KP_COLON
,

252 
SDLK_KP_COMMA
,

253 
SDLK_KP_D
,

254 
SDLK_KP_DBLAMPERSAND
,

255 
SDLK_KP_DECIMAL
,

256 
SDLK_KP_DIVIDE
,

257 
SDLK_KP_E
,

258 
SDLK_KP_ENTER
,

259 
SDLK_KP_EQUALS
,

260 
SDLK_KP_EQUALSAS400
,

261 
SDLK_KP_EXCLAM
,

262 
SDLK_KP_F
,

263 
SDLK_KP_GREATER
,

264 
SDLK_KP_HASH
,

265 
SDLK_KP_HEXADECIMAL
,

266 
SDLK_KP_LEFTBRACE
,

267 
SDLK_KP_LEFTPAREN
,

268 
SDLK_KP_LESS
,

269 
SDLK_KP_MEMADD
,

270 
SDLK_KP_MEMCLEAR
,

271 
SDLK_KP_MEMDIVIDE
,

272 
SDLK_KP_MEMMULTIPLY
,

273 
SDLK_KP_MEMRECALL
,

274 
SDLK_KP_MEMSTORE
,

275 
SDLK_KP_MEMSUBTRACT
,

276 
SDLK_KP_MINUS
,

277 
SDLK_KP_MULTIPLY
,

278 
SDLK_KP_OCTAL
,

279 
SDLK_KP_PERCENT
,

280 
SDLK_KP_PERIOD
,

281 
SDLK_KP_PLUS
,

282 
SDLK_KP_PLUSMINUS
,

283 
SDLK_KP_POWER
,

284 
SDLK_KP_RIGHTBRACE
,

285 
SDLK_KP_RIGHTPAREN
,

286 
SDLK_KP_SPACE
,

287 
SDLK_KP_TAB
,

288 
SDLK_KP_VERTICALBAR
,

289 
SDLK_KP_XOR
,

290 
SDLK_l
,

291 
SDLK_LALT
,

292 
SDLK_LCTRL
,

293 
SDLK_LEFT
,

294 
SDLK_LEFTBRACKET
,

295 
SDLK_LGUI
,

296 
SDLK_LSHIFT
,

297 
SDLK_m
,

298 
SDLK_MAIL
,

299 
SDLK_MEDIASELECT
,

300 
SDLK_MENU
,

301 
SDLK_MINUS
,

302 
SDLK_MODE
,

303 
SDLK_MUTE
,

304 
SDLK_n
,

305 
SDLK_NUMLOCKCLEAR
,

306 
SDLK_o
,

307 
SDLK_OPER
,

308 
SDLK_OUT
,

309 
SDLK_p
,

310 
SDLK_PAGEDOWN
,

311 
SDLK_PAGEUP
,

312 
SDLK_PASTE
,

313 
SDLK_PAUSE
,

314 
SDLK_PERIOD
,

315 
SDLK_POWER
,

316 
SDLK_PRINTSCREEN
,

317 
SDLK_PRIOR
,

318 
SDLK_q
,

319 
SDLK_r
,

320 
SDLK_RALT
,

321 
SDLK_RCTRL
,

322 
SDLK_RETURN
,

323 
SDLK_RETURN2
,

324 
SDLK_RGUI
,

325 
SDLK_RIGHT
,

326 
SDLK_RIGHTBRACKET
,

327 
SDLK_RSHIFT
,

328 
SDLK_s
,

329 
SDLK_SCROLLLOCK
,

330 
SDLK_SELECT
,

331 
SDLK_SEMICOLON
,

332 
SDLK_SEPARATOR
,

333 
SDLK_SLASH
,

334 
SDLK_SLEEP
,

335 
SDLK_SPACE
,

336 
SDLK_STOP
,

337 
SDLK_SYSREQ
,

338 
SDLK_t
,

339 
SDLK_TAB
,

340 
SDLK_THOUSANDSSEPARATOR
,

341 
SDLK_u
,

342 
SDLK_UNDO
,

343 
SDLK_UNKNOWN
,

344 
SDLK_UP
,

345 
SDLK_v
,

346 
SDLK_VOLUMEDOWN
,

347 
SDLK_VOLUMEUP
,

348 
SDLK_w
,

349 
SDLK_WWW
,

350 
SDLK_x
,

351 
SDLK_y
,

352 
SDLK_z
,

353 
SDL_SCANCODE_INTERNATIONAL1
,

354 
SDL_SCANCODE_INTERNATIONAL2
,

355 
SDL_SCANCODE_INTERNATIONAL3
,

356 
SDL_SCANCODE_INTERNATIONAL4
,

357 
SDL_SCANCODE_INTERNATIONAL5
,

358 
SDL_SCANCODE_INTERNATIONAL6
,

359 
SDL_SCANCODE_INTERNATIONAL7
,

360 
SDL_SCANCODE_INTERNATIONAL8
,

361 
SDL_SCANCODE_INTERNATIONAL9
,

362 
SDL_SCANCODE_LANG1
,

363 
SDL_SCANCODE_LANG2
,

364 
SDL_SCANCODE_LANG3
,

365 
SDL_SCANCODE_LANG4
,

366 
SDL_SCANCODE_LANG5
,

367 
SDL_SCANCODE_LANG6
,

368 
SDL_SCANCODE_LANG7
,

369 
SDL_SCANCODE_LANG8
,

370 
SDL_SCANCODE_LANG9
,

371 
SDL_SCANCODE_NONUSBACKSLASH
,

372 
SDL_SCANCODE_NONUSHASH
,

373 
SDLK_AMPERSAND
,

374 
SDLK_ASTERISK
,

375 
SDLK_AT
,

376 
SDLK_CARET
,

377 
SDLK_COLON
,

378 
SDLK_DOLLAR
,

379 
SDLK_EXCLAIM
,

380 
SDLK_GREATER
,

381 
SDLK_HASH
,

382 
SDLK_LEFTPAREN
,

383 
SDLK_LESS
,

384 
SDLK_PERCENT
,

385 
SDLK_PLUS
,

386 
SDLK_QUESTION
,

387 
SDLK_QUOTEDBL
,

388 
SDLK_RIGHTPAREN
,

389 
SDLK_UNDERSCORE


	@Clock.h

1 #agm



2 
	~<Wdows.h
>

3 
	~<ioam
>

4 
	~"Memy.h
"

5 
	sClock


7 
LARGE_INTEGER
 
	mockFqucy
;

8 
LARGE_INTEGER
 
	mpos
;

9 
LARGE_INTEGER
 
	md
;

12 
le
 
Clock
* 
	$ock_
(
Memy
* 
memy
)

14 
Clock
* 
ock
 = (Clock*
	`memy_loc
(
memy
, (Clock));

15  
ock
;

16 
	}
}

17 
le
 
	$ock_t
(
Clock
* 
ock
)

19 
	`QuyPfmFqucy
(&(
ock
->
ockFqucy
));

20 
	`QuyPfmCou
(&(
ock
->
pos
));

21 
	}
}

23 
le
 
	$ock_d
(
Clock
* 
ock
)

25 
	`QuyPfmCou
(&(
ock
->
d
));

26 
timeCsumed
 = ((
ock
->
d
.
QuadPt
 - clock->
pos
.QuadPart);

27 
time__mlcds
 = (((1000 * 
timeCsumed
/ (
ock
->
ockFqucy
.
QuadPt
);

28 
d
::
cout
 << "Timcsumed imlicds" << 
time__mlcds
 << std::
dl
;

29 
	}
}

	@Constants.cpp

1 
	~"Cڡts.h
"

3 
	$fu_ash_r
(cڡ * 
xt
, cڡ * 
fe
, 
le
)

5 
d
::
cout
 << "FATAL CRASH" << std::
dl
;

6 
d
::
cout
 << 
xt
 << "e:" << 
le
 << ", ife:" << 
fe
 << std::
dl
;

7 
	`abt
();

8 
	}
}

	@Constants.h

1 #agm



2 
	~<ioam
>

5 cڡ 
	gGAME_LEVEL_NAME_MAX_SIZE
 = 64;

7 cڡ 
	gMAX_EDITOR_ACTIONS
 = 100000;

8 cڡ 
	gMAX_NUMBER_GAMESTATES
 = 1000;

9 cڡ 
	gTIME_TO_DISPLAY_LEVEL_NAME
 = 1.5f;

11 
	eSCENE_TYPE


13 
	mST_EDITOR
,

14 
	mST_EDIT_LEVEL
,

15 
	mST_PLAY_WORLD
,

16 
	mST_PLAY_LEVEL
,

17 
	mST_SHOW_TEXT
,

18 
	mST_MENU
,

19 
	mST_COUNT


22 
	eUI_SPRITE_NAME


24 
	mBUTTON_LEFT
,

25 
	mBUTTON_RIGHT
,

26 
	mBUTTON_CENTER
,

27 
	mUP_ARROW
,

28 
	mDOWN_ARROW
,

29 
	mRIGHT_ARROW
,

30 
	mLEFT_ARROW


34 cڡ 
	gSCREEN_STARTING_WIDTH
 = 800;

35 cڡ 
	gSCREEN_STARTING_HEIGHT
 = 600;

36 cڡ 
	gSCREEN_RATIO
 = (()
SCREEN_STARTING_WIDTH
 / ()
SCREEN_STARTING_HEIGHT
);

37 cڡ 
	gMAX_NUM_FLOOR_SPRITES
 = 5000;

40 cڡ 
	gCAMERA_LERP_TIME
 = 0.8f;

41 cڡ 
	gCAMERA_ZOOM_SPEED
 = 3.0f;

42 cڡ 
	gCAMERA_MOVE_MULT
 = 0.02f;

44 cڡ 
	gMAX_ZOOM
 = 2.0f;

45 cڡ 
	gMAX_ZOOM_OUT_TO_STILL_DISPLAY_OUTLINES
 = 22.0f;

46 cڡ 
	gMAX_NUM_DOTTED_SPRITES
 = 200;

47 cڡ 
	gMAX_NUM_CHARACTERS
 = 200;

48 cڡ 
	gOUTLINE_DRAW_SIZE
 = 0.3f;

52 cڡ 
	gmax_ais__puzz
 = 1024;

54 cڡ 
	gWAIT_BETWEEN_PLAYER_MOVE_REPEAT
 = 0.13f;

55 cڡ 
	gDRAW_TITLE_TIME
 = 2.0f;

60 
	#ash_r
(...d{
	`fu_ash_r
(
__VA_ARGS__
, 
__FILE__
, 
__LINE__
);} 0)

	)

61 
fu_ash_r
(cڡ * 
xt
, cڡ * 
fe
, 
le
);

	@Editor.h

1 #agm



2 
	~"Mh.h
"

3 
	~"GameS.h
"

4 
	~"Cڡts.h
"

6 
	eTimeMacheEdAiName


8 
	mTM_APPLY_BRUSH
,

9 
	mTM_MOVE_GAMESTATE
,

10 
	mTM_MERGE_GAMESTATES
,

11 
	mTM_RESIZE_GAMESTATE
,

12 
	mTM_CREATE_GAMESTATE
,

13 
	mTM_DELETE_GAMESTATE
,

14 
	mTM_REPLACE_GAMESTATE
,

15 
	mTM_UPDATE_GAMESTATE
,

16 
	mTM_UNDO
,

17 
	mTM_CHANGE_LEVEL_MODE
,

18 
	mTM_LEVEL_LINKS
,

19 
	mTM_COUNT


21 
	eLevMode


23 
	mCrumb
,

24 
	mRt
,

25 
	mOvwld


28 
	sWldPosi


30 
	mv_dex
;

31 
IPa
 
	mv_posi
;

32 
	mv_posi_1d
;

35 
	sSGamee


37 
	mrg_gamee_dex
;

38 
	mrg_x
;

39 
	mrg_y
;

40 
bo
 
	ml_row_n_cumn
;

42 
	sSuoundWhWls


44 
	mrg_gamee_dex
;

46 
	sResizeGamee


48 
	mrg_gamee_dex
;

49 
IPa
 
	mxt_tg_posi
;

50 
IPa
 
	mxt_size
;

51 
IPa
 
	mdimt_om_put_to_xt
;

53 
	sAlyBrush


55 
	mrg_gamee_dex
;

56 
IPa
 
	mrg_sque
;

57 
GameeBrush
 
	mbrush
;

59 
	sMoveGamee


61 
	mrg_gamee_dex
;

62 
IPa
 
	mmoveDi
;

64 
	sMgeGamee


66 
	mgamee_dex_
;

67 
	mgamee_dex_right
;

68 
IPa
 
	mwlda_
;

69 
IPa
 
	mwlda_right
;

71 
	sRemoveGamee


73 
	mgamee_dex
;

75 
	sCeGameS
 {

76 
	mx
;

77 
	my
;

78 
	mw
;

79 
	mh
;

81 
	sRGamee


83 
GameS
* 
	ma_e
;

84 
	mdex_to_a
;

85 
	mme
[
GAME_LEVEL_NAME_MAX_SIZE
];

87 
	sChgeLevMode


89 
	mdex_to_a
;

90 
LevMode
 
	ma_vue
;

92 
	sUpdeGamee


94 
GameS
* 
	ma_e
;

95 
	mdex_to_a
;

97 
	sLevLks


99 
WldPosi
 
	mlk_a
;

100 
WldPosi
 
	mlk_b
;

104 
	sTimeMacheEdAi


106 
TimeMacheEdAiName
 
	mai
;

108 
RemoveGamee
 
	mmove
;

109 
MoveGamee
 
	mmove
;

110 
MgeGamee
 
	mmge
;

111 
AlyBrush
 
	mbrush
;

112 
ResizeGamee
 
	msize
;

113 
CeGameS
 
	m
;

114 
RGamee
 
	ma
;

115 
UpdeGamee
 
	mupde
;

116 
ChgeLevMode
 
	mv
;

117 } 
	mu
;

120 
	sLevName


122 
	mme
[
GAME_LEVEL_NAME_MAX_SIZE
];

125 
	sWldS


127 
	mnum_v
;

128 
IPa
 
	mv_posi
[
MAX_NUMBER_GAMESTATES
];

129 
GameS
* 
	mv_e
[
MAX_NUMBER_GAMESTATES
];

130 
LevName
 
	mv_mes
[
MAX_NUMBER_GAMESTATES
];

131 
LevMode
 
	mv_modes
[
MAX_NUMBER_GAMESTATES
];

132 
bo
 
	mv_sved
[
MAX_NUMBER_GAMESTATES
];

134 
	sTimeMacheEd


136 
Memy
* 
	mgamee_memy
;

137 
	mcut_numb_of_ais
;

138 
TimeMacheEdAi
 
	maiLi
[
MAX_EDITOR_ACTIONS
];

140 
WldS
 
	mwld_e
;

142 
WldPosi
 
gamee_timemache_g_ick_clisi_fu
(
TimeMacheEd
* 
timeMache
, 
mou_game_pos_x
, 
mou_game_pos_y
);

143 
gamee_timemache_g_ick_clisi_gamee
(
TimeMacheEd
* 
timeMache
, 
mou_game_pos_x
, 
mou_game_pos_y
);

144 
TimeMacheEd
* 
gamee_timemache_ed_
(
Memy
* 
memy
, Memy* 
GameeMemy
);

145 
gamee_timemache_ed_li_om_t
(
TimeMacheEd
* 
ed
, 
WldS
* 
pos
);

146 
gamee_timemache_te_emy_
(
WldS
* 
t_e
);

147 
gamee_timemache_ed_ke_ai
(
TimeMacheEd
* 
ed
, 
WldS
* 
maybe_t_e
, 
TimeMacheEdAi
 
ai
);

151 
WldPosi
 
wld_make_wld_posi_vid
();

152 
WldPosi
 
wld_make_wld_posi
(
v_dex
, 
IPa
 
pos_2d
, 
pos_1d
);

158 
TimeMacheEdAi
 
gamee_timemachi__undo_ai
();

159 
TimeMacheEdAi
 
gamee_timemachi___ai
(
xS
, 
yS
, 
w
, 
h
);

160 
TimeMacheEdAi
 
gamee_timemachi__y_brush
(
GameeBrush
 
brush
, 
rg_gamee
, 
IPa
 
rg_sque
);

161 
TimeMacheEdAi
 
gamee_timemachi__size_game
(
rg_gamee
,

162 
AABB
 
xtPosi
,

163 
IPa
 
dimt_om_put_to_xt
);

164 
TimeMacheEdAi
 
gamee_timemachi__move_gamee
(
rg_gamee
, 
IPa
 
movemt
);

165 
TimeMacheEdAi
 
gamee_timemachi__de_gamee
(
rg_gamee
);

166 
TimeMacheEdAi
 
gamee_timemachi__a_gamee
(
GameS
* 
amt
, 
to_a
, cڡ * 
me
);

167 
TimeMacheEdAi
 
gamee_timemachi__upde_gamee
(
GameS
* 
amt
, 
to_a
, 
LevName
 
me
);

168 
TimeMacheEdAi
 
gamee_timemachi__chge_v_mode
(
rg_gamee
, 
LevMode
 
xt_mode
);

	@EditorScene.h

1 #agm



2 
	~"GameS.h
"

3 
	~"Ed.h
"

5 cڡ 
	gˋ_ngth
 = 21;

6 
	sEdS


8 
TimeMacheEd
* 
	mtimeMache
;

9 
WldS
* 
	mtime_mache_t_e
;

10 
	mcutBrush
 = 0;

11 
GameeBrush
* 
	mˋ
;

12 
IPa
 
	mˋ_sn_t
;

16 
EdS
* 
	$eds_tup_wh_t_e
(
Memy
* 
ed_memy
, 
VwPtCama
 
ma_vwpt
, 
WldS
* 
t_e
)

18 
EdS
* 
su
 = (EdS*)
	`memy_loc
(
ed_memy
, (EditorScene));

19 
su
->
timeMache
 = 
	`gamee_timemache_ed_
(
ed_memy
, 
	`memy_
(50000000));

20 
su
->
time_mache_t_e
 = 
t_e
;

21 
	`gamee_timemache_ed_li_om_t
(
su
->
timeMache
,esu->
time_mache_t_e
);

23 
su
->
ˋ
 = (
GameeBrush
*)
	`memy_loc
(
ed_memy
, (GameeBrush* 
ˋ_ngth
);

24 
su
->
cutBrush
 = 0;

25 
su
->
ˋ_sn_t
 = 
	`mh_a_
(
ma_vwpt
.

, cama_vwpt.
up
 - 120);

27 
i
 = 0;

28 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
ue
, 
F_NONE
,rue, 
P_NONE
, 
l
, 
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

29 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
ue
, 
F_TARGET
, 
l
, 
P_NONE
, f, 
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

30 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
ue
, 
F_START
, 
l
, 
P_NONE
, f, 
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

31 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
ue
, 
F_LURKING_WALL
, 
l
, 
P_NONE
, f, 
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

32 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P
::
P_NONE
, f, 
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

33 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_WALL
, f, 
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

34 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
ue
, 
F_GRILL_COLD
,rue, 
P_NONE
,rue, 
	`gamee_pda_make
(),
l
,
	`gamee_oda_make
());

35 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
ue
, 
F_GRILL_HOT
,rue, 
P_NONE
,rue, 
	`gamee_pda_make
(),
l
,
	`gamee_oda_make
());

36 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_WALL_ALT
, f,
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

37 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_CRUMBLE
, f,
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

38 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_CRATE
,rue,
	`gamee_pda_make
(
CP_PUSH
),l,
	`gamee_oda_make
());

39 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_CRATE
,rue,
	`gamee_pda_make
(
CP_PULL
),l,
	`gamee_oda_make
());

40 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_CRATE
,rue,
	`gamee_pda_make
(
CP_PARALLEL
),l,
	`gamee_oda_make
());

41 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_CRATE
,rue,
	`gamee_pda_make
(
CP_MERGE
),l,
	`gamee_oda_make
());

42 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_CRATE
,rue,
	`gamee_pda_make
(
CP_PUSH
,
CP_MERGE
),l,
	`gamee_oda_make
());

43 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_CRATE
,rue,
	`gamee_pda_make
(
CP_PUSH
,
CP_PULL
),l,
	`gamee_oda_make
());

44 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_CRATE
,rue,
	`gamee_pda_make
(
CP_PUSH
,
CP_PARALLEL
),l,
	`gamee_oda_make
());

45 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
l
, 
F_NONE
, 
ue
, 
P_PLAYER
, f,
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

46 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
ue
, 
F_EXIT
, 
l
, 
P_NONE
, f, 
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

47 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
ue
, 
F_STAIRCASE
, 
l
, 
P_NONE
, f, 
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

48 
su
->
ˋ
[
i
++] = 
	`gamee_brush_
(
ue
, 
F_STAIRCASE_LEVELSTART
, 
l
, 
P_NONE
, f, 
	`gamee_pda_make
(),l,
	`gamee_oda_make
());

49 i(
i
 !
ˋ_ngth
)

51 
d
::
cout
 << 
i
 << std::
dl
;

52 
d
::
cout
 << 
ˋ_ngth
 << std::
dl
;

53 
	`ash_r
("youeedheumber oflements inhealeteo beeh samesheength ofhealete.");

56  
su
;

58 
	}
}

59 
EdS
* 
	$eds_tup
(
Memy
* 
ed_memy
, 
VwPtCama
 
ma_vwpt
)

61 
	`memy_r
(
ed_memy
);

62 
WldS
* 
ss
 = (WldS*)
	`memy_loc
(
ed_memy
, (WorldState));

63 
	`gamee_timemache_te_emy_
(
ss
);

64  
	`eds_tup_wh_t_e
(
ed_memy
, 
ma_vwpt
, 
ss
);

65 
	}
}

	@EditorThree.h

	@EditorTimeMachine.cpp

1 
	~"Ed.h
"

2 
	~<ioam
>

5 
	$de_gamee_om_li_
(
TimeMacheEd
* 
ed
, 
dex_to_de
)

7 
ed
->
wld_e
.
v_e
[
dex_to_de
] = 
NULL
;

8 
cut_numb_of_gamees
 = 
ed
->
wld_e
.
num_v
;

10 
i
 = 0; i < 
cut_numb_of_gamees
; i++)

12 i(
i
 =
dex_to_de
)

15 
z
 = 0; z < 
ed
->
wld_e
.
v_e
[
i
]->
w
 *d->wld_e.v_e[i]->
h
;z++)

18 i(
	`is_a
(
ed
->
wld_e
.
v_e
[
i
]->
o
[
z
]))

20 
_lk
 = 
ed
->
wld_e
.
v_e
[
i
]->
o_da
[
z
].
p܋r_id
;

22 i(
_lk
 =
dex_to_de
)

24 
ed
->
wld_e
.
v_e
[
i
]->
o_da
[
z
].
p܋r_id
 = 0;

25 
ed
->
wld_e
.
v_e
[
i
]->
o_da
[
z
].
p܋r_rg_sque
 = 
	`mh_a_
(0, 0);

26 
ed
->
wld_e
.
v_e
[
i
]->
o
[
z
] = 
Flo
::
F_NONE
;

32 if(
_lk
 > 
dex_to_de
)

33 
ed
->
wld_e
.
v_e
[
i
]->
o_da
[
z
].
p܋r_id
 -= 1;

39 
i
 = 
dex_to_de
; i < 
cut_numb_of_gamees
; i++)

41 
ed
->
wld_e
.
v_e
[
i
] =ditor->world_state.level_state[i + 1];

43 
i
 = 
dex_to_de
; i < 
cut_numb_of_gamees
; i++)

45 
ed
->
wld_e
.
v_posi
[
i
] =ditor->world_state.level_position[i + 1];

47 
i
 = 
dex_to_de
; i < 
cut_numb_of_gamees
; i++)

49 
ed
->
wld_e
.
v_mes
[
i
] =ditor->world_state.level_names[i + 1];

51 
i
 = 
dex_to_de
; i < 
cut_numb_of_gamees
; i++)

53 
ed
->
wld_e
.
v_modes
[
i
] =ditor->world_state.level_modes[i + 1];

55 
i
 = 
dex_to_de
; i < 
cut_numb_of_gamees
; i++)

57 
ed
->
wld_e
.
v_sved
[
i
] =ditor->world_state.level_solved[i + 1];

59 
ed
->
wld_e
.
num_v
--;

60 
	}
}

62 
TimeMacheEd
* 
	$gamee_timemache_ed_
(
Memy
* 
memy
, Memy* 
gamee_memy
)

64 
d
::
cout
 << (
TimeMacheEd
<< std::
dl
;

65 
TimeMacheEd
* 
su
 = (TimeMacheEd*
	`memy_loc
(
memy
, (TimeMachineEditor));

66 
su
->
gamee_memy
 = gamestate_memory;

67 
su
->
wld_e
.
num_v
 = 0;

68 
su
->
cut_numb_of_ais
 = 0;

69 
su
->
wld_e
.
v_e
[0] = (
GameS
*
	`memy_loc
(
gamee_memy
, (GameS** 
MAX_NUMBER_GAMESTATES
);

70 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
 ; i++)

71 
j
 = 0; j < 
GAME_LEVEL_NAME_MAX_SIZE
;j++)

72 
su
->
wld_e
.
v_mes
[
i
].
me
[
j
] = '\0';

73 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
;i++)

74 
su
->
wld_e
.
v_sved
[
i
] = 
l
;

75 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
;i++)

76 
su
->
wld_e
.
v_modes
[
i
] = 
LevMode
::
Crumb
;

77 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
;i++)

78 
su
->
wld_e
.
v_posi
[
i
] = 
	`mh_a_
(0,0);

79  
su
;

80 
	}
}

81 
	$gamee_timemache_te_emy_
(
WldS
* 
t_e
)

83 
t_e
->
num_v
 = 0;

84 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

85 
j
 = 0; j < 
GAME_LEVEL_NAME_MAX_SIZE
;j++)

86 
t_e
->
v_mes
[
i
].
me
[
j
] = '\0';

87 
	}
}

88 
	$gamee_timemache_ed_li_om_t
(
TimeMacheEd
* 
ed
, 
WldS
* 
pos
)

90 
	`memy_r
(
ed
->
gamee_memy
);

92 
ed
->
wld_e
.
num_v
 = 
pos
->num_level;

93 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

94 
ed
->
wld_e
.
v_mes
[
i
] = 
pos
->level_names[i];

95 
i
 = 0; i < 
pos
->
num_v
; i++)

97 
ed
->
wld_e
.
v_e
[
i
] = 
	`gamee_e
(
pos
->v_e[i],d->
gamee_memy
);

99 
i
 = 0; i < 
pos
->
num_v
; i++)

101 
ed
->
wld_e
.
v_posi
[
i
].
x
 = 
pos
->level_position[i].x;

102 
ed
->
wld_e
.
v_posi
[
i
].
y
 = 
pos
->level_position[i].y;

104 
i
 = 0; i < 
pos
->
num_v
; i++)

106 
ed
->
wld_e
.
v_modes
[
i
] = 
pos
->level_modes[i];

108 
i
 = 0; i < 
pos
->
num_v
; i++)

110 
ed
->
wld_e
.
v_sved
[
i
] = 
pos
->level_solved[i];

112 
	}
}

113 
bo
 
	$ke_uogged_ai
(
TimeMacheEd
* 
ed
, 
TimeMacheEdAi
 
ai
)

115 i(
ai
.ai =
TM_DELETE_GAMESTATE
)

117 
dex_to_de
 = 
ai
.
u
.
move
.
gamee_dex
;

118 
	`de_gamee_om_li_
(
ed
, 
dex_to_de
);

120 i(
ai
.ai =
TM_APPLY_BRUSH
)

122 
rg_gamee_dex
 = 
ai
.
u
.
brush
.target_gamestate_index;

123 
GameS
* 
gamee
 = 
ed
->
wld_e
.
v_e
[
rg_gamee_dex
];

124 
IPa
 
rg_brush_sque
 = 
ai
.
u
.
brush
.
rg_sque
;

125 
x
 = 
rg_brush_sque
.x;

126 
y
 = 
rg_brush_sque
.y;

127 
rg_brush_sque_1d
 = 
	`f2D
(
x
, 
y
, 
gamee
->
w
, gamee->
h
);

128 
GameeBrush
 
gamee_brush
 = 
ai
.
u
.
brush
.brush;

130 
bo
 
ai_aced
 = 
	`gamee_y_brush
(
gamee
, 
gamee_brush
, 
x
, 
y
);

131 i(!
ai_aced
)

133  
l
;

137 
num_ais
 = 
ed
->
cut_numb_of_ais
;

138 
TimeMacheEdAi
 
ϡAi
 = 
ed
->
aiLi
[
num_ais
 - 1];

139 i(
num_ais
 >= 1 &&

140 
ϡAi
.
ai
 =
TM_APPLY_BRUSH
)

142 
IPa
 
ϡ_rg_sque
 = 
ϡAi
.
u
.
brush
.
rg_sque
;

143 
ϡ_rg_v
 = 
ϡAi
.
u
.
brush
.
rg_gamee_dex
;

144 
ϡ_w
 = 
ed
->
wld_e
.
v_e
[
ϡ_rg_v
]->
w
;

145 
ϡ_h
 = 
ed
->
wld_e
.
v_e
[
ϡ_rg_v
]->
h
;

146 
ϡ_rg_sque_1d
 = 
	`f2D
(
ϡ_rg_sque
.
x
,a_rg_sque.
y
, 
ϡ_w
, 
ϡ_h
);

147 i(
	`is_a
(
ed
->
wld_e
.
v_e
[
ϡ_rg_v
]->
o
[
ϡ_rg_sque_1d
]) &&

148 
	`is_a
(
ed
->
wld_e
.
v_e
[
rg_gamee_dex
]->
o
[
rg_brush_sque_1d
]) &&

149 
ed
->
wld_e
.
v_e
[
ϡ_rg_v
]->
o_da
[
ϡ_rg_sque_1d
].
p܋r_id
 == -1

152 
rg_v
 = 
ai
.
u
.
brush
.
rg_gamee_dex
;

153 
IPa
 
rg_sque
 = 
ai
.
u
.
brush
.target_square;

154 
rg_w
 = 
ed
->
wld_e
.
v_e
[
rg_v
]->
w
;

155 
rg_h
 = 
ed
->
wld_e
.
v_e
[
rg_v
]->
h
;

156 
rg_sque_1d
 = 
	`f2D
(
rg_sque
.
x
,g_sque.
y
, 
rg_w
, 
rg_h
);

157 
ed
->
wld_e
.
v_e
[
ϡ_rg_v
]->
o_da
[
ϡ_rg_sque_1d
].
p܋r_id
 = 
rg_v
;

159 
ed
->
wld_e
.
v_e
[
ϡ_rg_v
]->
o_da
[
ϡ_rg_sque_1d
].
p܋r_rg_sque
 = 
rg_sque
;

160 
d
::
cout
 << "f܋id" << 
rg_v
 << ",g_v" <<g_v << std::
dl
;

161 
d
::
cout
 << "cd܋id" << 
ϡ_rg_v
 << ",ϡgev" <<a_rg_v << std::
dl
;

162 
d
::
cout
 << "rg squ1d" << 
rg_sque_1d
 << std::
dl
;

163 
d
::
cout
 << "ϡg squ1d" << 
ϡ_rg_sque_1d
 << std::
dl
;

164 
ed
->
wld_e
.
v_e
[
rg_v
]->
o_da
[
rg_sque_1d
].
p܋r_id
 = 
ϡ_rg_v
;

165 
ed
->
wld_e
.
v_e
[
rg_v
]->
o_da
[
rg_sque_1d
].
p܋r_rg_sque
 = 
ϡ_rg_sque
;

166 
ed
->
wld_e
.
v_modes
[
rg_v
] = 
LevMode
::
Rt
;

172 i(
ai
.ai =
TM_MERGE_GAMESTATES
)

174 
dex_
 = 
ai
.
u
.
mge
.
gamee_dex_
;

175 
dex_right
 = 
ai
.
u
.
mge
.
gamee_dex_right
;

176 
GameS
* 

 = 
ed
->
wld_e
.
v_e
[
dex_
];

177 
GameS
* 
right
 = 
ed
->
wld_e
.
v_e
[
dex_right
];

178 
IPa
 
wlda_
 = 
ai
.
u
.
mge
.worldspace_left;

179 
IPa
 
wlda_right
 = 
ai
.
u
.
mge
.worldspace_right;

181 
xS
 = 
	`mi
(
wlda_
.
x
, 
wlda_right
.x);

182 
yS
 = 
	`mi
(
wlda_
.
y
, 
wlda_right
.y);

183 
IPa
 
Offt
 = 
	`mh_a_
(
wlda_
.
x
 - 
xS
, wlda_.
y
 - 
yS
);

184 
IPa
 
rightOfft
 = 
	`mh_a_
(
wlda_right
.
x
 - 
xS
, wlda_right.
y
 - 
yS
);

186 
ouut_ngth_x
 = 
	`maxi
(
Offt
.
x
 + 

->
w
, 
rightOfft
.x + 
right
->w);

187 
ouut_ngth_y
 = 
	`maxi
(
Offt
.
y
 + 

->
h
, 
rightOfft
.y + 
right
->h);

188 
IPa
 
ouut_ngth
 = 
	`mh_a_
(
ouut_ngth_x
, 
ouut_ngth_y
);

189 
GameS
* 
xt
 = 
	`gamee_mge_wh_lo
(

, 
right
, 
ouut_ngth
, 
ed
->
gamee_memy
, 
Offt
, 
rightOfft
);

191 
	`de_gamee_om_li_
(
ed
, 
dex_right
);

192 
ed
->
wld_e
.
v_e
[
dex_
] = 
xt
;

193 
ed
->
wld_e
.
v_posi
[
dex_
] = 
	`mh_a_
(
xS
, 
yS
);

196 i(
ai
.ai =
TM_MOVE_GAMESTATE
)

198 
rg_gamee_dex
 = 
ai
.
u
.
move
.target_gamestate_index;

199 
IPa
 
di
 = 
ai
.
u
.
move
.
moveDi
;

201 
ed
->
wld_e
.
v_posi
[
rg_gamee_dex
] = 
	`mh_a_add
d->wld_e.v_posi[rg_gamee_dex], 
di
);

203 i(
ai
.ai =
TM_RESIZE_GAMESTATE
)

206 
w
 = 
ai
.
u
.
size
.
xt_size
.
x
;

207 
h
 = 
ai
.
u
.
size
.
xt_size
.
y
;

208 
IPa
 
dimt
 = 
ai
.
u
.
size
.
dimt_om_put_to_xt
;

211 
rg_gamee
 = 
ai
.
u
.
size
.
rg_gamee_dex
;

212 
GameS
* 
d
 = 
ed
->
wld_e
.
v_e
[
rg_gamee
];

213 
GameS
* 
xt
 = 
	`gamee_
(
ed
->
gamee_memy
, 
w
, 
h
);

216 
	`gamee_size
(
d
, 
xt
, 
dimt
);

219 
ed
->
wld_e
.
v_e
[
rg_gamee
] = 
xt
;

220 
ed
->
wld_e
.
v_posi
[
rg_gamee
] = 
ai
.
u
.
size
.
xt_tg_posi
;

225 i(
ai
.ai =
TM_CREATE_GAMESTATE
)

228 
x
 = 
ai
.
u
.

.x;

229 
y
 = 
ai
.
u
.

.y;

230 
IPa
 
btom_
 = 
	`mh_a_
(
x
, 
y
);

231 
w
 = 
ai
.
u
.

.w;

232 
h
 = 
ai
.
u
.

.h;

234 
GameS
* 
xt
 = 
	`gamee_
(
ed
->
gamee_memy
, 
w
, 
h
);

238 i(
ed
->
wld_e
.
num_v
 > 
MAX_NUMBER_GAMESTATES
)

240 
	`ash_r
("we have overflowed ourevelditor gamestate memory. Rats! This means you should implement someroper memoryechniquesoikeot havehis happen. ");

243 
	`abt
();

245 
ed
->
wld_e
.
v_e
[ed->wld_e.
num_v
] = 
xt
;

246 
ed
->
wld_e
.
v_posi
[ed->wld_e.
num_v
] = 
btom_
;

247 
ed
->
wld_e
.
num_v
++;

249 i(
ai
.ai =
TM_REPLACE_GAMESTATE
)

251 
pos
 = 
ai
.
u
.
a
.
dex_to_a
;

252 
GameS
* 
e
 = 
ai
.
u
.
a
.
a_e
;

253 
ed
->
wld_e
.
v_e
[
pos
] = 
e
;

254 
i
 = 0; i < 
GAME_LEVEL_NAME_MAX_SIZE
; i++)

256 
ed
->
wld_e
.
v_mes
[
pos
].
me
[
i
] = 
ai
.
u
.
a
.name[i];

259 i(
ai
.ai =
TM_UPDATE_GAMESTATE
)

261 
pos
 = 
ai
.
u
.
upde
.
dex_to_a
;

262 
GameS
* 
e
 = 
ai
.
u
.
upde
.
a_e
;

263 
ed
->
wld_e
.
v_e
[
pos
] = 
e
;

265 i(
ai
.ai =
TM_CHANGE_LEVEL_MODE
)

267 
ed
->
wld_e
.
v_modes
[
ai
.
u
.
v
.
dex_to_a
] =i.u.v.
a_vue
;

269  
ue
;

270 
	}
}

271 
	$gamee_timemache_ed_ke_ai
(
TimeMacheEd
* 
ed
, 
WldS
* 
maybe_t_e
, 
TimeMacheEdAi
 
ai
)

274 i(
ai
.ai =
TM_UNDO
 && 
ed
->
cut_numb_of_ais
 > 0)

276 
ed
->
cut_numb_of_ais
--;

279 i(!
maybe_t_e
)

280 
	`ash_r
("hmm, when doingn undoction, weassed, NULL when we should have givenos state. Fix it!");

281 
	`gamee_timemache_ed_li_om_t
(
ed
, 
maybe_t_e
);

282 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

283 
j
 = 0; j < 
GAME_LEVEL_NAME_MAX_SIZE
;j++)

284 
ed
->
wld_e
.
v_mes
[
i
].
me
[
j
] = '\0';

285 
i
 = 0; i < 
ed
->
cut_numb_of_ais
; i++)

287 
	`ke_uogged_ai
(
ed
,d->
aiLi
[
i
]);

290 if(
ai
.ai !
TM_UNDO
)

292 
bo
 
aced_ai
 = 
	`ke_uogged_ai
(
ed
, 
ai
);

293 i(
aced_ai
)

295 
ed
->
aiLi
[ed->
cut_numb_of_ais
] = 
ai
;

296 
ed
->
cut_numb_of_ais
++;

300 
	}
}

302 
WldPosi
 
	$wld_make_wld_posi
(
v_dex
, 
IPa
 
pos_2d
, 
pos_1d
)

304 
WldPosi
 
su
;

305 
su
.
v_dex
 =evel_index;

306 
su
.
v_posi
 = 
pos_2d
;

307 
su
.
v_posi_1d
 = 
pos_1d
;

308  
su
;

309 
	}
}

311 
WldPosi
 
	$wld_make_wld_posi_vid
()

313  
	`wld_make_wld_posi
(-1, 
	`mh_a_
(-1, -1), -1);

314 
	}
}

316 
WldPosi
 
	$gamee_timemache_g_ick_clisi_fu
(
TimeMacheEd
* 
timeMache
, 
mou_game_pos_x
, 
mou_game_pos_y
)

318 
glm
::
vec2
 
mouGamePos
 = glm::
	`vec2
(
mou_game_pos_x
, 
mou_game_pos_y
);

319 
dex_icked
 = 
	`gamee_timemache_g_ick_clisi_gamee
(
timeMache
, 
mou_game_pos_x
, 
mou_game_pos_y
);

320 
GameS
* 
e
 = 
timeMache
->
wld_e
.
v_e
[
dex_icked
];

321 
IPa
 
e_t
 = 
timeMache
->
wld_e
.
v_posi
[
dex_icked
];

322 
IPa
 
grid_icked
;

324 

 = (
e_t
.
x
;

325 
right
 = ((
e_t
.
x
 + 
e
->
w
);

326 
down
 = (
e_t
.
y
;

327 
up
 = ((
e_t
.
y
 + 
e
->
h
);

329 
rageX
 = 
	`r_bwn_two_pots
(
mouGamePos
.
x
, 

, 
right
);

330 
rageY
 = 
	`r_bwn_two_pots
(
mouGamePos
.
y
, 
down
, 
up
);

331 
x_o__icked
 = ()(
rageX
 * 
e
->
w
);

332 
y_o__icked
 = ()(
rageY
 * 
e
->
h
);

334 
grid_icked
 = 
	`mh_a_
(
x_o__icked
, 
y_o__icked
);

336 
grid_icked_1d
 = 
	`f2D
(
grid_icked
.
x
, grid_icked.
y
, 
e
->
w
, s->
h
);

337 
WldPosi
 
su
 = 
	`wld_make_wld_posi
(
dex_icked
, 
grid_icked
, 
grid_icked_1d
);

338  
su
;

339 
	}
}

340 
	$gamee_timemache_g_ick_clisi_gamee
(
TimeMacheEd
* 
timeMache
, 
mou_game_pos_x
,
mou_game_pos_y
)

342 
i
 = 0; i < 
timeMache
->
wld_e
.
num_v
; i++)

344 
GameS
* 
cutS
 = 
timeMache
->
wld_e
.
v_e
[
i
];

345 

 = (
timeMache
->
wld_e
.
v_posi
[
i
].
x
;

346 
right
 = (
timeMache
->
wld_e
.
v_posi
[
i
].
x
 + 
cutS
->
w
;

347 
down
 = (
timeMache
->
wld_e
.
v_posi
[
i
].
y
;

348 
up
 = (
timeMache
->
wld_e
.
v_posi
[
i
].
y
 + 
cutS
->
h
;

349 
bo
 
ickedFlo
 = 
	`mh_ick_is_side_AABB
(

, 
down
, 
right
, 
up
, 
mou_game_pos_x
, 
mou_game_pos_y
);

350 if(
ickedFlo
)

351  
i
;

354 
	}
}

356 
TimeMacheEdAi
 
	$gamee_timemachi__undo_ai
()

358 
TimeMacheEdAi
 
ai
;

359 
ai
.ai = 
TM_UNDO
;

360  
ai
;

361 
	}
}

362 
TimeMacheEdAi
 
	$gamee_timemachi___ai
(
x
, 
y
, 
w
, 
h
)

364 
TimeMacheEdAi
 
ai
;

365 
ai
.ai = 
TM_CREATE_GAMESTATE
;

366 
ai
.
u
.

.
x
 = x;

367 
ai
.
u
.

.
y
 = y;

368 
ai
.
u
.

.
w
 = w;

369 
ai
.
u
.

.
h
 = h;

370  
ai
;

371 
	}
}

372 
TimeMacheEdAi
 
	$gamee_timemachi__y_brush
(
GameeBrush
 
brush
, 
rg_gamee
, 
IPa
 
rg_sque
)

374 
TimeMacheEdAi
 
ai
;

375 
ai
.ai = 
TM_APPLY_BRUSH
;

376 
ai
.
u
.
brush
.brush = brush;

377 
ai
.
u
.
brush
.
rg_gamee_dex
 = 
rg_gamee
;

378 
ai
.
u
.
brush
.
rg_sque
 =arget_square;

379  
ai
;

380 
	}
}

381 
TimeMacheEdAi
 
	$gamee_timemachi__size_game
(
rg_gamee
,

382 
AABB
 
xtPosi
,

383 
IPa
 
dimt_om_put_to_xt
)

385 
TimeMacheEdAi
 
ai
;

386 
ai
.ai = 
TM_RESIZE_GAMESTATE
;

387 
ai
.
u
.
size
.
xt_tg_posi
.
x
 = (
xtPosi
.x;

388 
ai
.
u
.
size
.
xt_tg_posi
.
y
 = (
xtPosi
.y;

389 
ai
.
u
.
size
.
rg_gamee_dex
 = 
rg_gamee
;

390 
ai
.
u
.
size
.
dimt_om_put_to_xt
 = displacement_from_input_to_next;

391 
ai
.
u
.
size
.
xt_size
.
x
 = (
xtPosi
.
w
;

392 
ai
.
u
.
size
.
xt_size
.
y
 = (
xtPosi
.
h
;

393  
ai
;

394 
	}
}

395 
TimeMacheEdAi
 
	$gamee_timemachi__move_gamee
(
rg_gamee
, 
IPa
 
movemt
)

397 
TimeMacheEdAi
 
ai
;

398 
ai
.ai = 
TM_MOVE_GAMESTATE
;

399 
ai
.
u
.
move
.
moveDi
 = 
movemt
;

400 
ai
.
u
.
move
.
rg_gamee_dex
 = 
rg_gamee
;

401  
ai
;

402 
	}
}

403 
TimeMacheEdAi
 
	$gamee_timemachi__de_gamee
(
rg_gamee
)

405 
TimeMacheEdAi
 
ai
;

406 
ai
.ai = 
TM_DELETE_GAMESTATE
;

407 
ai
.
u
.
move
.
gamee_dex
 = 
rg_gamee
;

408  
ai
;

409 
	}
}

411 
TimeMacheEdAi
 
	$gamee_timemachi__a_gamee
(
GameS
* 
amt
, 
to_a
, cڡ * 
me
)

413 
TimeMacheEdAi
 
ai
;

414 
ai
.ai = 
TM_REPLACE_GAMESTATE
;

415 
ai
.
u
.
a
.
a_e
 = 
amt
;

416 
ai
.
u
.
a
.
dex_to_a
 = 
to_a
;

417 
i
 = 0; i < 
GAME_LEVEL_NAME_MAX_SIZE
; i++)

419 
ai
.
u
.
a
.
me
[
i
] =ame[i];

421  
ai
;

422 
	}
}

423 
TimeMacheEdAi
 
	$gamee_timemachi__upde_gamee
(
GameS
* 
amt
, 
to_a
, 
LevName
 
me
)

425 
TimeMacheEdAi
 
ai
;

426 
ai
.ai = 
TM_UPDATE_GAMESTATE
;

427 
ai
.
u
.
upde
.
a_e
 = 
amt
;

428 
ai
.
u
.
upde
.
dex_to_a
 = 
to_a
;

429 
i
 = 0; i < 
GAME_LEVEL_NAME_MAX_SIZE
; i++)

431 
ai
.
u
.
a
.
me
[
i
] =ame.name[i];

433  
ai
;

434 
	}
}

435 
TimeMacheEdAi
 
	$gamee_timemachi__chge_v_mode
(
rg_gamee
, 
LevMode
 
xt_mode
)

437 
TimeMacheEdAi
 
ai
;

438 
ai
.ai = 
TM_CHANGE_LEVEL_MODE
;

439 
ai
.
u
.
v
.
dex_to_a
 = 
rg_gamee
;

440 
ai
.
u
.
v
.
a_vue
 = 
xt_mode
;

441  
ai
;

442 
	}
}

	@Fonts.h

1 #agm



	@GameState.cpp

1 
	~"GameS.h
"

2 
	~"Memy.h
"

3 
	~<ioam
>

4 
	~"Mh.h
"

7 
gamee_lo_ys
(
GameS
* 
su
, 
Memy
* 
memy
, 
w
, 
h
);

10 
le
 
IPa
 
	$move_pos_wed_2d_up
(
IPa
 
pos
, 
w
, 
h
)

12 
pos
.
y
 += 1;

13 
pos
.
y
 -os.y >
h
) * h;

14  
pos
;

15 
	}
}

16 
le
 
IPa
 
	$move_pos_wed_2d_right
(
IPa
 
pos
, 
w
, 
h
) {

17 
pos
.
x
 += 1;

18 
pos
.
x
 -os.x >
w
) * w;

19  
pos
;

20 
	}
}

21 
le
 
IPa
 
	$move_pos_wed_2d_down
(
IPa
 
pos
, 
w
, 
h
) {

22 
pos
.
y
 -= 1;

23 
pos
.
y
 +os.y < 0* 
h
;

24  
pos
;

25 
	}
}

26 
le
 
IPa
 
	$move_pos_wed_2d_
(
IPa
 
pos
, 
w
, 
h
) {

27 
pos
.
x
 -= 1;

28 
pos
.
x
 +os.x < 0* 
w
;

29  
pos
;

30 
	}
}

31 
le
 
IPa
 
	$move_pos_wed_2d
(
IPa
 
pos
, 
Dei
 
dei
, 
w
, 
h
)

33 
dei
) {

34 
U
:

35 
pos
.
y
 += 1;

36 
pos
.
y
 -os.y >
h
) * h;

37  
pos
;

38 
R
:

39 
pos
.
x
 += 1;

40 
pos
.
x
 -os.x >
w
) * w;

41  
pos
;

42 
D
:

43 
pos
.
y
 -= 1;

44 
pos
.
y
 +os.y < 0* 
h
;

45  
pos
;

46 
L
:

47 
pos
.
x
 -= 1;

48 
pos
.
x
 +os.x < 0* 
w
;

49  
pos
;

51  
pos
;

52 
	}
}

54 
	gme
 <
ass
 
	gT
>

55 
	$y_moves_to_y_SLOW
(
Memy
* 
mp_memy
, 
bo
* 
is_movg
, 
T
* 
y
, 
w
, 
h
, 
Dei
 
ai
, T 
emy_v
)

58 
ngth
 = 
w
 * 
h
;

59 
T
* 
xt_y
 = (T*
	`memy_loc
(
mp_memy
, (T* 
ngth
);

60 * 
shl_de
 = (*)
	`memy_loc
(
mp_memy
, (* 
ngth
);

61 
z
 = 0; z < 
ngth
; z++)

63 
shl_de
[
z
] = 0;

65 
z
 = 0; z < 
ngth
; z++)

67 
xt_y
[
z
] = 
y
[z];

69 
z
 = 0; z < 
ngth
; z++)

71 
IPa
 
p
 = 
	`t2D
(
z
, 
w
, 
h
);

72 
IPa
 
xt
 = 
	`move_pos_wed_2d
(
p
, 
ai
, 
w
, 
h
);

73 
xt_1d
 = 
	`f2D
(
xt
.
x
,ext.
y
, 
w
, 
h
);

74 i(
is_movg
[
z
])

76 
xt_y
[
xt_1d
] = 
y
[
z
];

77 
shl_de
[
z
]++;

78 
shl_de
[
xt_1d
]--;

82 
z
 = 0; z < 
ngth
; z++)

84 i(
shl_de
[
z
] > 0)

85 
xt_y
[
z
] = 
emy_v
;

87 
z
 = 0; z < 
ngth
; z++)

89 
y
[
z
] = 
xt_y
[z];

91 
	}
}

92 
	$y__moves_to_y
(
Memy
* 
memy
, 
bo
* 
is_movg
, * 
y
, 
w
, 
h
)

94 
ngth
 = 
w
 * 
h
;

95 
j
 = 0; j < 
h
; j++)

97 
f_i
 = 
	`f2D
(
w
 - 1, 
j
, w, 
h
);

98 
ed_vue
 = 
y
[
f_i
];

100 
i
 = 0; i < 
w
 - 1; i++)

102 
pos
 = 
	`f2D
(
i
, 
j
, 
w
, 
h
);

103 
IPa
 
xt
 = 
	`move_pos_wed_2d_
(
	`mh_a_
(
i
, 
j
), 
w
, 
h
);

104 
xt_1d
 = 
	`f2D
(
xt
.
x
,ext.
y
, 
w
, 
h
);

105 
y
[
xt_1d
] = (y[
pos
] * 
is_movg
[pos]) + (layer[next_1d] * (1 - is_moving[pos]));

107 
IPa
 
xt_f_2d
 = 
	`move_pos_wed_2d_
(
	`mh_a_
(
w
 - 1, 
j
), w, 
h
);

108 
xt_f_1d
 = 
	`f2D
(
xt_f_2d
.
x
,ext_f_2d.
y
, 
w
, 
h
);

109 
y
[
xt_f_1d
] = (
ed_vue
 * 
is_movg
[
f_i
]) + (layer[next_final_1d] * (1 - is_moving[final_i]));

111 
	}
}

112 
	$y_right_moves_to_y
(
Memy
* 
memy
, 
bo
* 
is_movg
, * 
y
, 
w
, 
h
)

114 
ngth
 = 
w
 * 
h
;

115 
z
 = 0;

116 
j
 = 0; j < 
h
; j++)

118 
f_i
 = 
	`f2D
(0, 
j
, 
w
, 
h
);

119 
ed_vue
 = 
y
[
f_i
];

121 
i
 = 
w
 - 1; i >= 0; i--)

123 
pos
 = 
	`f2D
(
i
, 
j
, 
w
, 
h
);

124 
IPa
 
xt
 = 
	`move_pos_wed_2d_right
(
	`mh_a_
(
i
, 
j
), 
w
, 
h
);

125 
xt_1d
 = 
	`f2D
(
xt
.
x
,ext.
y
, 
w
, 
h
);

126 
y
[
xt_1d
] = (y[
pos
] * 
is_movg
[pos]) + (layer[next_1d] * (1 - is_moving[pos]));

129 
IPa
 
xt_f_2d
 = 
	`move_pos_wed_2d_right
(
	`mh_a_
(0, 
j
), 
w
, 
h
);

130 
xt_f_1d
 = 
	`f2D
(
xt_f_2d
.
x
,ext_f_2d.
y
, 
w
, 
h
);

131 
y
[
xt_f_1d
] = (
ed_vue
 * 
is_movg
[
f_i
]) + (layer[next_final_1d] * (1 - is_moving[final_i]));

133 
	}
}

134 
	$y_up_moves_to_y
(
Memy
* 
memy
, 
bo
* 
is_movg
, * 
y
, 
w
, 
h
)

136 
ngth
 = 
w
 * 
h
;

137 
i
 = 0; i < 
w
; i++)

139 
f_i
 = 
	`f2D
(
i
, 
h
 - 1, 
w
, h);

140 
ed_vue
 = 
y
[
f_i
];

142 
j
 = 1; j < 
h
; j++)

144 
pos
 = 
	`f2D
(
i
, 
j
, 
w
, 
h
);

145 
IPa
 
xt
 = 
	`move_pos_wed_2d_up
(
	`mh_a_
(
i
, 
j
), 
w
, 
h
);

146 
xt_1d
 = 
	`f2D
(
xt
.
x
,ext.
y
, 
w
, 
h
);

147 
y
[
xt_1d
] = (y[
pos
] * 
is_movg
[pos]) + (layer[next_1d] * (1 - is_moving[pos]));

150 
IPa
 
xt_f_2d
 = 
	`move_pos_wed_2d_up
(
	`mh_a_
(
i
, 
h
 - 1), 
w
, h);

151 
xt_f_1d
 = 
	`f2D
(
xt_f_2d
.
x
,ext_f_2d.
y
, 
w
, 
h
);

152 
y
[
xt_f_1d
] = (
ed_vue
 * 
is_movg
[
f_i
]) + (layer[next_final_1d] * (1 - is_moving[final_i]));

154 
	}
}

155 
	$y_down_moves_to_y
(
Memy
* 
memy
, 
bo
* 
is_movg
, * 
y
, 
w
, 
h
)

157 
ngth
 = 
w
 * 
h
;

158 
i
 = 0; i < 
w
; i++)

160 
f_i
 = 
	`f2D
(
i
, 
h
 - 1, 
w
, h);

161 
ed_vue
 = 
y
[
f_i
];

162 
j
 = 0; j < 
h
 - 1; j++)

164 
pos
 = 
	`f2D
(
i
, 
j
, 
w
, 
h
);

165 
IPa
 
xt
 = 
	`move_pos_wed_2d_down
(
	`mh_a_
(
i
, 
j
), 
w
, 
h
);

166 
xt_1d
 = 
	`f2D
(
xt
.
x
,ext.
y
, 
w
, 
h
);

167 
y
[
xt_1d
] = (y[
pos
] * 
is_movg
[pos]) + (layer[next_1d] * (1 - is_moving[pos]));

170 
IPa
 
xt_f_2d
 = 
	`move_pos_wed_2d_down
(
	`mh_a_
(
i
, 
h
 - 1), 
w
, h);

171 
xt_f_1d
 = 
	`f2D
(
xt_f_2d
.
x
,ext_f_2d.
y
, 
w
, 
h
);

172 
y
[
xt_f_1d
] = (
ed_vue
 * 
is_movg
[
f_i
]) + (layer[next_final_1d] * (1 - is_moving[final_i]));

174 
	}
}

177 
IPa
 
	$dei_to_a
(
Dei
 
ai
)

179 i(
ai
 =
U
)

181  
	`mh_a_
(0, 1);

183 i(
ai
 =
R
)

185  
	`mh_a_
(1, 0);

187 i(
ai
 =
D
)

189  
	`mh_a_
(0, -1);

191 i(
ai
 =
L
)

193  
	`mh_a_
(-1, 0);

195  
	`mh_a_
(0, 0);

196 
	}
}

197 
Dei
 
	$ai_to_dei
(
Ai
 
ai
)

199 i(
ai
 =
Ai
::
A_UP
)

200  
Dei
::
U
;

201 i(
ai
 =
Ai
::
A_RIGHT
)

202  
Dei
::
R
;

203 i(
ai
 =
Ai
::
A_DOWN
)

204  
Dei
::
D
;

205 i(
ai
 =
Ai
::
A_LEFT
)

206  
Dei
::
L
;

207  
Dei
::
NO_DIRECTION
;

208 
	}
}

210 
	$gamee_timemache_t
(
GameeTimeMache
* 
timeMache
, 
Memy
* 
sce_memy
)

212 
xt_pos
 = 
timeMache
->
num_gamees_ed
;

213 
GameS
* 
xt
 = &
timeMache
->
e_y
[
xt_pos
];

214 
GameS
* 
d
 = &
timeMache
->
e_y
[0];

215 
	`gamee_e_to_unlized
(
d
, 
xt
, 
sce_memy
);

216 
timeMache
->
num_gamees_ed
++;

217 
	}
}

218 
	$y_mge_moves
(
PDa
* 
p_da
, 
bo
* 
is_movg
, * 
y
, 
Dei
 
d
, 
w
, 
h
, 
GameSAnimi
* 
imi
)

220 
bo
 
de
 = 
l
;

221 !
de
)

223 
de
 = 
ue
;

224 
ngth
 = 
w
 * 
h
;

225 
z
 = 0;

226 
i
 = 0; i < 
w
; i++)

227 
j
 = 0; j < 
h
; j++, 
z
++)

229 i(
is_movg
[
z
])

231 
IPa
 
xt
 = 
	`move_pos_wed_2d
(
	`mh_a_
(
i
, 
j
), 
d
, 
w
, 
h
);

232 
xt_1d
 = 
	`f2D
(
xt
.
x
,ext.
y
, 
w
, 
h
);

233 
bo
 
we_e_mge
 = 
p_da
[
z
].
pows
[
CP_MERGE
] ||_da[
xt_1d
].powers[CP_MERGE];

234 
bo
 
bh_es
 = 
y
[
xt_1d
] =
P_CRATE
 &&ay[
z
] == P_CRATE;

235 
bo
 
xt_is_blocked
 = (
y
[
xt_1d
] !
LN_FLOOR
&& !
is_movg
[next_1d];

236 i(
xt_is_blocked
)

238 i(
bh_es
 && 
we_e_mge
)

241 
p_da
[
xt_1d
].
pows
[
CP_PUSH
] =_da[xt_1d].pows[CP_PUSH] ||_da[
z
].powers[CP_PUSH];

242 
p_da
[
xt_1d
].
pows
[
CP_PULL
] =_da[xt_1d].pows[CP_PULL] ||_da[
z
].powers[CP_PULL];

243 
p_da
[
xt_1d
].
pows
[
CP_MERGE
] =_da[xt_1d].pows[CP_MERGE] ||_da[
z
].powers[CP_MERGE];

244 
p_da
[
xt_1d
].
pows
[
CP_PARALLEL
] =_da[xt_1d].pows[CP_PARALLEL] ||_da[
z
].powers[CP_PARALLEL];

245 
y
[
z
] = 0;

246 
i
 = 0; i < 
CP_COUNT
;i++)

247 
p_da
[
z
].
pows
[
i
] = 
l
;

248 
is_movg
[
z
] = 
l
;

251 
imi
->
symb_t
.
d_pows
[
z
] = 
p_da
[
xt_1d
];

252 
imi
->
symb_t
.
d_pows
[
xt_1d
] = 
p_da
[next_1d];

258 
	}
}

259 
	$nl_moves_by_rigid
(
RigidDa
* 
rigids
, 
bo
* 
is_movg
, 
rigid_to_nl
, 
n
)

261 
k
 = 0; k < 
n
; k++)

262 i(
rigids
->
grid
[
k
] =
rigid_to_nl
)

263 
is_movg
[
k
] = 
l
;

264 
z
 = 0; z < 
rigids
->
num_lks
; z++)

265 i(
rigids
->
lks
[
z
].
x
 =
rigid_to_nl
)

266 
	`nl_moves_by_rigid
(
rigids
, 
is_movg
,igids->
lks
[
z
].
y
, 
n
);

267 
	}
}

268 
	$nl_blocked_nmge_moves
(
RigidDa
* 
rigids
, 
bo
* 
is_movg
, * 
y
, 
PDa
* 
p_da
, 
Dei
 
d
, 
w
, 
h
)

270 
bo
 
lo
 = 
l
;

271 
bo
 
de
 = 
l
;

272 !
de
)

274 
de
 = 
ue
;

275 
ngth
 = 
w
 * 
h
;

276 
z
 = 0;

277 
i
 = 0; i < 
w
; i++)

278 
j
 = 0; j < 
h
; j++, 
z
++)

280 i(
is_movg
[
z
])

282 
IPa
 
xt
 = 
	`move_pos_wed_2d
(
	`mh_a_
(
i
, 
j
), 
d
, 
w
, 
h
);

283 
xt_1d
 = 
	`f2D
(
xt
.
x
,ext.
y
, 
w
, 
h
);

284 
bo
 
we_e_mge
 = 
p_da
[
z
].
pows
[
CP_MERGE
] ||_da[
xt_1d
].powers[CP_MERGE];

285 
bo
 
bh_es
 = 
y
[
xt_1d
] =
P_CRATE
 &&ay[
z
] == P_CRATE;

286 
bo
 
xt_is_blocked
 = (
y
[
xt_1d
] !
LN_FLOOR
&& !
is_movg
[next_1d];

287 i(
xt_is_blocked
)

289 i(
bh_es
 && 
we_e_mge
)

295 
is_movg
[
z
] = 
l
;

296 
de
 = 
l
;

297 i(
rigids
->
grid
[
z
] != 0)

299 
	`nl_moves_by_rigid
(
rigids
,
is_movg
,rigids->
grid
[
z
],
w
*
h
);

300 
lo
 = 
ue
;

307 i(
lo
)

308 
	`nl_blocked_nmge_moves
(
rigids
, 
is_movg
, 
y
, 
p_da
, 
d
, 
w
, 
h
);

309 
	}
}

310 
	$nl_blocked_moves
(
bo
* 
is_movg
, * 
y
, 
Dei
 
d
, 
w
, 
h
)

312 
bo
 
de
 = 
l
;

313 !
de
)

315 
de
 = 
ue
;

316 
ngth
 = 
w
 * 
h
;

317 
z
 = 0;

318 
i
 = 0; i < 
w
; i++)

319 
j
 = 0; j < 
h
; j++, 
z
++)

321 i(
is_movg
[
z
])

323 
IPa
 
xt
 = 
	`move_pos_wed_2d
(
	`mh_a_
(
i
, 
j
), 
d
, 
w
, 
h
);

324 
xt_1d
 = 
	`f2D
(
xt
.
x
,ext.
y
, 
w
, 
h
);

325 
bo
 
xt_is_blocked
 = (
y
[
xt_1d
] !
LN_FLOOR
&& !
is_movg
[next_1d];

326 i(
xt_is_blocked
)

328 
is_movg
[
z
] = 
l
;

329 
de
 = 
l
;

335 
	}
}

336 
GameeTimeMache
* 
	$gamee_timemache_
(
GameS
* 
t_e
, 
Memy
* 
memy
, 
max_num_gamees
)

338 
GameeTimeMache
* 
su
 = (GameeTimeMache*
	`memy_loc
(
memy
, (GamestateTimeMachine));

339 
su
->
t_e
 = 
	`gamee_e
(t_e, 
memy
);

340 
su
->
e_y
 = (
GameS
*)
	`memy_loc
(
memy
, (GameS* 
max_num_gamees
);

342 
	`gamee_e_to_unlized
(
su
->
t_e
, &esu->
e_y
[0]), 
memy
);

344 
su
->
num_gamees_ed
 = 1;

345 
su
->
max_gamees_ab
 = 
max_num_gamees
;

346  
su
;

347 
	}
}

348 * 
	$gamee_timemache_undo
(
GameeTimeMache
* 
timeMache
)

351 i(
timeMache
->
num_gamees_ed
 > 1)

353 
timeMache
->
num_gamees_ed
--;

355  &
timeMache
->
e_y
[timeMache->
num_gamees_ed
];

357  
NULL
;

358 
	}
}

359 
GameS
* 
	$gamee_timemache_g_ϋ_gamee
(
GameeTimeMache
* 
timeMache
)

361  &
timeMache
->
e_y
[timeMache->
num_gamees_ed
 - 1];

362 
	}
}

365 
GameS
* 
	$gamee_
(
Memy
* 
memy
, 
w
, 
h
)

367 
size
 = (
GameS
);

368 
GameS
* 
su
 = (GameS*
	`memy_loc
(
memy
,
size
);

369 
	`gamee_lo_ys
(
su
, 
memy
, 
w
, 
h
);

370  
su
;

371 
	}
}

372 
GameS
* 
	$gamee_e
(
GameS
* 
e
, 
Memy
* 
memy
)

374 
GameS
* 
e_to
 = 
	`gamee_
(
memy
, 
e
->
w
, s->
h
);

375 
	`gamee_e_to
(
e
, 
e_to
);

376  
e_to
;

377 
	}
}

378 
GameS
* 
	$gamee_mge_wh_lo
(
GameS
* 
f
, GameS* 
cd
, 
IPa
 
combed_size
, 
Memy
* 
ouut_memy
, IPa 
_mge_offt
, IPa 
right_mge_offt
)

380 
GameS
* 
ouut_e
 = 
	`gamee_
(
ouut_memy
, 
combed_size
.
x
, combed_size.
y
);

381 
	`gamee_mge
(
f
, 
cd
, 
ouut_e
, 
_mge_offt
, 
right_mge_offt
);

382  
ouut_e
;

383 
	}
}

384 
GameS
* 
	$gamee_size_wh_lo
(
GameS
* 
put_e
, 
Memy
* 
ouut_memy
, 
ouut_w
, 
ouut_h
, 
IPa
 
dimt_om_put_to_ouut
)

386 
GameS
* 
ouut_e
 = 
	`gamee_
(
ouut_memy
, 
ouut_w
, 
ouut_h
);

387 
	`gamee_size
(
put_e
, 
ouut_e
, 
dimt_om_put_to_ouut
);

388  
ouut_e
;

389 
	}
}

390 
GameAiJou
* 
	$gamee_timemache_ke_ai
(
GameeTimeMache
* 
timeMache
, 
Dei
 
ai
, 
Memy
* 
sce_memy
, Memy* 
mp_memy
)

392 
xt_pos
 = 
timeMache
->
num_gamees_ed
;

393 
d_pos
 = 
xt_pos
 - 1;

394 
GameS
* 
d
 = &
timeMache
->
e_y
[
d_pos
];

395 
GameS
* 
xt
 = &
timeMache
->
e_y
[
xt_pos
];

396 
	`gamee_e_to_unlized
(
d
, 
xt
, 
sce_memy
);

397 
GameAiJou
* 
su
 = 
	`gamee_ai
(
xt
, 
ai
, 
mp_memy
);

398 
timeMache
->
num_gamees_ed
++;

399  
su
;

400 
	}
}

401 
	$gamee_mge
(
GameS
* 

, GameS* 
right
, GameS* 
ouut
, 
IPa
 
_mge_offt
, IPa 
right_mge_offt
)

403 
w_f
 = 

->
w
;

404 
h_f
 = 

->
h
;

405 
w_s
 = 
right
->
w
;

406 
h_s
 = 
right
->
h
;

407 
w_out
 = 
ouut
->
w
;

408 
h_out
 = 
ouut
->
h
;

412 
i
 = 0; i < 
w_f
; i++)

413 
j
 = 0; j < 
h_f
; j++)

415 
dex_
 = 
	`f2D
(
i
, 
j
, 
w_f
, 
h_f
);

416 
dex_out
 = 
	`f2D
(
i
 + 
_mge_offt
.
x
, 
j
 +e_mge_offt.
y
, 
w_out
, 
h_out
);

417 
ouut
->
o
[
dex_out
] = 

->o[
dex_
];

419 
i
 = 0; i < 
w_s
; i++)

420 
j
 = 0; j < 
h_s
; j++)

422 
dex_
 = 
	`f2D
(
i
, 
j
, 
w_s
, 
h_s
);

423 
dex_out
 = 
	`f2D
(
i
 + 
right_mge_offt
.
x
, 
j
 + 
_mge_offt
.
y
, 
w_out
, 
h_out
);

424 
ouut
->
o
[
dex_out
] = 

->o[
dex_
];

429 
i
 = 0; i < 
w_f
; i++)

430 
j
 = 0; j < 
h_f
; j++)

432 
dex_
 = 
	`f2D
(
i
, 
j
, 
w_f
, 
h_f
);

433 
dex_out
 = 
	`f2D
(
i
 + 
_mge_offt
.
x
, 
j
 +e_mge_offt.
y
, 
w_out
, 
h_out
);

434 
ouut
->
p
[
dex_out
] = 

->p[
dex_
];

436 
i
 = 0; i < 
w_s
; i++)

437 
j
 = 0; j < 
h_s
; j++)

439 
dex_
 = 
	`f2D
(
i
, 
j
, 
w_s
, 
h_s
);

440 
dex_out
 = 
	`f2D
(
i
 + 
right_mge_offt
.
x
, 
j
 + 
_mge_offt
.
y
, 
w_out
, 
h_out
);

441 
ouut
->
p
[
dex_out
] = 

->p[
dex_
];

446 
i
 = 0; i < 
w_f
; i++)

447 
j
 = 0; j < 
h_f
; j++)

449 
dex_
 = 
	`f2D
(
i
, 
j
, 
w_f
, 
h_f
);

450 
dex_out
 = 
	`f2D
(
i
 + 
_mge_offt
.
x
, 
j
 +e_mge_offt.
y
, 
w_out
, 
h_out
);

451 
ouut
->
o_da
[
dex_out
] = 

->o_da[
dex_
];

453 
i
 = 0; i < 
w_s
; i++)

454 
j
 = 0; j < 
h_s
; j++)

456 
dex_
 = 
	`f2D
(
i
, 
j
, 
w_s
, 
h_s
);

457 
dex_out
 = 
	`f2D
(
i
 + 
right_mge_offt
.
x
, 
j
 + 
_mge_offt
.
y
, 
w_out
, 
h_out
);

458 
ouut
->
o_da
[
dex_out
] = 

->o_da[
dex_
];

463 
i
 = 0; i < 
w_f
; i++)

464 
j
 = 0; j < 
h_f
; j++)

466 
dex_
 = 
	`f2D
(
i
, 
j
, 
w_f
, 
h_f
);

467 
dex_out
 = 
	`f2D
(
i
 + 
_mge_offt
.
x
, 
j
 +e_mge_offt.
y
, 
w_out
, 
h_out
);

468 
ouut
->
p_da
[
dex_out
] = 

->p_da[
dex_
];

470 
i
 = 0; i < 
w_s
; i++)

471 
j
 = 0; j < 
h_s
; j++)

473 
dex_
 = 
	`f2D
(
i
, 
j
, 
w_s
, 
h_s
);

474 
dex_out
 = 
	`f2D
(
i
 + 
right_mge_offt
.
x
, 
j
 + 
_mge_offt
.
y
, 
w_out
, 
h_out
);

475 
ouut
->
p_da
[
dex_out
] = 

->p_da[
dex_
];

479 
	}
}

480 
GameS
* 
	$gamee_add_row
(
GameS
* 
put
, 
Memy
* 
sce_memy
, 
rg_x
, 
rg_y
)

482 
w_d
 = 
put
->
w
;

483 
h_d
 = 
put
->
h
;

484 
w_xt
 = 
w_d
 + 1;

485 
h_xt
 = 
h_d
;

486 
GameS
* 
ouut
 = 
	`gamee_
(
sce_memy
, 
w_xt
, 
h_xt
);

487 
i
 = 0; i < 
w_d
; i++)

488 
j
 = 0; j < 
h_d
; j++)

490 
out_x
 = 
i
 + (>
rg_x
);

491 
out_y
 = 
j
;

492 
_dex
 = 
	`f2D
(
i
, 
j
, 
w_d
, 
h_d
);

493 
out_dex
 = 
	`f2D
(
out_x
, 
out_y
, 
w_xt
, 
h_xt
);

495 
ouut
->
o
[
out_dex
] = 
put
->o[
_dex
];

496 
ouut
->
p
[
out_dex
] = 
put
->p[
_dex
];

497 
ouut
->
o_da
[
out_dex
] = 
put
->o_da[
_dex
];

498 
ouut
->
p_da
[
out_dex
] = 
put
->p_da[
_dex
];

502  
ouut
;

503 
	}
}

504 
GameS
* 
	$gamee_add_cumn
(
GameS
* 
put
, 
Memy
* 
sce_memy
, 
rg_x
, 
rg_y
)

506 
w_d
 = 
put
->
w
;

507 
h_d
 = 
put
->
h
;

508 
w_xt
 = 
w_d
;

509 
h_xt
 = 
h_d
 + 1;

510 
GameS
* 
ouut
 = 
	`gamee_
(
sce_memy
, 
w_xt
, 
h_xt
);

511 
i
 = 0; i < 
w_d
; i++)

512 
j
 = 0; j < 
h_d
; j++)

514 
out_x
 = 
i
;

515 
out_y
 = 
j
 + (j >
rg_y
);

516 
_dex
 = 
	`f2D
(
i
, 
j
, 
w_d
, 
h_d
);

517 
out_dex
 = 
	`f2D
(
out_x
, 
out_y
, 
w_xt
, 
h_xt
);

519 
ouut
->
o
[
out_dex
] = 
put
->o[
_dex
];

520 
ouut
->
p
[
out_dex
] = 
put
->p[
_dex
];

521 
ouut
->
o_da
[
out_dex
] = 
put
->o_da[
_dex
];

522 
ouut
->
p_da
[
out_dex
] = 
put
->p_da[
_dex
];

525  
ouut
;

526 
	}
}

527 
GameS
* 
	$gamee_suound_wh_wls
(
GameS
* 
put
, 
Memy
* 
sce_memy
)

529 
d_w
 = 
put
->
w
;

530 
d_h
 = 
put
->
h
;

531 
xt_w
 = 
d_w
 + 2;

532 
xt_h
 = 
d_h
 + 2;

533 
GameS
* 
su
 = 
	`gamee_
(
sce_memy
, 
xt_w
, 
xt_h
);

534 
i
 = 0; i < 
xt_w
; i++)

535 
j
 = 0; j < 
xt_h
; j++)

536 i(
i
 =0 || 
j
 =0 || i =
xt_w
 - 1 || j =
xt_h
 - 1)

538 
z
 = 
	`f2D
(
i
, 
j
, 
xt_w
,
xt_h
);

539 
su
->
p
[
z
] = 
P_WALL
;

542 
i
 = 0; i < 
d_w
; i++)

543 
j
 = 0; j < 
d_h
; j++)

545 
_dex
 = 
	`f2D
(
i
, 
j
, 
d_w
, 
d_h
);

546 
out_dex
 = 
	`f2D
(
i
 + 1, 
j
 + 1, 
xt_w
, 
xt_h
);

547 
su
->
o
[
out_dex
] = 
put
->o[
_dex
];

548 
su
->
p
[
out_dex
] = 
put
->p[
_dex
];

549 
su
->
o_da
[
out_dex
] = 
put
->o_da[
_dex
];

550 
su
->
p_da
[
out_dex
] = 
put
->p_da[
_dex
];

553  
su
;

554 
	}
}

556 
	$gamee_lo_ys
(
GameS
* 
su
, 
Memy
* 
memy
, 
w
, 
h
)

558 
su
->
w
 = w;

559 
su
->
h
 = h;

560 
su
->
p
 = (*)
	`memy_loc
(
memy
, (* 
w
 * 
h
);

561 
su
->
o
 = (*)
	`memy_loc
(
memy
, (* 
w
 * 
h
);

562 
su
->
p_da
 = (
PDa
*)
	`memy_loc
(
memy
, (PDa* 
w
 * 
h
);

563 
su
->
o_da
 = (
FloDa
*)
	`memy_loc
(
memy
, (FloDa* 
w
 * 
h
);

564 
i
 = 0; i < 
w
 * 
h
; i++)

566 
Flo
 
f
 = (Floor)0;

567 
su
->
o
[
i
] = 
f
;

569 
i
 = 0; i < 
w
 * 
h
; i++)

571 
P
 
p
 = (Piece)0;

572 
su
->
p
[
i
] = 
p
;

574 
i
 = 0; i < 
w
 * 
h
; i++)

576 
su
->
o_da
[
i
] = 
	`gamee_oda_make
();

578 
i
 = 0; i < 
w
 * 
h
; i++)

580 
su
->
p_da
[
i
] = 
	`gamee_pda_make
();

583 
	}
}

584 
bo
 
	$gamee_is__w_cdi
(
GameS
* 
e
)

586 
n
 = 
e
->
w
 * s->
h
;

587 
i
 = 0; i < 
n
; i++)

589 i(
e
->
o
[
i
] =
F_EXIT
 || s->o[i] =
F_START
 || s->o[i] =
F_STAIRCASE_LEVELSTART
)

590 if(!
	`is_ay
(
e
->
p
[
i
]))

592  
l
;

595 
i
 = 0; i < 
n
; i++)

597 i(
e
->
o
[
i
] =
F_TARGET
 && s->
p
[i] !
P_CRATE
)

598  
l
;

600  
ue
;

601 
	}
}

603 
	$maybe_fd_ex__tu_g1
(
GameS
* 
e
)

605 
n
 = 
e
->
w
 * s->
h
;

606 
i
 = 0; i < 
n
; i++)

608 i(
e
->
o
[
i
] =
Flo
::
F_EXIT
)

610  
i
;

614 
i
 = 0; i < 
n
; i++)

616 i(
e
->
o
[
i
] =
Flo
::
F_START
)

618  
i
;

622 
i
 = 0; i < 
n
; i++)

624 i(
e
->
o
[
i
] =
Flo
::
F_STAIRCASE_LEVELSTART
)

626  
i
;

631 
	}
}

633 
	$gamee_maybe_fd_ay
(
GameS
* 
e
)

635 
i
 = 0; i < 
e
->
w
 * s->
h
; i++)

636 i(
e
->
p
[
i
] =
P
::
P_PLAYER
)

637  
i
;

639 
	}
}

640 
bo
 
	$is_v_t
(
v
)

642  
v
 =
F_START
 || v =
F_STAIRCASE_LEVELSTART
;

643 
	}
}

644 
bo
 
	$is_a
(
v
)

646  
v
 =
F_STAIRCASE
 || v =
F_STAIRCASE_LEVELSTART
 || v =
F_STAIRCASE_SOLVED
;

647 
	}
}

648 
bo
 
	$is_ay
(
v
)

650  
v
 =
P_PLAYER
;

651 
	}
}

652 
bo
 
	$is_e
(
v
)

654  
v
 =
P_CRATE
;

655 
	}
}

656 
bo
 
	$is_nm_e
(
PDa
 
v
)

658  
v
.
pows
[
CP_PUSH
];

659 
	}
}

660 
bo
 
	$is_pu_e
(
PDa
 
v
)

662  
v
.
pows
[
CP_PULL
];

663 
	}
}

664 
	$gamee_size
(
GameS
* 
put_e
, GameS* 
ouut_e
, 
IPa
 
dimt_om_put_to_ouut
)

666 
w_
 = 
put_e
->
w
;

667 
h_
 = 
put_e
->
h
;

668 
w_out
 = 
ouut_e
->
w
;

669 
h_out
 = 
ouut_e
->
h
;

670 
i
 = 0; i < 
w_
;i++)

671 
j
 = 0; j < 
h_
; j++)

673 
out_x
 = 
i
 + 
dimt_om_put_to_ouut
.
x
;

674 
out_y
 = 
j
 + 
dimt_om_put_to_ouut
.
y
;

675 i(
out_x
 >0 && out_x < 
w_out
 && 
out_y
 >0 && out_y < 
h_out
)

677 
_dex
 = 
	`f2D
(
i
, 
j
, 
w_
, 
h_
);

678 
out_dex
 = 
	`f2D
(
out_x
, 
out_y
, 
w_out
, 
h_out
);

680 
ouut_e
->
o
[
out_dex
] = 
put_e
->o[
_dex
];

681 
ouut_e
->
p
[
out_dex
] = 
put_e
->p[
_dex
];

682 
ouut_e
->
o_da
[
out_dex
] = 
put_e
->o_da[
_dex
];

683 
ouut_e
->
p_da
[
out_dex
] = 
put_e
->p_da[
_dex
];

688 
	}
}

689 
	$gamee_e_to
(
GameS
* 
put_e
, GameS* 
ouut_e
)

691 
w
 = 
put_e
->w;

692 
h
 = 
put_e
->h;

693 i(
ouut_e
->
w
 !w || ouut_e->
h
 != h)

695 
	`ash_r
("You fool! Youriedo use gamestate_clone_to onn input_statehat didn't havehe correctmount of memory. This would be memoryeak. It'sow crash. Enjoy.");

697 
ouut_e
->
w
 = w;

698 
ouut_e
->
h
 = h;

699 
i
 = 0; i < 
w
;i++)

700 
j
 = 0; j < 
h
; j++)

703 
dex
 = 
	`f2D
(
i
, 
j
, 
w
, 
h
);

704 
ouut_e
->
o
[
dex
] = 
put_e
->floor[index];

705 
ouut_e
->
p
[
dex
] = 
put_e
->piece[index];

706 
ouut_e
->
o_da
[
dex
] = 
put_e
->floor_data[index];

707 
ouut_e
->
p_da
[
dex
] = 
put_e
->piece_data[index];

711 
	}
}

712 
	$gamee_e_to_unlized
(
GameS
* 
put_e
, GameS* 
ouut_e
, 
Memy
* 
memy
)

714 
w
 = 
put_e
->w;

715 
h
 = 
put_e
->h;

716 
	`gamee_lo_ys
(
ouut_e
, 
memy
, 
w
, 
h
);

717 
	`gamee_e_to
(
put_e
, 
ouut_e
);

718 
	}
}

721 
bo
 
	$gamee_y_brush
(
GameS
* 
e
, 
GameeBrush
 
brush
, 
x
, 
y
)

723 
bo
 
ac
 = 
l
;

724 i(
brush
.
yFlo
)

726 
w
 = 
e
->w;

727 
h
 = 
e
->h;

728 
rg
 = 
	`f2D
(
x
, 
y
, 
w
,
h
);

729 i(
e
->
o
[
rg
] !
brush
.floor)

731 
e
->
o
[
rg
] = 
brush
.floor;

732 
ac
 = 
ue
;

736 i(
brush
.
yP
)

738 
w
 = 
e
->w;

739 
h
 = 
e
->h;

740 
rg
 = 
	`f2D
(
x
, 
y
, 
w
, 
h
);

741 i(
e
->
p
[
rg
] !
brush
.piece)

743 
e
->
p
[
rg
] = 
brush
.piece;

744 
ac
 = 
ue
;

747 i(
brush
.
yCPow
)

749 
w
 = 
e
->w;

750 
h
 = 
e
->h;

751 
rg
 = 
	`f2D
(
x
, 
y
, 
w
, 
h
);

752 
i
 = 0; i < 
CP_COUNT
; i++)

753 
e
->
p_da
[
rg
].
pows
[
i
] = 
brush
.piece_data.powers[i];

755 i(
brush
.
yFloPow
)

757 
w
 = 
e
->w;

758 
h
 = 
e
->h;

759 
rg
 = 
	`f2D
(
x
, 
y
, 
w
,
h
);

761 
e
->
o_da
[
rg
] = 
brush
.floor_data;

764  
ac
;

765 
	}
}

766 
GameeBrush
 
	$gamee_brush_
(
bo
 
yFlo
, 
Flo
 
o
, bo 
yP
, 
P
 
p
, bo 
yPDa
, 
PDa
 
pDa
,bo 
yFloDa
, 
FloDa
 
oDa
)

768 
GameeBrush
 
su
;

769 
su
.
yFlo
 =pplyFloor;

770 
su
.
o
 = floor;

771 
su
.
yP
 =pplyPiece;

772 
su
.
p
 =iece;

773 
su
.
yCPow
 = 
yPDa
;

774 
su
.
p_da
 = 
pDa
;

775 
su
.
yFloPow
 = 
yFloDa
;

776 
su
.
o_da
 = 
oDa
;

777  
su
;

778 
	}
}

782 
	gxtuAsts
::
SYMBOLS
 
	$pda_to_symb
(
CPow
 
v
)

784 i(
v
 =
CPow
::
CP_PUSH
)

785  
xtuAsts
::
SYMBOLS
::
Ce
;

786 i(
v
 =
CPow
::
CP_PULL
)

787  
xtuAsts
::
SYMBOLS
::
Sque
;

788 i(
v
 =
CPow
::
CP_MERGE
)

789  
xtuAsts
::
SYMBOLS
::
Plus
;

790 i(
v
 =
CPow
::
CP_PARALLEL
)

791  
xtuAsts
::
SYMBOLS
::
Trng
;

792 
	`ash_r
("Triedo draw crate_powerhat isot drawable");

793  
xtuAsts
::
SYMBOLS
::
HfCe
;

794 
	}
}

796 
PDa
 
	$gamee_pda_make
()

798 
PDa
 
su
;

799 
i
 = 0; i < 
CP_COUNT
; i++)

800 
su
.
pows
[
i
] = 
l
;

801  
su
;

802 
	}
}

803 
PDa
 
	$gamee_pda_make
(
CPow
 
pow
)

805 
PDa
 
su
;

806 
i
 = 0; i < 
CP_COUNT
; i++)

807 
su
.
pows
[
i
] = 
l
;

808 
su
.
pows
[
pow
] = 
ue
;

809  
su
;

811 
	}
}

812 
PDa
 
	$gamee_pda_make
(
CPow
 
pow
,CPow 
pow2
)

814 
PDa
 
su
;

815 
i
 = 0; i < 
CP_COUNT
; i++)

816 
su
.
pows
[
i
] = 
l
;

817 
su
.
pows
[
pow
] = 
ue
;

818 
su
.
pows
[
pow2
] = 
ue
;

819  
su
;

821 
	}
}

822 
PDa
 
	$gamee_pda_make
(
CPow
 
pow
,CPow 
pow2
, CPow 
pow3
)

824 
PDa
 
su
;

825 
i
 = 0; i < 
CP_COUNT
; i++)

826 
su
.
pows
[
i
] = 
l
;

827 
su
.
pows
[
pow
] = 
ue
;

828 
su
.
pows
[
pow2
] = 
ue
;

829 
su
.
pows
[
pow3
] = 
ue
;

830  
su
;

832 
	}
}

833 
FloDa
 
	$gamee_oda_make
()

835 
FloDa
 
su
;

836 
su
.
p܋r_id
 = -1;

837  
su
;

838 
	}
}

843 
	$gamee_t_a__vue
(
GameS
** 
gamee
, 
n
)

845 
z
 = 0; z < 
n
; z++)

848 
w
 = 
gamee
[
z
]->w;

849 
h
 = 
gamee
[
z
]->h;

850 
i
 = 0; i < 
w
 * 
h
; i++)

852 i(
	`is_a
(
gamee
[
z
]->
o
[
i
]))

854 
d
::
cout
 << "i" << 
i
 << ",_lk" << 
gamee
[
z
]->
o_da
[i].
p܋r_id
 << std::
dl
;

859 
	}
}

860 ** 
	$gamee_g_ys
(
GameS
* 
gamee
, * 
num_ys_found
, 
Memy
* 
mp_memy
)

862 ** 
su
 = (**)
	`memy_loc
(
mp_memy
, (*) * 2);

863 
su
[0] = 
gamee
->
o
;

864 
su
[1] = 
gamee
->
p
;

865  
su
;

866 
	}
}

867 * 
	$gamee_g_y
(
GameS
* 
gamee
, 
y_num
)

869 i(
y_num
 == 0)

870  
gamee
->
o
;

871 i(
y_num
 == 1)

872  
gamee
->
p
;

873 
	`ash_r
("uh ohh, weriedo getayerhat doesn'txist!");

874  
gamee
->
o
;

875 
	}
}

876 
AABB
* 
	$gamee__clids
(
Memy
* 
memy
, 
GameS
** 
es
, 
IPa
* 
lotis
, 
ngth
)

878 
AABB
* 
su
 = (AABB*)
	`memy_loc
(
memy
, (AABB* (
ngth
 - 1));

879 
i
 = 0; i < 
ngth
; i++)

881 
su
[
i
].
w
 = (
es
[i]->w;

882 
su
[
i
].
h
 = (
es
[i]->h;

884 
i
 = 0; i < 
ngth
; i++)

886 
su
[
i
].
x
 = (
lotis
[i].x;

887 
su
[
i
].
y
 = (
lotis
[i].y;

889  
su
;

890 
	}
}

891 
AABB
* 
	$gamee__clids
(
Memy
* 
memy
, 
GameS
** 
es
, 
IPa
* 
lotis
, 
ngth
, 
sk_dex
)

893 
AABB
* 
su
 = (AABB*
	`memy_loc
(
memy
, (AABB* (
ngth
 - 1));

894 
i
 = 0; i < 
sk_dex
; i++)

896 
su
[
i
].
w
 = (
es
[i]->w;

897 
su
[
i
].
h
 = (
es
[i]->h;

899 
i
 = 
sk_dex
 + 1; i < 
ngth
; i++)

901 
su
[
i
 - 1].
w
 = (
es
[i]->w;

902 
su
[
i
 - 1].
h
 = (
es
[i]->h;

904 
i
 = 0; i < 
sk_dex
; i++)

906 
su
[
i
].
x
 = (
lotis
[i].x;

907 
su
[
i
].
y
 = (
lotis
[i].y;

909 
i
 = 
sk_dex
 + 1; i < 
ngth
; i++)

911 
su
[
i
 - 1].
x
 = (
lotis
[i].x;

912 
su
[
i
 - 1].
y
 = (
lotis
[i].y;

914  
su
;

915 
	}
}

916 
	$symblonimi_loc_
(
GameS
* 
e
, 
SymbAnimi
* 
imi
,
w
, 
h
)

918 
z
 = 0;

919 
i
 = 0; i < 
w
; i++)

920 
j
 = 0; j < 
h
;j++,
z
++)

922 
imi
->
t_pows
[
z
] = 
e
->
p_da
[z];

923 
imi
->
d_pows
[
z
] = 
e
->
p_da
[z];

924 
p
 = 0; < 
CP_COUNT
;++)

925 
imi
->
ash_pows
[
z
].
pows
[
p
] = 
l
;;

926 
imi
->
glob_posi
[
z
] = 
	`mh_a_
(
i
, 
j
);

927 
imi
->
glob_move
[
z
] = 
Dei
::
NO_DIRECTION
;

929 
	}
}

931 
SymbAnimi
* 
	$symblonimi__
(
num_emts
, 
Memy
* 
mp_memy
)

933 
SymbAnimi
* 
su
 = 
mem_loc
<SymbAnimi>(
mp_memy
, 1);

934 
su
->
n
 = 
num_emts
;

935 
su
->
glob_posi
 = 
mem_loc
<
IPa
>(
mp_memy
, 
num_emts
);

936 
su
->
glob_move
 = 
mem_loc
<
Dei
>(
mp_memy
,
num_emts
);

937 
su
->
t_pows
 = 
mem_loc
<
PDa
>(
mp_memy
,
num_emts
);

938 
su
->
d_pows
 = 
mem_loc
<
PDa
>(
mp_memy
,
num_emts
);

939 
su
->
ash_pows
 = 
mem_loc
<
PDa
>(
mp_memy
,
num_emts
);

940  
su
;

941 
	}
}

943 
	$symbglobimi_loc_
(
SymbGlobAnimi
* 
to_loc
, 
Memy
* 
mp_memy
,
num_emts
)

945 
to_loc
->
n
 = 
num_emts
;

946 
to_loc
->
img_vue
 = 
mem_loc
<>(
mp_memy
, 
num_emts
);

947 
to_loc
->
to_move
 = 
mem_loc
<
Dei
>(
mp_memy
, 
num_emts
);

948 
to_loc
->
pos
 = 
mem_loc
<
IPa
>(
mp_memy
, 
num_emts
);

949 
	}
}

950 
	$cy_p_imi_to_symb_imi
(
PDa
* 
es
, 
n_ps
, 
n_symbs
, 
MaskedMovemtAnimi
* 
ps
, MaskedMovemtAnimi* 
symb
)

952 
cut_n_symbs
 = 0;

953 
i
 = 0; i < 
n_ps
; i++)

955 
j
 = 0; j < 
CP_COUNT
;j++)

956 i(
es
[
i
].
pows
[
j
])

958 
symb
->
pos
[
cut_n_symbs
] = 
ps
->pos[
i
];

959 
symb
->
img_vue
[
cut_n_symbs
] = 
j
;

960 
symb
->
to_move
[
cut_n_symbs
]
ps
->to_move[
i
];

961 
cut_n_symbs
++;

964 
	}
}

965 
	$masked_movemt_imi_e_
(
n
, 
MaskedMovemtAnimi
* 
cy
, MaskedMovemtAnimi* 
ig
)

967 
i
 = 0; i < 
n
; i++)

969 
cy
->
img_vue
[
i
] = 
ig
->img_value[i];

971 
i
 = 0; i < 
n
; i++)

973 
cy
->
pos
[
i
] = 
ig
->pos[i];

975 
i
 = 0; i < 
n
; i++)

977 
cy
->
to_move
[
i
] = 
ig
->to_move[i];

979 
	}
}

980 
MaskedMovemtAnimi
* 
	$gamee_imimovefo__
(
num_emts
, 
Memy
* 
mp_memy
)

982 
MaskedMovemtAnimi
* 
su
 = (MaskedMovemtAnimi*)
	`memy_loc
(
mp_memy
, (MaskedMovementAnimation));

983 
su
->
pos
 = (
IPa
*)
	`memy_loc
(
mp_memy
, (IPa* 
num_emts
);

984 
su
->
to_move
 = (
Dei
*)
	`memy_loc
(
mp_memy
, (Dei* 
num_emts
);

985 
su
->
img_vue
 = (*)
	`memy_loc
(
mp_memy
, (* 
num_emts
);

986 
i
 = 0; i < 
num_emts
; i++)

988 
su
->
pos
[
i
] = 
	`mh_a_
(0, 0);

989 
su
->
to_move
[
i
] = 
Dei
::
NO_DIRECTION
;

990 
su
->
img_vue
[
i
] = 0;

992  
su
;

993 
	}
}

994 
	$imimovefo_t_deu_posis
(
MaskedMovemtAnimi
* 
fo
, 
GameS
* 
e
)

996 
w
 = 
e
->w;

997 
h
 = 
e
->h;

998 
z
 = 0;

999 
i
 = 0; i < 
w
;i++)

1000 
j
 = 0; j < 
h
; j++, 
z
++)

1002 
fo
->
pos
[
z
] = 
	`mh_a_
(
i
, 
j
);

1004 
	}
}

1005 
	$imimovefo_cy_om_gamee_
(
MaskedMovemtAnimi
* 
fo
, 
GameS
* 
e
)

1007 
num_to_dw
 = 
e
->
w
 * s->
h
;

1008 
i
 = 0; i < 
num_to_dw
; i++)

1010 
xt_v
 = 
e
->
p
[
i
];

1011 
fo
->
img_vue
[
i
] = 
xt_v
;

1014 
	}
}

1015 
	$imimovefo_y_movemts
(
GameS
* 
e
, 
MaskedMovemtAnimi
* 
t
,MaskedMovemtAnimi* 
d
, 
bo
* 
moves
, 
Dei
 
movemt
, 
num_to_dw
)

1017 
z
 = 0;

1018 
i
 = 0; i < 
e
->
w
;i++)

1019 
j
 = 0;j < 
e
->
h
;j++,
z
++)

1020 i(
moves
[
z
])

1022 
t
->
to_move
[
z
] = 
movemt
;

1023 
d
->
to_move
[
z
] = 
movemt
;

1024 
IPa
 
xt_gl
 = 
	`move_pos_wed_2d
(
	`mh_a_
(
i
,
j
),
movemt
, 
e
->
w
, s->
h
);

1025 
d
->
pos
[
z
] = 
xt_gl
;

1027 
	}
}

1029 
	gglm
::
vec2
 
	$pda_lcuϋ_s
(
PDa
 
p
)

1031 
tٮ
 = 0;

1032 
i
 = 0; i < 
CP_COUNT
; i++)

1033 
tٮ
 +
p
.
pows
[
i
];

1034 
width
 = ()
	`
(
	`sq
(
tٮ
));

1035 
glm
::
vec2
 
s
;

1036 
s
.
x
 = 1.0/ ()
width
;

1037 
s
.
y
 = 1.0/ ()
width
;

1038  
s
;

1039 
	}
}

1041 
	$pda_lcuϋ_lol_posis
(
PDa
 
p
, 
glm
::
vec2
* 
s
, glm::vec2* 
out_posis
)

1043 
tٮ
 = 0;

1044 
i
 = 0; i < 
CP_COUNT
; i++)

1045 
tٮ
 +
p
.
pows
[
i
];

1046 
width
 = ()
	`
(
	`sq
(
tٮ
));

1048 
num_dwn
 = 0;

1049 
j
 = 0; j < 
CP_COUNT
; j++)

1051 i(
p
.
pows
[
j
])

1053 
out_posis
[
num_dwn
].
x
 = um_dw% 
width
);

1054 
out_posis
[
num_dwn
].
y
 = um_dw/ 
width
);

1055 
num_dwn
++;

1058 
	}
}

1062 
GameAiJou
* 
	$gamee_ai
(
GameS
* 
e
, 
Dei
 
ai
, 
Memy
* 
mp_memy
)

1064 
GameAiJou
* 
jou
 = (GameAiJou*)
	`memy_loc
(
mp_memy
, (GameActionJournal));

1065 
jou
->
d_e
 = 
	`gamee_e
(
e
, 
mp_memy
);

1066 cڡ 
w
 = 
e
->w;

1067 cڡ 
h
 = 
e
->h;

1068 cڡ 
num_emts
 = 
w
 * 
h
;

1069 * 
ps
 = 
e
->
p
;

1072 
GameSAnimi
* 
imi
;

1074 
imi
 = (
GameSAnimi
*
	`memy_loc
(
mp_memy
, (GameStateAnimation));

1075 
imi
->
ts
 = *
	`gamee_imimovefo__
(
w
 * 
h
, 
mp_memy
);

1076 
imi
->
ds
 = *
	`gamee_imimovefo__
(
w
 * 
h
, 
mp_memy
);

1077 
imi
->
num_to_dw
 = 
w
 * 
h
;

1078 
	`imimovefo_cy_om_gamee_
(&
imi
->
ts
, 
e
);

1079 
	`imimovefo_t_deu_posis
(&
imi
->
ts
, 
e
);

1080 
	`imimovefo_t_deu_posis
(&
imi
->
ds
, 
e
);

1083 
ay_1d
 = 0;

1084 
IPa
 
ay_2d
 = 
	`mh_a_
(0,0);

1087 
i
 = 0; i < 
num_emts
; i++)

1089 i(
	`is_ay
(
ps
[
i
]))

1092 
ay_1d
 = 
i
;

1093 
ay_2d
 = 
	`t2D
(
i
, 
e
->
w
, s->
h
);

1100 
bo
* 
sque_movg
 = (bo*)
	`memy_loc
(
mp_memy
, (bo* 
num_emts
);

1102 
	`memt
(
sque_movg
, 
l
, (* 
num_emts
);

1103 
sque_movg
[
ay_1d
] = 
ue
;

1107 
RigidDa
 
rigid_da
;

1109 
rigid_da
.
grid
 = (*)
	`memy_loc
(
mp_memy
, (* 
num_emts
);

1110 
i
 = 0; i < 
num_emts
; i++)

1111 
rigid_da
.
grid
[
i
]= 0;

1112 
rigid_da
.
lks
 = (
IPa
*
	`memy_loc
(
mp_memy
, (IPa* 
num_emts
);

1113 
rigid_da
.
num_lks
 = 0;

1114 
rigid_da
.
num_rigids
 = 1;

1118 
IPa
 
xt_sque
 = 
	`move_pos_wed_2d
(
ay_2d
, 
ai
, 
w
, 
h
);

1119 
IPa
 
back_sque
 = 
	`move_pos_wed_2d
(
ay_2d
, 
	`dei_v
(
ai
), 
w
, 
h
);

1120 
IPa
 
ockwi_sque
 = 
	`move_pos_wed_2d
(
ay_2d
, 
	`dei_r٩e_ockwi
(
ai
), 
w
, 
h
);

1121 
IPa
 
tiockwi_sque
 = 
	`move_pos_wed_2d
(
ay_2d
, 
	`dei_r٩e_ti
(
ai
), 
w
, 
h
);

1122 
xt_sque_1d
 = 
	`f2D
(
xt_sque
.
x
,ext_sque.
y
, 
w
, 
h
);

1123 
back_sque_1d
 = 
	`f2D
(
back_sque
.
x
, back_sque.
y
, 
w
, 
h
);

1124 
ockwi_sque_1d
 = 
	`f2D
(
ockwi_sque
.
x
, clockwi_sque.
y
, 
w
, 
h
);

1125 
tiockwi_sque_1d
 = 
	`f2D
(
tiockwi_sque
.
x
,iockwi_sque.
y
, 
w
, 
h
);

1127 
xt_p
 = 
ps
[
xt_sque_1d
];

1128 
back_p
 = 
ps
[
back_sque_1d
];

1129 
ockwi_p
 = 
ps
[
ockwi_sque_1d
];

1130 
tiockwi_p
 = 
ps
[
tiockwi_sque_1d
];

1133 
ay_rigid_numb
 = 
rigid_da
.
num_rigids
;

1134 
rigid_da
.
num_rigids
++;

1135 
rigid_da
.
grid
[
ay_1d
] = 
ay_rigid_numb
;

1136 i(
xt_p
 =
P_CRATE
 && 
e
->
p_da
[
xt_sque_1d
].
pows
[
CP_PUSH
])

1138 
sque_movg
[
xt_sque_1d
] = 
ue
;

1139 
rigid_da
.
grid
[
xt_sque_1d
] =igid_da.
num_rigids
;

1140 
rigid_da
.
num_rigids
++;

1141 
rigid_da
.
lks
[rigid_da.
num_lks
] = 
	`mh_a_
(
ay_rigid_numb
,igid_da.
grid
[
xt_sque_1d
]);

1142 
rigid_da
.
num_lks
++;

1144 i(
back_p
 =
P_CRATE
 && 
e
->
p_da
[
back_sque_1d
].
pows
[
CP_PULL
])

1146 
sque_movg
[
back_sque_1d
] = 
ue
;

1147 
rigid_da
.
grid
[
back_sque_1d
] =igid_da.
num_rigids
;

1148 
rigid_da
.
num_rigids
++;

1149 
rigid_da
.
lks
[rigid_da.
num_lks
] = 
	`mh_a_
(
ay_rigid_numb
,igid_da.
grid
[
back_sque_1d
]);

1150 
rigid_da
.
num_lks
++;

1152 i(
ockwi_p
 =
P_CRATE
 && 
e
->
p_da
[
ockwi_sque_1d
].
pows
[
CP_PARALLEL
])

1154 
sque_movg
[
ockwi_sque_1d
] = 
ue
;

1155 
rigid_da
.
grid
[
ockwi_sque_1d
] =igid_da.
num_rigids
;

1156 
rigid_da
.
num_rigids
++;

1157 
rigid_da
.
lks
[rigid_da.
num_lks
] = 
	`mh_a_
(
ay_rigid_numb
,igid_da.
grid
[
ockwi_sque_1d
]);

1158 
rigid_da
.
num_lks
++;

1160 i(
tiockwi_p
 =
P_CRATE
 && 
e
->
p_da
[
tiockwi_sque_1d
].
pows
[
CP_PARALLEL
])

1162 
sque_movg
[
tiockwi_sque_1d
] = 
ue
;

1163 
rigid_da
.
grid
[
tiockwi_sque_1d
] =igid_da.
num_rigids
;

1164 
rigid_da
.
num_rigids
++;

1165 
rigid_da
.
lks
[rigid_da.
num_lks
] = 
	`mh_a_
(
ay_rigid_numb
,igid_da.
grid
[
tiockwi_sque_1d
]);

1166 
rigid_da
.
num_lks
++;

1168 i(
e
->
o
[
xt_sque_1d
] =
F_GRILL_HOT
)

1170 
sque_movg
[
ay_1d
] = 
l
;

1171 
	`nl_moves_by_rigid
(&
rigid_da
, 
sque_movg
, 
ay_rigid_numb
, 
e
->
w
 * s->
h
);

1176 
imi
->
symb_t
 = *
	`symblonimi__
(
w
 * 
h
, 
mp_memy
);

1177 
imi
->
symb_d
 = *
	`symblonimi__
(
w
 * 
h
, 
mp_memy
);

1179 
	`symblonimi_loc_
(
e
, &
imi
->
symb_t
, 
w
, 
h
);

1180 
	`symblonimi_loc_
(
e
, &
imi
->
symb_d
, 
w
, 
h
);

1182 
	`nl_blocked_nmge_moves
(&
rigid_da
, 
sque_movg
, 
ps
, 
e
->
p_da
, 
ai
, 
w
, 
h
);

1185 i(
sque_movg
[
ay_1d
] && 
e
->
o
[ay_1d] =
F_GRILL_COLD
)

1186 
e
->
o
[
ay_1d
] = 
F_GRILL_HOT
;

1191 
	`y_mge_moves
(
e
->
p_da
, 
sque_movg
, 
ps
, 
ai
, 
w
, 
h
,
imi
);

1194 
	`imimovefo_cy_om_gamee_
(&
imi
->
ds
, 
e
);

1197 
	`imimovefo_y_movemts
(
e
,&
imi
->
ts
, &imi->
ds
, 
sque_movg
, 
ai
, 
w
 * 
h
);

1200 
y_moves_to_y_SLOW
<>(
mp_memy
, 
sque_movg
, 
ps
, 
w
, 
h
, 
ai
, 
P_NONE
);

1201 
y_moves_to_y_SLOW
<
PDa
>(
mp_memy
, 
sque_movg
, 
e
->
p_da
,
w
,
h
,
ai
, 
	`gamee_pda_make
());

1203 
jou
->
ai_su
 = 
AR_ACTION_OCCURED
;

1204 
jou
->
maybe_imi
 = 
imi
;

1205  
jou
;

1206 
	}
}

1207 
	$gamee_umb
(
GameS
* 
e
)

1209 
n
 = 
e
->
w
 * s->
h
;

1210 
i
 = 0; i < 
n
; i++)

1212 i(
e
->
p
[
i
] =
P_CRUMBLE
 || s->p[i] =
P_CRATE
)

1213 
e
->
p
[
i
] = 
P_NONE
;

1215 
i
 = 0; i < 
n
; i++)

1217 i(
e
->
o
[
i
] =
F_START
 || s->o[i] =
F_TARGET
)

1218 
e
->
o
[
i
] = 
F_NONE
;

1220 
i
 = 0; i < 
n
; i++)

1222 i(
e
->
o
[
i
] =
F_EXIT
)

1223 
e
->
o
[
i
] = 
F_NONE
;

1225 
	}
}

1226 
	$gamee_tup
(
GameS
* 
e
)

1228 
	`gamee_exude_lurkg_wls
(
e
);

1231 
ex
 = 
	`maybe_fd_ex__tu_g1
(
e
);

1233 i(
ex
 == -1)

1235 
	`ash_r
("a gamestate was started up, butnxit couldn't be found. Uh oh.");

1238 
i
 = 0; i < 
e
->
w
 * s->
h
;i++)

1240 i(
i
 =
ex
)

1242 i(
e
->
o
[
i
] =
F_EXIT
 || s->o[i] =
F_START
 || s->o[i] =
F_STAIRCASE_LEVELSTART
)

1244 
e
->
o
[
i
] = 
F_NONE
;

1248 if(
l
)

1250 
bo
 
found_
 = 
l
;

1251 
bo
 
found_ex
 = 
l
;

1252 

 = 0;

1253 
ex
 = 0;

1254 
i
 = 0; i < 
e
->
w
 * s->
h
; i++)

1256 i(
	`is_v_t
(
e
->
o
[
i
]))

1258 
found_
 = 
ue
;

1259 

 = 
i
;

1263 
i
 = 0; i < 
e
->
w
 * s->
h
; i++)

1266 i(
e
->
o
[
i
] =
F_EXIT
)

1268 
found_ex
 = 
ue
;

1269 
ex
 = 
i
;

1274 i(
found_
 && !
found_ex
)

1276 
e
->
o
[

] = 
F_EXIT
;

1280 
	}
}

1281 
	$gamee_exude_lurkg_wls
(
GameS
* 
e
)

1283 
n
 = 
e
->
w
 * s->
h
;

1284 
i
 = 0; i < 
n
; i++)

1286 i(
e
->
o
[
i
] =
F_LURKING_WALL
)

1288 
e
->
p
[
i
] = 
P_WALL
;

1292 
	}
}

	@GameState.h

1 #agm



3 
	~"Cڡts.h
"

4 
	~"Memy.h
"

5 
	~"Mh.h
"

6 
	~<ioam
>

7 
	~"xtuAsts.h
"

8 
	eLAYER_NAME


10 
	mLN_FLOOR
,

11 
	mLN_PIECE
,

12 
	mLN_COUNT


15 cڡ 
	gGAME_NUM_LAYERS
 = 
LN_COUNT
;

16 cڡ 
	gPLAYER_LAYER
 = 
LN_PIECE
;

18 
	eP
 {

19 
	mP_NONE
,

20 
	mP_PLAYER
,

21 
	mP_CRATE
,

22 
	mP_CRUMBLE
,

23 
	mP_WALL
,

24 
	mP_WALL_ALT
,

25 
	mP_COUNT


28 
	eFlo
 {

29 
	mF_NONE
,

30 
	mF_TARGET
,

31 
	mF_OUTLINE
,

32 
	mF_START
,

33 
	mF_ZBLACK
,

34 
	mF_LURKING_WALL
,

35 
	mF_GRILL_COLD
,

36 
	mF_GRILL_HOT
,

37 
	mF_EXIT
,

38 
	mF_STAIRCASE
,

39 
	mF_STAIRCASE_LEVELSTART
,

40 
	mF_STAIRCASE_SOLVED
,

41 
	mF_COUNT


43 
	eCPow
 {

44 
	mCP_PUSH
,

45 
	mCP_PULL
,

46 
	mCP_PARALLEL
,

47 
	mCP_MERGE
,

48 
	mCP_STICKY
,

49 
	mCP_COUNT
,

50 
	mCP_ERROR


52 
	sPDa


54 
bo
 
	mpows
[
CP_COUNT
];

57 
	gT܋r_Loti
;

58 
	sFloDa


61 
	mp܋r_id
;

62 
IPa
 
	mp܋r_rg_sque
;

65 
	sGameS
 {

66 
	mw
;

67 
	mh
;

68 * 
	mo
;

69 * 
	mp
;

70 
FloDa
* 
	mo_da
;

71 
PDa
* 
	mp_da
;

74 
	sGameeBrush
 {

75 
bo
 
	myFlo
;

76 
bo
 
	myP
;

77 
Flo
 
	mo
;

78 
P
 
	mp
;

79 
bo
 
	myCPow
;

80 
PDa
 
	mp_da
;

81 
bo
 
	myFloPow
;

82 
FloDa
 
	mo_da
;

85 
	sGameeTimeMache


87 
GameS
* 
	mt_e
;

88 
GameS
* 
	me_y
;

89 
	mnum_gamees_ed
;

90 
	mmax_gamees_ab
;

92 
	eAi
 {

93 
	mA_UP
,

94 
	mA_RIGHT
,

95 
	mA_DOWN
,

96 
	mA_LEFT
,

97 
	mA_UNDO
,

98 
	mA_RESET
,

99 
	mA_NONE
,

100 
	mA_COUNT


104 
	eAnimiTy
 {

105 
	mAT_NONE
,

106 
	mAT_MOVE
,

107 
	mAT_COUNT


111 
	sSymbGlobAnimi


113 
	mn
;

114 
IPa
* 
	mpos
;

115 
Dei
* 
	mto_move
;

116 * 
	mimg_vue
;

118 
	sSymbAnimi


120 
	mn
;

121 * 
	mdex
;

122 
IPa
* 
	mglob_posi
;

123 
Dei
* 
	mglob_move
;

124 
PDa
* 
	mt_pows
;

125 
PDa
* 
	md_pows
;

126 
PDa
* 
	mash_pows
;

128 
	sMaskedMovemtAnimi


130 
IPa
* 
	mpos
;

131 
Dei
* 
	mto_move
;

133 * 
	mimg_vue
;

135 
	sGameSAnimi


137 
	mnum_to_dw
;

139 
MaskedMovemtAnimi
 
	mts
;

140 
MaskedMovemtAnimi
 
	mds
;

142 
SymbAnimi
 
	msymb_t
;

143 
SymbAnimi
 
	msymb_d
;

145 
	eAiResu


147 
	mAR_ACTION_CANCELLED
,

148 
	mAR_ACTION_OCCURED
,

149 
	mAR_COUNT


151 
	sGameAiJou


153 
GameS
* 
	md_e
;

154 
AiResu
 
	mai_su
;

155 
GameSAnimi
* 
	mmaybe_imi
;

158 
	sRigidDa


160 * 
	mgrid
;

161 
	mnum_rigids
;

162 
IPa
* 
	mlks
;

163 
	mnum_lks
;

165 
Dei
 
ai_to_dei
(
Ai
 
ai
);

166 
IPa
 
dei_to_a
(
Dei
 
d
);

167 
gamee_timemache_t
(
GameeTimeMache
* 
timeMache
, 
Memy
* 
sce_memy
);

171 
gamee_timemache_t
(
GameeTimeMache
* 
timeMache
, 
Memy
* 
sce_memy
);

172 * 
gamee_timemache_undo
(
GameeTimeMache
* 
timeMache
);

173 
GameS
* 
gamee_timemache_g_ϋ_gamee
(
GameeTimeMache
* 
timeMache
);

174 
GameeTimeMache
* 
gamee_timemache_
(
GameS
* 
t_e
, 
Memy
* 
memy
, 
max_num_gamees
);

175 
GameAiJou
* 
gamee_timemache_ke_ai
(
GameeTimeMache
* 
timeMache
, 
Dei
 
ai
, 
Memy
* 
sce_memy
, Memy* 
mp_memy
);

178 
GameeBrush
 
gamee_brush_
(
bo
 
yFlo
, 
Flo
 
o
, bo 
yP
, 
P
 
p
, bo 
yPDa
, 
PDa
 
pDa
, bo 
yFloDa
, 
FloDa
 
oDa
);

182 
	gxtuAsts
::
SYMBOLS
 
pda_to_symb
(
CPow
 
v
);

183 
PDa
 
gamee_pda_make
();

184 
PDa
 
gamee_pda_make
(
CPow
 
v
);

185 
PDa
 
gamee_pda_make
(
CPow
 
v
, CPow 
v2
);

186 
PDa
 
gamee_pda_make
(
CPow
 
v
, CPow 
v2
,CPow 
v3
);

187 
FloDa
 
gamee_oda_make
();

191 
GameS
* 
gamee_
(
Memy
* 
memy
, 
w
, 
h
);

192 
GameS
* 
gamee_e
(GameS* 
e
, 
Memy
* 
memy
);

193 
gamee_e_to_unlized
(
GameS
* 
put
, GameS* 
ouut
, 
Memy
* 
memy
);

194 
gamee_e_to
(
GameS
* 
put_e
, GameS* 
ouut_e
);

196 
GameS
* 
gamee_add_row
(GameS* 
put
, 
Memy
* 
sce_memy
, 
rg_x
, 
rg_y
);

197 
GameS
* 
gamee_add_cumn
(GameS* 
put
, 
Memy
* 
sce_memy
, 
rg_x
, 
rg_y
);

198 
GameS
* 
gamee_suound_wh_wls
(GameS* 
put
, 
Memy
* 
sce_memy
);

199 
gamee_size
(
GameS
* 
put_e
, GameS* 
ouut_e
, 
IPa
 
dimt_om_put_to_ouut
);

200 
GameS
* 
gamee_size_wh_lo
(GameS* 
put_e
, 
Memy
* 
ouut_memy
, 
ouut_w
, 
ouut_h
, 
IPa
 
dimt_om_put_to_ouut
);

201 
bo
 
gamee_y_brush
(
GameS
* 
e
, 
GameeBrush
 
brush
, 
x
, 
y
);

202 
GameS
* 
gamee_mge_wh_lo
(GameS* 
f
, GameS* 
cd
, 
IPa
 
combed_size
, 
Memy
* 
ouut_memy
, IPa 
_mge_offt
, IPa 
right_mge_offt
);

203 
gamee_mge
(
GameS
* 

, GameS* 
right
, GameS* 
ouut
, 
IPa
 
_mge_offt
, IPa 
right_mge_offt
);

206 
gamee_t_a__vue
(
GameS
** 
gamee
,
n
);

207 ** 
gamee_g_ys
(
GameS
* 
gamee
, * 
num_ys_found
, 
Memy
* 
mp_memy
);

208 * 
gamee_g_y
(
GameS
* 
gamee
, 
y_num
);

210 
AABB
* 
gamee__clids
(
Memy
* 
memy
, 
GameS
** 
es
, 
IPa
* 
lotis
, 
ngth
);

211 
AABB
* 
gamee__clids
(
Memy
* 
memy
, 
GameS
** 
es
, 
IPa
* 
lotis
, 
ngth
, 
sk_dex
);

212 
bo
 
gamee_is__w_cdi
(
GameS
* 
e
);

214 
gamee_maybe_fd_ay
(
GameS
* 
e
);

215 
maybe_fd_ex__tu_g1
(
GameS
* 
e
);

216 
bo
 
is_v_t
(
v
);

217 
bo
 
is_a
(
v
);

218 
bo
 
is_ay
(
v
);

220 
	gglm
::
vec2
 
pda_lcuϋ_s
(
PDa
 
p
);

221 
pda_lcuϋ_lol_posis
(
PDa
 
p
, 
glm
::
vec2
* 
s
, glm::vec2* 
out_posis
);

226 
GameAiJou
* 
gamee_ai
(
GameS
* 
e
, 
Dei
 
ai
, 
Memy
* 
mp_memy
);

228 
gamee_tup
(
GameS
* 
e
);

229 
gamee_umb
(
GameS
* 
e
);

230 
gamee_exude_lurkg_wls
(
GameS
* 
e
);

	@GamestateAI.h

1 #agm



3 
	twd
;

5 
mea
 
	gGameeAI


7 
	sGamee


9 
	gw
;

10 
	gh
;

11 
	gnum_es
;

12 
bo
* 
	ghizڏl_wls
;

13 
bo
* 
	gvtil_wls
;

14 
	gmou_rg
;

17 
	gme
<
tyme
 
	gsize_t
>

18 
exnd
(
Gamee
 
e
, cڡ 
put_ngth
, 
size_t
* 
put
, size_t* 
ouut
)

21 
	gi
 = 0; i < 
	gput_ngth
; i++)

26 
	gi
 = 0; i < 
	gput_ngth
; i++)

31 
	gi
 = 0; i < 
	gput_ngth
;i++)

36 
	gi
 = 0; i < 
	gput_ngth
; i++)

	@GenericUtil.h

1 #agm



3 
	gme
 <
tyme
 
	gEmt
>

4 
	$fd_emt
(
Emt
* 
li
, Em
ek
, 
ngth
)

6 
i
 = 0; i < 
ngth
; i++)

7 i(
li
[
i
] =
ek
)

8  
i
;

10 
	}
}

	@Grid.cpp

1 
	~"Mh.h
"

3 
IPa
 
	$mh_grid_move_dei
(
IPa
 
pos
, IPa 
move
, IPa 
dimsis
)

5 
x
 = 
pos
.x + 
move
.x;

6 
y
 = 
pos
.y + 
move
.y;

7 i(
x
 >
dimsis
.x)

8 
x
 = 
dimsis
.x - 1;

9 i(
y
 >
dimsis
.y)

10 
y
 = 
dimsis
.y - 1;

11 i(
x
 < 0)

12 
x
 = 0;

13 i(
y
 < 0)

14 
y
 = 0;

15  
	`mh_a_
(
x
, 
y
);

16 
	}
}

17 
IPa
 
	$mh_grid_move_dei
(
xS
, 
yS
, 
xMove
, 
yMove
, 
w
, 
h
)

19 
x
 = 
xS
 + 
xMove
;

20 
y
 = 
yS
 + 
yMove
;

21 i(
x
 >
w
)

22 
x
 = 
w
 - 1;

23 i(
y
 >
h
)

24 
y
 = 
h
 - 1;

25 i(
x
 < 0)

26 
x
 = 0;

27 i(
y
 < 0)

28 
y
 = 0;

29  
	`mh_a_
(
x
, 
y
);

30 
	}
}

31 
IPa
 
	$mh_grid_move_dei_wed
(
IPa
 
pos
, IPa 
move
, IPa 
dimsis
)

33 
x
 = 
pos
.x + 
move
.x;

34 
y
 = 
pos
.y + 
move
.y;

35 
x
 = x % 
dimsis
.x;

36 
y
 = y % 
dimsis
.y;

37 i(
x
 < 0)

38 
x
 +
dimsis
.x;

39 i(
y
 < 0)

40 
y
 +
dimsis
.y;

41  
	`mh_a_
(
x
, 
y
);

42 
	}
}

43 
IPa
 
	$mh_grid_move_dei_wed
(
xS
, 
yS
, 
xMove
, 
yMove
, 
w
, 
h
)

45 
x
 = 
xS
 + 
xMove
;

46 
y
 = 
yS
 + 
yMove
;

47 
x
 = x % 
w
;

48 
y
 = y % y;

49 i(
x
 < 0)

50 
x
 +
w
;

51 i(
y
 < 0)

52 
y
 +
h
;

53  
	`mh_a_
(
x
, 
y
);

54 
	}
}

	@HelperGL.cpp

1 
	~"HrGL.h
"

3 
	$gl_ge_d_bd_VAO
(
GLut
* 
loti
)

5 
	`glGVxAays
(1, 
loti
);

6 
	`glBdVxAay
(*
loti
);

7 
	}
}

9 
	$gl_tup_deus
()

12 
	}
}

14 
	$gl_tup_t_vx
(
GLut
* 
bufr
, GLu
gl_ib_loti
, 
ve_size
, 
max_bufr_ngth
)

16 i(
ve_size
 <= 0 || vector_size > 4)

18 
	`ash_r
("cܻly cd gl_tup_vx wh ve sizo" + 
ve_size
);

20 
	`glGBufrs
(1, 
bufr
);

21 
	`glBdBufr
(
GL_ARRAY_BUFFER
, *
bufr
);

22 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (* 
ve_size
 * 
max_bufr_ngth
, 
NULL
, 
GL_DYNAMIC_DRAW
);

24 
	`glVxAribPor
(
gl_ib_loti
, 
ve_size
, 
GL_FLOAT
, 
l
, vector_size * (), (*)0);

25 
	`glEbVxAribAay
(
gl_ib_loti
);

26 
	`glVxAribDivis
(
gl_ib_loti
, 1);

27 
	}
}

29 
	$gl_tup_t_vx
(
GLut
* 
bufr
, GLu
gl_ib_loti
, 
ve_size
, 
max_bufr_ngth
)

31 i(
ve_size
 <= 0 || vector_size > 4)

33 
	`ash_r
("cܻly cd gl_tup_vx wh ve sizo" + 
ve_size
);

35 
	`glGBufrs
(1, 
bufr
);

36 
	`glBdBufr
(
GL_ARRAY_BUFFER
, *
bufr
);

37 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (* 
ve_size
 * 
max_bufr_ngth
, 
NULL
, 
GL_DYNAMIC_DRAW
);

39 
	`glVxAribPor
(
gl_ib_loti
, 
ve_size
, 
GL_FLOAT
, 
l
, vector_size * (), (*)0);

40 
	`glEbVxAribAay
(
gl_ib_loti
);

41 
	`glVxAribDivis
(
gl_ib_loti
, 1);

42 
	}
}

44 
	$gl_check_r
(cڡ * 
fame
, 
le
)

46 
r_check
 = 
	`glGE
();

47 i(
r_check
 != 0)

48 
d
::
cout
 << "whavodudݒGL ole" << 
le
 << " , if" << 
fame
 << "bcheck iout." << 
r_check
 << std::
dl
;

49 
	}
}

	@HelperGL.h

1 #agm



3 
	~"Cڡts.h
"

4 
	~<gd\gd.h
>

5 
	~"Memy.h
"

6 
	~"glm/glm.h
"

8 
gl_ge_d_bd_VAO
(
GLut
* 
loti
);

10 
gl_tup_deus
();

11 
gl_tup_t_vx
(
GLut
* 
bufr
, GLu
gl_ib_loti
, 
ve_size
, 
max_bufr_ngth
);

12 
gl_tup_t_vx
(
GLut
* 
bufr
, GLu
gl_ib_loti
, 
ve_size
, 
max_bufr_ngth
);

13 
	#CHK
 d{
	`gl_check_r
(
__FILE__
,
__LINE__
);} 0);

	)

15 
gl_check_r
(cڡ * 
fame
, 
le
);

	@IntPair.cpp

1 
	~"Mh.h
"

3 
Dei
 
	$dei_v
(
Dei
 
d
)

5 i(
d
 =
Dei
::
U
)

6  
Dei
::
D
;

7 i(
d
 =
Dei
::
L
)

8  
Dei
::
R
;

9 i(
d
 =
Dei
::
D
)

10  
Dei
::
U
;

11 i(
d
 =
Dei
::
R
)

12  
Dei
::
L
;

13  
d
;

14 
	}
}

16 
Dei
 
	$dei_r٩e_ockwi
(
Dei
 
d
) {

17 i(
d
 >
NO_DIRECTION
)

18  
d
;

19  (
Dei
)((()
d
 + 1) % 4);

20 
	}
}

22 
Dei
 
	$dei_r٩e_ti
(
Dei
 
d
)

24 i(
d
 =
Dei
::
U
)

25  
Dei
::
L
;

26 i(
d
 =
Dei
::
L
)

27  
Dei
::
D
;

28 i(
d
 =
Dei
::
D
)

29  
Dei
::
R
;

30 i(
d
 =
Dei
::
R
)

31  
Dei
::
U
;

32  
d
;

33 
	}
}

35 
IPa
 
	$mh_a_
(
x
, 
y
)

37 
IPa
 
su
;

38 
su
.
x
 = x;

39 
su
.
y
 = y;

40  
su
;

41 
	}
}

42 
IPa
 
	$mh_a_add
(
IPa
 

, IPa 
right
)

44 
IPa
 
su
;

45 
su
.
x
 = 

.x + 
right
.x;

46 
su
.
y
 = 

.y + 
right
.y;

47  
su
;

48 
	}
}

49 
IPa
 
	$mh_a_sub
(
IPa
 

, IPa 
right
)

51 
IPa
 
su
;

52 
su
.
x
 = 

.x - 
right
.x;

53 
su
.
y
 = 

.y - 
right
.y;

54  
su
;

55 
	}
}

57 
bo
 
	$mh_a_eq
(
IPa
 

, IPa 
right
)

59  

.
x
 =
right
.x &&e.
y
 ==ight.y;

60 
	}
}

	@MainHelpers.h

1 #agm



2 
	~<crg
>

3 
	~"GameS.h
"

4 
	~"Mh.h
"

5 
	~"Shad.h
"

6 
	~"Ed.h
"

7 
	~<ioam
>

8 
	~"Resour.h
"

9 
	~<SDL.h
>

10 
	~"Click.h
"

11 
	~"TrueFtCha.h
"

12 
	~<2bud.h
>

13 
	~"P.h
"

14 
	~"Wld.h
"

15 
	~"Animi.h
"

16 
	~"TextDw.h
"

17 
	~"HrGL.h
"

18 
	~"dw.h
"

19 #ud
FT_FREETYPE_H


23 
	sPyS


25 
GameeTimeMache
* 
	mtimeMache
;

26 
GameeTimeMache
* 
	mtimeMache_ed
;

27 
IPa
 
	mloc
;

28 
IPa
 
	mloc_ed
;

29 
	mgame_me_ngth
;

30 
	mgame_me
[
GAME_LEVEL_NAME_MAX_SIZE
];

31 
	med_posi__time_mache
;

36 
	sGamereDwInfo
 {

37 
	mglm
::
vec4
* 
o_s_u
;

38 
	mglm
::
vec3
* 
o_posis_u
;

39 * 
	mo_tٮ_dwn
;

40 
	mglm
::
vec4
* 
o_s_mr
;

41 
	mglm
::
vec4
* 
p_s_u
;

42 
	mglm
::
vec3
* 
p_posis_u
;

43 * 
	mp_tٮ_dwn
;

44 
	mglm
::
vec4
* 
p_s_mr
;

56 
GameSCama
 
mh_ma_bud_f_gamee
(
GameS
* 
gamee
, 
IPa
 
posi
, 
VwPtCama
 
vwpt
, 
x_ddg
 = 4, 
y_ddg
 = 3);

61 
ke_ay_ai
(
GameeTimeMache
* 
maybe_time_mache
, 
IPa
 
dw_posi
, 
EdUIS
* 
ui_e
, 
Dei
 
ai
, 
Memy
* 
v_memy
, Memy* 
ame_memy
, Memy* 
imi_memy
);

64 
bo
 
MaybeAlyBrush
(
GameeBrush
* 
ˋ
, 
cutBrush
, 
EdUIS
* 
ui_e
, 
TimeMacheEd
* 
timeMache
, 
glm
::
vec2
 
mouGamePos
);

65 
bo
 
MaybeAlyBrushInPyMode
(
Memy
* 
memy
, 
GameeBrush
* 
ˋ
, 
cut_brush
, 
EdUIS
* 
ui_e
, 
GameeTimeMache
* 
time_mache
, 
IPa
 
cut_e_pos
, 
glm
::
vec2
 
mouGamePos
);

69 
AABB
 
lcuϋ_oue_om__fo
(
Memy
* 
ame_memy
, 
TimeMacheEd
* 
timeMache
, 
EdUIS
 
ui_e
);

70 
AABB
 
lcuϋ_oue_posi_om_dg_fo
(
Memy
* 
ame_memy
,

71 
TimeMacheEd
* 
timeMache
,

72 
EdUIS
 
ui_e
,

73 
glm
::
vec2
 
dggg_t_posi__gamea
);

74 
AABB
 
lcuϋ_oue_om_move_fo
(
Memy
* 
ame_memy
, 
TimeMacheEd
* 
timeMache
, 
EdUIS
 
ui_e
);

	@Math.h

1 #agm



3 
	~"Memy.h
"

4 
	~"glm/glm.h
"

5 
	~"glm/gtc/mrix_sfm.h
"

10 
	sGameSCama


12 
	m
;

13 
	mright
;

14 
	mup
;

15 
	mdown
;

16 
	moPot
;

17 
	mrPot
;

21 
	sVwPtCama


23 
	m
;

24 
	mright
;

25 
	mup
;

26 
	mdown
;

28 
	sIPa


30 
	mx
;

31 
	my
;

33 
	eDei
 {

34 
	mU
, 
	mR
, 
	mD
, 
	mL
, 
	mNO_DIRECTION
, 
	mDIRECTION_COUNT


36 
Dei
 
dei_v
(Dei 
d
);

37 
Dei
 
dei_r٩e_ockwi
(Dei 
d
);

38 
Dei
 
dei_r٩e_ti
(Dei 
d
);

39 
IPa
 
mh_a_
(
x
, 
y
);

40 
IPa
 
mh_a_add
(IPa 

, IPa 
right
);

41 
IPa
 
mh_a_sub
(IPa 

, IPa 
right
);

42 
bo
 
mh_a_eq
(
IPa
 

, IPa 
right
);

44 
ma_tio
(
VwPtCama
 
vwpt
);

45 
	gglm
::
m4
 
ma_make_mrix
(
GameSCama
 
ma
);

46 
GameSCama
 
mh_ma_move_towds_˽
(GameSCam
movg
, GameSCam
gl
, 
cut_time
, 
gl_time
);

47 
GameSCama
 
mh_ma_bud
(
ma_height
, 
sn__x
, 
sn__y
, 
VwPtCama
 
vwpt
);

48 
mh_pixa_to_gamea_muɝlr
(
VwPtCama
 
vw
, 
gameHeight
);

49 
mh_gamea_to_pixa_muɝlr
(
VwPtCama
 
vw
, 
gameHeight
);

50 
	gglm
::
vec2
 
mh_sna_to_pixa
(
IPa
 
snSPosi
, 
GameSCama
 
ma
, 
VwPtCama
 
vw
, 
gameHeight
);

51 
	gglm
::
vec2
 
mh_pixa_to_sna
(
IPa
 
pixSPosi
, 
GameSCama
 
ma
, 
VwPtCama
 
vw
, 
gameHeight
);

52 
	gglm
::
vec2
 
mh_sna_to_gamea
(
IPa
 
snSPosi
, 
GameSCama
 
ma
, 
VwPtCama
 
vw
, 
gameHeight
);

57 
	gglm
::
m4
 
mh_ed_mrix
(
glm
::
vec3
 
e
);

58 
	gglm
::
m4
 
mh_ed_sd_mrix
(
glm
::
vec3
 
e
, glm::vec3 
s
);

63 
	eSide


65 
	mS_RIGHT
,

66 
	mS_DOWN
,

67 
	mS_LEFT
,

68 
	mS_UP
,

69 
	mS_COUNT


72 
IPa
 
mh_side_to_dei
(
Side
 
s
);

73 
Side
 
mh_side_pose
(Sid
s
);

74 
Side
 
mh_dei_to_side
(
IPa
 

);

79 
IPa
 
mh_grid_move_dei
(IPa 
pos
, IPa 
move
, IPa 
dimsis
);

80 
IPa
 
mh_grid_move_dei
(
xS
, 
yS
, 
xMove
, 
yMove
, 
w
, 
h
);

81 
IPa
 
mh_grid_move_dei_wed
(IPa 
pos
, IPa 
move
, IPa 
dimsis
);

82 
IPa
 
mh_grid_move_dei_wed
(
xS
, 
yS
, 
xMove
, 
yMove
, 
w
, 
h
);

84 
bo
* 
mh_grid_wk_adja
(
Memy
* 
su_memy
, Memy* 
mp_memy
, * 
put_grid
, 
t_x
, 
t_y
, 
w
, 
h
);

85 
bo
* 
mh_grid_wk_adja_wed
(
Memy
* 
su_memy
, Memy* 
mp_memy
, * 
put_grid
, 
t_x
, 
t_y
, 
w
, 
h
);

90 
	sAABB


92 
	mx
;

93 
	my
;

94 
	mw
;

95 
	mh
;

98 
AABB
 
mh_AABB_
(
x
, 
y
, 
width
, 
height
);

99 
AABB
 
mh_AABB__t
(
x
, 
y
, 
width
, 
height
);

100 
mh_ick_is_side_AABB_li
(
ickX
, 
ickY
, 
AABB
* 
boxes
, 
tٮ_boxes
);

102 
bo
 
mh_AABB_is_clidg
(
AABB
 

, AABB* 
aga_y
, 
ngth
);

103 
mh_AABB_bak_to_bds
(
AABB
 
box
, AABB* 
ouut
, 
bd_size
);

105 
le
 
bo
 
	$mh_ick_is_side_AABB
(
ickX
, 
ickY
, 
AABB
 
box
)

107  
ickX
 >
box
.
x
 && clickX < (box.x + box.
w
&& 
ickY
 >box.
y
 && clickY < (box.y + box.
h
);

108 
	}
}

109 
le
 
	$r_bwn_two_pots
(
pot
, 
mi
, 
maxi
)

111  (
pot
 - 
mi
/ (
maxi
 - mini);

112 
	}
}

113 
le
 
bo
 
	$mh_ick_is_side_AABB
(

, 
btom
, 
right
, 
t
, 
ickX
, 
ickY
)

115  
ickX
 >

 && clickX < 
right
 && 
ickY
 >
btom
 && clickY < 
t
;

116 
	}
}

117 
le
 
bo
 
	$mh_ick_is_side_AABB
(
IPa
 
mi
, IPa 
maxi
, IPa 
ick
)

119  
ick
.
x
 >
mi
.x && click.x <
maxi
.x && click.
y
 >= mini.y && click.y <= maxi.y;

120 
	}
}

133 
le
 
	$f2D
(
x
, 
y
, 
w
, 
h
)

135  
y
 + 
x
 * 
h
;

136 
	}
}

139 
le
 
IPa
 
	$t2D
(
i
, 
w
, 
h
)

141 
IPa
 
su
;

142 
su
.
x
 = 
i
 / 
h
;

143 
su
.
y
 = 
i
 % 
h
;

144  
su
;

145 
	}
}

147 
le
 
bo
 
	$mh_wh_grid
(
x
, 
y
, 
w
, 
h
)

149  
x
 >0 && 
y
 >0 && x < 
w
 && y < 
h
;

150 
	}
}

153 
le
 
	$˽f
(

, 
right
, 
t
)

155  

 * (1.0- 
t
+ 
right
 *;

156 
	}
}

157 
le
 
	$ampf
(
m
, 
max
, 
v
)

159 i(
v
 < 
m
)

160  
m
;

161 i(
v
 > 
max
)

162  
max
;

163  
v
;

164 
	}
}

165 
le
 
	$maxf
(
x
, 
y
) {

166 i(
x
 < 
y
)

167  
y
;

168  
x
;

169 
	}
}

170 
le
 
	$mf
(
x
, 
y
)

172 i(
x
 < 
y
)

173  
x
;

174  
y
;

175 
	}
}

176 
le
 
	$maxi
(
x
, 
y
)

178 i(
x
 >
y
)

179  
x
;

180  
y
;

181 
	}
}

182 
le
 
	$mi
(
x
, 
y
)

184 i(
x
 <
y
)

185  
x
;

186  
y
;

187 
	}
}

189 
le
 
	$sign
(
x
)

191 i(
x
 > 0)

193 i(
x
 < 0)

196 
	}
}

	@Maths.h

1 #agm



3 
	svec2


5 
	mx
;

6 
	my
;

9 
	svec3


11 
	mx
;

12 
	my
;

13 
	mz
;

16 
	svec4


18 
	mx
;

19 
	my
;

20 
	mz
;

21 
	mw
;

	@Memory.cpp

1 
	~<dlib.h
>

2 
	~<ioam
>

3 
	~"Cڡts.h
"

4 cڡ 
	gignBoundy
 = 8;

6 
	sMemy


8 
	mcutOfft
;

9 
	msize
;

10 * 
	mmemyS
;

13 * 
	$memy_loc
(
Memy
* 
memy
, 
numBys
)

15 
bysToAddToMemyToCڣrveAlignmt
 = (
ignBoundy
 - (
numBys
 %lignBoundary)) %lignBoundary;

16 
fBys
 = 
numBys
 + 
bysToAddToMemyToCڣrveAlignmt
;

19 i(
fBys
 + 
memy
->
cutOfft
 >memy->
size
)

21 
	`ash_r
("we have overflowed our memory. Rats!");

22  
nuαr
;

24 * 
su
 = (*(((*
memy
->
memyS
+ memy->
cutOfft
);

25 
memy
->
cutOfft
 +
fBys
;

26  
su
;

27 
	}
}

28 
	$memy_r
(
Memy
* 
memy
)

30 
memy
->
cutOfft
 = 0;

31 
	}
}

32 
Memy
* 
	$memy_
(
numBys
)

34 
size
 = (
Memy
);

35 
Memy
* 
memy
 = (Memy*
	`mloc
(
size
);

36 
memy
->
cutOfft
 = 0;

37 
memy
->
size
 = 
numBys
;

38 
memy
->
memyS
 = 
	`mloc
(
numBys
);

39  
memy
;

40 
	}
}

42 
	$memy_p_ack
(
Memy
* 
memy
, * 
por
)

45 * 
r_ce
 = (*
memy
->
memyS
;

46 * 
r_bigg
 = (*
por
;

47 
di
 = ((
r_bigg
 - 
r_ce
);

48 
su
 = (
di
;

49 
memy
->
cutOfft
 -
di
;

50 
	}
}

	@Memory.h

1 #agm



3 
	gMemy
;

8 
	gme
<
ass
 
	gT
>

9 
T
* 
	$mem_loc
(
Memy
* 
memy
, 
num_emts
)

11  (
T
*)
	`memy_loc
(
memy
, (T* 
num_emts
);

12 
	}
}

14 * 
memy_loc
(
Memy
* 
memy
, 
numBys
);

15 
memy_r
(
Memy
* 
memy
);

16 
memy_deroy_nihe_ge_n_ev_the_por_wl_ma
(
Memy
* 
memy
);

17 
memy_p_ack
(
Memy
*, * 
pot_to_r
);

18 
Memy
* 
memy_
(
numBys
);

20 
	gSckMemy
;

22 * 
memy_ack_loc
(
SckMemy
* 
memy
, 
num_bys
);

	@MenuScene.h

1 #agm



2 
	~<rg
>

3 
	~"Memy.h
"

4 
	~"TextDw.h
"

5 (*
	gBuClback
)();

7 
	sMuText


9 
GameSCama
 
	mdw_
;

10 * 
	mxt
;

12 
	sMuBu


14 
GameSCama
 
	mdw_
;

15 * 
	mbu_xt
;

16 
BuClback
 
	mback
;

18 
	sMuS


20 
	mnum_bus
;

21 
	mcut_highlighd_bu
;

22 
MuBu
* 
	mbus
;

26 * 
	$ch_loc
(
Memy
* 
memy
, 
d
::
rg
 
to_loc
)

28 
ngth
 = 
to_loc
.
	`ngth
() + 1;

29 * 
su
 = (*
	`memy_loc
(
memy
, (* 
ngth
);

30 
i
 = 0; i < 
to_loc
.
	`ngth
(); i++)

31 
su
[
i
] = 
to_loc
[i];

32 
su
[
to_loc
.
	`ngth
()] = 
NULL
;

33  
su
;

34 
	}
}

35 
MuS
* 
	$tup_ma_mu
(
Memy
* 
mu_memy
, 
BuClback
 
w_game
, BuClback 
ctue_game
, BuClback 
v_ed
)

37 
	`memy_r
(
mu_memy
);

39 
MuS
* 
su
 = (MuS*
	`memy_loc
(
mu_memy
, (MenuScene));

40 
su
->
num_bus
 = 3;

41 
su
->
cut_highlighd_bu
 = 1;

42 
su
->
bus
 = (
MuBu
*
	`memy_loc
(
mu_memy
, (MenuButton) * 3);

43 * 
f
 = 
	`ch_loc
(
mu_memy
, "New Game");

44 
su
->
bus
[0].
bu_xt
 = 
f
;

45 
su
->
bus
[1].
bu_xt
 = 
	`ch_loc
(
mu_memy
,"Continuey");

46 
su
->
bus
[2].
bu_xt
 = 
	`ch_loc
(
mu_memy
,"Level Editor");

47 
su
->
bus
[0].
back
 = 
w_game
;

48 
su
->
bus
[1].
back
 = 
ctue_game
;

49 
su
->
bus
[2].
back
 = 
v_ed
;

51  
su
;

52 
	}
}

	@Parse.cpp

1 
	~"P.h
"

2 
	~<ioam
>

3 #ifde
EMSCRIPTEN


4 
	#rtf_s
(
gs1
,
gs2
,...
	`rtf
rgs1,
__VA_ARGS__
)

	)

6 
	$di_to_ch
(cڡ * 
pos
, cڡ 
mch
)

8 
i
 = 0;

9 ; 
pos
[0] !
mch
 ||os[0] == '\0';os++)

11 
i
++;

13  
i
;

14 
	}
}

16 
	$r_numb
(cڡ * 
pos
)

18 
su
 = 0;

19 ; 
pos
[0] >= '0' &&os[0] <= '9';os++)

21 
su
 *= 10;

22 
to_add
 = 
pos
[0] - '0';

23 
su
 +
to_add
;

25  
su
;

26 
	}
}

27 
bo
 
	$r_rgs_mch
(cڡ * 
pos
, cڡ * 
mch
, 
max_ngth
)

29 
i
 = 0; i < 
max_ngth
; i++, 
pos
++, 
mch
++)

31 i(
pos
[0] !
mch
[0])

32  
l
;

34  
ue
;

35 
	}
}

37 
	$to_num
(
c
)

39  
c
 - '0';

40 
	}
}

42 
bo
 
	$is_num_nzo
(
c
)

44  
c
 >= '1' && c <= '9';

45 
	}
}

47 
bo
 
	$is_num
(
c
)

49  
c
 >= '0' && c <= '9';

50 
	}
}

52 
bo
 
	$is_whea
(
c
)

54  
c
 == ' ' || c == '\t' || c == '\n' || c == '\v' || c == '\f' || c == '\r';

55 
	}
}

57 * 
	$y_r_numb
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
)

59 * 
su
 = (*)
	`memy_loc
(
mp_memy
, ());

60 * 
_
 = 
t
->

;

61 i(
t
->

[0] == '0')

63 
t
->

++;

64 *
su
 = 0;

65  
su
;

67 
bo
 
give_numb
 = 
l
;

68 i(
t
->

[0] == '-')

70 
t
->

++;

71 
give_numb
 = 
ue
;

73 i(
	`is_num_nzo
(
t
->

[0]))

75 
num
 = 
	`to_num
(
t
->

[0]);

76 
t
->

++;

77 
	`is_num
(
t
->

[0]))

79 
num
 *= 10;

80 
num
 +
	`to_num
(
t
->

[0]);

81 
t
->

++;

83 *
su
 = 
num
;

84 i(
give_numb
)

85 *
su
 = -(*result);

86  
su
;

89 
t
->

 = 
_
;

90  
NULL
;

91 
	}
}

93 
bo
 
	$y_r_rg
(
Tokiz
* 
t
, cڡ * 
me
)

95 * 
_su
 = 
t
->

;

97 
t
->

[0] && 
me
[0])

99 i(
t
->

[0] !
me
[0])

101 
t
->

 = 
_su
;

102  
l
;

104 
t
->

++;

105 
me
++;

108 i(
t
->

[0])

110  
ue
;

114 
t
->

 = 
_su
;

115  
l
;

117 
	}
}

119 
bo
 
	$y_r_ch
(
Tokiz
* 
t
, 
c
)

121 i(
t
->

[0] =
c
)

123 
t
->

++;

124  
ue
;

126  
l
;

127 
	}
}

129 * 
	$y_r_numb_ch_
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
, 
c
)

131 * 
_
 = 
t
->

;

132 * 
su
 = 
	`y_r_numb
(
t
, 
mp_memy
);

133 
bo
 
ch_a
 = 
	`y_r_ch
(
t
, 
c
);

134 i(
ch_a
 && 
su
)

136  
su
;

138 
t
->

 = 
_
;

139  
NULL
;

141 
	}
}

142 * 
	$y_r_numb_comma_
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
)

144 * 
_
 = 
t
->

;

145 * 
su
 = 
	`y_r_numb
(
t
, 
mp_memy
);

146 
bo
 
comma_a
 = 
	`y_r_ch
(
t
, ',');

147 i(
comma_a
 && 
su
)

149  
su
;

151 
t
->

 = 
_
;

152  
NULL
;

154 
	}
}

155 * 
	$y_r_numb_dash_
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
)

157 * 
_
 = 
t
->

;

158 * 
su
 = 
	`y_r_numb
(
t
, 
mp_memy
);

159 
bo
 
comma_a
 = 
	`y_r_ch
(
t
, '_');

160 i(
comma_a
 && 
su
)

162  
su
;

164 
t
->

 = 
_
;

165  
NULL
;

167 
	}
}

168 
FloDa
* 
	$y_r_o_da
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
)

171 * 
_
 = 
t
->

;

172 
FloDa
* 
su
 = (FloDa*
	`memy_loc
(
mp_memy
, (FloorData));

173 
num_v
 = 0;

174 * 
f
 = 
	`y_r_numb_ch_
(
t
, 
mp_memy
,'-');

175 * 
cd
 = 
	`y_r_numb_ch_
(
t
, 
mp_memy
,'-');

176 * 
thd
 = 
	`y_r_numb
(
t
, 
mp_memy
);

177 i(!
f
 || !
cd
 || !
thd
)

179 
t
->

 = 
_
;

180  
NULL
;

182 
su
->
p܋r_id
 = *
f
;

183 
su
->
p܋r_rg_sque
.
x
 = *
cd
;

184 
su
->
p܋r_rg_sque
.
y
 = *
thd
;

186 
bo
 
found_comma
 = 
	`y_r_ch
(
t
, ',');

187 i(!
found_comma
)

189 
	`ash_r
("parsing floor datarror with comma");

191  
su
;

192 
	}
}

193 
PDa
* 
	$y_r_p_da
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
)

195 * 
_
 = 
t
->

;

196 
PDa
* 
su
 = (PDa*
	`memy_loc
(
mp_memy
, (PieceData));

197 
num_v
 = 0;

198 * 
xt_v
 = 
	`y_r_numb_dash_
(
t
, 
mp_memy
);

199 i(!
xt_v
)

201 
t
->

 = 
_
;

202  
NULL
;

204 
xt_v
)

206 
su
->
pows
[
num_v
] = *
xt_v
;

207 
xt_v
 = 
	`y_r_numb_dash_
(
t
, 
mp_memy
);

208 
num_v
++;

210 
bo
 
found_comma
 = 
	`y_r_ch
(
t
, ',');

211 i(!
found_comma
)

213 
	`ash_r
("parsingiece datarror with comma");

215  
su
;

217 
	}
}

218 
	$csume_whea
(
Tokiz
* 
t
)

220 
	`is_whea
(
t
->

[0]))

221 
t
->

++;

222 
	}
}

224 * 
	$y_r_cut_v
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
)

226 * 
_
 = 
t
->

;

227 
bo
 
r_fished
 = 
l
;

228 
bo
 
found_num_gamees
 = 
	`y_r_rg
(
t
, "current_level:");

229 i(
found_num_gamees
)

231 * 
maybe_num
 = 
	`y_r_numb
(
t
, 
mp_memy
);

232 
	`y_r_ch
(
t
, ';');

233 i(
maybe_num
)

235  
maybe_num
;

239 
	`ash_r
("we failedoarsehe currentevel value, when we'dlready foundhe current_levelag, uh oh.");

242 
t
->

 = 
_
;

243  
NULL
;

244 
	}
}

245 * 
	$y_r_num_gamees
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
)

247 * 
_
 = 
t
->

;

249 
bo
 
r_fished
 = 
l
;

251 
bo
 
found_num_gamees
 = 
	`y_r_rg
(
t
, "num_gamestates:");

252 i(
found_num_gamees
)

254 * 
maybe_num
 = 
	`y_r_numb
(
t
, 
mp_memy
);

255 
	`y_r_ch
(
t
, ';');

256 i(
maybe_num
)

258  
maybe_num
;

262 
d
::
cout
 << "Faedػadumb ogameenumb. Oho! Washgow,hii bad." << std::
dl
;

263 
	`abt
();

267 
t
->

 = 
_
;

268  
NULL
;

270 
	}
}

272 
bo
 
	$y_r_posis
(
Tokiz
* 
t
, 
IPa
 * 
su
, 
Memy
* 
mp_memy
)

274 * 
_
 = 
t
->

;

275 
bo
 
found_posis
 = 
	`y_r_rg
(
t
, "positions:");

276 i(
found_posis
)

278 
bo
 
ached_d
 = 
	`y_r_ch
(
t
, ';');

279 
num_posis_rd
 = 0;

280 !
ached_d
)

282 * 
xtW
 = 
	`y_r_numb_comma_
(
t
, 
mp_memy
);

283 * 
xtH
 = 
	`y_r_numb_comma_
(
t
, 
mp_memy
);

285 i(!
xtW
 || !
xtH
)

287 
d
::
cout
 << "okay. Okay. Wow. Ouposiڇay ifmd. Somhg gڐwrg. Bash." << std::
dl
;

288 
	`abt
();

290 
su
[
num_posis_rd
].
x
 = *
xtW
;

291 
su
[
num_posis_rd
].
y
 = *
xtH
;

292 
num_posis_rd
++;

294 
ached_d
 = 
	`y_r_ch
(
t
, ';');

296  
ue
;

298 
t
->

 = 
_
;

299  
l
;

301 
	}
}

303 
bo
 
	$y_r_vsi
(
Tokiz
* 
t
, * 
vsi_su
, 
IPa
* 
su
, 
Memy
* 
mp_memy
)

305 
Tokiz
 
_su
 = *
t
;

306 
bo
 
some_v
 = 
	`y_r_rg
(
t
, "version:");

308 i(!
some_v
)

310 *
vsi_su
 = 0;

311 *
t
 = 
_su
;

312  
l
;

314 * 
maybe_vsi_numb
 = 
	`y_r_numb
(
t
, 
mp_memy
);

315 i(
maybe_vsi_numb
 =
NULL
)

317 
	`ash_r
("uh oh, we'vencountered 'version:'ag buthere iso versionumberttached! ");

319 
vsi_numb
 = *
maybe_vsi_numb
;

320 
bo
 
suced
 = 
	`y_r_ch
(
t
, ';');

321 i(!
suced
)

323 
	`ash_r
("uh oh, weriedoarse ';'o head intoheext section.hat didn't work.");

325  
vsi_numb
;

327 
	}
}

329 
bo
 
	$y_r_o_da
(
Tokiz
* 
t
, 
GameS
** 
su
, 
Memy
* 
f_memy
, Memy* 
mp_memy
)

332 * 
_
 = 
t
->

;

333 
bo
 
found_o_da
 = 
	`y_r_rg
(
t
, "floor_data:");

334 i(
found_o_da
)

337 
num_gamees
 = 0;

338 !
	`y_r_ch
(
t
, ';'))

340 * 
wp
 = 
	`y_r_numb_comma_
(
t
, 
mp_memy
);

341 * 
hp
 = 
	`y_r_numb_comma_
(
t
, 
mp_memy
);

342 i(!
wp
 || !
hp
)

344 
d
::
cout
 << "o_dy faed orsg w h." << std::
dl
;

345 
	`abt
();

347 
w
 = *
wp
;

348 
h
 = *
hp
;

349 
n
 = 
w
 * 
h
;

350 i(
su
[
num_gamees
] =
NULL
)

351 
su
[
num_gamees
] = 
	`gamee_
(
f_memy
, 
w
, 
h
);

352 
i
 = 0; i < 
n
; i++)

354 
FloDa
* 
xtf
 = 
	`y_r_o_da
(
t
, 
mp_memy
);

355 i(!
xtf
)

357 
d
::
cout
 << "r flo ded orsgumb." << std::
dl
;

358 
	`abt
();

360 
FloDa
 
xt
 = *
xtf
;

361 
su
[
num_gamees
]->
o_da
[
i
] = 
xt
;

363 
num_gamees
++;

365  
ue
;

367  
l
;

368 
	}
}

370 
bo
 
	$y_r_p_da
(
Tokiz
* 
t
, 
GameS
** 
su
, 
Memy
* 
f_memy
, Memy* 
mp_memy
)

372 * 
_
 = 
t
->

;

373 
bo
 
found_p_da
 = 
	`y_r_rg
(
t
, "piece_data:");

374 i(
found_p_da
)

377 
num_gamees
 = 0;

378 !
	`y_r_ch
(
t
, ';'))

380 * 
wp
 = 
	`y_r_numb_comma_
(
t
, 
mp_memy
);

381 * 
hp
 = 
	`y_r_numb_comma_
(
t
, 
mp_memy
);

382 i(!
wp
 || !
hp
)

384 
d
::
cout
 << "ray faed orsg w h." << std::
dl
;

385 
	`abt
();

387 
w
 = *
wp
;

388 
h
 = *
hp
;

389 
n
 = 
w
 * 
h
;

390 i(
su
[
num_gamees
] =
NULL
)

391 
su
[
num_gamees
] = 
	`gamee_
(
f_memy
, 
w
, 
h
);

392 
i
 = 0; i < 
n
; i++)

394 
PDa
* 
x
 = 
	`y_r_p_da
(
t
, 
mp_memy
);

395 i(!
x
)

397 
d
::
cout
 << "r ded orsgumb." << std::
dl
;

398 
	`abt
();

400 
PDa
 
xt
 = *
x
;

401 
su
[
num_gamees
]->
p_da
[
i
] = 
xt
;

404 
num_gamees
++;

407  
ue
;

409  
l
;

410 
	}
}

411 
bo
 
	$y_r_y
(
Tokiz
* 
t
, 
GameS
** 
su
, 
Memy
* 
f_memy
, Memy* 
mp_memy
)

413 * 
_
 = 
t
->

;

414 
bo
 
is_y_r_t
 = 
	`y_r_rg
(
t
, "layer");

415 * 
maybe_y_num
 = 
	`y_r_numb
(
t
, 
mp_memy
);

416 
bo
 
is_mic__d
 = 
	`y_r_ch
(
t
, ':');

417 i(
is_y_r_t
 && 
maybe_y_num
 && 
is_mic__d
)

420 
y_num
 = *
maybe_y_num
;

421 i(
y_num
 >
GAME_NUM_LAYERS
)

423 
d
::
cout
 << "wygwrtبyumbh ibiggh shouldxi iougame. Cshgow!" << std::
dl
;

424 
	`abt
();

428 
num_gamees
 = 0;

429 !
	`y_r_ch
(
t
, ';'))

431 * 
wp
 = 
	`y_r_numb_comma_
(
t
, 
mp_memy
);

432 * 
hp
 = 
	`y_r_numb_comma_
(
t
, 
mp_memy
);

433 i(!
wp
 || !
hp
)

435 
d
::
cout
 << "ray faed orsg w h." << std::
dl
;

436 
	`abt
();

438 
w
 = *
wp
;

439 
h
 = *
hp
;

440 
n
 = 
w
 * 
h
;

441 i(
su
[
num_gamees
] =
NULL
)

442 
su
[
num_gamees
] = 
	`gamee_
(
f_memy
, 
w
, 
h
);

443 
i
 = 0; i < 
n
; i++)

445 * 
x
 = 
	`y_r_numb_comma_
(
t
, 
mp_memy
);

446 i(!
x
)

448 
d
::
cout
 << "ray faed orsgumb." << std::
dl
;

449 
	`abt
();

451 
xt
 = *
x
;

452 * 
cut_y
 = 
	`gamee_g_y
(
su
[
num_gamees
], 
y_num
);

453 
cut_y
[
i
] = 
xt
;

456 
num_gamees
++;

458  
ue
;

461 
t
->

 = 
_
;

462  
l
;

463 
	}
}

464 
bo
 
	$y_r_bos
(
Tokiz
* 
t
, 
bo
* 
su
, 
Memy
* 
f_memy
, Memy* 
mp_memy
)

466 * 
_
 = 
t
->

;

467 
bo
 
is_me_r
 = 
	`y_r_rg
(
t
, "solved:");

468 i(!
is_me_r
)

470 
t
->

 = 
_
;

471  
l
;

473 
num_gamees
 = 0;

474 !
	`y_r_ch
(
t
, ';'))

476 * 
bo_v
 = 
	`y_r_numb
(
t
, 
mp_memy
);

477 i(!
bo_v
 || *bool_val > 1 || *bool_val < 0)

479 
	`ash_r
("weriedoarse comma seperatedist of bools, but wean into somethinghat wasn't bool");

481 
bo
 
suced
 = 
	`y_r_ch
(
t
, ',');

482 i(!
suced
)

483 
	`ash_r
("weriedoarse comma seperatedist of bools, but wean into somethinghat wasn't comma");

485 
su
[
num_gamees
] = 
bo_v
;

486 
num_gamees
++;

488  
ue
;

489 
	}
}

490 
bo
 
	$y_r_mode
(
Tokiz
* 
t
, 
LevMode
* 
su
, 
Memy
* 
f_memy
, Memy* 
mp_memy
)

492 * 
_
 = 
t
->

;

493 
bo
 
is_mode_r
 = 
	`y_r_rg
(
t
, "mode:");

494 i(!
is_mode_r
)

496 
t
->

 = 
_
;

497  
l
;

499 
num_gamees
 = 0;

500 !
	`y_r_ch
(
t
, ';'))

502 * 
v
 = 
	`y_r_numb
(
t
, 
mp_memy
);

503 
bo
 
comma_xt
 = 
	`y_r_ch
(
t
, ',');

504 i(
v
 && 
comma_xt
)

506 
su
[
num_gamees
] = (
LevMode
*
v
;

510 
	`ash_r
("uh oh, weriedoarse ourselvesumber commaair forarsing mode, we couldn't find it, ohoooooo");

512 
num_gamees
++;

514  
ue
;

516 
	}
}

517 
bo
 
	$y_r_mes
(
Tokiz
* 
t
, 
LevName
* 
su
, 
Memy
* 
f_memy
, Memy* 
mp_memy
)

519 * 
_
 = 
t
->

;

520 
bo
 
is_mes_r
 = 
	`y_r_rg
(
t
, "names:");

521 i(!
is_mes_r
)

523 
t
->

 = 
_
;

524  
l
;

528 
num_gamees
 = 0;

529 !
	`y_r_ch
(
t
, ';'))

531 
i
 = 0;

532 
t
->

[0] != ',')

534 i(
i
 >
GAME_LEVEL_NAME_MAX_SIZE
)

536 
d
::
cout
 << "r faed, we'vruaoshideous, hideouthg, we'vruaoss" << std::
dl
;

537 
	`abt
();

539 
su
[
num_gamees
].
me
[
i
] = 
t
->

[0];

540 
i
++;

541 
t
->

++;

543 ; 
i
 <
GAME_LEVEL_NAME_MAX_SIZE
; i++)

544 
su
[
num_gamees
].
me
[
i
] = '\0';

546 
t
->

++;

547 
num_gamees
++;

549  
ue
;

550 
	}
}

551 
WldS
* 
	$r_derlize_timemache
(
d
::
rg
 
put_rg
, 
Memy
* 
f_memy
, Memy* 
mp_memy
)

557 
d
::
rg
::

 
d_pos
 = std::
	`move
(
put_rg
.
	`beg
(), iut_rg.
	`d
(), '\n');

558 
put_rg
.
	`a
(
d_pos
, iut_rg.
	`d
());

561 
WldS
* 
su
 = (WldS*)
	`memy_loc
(
f_memy
, (WorldState));

562 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

564 
su
->
v_e
[
i
] = 
NULL
;

566 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

567 
j
 = 0; j < 
GAME_LEVEL_NAME_MAX_SIZE
;j++)

569 
su
->
v_mes
[
i
].
me
[
j
] = '\0';

571 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

573 
su
->
v_sved
[
i
] = 
l
;

576 * 
put
 = &(
put_rg
[0]);

577 
Tokiz
 
tokiz
;

578 
tokiz
.

 = 
put
;

580 
tokiz
.

[0] !
NULL
)

582 
	`csume_whea
(&
tokiz
);

583 * 
maybe_num_gamees
 = 
	`y_r_num_gamees
(&
tokiz
, 
mp_memy
);

584 i(
maybe_num_gamees
)

586 
su
->
num_v
 = *
maybe_num_gamees
;

589 
bo
 
rd_posis
 = 
	`y_r_posis
(&
tokiz
, 
su
->
v_posi
, 
mp_memy
);

590 
bo
 
rd_y
 = 
	`y_r_y
(&
tokiz
, 
su
->
v_e
, 
f_memy
, 
mp_memy
);

591 
bo
 
rd_p_da
 = 
	`y_r_p_da
(&
tokiz
, 
su
->
v_e
, 
f_memy
, 
mp_memy
);

592 
bo
 
rd_o_da
 = 
	`y_r_o_da
(&
tokiz
, 
su
->
v_e
, 
f_memy
, 
mp_memy
);

593 
bo
 
rd_mes
 = 
	`y_r_mes
(&
tokiz
, 
su
->
v_mes
, 
f_memy
, 
mp_memy
);

595 
bo
 
rd_v_sved
 = 
	`y_r_bos
(&
tokiz
, 
su
->
v_sved
, 
f_memy
, 
mp_memy
);

596 
bo
 
rd_v_mode
 = 
	`y_r_mode
(&
tokiz
, 
su
->
v_modes
, 
f_memy
, 
mp_memy
);

597 i(!
maybe_num_gamees
 && !
rd_posis
 && !
rd_y
 && !
rd_mes
 && !
rd_p_da
)

599 
d
::
cout
 << "uh oh, we'vedطr somhgndhrsg i'ov. Bash!" << std::
dl
;

600 
d
::
cout
 << " otokizexle:" << std::
dl
;

601 i(
tokiz
.

[0] =
NULL
)

602 
d
::
cout
 << "tuouthintokize,nd wcomy de.Huh ? Whgog oth." << std::
dl
;

604 
d
::
cout
 << 
tokiz
.

[0] << std::
dl
;

605 
d
::
cout
 << "rd_posis:" << 
rd_posis
 << std::
dl
;

606 
d
::
cout
 << "rd_y:" << 
rd_y
 << std::
dl
;

607 
d
::
cout
 << "rd_mes:" << 
rd_mes
 << std::
dl
;

608 
d
::
cout
 << "rd_posis:" << (
maybe_num_gamees
 !
NULL
<< std::
dl
;

609 
	`abt
();

612 
	`csume_whea
(&
tokiz
);

613 i(
tokiz
.

[0] =
NULL
)

614 
d
::
cout
 << "Wshould quighnow,ikighouown." << std::
dl
;

616  
su
;

617 
	}
}

619 
	$r_rlize_gamee_ys
(* 
ouut
, * 
ouut_csumed
, 
max_ouut_ngth
, 
ngth
, 
GameS
** 
es
)

621 
z
 = 0; z < 
GAME_NUM_LAYERS
; z++)

623 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, "y%i:", 
z
);

624 
i
 = 0; i < 
ngth
; i++)

626 
GameS
* 
e
 = 
es
[
i
];

629 cڡ 
w
 = 
e
->w;

630 cڡ 
h
 = 
e
->h;

631 cڡ 
y_n
 = 
w
 * 
h
;

632 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, "%d,%d", 
w
, 
h
);

633 
j
 = 0; j < 
y_n
; j++)

635 * 
cut_y
 = 
	`gamee_g_y
(
e
, 
z
);

636 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, ",%d", 
cut_y
[
j
]);

638 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, ",");

642 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, ";\n");

645 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, "piece_data:");

646 
i
 = 0; i < 
ngth
; i++)

648 
GameS
* 
e
 = 
es
[
i
];

649 cڡ 
w
 = 
e
->w;

650 cڡ 
h
 = 
e
->h;

651 cڡ 
y_n
 = 
w
 * 
h
;

652 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, "%d,%d,", 
w
, 
h
);

653 
j
 = 0; j < 
w
 * 
h
; j++)

655 
k
 = 0; k < 
CP_COUNT
; k++)

657 
to_t
 = 
e
->
p_da
[
j
].
pows
[
k
];

658 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, "%d_", 
to_t
);

660 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, ",");

663 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, ";\n");

665 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, "floor_data:");

666 
i
 = 0; i < 
ngth
; i++)

668 
GameS
* 
e
 = 
es
[
i
];

669 cڡ 
w
 = 
e
->w;

670 cڡ 
h
 = 
e
->h;

671 cڡ 
y_n
 = 
w
 * 
h
;

672 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, "%d,%d,", 
w
, 
h
);

673 
j
 = 0; j < 
w
 * 
h
; j++)

675 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, "%d-%d-%d,",

676 
e
->
o_da
[
j
].
p܋r_id
,

677 
e
->
o_da
[
j
].
p܋r_rg_sque
.
x
,

678 
e
->
o_da
[
j
].
p܋r_rg_sque
.
y


683 *
ouut_csumed
 +
	`rtf_s
(
ouut
 + *ouut_csumed, 
max_ouut_ngth
, ";\n");

684 
	}
}

685 
	gd
::
rg
 
	$r_rlize_timemache
(
WldS
* 
wld_e
, 
Memy
* 
f_memy
, Memy* 
mp_memy
)

687 cڡ 
max_ngth
 = 60000;

688 
ouut_csumed
 = 0;

689 * 
ouut
 = (*)
	`memy_loc
(
mp_memy
, (* 
max_ngth
);

690 cڡ 
num_gamees
 = 
wld_e
->
num_v
;

694 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "num_gamees:%d;\n", 
num_gamees
);

698 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "positions:");

699 
i
 = 0; i < 
num_gamees
; i++)

701 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "%d,%d,", 
wld_e
->
v_posi
[
i
].
x
, wld_e->v_posi[i].
y
);

703 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, ";\n");

706 
	`r_rlize_gamee_ys
(
ouut
, &
ouut_csumed
, 
max_ngth
, 
num_gamees
, 
wld_e
->
v_e
);

709 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "names:");

710 
i
 = 0; i < 
num_gamees
; i++)

712 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "%s,", &
wld_e
->
v_mes
[
i
].
me
);

714 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, ";\n");

718 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "solved:");

719 
i
 = 0; i < 
num_gamees
; i++)

721 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "%d,", 
wld_e
->
v_sved
[
i
]);

723 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, ";\n");

727 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "mode:");

728 
i
 = 0; i < 
num_gamees
; i++)

730 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "%d,", 
wld_e
->
v_modes
[
i
]);

732 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, ";\n");

735  
d
::
	`rg
(
ouut
);

736 
	}
}

	@Parse.h

1 #agm



2 
	~"Ed.h
"

3 
	~<rg
>

4 
	~"Memy.h
"

5 
	~<gex
>

13 
	sTokiz


15 * 
	m
;

17 
di_to_ch
(cڡ * 
pos
, cڡ 
mch
);

18 
r_numb
(cڡ * 
pos
);

19 
bo
 
r_rgs_mch
(cڡ * 
pos
, cڡ * 
mch
, 
max_ngth
);

21 
to_num
(
c
);

22 
bo
 
is_num_nzo
(
c
);

23 
bo
 
is_num
(
c
);

24 
bo
 
is_whea
(
c
);

25 * 
y_r_numb
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
);

26 
bo
 
y_r_rg
(
Tokiz
* 
t
, cڡ * 
me
);

27 
bo
 
y_r_ch
(
Tokiz
* 
t
, 
c
);

28 * 
y_r_numb_comma_
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
);

29 
csume_whea
(
Tokiz
* 
t
);

31 
bo
 
y_r_bos
(
Tokiz
* 
t
, bo* 
su
, 
Memy
* 
f_memy
, Memy* 
mp_memy
);

32 * 
y_r_cut_v
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
);

33 * 
y_r_num_gamees
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
);

34 
bo
 
y_r_posis
(
Tokiz
* 
t
, 
IPa
 * 
su
, 
Memy
* 
mp_memy
);

35 
bo
 
y_r_y
(
Tokiz
* 
t
, 
GameS
** 
su
, 
Memy
* 
f_memy
, Memy* 
mp_memy
);

36 
bo
 
y_r_mes
(
Tokiz
* 
t
, 
LevName
* 
su
, 
Memy
* 
f_memy
, Memy* 
mp_memy
);

37 
WldS
* 
r_derlize_timemache
(
d
::
rg
 
put_rg
, 
Memy
* 
f_memy
, Memy* 
mp_memy
);

39 
r_rlize_gamee_ys
(* 
ouut
, * 
ouut_csumed
, 
max_ouut_ngth
, 
ngth
, 
GameS
** 
es
);

40 
	gd
::
rg
 
r_rlize_timemache
(
WldS
* 
wld_e
, 
Memy
* 
f_memy
, Memy* 
mp_memy
);

	@ParticleSystem.h

1 #agm



2 
	~<glm\fwd.h
>

3 
	~<gd\gd.h
>

5 
	gPtieSyem
;

7 
PtieSyem
 
ie_tup
(
max_num_ies
, 
num_ies_tys
, 
glm
::
vec4
* 
code_m
, 
GLut
 
ie_xtu
);

10 
ie_dw
(
PtieSyem
 
syem
, 
nge_t
,
ngth
);

	@PreludeIncludes.h

1 #agm



3 #ifde
EMSCRIPTEN


4 
	~<emsn.h
>

5 
	~<emsn/html5.h
>

6 
	#ry_s
 
ry


	)

7 
	~<SDL_image.h
>

8 
	~<SDL_f.h
>

9 
	#GL_GLES_PROTOTYPES
 1

	)

10 
	#GL_GLEXT_PROTOTYPES
 1

	)

12 
	~<GLES3/gl3.h
>

14 
	#EM_BOOL
 
bo


	)

15 
	~<gd/gd.h
>

16 
	~"Clock.h
"

	@Regex.cpp

1 
	~"Regex.h
"

2 
	~"P.h
"

6 
bo
 
	$y_r_u_rg
(
Tokiz
* 
t
, cڡ * 
me
)

8 * 

 = 
t
->

;

9 
bo
 
de
 = 
l
;

10 
t
->

[0] != '\0')

12 
bo
 
found_rg
 = 
	`y_r_rg
(
t
, 
me
);

13 i(
found_rg
)

14  
ue
;

15 
t
->

++;

17 
t
->

 = 

;

18  
l
;

19 
	}
}

20 * 
	$y_r_u_ch
(
Tokiz
* 
t
, 
_ch
, 
Memy
* 
mp_memy
)

23 * 

 = 
t
->

;

24 
ngth
 = 1;

25 
t
->

[0] !
_ch
)

27 i(
t
->

[0] == '\0')

29 
t
-> 

 = 

;

30  
NULL
;

32 
ngth
++;

33 
t
->

++;

35 * 
su
 = (*
	`memy_loc
(
mp_memy
, (* 
ngth
);

36 
i
 = 0; i < 
ngth
 - 1; i++)

37 
su
[
i
] = 

[i];

38 
su
[
ngth
 - 1] = '\0';

39  
su
;

40 
	}
}

41 * 
	$y_r_u_numb
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
)

43 * 

 = 
t
->

;

44 
bo
 
de
 = 
l
;

45 
t
->

[0] != '\0')

47 * 
maybe_num
 = 
	`y_r_numb
(
t
,
mp_memy
);

48 i(
maybe_num
)

49  
maybe_num
;

50 
t
->

++;

52 
t
->

 = 

;

53  
NULL
;

54 
	}
}

55 
	gd
::
rg
 
	$r_bwn_ques
(
Tokiz
* 
t
, 
Memy
* 
mp_memy
)

57 * 

 = 
t
->

;

58 
bo
 
ssg
 = 
	`y_r_ch
(
t
, '"');

59 * 
su
 = 
	`y_r_u_ch
(
t
, '"',
mp_memy
);

60 i(
su
 =
NULL
)

62 
d
::
cout
 << "edطr bwques.btg." << std::
dl
;

63 
	`abt
();

65  
d
::
	`rg
(
su
);

66 
	}
}

71 
AasDa
* 
	$GAasPosi
(
Memy
* 
mp_memy
, 
d
::
rg
 
s
, 
g_s_numb_om_me
 
func_s
)

73 * 
put
 = &(
s
[0]);

74 
AasDa
* 
su
 = (AasDa*)
	`memy_loc
(
mp_memy
, (AtlasData));

75 
su
->
ngth
 = 0;

79 
Tokiz
 
ngth_tokiz
;

80 
ngth_tokiz
.

 = 
put
;

82 
bo
 
found_xt
 = 
ue
;

83 
found_xt
)

85 
found_xt
 = 
	`y_r_u_rg
(&
ngth_tokiz
, "\"filename\":");

86 i(
found_xt
)

87 
su
->
ngth
++;

93 
su
->
um_croodg_vues
 = (*)
	`memy_loc
(
mp_memy
, (*esu->
ngth
);

94 
su
->
posis
 = (
Posi
*)
	`memy_loc
(
mp_memy
, (Posi*esu->
ngth
);

95 
Tokiz
 
t
;

96 
t
.

 = 
put
;

98 
i
 = 0; i < 
su
->
ngth
; i++)

101 
bo
 
found_xt_fame
 = 
	`y_r_u_rg
(&
t
, "\"filename\": ");

102 
d
::
rg
 
qued_me
 = 
	`r_bwn_ques
(&
t
,
mp_memy
);

103 
bo
 
found_xt_ame
 = 
	`y_r_u_rg
(&
t
, "\"frame\": {");

104 * 
x
 = 
	`y_r_u_numb
(&
t
,
mp_memy
);

105 * 
y
 = 
	`y_r_u_numb
(&
t
, 
mp_memy
);

106 * 
w
 = 
	`y_r_u_numb
(&
t
, 
mp_memy
);

107 * 
h
 = 
	`y_r_u_numb
(&
t
, 
mp_memy
);

108 i(!
found_xt_fame
 || !
found_xt_ame
 || !
x
 || !
y
 || !
w
 || !
h
)

110 
d
::
cout
 << "u ioubndewextuarr, fix it." << std::
dl
;

111 
	`abt
();

115 
su
->
um_croodg_vues
[
i
] = 
	`func_s
(
qued_me
);

117 
su
->
posis
[
i
].
x
 = *x;

118 
su
->
posis
[
i
].
y
 = *y;

119 
su
->
posis
[
i
].
w
 = *w;

120 
su
->
posis
[
i
].
h
 = *h;

126 
bo
 
found_ma
 = 
	`y_r_u_rg
(&
t
, "\"meta\"");

127 
bo
 
found_size
 = 
	`y_r_u_rg
(&
t
, "\"w\":");

128 * 
xtW
 = 
	`y_r_u_numb
(&
t
,
mp_memy
);

129 * 
xtH
 = 
	`y_r_u_numb
(&
t
,
mp_memy
);

131 i(
found_ma
 && 
found_size
 && 
xtW
 && 
xtH
)

133 
su
->
maWidth
 = *
xtW
;

134 
su
->
maHeight
 = *
xtH
;

138 
d
::
cout
 << "Msed. Abtg." << std::
dl
;

139 
	`abt
();

141  
su
;

144 
	}
}

	@Regex.h

1 #agm



3 
	~"Memy.h
"

4 
	~"GameS.h
"

5 
	~<ioam
>

6 
	~"Resour.h
"

7 
	eLAYERNAMEREGEX


9 
	mLNR_FLOOR
,

10 
	mLNR_PIECE
,

11 
	mLNR_COUNT


13 
	sPosi


15 
	mx
;

16 
	my
;

17 
	mw
;

18 
	mh
;

21 
	sr


23 
	mngth
;

24 * 
	mv
;

27 
	sAasDa


29 
	mmaWidth
;

30 
	mmaHeight
;

31 
	mngth
;

32 * 
	mum_croodg_vues
;

33 
Posi
* 
	mposis
;

38 
AasDa
* 
GAasPosi
(
Memy
* 
mp_memy
, 
d
::
rg
 
s
, 
g_s_numb_om_me
 
func_s
);

	@Resource.h

1 #agm



3 
	~<rg
>

4 
	~"Memy.h
"

5 
	~"GameS.h
"

6 
	~"xtuAsts.h
"

7 (*
	tg_s_numb_om_me
(
	td
::
	trg
);

11 
xtuAsts
::
FLOOR
 
	`sour_o_to_re
(
Flo
 
o
);

12 
xtuAsts
::
PIECE
 
	`sour_p_to_re
(
P
 
p
);

13 
	`sour_y_vue_to_y_re_vue
(
y_vue
, 
y_num
);

14 
d
::
rg
 
	`sour_ld_puzz_fe
(d::rg 
fePh
);

15 
d
::
rg
 
	`sour_ld_xt_fe
(d::rg 
fePh
);

16 
	`sour_ld_image_om_fe_to_gpu
(
d
::
rg
 
fePh
);

	@ResourceLoadText.cpp

1 
	~<rg
>

2 
	~<ioam
>

3 
	~<fam
>

4 
	~<sam
>

6 
	~"PludeInudes.h
"

7 
	~<GLFW/glfw3.h
>

8 
	~"Memy.h
"

9 
	#STB_IMAGE_IMPLEMENTATION


	)

10 
	~"b_image.h
"

11 
	~<glm\ext\ve_t4.h
>

12 
	~"GameS.h
"

13 
	~<rg
>

14 
	~"Regex.h
"

15 
	~"Resour.h
"

17 
	gxtuAsts
::
FLOOR
 
	$sour_o_to_re
(
Flo
 
o
)

19 i(
o
 =
F_NONE
)

20  
xtuAsts
::
FLOOR
::
Flo
;

21 i(
o
 =
F_TARGET
)

22  
xtuAsts
::
FLOOR
::
Tg
;

23 i(
o
 =
F_START
)

24  
xtuAsts
::
FLOOR
::
S
;

25 i(
o
 =
F_EXIT
)

26  
xtuAsts
::
FLOOR
::
ZBZ
;

27 i(
o
 =
F_ZBLACK
)

28  
xtuAsts
::
FLOOR
::
ZBck
;

29 i(
o
 =
F_LURKING_WALL
)

30  
xtuAsts
::
FLOOR
::
Flo
;

31 i(
o
 =
F_OUTLINE
)

32  
xtuAsts
::
FLOOR
::
Flo
;

33 i(
o
 =
F_GRILL_COLD
)

34  
xtuAsts
::
FLOOR
::
GrlC
;

35 i(
o
 =
F_GRILL_HOT
)

36  
xtuAsts
::
FLOOR
::
GrlH
;

37 i(
o
 =
F_STAIRCASE
 || flo =
F_STAIRCASE_LEVELSTART
)

38  
xtuAsts
::
FLOOR
::
S
;

39 i(
o
 =
F_STAIRCASE_SOLVED
)

40  
xtuAsts
::
FLOOR
::
Tick
;

41  (
xtuAsts
::
FLOOR

o
;

42 
	}
}

43 
	gxtuAsts
::
PIECE
 
	$sour_p_to_re
(
P
 
p
)

45 i(
p
 =
P
::
P_CRATE
)

46  
xtuAsts
::
PIECE
::
C
;

47 i(
p
 =
P
::
P_CRUMBLE
)

48  
xtuAsts
::
PIECE
::
Crumb
;

49 i(
p
 =
P
::
P_NONE
)

50  
xtuAsts
::
PIECE
::
Emy
;

51 i(
p
 =
P
::
P_PLAYER
)

52  
xtuAsts
::
PIECE
::
Py
;

53 i(
p
 =
P
::
P_WALL_ALT
)

54  
xtuAsts
::
PIECE
::
WlA
;

55 i(
p
 =
P
::
P_WALL
)

56  
xtuAsts
::
PIECE
::
Wl
;

57  (
xtuAsts
::
PIECE

p
;

58 
	}
}

59 
	$sour_y_vue_to_y_re_vue
(
y_vue
, 
y_num
)

61 i(
y_num
 =
LN_FLOOR
)

62  
	`sour_o_to_re
((
Flo
)
y_vue
);

64  
	`sour_p_to_re
((
P
)
y_vue
);

65 
	}
}

67 
	gd
::
rg
 
	$sour_ld_puzz_fe
(
d
::
rg
 
puzzme
)

69 
d
::
rg
 
f_th
 = "asts/puzzs/" + 
puzzme
 + ".puzzle";

70 
d
::
cout
 << "fh: " << 
f_th
 << std::
dl
;

71 
d
::
ifam
 
	`myFe
(
f_th
);

72 
d
::
rgam
 
mySm
;

73 
mySm
 << 
myFe
.
	`rdbuf
();

74 
myFe
.
	`o
();

75 
d
::
rg
 
su
 = 
mySm
.
	`r
();

76  
su
;

77 
	}
}

78 
	gd
::
rg
 
	$sour_ld_xt_fe
(
d
::
rg
 
fePh
)

80 
d
::
ifam
 
	`myFe
("asts/" + 
fePh
);

81 
d
::
rgam
 
mySm
;

82 
mySm
 << 
myFe
.
	`rdbuf
();

83 
myFe
.
	`o
();

84 
d
::
rg
 
su
 = 
mySm
.
	`r
();

85  
su
;

86 
	}
}

88 
	$sour_ld_image_om_fe_to_gpu
(
d
::
rg
 
fe_th
)

90 
d
::
rg
 
ast_fe_th
 = "asts//" + 
fe_th
;

91 
su
;

92 
	`glGTextus
(1, &
su
);

93 
	`glEb
(
GL_BLEND
);

94 
	`glBdTextu
(
GL_TEXTURE_2D
, 
su
);

96 
	`glTexPami
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_S
, 
GL_CLAMP_TO_EDGE
);

97 
	`glTexPami
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_T
, 
GL_CLAMP_TO_EDGE
);

99 
	`glTexPami
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR
);

100 
	`glTexPami
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_LINEAR
);

102 
	`bi_t__vtiy__ld
(
ue
);

104 
width
;

105 
height
;

106 
num_of_chls
;

107 * 
da
 = 
	`bi_ld
(
ast_fe_th
.
	`c_r
(), &
width
, &
height
, &
num_of_chls
, 0);

108 
fm
 = 
GL_RGBA
;

109 i(
num_of_chls
 == 3)

110 
fm
 = 
GL_RGB
;

111 i(
da
)

113 
	`glTexImage2D
(
GL_TEXTURE_2D
, 0, 
GL_RGBA
, 
width
, 
height
, 0, 
fm
, 
GL_UNSIGNED_BYTE
, 
da
);

118 
d
::
cout
 << "Textud faed,amofe:" << 
fe_th
.
	`c_r
(<< "looklikthogmg cshow" << std::
dl
;

120 
	`bi_image_
(
da
);

122  
su
;

123 
	}
}

125 
	gglm
::
vec4
* 
	$sour_ld_
(
d
::
rg
 
fe_ld
, 
g_s_numb_om_me
 
func
, 
Memy
* 
memy
, Memy* 
mpMemy
)

127 
d
::
rg
 
fe
 = 
	`sour_ld_xt_fe
(
fe_ld
);

128 
AasDa
* 
da
 = 
	`GAasPosi
(
memy
, 
fe
, 
func
);

129 
glm
::
vec4
* 
su
 = (glm::vec4*
	`memy_loc
(
memy
, (glm::vec4* 
da
->
ngth
);

131 
tٮW
 = 
da
->
maWidth
;

132 
tٮH
 = 
da
->
maHeight
;

133 
i
 = 0; i < 
da
->
ngth
; i++)

135 
Posi
 
p
 = 
da
->
posis
[
i
];

137 
p
.
y
 = 
tٮH
 - 1 -.y;

138 
p
.
y
 -p.
h
 - 1;

141 
p
.
w
 +p.
x
 - 1;

142 
p
.
h
 +p.
y
 - 1;

144 
xt_dex
 = 
da
->
um_croodg_vues
[
i
];

146 
su
[
xt_dex
].
x
 = ()
p
.x / (
tٮW
 - 1);

147 
su
[
xt_dex
].
y
 = ()
p
.y / (
tٮH
 - 1);

148 
su
[
xt_dex
].
z
 = ()
p
.
w
 / (
tٮW
 - 1);

149 
su
[
xt_dex
].
w
 = ()
p
.
h
 / (
tٮH
 - 1);

152  
su
;

153 
	}
}

	@SaveLoad.cpp

1 
	~"SaveLd.h
"

2 
	~"Memy.h
"

4 #ide
EMSCRIPTEN


5 
	~"tyfedlogs.h
"

7 
	~<ioam
>

8 
	~"Cڡts.h
"

9 
	gd
::
rg
 
	$ld_puzz_om_asts
(
d
::
rg
 
v_me
)

11 
d
::
cout
 << "v fwygݒ:" << 
v_me
 << std::
dl
;

12 
FILE
* 
lIn
;

13 
lIn
 = 
	`fݒ
(
v_me
.
	`c_r
(), "r");

14 i(!
lIn
)

16 
d
::
cout
 << "funiچd_puzz_om_asthaedfdhth scifd. (SaveLd.p,17). Check iout!" << std::
dl
;

18 cڡ 
bufr_size
 = 50000;

19 
bufr
[
bufr_size
];

21 

 =

22 
bufr
[0] = '\0';

23 
i
 = 0;

24 
z
 = 0; z < 
bufr_size
; z++)

26 
bufr
[
z
] = '\0';

28 !
	`of
(
lIn
&& 
i
 < 
bufr_size
)

30 
c
 = ()
	`fgc
(
lIn
);

31 
bufr
[
i
] = 
c
;

32 
i
++;

34 i(
i
 >
bufr_size
)

36 
	`ash_r
("ourevel filesre finallyo big for our buffer in saveloadoad function. Go in, implement it using memory_alloc instead ofhe current hacky way.");

38 if(
i
 > 0)

39 
bufr
[
i
 - 1] = '\0';

40 
	`fo
(
lIn
);

41  
d
::
	`rg
(
bufr
);

42 
	}
}

43 #ifde
EMSCRIPTEN


44 
	$ve_puzz_fe
(
d
::
rg
 
to_ve
)

47 
	}
}

49 
	$ve_puzz_fe
(
d
::
rg
 
to_ve
)

51 cڡ* 
lTheSaveFeName
;

52 cڡ* 
lWlBeGphicMode
;

53 
FILE
* 
lIn
;

54 
lBufr
[1024];

55 cڡ* 
lFrPs
[2] = { "*.puzzle", "*.puz" };

57 
lWlBeGphicMode
 = 
	`tyfd_putBox
("tyfd_quy", 
NULL
, NULL);

59 i(
lWlBeGphicMode
)

61 
	`ry
(
lBufr
, "graphic mode: ");

65 
	`ry
(
lBufr
, "console mode: ");

70 
	`rt
(
lBufr
, 
tyfd_ڣ
);

73 
lTheSaveFeName
 = 
	`tyfd_veFeDlog
(

77 
lFrPs
,

78 
NULL
);

80 i(!
lTheSaveFeName
)

82 
	`tyfd_mesgeBox
(

91 
lIn
 = 
	`fݒ
(
lTheSaveFeName
, "w");

92 i(!
lIn
)

94 
	`tyfd_mesgeBox
(

102 
	`uts
(
to_ve
.
	`c_r
(), 
lIn
);

103 
	`fo
(
lIn
);

105 
	}
}

108 
	$ve_ctue_fe
(
d
::
rg
 
to_ve
)

110 
FILE
* 
lIn
;

111 cڡ * 
ve_me
 = ".\\assets\\puzzles\\save1.game";

112 
lIn
 = 
	`fݒ
(
ve_me
, "w");

113 i(!
lIn
)

115 
	`ash_r
("triedo save continue file. It failed!");

117 
	`uts
(
to_ve
.
	`c_r
(), 
lIn
);

118 
	`fo
(
lIn
);

119 
	}
}

121 
	gd
::
rg
 
	$g_ctue_fe
(
Memy
* 
mp_memy
)

123 cڡ * 
to_ld
 = ".\\assets\\puzzles\\save1.game";

124 
FILE
* 
lIn
 = 
	`fݒ
(
to_ld
, "r");

125 i(!
lIn
)

127 
d
::
cout
 << "nctuftld" << std::
dl
;

130 
size
 = 0;

131 !
	`of
(
lIn
))

133 
	`fgc
(
lIn
);

134 
size
++;

136 
	`fek
(
lIn
, 0, 
SEEK_SET
);

138 * 
su
 = (*
	`memy_loc
(
mp_memy
, (* (
size
 + 1));

139 
i
 = 0; i < 
size
; i++)

141 
su
[
i
] = ()
	`fgc
(
lIn
);

142 i(
	`of
(
lIn
))

144 
su
[
i
] = 
NULL
;

148 
su
[
size
] = 
NULL
;

149 
d
::
cout
 << 
su
 << std::
dl
;

150  
d
::
	`rg
(
su
);

151 
	}
}

152 #ide
EMSCRIPTEN


153 
	gd
::
rg
 
	$ld_puzz_fe
()

155 cڡ* 
lTheOnFeName
;

156 
FILE
* 
lIn
;

157 cڡ* 
lFrPs
[2] = { "*.puzzle", "*.puz" };

159 
lTheOnFeName
 = 
	`tyfd_ݒFeDlog
(

164 
lFrPs
,

165 
NULL
,

168 i(!
lTheOnFeName
)

170 
	`tyfd_mesgeBox
(

178  
	`ld_puzz_om_asts
(
lTheOnFeName
);

179 
	}
}

181 
	gd
::
rg
 
	$ld_puzz_fe
()

184 
	}
}

	@SaveLoad.h

1 #agm



2 #agm
wng
(
dib
:4996)

3 
	~<rg
>

4 
	~"Memy.h
"

6 
	gd
::
rg
 
ld_puzz_om_asts
(
d
::rg 
v_me
);

7 
ve_puzz_fe
(
d
::
rg
 
to_ve
);

8 
	gd
::
rg
 
ld_puzz_fe
();

9 
ve_game
(
d
::
rg
 
to_ve
);

10 
ve_ctue_fe
(
d
::
rg
 
to_ve
);

11 
	gd
::
rg
 
g_ctue_fe
(
Memy
* 
mp_memy
);

	@Scratch.h

	@Shader.cpp

1 
	~<rg
>

3 
	~"PludeInudes.h
"

4 
	~<glm/glm.h
>

5 
	~<glm/gtc/ty_r.h
>

6 
	~"Resour.h
"

7 
	~<ioam
>

9 
GLut
 
	tShad
;

11 
bo
 
	$_rgs_t_equs_rg_
(
d
::
rg
 
t_
, std::string string)

13 i(
t_
.
	`ngth
(> 
rg
.length())

14  
l
;

15 
i
 = 0; i < 
t_
.
	`ngth
(); i++)

16 i(
t_
[
i
] !
rg
[i])

17  
l
;

18  
ue
;

19 
	}
}

21 
	gd
::
rg
 
	$cvt_ce_to_es_
(
d
::
rg
 
put
)

23 
d
::
rg
 
to_de
 = "#version 300 core";

24 
d
::
rg
 
to_a
 = "#version 300s";

25 
n
 = (
to_de
.
	`ngth
() + 2;

26 
d
::
rg
 
su
 = 
to_a
 + 
put
.
	`subr
(17,d::rg::
os
);

27  
su
;

28 
	}
}

30 
	gd
::
rg
 
	$cvt_ch_ce_to_es_
(cڡ * 
put
)

32 
d
::
rg
 
mp
 = std::
	`rg
(
put
);

33  
	`cvt_ce_to_es_
(
mp
);

34 
	}
}

36 
Shad
 
	$shad_compe_lded_ogm
(cڡ * 
vxDaTemp
, cڡ * 
agmtDaTemp
, cڡ * 
geomryDa
 = 
nuαr
)

38 
	`tf
("NARROWED BUG DOWN TO THIS SEGMENT OF CODE!");

39 #ifde
EMSCRIPTEN


40 
d
::
rg
 
vxDar
 = 
	`cvt_ch_ce_to_es_
(
vxDaTemp
);

41 
d
::
rg
 
agmtDar
 = 
	`cvt_ch_ce_to_es_
(
agmtDaTemp
);

42 cڡ * 
vxDa
 = 
vxDar
.
	`c_r
();

43 cڡ * 
agmtDa
 = 
agmtDar
.
	`c_r
();

45 cڡ * 
vxDa
 = 
vxDaTemp
;

46 cڡ * 
agmtDa
 = 
agmtDaTemp
;

52 
GLut
 
vxShad
 = 
	`glCeShad
(
GL_VERTEX_SHADER
);

53 
d
::
cout
 << "glShadSour VERT CREATE" << 
	`glGE
(<< std::
dl
;

54 
GLut
 
agmtShad
 = 
	`glCeShad
(
GL_FRAGMENT_SHADER
);

55 
d
::
cout
 << "glShadSour FRAG CREATE" << 
	`glGE
(<< std::
dl
;

58 
	`glShadSour
(
vxShad
, 1, &
vxDa
, 
NULL
);

59 
d
::
cout
 << "glShadSour VERT LOAD" << 
	`glGE
(<< std::
dl
;

60 
	`glCompeShad
(
vxShad
);

61 
d
::
cout
 << "glShadSour VERT COMPILE" << 
	`glGE
(<< std::
dl
;

63 
GLt
 
sucss
;

64 
foLog
[1024];

66 
	`glGShadiv
(
vxShad
, 
GL_COMPILE_STATUS
, &
sucss
);

67 
d
::
cout
 << "glGShadiv VERT" << 
	`glGE
(<< std::
dl
;

68 i(!
sucss
) {

69 
	`glGShadInfoLog
(
vxShad
, 1024, 
NULL
, 
foLog
);

70 
d
::
cout
 << "ERROR::SHADER::VERTEX::COMPILATION_FAILED\n" << 
foLog
 << std::
dl
;

71 
d
::
cout
 << 
foLog
 << std::
dl
;

72 
	`abt
();

76 
d
::
cout
 << "sucssfuyached vx shad" << std::
dl
;

80 
	`glShadSour
(
agmtShad
, 1, &
agmtDa
, 
NULL
);

81 
d
::
cout
 << "glShadSour FRAG LOAD" << 
	`glGE
(<< std::
dl
;

82 
	`glCompeShad
(
agmtShad
);

83 
d
::
cout
 << "glShadSour FRAG COMPILE" << 
	`glGE
(<< std::
dl
;

85 
	`glGShadiv
(
agmtShad
, 
GL_COMPILE_STATUS
, &
sucss
);

87 i(!
sucss
) {

88 
	`glGShadInfoLog
(
agmtShad
, 1024, 
NULL
, 
foLog
);

89 
d
::
cout
 << "ERROR::SHADER::FRAGMENT::COMPILATION_FAILED\n" << 
foLog
 << std::
dl
;

90 
d
::
cout
 << 
foLog
 << std::
dl
;

91 
	`abt
();

95 
d
::
cout
 << "sucssfuyached fgmshad" << std::
dl
;

98 
Shad
 
su
 = 
	`glCeProgm
();

99 
d
::
cout
 << "glCeProgm: " << 
	`glGE
(<< std::
dl
;

100 
	`glAachShad
(
su
, 
vxShad
);

101 
d
::
cout
 << "glAachShad VERT: " << 
	`glGE
(<< std::
dl
;

102 
	`glAachShad
(
su
, 
agmtShad
);

103 
d
::
cout
 << "glAachShad FRAG: " << 
	`glGE
(<< std::
dl
;

104 
	`glLkProgm
(
su
);

105 
d
::
cout
 << "LINK: " << 
	`glGE
(<< std::
dl
;

106 
	`glGProgmiv
(
su
, 
GL_LINK_STATUS
, &
sucss
);

107 i(!
sucss
) {

108 
	`glGProgmInfoLog
(
su
, 1024, 
NULL
, 
foLog
);

109 
d
::
cout
 << "ERROR::SHADER::PROGRAM::LINKING_FAILED\n" << std::
dl
;

110 
d
::
cout
 << 
foLog
 << std::
dl
;

113 
	`glDeShad
(
vxShad
);

114 
	`glDeShad
(
agmtShad
);

115  
su
;

116 
	}
}

118 
Shad
 
	$shad_compe_ogm
(cڡ * 
vxPh
, cڡ * 
agmtPh
, cڡ * 
geomryPh
 = 
nuαr
)

120 
d
::
rg
 
vxSg
 = 
	`sour_ld_xt_fe
(
vxPh
);

121 cڡ * 
vx
 = 
vxSg
.
	`c_r
();

122 
d
::
rg
 
agmtSg
 = 
	`sour_ld_xt_fe
(
agmtPh
);

123 cڡ * 
ag
 = 
agmtSg
.
	`c_r
();

124 cڡ * 
geo
 = 
nuαr
;

125 i(
geomryPh
 !
nuαr
)

126 
geo
 = 
	`sour_ld_xt_fe
(
geomryPh
).
	`c_r
();

129  
	`shad_compe_lded_ogm
(
vx
, 
ag
, 
geo
);

131 
	}
}

132 
	$shad_u
(
Shad
 
shad
)

134 
	`glUProgm
(
shad
);

135 
	}
}

136 
	$shad_t_unifm_t
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
vue
)

138 
	`glUnifm1i
(
	`glGUnifmLoti
(
shad
, 
me
.
	`c_r
()), 
vue
);

139 
	}
}

140 
	$shad_t_unifm_t
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
vue
)

142 
	`glUnifm1f
(
	`glGUnifmLoti
(
shad
, 
me
.
	`c_r
()), 
vue
);

143 
	}
}

144 
	$shad_t_unifm_vec2
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
vec2
 
vue
)

146 
	`glUnifm2f
(
	`glGUnifmLoti
(
shad
, 
me
.
	`c_r
()), 
vue
.
x
, vue.
y
);

147 
	}
}

148 
	$shad_t_unifm_vec3
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
vec3
 
vue
)

150 
	`glUnifm3f
(
	`glGUnifmLoti
(
shad
, 
me
.
	`c_r
()), 
vue
.
x
, vue.
y
, vue.
z
);

151 
	}
}

152 
	$shad_t_unifm_vec4
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
vec4
 
vue
)

154 
	`glUnifm4f
(
	`glGUnifmLoti
(
shad
, 
me
.
	`c_r
()), 
vue
.
x
, vue.
y
, vue.
z
,vue.
w
);

155 
	}
}

156 
	$shad_t_unifm_m2
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
m2
 
vue
)

158 
	`glUnifmMrix2fv
(
	`glGUnifmLoti
(
shad
, 
me
.
	`c_r
()), 1, 
l
, 
glm
::
	`vue_r
(
vue
));

159 
	}
}

160 
	$shad_t_unifm_m3
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
m3
 
vue
)

162 
	`glUnifmMrix3fv
(
	`glGUnifmLoti
(
shad
, 
me
.
	`c_r
()), 1, 
l
, 
glm
::
	`vue_r
(
vue
));

163 
	}
}

164 
	$shad_t_unifm_m4
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
m4
 
vue
)

166 
	`glUnifmMrix4fv
(
	`glGUnifmLoti
(
shad
, 
me
.
	`c_r
()), 1, 
l
, 
glm
::
	`vue_r
(
vue
));

167 
	}
}

	@Shader.h

1 #agm



2 
	~<glm/glm.h
>

4 
	~<rg
>

5 
	~"PludeInudes.h
"

6 
	~<glm/glm.h
>

7 
	~<glm/gtc/ty_r.h
>

9 
GLut
 
	tShad
;

11 
Shad
 
shad_compe_ogm
(cڡ * 
vxPh
, cڡ * 
agmtPh
, cڡ * 
geomryPh
 = 
nuαr
);

12 
shad_u
(
Shad
 
shad
);

14 
shad_t_unifm_t
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
vue
);

15 
shad_t_unifm_t
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
vue
);

16 
shad_t_unifm_vec2
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
vec2
 
vue
);

17 
shad_t_unifm_vec3
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
vec3
 
vue
);

18 
shad_t_unifm_vec4
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
vec4
 
vue
);

19 
shad_t_unifm_m2
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
m2
 
vue
);

20 
shad_t_unifm_m3
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
m3
 
vue
);

21 
shad_t_unifm_m4
(
Shad
 
shad
, cڡ 
d
::
rg
& 
me
, 
glm
::
m4
 
vue
);

	@Side.h

1 #agm



3 
	~"Mh.h
"

6 
IPa
 
	$mh_side_to_dei
(
Side
 
s
)

8 i(
s
 =
S_RIGHT
)

9  
	`mh_a_
(1, 0);

10 i(
s
 =
S_DOWN
)

11  
	`mh_a_
(0, -1);

12 i(
s
 =
S_LEFT
)

13  
	`mh_a_
(-1, 0);

14 i(
s
 =
S_UP
)

15  
	`mh_a_
(0, 1);

16  
	`mh_a_
(0, 0);

17 
	}
}

18 
Side
 
	$mh_dei_to_side
(
IPa
 

)

20 i(

.
x
 == -1)

21  
S_LEFT
;

22 i(

.
x
 == 1)

23  
S_RIGHT
;

24 i(

.
y
 == 1)

25  
S_UP
;

26 i(

.
y
 == -1)

27  
S_DOWN
;

28 
	}
}

29 
Side
 
	$mh_side_pose
(
Side
 
s
)

32 
i
 = ()
s
;

33 
xt
 = (
i
 + 2) % 4;

34  (
Side

xt
;

35 
	}
}

	@Source.cpp

	@Sprites.cpp

1 
	~"Ses.h
"

2 
	~<glm\ext\mrix_sfm.h
>

4 
	$res_fuΥre_to_gpu_da
(
FuSeAay
* 
res
, 
glm
::
vec4
* 
dex_mr
, glm::vec4* 
s_ouut
, glm::
m4
* 
mrix_ouut
)

6 
ngth
 = 
res
->length;

7 
i
 = 0; i < 
ngth
; i++)

9 
s_ouut
[
i
] = 
dex_mr
[
res
->
sIndex
[i]];

11 
glm
::
vec3
 
e_befe_r٩e_t
 = glm::
	`vec3
(-0.5f, -0.5f, 0);

12 
glm
::
vec3
 
e_a_r٩e_d
 = glm::
	`vec3
(0.5f, 0.5f, 0);

13 
glm
::
vec3
 
r٩e_vec3
 = glm::
	`vec3
(0, 0, 1);

14 
i
 = 0; i < 
ngth
; i++)

17 
mrix_ouut
[
i
] = 
glm
::
	`m4
(1.0f);

20 
glm
::
	`e
(
mrix_ouut
[
i
], glm::
	`vec3
(
res
->
posiWhS
[i].
x
,res->posiWhS[i].
y
,0));

23 
glm
::
	`s
(
mrix_ouut
[
i
], glm::
	`vec3
(
res
->
posiWhS
[i].
z
, ses->posiWhS[i].
w
, 1));

26 
glm
::
	`e
(
mrix_ouut
[
i
], 
e_befe_r٩e_t
);

27 
glm
::
	`r٩e
(
mrix_ouut
[
i
], 
res
->
r٩i
[i], 
r٩e_vec3
);

28 
glm
::
	`e
(
mrix_ouut
[
i
], 
e_a_r٩e_d
);

30 
	}
}

31 
	$res_boxre_to_gpu_da
(
BoxSes
* 
res
, 
glm
::
vec4
* 
dex_mr
, glm::vec4* 
s_ouut
, glm::
vec2
* 
posi_ouut
)

33 
ngth
 = 
res
->length;

34 
i
 = 0; i < 
ngth
; i++)

36 
s_ouut
[
i
] = 
dex_mr
[
res
->
sIndex
[i]];

38 
i
 = 0; i < 
ngth
; i++)

40 
posi_ouut
[
i
] = 
res
->
posi
[i];

42 
	}
}

	@Sprites.h

1 #agm



2 
	~<glm/glm.h
>

3 
	~"Mh.h
"

4 
	sBoxSes
 {

5 
	mngth
;

6 * 
	msIndex
;

7 
	mglm
::
vec2
* 
posi
;

10 
	sFuSeAay


12 
	mngth
;

13 * 
	msIndex
;

14 
	mglm
::
vec4
* 
posiWhS
;

15 * 
	mr٩i
;

18 
res_fuΥre_to_bb_d_gpu_da
(
FuSeAay
* 
res
, 
AABB
* 
bb_ouut
, 
glm
::
vec4
* 
s_ouut
, glm::
m4
* 
mrix_ouut
);

19 
res_boxre_to_bb_d_gpu_da
(
BoxSes
* 
res
, 
AABB
* 
bb_ouut
, 
glm
::
vec4
* 
s_ouut
, glm::
m4
* 
mrix_ouut
);

	@TextDraw.cpp

1 
	~"TextDw.h
"

4 
	$g_hizڏl_a_csumed_by_xt
(
glm
::
vec3
 
t_posi
, glm::
vec2
 
s
, cڡ * 
c_rg
, 
TextWre
* 
fo
)

7 
glm
::
vec3
 
xt_posi
 = 
t_posi
;

8 
dw
 = *
fo
->
cut_numb_dwn
;

9 ; 
c_rg
[0]; c_string++)

11 
c
 = 
c_rg
[0];

14 
hizڏl_a
 = 
fo
->
xt_posis
[
c
].
w
 / 
FONT_CHARACTER_HEIGHT
;

16 
x_t
 = (
xt_posi
.
x
 + 
fo
->
ue_ft_n
[
c
].
Brg
.x/ (
FONT_CHARACTER_HEIGHT
);

17 
y_t
 = (
xt_posi
.
y
 - (
fo
->
ue_ft_n
[
c
].
Size
.y - info->ue_ft_n[c].
Brg
.y)/ (
FONT_CHARACTER_HEIGHT
);

18 
w
 = (
fo
->
ue_ft_n
[
c
].
Size
.
x
/ (
FONT_CHARACTER_HEIGHT
);

19 
h
 = 
fo
->
ue_ft_n
[
c
].
Size
.
y
 / (
FONT_CHARACTER_HEIGHT
);

22 
x_pixs__gamea
 = (
fo
->
ue_ft_n
[
c
].
adv
 >> 6/ (
FONT_CHARACTER_HEIGHT
);

23 
xt_posi
.
x
 +(
x_pixs__gamea
 * 
s
.x);

26 *
fo
->
cut_numb_dwn
 = 
dw
;

27  
xt_posi
.
x
 - 
t_posi
.x;

28 
	}
}

30 
LeBounds
 
	$g_lebounds_a_csumed_by_xt
(
glm
::
vec3
 
t_posi
, glm::
vec2
 
s
, cڡ * 
c_rg
, 
TextWre
* 
fo
)

33 
glm
::
vec3
 
xt_posi
 = 
t_posi
;

34 
LeBounds
 
su
;

35 
su
.
y_b
 = 0;

36 
su
.
y_t
 = 0;

37 
su
.
y_di
 = 0;

38 
dw
 = *
fo
->
cut_numb_dwn
;

39 ; 
c_rg
[0]; c_string++)

41 
c
 = 
c_rg
[0];

44 
hizڏl_a
 = 
fo
->
xt_posis
[
c
].
w
 / 
FONT_CHARACTER_HEIGHT
;

46 
x_t
 = (
xt_posi
.
x
 + 
fo
->
ue_ft_n
[
c
].
Brg
.x/ (
FONT_CHARACTER_HEIGHT
);

47 
y_t
 = (
xt_posi
.
y
 - (
fo
->
ue_ft_n
[
c
].
Size
.y - info->ue_ft_n[c].
Brg
.y)/ (
FONT_CHARACTER_HEIGHT
);

48 
w
 = (
fo
->
ue_ft_n
[
c
].
Size
.
x
/ (
FONT_CHARACTER_HEIGHT
);

49 
h
 = 
fo
->
ue_ft_n
[
c
].
Size
.
y
 / (
FONT_CHARACTER_HEIGHT
);

52 
x_pixs__gamea
 = (
fo
->
ue_ft_n
[
c
].
adv
 >> 6/ (
FONT_CHARACTER_HEIGHT
);

53 
xt_posi
.
x
 +(
x_pixs__gamea
 * 
s
.x);

55 
su
.
y_b
 = 
	`mf
esu.y_b, 
y_t
);

56 
su
.
y_t
 = 
	`maxf
esu.y_t, 
y_t
 + 
h
);

57 
su
.
y_di
 = 
	`maxf
esu.y_di, 
h
);

59 *
fo
->
cut_numb_dwn
 = 
dw
;

60 
su
.
le_ngth
 = 
xt_posi
.
x
 - 
t_posi
.x;

61  
su
;

62 
	}
}

64 
	$dw_xt_to_sn
(
glm
::
vec3
 
t_posi
, glm::
vec2
 
s
, cڡ * 
c_rg
, 
TextWre
* 
fo
)

67 
glm
::
vec3
 
xt_posi
 = 
t_posi
;

68 
dw
 = *
fo
->
cut_numb_dwn
;

69 ; 
c_rg
[0]; c_string++)

71 
c
 = 
c_rg
[0];

74 
hizڏl_a
 = 
fo
->
xt_posis
[
c
].
w
 / 
FONT_CHARACTER_HEIGHT
;

76 
x_t
 = (
xt_posi
.
x
 + 
fo
->
ue_ft_n
[
c
].
Brg
.x/ (
FONT_CHARACTER_HEIGHT
);

77 
y_t
 = (
xt_posi
.
y
 - (
fo
->
ue_ft_n
[
c
].
Size
.y - info->ue_ft_n[c].
Brg
.y* 
s
.y/ (
FONT_CHARACTER_HEIGHT
);

78 
w
 = (
fo
->
ue_ft_n
[
c
].
Size
.
x
/ (
FONT_CHARACTER_HEIGHT
);

79 
h
 = 
fo
->
ue_ft_n
[
c
].
Size
.
y
 / (
FONT_CHARACTER_HEIGHT
);

81 i(
c
 != ' ')

83 
glm
::
vec3
 
t_posi
 = glm::
	`vec3
(
xt_posi
.
x
 + 
x_t
,ext_posi.
y
 + 
y_t
,ext_posi.
z
);

84 
fo
->
rg_mrix_u
[
dw
] = 
glm
::
	`m4
(1.0f);

85 
fo
->
rg_mrix_u
[
dw
] = 
glm
::
	`e
(fo->rg_mrix_u[dw], 
t_posi
);

86 
fo
->
rg_mrix_u
[
dw
] = 
glm
::
	`s
(fo->rg_mrix_u[dw], glm::
	`vec3
(
w
 * 
s
.
x
, 
h
 * s.
y
, 1));

87 
fo
->
rg_c_u
[
dw
] = 
glm
::
	`vec4
(0.5, 0.2, 0.3, 1);

89 
AABB
 
box
 = 
fo
->
xt_posis_nmized
[
c
];

90 
glm
::
vec4
 
to_s_ouut
 = glm::
	`vec4
(
box
.
x
, box.
y
, box.x + box.
w
, box.y + box.
h
);

91 
fo
->
rg_s_u
[
dw
] = 
to_s_ouut
;

93 
dw
++;

97 
x_pixs__gamea
 = (
fo
->
ue_ft_n
[
c
].
adv
 >> 6/ (
FONT_CHARACTER_HEIGHT
);

98 
xt_posi
.
x
 +(
x_pixs__gamea
 * 
s
.x);

101 *
fo
->
cut_numb_dwn
 = 
dw
;

102  
xt_posi
.
x
 - 
t_posi
.x;

103 
	}
}

105 
	$rage_bwn
(
t
, 
d
, 
pot
)

107  (
pot
 - 
t
/ (
d
 - start);

108 
	}
}

110 
	$˽
(
t
, 
d
, 
rage
)

112  
rage
 * 
d
 + (1.0-age* 
t
;

113 
	}
}

115 
	$dw_xt_maximized_ed_to_sn
(
GameSCama
 
ma
, cڡ * 
rg_to_dw
, 
TextWre
* 
xt_dw_fo
)

118 
glm
::
vec3
 
sn_
 = glm::
	`vec3
((
ma
.

 + cama.
right
/ 2.0f, (ma.
up
 + cama.
down
) / 2.0f, 15);

120 
LeBounds
 
bounds
 = 
	`g_lebounds_a_csumed_by_xt
(
sn_
, 
glm
::
	`vec2
(1, 1), 
rg_to_dw
, 
xt_dw_fo
);

121 
xt_width
 = 
	`g_hizڏl_a_csumed_by_xt
(
sn_
, 
glm
::
	`vec2
(1, 1), 
rg_to_dw
, 
xt_dw_fo
);

122 
xt_height
 = 
bounds
.
y_t
 - bounds.
y_b
;

126 
x_di
 = 
ma
.
right
 - cama.

;

127 
y_di
 = 
ma
.
up
 - cama.
down
;

128 
x_s
 = 
x_di
 / 
xt_width
;

129 
y_s
 = 
y_di
 / 
xt_height
;

130 
s
 = 
	`mf
(
x_s
, 
y_s
);

132 
t_xt_y_ue_t
;

134 
ma_ngth
 = 
ma
.
up
 - cama.
down
;

135 
unsd_xt_le_ngth
 = 
bounds
.
y_t
 - bounds.
y_b
;

137 
sd_xt_le_ngth
 = 
unsd_xt_le_ngth
 * 
s
;

139 
vtil_a
 = 
y_di
 - 
sd_xt_le_ngth
;

140 
hf_vtil_a
 = 
vtil_a
 / 2.0f;

142 
t_tio
 = 
	`rage_bwn
(
bounds
.
y_b
, bounds.
y_t
, 0);

144 
t_xt_btom
 = 
ma
.
down
 + 
hf_vtil_a
;

145 
t_xt_t
 = 
t_xt_btom
 + 
sd_xt_le_ngth
;

146 
t_xt_y_ue_t
 = 
	`˽
(
t_xt_btom
, 
t_xt_t
, 
t_tio
);

148 
t_xt_x_ue_t
;

150 
ue_width
 = 
xt_width
 * 
s
;

151 
x_a_
 = 
x_di
 - 
ue_width
;

152 
x_a__hf
 = 
x_a_
 / 2.0f;

153 
t_xt_x_ue_t
 = 
ma
.

 + 
x_a__hf
;

155 
	`dw_xt_to_sn
(
glm
::
	`vec3
(
t_xt_x_ue_t
, 
t_xt_y_ue_t
, 
sn_
.
z
), glm::
	`vec2
(
x_s
, x_s), 
rg_to_dw
, 
xt_dw_fo
);

156 
	}
}

158 
GameSCama
 
	$_g_grid_emt
(
x
, 
y
, 
width
, 
height
, 
GameSCama
 

)

160 
GameSCama
 
su
;

161 
su
.

 = 
	`˽
(

.,a.
right
, 
x
 / 
width
);

162 
su
.
down
 = 
	`˽
(

.down,a.
up
, 
y
 / 
height
);

164 
su
.
right
 = 
	`˽
(

.

,a.right, (
x
 + 1/ 
width
);

165 
su
.
up
 = 
	`˽
(

.
down
,a.up, (
y
 + 1/ 
height
);

167  
su
;

168 
	}
}

170 
GameSCama
* 
	$bak_ma_to_cumns
(
GameSCama
 

, 
cumn
, 
Memy
* 
sce_memy
)

172 
GameSCama
* 
su
 = (GameSCama*)
	`memy_loc
(
sce_memy
, (GameSCama* 
cumn
);

173 
ngth
 = 

.
right
 -a.
down
;

174 
l_ngth
 = 
ngth
 / ()
cumn
;

175 
i
 = 0; i < 
cumn
; i++)

177 
su
[
i
].
up
 = 

.up;

178 
su
[
i
].
down
 = 

.down;

179 
su
[
i
].

 = 

. + 
l_ngth
 * i;

180 
su
[
i
].
right
 = 

.

 + 
l_ngth
 * (i + 1);

181 
su
[
i
].
oPot
 = 

.closePoint;

182 
su
[
i
].
rPot
 = 

.farPoint;

184  
su
;

185 
	}
}

187 
GameSCama
* 
	$bak_ma_to_rows
(
GameSCama
 

, 
rows
, 
Memy
* 
sce_memy
)

189 
GameSCama
* 
su
 = (GameSCama*)
	`memy_loc
(
sce_memy
, (GameSCama* 
rows
);

190 
ngth
 = 

.
up
 -a.
down
;

191 
l_ngth
 = 
ngth
 / ()
rows
;

192 
i
 = 0; i < 
rows
; i++)

194 
su
[
i
].
up
 = 

.
down
 + 
l_ngth
 * (i + 1);

195 
su
[
i
].
down
 = 

.dow+ 
l_ngth
 * i;

196 
su
[
i
].

 = 

.left;

197 
su
[
i
].
right
 = 

.right;

198 
su
[
i
].
oPot
 = 

.closePoint;

199 
su
[
i
].
rPot
 = 

.farPoint;

201  
su
;

202 
	}
}

204 
GameSCama
* 
	$bak_ma_to_weighd_cumns
(
GameSCama
 

, * 
cumn_tio
, 
ngth
, 
Memy
* 
sce_memy
)

206 
GameSCama
* 
su
 = (GameSCama*)
	`memy_loc
(
sce_memy
, (GameSCama* 
ngth
);

207 
x_width
 = 

.
right
 -a.

;

208 
y_height
 = 

.
up
 -a.
down
;

209 
tٮ
 = 0;

210 
i
 = 0; i < 
ngth
; i++)

212 
tٮ
 +
cumn_tio
[
i
];

214 
tٮf
 = ()
tٮ
;

215 
t
 = 0;

216 
i
 = 0; i < 
ngth
; i++)

218 
our_t
 = 
t
;

219 
xt_tio
 = 
cumn_tio
[
i
] / 
tٮf
;

220 
our_d
 = 
our_t
 + 
xt_tio
 * 
x_width
;

221 
t
 +
xt_tio
;

223 
su
[
i
].

 = 
our_t
;

224 
su
[
i
].
right
 = 
our_d
;

225 
su
[
i
].
up
 = 

.up;

226 
su
[
i
].
down
 = 

.down;

227 
su
[
i
].
rPot
 = 

.farPoint;

228 
su
[
i
].
oPot
 = 

.closePoint;

230  
su
;

231 
	}
}

233 
GameSCama
* 
	$bak_ma_to_weighd_rows
(
GameSCama
 

, * 
row_tio
, 
ngth
, 
Memy
* 
sce_memy
)

235 
GameSCama
* 
su
 = (GameSCama*)
	`memy_loc
(
sce_memy
, (GameSCama* 
ngth
);

236 
x_width
 = 

.
right
 -a.

;

237 
y_height
 = 

.
up
 -a.
down
;

238 
tٮ
 = 0;

239 
i
 = 0; i < 
ngth
; i++)

241 
tٮ
 +
row_tio
[
i
];

243 
tٮf
 = ()
tٮ
;

244 
t
 = 0;

245 
i
 = 0; i < 
ngth
; i++)

247 
our_t
 = 
t
;

248 
xt_tio
 = 
row_tio
[
i
] / 
tٮf
;

249 
our_d
 = 
our_t
 + 
xt_tio
 * 
y_height
;

250 
t
 +
xt_tio
;

252 
su
[
i
].

 = 

.left;

253 
su
[
i
].
right
 = 

.
down
;

254 
su
[
i
].
up
 = 
our_t
;

255 
su
[
i
].
down
 = 
our_d
;

256 
su
[
i
].
rPot
 = 

.farPoint;

257 
su
[
i
].
oPot
 = 

.closePoint;

259  
su
;

260 
	}
}

	@TextDraw.h

1 #agm



3 
	~"Mh.h
"

4 
	~"TrueFtCha.h
"

5 cڡ 
	gFONT_CHARACTER_HEIGHT
 = 128;

6 cڡ 
	gFONT_ATLAS_WIDTH
 = 1024;

7 cڡ 
	gFONT_ATLAS_HEIGHT
 = 1024;

8 cڡ 
	gFONT_NUM_CHARACTERS
 = 128;

10 
	sTextWre
 {

11 
	mglm
::
m4
* 
rg_mrix_u
;

12 
	mglm
::
vec4
* 
rg_s_u
;

13 
	mglm
::
vec4
* 
rg_c_u
;

14 
TTF_Cha
* 
	mue_ft_n
;

15 
AABB
* 
	mxt_posis
;

16 
AABB
* 
	mxt_posis_nmized
;

17 * 
	mcut_numb_dwn
;

20 
	sLeBounds


22 
	mle_ngth
;

23 
	my_t
;

24 
	my_b
;

25 
	my_di
;

28 
g_hizڏl_a_csumed_by_xt
(
glm
::
vec3
 
t_posi
, glm::
vec2
 
s
, cڡ * 
c_rg
, 
TextWre
* 
fo
);

29 
LeBounds
 
g_lebounds_a_csumed_by_xt
(
glm
::
vec3
 
t_posi
, glm::
vec2
 
s
, cڡ * 
c_rg
, 
TextWre
* 
fo
);

30 
dw_xt_to_sn
(
glm
::
vec3
 
t_posi
, glm::
vec2
 
s
, cڡ * 
c_rg
, 
TextWre
* 
fo
);

34 
	sLe


36 
	m
;

37 
	mngth
;

38 
	mt
;

39 
	mb
;

43 
rage_bwn
(
t
, 
d
, 
pot
);

44 
˽
(
t
, 
d
, 
rage
);

45 
dw_xt_maximized_ed_to_sn
(
GameSCama
 
ma
, cڡ * 
rg_to_dw
, 
TextWre
* 
xt_dw_fo
);

47 
GameSCama
 
_g_grid_emt
(
x
, 
y
, 
width
, 
height
, GameSCam

);

48 
GameSCama
* 
bak_ma_to_cumns
(GameSCam

, 
cumn
, 
Memy
* 
sce_memy
);

50 
GameSCama
* 
bak_ma_to_rows
(GameSCam

, 
rows
, 
Memy
* 
sce_memy
);

52 
GameSCama
* 
bak_ma_to_weighd_cumns
(GameSCam

, * 
cumn_tio
, 
ngth
, 
Memy
* 
sce_memy
);

54 
GameSCama
* 
bak_ma_to_weighd_rows
(GameSCam

, * 
row_tio
, 
ngth
, 
Memy
* 
sce_memy
);

	@TextScene.h

1 #agm



2 
	~"Cڡts.h
"

3 
	~<rg
>

4 
	~"Memy.h
"

5 
	sTextS


7 * 
	mto_diy
;

8 
	mt_time
;

9 
	md_time
;

10 
SCENE_TYPE
 
	ms_to_vt_to
;

13 
TextS
* 
	$bud_xt_s
(
d
::
rg
 
to_bud
, 
SCENE_TYPE
 
ϡ_s
, 
Memy
* 
xt_memy
, 
t_time
, 
diy_time
)

15 
	`memy_r
(
xt_memy
);

16 
TextS
* 
su
 = (TextS*)
	`memy_loc
(
xt_memy
, (TextScene));

17 
su
->
to_diy
 = (*)
	`memy_loc
(
xt_memy
, 
to_bud
.
	`ngth
() + 1);

18 
i
 = 0; i < 
to_bud
.
	`ngth
(); i++)

19 
su
->
to_diy
[
i
] = 
to_bud
[i];

20 
su
->
to_diy
[
to_bud
.
	`ngth
()] = 
NULL
;

21 
su
->
t_time
 = start_time;

22 
su
->
d_time
 = 
t_time
 + 
diy_time
;

23 
su
->
s_to_vt_to
 = 
ϡ_s
;

24  
su
;

25 
	}
}

27 
TextS
* 
	$v_pup
(
d
::
rg
 
v_me
, 
Memy
* 
xt_memy
, 
cut_time
)

29  
	`bud_xt_s
(
v_me
, 
SCENE_TYPE
::
ST_PLAY_LEVEL
, 
xt_memy
, 
cut_time
, 
TIME_TO_DISPLAY_LEVEL_NAME
);

30 
	}
}

32 
TextS
* 
	$v_pup_cuomtime
(
d
::
rg
 
v_me
, 
Memy
* 
xt_memy
, 
cut_time
, 
diy_time
)

34  
	`bud_xt_s
(
v_me
, 
SCENE_TYPE
::
ST_PLAY_LEVEL
, 
xt_memy
, 
cut_time
, 
diy_time
);

35 
	}
}

	@TrueFontCharacter.h

1 #agm



2 
	~<glm\ext\ve_t2.h
>

4 
	sTTF_Cha


6 
	mglm
::
ivec2
 
Size
;

7 
	mglm
::
ivec2
 
Brg
;

8 
	madv
;

	@Walk.cpp

1 
	~"Mh.h
"

3 
bo
* 
	$mh_grid_wk_adja
(
Memy
* 
su_memy
, Memy* 
mp_memy
, * 
put_grid
, 
t_x
, 
t_y
, 
w
, 
h
)

5  
nuαr
;

6 
	}
}

7 
bo
* 
	$mh_grid_wk_adja_wed
(
Memy
* 
su_memy
, Memy* 
mp_memy
, * 
put_grid
, 
t_x
, 
t_y
, 
w
, 
h
)

51  
nuαr
;

52 
	}
}

	@World.cpp

1 
	~"Wld.h
"

2 
	~"Animi.h
"

3 
	~"P.h
"

6 
	$wld_y_vsg_a
(
WldS
* 
s
)

8 i(
s
->
a_we_d_v_om
.
v_dex
 >= 0)

10 
s
->
ϡ_ai_was_pt
 = 
ue
;

11 
WldPosi
 
cut_pos
 = 
	`wld_maybe_fd_ay
(
s
);

12 
WldPosi
 
vt_pos
 = 
s
->
a_we_d_v_om
;

13 i(
cut_pos
.
v_dex
 == -1)

14 
	`ash_r
("uh ohhh, weriedo findlayer but couldn't find one,hat shouldn't have happened");

15 
ay_v
 = 
s
->
wld_e
.
v_e
[
cut_pos
.
v_dex
]->
p
[cut_pos.
v_posi_1d
];

16 
s
->
wld_e
.
v_e
[
vt_pos
.
v_dex
]->
o
[vt_pos.
v_posi_1d
] = 
F_STAIRCASE_SOLVED
;

19 
s
->
wld_e
.
v_e
[
cut_pos
.
v_dex
]->
p
[cut_pos.
v_posi_1d
] = 
P_NONE
;

20 
s
->
wld_e
.
v_e
[
vt_pos
.
v_dex
]->
p
[vt_pos.
v_posi_1d
] = 
ay_v
;

21 
s
->
cut_v
 = 
vt_pos
.
v_dex
;

23 
	}
}

25 
WldPyS
* 
	$wld_ay_ai
(
WldS
* 
s
, 
Dei
 
ai
, 
Memy
* 
v_memy
)

27 
s
->
ϡ_ai_was_pt
 = 
l
;

29 
IPa
 
move
 = 
	`dei_to_a
(
ai
);

30 
GameS
* 
cut_e
 = 
s
->
wld_e
.
v_e
[s->
cut_v
];

31 
IPa
 
cut_e_posi
 = 
s
->
wld_e
.
v_posi
[s->
cut_v
];

34 
WldPosi
 
ay_pos
 = 
	`wld_maybe_fd_ay
(
s
);

35 
cut_ay_vue
 = 
s
->
wld_e
.
v_e
[
ay_pos
.
v_dex
]->
p
[ay_pos.
v_posi_1d
];

59 
IPa
 
xt_ay_sque_posi
;

60 
xt_sque_v
;

62 
IPa
 
ive_xt
 = 
	`mh_a_add
(
move
, 
ay_pos
.
v_posi
 );

63 
bo
 
side_v
 = 
	`mh_wh_grid
(
ive_xt
.
x
,tive_xt.
y
, 
cut_e
->
w
, cut_e->
h
);

64 i(
side_v
)

66 
xt_ay_sque_posi
 = 
ive_xt
;

67 
xt_sque_v
 = 
s
->
cut_v
;

72 
IPa
 
wld_posi
 = 
	`mh_a_add
(
ive_xt
, 
cut_e_posi
);

74 
bo
 
found_move
 = 
l
;

75 
i
 = 0; i < 
s
->
wld_e
.
num_v
; i++)

77 
IPa
 
grid_loti
 = 
	`mh_a_sub
(
wld_posi
, 
s
->
wld_e
.
v_posi
[
i
]);

78 i(
	`mh_wh_grid
(
grid_loti
.
x
, grid_loti.
y
, 
s
->
wld_e
.
v_e
[
i
]->
w
, s->wld_e.v_e[i]->
h
))

80 
xt_ay_sque_posi
 = 
grid_loti
;

81 
xt_sque_v
 = 
i
;

82 
found_move
 = 
ue
;

86 i(!
found_move
)

89  
NULL
;

95 
GameS
* 
xt_e
 = 
s
->
wld_e
.
v_e
[
xt_sque_v
];

97 
xt_sque_posi_1d
 = 
	`f2D
(
xt_ay_sque_posi
.
x
,ext_ay_sque_posi.
y
, 
xt_e
->
w
,ext_e->
h
);

98 i(
xt_e
->
p
[
xt_sque_posi_1d
] !
P_NONE
)

101  
NULL
;

109 
cut_e_posi_1d
 = 
	`f2D
(
ay_pos
.
v_posi
.
x
,y_pos.v_posi.
y
, 
cut_e
->
w
, cut_e->
h
);

110 
cut_e
->
p
[
cut_e_posi_1d
] = 
P_NONE
;

113 
xt_sque_posi_1d
 = 
	`f2D
(
xt_ay_sque_posi
.
x
,ext_ay_sque_posi.
y
, 
xt_e
->
w
,ext_e->
h
);

115 
xt_e
->
p
[
xt_sque_posi_1d
] = 
cut_ay_vue
;

116 
s
->
cut_v
 = 
xt_sque_v
;

121 
f_v_dex
 = 
xt_sque_v
;

122 
f_posi_1d
 = 
xt_sque_posi_1d
;

124 
f
 = 
xt_e
->
o
[
xt_sque_posi_1d
];

125 
bo
 
dg__p܋r
 = 
	`is_a
(
f
);

126 i(
dg__p܋r
)

129 
lk_loti
;

130 
IPa
 
lk_sque_2d
;

131 
lk_sque_1d
;

133 
FloDa
 
xt_oda
 = 
xt_e
->
o_da
[
xt_sque_posi_1d
];

134 
lk_loti
 = 
xt_oda
.
p܋r_id
;

135 
lk_sque_2d
 = 
xt_oda
.
p܋r_rg_sque
;

136 
lk_w
 = 
s
->
wld_e
.
v_e
[
lk_loti
]->
w
;

137 
lk_h
 = 
s
->
wld_e
.
v_e
[
lk_loti
]->
h
;

138 
lk_sque_1d
 = 
	`f2D
(
lk_sque_2d
.
x
,k_sque_2d.
y
, 
lk_w
,
lk_h
);

143 
s
->
ϡ_ai_was_pt
 = 
l
;

144 
xt_e
->
p
[
xt_sque_posi_1d
] = 0;

145 
s
->
wld_e
.
v_e
[
lk_loti
]->
p
[
lk_sque_1d
] = 
P
::
P_PLAYER
;

146 
GameS
* 
xt
 = 
s
->
wld_e
.
v_e
[
xt_sque_v
];

147 
v_pos_1d
 = 
	`f2D
(
xt_ay_sque_posi
.
x
,ext_ay_sque_posi.
y
, 
xt
->
w
,ext->
h
);

148 
s
->
a_we_d_v_om
 = 
	`wld_make_wld_posi
(s->
cut_v
, 
xt_ay_sque_posi
, 
v_pos_1d
);

149 
s
->
cut_v
 = 
lk_loti
;

150 
f_v_dex
 = 
lk_loti
;

151 
f_posi_1d
 = 
lk_sque_1d
;

160 
te_ay_dg_
 = 
s
->
wld_e
.
v_e
[
f_v_dex
]->
o
[
f_posi_1d
];

161 
bo
 
dg__t_te
 = 
te_ay_dg_
 =
F_START
 ||e_ay_dg_ =
F_STAIRCASE_LEVELSTART
;

162 i(
dg__t_te
)

164 
	`memy_r
(
v_memy
);

165 
GameS
* 
xt_s_befe_exude
 = 
s
->
wld_e
.
v_e
[s->
cut_v
];

166 
GameS
* 
xt_s
 = 
	`gamee_e
(
xt_s_befe_exude
, 
v_memy
);

167 
	`gamee_tup
(
xt_s
);

168 
WldPyS
* 
su
 = (WldPyS*
	`memy_loc
(
v_memy
, (WorldPlayScene));

169 
su
->
time_mache
 = 
	`gamee_timemache_
(
xt_s
, 
v_memy
, 1024);

170 
su
->
dw_posi
 = 
s
->
wld_e
.
v_posi
[
f_v_dex
];

171  
su
;

175 
s
->
a_we_d_v_om
 = 
	`wld_make_wld_posi
(-1, 
	`mh_a_
(-1, -1), -1);

180  
NULL
;

183 
	}
}

184 
WldS
* 
	$tup_wld_s_ctue
(
WldS
* 
s
, 
SCENE_TYPE
 
go_to__backa
)

186 
s
->
go_to__backa
 = go_to_on_backspace;

187 
s
->
ϡ_ai_was_pt
 = 
l
;

188  
s
;

189 
	}
}

190 
WldS
* 
	$tup_wld_s
(
TimeMacheEd
* 
bud_om
, 
Memy
* 
wld_s_memy
, 
SCENE_TYPE
 
go_to__backa
)

192 
WldS
* 
su
 = (WldS*)
	`memy_loc
(
wld_s_memy
, (WorldScene));

193 
su
->
go_to__backa
 = go_to_on_backspace;

194 
su
->
ϡ_ai_was_pt
 = 
l
;

195 cڡ 
num_gamees
 = 
bud_om
->
wld_e
.
num_v
;

196 
su
->
wld_e
.
num_v
 = 
num_gamees
;

197 
i
 = 0; i < 
num_gamees
; i++)

199 
su
->
wld_e
.
v_posi
[
i
] = 
bud_om
->world_state.level_position[i];

201 
i
 = 0; i < 
num_gamees
; i++)

203 
su
->
wld_e
.
v_sved
[
i
] = 
bud_om
->world_state.level_solved[i];

205 
i
 = 0; i < 
num_gamees
; i++)

207 
su
->
wld_e
.
v_e
[
i
] = 
	`gamee_e
(
bud_om
->wld_e.v_e[i], 
wld_s_memy
);

209 
i
 = 0; i < 
num_gamees
;i++)

211 
su
->
wld_e
.
v_mes
[
i
] = 
bud_om
->world_state.level_names[i];

213 
i
 = 0; i < 
num_gamees
;i++)

215 
su
->
wld_e
.
v_modes
[
i
] = 
bud_om
->world_state.level_modes[i];

219 
bo
 
de_fdg_ay
 = 
l
;

220 
i
 = 0; i < 
num_gamees
; i++)

222 
n
 = 
su
->
wld_e
.
v_e
[
i
]->
w
 *esu->wld_e.v_e[i]->
h
;

223 
z
 = 0; z < 
n
; z++)

224 i(
su
->
wld_e
.
v_e
[
i
]->
p
[
z
] =
P_PLAYER
)

226 
su
->
cut_v
 = 
i
;

227 
de_fdg_ay
 = 
ue
;

230 i(
de_fdg_ay
)

233 i(!
de_fdg_ay
)

235 
d
::
cout
 << "Yourdؚt wldh didn'cڏy, swn'pothwld. F܂ow,hiiash." << std::
dl
;

236 
	`abt
();

239  
su
;

240 
	}
}

241 
bo
 
	$y_vs__aive
(
WldS
* 
to_check
)

243 
i
 = 0; i < 
to_check
->
wld_e
.
num_v
; i++)

245 
GameS
* 
e
 = 
to_check
->
wld_e
.
v_e
[
i
];

246 
w
 = 
e
->w;

247 
h
 = 
e
->h;

248 
n
 = 
w
 * 
h
;

249 
z
 = 0; z < 
n
; z++)

251 i(
e
->
o
[
z
] =
Flo
::
F_START
 || s->o[z] =Flo::
F_STAIRCASE_LEVELSTART
)

252  
ue
;

255  
l
;

256 
	}
}

259 
WldPosi
 
	$wld_maybe_fd_ay
(
WldS
* 
s
)

261 
z
 = 0; z < 
s
->
wld_e
.
num_v
; z++)

263 
pos_1d
 = 
	`gamee_maybe_fd_ay
(
s
->
wld_e
.
v_e
[
z
]);

264 i(
pos_1d
 != -1)

266 
IPa
 
pos_2d
 = 
	`t2D
(
pos_1d
, 
s
->
wld_e
.
v_e
[
z
]->
w
, s->wld_e.v_e[z]->
h
);

267 
WldPosi
 
su
 = 
	`wld_make_wld_posi
(
z
,
pos_2d
,
pos_1d
);

268  
	`wld_make_wld_posi
(
z
,
pos_2d
,
pos_1d
);

271  
	`wld_make_wld_posi
(-1,
	`mh_a_
(-1,-1),-1);

272 
	}
}

274 
	gd
::
rg
 
	$wld_rlize_d
(
WldS
* 
wld
, 
Memy
* 
sce
, Memy* 
mp_memy
)

277 cڡ 
max_ngth
 = 10000;

278 
ouut_csumed
 = 0;

279 * 
ouut
 = (*)
	`memy_loc
(
mp_memy
, (* 
max_ngth
);

280 cڡ 
num_gamees
 = 
wld
->
wld_e
.
num_v
;

284 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "num_gamees:%d;\n", 
num_gamees
);

293 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "positions:");

294 
i
 = 0; i < 
num_gamees
; i++)

295 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "%d,%d,", 
wld
->
wld_e
.
v_posi
[
i
].
x
, wld->wld_e.v_posi[i].
y
);

296 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, ";\n");

300 
	`r_rlize_gamee_ys
(
ouut
, &
ouut_csumed
, 
max_ngth
, 
num_gamees
, 
wld
->
wld_e
.
v_e
);

303 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "names:");

304 
i
 = 0; i < 
num_gamees
; i++)

306 * 
me
 = 
wld
->
wld_e
.
v_mes
[
i
].name;

307 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "%s,", 
me
);

309 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, ";\n");

314 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "solved:");

315 
i
 = 0; i < 
num_gamees
; i++)

317 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, "%d,", 
wld
->
wld_e
.
v_sved
[
i
]);

319 
ouut_csumed
 +
	`rtf_s
(
ouut
 + ouut_csumed, 
max_ngth
, ";\n");

321  
d
::
	`rg
(
ouut
);

322 
	}
}

324 
WldS
* 
	$wld_derlize
(
d
::
rg
 
wld_rg
, 
Memy
* 
sce
, Memy* 
mp_memy
)

326 
WldS
* 
wld_e
 = 
	`r_derlize_timemache
(
wld_rg
, 
sce
, 
mp_memy
);

327 
WldS
* 
su
 = (WldS*)
	`memy_loc
(
sce
, (WorldScene));

330 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

332 
su
->
wld_e
.
v_e
[
i
] = 
NULL
;

334 
i
 = 0; i < 
MAX_NUMBER_GAMESTATES
; i++)

335 
j
 = 0; j < 
GAME_LEVEL_NAME_MAX_SIZE
;j++)

337 
su
->
wld_e
.
v_mes
[
i
].
me
[
j
] = '\0';

341 
su
->
wld_e
 = *world_state;

342 
su
->
cut_v
 = 
	`wld_maybe_fd_ay
esu).
v_dex
;

343 
su
->
a_we_d_v_om
 = 
	`wld_make_wld_posi_vid
();

344 
su
->
go_to__backa
 = 
SCENE_TYPE
::
ST_COUNT
;

345  
su
;

346 
	}
}

	@World.h

1 #agm



2 
	~"Mh.h
"

3 
	~"GameS.h
"

4 
	~"Ed.h
"

5 
	~"Animi.h
"

6 
	~"Cڡts.h
"

7 
	~<ioam
>

9 
	sWldS


12 
SCENE_TYPE
 
	mgo_to__backa
;

13 
WldPosi
 
	ma_we_d_v_om
;

14 
	mcut_v
;

16 
bo
 
	mϡ_ai_was_pt
;

18 
WldS
 
	mwld_e
;

21 
	sWldPyS


23 
IPa
 
	mdw_posi
;

24 
GameeTimeMache
* 
	mtime_mache
;

27 
wld_y_vsg_a
(
WldS
* 
s
);

28 
WldPyS
* 
wld_ay_ai
(
WldS
* 
s
, 
Dei
 
ai
, 
Memy
* 
v_memy
);

29 
WldS
* 
tup_wld_s
(
TimeMacheEd
* 
bud_om
, 
Memy
* 
wld_s_memy
, 
SCENE_TYPE
 
go_to__backa
);

30 
bo
 
y_vs__aive
(
WldS
* 
to_check
);

31 
WldS
* 
wld_derlize
(
d
::
rg
 
wld
, 
Memy
* 
sce
, Memy* 
mp
);

32 
WldPosi
 
wld_maybe_fd_ay
(
WldS
* 
s
);

	@draw.cpp

1 
	~"Mh.h
"

2 
	~"Shad.h
"

3 
	~<gd\gd.h
>

4 
	~"HrGL.h
"

5 
	~"dw.h
"

6 
	~"GameS.h
"

7 
	~"Resour.h
"

8 
	~"re.h
"

10 cڡ 
	gMAX_NUM_FULL_SPRITES
 = 100;

12 
	$dw_bck_box_ov_sn
(
GameSCama
 
sn
, 
SeWre
* 
fo
)

14 
fo
->
mrix_u
[fo->
num_dw
] = 
glm
::
	`m4
(1.0f);

15 
fo
->
mrix_u
[fo->
num_dw
] = 
glm
::
	`e
(fo->mrix_u[fo->num_dw], glm::
	`vec3
(
sn
.

, sn.
down
, 10));

16 
height
 = 
sn
.
up
 - sn.
down
;

17 
width
 = 
sn
.
right
 - sn.

;

18 
fo
->
mrix_u
[fo->
num_dw
] = 
glm
::
	`s
(fo->mrix_u[fo->num_dw], glm::
	`vec3
(
width
, 
height
, 1));

19 
fo
->
s_u
[fo->
num_dw
] = info->
s_mr
[
	`sour_o_to_re
(
F_ZBLACK
)];

20 
fo
->
num_dw
++;

21 
	}
}

22 
	$dw_oue_to_gamea
(
AABB
 
oue
, 
SeWre
* 
fo
)

24 
fo
->
mrix_u
[fo->
num_dw
] = 
glm
::
	`m4
(1.0f);

25 
fo
->
mrix_u
[fo->
num_dw
] = 
glm
::
	`e
(fo->mrix_u[fo->num_dw], glm::
	`vec3
(
oue
.
x
, oue.
y
, 5));

26 
fo
->
mrix_u
[fo->
num_dw
] = 
glm
::
	`s
(fo->mrix_u[fo->num_dw], glm::
	`vec3
(
oue
.
w
, oue.
h
, 1));

27 
fo
->
s_u
[fo->
num_dw
] = info->
s_mr
[
	`sour_o_to_re
(
F_ZBLACK
)];

28 
fo
->
num_dw
++;

29 
	}
}

30 
	$dw_gamees_oues_to_gamea
(
GameS
** 
gamees
, 
IPa
* 
offts
, 
ngth_funi_put
, 
SeWre
* 
fo
, 
sk_dex
)

32 
z
 = 0; z < 
sk_dex
; z++)

34 
w
 = 
gamees
[
z
]->w;

35 
h
 = 
gamees
[
z
]->h;

36 
IPa
 
tPos
 = 
offts
[
z
];

37 
glm
::
m4
 
f
 = glm::
	`m4
(1.0f);

38 
f
 = 
glm
::
	`e
(f, glm::
	`vec3
(
tPos
.
x
 - 
OUTLINE_DRAW_SIZE
, sPos.
y
 - OUTLINE_DRAW_SIZE, 0));

39 
f
 = 
glm
::
	`s
(f, glm::
	`vec3
(
w
 + 
OUTLINE_DRAW_SIZE
 * 2, 
h
 + OUTLINE_DRAW_SIZE * 2, 1));

40 
fo
->
mrix_u
[fo->
num_dw
] = 
f
;

41 
fo
->
s_u
[fo->
num_dw
] = info->
s_mr
[
	`sour_o_to_re
(
F_ZBLACK
)];

42 
fo
->
num_dw
++;

44 
z
 = 
sk_dex
 + 1; z < 
ngth_funi_put
; z++)

46 
w
 = 
gamees
[
z
]->w;

47 
h
 = 
gamees
[
z
]->h;

48 
IPa
 
tPos
 = 
offts
[
z
];

49 
glm
::
m4
 
f
 = glm::
	`m4
(1.0f);

50 
f
 = 
glm
::
	`e
(f, glm::
	`vec3
(
tPos
.
x
 - 
OUTLINE_DRAW_SIZE
, sPos.
y
 - OUTLINE_DRAW_SIZE, 0));

51 
f
 = 
glm
::
	`s
(f, glm::
	`vec3
(
w
 + 
OUTLINE_DRAW_SIZE
 * 2, 
h
 + OUTLINE_DRAW_SIZE * 2, 1));

52 
fo
->
mrix_u
[fo->
num_dw
] = 
f
;

53 
fo
->
s_u
[fo->
num_dw
] = info->
s_mr
[
	`sour_o_to_re
(
F_ZBLACK
)];

54 
fo
->
num_dw
++;

56 
	}
}

57 
	$dw_ui_to_gamea
(
GameSCama
 
dw_
, 
dex
, 
SeWre
* 
dw_fo
, 
glm
::
vec4
 
c
)

59 
cut_dw
 = 
dw_fo
->
num_dw
;

60 
dw_fo
->
s_u
[
cut_dw
] = dw_fo->
s_mr
[
dex
];

61 
dw_fo
->
mrix_u
[
cut_dw
] = 
glm
::
	`m4
(1.0f);

62 
dw_fo
->
mrix_u
[
cut_dw
] = 
glm
::
	`e
(dw_fo->mrix_u[cut_dw], glm::
	`vec3
(
dw_
.

, dw_.
down
, 1));

63 
width
 = 
dw_
.
right
 - dw_.

;

64 
height
 = 
dw_
.
up
 - dw_.
down
;

65 
dw_fo
->
mrix_u
[
cut_dw
] = 
glm
::
	`s
(dw_fo->mrix_u[cut_dw], glm::
	`vec3
(
width
, 
height
, 1));

66 
dw_fo
->
c_u
[
cut_dw
] = 
c
;

67 
dw_fo
->
num_dw
++;

69 
	}
};

70 
	$dw_bu_to_gamea
(
GameSCama
 
dw_
, 
SeWre
 * 
ui_dw
, 
glm
::
vec4
 
c
)

73 
width
 = 
dw_
.
right
 - dw_.

;

74 
height
 = 
dw_
.
up
 - dw_.
down
;

75 i(
height
 >
width
)

77 
	`ash_r
("we can't draw button if it isn'tteast 1x1,he draw won't work");

82 
GameSCama
 
_dw
 = 
dw_
;

83 
_dw
.
right
 =e_dw.

 + 0.5* 
height
;

84 
	`dw_ui_to_gamea
(
_dw
,
xtuAsts
::
UI
::
BuLeHf
, 
ui_dw
, 
c
);

88 
GameSCama
 
midd_dw
 = 
dw_
;

89 
midd_dw
.

 +0.5* 
height
;

90 
midd_dw
.
right
 -0.5* 
height
;

91 
	`dw_ui_to_gamea
(
midd_dw
, 
xtuAsts
::
UI
::
BuCr
, 
ui_dw
, 
c
);

93 i(
height
 !
width
)

95 
GameSCama
 
right_dw
 = 
dw_
;

96 
right_dw
.

 =ight_dw.
right
 - 0.5* 
height
;

97 
	`dw_ui_to_gamea
(
right_dw
,
xtuAsts
::
UI
::
BuRightHf
 ,
ui_dw
, 
c
);

100 
	}
}

102 
	$mask_re_usg_wdow
(
glm
::
vec4
* 
dw_sque
, glm::vec4* 
x_cod
, glm::vec4 
wdow
, glm::
vec2
 
x_movemt
)

104 
glm
::
vec4
 
xt_dw_sque
;

107 
xt_dw_sque
.
x
 = 
	`maxf
(
dw_sque
->x, 
wdow
.x);

108 
xt_dw_sque
.
z
 = 
	`mf
(
dw_sque
->z, 
wdow
.z);

109 
xt_dw_sque
.
y
 = 
	`maxf
(
dw_sque
->y, 
wdow
.y);

110 
xt_dw_sque
.
w
 = 
	`mf
(
dw_sque
->w, 
wdow
.w);

113 aut
dme_s_chge
 = [](
pos
, 
wdow
, 
ngth_sque
) -> 

115 
rage_chge
 = (
pos
 - 
wdow
/ 
ngth_sque
;

116  
rage_chge
;

118 
glm
::
vec4
 
xt_x_cod
;

120 
width
 = 
dw_sque
->
z
 - dw_sque->
x
;

121 
height
 = 
dw_sque
->
w
 - dw_sque->
y
;

123 

 = 
	`ampf
(0, 1, 0 - 
x_movemt
.
x
 / 
width
);

124 
right
 = 
	`ampf
(0, 1, 1 - 
x_movemt
.
x
 / 
width
);

125 
down
 = 
	`ampf
(0, 1, 0 - 
x_movemt
.
y
 / 
height
);

126 
up
 = 
	`ampf
(0, 1, 1 - 
x_movemt
.
y
 / 
height
);

128 
xt_x_cod
.
x
 = 
	`˽
(
x_cod
->x,ex_cod->
z
, 

);

129 
xt_x_cod
.
z
 = 
	`˽
(
x_cod
->
x
,ex_cod->z, 
right
);

130 
xt_x_cod
.
y
 = 
	`˽
(
x_cod
->y,ex_cod->
w
, 
down
);

131 
xt_x_cod
.
w
 = 
	`˽
(
x_cod
->
y
,ex_cod->w, 
up
);

134 *
dw_sque
 = 
xt_dw_sque
;

135 *
x_cod
 = 
xt_x_cod
;

136 
	}
}

137 
	$dw_y_to_gamea
(
GameS
** 
gamees
, 
IPa
* 
offts
, 
numb_of_gamees
, 
SeWre
* 
fo
, 
y_dex
)

139 
i
 = 
y_dex
;

141 
z
 = 0; z < 
numb_of_gamees
; z++)

143 
GameS
* 
gamee
 = 
gamees
[
z
];

144 
IPa
 
offt
 = 
offts
[
z
];

145 * 
cut_y
 = 
	`gamee_g_y
(
gamee
,
y_dex
);

146 
num_emts__gamee
 = 
gamee
->
w
 * gamee->
h
;

147 
k
 = 0; k < 
num_emts__gamee
; k++)

149 
e
 = 
cut_y
[
k
];

150 
e_image
 = 
	`sour_y_vue_to_y_re_vue
(
e
, 
i
);

151 
fo
->
s_u
[fo->
num_dw
 + 
k
] = info->
s_mr
[
e_image
];

152 
IPa
 
p
 = 
	`t2D
(
k
, 
gamee
->
w
, gamee->
h
);

153 
glm
::
vec3
 
e
 = glm::
	`vec3
(
offt
.
x
 + 
p
.x, offt.
y
 +.y, 
Z_POSITION_STARTING_LAYER
 + 
i
);

154 
fo
->
mrix_u
[fo->
num_dw
 + 
k
] = 
	`mh_ed_mrix
(
e
);

155 
fo
->
c_u
[fo->
num_dw
+ 
k
] = 
glm
::
	`vec4
(1, 1, 1, 1);

157 
fo
->
num_dw
 +
num_emts__gamee
;

160 
	}
}

161 
	$dw_re
(
s_e
, 
glm
::
m4
 
posi
, 
SeWre
* 
wre_to
)

163 
glm
::
vec4
 
s_cods
 = 
wre_to
->
s_mr
[
s_e
];

164 
d
 = 
wre_to
->
num_dw
;

165 
wre_to
->
s_u
[
d
] = 
s_cods
;

166 
wre_to
->
mrix_u
[
d
] = 
posi
;

167 
wre_to
->
c_u
[
d
] = 
glm
::
	`vec4
(1, 1, 1, 1);

168 
wre_to
->
num_dw
++;

169 
	}
}

173 
dw_p_da
(
PDa
 
p_da
, 
glm
::
vec2
 
dw_t
, 
SeWre
* 
symbs
, glm::
vec3
 
glob_s
 = glm::
	$vec3
(1,1,1))

176 
ngth
 = 
CP_COUNT
;

177 
tٮ
 = 0;

178 
i
 = 0; i < 
ngth
; i++)

179 
tٮ
 +
p_da
.
pows
[
i
];

181 
num_dwn
 = 0;

182 
width
 = (
	`
(
	`sq
(
tٮ
));

184 
j
 = 0; j < 
ngth
; j++)

186 i(
p_da
.
pows
[
j
])

189 
to_dw
 = 
	`pda_to_symb
((
CPow

j
);

190 
glm
::
vec3
 
dw_posi
 = glm::
	`vec3
(
num_dwn
 % 
width
,um_drawn / width, 6);

191 
glm
::
vec3
 
s
 = glm::
	`vec3
(1.0 / ()
width
, 1.0 / ()width, 1);

192 
s
.
x
 -= 0.10f;

193 
s
.
y
 -= 0.10f;

194 
dw_posi
.
x
 /()
width
;

195 
dw_posi
.
y
 /()
width
;

196 
dw_posi
.
x
 +
dw_t
.x;

197 
dw_posi
.
y
 +
dw_t
.y;

198 
dw_posi
.
x
 += 0.05f;

199 
dw_posi
.
y
 += 0.05f;

200 
num_dwn
++;

201 
glm
::
m4
 
mrix_dwn
 = 
	`mh_ed_sd_mrix
(
dw_posi
, 
s
 * 
glob_s
);

202 
	`dw_re
(
to_dw
, 
mrix_dwn
, 
symbs
);

206 
	}
};

208 
	$dw_gamee_ps
(
GameS
* 
gamee
, 
IPa
 
offt
, 
AWre
* 
fo
)

210 
GameS
* 
xt
 = 
gamee
;

211 
i
 = 0; i < 
xt
->
w
 *ext->
h
; i++)

212 i(
xt
->
p
[
i
] =
P_CRATE
)

214 
PDa
 
p_da
 = 
xt
->p_da[
i
];

215 
IPa
 
e_offt
 = 
offt
;

216 
IPa
 
grid_offt
 = 
	`t2D
(
i
, 
xt
->
w
,ext->
h
);

217 
glm
::
vec2
 
dw_offt
 = glm::
	`vec2
(
e_offt
.
x
 + 
grid_offt
.x, s_offt.
y
 + grid_offset.y);

218 
	`dw_p_da
(
p_da
, 
dw_offt
, 
fo
->
symb
);

221 
	}
}

223 
	$dw_gamea
(
GameS
** 
gamees
, 
IPa
* 
offts
, 
numb_of_gamees
, 
AWre
* 
fo
)

227 
	`dw_y_to_gamea
(
gamees
, 
offts
, 
numb_of_gamees
, 
fo
->
o
, 0);

228 
	`dw_y_to_gamea
(
gamees
, 
offts
, 
numb_of_gamees
, 
fo
->
p
, 1);

230 
z
 = 0; z < 
numb_of_gamees
;z++)

232 
GameS
* 
xt
 = 
gamees
[
z
];

233 
IPa
 
offt
 = 
offts
[
z
];

234 
	`dw_gamee_ps
(
xt
, 
offt
, 
fo
);

237 
	}
}

239 
	$dw_ˉe
(
IPa
 
ˋ_sn_t
,

240 
GameSCama
 
ma_game
,

241 
VwPtCama
 
ma_vwpt
,

242 
EdUIS
* 
ui_e
,

243 
ˋ_ngth
,

244 
GameeBrush
* 
ˋ
,

245 
AWre
* 
y_dw
)

250 
glm
::
vec2
 
ˋ_ue_t
 = 
	`mh_sna_to_gamea
(
ˋ_sn_t
, 
ma_game
, 
ma_vwpt
, 
ui_e
->
game_height_cut
);

251 
i
 = 0; i < 
ˋ_ngth
; i++)

253 i(
ˋ
[
i
].
yFlo
)

255 
SeWre
* 
o
 = 
y_dw
->floor;

256 
e_image
 = 
	`sour_y_vue_to_y_re_vue
(
ˋ
[
i
].
o
, 
LN_FLOOR
);

257 
o
->
s_u
[o->
num_dw
] = flo->
s_mr
[
e_image
];

258 
o
->
mrix_u
[o->
num_dw
] = 
	`mh_ed_mrix
(
glm
::
	`vec3
(
ˋ_ue_t
.
x
 + 
i
,e_ue_t.
y
,4));

259 
o
->
c_u
[o->
num_dw
] = 
glm
::
	`vec4
(1, 1, 1, 1);

260 
o
->
num_dw
++;

262 i(
ˋ
[
i
].
yP
)

266 
SeWre
* 
p
 = 
y_dw
->piece;

267 
e_image
 = 
	`sour_y_vue_to_y_re_vue
(
ˋ
[
i
].
p
, 
LN_PIECE
);

268 
p
->
s_u
[p->
num_dw
] =->
s_mr
[
e_image
];

269 
p
->
mrix_u
[p->
num_dw
] = 
	`mh_ed_mrix
(
glm
::
	`vec3
(
ˋ_ue_t
.
x
 + 
i
,e_ue_t.
y
, 5));

270 
p
->
c_u
[p->
num_dw
] = 
glm
::
	`vec4
(1, 1, 1, 1);

271 
p
->
num_dw
++;

274 if(
ˋ
[
i
].
yCPow
)

277 
PDa
 
p_da
 = 
ˋ
[
i
].piece_data;

278 
	`dw_p_da
(
p_da
,
glm
::
	`vec2
(
ˋ_ue_t
.
x
 + 
i
,ˋ_ue_t.
y
), 
y_dw
->
symb
, glm::
	`vec3
(1,1,1));

282 
	}
}

	@draw.h

1 #agm



2 
	~"Animi.h
"

3 
	~"Ed.h
"

4 
	~"Click.h
"

5 
	~"re.h
"

6 
	~"xtuAsts.h
"

10 
dw_y_to_gamea
(
GameS
** 
gamees
, 
IPa
* 
offts
, 
numb_of_gamees
, 
SeWre
* 
fo
, 
y_dex
);

11 
dw_gamea
(
GameS
** 
gamees
, 
IPa
* 
offts
, 
numb_of_gamees
, 
AWre
* 
fo
);

12 
dw_gamees_oues_to_gamea
(

13 
GameS
** 
gamees
,

14 
IPa
* 
offts
,

15 
ngth_funi_put
,

16 
SeWre
* 
fo
,

17 
dex
);

18 
dw_ˉe
(
IPa
 
ˋ_sn_t
,

19 
GameSCama
 
ma_game
,

20 
VwPtCama
 
ma_vwpt
,

21 
EdUIS
* 
ui_e
,

22 
ˋ_ngth
,

23 
GameeBrush
* 
ˋ
,

24 
AWre
* 
y_dw
);

25 
dw_bck_box_ov_sn
(
GameSCama
 
sn
, 
SeWre
* 
fo
);

26 
dw_oue_to_gamea
(
AABB
 
oue
, 
SeWre
* 
fo
);

27 
dw_bu_to_gamea
(
GameSCama
 
dw_
, 
SeWre
* 
ui_dw
, 
glm
::
vec4
 
c
 = glm::vec4(1,1,1,1));

28 
dw_ui_to_gamea
(
GameSCama
 
dw_
, 
dex
, 
SeWre
* 
dw_fo
, 
glm
::
vec4
 
c
 = glm::vec4(1, 1, 1, 1));

	@gui.h

1 #agm



2 
	~<rg
>

3 
	~"glm/glm.h
"

5 (*
	tgui_funi
)();

6 
	sGUI


11 
	sGUI_Text


13 
d
::
rg
 
xt
;

14 
glm
::
vec3
 
posi
;

15 
glm
::
vec2
 
s
;

18 
	sGUI_Bu


20 
d
::
rg
 
xt
;

21 
glm
::
vec3
 
posi
;

22 
glm
::
vec2
 
s
;

23 
glm
::
vec4
 
c
;

24 
gui_funi
 
funi
;

26 
	sGUI_Bus


28 
d
::
rg
* 
xts
;

29 
glm
::
vec3
* 
posis
;

30 
glm
::
vec2
 
ss
;

31 
glm
::
vec4
 
cs
;

32 
gui_funi
* 
funis
;

34 
	sGUI_Mu


36 
ngth
;

37 
bu_ed
;

38 
GUI_Bu
* 
bus
;

41 
	$lcuϋ_bu_icked_adly
(
GUI_Bu
* 
bus
, 
glm
::
vec2
 
moupos
)

44 
	}
}

	@sprite.cpp

1 
	~"re.h
"

3 
SeWre
* 
	$re_wre_make
(
GLut
 
s_xtu
, 
Shad
 
shad
, 
Memy
* 
rmt_memy
, 
max_dw
, GLu
vtis_VBO
, GLu
vtis_EBO
, 
glm
::
vec4
* 
s_mr
)

5 
SeWre
* 
su
 = (SeWre*)
	`memy_loc
(
rmt_memy
, (SpriteWrite));

6 
su
->
shad
 = shader;

7 
su
->
s_xtu
 =tlas_texture;

8 
su
->
max_dw
 = 0;

9 
su
->
num_dw
 = 0;

10 
su
->
s_u
 = (
glm
::
vec4
*
	`memy_loc
(
rmt_memy
, 
max_dw
 * (glm::vec4));

11 
su
->
s_mr
 =tlas_mapper;

12 
su
->
mrix_u
 = (
glm
::
m4
*
	`memy_loc
(
rmt_memy
, 
max_dw
 * (glm::mat4));

13 
su
->
c_u
 = (
glm
::
vec4
*
	`memy_loc
(
rmt_memy
, 
max_dw
 * (glm::vec4));

15 
	`shad_u
(
shad
);

18 
	`glGVxAays
(1, &
su
->
VAO
);

19 
	`glBdVxAay
(
su
->
VAO
);

21 
	`glGVxAays
(1, &
su
->
VAO
); 
CHK


22 
	`glBdVxAay
(
su
->
VAO
); 
CHK


24 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
vtis_VBO
); 
CHK


25 
	`glBdBufr
(
GL_ELEMENT_ARRAY_BUFFER
, 
vtis_EBO
); 
CHK


27 
posi
 = 
	`glGAribLoti
(
shad
, "pos"); 
CHK


28 
	`glVxAribPor
(
posi
, 3, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)0); 
CHK


29 
	`glEbVxAribAay
(
posi
); 
CHK


31 
xCod
 = 
	`glGAribLoti
(
shad
, "putTexCod"); 
CHK


32 
	`glVxAribPor
(
xCod
, 2, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)(3 * ())); 
CHK


33 
	`glEbVxAribAay
(
xCod
); 
CHK


35 
	`glGBufrs
(1, &
su
->
mrix_buf
); 
CHK


36 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
su
->
mrix_buf
); 
CHK


37 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (
glm
::
m4
* 
max_dw
, 
NULL
, 
GL_DYNAMIC_DRAW
); 
CHK


39 
mrixOfft
 = 4;

40 
	`glVxAribPor
(
mrixOfft
, 4, 
GL_FLOAT
, 
l
, 16 * (), (*)0); 
CHK


41 
	`glVxAribPor
(
mrixOfft
 + 1, 4, 
GL_FLOAT
, 
l
, 16 * (), (*)(4 * ())); 
CHK


43 
	`glVxAribPor
(
mrixOfft
 + 2, 4, 
GL_FLOAT
, 
l
, 16 * (), (*)(8 * ())); 
CHK


44 
	`glVxAribPor
(
mrixOfft
 + 3, 4, 
GL_FLOAT
, 
l
, 16 * (), (*)(12 * ())); 
CHK


45 
	`glEbVxAribAay
(
mrixOfft
); 
CHK


46 
	`glEbVxAribAay
(
mrixOfft
 + 1); 
CHK


47 
	`glEbVxAribAay
(
mrixOfft
 + 2); 
CHK


48 
	`glEbVxAribAay
(
mrixOfft
 + 3); 
CHK


49 
	`glVxAribDivis
(
mrixOfft
, 1); 
CHK


50 
	`glVxAribDivis
(
mrixOfft
 + 1, 1); 
CHK


51 
	`glVxAribDivis
(
mrixOfft
 + 2, 1); 
CHK


52 
	`glVxAribDivis
(
mrixOfft
 + 3, 1); 
CHK


54 
	`glGBufrs
(1, &
su
->
s_buf
); 
CHK


55 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
su
->
s_buf
); 
CHK


56 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (
glm
::
vec4
* 
max_dw
, 
NULL
, 
GL_DYNAMIC_DRAW
); 
CHK


58 
sOfft
 = 
	`glGAribLoti
(
shad
, "atlasCoord");

59 
	`glVxAribPor
(
sOfft
, 4, 
GL_FLOAT
, 
l
, 4 * (), (*)(0)); 
CHK


60 
	`glEbVxAribAay
(
sOfft
); 
CHK


61 
	`glVxAribDivis
(
sOfft
, 1); 
CHK


63 
	`glGBufrs
(1, &
su
->
c_buf
); 
CHK


64 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
su
->
c_buf
); 
CHK


65 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (
glm
::
vec4
* 
max_dw
, 
NULL
, 
GL_DYNAMIC_DRAW
); 
CHK


67 
cOfft
 = 3;

68 
	`glVxAribPor
(
cOfft
, 4, 
GL_FLOAT
, 
l
, 4 * (), (*)(0)); 
CHK


69 
	`glEbVxAribAay
(
cOfft
); 
CHK


70 
	`glVxAribDivis
(
cOfft
, 1); 
CHK


71 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
vtis_VBO
); 
CHK


72 
	`glBdBufr
(
GL_ELEMENT_ARRAY_BUFFER
, 
vtis_EBO
); 
CHK


74  
su
;

75 
	}
}

77 
	$re_wre_out
(
SeWre
* 
out
, 
glm
::
m4
 
ma
)

79 
	`shad_t_unifm_m4
(
out
->
shad
, "vwProjeiMrix", 
ma
);

81 
	`glUProgm
(
out
->
shad
);

82 
	`glBdVxAay
(
out
->
VAO
);

83 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
out
->
s_buf
);

84 
	`glBufrSubDa
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec4
* 
out
->
num_dw
, out->
s_u
);

86 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
out
->
mrix_buf
);

87 
	`glBufrSubDa
(
GL_ARRAY_BUFFER
, 0, (
glm
::
m4
* 
out
->
num_dw
, out->
mrix_u
);

89 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
out
->
c_buf
);

90 
	`glBufrSubDa
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec4
* 
out
->
num_dw
, out->
c_u
);

92 
	`glBdTextu
(
GL_TEXTURE_2D
, 
out
->
s_xtu
);

93 
	`glDwEmtsInd
(
GL_TRIANGLES
, 6, 
GL_UNSIGNED_INT
, 0, 
out
->
num_dw
);

94 
	}
}

	@sprite.h

1 #agm



3 #agm



5 
	~"Mh.h
"

6 
	~"Shad.h
"

7 
	~"HrGL.h
"

8 
	~"TextDw.h
"

11 
	tut
;

16 
	sSeWre
 {

17 
Shad
 
	mshad
;

18 
ut
 
	ms_xtu
;

20 
ut
 
	mVAO
;

21 
ut
 
	mmrix_buf
;

22 
ut
 
	ms_buf
;

23 
ut
 
	mc_buf
;

25 
ut
 
	mmax_dw
;

26 
ut
 
	mnum_dw
;

27 
	mglm
::
vec4
* 
s_mr
;

28 
	mglm
::
vec4
* 
s_u
;

29 
	mglm
::
m4
* 
mrix_u
;

30 
	mglm
::
vec4
* 
c_u
;

32 
	sAWre


34 
SeWre
* 
	mo
;

35 
SeWre
* 
	mp
;

36 
SeWre
* 
	msymb
;

37 
SeWre
* 
	mui
;

38 
TextWre
* 
	mxt
;

41 
SeWre
* 
re_wre_make
(
GLut
 
s_xtu
, 
Shad
 
shad
, 
Memy
* 
rmt_memy
, 
max_dw
, GLu
vtis_VBO
, GLu
vtis_EBO
, 
glm
::
vec4
* 
s_mr
);

43 
re_wre_out
(
SeWre
* 
out
, 
glm
::
m4
 
ma
);

	@stb_image.h

114 #ide
STBI_INCLUDE_STB_IMAGE_H


115 
	#STBI_INCLUDE_STB_IMAGE_H


	)

323 #ide
STBI_NO_STDIO


324 
	~<dio.h
>

327 
	#STBI_VERSION
 1

	)

331 
	mSTBI_deu
 = 0,

333 
	mSTBI_gy
 = 1,

334 
	mSTBI_gy_pha
 = 2,

335 
	mSTBI_rgb
 = 3,

336 
	mSTBI_rgb_pha
 = 4

339 
	~<dlib.h
>

340 
	tbi_uc
;

341 
	tbi_us
;

343 #ifde
__lulus


347 #ide
STBIDEF


348 #ifde
STB_IMAGE_STATIC


349 
	#STBIDEF
 

	)

351 
	#STBIDEF
 

	)

366 (*
ad
(*
ur
,*
da
,
size
);

367 (*
sk
(*
ur
,
n
);

368 (*
eof
(*
ur
);

369 } 
	tbi_io_backs
;

376 
STBIDEF
 
bi_uc
 *
bi_ld_om_memy
 (bi_ucڡ *
bufr
, 
n
 , *
x
, *
y
, *
chls__fe
, 
desed_chls
);

377 
STBIDEF
 
bi_uc
 *
bi_ld_om_backs
(
bi_io_backs
 cڡ *
bk
 , *
ur
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

379 #ide
STBI_NO_STDIO


380 
STBIDEF
 
bi_uc
 *
bi_ld
 (cڡ *
fame
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

381 
STBIDEF
 
bi_uc
 *
bi_ld_om_fe
 (
FILE
 *
f
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

385 #ide
STBI_NO_GIF


386 
STBIDEF
 
bi_uc
 *
bi_ld_gif_om_memy
(bi_ucڡ *
bufr
, 
n
, **
days
, *
x
, *
y
, *
z
, *
comp
, 
q_comp
);

389 #ifde
STBI_WINDOWS_UTF8


390 
STBIDEF
 
bi_cvt_wch_to_utf8
(*
bufr
, 
size_t
 
buf㾒
, cڡ 
wch_t
* 
put
);

398 
STBIDEF
 
bi_us
 *
bi_ld_16_om_memy
 (
bi_uc
 cڡ *
bufr
, 
n
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

399 
STBIDEF
 
bi_us
 *
bi_ld_16_om_backs
(
bi_io_backs
 cڡ *
bk
, *
ur
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

401 #ide
STBI_NO_STDIO


402 
STBIDEF
 
bi_us
 *
bi_ld_16
 (cڡ *
fame
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

403 
STBIDEF
 
bi_us
 *
bi_ld_om_fe_16
(
FILE
 *
f
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

410 #ide
STBI_NO_LINEAR


411 
STBIDEF
 *
bi_ldf_om_memy
 (
bi_uc
 cڡ *
bufr
, 
n
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

412 
STBIDEF
 *
bi_ldf_om_backs
 (
bi_io_backs
 cڡ *
bk
, *
ur
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

414 #ide
STBI_NO_STDIO


415 
STBIDEF
 *
bi_ldf
 (cڡ *
fame
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

416 
STBIDEF
 *
bi_ldf_om_fe
 (
FILE
 *
f
, *
x
, *
y
, *
chls__fe
, 
desed_chls
);

420 #ide
STBI_NO_HDR


421 
STBIDEF
 
bi_hdr_to_ldr_gamma
(
gamma
);

422 
STBIDEF
 
bi_hdr_to_ldr_s
(
s
);

425 #ide
STBI_NO_LINEAR


426 
STBIDEF
 
bi_ldr_to_hdr_gamma
(
gamma
);

427 
STBIDEF
 
bi_ldr_to_hdr_s
(
s
);

431 
STBIDEF
 
bi_is_hdr_om_backs
(
bi_io_backs
 cڡ *
bk
, *
ur
);

432 
STBIDEF
 
bi_is_hdr_om_memy
(
bi_uc
 cڡ *
bufr
, 
n
);

433 #ide
STBI_NO_STDIO


434 
STBIDEF
 
bi_is_hdr
 (cڡ *
fame
);

435 
STBIDEF
 
bi_is_hdr_om_fe
(
FILE
 *
f
);

441 
STBIDEF
 cڡ *
bi_u_as
 ();

444 
STBIDEF
 
bi_image_
 (*
tv_om_bi_ld
);

447 
STBIDEF
 
bi_fo_om_memy
(
bi_uc
 cڡ *
bufr
, 
n
, *
x
, *
y
, *
comp
);

448 
STBIDEF
 
bi_fo_om_backs
(
bi_io_backs
 cڡ *
bk
, *
ur
, *
x
, *
y
, *
comp
);

449 
STBIDEF
 
bi_is_16_b_om_memy
(
bi_uc
 cڡ *
bufr
, 
n
);

450 
STBIDEF
 
bi_is_16_b_om_backs
(
bi_io_backs
 cڡ *
bk
, *
ur
);

452 #ide
STBI_NO_STDIO


453 
STBIDEF
 
bi_fo
 (cڡ *
fame
, *
x
, *
y
, *
comp
);

454 
STBIDEF
 
bi_fo_om_fe
 (
FILE
 *
f
, *
x
, *
y
, *
comp
);

455 
STBIDEF
 
bi_is_16_b
 (cڡ *
fame
);

456 
STBIDEF
 
bi_is_16_b_om_fe
(
FILE
 *
f
);

464 
STBIDEF
 
bi_t_uŻmuɝly__ld
(
ag_ue_if_should_uŻmuɝly
);

468 
STBIDEF
 
bi_cvt_he_g_to_rgb
(
ag_ue_if_should_cvt
);

471 
STBIDEF
 
bi_t__vtiy__ld
(
ag_ue_if_should_
);

476 
STBIDEF
 
bi_t__vtiy__ld_thad
(
ag_ue_if_should_
);

480 
STBIDEF
 *
bi_zlib_decode_mloc_guesssize
(cڡ *
bufr
, 
n
, 
l_size
, *
ou
);

481 
STBIDEF
 *
bi_zlib_decode_mloc_guesssize_hdag
(cڡ *
bufr
, 
n
, 
l_size
, *
ou
, 
r_hd
);

482 
STBIDEF
 *
bi_zlib_decode_mloc
(cڡ *
bufr
, 
n
, *
ou
);

483 
STBIDEF
 
bi_zlib_decode_bufr
(*
obufr
, 
ޒ
, cڡ *
ibufr
, 

);

485 
STBIDEF
 *
bi_zlib_decode_nohd_mloc
(cڡ *
bufr
, 
n
, *
ou
);

486 
STBIDEF
 
bi_zlib_decode_nohd_bufr
(*
obufr
, 
ޒ
, cڡ *
ibufr
, 

);

489 #ifde
__lulus


498 #ifde
STB_IMAGE_IMPLEMENTATION


500 #i
defed
(
STBI_ONLY_JPEG
|| defed(
STBI_ONLY_PNG
|| defed(
STBI_ONLY_BMP
) \

501 || 
defed
(
STBI_ONLY_TGA
|| defed(
STBI_ONLY_GIF
|| defed(
STBI_ONLY_PSD
) \

502 || 
defed
(
STBI_ONLY_HDR
|| defed(
STBI_ONLY_PIC
|| defed(
STBI_ONLY_PNM
) \

503 || 
	$defed
(
STBI_ONLY_ZLIB
)

504 #ide
STBI_ONLY_JPEG


505 
	#STBI_NO_JPEG


	)

507 #ide
STBI_ONLY_PNG


508 
	#STBI_NO_PNG


	)

510 #ide
STBI_ONLY_BMP


511 
	#STBI_NO_BMP


	)

513 #ide
STBI_ONLY_PSD


514 
	#STBI_NO_PSD


	)

516 #ide
STBI_ONLY_TGA


517 
	#STBI_NO_TGA


	)

519 #ide
STBI_ONLY_GIF


520 
	#STBI_NO_GIF


	)

522 #ide
STBI_ONLY_HDR


523 
	#STBI_NO_HDR


	)

525 #ide
STBI_ONLY_PIC


526 
	#STBI_NO_PIC


	)

528 #ide
STBI_ONLY_PNM


529 
	#STBI_NO_PNM


	)

533 #i
	`defed
(
STBI_NO_PNG
&& !defed(
STBI_SUPPORT_ZLIB
&& !defed(
STBI_NO_ZLIB
)

534 
	#STBI_NO_ZLIB


	)

538 
	~<dg.h
>

539 
	~<ddef.h
>

540 
	~<dlib.h
>

541 
	~<rg.h
>

542 
	~<lims.h
>

544 #i!
	`defed
(
STBI_NO_LINEAR
|| !defed(
STBI_NO_HDR
)

545 
	~<mh.h
>

548 #ide
STBI_NO_STDIO


549 
	~<dio.h
>

552 #ide
STBI_ASSERT


553 
	~<as.h
>

554 
	#STBI_ASSERT
(
x

	`as
(x)

	)

557 #ifde
__lulus


558 
	#STBI_EXTERN
 "C"

	)

560 
	#STBI_EXTERN
 

	)

564 #ide
_MSC_VER


565 #ifde
__lulus


566 
	#bi_le
 
le


	)

568 
	#bi_le


	)

571 
	#bi_le
 
__fle


	)

574 #ide
STBI_NO_THREAD_LOCALS


575 #i
	`defed
(
__lulus
) && __cplusplus >= 201103L

576 
	#STBI_THREAD_LOCAL
 
thad_lol


	)

577 #i
	`defed
 (
__STDC_VERSION__
) && __STDC_VERSION__ >= 201112L

578 
	#STBI_THREAD_LOCAL
 
_Thad_lol


	)

579 #i
	`defed
(
__GNUC__
)

580 
	#STBI_THREAD_LOCAL
 
__thad


	)

581 #i
	`defed
(
_MSC_VER
)

582 
	#STBI_THREAD_LOCAL
 
	`__deec
(
thad
)

	)

586 #ifde
_MSC_VER


587 
	tbi__ut16
;

588 sigd 
	tbi__t16
;

589 
	tbi__ut32
;

590 sigd 
	tbi__t32
;

592 
	~<dt.h
>

593 
ut16_t
 
	tbi__ut16
;

594 
t16_t
 
	tbi__t16
;

595 
ut32_t
 
	tbi__ut32
;

596 
t32_t
 
	tbi__t32
;

600 
	tvide_ut32
[(
bi__ut32
)==4 ? 1 : -1];

602 #ifde
_MSC_VER


603 
	#STBI_NOTUSED
(
v
()(v)

	)

605 
	#STBI_NOTUSED
(
v
()(v)

	)

608 #ifde
_MSC_VER


609 
	#STBI_HAS_LROTL


	)

612 #ifde
STBI_HAS_LROTL


613 
	#bi_
(
x
,
y

	`_l
(x,y)

	)

615 
	#bi_
(
x
,
y
(((x<< (y)| ((x>> (32 - (y))))

	)

618 #i
	`defed
(
STBI_MALLOC
&& defed(
STBI_FREE
&& (defed(
STBI_REALLOC
|| defed(
STBI_REALLOC_SIZED
))

620 #i!
	`defed
(
STBI_MALLOC
&& !defed(
STBI_FREE
&& !defed(
STBI_REALLOC
&& !defed(
STBI_REALLOC_SIZED
)

626 #ide
STBI_MALLOC


627 
	#STBI_MALLOC
(
sz

	`mloc
(sz)

	)

628 
	#STBI_REALLOC
(
p
,
wsz

	`loc
,wsz)

	)

629 
	#STBI_FREE
(
p

	`
)

	)

632 #ide
STBI_REALLOC_SIZED


633 
	#STBI_REALLOC_SIZED
(
p
,
dsz
,
wsz

	`STBI_REALLOC
,wsz)

	)

637 #i
	`defed
(
__x86_64__
|| defed(
_M_X64
)

638 
	#STBI__X64_TARGET


	)

639 #i
	`defed
(
__i386
|| defed(
_M_IX86
)

640 
	#STBI__X86_TARGET


	)

643 #i
	`defed
(
__GNUC__
&& defed(
STBI__X86_TARGET
&& !defed(
__SSE2__
&& !defed(
STBI_NO_SIMD
)

651 
	#STBI_NO_SIMD


	)

654 #i
	`defed
(
__MINGW32__
&& defed(
STBI__X86_TARGET
&& !defed(
STBI_MINGW_ENABLE_SSE2
&& !defed(
STBI_NO_SIMD
)

666 
	#STBI_NO_SIMD


	)

669 #i!
	`defed
(
STBI_NO_SIMD
&& (defed(
STBI__X86_TARGET
|| defed(
STBI__X64_TARGET
))

670 
	#STBI_SSE2


	)

671 
	~<emm.h
>

673 #ifde
_MSC_VER


675 #i
_MSC_VER
 >= 1400

676 
	~<.h
>

677 
	$bi__uid3
()

679 
fo
[4];

680 
	`__uid
(
fo
,1);

681  
fo
[3];

682 
	}
}

684 
	$bi__uid3
()

686 
s
;

687 
__asm
 {

688 
mov
 
x
,1

689 
uid


690 
mov
 
s
,
edx


692  
s
;

693 
	}
}

696 
	#STBI_SIMD_ALIGN
(
ty
, 
me

	`__deec
(
	`ign
(16)ty 
	)
name

698 #i!
defed
(
STBI_NO_JPEG
&& defed(
STBI_SSE2
)

699 
	$bi__s2_avaab
()

701 
fo3
 = 
	`bi__uid3
();

702  ((
fo3
 >> 26) & 1) != 0;

703 
	}
}

707 
	#STBI_SIMD_ALIGN
(
ty
, 
me
tyam
	`__ibu__
((
	`igd
(16)))

	)

709 #i!
defed
(
STBI_NO_JPEG
&& defed(
STBI_SSE2
)

710 
	$bi__s2_avaab
()

716 
	}
}

723 #i
defed
(
STBI_NO_SIMD
&& defed(
STBI_NEON
)

724 #unde
STBI_NEON


727 #ifde
STBI_NEON


728 
	~<m_.h
>

730 
	#STBI_SIMD_ALIGN
(
ty
, 
me
tyam
	`__ibu__
((
	`igd
(16)))

	)

733 #ide
STBI_SIMD_ALIGN


734 
	#STBI_SIMD_ALIGN
(
ty
, 
me
ty 
	)
name

745 
bi__ut32
 
	mimg_x
, 
	mimg_y
;

746 
	mimg_n
, 
	mimg_out_n
;

748 
bi_io_backs
 
	mio
;

749 *
	mio_ur_da
;

751 
	mad_om_backs
;

752 
	mbu
;

753 
bi_uc
 
	mbufr_t
[128];

755 
bi_uc
 *
	mimg_bufr
, *
	mimg_bufr_d
;

756 
bi_uc
 *
	mimg_bufr_ig
, *
	mimg_bufr_ig_d
;

757 } 
	tbi__cڋxt
;

760 
bi__fl_bufr
(
bi__cڋxt
 *
s
);

763 
	$bi__t_mem
(
bi__cڋxt
 *
s
, 
bi_uc
 cڡ *
bufr
, 
n
)

765 
s
->
io
.
ad
 = 
NULL
;

766 
s
->
ad_om_backs
 = 0;

767 
s
->
img_bufr
 = s->
img_bufr_ig
 = (
bi_uc
 *
bufr
;

768 
s
->
img_bufr_d
 = s->
img_bufr_ig_d
 = (
bi_uc
 *
bufr
+
n
;

769 
	}
}

772 
	$bi__t_backs
(
bi__cڋxt
 *
s
, 
bi_io_backs
 *
c
, *
ur
)

774 
s
->
io
 = *
c
;

775 
s
->
io_ur_da
 = 
ur
;

776 
s
->
bu
 = (s->
bufr_t
);

777 
s
->
ad_om_backs
 = 1;

778 
s
->
img_bufr_ig
 = s->
bufr_t
;

779 
	`bi__fl_bufr
(
s
);

780 
s
->
img_bufr_ig_d
 = s->
img_bufr_d
;

781 
	}
}

783 #ide
STBI_NO_STDIO


785 
	$bi__dio_ad
(*
ur
, *
da
, 
size
)

787  (
	`d
(
da
,1,
size
,(
FILE
*
ur
);

788 
	}
}

790 
	$bi__dio_sk
(*
ur
, 
n
)

792 
	`fek
((
FILE
*
ur
, 
n
, 
SEEK_CUR
);

793 
	}
}

795 
	$bi__dio_eof
(*
ur
)

797  
	`of
((
FILE
*
ur
);

798 
	}
}

800 
bi_io_backs
 
	gbi__dio_backs
 =

802 
bi__dio_ad
,

803 
bi__dio_sk
,

804 
bi__dio_eof
,

807 
	$bi__t_fe
(
bi__cڋxt
 *
s
, 
FILE
 *
f
)

809 
	`bi__t_backs
(
s
, &
bi__dio_backs
, (*
f
);

810 
	}
}

816 
	$bi__wd
(
bi__cڋxt
 *
s
)

821 
s
->
img_bufr
 = s->
img_bufr_ig
;

822 
s
->
img_bufr_d
 = s->
img_bufr_ig_d
;

823 
	}
}

827 
	mSTBI_ORDER_RGB
,

828 
	mSTBI_ORDER_BGR


833 
	mbs_r_chl
;

834 
	mnum_chls
;

835 
	mchl_d
;

836 } 
	tbi__su_fo
;

838 #ide
STBI_NO_JPEG


839 
bi__jg_
(
bi__cڋxt
 *
s
);

840 *
bi__jg_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
);

841 
bi__jg_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
);

844 #ide
STBI_NO_PNG


845 
bi__g_
(
bi__cڋxt
 *
s
);

846 *
bi__g_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
);

847 
bi__g_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
);

848 
bi__g_is16
(
bi__cڋxt
 *
s
);

851 #ide
STBI_NO_BMP


852 
bi__bmp_
(
bi__cڋxt
 *
s
);

853 *
bi__bmp_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
);

854 
bi__bmp_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
);

857 #ide
STBI_NO_TGA


858 
bi__tga_
(
bi__cڋxt
 *
s
);

859 *
bi__tga_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
);

860 
bi__tga_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
);

863 #ide
STBI_NO_PSD


864 
bi__psd_
(
bi__cڋxt
 *
s
);

865 *
bi__psd_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
, 
bpc
);

866 
bi__psd_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
);

867 
bi__psd_is16
(
bi__cڋxt
 *
s
);

870 #ide
STBI_NO_HDR


871 
bi__hdr_
(
bi__cڋxt
 *
s
);

872 *
bi__hdr_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
);

873 
bi__hdr_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
);

876 #ide
STBI_NO_PIC


877 
bi__pic_
(
bi__cڋxt
 *
s
);

878 *
bi__pic_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
);

879 
bi__pic_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
);

882 #ide
STBI_NO_GIF


883 
bi__gif_
(
bi__cڋxt
 *
s
);

884 *
bi__gif_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
);

885 *
bi__ld_gif_ma
(
bi__cڋxt
 *
s
, **
days
, *
x
, *
y
, *
z
, *
comp
, 
q_comp
);

886 
bi__gif_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
);

889 #ide
STBI_NO_PNM


890 
bi__m_
(
bi__cڋxt
 *
s
);

891 *
bi__m_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
);

892 
bi__m_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
);

896 #ifde
STBI_THREAD_LOCAL


897 
	gSTBI_THREAD_LOCAL


899 cڡ *
	gbi__g_u_as
;

901 
STBIDEF
 cڡ *
	$bi_u_as
()

903  
bi__g_u_as
;

904 
	}
}

906 #ide
STBI_NO_FAILURE_STRINGS


907 
	$bi__r
(cڡ *
r
)

909 
bi__g_u_as
 = 
r
;

911 
	}
}

914 *
	$bi__mloc
(
size_t
 
size
)

916  
	`STBI_MALLOC
(
size
);

917 
	}
}

931 
	$bi__addsizes_vid
(
a
, 
b
)

933 i(
b
 < 0)  0;

938  
a
 <
INT_MAX
 - 
b
;

939 
	}
}

943 
	$bi__mul2sizes_vid
(
a
, 
b
)

945 i(
a
 < 0 || 
b
 < 0)  0;

946 i(
b
 == 0)  1;

948  
a
 <
INT_MAX
/
b
;

949 
	}
}

951 #i!
defed
(
STBI_NO_JPEG
|| !defed(
STBI_NO_PNG
|| !defed(
STBI_NO_TGA
|| !defed(
STBI_NO_HDR
)

953 
	$bi__mad2sizes_vid
(
a
, 
b
, 
add
)

955  
	`bi__mul2sizes_vid
(
a
, 
b
&& 
	`bi__addsizes_vid
*b, 
add
);

956 
	}
}

960 
	$bi__mad3sizes_vid
(
a
, 
b
, 
c
, 
add
)

962  
	`bi__mul2sizes_vid
(
a
, 
b
&& stbi__mul2sizes_vid*b, 
c
) &&

963 
	`bi__addsizes_vid
(
a
*
b
*
c
, 
add
);

964 
	}
}

967 #i!
defed
(
STBI_NO_LINEAR
|| !defed(
STBI_NO_HDR
)

968 
	$bi__mad4sizes_vid
(
a
, 
b
, 
c
, 
d
, 
add
)

970  
	`bi__mul2sizes_vid
(
a
, 
b
&& stbi__mul2sizes_vid*b, 
c
) &&

971 
	`bi__mul2sizes_vid
(
a
*
b
*
c
, 
d
&& 
	`bi__addsizes_vid
*b*c*d, 
add
);

972 
	}
}

975 #i!
defed
(
STBI_NO_JPEG
|| !defed(
STBI_NO_PNG
|| !defed(
STBI_NO_TGA
|| !defed(
STBI_NO_HDR
)

977 *
	$bi__mloc_mad2
(
a
, 
b
, 
add
)

979 i(!
	`bi__mad2sizes_vid
(
a
, 
b
, 
add
) 
NULL
;

980  
	`bi__mloc
(
a
*
b
 + 
add
);

981 
	}
}

984 *
	$bi__mloc_mad3
(
a
, 
b
, 
c
, 
add
)

986 i(!
	`bi__mad3sizes_vid
(
a
, 
b
, 
c
, 
add
) 
NULL
;

987  
	`bi__mloc
(
a
*
b
*
c
 + 
add
);

988 
	}
}

990 #i!
defed
(
STBI_NO_LINEAR
|| !defed(
STBI_NO_HDR
)

991 *
	$bi__mloc_mad4
(
a
, 
b
, 
c
, 
d
, 
add
)

993 i(!
	`bi__mad4sizes_vid
(
a
, 
b
, 
c
, 
d
, 
add
) 
NULL
;

994  
	`bi__mloc
(
a
*
b
*
c
*
d
 + 
add
);

995 
	}
}

1002 #ifde
STBI_NO_FAILURE_STRINGS


1003 
	#bi__r
(
x
,
y
0

	)

1004 #i
defed
(
STBI_FAILURE_USERMSG
)

1005 
	#bi__r
(
x
,
y

	`bi__r
(y)

	)

1007 
	#bi__r
(
x
,
y

	`bi__r
(x)

	)

1010 
	#bi__f
(
x
,
y
((*)(
size_t
(
	`bi__r
(x,y)?
NULL
:NULL))

	)

1011 
	#bi__uc
(
x
,
y
((*)(
size_t
(
	`bi__r
(x,y)?
NULL
:NULL))

	)

1013 
STBIDEF
 
	$bi_image_
(*
tv_om_bi_ld
)

1015 
	`STBI_FREE
(
tv_om_bi_ld
);

1016 
	}
}

1018 #ide
STBI_NO_LINEAR


1019 *
bi__ldr_to_hdr
(
bi_uc
 *
da
, 
x
, 
y
, 
comp
);

1022 #ide
STBI_NO_HDR


1023 
bi_uc
 *
bi__hdr_to_ldr
(*
da
, 
x
, 
y
, 
comp
);

1026 
	gbi__vtiy___ld_glob
 = 0;

1028 
STBIDEF
 
	$bi_t__vtiy__ld
(
ag_ue_if_should_
)

1030 
bi__vtiy___ld_glob
 = 
ag_ue_if_should_
;

1031 
	}
}

1033 #ide
STBI_THREAD_LOCAL


1034 
	#bi__vtiy___ld
 
bi__vtiy___ld_glob


	)

1036 
STBI_THREAD_LOCAL
 
	gbi__vtiy___ld_lol
, 
	gbi__vtiy___ld_t
;

1038 
STBIDEF
 
	$bi_t__vtiy__ld_thad
(
ag_ue_if_should_
)

1040 
bi__vtiy___ld_lol
 = 
ag_ue_if_should_
;

1041 
bi__vtiy___ld_t
 = 1;

1042 
	}
}

1044 
	#bi__vtiy___ld
 (
bi__vtiy___ld_t
 \

1045 ? 
bi__vtiy___ld_lol
 \

1046 : 
bi__vtiy___ld_glob
)

	)

1049 *
	$bi__ld_ma
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
, 
bpc
)

1051 
	`memt
(
ri
, 0, (*ri));

1052 
ri
->
bs_r_chl
 = 8;

1053 
ri
->
chl_d
 = 
STBI_ORDER_RGB
;

1054 
ri
->
num_chls
 = 0;

1056 #ide
STBI_NO_JPEG


1057 i(
	`bi__jg_
(
s
) 
	`bi__jg_ld
(s,
x
,
y
,
comp
,
q_comp
, 
ri
);

1059 #ide
STBI_NO_PNG


1060 i(
	`bi__g_
(
s
) 
	`bi__g_ld
(s,
x
,
y
,
comp
,
q_comp
, 
ri
);

1062 #ide
STBI_NO_BMP


1063 i(
	`bi__bmp_
(
s
) 
	`bi__bmp_ld
(s,
x
,
y
,
comp
,
q_comp
, 
ri
);

1065 #ide
STBI_NO_GIF


1066 i(
	`bi__gif_
(
s
) 
	`bi__gif_ld
(s,
x
,
y
,
comp
,
q_comp
, 
ri
);

1068 #ide
STBI_NO_PSD


1069 i(
	`bi__psd_
(
s
) 
	`bi__psd_ld
(s,
x
,
y
,
comp
,
q_comp
, 
ri
, 
bpc
);

1071 
	`STBI_NOTUSED
(
bpc
);

1073 #ide
STBI_NO_PIC


1074 i(
	`bi__pic_
(
s
) 
	`bi__pic_ld
(s,
x
,
y
,
comp
,
q_comp
, 
ri
);

1076 #ide
STBI_NO_PNM


1077 i(
	`bi__m_
(
s
) 
	`bi__m_ld
(s,
x
,
y
,
comp
,
q_comp
, 
ri
);

1080 #ide
STBI_NO_HDR


1081 i(
	`bi__hdr_
(
s
)) {

1082 *
hdr
 = 
	`bi__hdr_ld
(
s
, 
x
,
y
,
comp
,
q_comp
, 
ri
);

1083  
	`bi__hdr_to_ldr
(
hdr
, *
x
, *
y
, 
q_comp
 ?eq_com: *
comp
);

1087 #ide
STBI_NO_TGA


1089 i(
	`bi__tga_
(
s
))

1090  
	`bi__tga_ld
(
s
,
x
,
y
,
comp
,
q_comp
, 
ri
);

1093  
	`bi__uc
("unknown imageype", "Imageot ofny knownype, or corrupt");

1094 
	}
}

1096 
bi_uc
 *
	$bi__cvt_16_to_8
(
bi__ut16
 *
ig
, 
w
, 
h
, 
chls
)

1098 
i
;

1099 
img_n
 = 
w
 * 
h
 * 
chls
;

1100 
bi_uc
 *
dud
;

1102 
dud
 = (
bi_uc
 *
	`bi__mloc
(
img_n
);

1103 i(
dud
 =
NULL
 
	`bi__uc
("outofmem", "Out of memory");

1105 
i
 = 0; i < 
img_n
; ++i)

1106 
dud
[
i
] = (
bi_uc
)((
ig
[i] >> 8) & 0xFF);

1108 
	`STBI_FREE
(
ig
);

1109  
dud
;

1110 
	}
}

1112 
bi__ut16
 *
	$bi__cvt_8_to_16
(
bi_uc
 *
ig
, 
w
, 
h
, 
chls
)

1114 
i
;

1115 
img_n
 = 
w
 * 
h
 * 
chls
;

1116 
bi__ut16
 *
rged
;

1118 
rged
 = (
bi__ut16
 *
	`bi__mloc
(
img_n
*2);

1119 i(
rged
 =
NULL
 (
bi__ut16
 *
	`bi__uc
("outofmem", "Out of memory");

1121 
i
 = 0; i < 
img_n
; ++i)

1122 
rged
[
i
] = (
bi__ut16
)((
ig
[i] << 8) + orig[i]);

1124 
	`STBI_FREE
(
ig
);

1125  
rged
;

1126 
	}
}

1128 
	$bi__vtil_
(*
image
, 
w
, 
h
, 
bys_r_pix
)

1130 
row
;

1131 
size_t
 
bys_r_row
 = (size_t)
w
 * 
bys_r_pix
;

1132 
bi_uc
 
mp
[2048];

1133 
bi_uc
 *
bys
 = (bi_u*)
image
;

1135 
row
 = 0;ow < (
h
>>1);ow++) {

1136 
bi_uc
 *
row0
 = 
bys
 + 
row
*
bys_r_row
;

1137 
bi_uc
 *
row1
 = 
bys
 + (
h
 - 
row
 - 1)*
bys_r_row
;

1139 
size_t
 
bys_
 = 
bys_r_row
;

1140 
bys_
) {

1141 
size_t
 
bys_cy
 = (
bys_
 < (
mp
)) ? bytes_left : (temp);

1142 
	`memy
(
mp
, 
row0
, 
bys_cy
);

1143 
	`memy
(
row0
, 
row1
, 
bys_cy
);

1144 
	`memy
(
row1
, 
mp
, 
bys_cy
);

1145 
row0
 +
bys_cy
;

1146 
row1
 +
bys_cy
;

1147 
bys_
 -
bys_cy
;

1150 
	}
}

1152 #ide
STBI_NO_GIF


1153 
	$bi__vtil__is
(*
image
, 
w
, 
h
, 
z
, 
bys_r_pix
)

1155 
i
;

1156 
i_size
 = 
w
 * 
h
 * 
bys_r_pix
;

1158 
bi_uc
 *
bys
 = (bi_u*)
image
;

1159 
i
 = 0; sli < 
z
; ++slice) {

1160 
	`bi__vtil_
(
bys
, 
w
, 
h
, 
bys_r_pix
);

1161 
bys
 +
i_size
;

1163 
	}
}

1166 *
	$bi__ld_d_pooss_8b
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
)

1168 
bi__su_fo
 
ri
;

1169 *
su
 = 
	`bi__ld_ma
(
s
, 
x
, 
y
, 
comp
, 
q_comp
, &
ri
, 8);

1171 i(
su
 =
NULL
)

1172  
NULL
;

1174 i(
ri
.
bs_r_chl
 != 8) {

1175 
	`STBI_ASSERT
(
ri
.
bs_r_chl
 == 16);

1176 
su
 = 
	`bi__cvt_16_to_8
((
bi__ut16
 *su, *
x
, *
y
, 
q_comp
 =0 ? *
comp
 :eq_comp);

1177 
ri
.
bs_r_chl
 = 8;

1182 i(
bi__vtiy___ld
) {

1183 
chls
 = 
q_comp
 ?eq_com: *
comp
;

1184 
	`bi__vtil_
(
su
, *
x
, *
y
, 
chls
 * (
bi_uc
));

1187  (*
su
;

1188 
	}
}

1190 
bi__ut16
 *
	$bi__ld_d_pooss_16b
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
)

1192 
bi__su_fo
 
ri
;

1193 *
su
 = 
	`bi__ld_ma
(
s
, 
x
, 
y
, 
comp
, 
q_comp
, &
ri
, 16);

1195 i(
su
 =
NULL
)

1196  
NULL
;

1198 i(
ri
.
bs_r_chl
 != 16) {

1199 
	`STBI_ASSERT
(
ri
.
bs_r_chl
 == 8);

1200 
su
 = 
	`bi__cvt_8_to_16
((
bi_uc
 *su, *
x
, *
y
, 
q_comp
 =0 ? *
comp
 :eq_comp);

1201 
ri
.
bs_r_chl
 = 16;

1207 i(
bi__vtiy___ld
) {

1208 
chls
 = 
q_comp
 ?eq_com: *
comp
;

1209 
	`bi__vtil_
(
su
, *
x
, *
y
, 
chls
 * (
bi__ut16
));

1212  (
bi__ut16
 *
su
;

1213 
	}
}

1215 #i!
defed
(
STBI_NO_HDR
&& !defed(
STBI_NO_LINEAR
)

1216 
	$bi__t_pooss
(*
su
, *
x
, *
y
, *
comp
, 
q_comp
)

1218 i(
bi__vtiy___ld
 && 
su
 !
NULL
) {

1219 
chls
 = 
q_comp
 ?eq_com: *
comp
;

1220 
	`bi__vtil_
(
su
, *
x
, *
y
, 
chls
 * ());

1222 
	}
}

1225 #ide
STBI_NO_STDIO


1227 #i
defed
(
_MSC_VER
&& defed(
STBI_WINDOWS_UTF8
)

1228 
STBI_EXTERN
 
	$__deec
(
dimpt

__d
 
	`MuiByToWideCh
(

, 
ags
, cڡ *
r
, 
cbmb
, 
wch_t
 *
wider
, 
cchwide
);

1229 
STBI_EXTERN
 
	$__deec
(
dimpt

__d
 
	`WideChToMuiBy
(

, 
ags
, cڡ 
wch_t
 *
wider
, 
cchwide
, *
r
, 
cbmb
, cڡ *
defch
, *
ud_deu
);

1232 #i
	`defed
(
_MSC_VER
&& defed(
STBI_WINDOWS_UTF8
)

1233 
STBIDEF
 
	$bi_cvt_wch_to_utf8
(*
bufr
, 
size_t
 
buf㾒
, cڡ 
wch_t
* 
put
)

1235  
	`WideChToMuiBy
(65001 , 0, 
put
, -1, 
bufr
, (
buf㾒
, 
NULL
, NULL);

1236 
	}
}

1239 
FILE
 *
	$bi__fݒ
(cڡ *
fame
, cڡ *
mode
)

1241 
FILE
 *
f
;

1242 #i
	`defed
(
_MSC_VER
&& defed(
STBI_WINDOWS_UTF8
)

1243 
wch_t
 
wMode
[64];

1244 
wch_t
 
wFame
[1024];

1245 i(0 =
	`MuiByToWideCh
(65001 , 0, 
fame
, -1, 
wFame
, (wFilename)))

1248 i(0 =
	`MuiByToWideCh
(65001 , 0, 
mode
, -1, 
wMode
, (wMode)))

1251 #i
_MSC_VER
 >= 1400

1252 i(0 !
	`_wfݒ_s
(&
f
, 
wFame
, 
wMode
))

1253 
f
 = 0;

1255 
f
 = 
	`_wfݒ
(
wFame
, 
wMode
);

1258 #i
	`defed
(
_MSC_VER
) && _MSC_VER >= 1400

1259 i(0 !
	`fݒ_s
(&
f
, 
fame
, 
mode
))

1260 
f
=0;

1262 
f
 = 
	`fݒ
(
fame
, 
mode
);

1264  
f
;

1265 
	}
}

1268 
STBIDEF
 
bi_uc
 *
	$bi_ld
(cڡ *
fame
, *
x
, *
y
, *
comp
, 
q_comp
)

1270 
FILE
 *
f
 = 
	`bi__fݒ
(
fame
, "rb");

1271 *
su
;

1272 i(!
f
 
	`bi__uc
("can't fopen", "Unableo open file");

1273 
su
 = 
	`bi_ld_om_fe
(
f
,
x
,
y
,
comp
,
q_comp
);

1274 
	`fo
(
f
);

1275  
su
;

1276 
	}
}

1278 
STBIDEF
 
bi_uc
 *
	$bi_ld_om_fe
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
q_comp
)

1280 *
su
;

1281 
bi__cڋxt
 
s
;

1282 
	`bi__t_fe
(&
s
,
f
);

1283 
su
 = 
	`bi__ld_d_pooss_8b
(&
s
,
x
,
y
,
comp
,
q_comp
);

1284 i(
su
) {

1286 
	`fek
(
f
, - ((
s
.
img_bufr_d
 - s.
img_bufr
), 
SEEK_CUR
);

1288  
su
;

1289 
	}
}

1291 
STBIDEF
 
bi__ut16
 *
	$bi_ld_om_fe_16
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
q_comp
)

1293 
bi__ut16
 *
su
;

1294 
bi__cڋxt
 
s
;

1295 
	`bi__t_fe
(&
s
,
f
);

1296 
su
 = 
	`bi__ld_d_pooss_16b
(&
s
,
x
,
y
,
comp
,
q_comp
);

1297 i(
su
) {

1299 
	`fek
(
f
, - ((
s
.
img_bufr_d
 - s.
img_bufr
), 
SEEK_CUR
);

1301  
su
;

1302 
	}
}

1304 
STBIDEF
 
bi_us
 *
	$bi_ld_16
(cڡ *
fame
, *
x
, *
y
, *
comp
, 
q_comp
)

1306 
FILE
 *
f
 = 
	`bi__fݒ
(
fame
, "rb");

1307 
bi__ut16
 *
su
;

1308 i(!
f
 (
bi_us
 *
	`bi__uc
("can't fopen", "Unableo open file");

1309 
su
 = 
	`bi_ld_om_fe_16
(
f
,
x
,
y
,
comp
,
q_comp
);

1310 
	`fo
(
f
);

1311  
su
;

1312 
	}
}

1317 
STBIDEF
 
bi_us
 *
	$bi_ld_16_om_memy
(
bi_uc
 cڡ *
bufr
, 
n
, *
x
, *
y
, *
chls__fe
, 
desed_chls
)

1319 
bi__cڋxt
 
s
;

1320 
	`bi__t_mem
(&
s
,
bufr
,
n
);

1321  
	`bi__ld_d_pooss_16b
(&
s
,
x
,
y
,
chls__fe
,
desed_chls
);

1322 
	}
}

1324 
STBIDEF
 
bi_us
 *
	$bi_ld_16_om_backs
(
bi_io_backs
 cڡ *
bk
, *
ur
, *
x
, *
y
, *
chls__fe
, 
desed_chls
)

1326 
bi__cڋxt
 
s
;

1327 
	`bi__t_backs
(&
s
, (
bi_io_backs
 *)
bk
, 
ur
);

1328  
	`bi__ld_d_pooss_16b
(&
s
,
x
,
y
,
chls__fe
,
desed_chls
);

1329 
	}
}

1331 
STBIDEF
 
bi_uc
 *
	$bi_ld_om_memy
(
bi_uc
 cڡ *
bufr
, 
n
, *
x
, *
y
, *
comp
, 
q_comp
)

1333 
bi__cڋxt
 
s
;

1334 
	`bi__t_mem
(&
s
,
bufr
,
n
);

1335  
	`bi__ld_d_pooss_8b
(&
s
,
x
,
y
,
comp
,
q_comp
);

1336 
	}
}

1338 
STBIDEF
 
bi_uc
 *
	$bi_ld_om_backs
(
bi_io_backs
 cڡ *
bk
, *
ur
, *
x
, *
y
, *
comp
, 
q_comp
)

1340 
bi__cڋxt
 
s
;

1341 
	`bi__t_backs
(&
s
, (
bi_io_backs
 *
bk
, 
ur
);

1342  
	`bi__ld_d_pooss_8b
(&
s
,
x
,
y
,
comp
,
q_comp
);

1343 
	}
}

1345 #ide
STBI_NO_GIF


1346 
STBIDEF
 
bi_uc
 *
	$bi_ld_gif_om_memy
(
bi_uc
 cڡ *
bufr
, 
n
, **
days
, *
x
, *
y
, *
z
, *
comp
, 
q_comp
)

1348 *
su
;

1349 
bi__cڋxt
 
s
;

1350 
	`bi__t_mem
(&
s
,
bufr
,
n
);

1352 
su
 = (*
	`bi__ld_gif_ma
(&
s
, 
days
, 
x
, 
y
, 
z
, 
comp
, 
q_comp
);

1353 i(
bi__vtiy___ld
) {

1354 
	`bi__vtil__is

su
, *
x
, *
y
, *
z
, *
comp
 );

1357  
su
;

1358 
	}
}

1361 #ide
STBI_NO_LINEAR


1362 *
	$bi__ldf_ma
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
)

1364 *
da
;

1365 #ide
STBI_NO_HDR


1366 i(
	`bi__hdr_
(
s
)) {

1367 
bi__su_fo
 
ri
;

1368 *
hdr_da
 = 
	`bi__hdr_ld
(
s
,
x
,
y
,
comp
,
q_comp
, &
ri
);

1369 i(
hdr_da
)

1370 
	`bi__t_pooss
(
hdr_da
,
x
,
y
,
comp
,
q_comp
);

1371  
hdr_da
;

1374 
da
 = 
	`bi__ld_d_pooss_8b
(
s
, 
x
, 
y
, 
comp
, 
q_comp
);

1375 i(
da
)

1376  
	`bi__ldr_to_hdr
(
da
, *
x
, *
y
, 
q_comp
 ?eq_com: *
comp
);

1377  
	`bi__f
("unknown imageype", "Imageot ofny knownype, or corrupt");

1378 
	}
}

1380 
STBIDEF
 *
	$bi_ldf_om_memy
(
bi_uc
 cڡ *
bufr
, 
n
, *
x
, *
y
, *
comp
, 
q_comp
)

1382 
bi__cڋxt
 
s
;

1383 
	`bi__t_mem
(&
s
,
bufr
,
n
);

1384  
	`bi__ldf_ma
(&
s
,
x
,
y
,
comp
,
q_comp
);

1385 
	}
}

1387 
STBIDEF
 *
	$bi_ldf_om_backs
(
bi_io_backs
 cڡ *
bk
, *
ur
, *
x
, *
y
, *
comp
, 
q_comp
)

1389 
bi__cڋxt
 
s
;

1390 
	`bi__t_backs
(&
s
, (
bi_io_backs
 *
bk
, 
ur
);

1391  
	`bi__ldf_ma
(&
s
,
x
,
y
,
comp
,
q_comp
);

1392 
	}
}

1394 #ide
STBI_NO_STDIO


1395 
STBIDEF
 *
	$bi_ldf
(cڡ *
fame
, *
x
, *
y
, *
comp
, 
q_comp
)

1397 *
su
;

1398 
FILE
 *
f
 = 
	`bi__fݒ
(
fame
, "rb");

1399 i(!
f
 
	`bi__f
("can't fopen", "Unableo open file");

1400 
su
 = 
	`bi_ldf_om_fe
(
f
,
x
,
y
,
comp
,
q_comp
);

1401 
	`fo
(
f
);

1402  
su
;

1403 
	}
}

1405 
STBIDEF
 *
	$bi_ldf_om_fe
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
q_comp
)

1407 
bi__cڋxt
 
s
;

1408 
	`bi__t_fe
(&
s
,
f
);

1409  
	`bi__ldf_ma
(&
s
,
x
,
y
,
comp
,
q_comp
);

1410 
	}
}

1419 
STBIDEF
 
	$bi_is_hdr_om_memy
(
bi_uc
 cڡ *
bufr
, 
n
)

1421 #ide
STBI_NO_HDR


1422 
bi__cڋxt
 
s
;

1423 
	`bi__t_mem
(&
s
,
bufr
,
n
);

1424  
	`bi__hdr_
(&
s
);

1426 
	`STBI_NOTUSED
(
bufr
);

1427 
	`STBI_NOTUSED
(
n
);

1430 
	}
}

1432 #ide
STBI_NO_STDIO


1433 
STBIDEF
 
	$bi_is_hdr
 (cڡ *
fame
)

1435 
FILE
 *
f
 = 
	`bi__fݒ
(
fame
, "rb");

1436 
su
=0;

1437 i(
f
) {

1438 
su
 = 
	`bi_is_hdr_om_fe
(
f
);

1439 
	`fo
(
f
);

1441  
su
;

1442 
	}
}

1444 
STBIDEF
 
	$bi_is_hdr_om_fe
(
FILE
 *
f
)

1446 #ide
STBI_NO_HDR


1447 
pos
 = 
	`l
(
f
);

1448 
s
;

1449 
bi__cڋxt
 
s
;

1450 
	`bi__t_fe
(&
s
,
f
);

1451 
s
 = 
	`bi__hdr_
(&
s
);

1452 
	`fek
(
f
, 
pos
, 
SEEK_SET
);

1453  
s
;

1455 
	`STBI_NOTUSED
(
f
);

1458 
	}
}

1461 
STBIDEF
 
	$bi_is_hdr_om_backs
(
bi_io_backs
 cڡ *
bk
, *
ur
)

1463 #ide
STBI_NO_HDR


1464 
bi__cڋxt
 
s
;

1465 
	`bi__t_backs
(&
s
, (
bi_io_backs
 *
bk
, 
ur
);

1466  
	`bi__hdr_
(&
s
);

1468 
	`STBI_NOTUSED
(
bk
);

1469 
	`STBI_NOTUSED
(
ur
);

1472 
	}
}

1474 #ide
STBI_NO_LINEAR


1475 
	gbi__l2h_gamma
=2.2f, 
	gbi__l2h_s
=1.0f;

1477 
STBIDEF
 
	$bi_ldr_to_hdr_gamma
(
gamma
{ 
bi__l2h_gamma
 = gamma; 
	}
}

1478 
STBIDEF
 
	$bi_ldr_to_hdr_s
(
s
{ 
bi__l2h_s
 = s; 
	}
}

1481 
	gbi__h2l_gamma_i
=1.0f/2.2f, 
	gbi__h2l_s_i
=1.0f;

1483 
STBIDEF
 
	$bi_hdr_to_ldr_gamma
(
gamma
{ 
bi__h2l_gamma_i
 = 1/gamma; 
	}
}

1484 
STBIDEF
 
	$bi_hdr_to_ldr_s
(
s
{ 
bi__h2l_s_i
 = 1/s; 
	}
}

1494 
	mSTBI__SCAN_ld
=0,

1495 
	mSTBI__SCAN_ty
,

1496 
	mSTBI__SCAN_hd


1499 
	$bi__fl_bufr
(
bi__cڋxt
 *
s
)

1501 
n
 = (
s
->
io
.
ad
)(s->
io_ur_da
,(*)s->
bufr_t
,s->
bu
);

1502 i(
n
 == 0) {

1505 
s
->
ad_om_backs
 = 0;

1506 
s
->
img_bufr
 = s->
bufr_t
;

1507 
s
->
img_bufr_d
 = s->
bufr_t
+1;

1508 *
s
->
img_bufr
 = 0;

1510 
s
->
img_bufr
 = s->
bufr_t
;

1511 
s
->
img_bufr_d
 = s->
bufr_t
 + 
n
;

1513 
	}
}

1515 
bi_le
 
bi_uc
 
	$bi__g8
(
bi__cڋxt
 *
s
)

1517 i(
s
->
img_bufr
 < s->
img_bufr_d
)

1518  *
s
->
img_bufr
++;

1519 i(
s
->
ad_om_backs
) {

1520 
	`bi__fl_bufr
(
s
);

1521  *
s
->
img_bufr
++;

1524 
	}
}

1526 #i
defed
(
STBI_NO_JPEG
&& defed(
STBI_NO_HDR
&& defed(
STBI_NO_PIC
&& defed(
STBI_NO_PNM
)

1529 
bi_le
 
	$bi___eof
(
bi__cڋxt
 *
s
)

1531 i(
s
->
io
.
ad
) {

1532 i(!(
s
->
io
.
eof
)(s->
io_ur_da
))  0;

1535 i(
s
->
ad_om_backs
 == 0)  1;

1538  
s
->
img_bufr
 >s->
img_bufr_d
;

1539 
	}
}

1542 #i
defed
(
STBI_NO_JPEG
&& defed(
STBI_NO_PNG
&& defed(
STBI_NO_BMP
&& defed(
STBI_NO_PSD
&& defed(
STBI_NO_TGA
&& defed(
STBI_NO_GIF
&& defed(
STBI_NO_PIC
)

1545 
	$bi__sk
(
bi__cڋxt
 *
s
, 
n
)

1547 i(
n
 < 0) {

1548 
s
->
img_bufr
 = s->
img_bufr_d
;

1551 i(
s
->
io
.
ad
) {

1552 
bn
 = ((
s
->
img_bufr_d
 - s->
img_bufr
);

1553 i(
bn
 < 
n
) {

1554 
s
->
img_bufr
 = s->
img_bufr_d
;

1555 (
s
->
io
.
sk
)(s->
io_ur_da
, 
n
 - 
bn
);

1559 
s
->
img_bufr
 +
n
;

1560 
	}
}

1563 #i
defed
(
STBI_NO_PNG
&& defed(
STBI_NO_TGA
&& defed(
STBI_NO_HDR
&& defed(
STBI_NO_PNM
)

1566 
	$bi__gn
(
bi__cڋxt
 *
s
, 
bi_uc
 *
bufr
, 
n
)

1568 i(
s
->
io
.
ad
) {

1569 
bn
 = ((
s
->
img_bufr_d
 - s->
img_bufr
);

1570 i(
bn
 < 
n
) {

1571 
s
, 
cou
;

1573 
	`memy
(
bufr
, 
s
->
img_bufr
, 
bn
);

1575 
cou
 = (
s
->
io
.
ad
)(s->
io_ur_da
, (*
bufr
 + 
bn
, 
n
 - blen);

1576 
s
 = (
cou
 =(
n
-
bn
));

1577 
s
->
img_bufr
 = s->
img_bufr_d
;

1578  
s
;

1582 i(
s
->
img_bufr
+
n
 <s->
img_bufr_d
) {

1583 
	`memy
(
bufr
, 
s
->
img_bufr
, 
n
);

1584 
s
->
img_bufr
 +
n
;

1588 
	}
}

1591 #i
defed
(
STBI_NO_JPEG
&& defed(
STBI_NO_PNG
&& defed(
STBI_NO_PSD
&& defed(
STBI_NO_PIC
)

1594 
	$bi__g16be
(
bi__cڋxt
 *
s
)

1596 
z
 = 
	`bi__g8
(
s
);

1597  (
z
 << 8+ 
	`bi__g8
(
s
);

1598 
	}
}

1601 #i
defed
(
STBI_NO_PNG
&& defed(
STBI_NO_PSD
&& defed(
STBI_NO_PIC
)

1604 
bi__ut32
 
	$bi__g32be
(
bi__cڋxt
 *
s
)

1606 
bi__ut32
 
z
 = 
	`bi__g16be
(
s
);

1607  (
z
 << 16+ 
	`bi__g16be
(
s
);

1608 
	}
}

1611 #i
defed
(
STBI_NO_BMP
&& defed(
STBI_NO_TGA
&& defed(
STBI_NO_GIF
)

1614 
	$bi__g16
(
bi__cڋxt
 *
s
)

1616 
z
 = 
	`bi__g8
(
s
);

1617  
z
 + (
	`bi__g8
(
s
) << 8);

1618 
	}
}

1621 #ide
STBI_NO_BMP


1622 
bi__ut32
 
	$bi__g32
(
bi__cڋxt
 *
s
)

1624 
bi__ut32
 
z
 = 
	`bi__g16
(
s
);

1625  
z
 + (
	`bi__g16
(
s
) << 16);

1626 
	}
}

1629 
	#STBI__BYTECAST
(
x
((
bi_uc
) ((x) & 255))

1630 

	)

1631 #i
defed
(
STBI_NO_JPEG
&& defed(
STBI_NO_PNG
&& defed(
STBI_NO_BMP
&& defed(
STBI_NO_PSD
&& defed(
STBI_NO_TGA
&& defed(
STBI_NO_GIF
&& defed(
STBI_NO_PIC
&& defed(
STBI_NO_PNM
)

1645 
bi_uc
 
	$bi__compu_y
(
r
, 
g
, 
b
)

1647  (
bi_uc
(((
r
*77+ (
g
*150+ (29*
b
)) >> 8);

1648 
	}
}

1651 #i
defed
(
STBI_NO_PNG
&& defed(
STBI_NO_BMP
&& defed(
STBI_NO_PSD
&& defed(
STBI_NO_TGA
&& defed(
STBI_NO_GIF
&& defed(
STBI_NO_PIC
&& defed(
STBI_NO_PNM
)

1654 *
	$bi__cvt_fm
(*
da
, 
img_n
, 
q_comp
, 
x
, 
y
)

1656 
i
,
j
;

1657 *
good
;

1659 i(
q_comp
 =
img_n
 
da
;

1660 
	`STBI_ASSERT
(
q_comp
 >= 1 &&eq_comp <= 4);

1662 
good
 = (*
	`bi__mloc_mad3
(
q_comp
, 
x
, 
y
, 0);

1663 i(
good
 =
NULL
) {

1664 
	`STBI_FREE
(
da
);

1665  
	`bi__uc
("outofmem", "Out of memory");

1668 
j
=0; j < (
y
; ++j) {

1669 *
c
 = 
da
 + 
j
 * 
x
 * 
img_n
 ;

1670 *
de
 = 
good
 + 
j
 * 
x
 * 
q_comp
;

1672 
	#STBI__COMBO
(
a
,
b
()*8+(b))

	)

1673 
	#STBI__CASE
(
a
,
b

	`STBI__COMBO
,b): 
i
=
x
-1; i >0; --i, 
c
 +a, 
de
 +b)

	)

1676 
	`STBI__COMBO
(
img_n
, 
q_comp
)) {

1677 
	`STBI__CASE
(1,2{ 
de
[0]=
c
[0]; dest[1]=255; } ;

1678 
	`STBI__CASE
(1,3{ 
de
[0]=de[1]=de[2]=
c
[0]; } ;

1679 
	`STBI__CASE
(1,4{ 
de
[0]=de[1]=de[2]=
c
[0]; dest[3]=255; } ;

1680 
	`STBI__CASE
(2,1{ 
de
[0]=
c
[0]; } ;

1681 
	`STBI__CASE
(2,3{ 
de
[0]=de[1]=de[2]=
c
[0]; } ;

1682 
	`STBI__CASE
(2,4{ 
de
[0]=de[1]=de[2]=
c
[0]; dest[3]=src[1]; } ;

1683 
	`STBI__CASE
(3,4{ 
de
[0]=
c
[0];dest[1]=src[1];dest[2]=src[2];dest[3]=255; } ;

1684 
	`STBI__CASE
(3,1{ 
de
[0]=
	`bi__compu_y
(
c
[0],src[1],src[2]); } ;

1685 
	`STBI__CASE
(3,2{ 
de
[0]=
	`bi__compu_y
(
c
[0],src[1],src[2]); dest[1] = 255; } ;

1686 
	`STBI__CASE
(4,1{ 
de
[0]=
	`bi__compu_y
(
c
[0],src[1],src[2]); } ;

1687 
	`STBI__CASE
(4,2{ 
de
[0]=
	`bi__compu_y
(
c
[0],src[1],src[2]); dest[1] = src[3]; } ;

1688 
	`STBI__CASE
(4,3{ 
de
[0]=
c
[0];dest[1]=src[1];dest[2]=src[2]; } ;

1689 : 
	`STBI_ASSERT
(0);

1691 #unde
STBI__CASE


1694 
	`STBI_FREE
(
da
);

1695  
good
;

1696 
	}
}

1699 #i
defed
(
STBI_NO_PNG
&& defed(
STBI_NO_PSD
)

1702 
bi__ut16
 
	$bi__compu_y_16
(
r
, 
g
, 
b
)

1704  (
bi__ut16
(((
r
*77+ (
g
*150+ (29*
b
)) >> 8);

1705 
	}
}

1708 #i
defed
(
STBI_NO_PNG
&& defed(
STBI_NO_PSD
)

1711 
bi__ut16
 *
	$bi__cvt_fm16
(
bi__ut16
 *
da
, 
img_n
, 
q_comp
, 
x
, 
y
)

1713 
i
,
j
;

1714 
bi__ut16
 *
good
;

1716 i(
q_comp
 =
img_n
 
da
;

1717 
	`STBI_ASSERT
(
q_comp
 >= 1 &&eq_comp <= 4);

1719 
good
 = (
bi__ut16
 *
	`bi__mloc
(
q_comp
 * 
x
 * 
y
 * 2);

1720 i(
good
 =
NULL
) {

1721 
	`STBI_FREE
(
da
);

1722  (
bi__ut16
 *
	`bi__uc
("outofmem", "Out of memory");

1725 
j
=0; j < (
y
; ++j) {

1726 
bi__ut16
 *
c
 = 
da
 + 
j
 * 
x
 * 
img_n
 ;

1727 
bi__ut16
 *
de
 = 
good
 + 
j
 * 
x
 * 
q_comp
;

1729 
	#STBI__COMBO
(
a
,
b
()*8+(b))

	)

1730 
	#STBI__CASE
(
a
,
b

	`STBI__COMBO
,b): 
i
=
x
-1; i >0; --i, 
c
 +a, 
de
 +b)

	)

1733 
	`STBI__COMBO
(
img_n
, 
q_comp
)) {

1734 
	`STBI__CASE
(1,2{ 
de
[0]=
c
[0]; dest[1]=0xffff; } ;

1735 
	`STBI__CASE
(1,3{ 
de
[0]=de[1]=de[2]=
c
[0]; } ;

1736 
	`STBI__CASE
(1,4{ 
de
[0]=de[1]=de[2]=
c
[0]; dest[3]=0xffff; } ;

1737 
	`STBI__CASE
(2,1{ 
de
[0]=
c
[0]; } ;

1738 
	`STBI__CASE
(2,3{ 
de
[0]=de[1]=de[2]=
c
[0]; } ;

1739 
	`STBI__CASE
(2,4{ 
de
[0]=de[1]=de[2]=
c
[0]; dest[3]=src[1]; } ;

1740 
	`STBI__CASE
(3,4{ 
de
[0]=
c
[0];dest[1]=src[1];dest[2]=src[2];dest[3]=0xffff; } ;

1741 
	`STBI__CASE
(3,1{ 
de
[0]=
	`bi__compu_y_16
(
c
[0],src[1],src[2]); } ;

1742 
	`STBI__CASE
(3,2{ 
de
[0]=
	`bi__compu_y_16
(
c
[0],src[1],src[2]); dest[1] = 0xffff; } ;

1743 
	`STBI__CASE
(4,1{ 
de
[0]=
	`bi__compu_y_16
(
c
[0],src[1],src[2]); } ;

1744 
	`STBI__CASE
(4,2{ 
de
[0]=
	`bi__compu_y_16
(
c
[0],src[1],src[2]); dest[1] = src[3]; } ;

1745 
	`STBI__CASE
(4,3{ 
de
[0]=
c
[0];dest[1]=src[1];dest[2]=src[2]; } ;

1746 : 
	`STBI_ASSERT
(0);

1748 #unde
STBI__CASE


1751 
	`STBI_FREE
(
da
);

1752  
good
;

1753 
	}
}

1756 #ide
STBI_NO_LINEAR


1757 *
	$bi__ldr_to_hdr
(
bi_uc
 *
da
, 
x
, 
y
, 
comp
)

1759 
i
,
k
,
n
;

1760 *
ouut
;

1761 i(!
da
 
NULL
;

1762 
ouut
 = (*
	`bi__mloc_mad4
(
x
, 
y
, 
comp
, (), 0);

1763 i(
ouut
 =
NULL
{ 
	`STBI_FREE
(
da
);  
	`bi__f
("outofmem", "Out of memory"); }

1765 i(
comp
 & 1
n
 = comp; n = comp-1;

1766 
i
=0; i < 
x
*
y
; ++i) {

1767 
k
=0; k < 
n
; ++k) {

1768 
ouut
[
i
*
comp
 + 
k
] = ((
	`pow
(
da
[i*comp+k]/255.0f, 
bi__l2h_gamma
* 
bi__l2h_s
);

1771 i(
n
 < 
comp
) {

1772 
i
=0; i < 
x
*
y
; ++i) {

1773 
ouut
[
i
*
comp
 + 
n
] = 
da
[i*comp +]/255.0f;

1776 
	`STBI_FREE
(
da
);

1777  
ouut
;

1778 
	}
}

1781 #ide
STBI_NO_HDR


1782 
	#bi__t2t
(
x
(((x))

	)

1783 
bi_uc
 *
	$bi__hdr_to_ldr
(*
da
, 
x
, 
y
, 
comp
)

1785 
i
,
k
,
n
;

1786 
bi_uc
 *
ouut
;

1787 i(!
da
 
NULL
;

1788 
ouut
 = (
bi_uc
 *
	`bi__mloc_mad3
(
x
, 
y
, 
comp
, 0);

1789 i(
ouut
 =
NULL
{ 
	`STBI_FREE
(
da
);  
	`bi__uc
("outofmem", "Out of memory"); }

1791 i(
comp
 & 1
n
 = comp; n = comp-1;

1792 
i
=0; i < 
x
*
y
; ++i) {

1793 
k
=0; k < 
n
; ++k) {

1794 
z
 = (
	`pow
(
da
[
i
*
comp
+
k
]*
bi__h2l_s_i
, 
bi__h2l_gamma_i
) * 255 + 0.5f;

1795 i(
z
 < 0) z = 0;

1796 i(
z
 > 255) z = 255;

1797 
ouut
[
i
*
comp
 + 
k
] = (
bi_uc

	`bi__t2t
(
z
);

1799 i(
k
 < 
comp
) {

1800 
z
 = 
da
[
i
*
comp
+
k
] * 255 + 0.5f;

1801 i(
z
 < 0) z = 0;

1802 i(
z
 > 255) z = 255;

1803 
ouut
[
i
*
comp
 + 
k
] = (
bi_uc

	`bi__t2t
(
z
);

1806 
	`STBI_FREE
(
da
);

1807  
ouut
;

1808 
	}
}

1832 #ide
STBI_NO_JPEG


1835 
	#FAST_BITS
 9

1836 

	)

1839 
bi_uc
 
	m
[1 << 
FAST_BITS
];

1841 
bi__ut16
 
	mcode
[256];

1842 
bi_uc
 
	mvues
[256];

1843 
bi_uc
 
	msize
[257];

1844 
	mmaxcode
[18];

1845 
	md
[17];

1846 } 
	tbi__huffm
;

1850 
bi__cڋxt
 *
	ms
;

1851 
bi__huffm
 
	mhuff_dc
[4];

1852 
bi__huffm
 
	mhuff_ac
[4];

1853 
bi__ut16
 
	mdequt
[4][64];

1854 
bi__t16
 
	m_ac
[4][1 << 
FAST_BITS
];

1857 
	mimg_h_max
, 
	mimg_v_max
;

1858 
	mimg_mcu_x
, 
	mimg_mcu_y
;

1859 
	mimg_mcu_w
, 
	mimg_mcu_h
;

1864 
	mid
;

1865 
	mh
,
	mv
;

1866 
	mtq
;

1867 
	mhd
,
	mha
;

1868 
	mdc_ed
;

1870 
	mx
,
	my
,
	mw2
,
	mh2
;

1871 
bi_uc
 *
	mda
;

1872 *
	mw_da
, *
	mw_cff
;

1873 
bi_uc
 *
	mlebuf
;

1874 *
	mcff
;

1875 
	mcff_w
, 
	mcff_h
;

1876 } 
	mimg_comp
[4];

1878 
bi__ut32
 
	mcode_bufr
;

1879 
	mcode_bs
;

1880 
	mmk
;

1881 
	mnome
;

1883 
	mogssive
;

1884 
	mec_t
;

1885 
	mec_d
;

1886 
	msucc_high
;

1887 
	msucc_low
;

1888 
	meob_run
;

1889 
	mjfif
;

1890 
	mp14_c_sfm
;

1891 
	mrgb
;

1893 
	msn_n
, 
	md
[4];

1894 
	mt_rv
, 
	mtodo
;

1897 (*
	mid_block_kl
)(
bi_uc
 *
	mout
, 
	mout_ride
, 
	mda
[64]);

1898 (*
	mYCbCr_to_RGB_kl
)(
bi_uc
 *
	mout
, cڡ stbi_u*
	my
, cڡ stbi_u*
	mpcb
, cڡ stbi_u*
	mp
, 
	mcou
, 
	m
);

1899 
	mbi_uc
 *(*
	mme_row_hv_2_kl
)(
bi_uc
 *
	mout
, stbi_u*
	m_ì
, stbi_u*
	m_r
, 
	mw
, 
	mhs
);

1900 } 
	tbi__jg
;

1902 
	$bi__bud_huffm
(
bi__huffm
 *
h
, *
cou
)

1904 
i
,
j
,
k
=0;

1905 
code
;

1907 
i
=0; i < 16; ++i)

1908 
j
=0; j < 
cou
[
i
]; ++j)

1909 
h
->
size
[
k
++] = (
bi_uc
(
i
+1);

1910 
h
->
size
[
k
] = 0;

1913 
code
 = 0;

1914 
k
 = 0;

1915 
j
=1; j <= 16; ++j) {

1917 
h
->
d
[
j
] = 
k
 - 
code
;

1918 i(
h
->
size
[
k
] =
j
) {

1919 
h
->
size
[
k
] =
j
)

1920 
h
->
code
[
k
++] = (
bi__ut16
) (code++);

1921 i(
code
-1 >(1u << 
j
) 
	`bi__r
("bad codeengths","Corrupt JPEG");

1924 
h
->
maxcode
[
j
] = 
code
 << (16-j);

1925 
code
 <<= 1;

1927 
h
->
maxcode
[
j
] = 0xffffffff;

1930 
	`memt
(
h
->

, 255, 1 << 
FAST_BITS
);

1931 
i
=0; i < 
k
; ++i) {

1932 
s
 = 
h
->
size
[
i
];

1933 i(
s
 <
FAST_BITS
) {

1934 
c
 = 
h
->
code
[
i
] << (
FAST_BITS
-
s
);

1935 
m
 = 1 << (
FAST_BITS
-
s
);

1936 
j
=0; j < 
m
; ++j) {

1937 
h
->

[
c
+
j
] = (
bi_uc

i
;

1942 
	}
}

1946 
	$bi__bud__ac
(
bi__t16
 *
_ac
, 
bi__huffm
 *
h
)

1948 
i
;

1949 
i
=0; i < (1 << 
FAST_BITS
); ++i) {

1950 
bi_uc
 

 = 
h
->[
i
];

1951 
_ac
[
i
] = 0;

1952 i(

 < 255) {

1953 
rs
 = 
h
->
vues
[

];

1954 
run
 = (
rs
 >> 4) & 15;

1955 
magbs
 = 
rs
 & 15;

1956 
n
 = 
h
->
size
[

];

1958 i(
magbs
 && 
n
 + magb<
FAST_BITS
) {

1960 
k
 = ((
i
 << 
n
& ((1 << 
FAST_BITS
- 1)>> (FAST_BITS - 
magbs
);

1961 
m
 = 1 << (
magbs
 - 1);

1962 i(
k
 < 
m
k +(~0U << 
magbs
) + 1;

1964 i(
k
 >= -128 && k <= 127)

1965 
_ac
[
i
] = (
bi__t16
((
k
 * 256+ (
run
 * 16+ (
n
 + 
magbs
));

1969 
	}
}

1971 
	$bi__grow_bufr_un
(
bi__jg
 *
j
)

1974 
b
 = 
j
->
nome
 ? 0 : 
	`bi__g8
(j->
s
);

1975 i(
b
 == 0xff) {

1976 
c
 = 
	`bi__g8
(
j
->
s
);

1977 
c
 =0xff
	`bi__g8
(
j
->
s
);

1978 i(
c
 != 0) {

1979 
j
->
mk
 = (
c
;

1980 
j
->
nome
 = 1;

1984 
j
->
code_bufr
 |
b
 << (24 - j->
code_bs
);

1985 
j
->
code_bs
 += 8;

1986 } 
j
->
code_bs
 <= 24);

1987 
	}
}

1990 cڡ 
bi__ut32
 
	gbi__bmask
[17]={0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535};

1993 
bi_le
 
	$bi__jg_huff_decode
(
bi__jg
 *
j
, 
bi__huffm
 *
h
)

1995 
mp
;

1996 
c
,
k
;

1998 i(
j
->
code_bs
 < 16
	`bi__grow_bufr_un
(j);

2002 
c
 = (
j
->
code_bufr
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2003 
k
 = 
h
->

[
c
];

2004 i(
k
 < 255) {

2005 
s
 = 
h
->
size
[
k
];

2006 i(
s
 > 
j
->
code_bs
)

2008 
j
->
code_bufr
 <<
s
;

2009 
j
->
code_bs
 -
s
;

2010  
h
->
vues
[
k
];

2019 
mp
 = 
j
->
code_bufr
 >> 16;

2020 
k
=
FAST_BITS
+1 ; ; ++k)

2021 i(
mp
 < 
h
->
maxcode
[
k
])

2023 i(
k
 == 17) {

2025 
j
->
code_bs
 -= 16;

2029 i(
k
 > 
j
->
code_bs
)

2033 
c
 = ((
j
->
code_bufr
 >> (32 - 
k
)& 
bi__bmask
[k]+ 
h
->
d
[k];

2034 
	`STBI_ASSERT
((((
j
->
code_bufr
>> (32 - 
h
->
size
[
c
])& 
bi__bmask
[h->size[c]]=h->
code
[c]);

2037 
j
->
code_bs
 -
k
;

2038 
j
->
code_bufr
 <<
k
;

2039  
h
->
vues
[
c
];

2040 
	}
}

2043 cڡ 
	gbi__jbs
[16] = {0,-1,-3,-7,-15,-31,-63,-127,-255,-511,-1023,-2047,-4095,-8191,-16383,-32767};

2047 
bi_le
 
	$bi__exnd_ive
(
bi__jg
 *
j
, 
n
)

2049 
k
;

2050 
sgn
;

2051 i(
j
->
code_bs
 < 
n

	`bi__grow_bufr_un
(j);

2053 
sgn
 = (
bi__t32
)
j
->
code_bufr
 >> 31;

2054 
k
 = 
	`bi_
(
j
->
code_bufr
, 
n
);

2055 
	`STBI_ASSERT
(
n
 >0 && < (((
bi__bmask
)/(*stbi__bmask)));

2056 
j
->
code_bufr
 = 
k
 & ~
bi__bmask
[
n
];

2057 
k
 &
bi__bmask
[
n
];

2058 
j
->
code_bs
 -
n
;

2059  
k
 + (
bi__jbs
[
n
] & ~
sgn
);

2060 
	}
}

2063 
bi_le
 
	$bi__jg_g_bs
(
bi__jg
 *
j
, 
n
)

2065 
k
;

2066 i(
j
->
code_bs
 < 
n

	`bi__grow_bufr_un
(j);

2067 
k
 = 
	`bi_
(
j
->
code_bufr
, 
n
);

2068 
j
->
code_bufr
 = 
k
 & ~
bi__bmask
[
n
];

2069 
k
 &
bi__bmask
[
n
];

2070 
j
->
code_bs
 -
n
;

2071  
k
;

2072 
	}
}

2074 
bi_le
 
	$bi__jg_g_b
(
bi__jg
 *
j
)

2076 
k
;

2077 i(
j
->
code_bs
 < 1
	`bi__grow_bufr_un
(j);

2078 
k
 = 
j
->
code_bufr
;

2079 
j
->
code_bufr
 <<= 1;

2080 --
j
->
code_bs
;

2081  
k
 & 0x80000000;

2082 
	}
}

2086 cڡ 
bi_uc
 
	gbi__jg_dezigzag
[64+15] =

2102 
	$bi__jg_decode_block
(
bi__jg
 *
j
, 
da
[64], 
bi__huffm
 *
hdc
, stbi__huffm *
hac
, 
bi__t16
 *
c
, 
b
, 
bi__ut16
 *
dequt
)

2104 
diff
,
dc
,
k
;

2105 
t
;

2107 i(
j
->
code_bs
 < 16
	`bi__grow_bufr_un
(j);

2108 
t
 = 
	`bi__jg_huff_decode
(
j
, 
hdc
);

2109 i(
t
 < 0 
	`bi__r
("bad huffman code","Corrupt JPEG");

2112 
	`memt
(
da
,0,64*(data[0]));

2114 
diff
 = 
t
 ? 
	`bi__exnd_ive
(
j
,) : 0;

2115 
dc
 = 
j
->
img_comp
[
b
].
dc_ed
 + 
diff
;

2116 
j
->
img_comp
[
b
].
dc_ed
 = 
dc
;

2117 
da
[0] = ((
dc
 * 
dequt
[0]);

2120 
k
 = 1;

2122 
zig
;

2123 
c
,
r
,
s
;

2124 i(
j
->
code_bs
 < 16
	`bi__grow_bufr_un
(j);

2125 
c
 = (
j
->
code_bufr
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2126 
r
 = 
c
[
c
];

2127 i(
r
) {

2128 
k
 +(
r
 >> 4) & 15;

2129 
s
 = 
r
 & 15;

2130 
j
->
code_bufr
 <<
s
;

2131 
j
->
code_bs
 -
s
;

2133 
zig
 = 
bi__jg_dezigzag
[
k
++];

2134 
da
[
zig
] = (((
r
 >> 8* 
dequt
[zig]);

2136 
rs
 = 
	`bi__jg_huff_decode
(
j
, 
hac
);

2137 i(
rs
 < 0 
	`bi__r
("bad huffman code","Corrupt JPEG");

2138 
s
 = 
rs
 & 15;

2139 
r
 = 
rs
 >> 4;

2140 i(
s
 == 0) {

2141 i(
rs
 != 0xf0) ;

2142 
k
 += 16;

2144 
k
 +
r
;

2146 
zig
 = 
bi__jg_dezigzag
[
k
++];

2147 
da
[
zig
] = ((
	`bi__exnd_ive
(
j
,
s
* 
dequt
[zig]);

2150 } 
k
 < 64);

2152 
	}
}

2154 
	$bi__jg_decode_block_og_dc
(
bi__jg
 *
j
, 
da
[64], 
bi__huffm
 *
hdc
, 
b
)

2156 
diff
,
dc
;

2157 
t
;

2158 i(
j
->
ec_d
 !0 
	`bi__r
("can't merge dcndc", "Corrupt JPEG");

2160 i(
j
->
code_bs
 < 16
	`bi__grow_bufr_un
(j);

2162 i(
j
->
succ_high
 == 0) {

2164 
	`memt
(
da
,0,64*(data[0]));

2165 
t
 = 
	`bi__jg_huff_decode
(
j
, 
hdc
);

2166 
diff
 = 
t
 ? 
	`bi__exnd_ive
(
j
,) : 0;

2168 
dc
 = 
j
->
img_comp
[
b
].
dc_ed
 + 
diff
;

2169 
j
->
img_comp
[
b
].
dc_ed
 = 
dc
;

2170 
da
[0] = ((
dc
 << 
j
->
succ_low
);

2173 i(
	`bi__jg_g_b
(
j
))

2174 
da
[0] +((1 << 
j
->
succ_low
);

2177 
	}
}

2181 
	$bi__jg_decode_block_og_ac
(
bi__jg
 *
j
, 
da
[64], 
bi__huffm
 *
hac
, 
bi__t16
 *
c
)

2183 
k
;

2184 i(
j
->
ec_t
 =0 
	`bi__r
("can't merge dcndc", "Corrupt JPEG");

2186 i(
j
->
succ_high
 == 0) {

2187 
shi
 = 
j
->
succ_low
;

2189 i(
j
->
eob_run
) {

2190 --
j
->
eob_run
;

2194 
k
 = 
j
->
ec_t
;

2196 
zig
;

2197 
c
,
r
,
s
;

2198 i(
j
->
code_bs
 < 16
	`bi__grow_bufr_un
(j);

2199 
c
 = (
j
->
code_bufr
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2200 
r
 = 
c
[
c
];

2201 i(
r
) {

2202 
k
 +(
r
 >> 4) & 15;

2203 
s
 = 
r
 & 15;

2204 
j
->
code_bufr
 <<
s
;

2205 
j
->
code_bs
 -
s
;

2206 
zig
 = 
bi__jg_dezigzag
[
k
++];

2207 
da
[
zig
] = (((
r
 >> 8<< 
shi
);

2209 
rs
 = 
	`bi__jg_huff_decode
(
j
, 
hac
);

2210 i(
rs
 < 0 
	`bi__r
("bad huffman code","Corrupt JPEG");

2211 
s
 = 
rs
 & 15;

2212 
r
 = 
rs
 >> 4;

2213 i(
s
 == 0) {

2214 i(
r
 < 15) {

2215 
j
->
eob_run
 = (1 << 
r
);

2216 i(
r
)

2217 
j
->
eob_run
 +
	`bi__jg_g_bs
(j, 
r
);

2218 --
j
->
eob_run
;

2221 
k
 += 16;

2223 
k
 +
r
;

2224 
zig
 = 
bi__jg_dezigzag
[
k
++];

2225 
da
[
zig
] = ((
	`bi__exnd_ive
(
j
,
s
<< 
shi
);

2228 } 
k
 <
j
->
ec_d
);

2232 
b
 = ((1 << 
j
->
succ_low
);

2234 i(
j
->
eob_run
) {

2235 --
j
->
eob_run
;

2236 
k
 = 
j
->
ec_t
; k <j->
ec_d
; ++k) {

2237 *
p
 = &
da
[
bi__jg_dezigzag
[
k
]];

2238 i(*
p
 != 0)

2239 i(
	`bi__jg_g_b
(
j
))

2240 i((*
p
 & 
b
)==0) {

2241 i(*
p
 > 0)

2242 *
p
 +
b
;

2244 *
p
 -
b
;

2248 
k
 = 
j
->
ec_t
;

2250 
r
,
s
;

2251 
rs
 = 
	`bi__jg_huff_decode
(
j
, 
hac
);

2252 i(
rs
 < 0 
	`bi__r
("bad huffman code","Corrupt JPEG");

2253 
s
 = 
rs
 & 15;

2254 
r
 = 
rs
 >> 4;

2255 i(
s
 == 0) {

2256 i(
r
 < 15) {

2257 
j
->
eob_run
 = (1 << 
r
) - 1;

2258 i(
r
)

2259 
j
->
eob_run
 +
	`bi__jg_g_bs
(j, 
r
);

2260 
r
 = 64;

2267 i(
s
 !1 
	`bi__r
("bad huffman code", "Corrupt JPEG");

2269 i(
	`bi__jg_g_b
(
j
))

2270 
s
 = 
b
;

2272 
s
 = -
b
;

2276 
k
 <
j
->
ec_d
) {

2277 *
p
 = &
da
[
bi__jg_dezigzag
[
k
++]];

2278 i(*
p
 != 0) {

2279 i(
	`bi__jg_g_b
(
j
))

2280 i((*
p
 & 
b
)==0) {

2281 i(*
p
 > 0)

2282 *
p
 +
b
;

2284 *
p
 -
b
;

2287 i(
r
 == 0) {

2288 *
p
 = (
s
;

2291 --
r
;

2294 } 
k
 <
j
->
ec_d
);

2298 
	}
}

2301 
bi_le
 
bi_uc
 
	$bi__amp
(
x
)

2304 i((
x
 > 255) {

2305 i(
x
 < 0)  0;

2306 i(
x
 > 255)  255;

2308  (
bi_uc

x
;

2309 
	}
}

2311 
	#bi__f2f
(
x
(((((x* 4096 + 0.5)))

	)

2312 
	#bi__fsh
(
x
((x* 4096)

	)

2315 
	#STBI__IDCT_1D
(
s0
,
s1
,
s2
,
s3
,
s4
,
s5
,
s6
,
s7
) \

2316 
t0
,
t1
,
t2
,
t3
,
p1
,
p2
,
p3
,
p4
,
p5
,
x0
,
x1
,
x2
,
x3
; \

2317 
p2
 = 
s2
; \

2318 
p3
 = 
s6
; \

2319 
p1
 = (
p2
+
p3
* 
	`bi__f2f
(0.5411961f); \

2320 
t2
 = 
p1
 + 
p3
*
	`bi__f2f
(-1.847759065f); \

2321 
t3
 = 
p1
 + 
p2
*
	`bi__f2f
( 0.765366865f); \

2322 
p2
 = 
s0
; \

2323 
p3
 = 
s4
; \

2324 
t0
 = 
	`bi__fsh
(
p2
+
p3
); \

2325 
t1
 = 
	`bi__fsh
(
p2
-
p3
); \

2326 
x0
 = 
t0
+
t3
; \

2327 
x3
 = 
t0
-
t3
; \

2328 
x1
 = 
t1
+
t2
; \

2329 
x2
 = 
t1
-
t2
; \

2330 
t0
 = 
s7
; \

2331 
t1
 = 
s5
; \

2332 
t2
 = 
s3
; \

2333 
t3
 = 
s1
; \

2334 
p3
 = 
t0
+
t2
; \

2335 
p4
 = 
t1
+
t3
; \

2336 
p1
 = 
t0
+
t3
; \

2337 
p2
 = 
t1
+
t2
; \

2338 
p5
 = (
p3
+
p4
)*
	`bi__f2f
( 1.175875602f); \

2339 
t0
 =0*
	`bi__f2f
( 0.298631336f); \

2340 
t1
 =1*
	`bi__f2f
( 2.053119869f); \

2341 
t2
 =2*
	`bi__f2f
( 3.072711026f); \

2342 
t3
 =3*
	`bi__f2f
( 1.501321110f); \

2343 
p1
 = 
p5
 +1*
	`bi__f2f
(-0.899976223f); \

2344 
p2
 = 
p5
 +2*
	`bi__f2f
(-2.562915447f); \

2345 
p3
 =3*
	`bi__f2f
(-1.961570560f); \

2346 
p4
 =4*
	`bi__f2f
(-0.390180644f); \

2347 
t3
 +
p1
+
p4
; \

2348 
t2
 +
p2
+
p3
; \

2349 
t1
 +
p2
+
p4
; \

2350 
t0
 +
p1
+
p3
;

	)

2352 
	$bi__id_block
(
bi_uc
 *
out
, 
out_ride
, 
da
[64])

2354 
i
,
v
[64],*
v
=val;

2355 
bi_uc
 *
o
;

2356 *
d
 = 
da
;

2359 
i
=0; i < 8; ++i,++
d
, ++
v
) {

2361 i(
d
[ 8]==0 && d[16]==0 && d[24]==0 && d[32]==0

2362 && 
d
[40]==0 && d[48]==0 && d[56]==0) {

2367 
dm
 = 
d
[0]*4;

2368 
v
[0] = v[8] = v[16] = v[24] = v[32] = v[40] = v[48] = v[56] = 
dm
;

2370 
	`STBI__IDCT_1D
(
d
[ 0],d[ 8],d[16],d[24],d[32],d[40],d[48],d[56])

2373 
x0
 +512; 
x1
 +512; 
x2
 +512; 
x3
 += 512;

2374 
v
[ 0] = (
x0
+
t3
) >> 10;

2375 
v
[56] = (
x0
-
t3
) >> 10;

2376 
v
[ 8] = (
x1
+
t2
) >> 10;

2377 
v
[48] = (
x1
-
t2
) >> 10;

2378 
v
[16] = (
x2
+
t1
) >> 10;

2379 
v
[40] = (
x2
-
t1
) >> 10;

2380 
v
[24] = (
x3
+
t0
) >> 10;

2381 
v
[32] = (
x3
-
t0
) >> 10;

2385 
i
=0, 
v
=
v
, 
o
=
out
; i < 8; ++i,v+=8,o+=
out_ride
) {

2387 
	`STBI__IDCT_1D
(
v
[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7])

2394 
x0
 += 65536 + (128<<17);

2395 
x1
 += 65536 + (128<<17);

2396 
x2
 += 65536 + (128<<17);

2397 
x3
 += 65536 + (128<<17);

2400 
o
[0] = 
	`bi__amp
((
x0
+
t3
) >> 17);

2401 
o
[7] = 
	`bi__amp
((
x0
-
t3
) >> 17);

2402 
o
[1] = 
	`bi__amp
((
x1
+
t2
) >> 17);

2403 
o
[6] = 
	`bi__amp
((
x1
-
t2
) >> 17);

2404 
o
[2] = 
	`bi__amp
((
x2
+
t1
) >> 17);

2405 
o
[5] = 
	`bi__amp
((
x2
-
t1
) >> 17);

2406 
o
[3] = 
	`bi__amp
((
x3
+
t0
) >> 17);

2407 
o
[4] = 
	`bi__amp
((
x3
-
t0
) >> 17);

2409 
	}
}

2411 #ifde
STBI_SSE2


2415 
	$bi__id_simd
(
bi_uc
 *
out
, 
out_ride
, 
da
[64])

2418 
__m128i
 
row0
, 
row1
, 
row2
, 
row3
, 
row4
, 
row5
, 
row6
, 
row7
;

2419 
__m128i
 
tmp
;

2422 
	#d_cڡ
(
x
,
y

	`_mm__i16
((x),(y),(x),(y),(x),(y),(x),(y))

	)

2426 
	#d_r
(
out0
,
out1
, 
x
,
y
,
c0
,
c1
) \

2427 
__m128i
 
c0
##
lo
 = 
	`_mm_uacklo_i16
((
x
),(
y
)); \

2428 
__m128i
 
c0
##
hi
 = 
	`_mm_uackhi_i16
((
x
),(
y
)); \

2429 
__m128i
 
out0
##
_l
 = 
	`_mm_madd_i16
(
c0
##
lo
, c0); \

2430 
__m128i
 
out0
##
_h
 = 
	`_mm_madd_i16
(
c0
##
hi
, c0); \

2431 
__m128i
 
out1
##
_l
 = 
	`_mm_madd_i16
(
c0
##
lo
, 
c1
); \

2432 
__m128i
 
out1
##
_h
 = 
	`_mm_madd_i16
(
c0
##
hi
, 
c1
)

	)

2435 
	#d_wid
(
out
, 

) \

2436 
__m128i
 
out
##
_l
 = 
	`_mm_ai_i32
(
	`_mm_uacklo_i16
(
	`_mm_tzo_si128
(), (

)), 4); \

2437 
__m128i
 
out
##
_h
 = 
	`_mm_ai_i32
(
	`_mm_uackhi_i16
(
	`_mm_tzo_si128
(), (

)), 4)

	)

2440 
	#d_wadd
(
out
, 
a
, 
b
) \

2441 
__m128i
 
out
##
_l
 = 
	`_mm_add_i32
(
a
##_l, 
b
##_l); \

2442 
__m128i
 
out
##
_h
 = 
	`_mm_add_i32
(
a
##_h, 
b
##_h)

	)

2445 
	#d_wsub
(
out
, 
a
, 
b
) \

2446 
__m128i
 
out
##
_l
 = 
	`_mm_sub_i32
(
a
##_l, 
b
##_l); \

2447 
__m128i
 
out
##
_h
 = 
	`_mm_sub_i32
(
a
##_h, 
b
##_h)

	)

2450 
	#d_by32o
(
out0
, 
out1
, 
a
,
b
,
bs
,
s
) \

2452 
__m128i
 
abd_l
 = 
	`_mm_add_i32
(
a
##
_l
, 
bs
); \

2453 
__m128i
 
abd_h
 = 
	`_mm_add_i32
(
a
##
_h
, 
bs
); \

2454 
	`d_wadd
(
sum
, 
abd
, 
b
); \

2455 
	`d_wsub
(
dif
, 
abd
, 
b
); \

2456 
out0
 = 
	`_mm_cks_i32
(
	`_mm_ai_i32
(
sum_l
, 
s
), _mm_ai_i32(
sum_h
, s)); \

2457 
out1
 = 
	`_mm_cks_i32
(
	`_mm_ai_i32
(
dif_l
, 
s
), _mm_ai_i32(
dif_h
, s)); \

2458 }

	)

2461 
	#d_ve8
(
a
, 
b
) \

2462 
tmp
 = 
a
; \

2463 
a
 = 
	`_mm_uacklo_i8
, 
b
); \

2464 
b
 = 
	`_mm_uackhi_i8
(
tmp
, b)

	)

2467 
	#d_ve16
(
a
, 
b
) \

2468 
tmp
 = 
a
; \

2469 
a
 = 
	`_mm_uacklo_i16
, 
b
); \

2470 
b
 = 
	`_mm_uackhi_i16
(
tmp
, b)

	)

2472 
	#d_ss
(
bs
,
shi
) \

2475 
	`d_r
(
t2e
,
t3e
, 
row2
,
row6
, 
r0_0
,
r0_1
); \

2476 
__m128i
 
sum04
 = 
	`_mm_add_i16
(
row0
, 
row4
); \

2477 
__m128i
 
dif04
 = 
	`_mm_sub_i16
(
row0
, 
row4
); \

2478 
	`d_wid
(
t0e
, 
sum04
); \

2479 
	`d_wid
(
t1e
, 
dif04
); \

2480 
	`d_wadd
(
x0
, 
t0e
, 
t3e
); \

2481 
	`d_wsub
(
x3
, 
t0e
, 
t3e
); \

2482 
	`d_wadd
(
x1
, 
t1e
, 
t2e
); \

2483 
	`d_wsub
(
x2
, 
t1e
, 
t2e
); \

2485 
	`d_r
(
y0o
,
y2o
, 
row7
,
row3
, 
r2_0
,
r2_1
); \

2486 
	`d_r
(
y1o
,
y3o
, 
row5
,
row1
, 
r3_0
,
r3_1
); \

2487 
__m128i
 
sum17
 = 
	`_mm_add_i16
(
row1
, 
row7
); \

2488 
__m128i
 
sum35
 = 
	`_mm_add_i16
(
row3
, 
row5
); \

2489 
	`d_r
(
y4o
,
y5o
, 
sum17
,
sum35
, 
r1_0
,
r1_1
); \

2490 
	`d_wadd
(
x4
, 
y0o
, 
y4o
); \

2491 
	`d_wadd
(
x5
, 
y1o
, 
y5o
); \

2492 
	`d_wadd
(
x6
, 
y2o
, 
y5o
); \

2493 
	`d_wadd
(
x7
, 
y3o
, 
y4o
); \

2494 
	`d_by32o
(
row0
,
row7
, 
x0
,
x7
,
bs
,
shi
); \

2495 
	`d_by32o
(
row1
,
row6
, 
x1
,
x6
,
bs
,
shi
); \

2496 
	`d_by32o
(
row2
,
row5
, 
x2
,
x5
,
bs
,
shi
); \

2497 
	`d_by32o
(
row3
,
row4
, 
x3
,
x4
,
bs
,
shi
); \

2498 }

	)

2500 
__m128i
 
r0_0
 = 
	`d_cڡ
(
	`bi__f2f
(0.5411961f), stbi__f2f(0.5411961f) + stbi__f2f(-1.847759065f));

2501 
__m128i
 
r0_1
 = 
	`d_cڡ
(
	`bi__f2f
(0.5411961f) + stbi__f2f( 0.765366865f), stbi__f2f(0.5411961f));

2502 
__m128i
 
r1_0
 = 
	`d_cڡ
(
	`bi__f2f
(1.175875602f) + stbi__f2f(-0.899976223f), stbi__f2f(1.175875602f));

2503 
__m128i
 
r1_1
 = 
	`d_cڡ
(
	`bi__f2f
(1.175875602f), stbi__f2f(1.175875602f) + stbi__f2f(-2.562915447f));

2504 
__m128i
 
r2_0
 = 
	`d_cڡ
(
	`bi__f2f
(-1.961570560f) + stbi__f2f( 0.298631336f), stbi__f2f(-1.961570560f));

2505 
__m128i
 
r2_1
 = 
	`d_cڡ
(
	`bi__f2f
(-1.961570560f), stbi__f2f(-1.961570560f) + stbi__f2f( 3.072711026f));

2506 
__m128i
 
r3_0
 = 
	`d_cڡ
(
	`bi__f2f
(-0.390180644f) + stbi__f2f( 2.053119869f), stbi__f2f(-0.390180644f));

2507 
__m128i
 
r3_1
 = 
	`d_cڡ
(
	`bi__f2f
(-0.390180644f), stbi__f2f(-0.390180644f) + stbi__f2f( 1.501321110f));

2510 
__m128i
 
bs_0
 = 
	`_mm_t1_i32
(512);

2511 
__m128i
 
bs_1
 = 
	`_mm_t1_i32
(65536 + (128<<17));

2514 
row0
 = 
	`_mm_ld_si128
((cڡ 
__m128i
 *(
da
 + 0*8));

2515 
row1
 = 
	`_mm_ld_si128
((cڡ 
__m128i
 *(
da
 + 1*8));

2516 
row2
 = 
	`_mm_ld_si128
((cڡ 
__m128i
 *(
da
 + 2*8));

2517 
row3
 = 
	`_mm_ld_si128
((cڡ 
__m128i
 *(
da
 + 3*8));

2518 
row4
 = 
	`_mm_ld_si128
((cڡ 
__m128i
 *(
da
 + 4*8));

2519 
row5
 = 
	`_mm_ld_si128
((cڡ 
__m128i
 *(
da
 + 5*8));

2520 
row6
 = 
	`_mm_ld_si128
((cڡ 
__m128i
 *(
da
 + 6*8));

2521 
row7
 = 
	`_mm_ld_si128
((cڡ 
__m128i
 *(
da
 + 7*8));

2524 
	`d_ss
(
bs_0
, 10);

2528 
	`d_ve16
(
row0
, 
row4
);

2529 
	`d_ve16
(
row1
, 
row5
);

2530 
	`d_ve16
(
row2
, 
row6
);

2531 
	`d_ve16
(
row3
, 
row7
);

2534 
	`d_ve16
(
row0
, 
row2
);

2535 
	`d_ve16
(
row1
, 
row3
);

2536 
	`d_ve16
(
row4
, 
row6
);

2537 
	`d_ve16
(
row5
, 
row7
);

2540 
	`d_ve16
(
row0
, 
row1
);

2541 
	`d_ve16
(
row2
, 
row3
);

2542 
	`d_ve16
(
row4
, 
row5
);

2543 
	`d_ve16
(
row6
, 
row7
);

2547 
	`d_ss
(
bs_1
, 17);

2551 
__m128i
 
p0
 = 
	`_mm_ckus_i16
(
row0
, 
row1
);

2552 
__m128i
 
p1
 = 
	`_mm_ckus_i16
(
row2
, 
row3
);

2553 
__m128i
 
p2
 = 
	`_mm_ckus_i16
(
row4
, 
row5
);

2554 
__m128i
 
p3
 = 
	`_mm_ckus_i16
(
row6
, 
row7
);

2557 
	`d_ve8
(
p0
, 
p2
);

2558 
	`d_ve8
(
p1
, 
p3
);

2561 
	`d_ve8
(
p0
, 
p1
);

2562 
	`d_ve8
(
p2
, 
p3
);

2565 
	`d_ve8
(
p0
, 
p2
);

2566 
	`d_ve8
(
p1
, 
p3
);

2569 
	`_mm_ܖ_i64
((
__m128i
 *
out
, 
p0
); ou+
out_ride
;

2570 
	`_mm_ܖ_i64
((
__m128i
 *
out
, 
	`_mm_shufe_i32
(
p0
, 0x4e)); ou+
out_ride
;

2571 
	`_mm_ܖ_i64
((
__m128i
 *
out
, 
p2
); ou+
out_ride
;

2572 
	`_mm_ܖ_i64
((
__m128i
 *
out
, 
	`_mm_shufe_i32
(
p2
, 0x4e)); ou+
out_ride
;

2573 
	`_mm_ܖ_i64
((
__m128i
 *
out
, 
p1
); ou+
out_ride
;

2574 
	`_mm_ܖ_i64
((
__m128i
 *
out
, 
	`_mm_shufe_i32
(
p1
, 0x4e)); ou+
out_ride
;

2575 
	`_mm_ܖ_i64
((
__m128i
 *
out
, 
p3
); ou+
out_ride
;

2576 
	`_mm_ܖ_i64
((
__m128i
 *
out
, 
	`_mm_shufe_i32
(
p3
, 0x4e));

2579 #unde
d_cڡ


2580 #unde
d_r


2581 #unde
d_wid


2582 #unde
d_wadd


2583 #unde
d_wsub


2584 #unde
d_by32o


2585 #unde
d_ve8


2586 #unde
d_ve16


2587 #unde
d_ss


2588 
	}
}

2592 #ifde
STBI_NEON


2596 
	$bi__id_simd
(
bi_uc
 *
out
, 
out_ride
, 
p_da
[64])

2598 
t16x8_t
 
row0
, 
row1
, 
row2
, 
row3
, 
row4
, 
row5
, 
row6
, 
row7
;

2600 
t16x4_t
 
r0_0
 = 
	`vdup_n_s16
(
	`bi__f2f
(0.5411961f));

2601 
t16x4_t
 
r0_1
 = 
	`vdup_n_s16
(
	`bi__f2f
(-1.847759065f));

2602 
t16x4_t
 
r0_2
 = 
	`vdup_n_s16
(
	`bi__f2f
( 0.765366865f));

2603 
t16x4_t
 
r1_0
 = 
	`vdup_n_s16
(
	`bi__f2f
( 1.175875602f));

2604 
t16x4_t
 
r1_1
 = 
	`vdup_n_s16
(
	`bi__f2f
(-0.899976223f));

2605 
t16x4_t
 
r1_2
 = 
	`vdup_n_s16
(
	`bi__f2f
(-2.562915447f));

2606 
t16x4_t
 
r2_0
 = 
	`vdup_n_s16
(
	`bi__f2f
(-1.961570560f));

2607 
t16x4_t
 
r2_1
 = 
	`vdup_n_s16
(
	`bi__f2f
(-0.390180644f));

2608 
t16x4_t
 
r3_0
 = 
	`vdup_n_s16
(
	`bi__f2f
( 0.298631336f));

2609 
t16x4_t
 
r3_1
 = 
	`vdup_n_s16
(
	`bi__f2f
( 2.053119869f));

2610 
t16x4_t
 
r3_2
 = 
	`vdup_n_s16
(
	`bi__f2f
( 3.072711026f));

2611 
t16x4_t
 
r3_3
 = 
	`vdup_n_s16
(
	`bi__f2f
( 1.501321110f));

2613 
	#d_lg_mul
(
out
, 
q
, 
cff
) \

2614 
t32x4_t
 
out
##
_l
 = 
	`vmu_s16
(
	`vg_low_s16
(
q
), 
cff
); \

2615 
t32x4_t
 
out
##
_h
 = 
	`vmu_s16
(
	`vg_high_s16
(
q
), 
cff
)

	)

2617 
	#d_lg_mac
(
out
, 
acc
, 
q
, 
cff
) \

2618 
t32x4_t
 
out
##
_l
 = 
	`vml_s16
(
acc
##_l, 
	`vg_low_s16
(
q
), 
cff
); \

2619 
t32x4_t
 
out
##
_h
 = 
	`vml_s16
(
acc
##_h, 
	`vg_high_s16
(
q
), 
cff
)

	)

2621 
	#d_wid
(
out
, 
q
) \

2622 
t32x4_t
 
out
##
_l
 = 
	`vsh_n_s16
(
	`vg_low_s16
(
q
), 12); \

2623 
t32x4_t
 
out
##
_h
 = 
	`vsh_n_s16
(
	`vg_high_s16
(
q
), 12)

	)

2626 
	#d_wadd
(
out
, 
a
, 
b
) \

2627 
t32x4_t
 
out
##
_l
 = 
	`vaddq_s32
(
a
##_l, 
b
##_l); \

2628 
t32x4_t
 
out
##
_h
 = 
	`vaddq_s32
(
a
##_h, 
b
##_h)

	)

2631 
	#d_wsub
(
out
, 
a
, 
b
) \

2632 
t32x4_t
 
out
##
_l
 = 
	`vsubq_s32
(
a
##_l, 
b
##_l); \

2633 
t32x4_t
 
out
##
_h
 = 
	`vsubq_s32
(
a
##_h, 
b
##_h)

	)

2636 
	#d_by32o
(
out0
,
out1
, 
a
,
b
,
shi
,
s
) \

2638 
	`d_wadd
(
sum
, 
a
, 
b
); \

2639 
	`d_wsub
(
dif
, 
a
, 
b
); \

2640 
out0
 = 
	`vcombe_s16
(
	`shi
(
sum_l
, 
s
), shi(
sum_h
, s)); \

2641 
out1
 = 
	`vcombe_s16
(
	`shi
(
dif_l
, 
s
), shi(
dif_h
, s)); \

2642 }

	)

2644 
	#d_ss
(
shi
, 
shi
) \

2647 
t16x8_t
 
sum26
 = 
	`vaddq_s16
(
row2
, 
row6
); \

2648 
	`d_lg_mul
(
p1e
, 
sum26
, 
r0_0
); \

2649 
	`d_lg_mac
(
t2e
, 
p1e
, 
row6
, 
r0_1
); \

2650 
	`d_lg_mac
(
t3e
, 
p1e
, 
row2
, 
r0_2
); \

2651 
t16x8_t
 
sum04
 = 
	`vaddq_s16
(
row0
, 
row4
); \

2652 
t16x8_t
 
dif04
 = 
	`vsubq_s16
(
row0
, 
row4
); \

2653 
	`d_wid
(
t0e
, 
sum04
); \

2654 
	`d_wid
(
t1e
, 
dif04
); \

2655 
	`d_wadd
(
x0
, 
t0e
, 
t3e
); \

2656 
	`d_wsub
(
x3
, 
t0e
, 
t3e
); \

2657 
	`d_wadd
(
x1
, 
t1e
, 
t2e
); \

2658 
	`d_wsub
(
x2
, 
t1e
, 
t2e
); \

2660 
t16x8_t
 
sum15
 = 
	`vaddq_s16
(
row1
, 
row5
); \

2661 
t16x8_t
 
sum17
 = 
	`vaddq_s16
(
row1
, 
row7
); \

2662 
t16x8_t
 
sum35
 = 
	`vaddq_s16
(
row3
, 
row5
); \

2663 
t16x8_t
 
sum37
 = 
	`vaddq_s16
(
row3
, 
row7
); \

2664 
t16x8_t
 
sumodd
 = 
	`vaddq_s16
(
sum17
, 
sum35
); \

2665 
	`d_lg_mul
(
p5o
, 
sumodd
, 
r1_0
); \

2666 
	`d_lg_mac
(
p1o
, 
p5o
, 
sum17
, 
r1_1
); \

2667 
	`d_lg_mac
(
p2o
, 
p5o
, 
sum35
, 
r1_2
); \

2668 
	`d_lg_mul
(
p3o
, 
sum37
, 
r2_0
); \

2669 
	`d_lg_mul
(
p4o
, 
sum15
, 
r2_1
); \

2670 
	`d_wadd
(
sump13o
, 
p1o
, 
p3o
); \

2671 
	`d_wadd
(
sump24o
, 
p2o
, 
p4o
); \

2672 
	`d_wadd
(
sump23o
, 
p2o
, 
p3o
); \

2673 
	`d_wadd
(
sump14o
, 
p1o
, 
p4o
); \

2674 
	`d_lg_mac
(
x4
, 
sump13o
, 
row7
, 
r3_0
); \

2675 
	`d_lg_mac
(
x5
, 
sump24o
, 
row5
, 
r3_1
); \

2676 
	`d_lg_mac
(
x6
, 
sump23o
, 
row3
, 
r3_2
); \

2677 
	`d_lg_mac
(
x7
, 
sump14o
, 
row1
, 
r3_3
); \

2678 
	`d_by32o
(
row0
,
row7
, 
x0
,
x7
,
shi
,
shi
); \

2679 
	`d_by32o
(
row1
,
row6
, 
x1
,
x6
,
shi
,
shi
); \

2680 
	`d_by32o
(
row2
,
row5
, 
x2
,
x5
,
shi
,
shi
); \

2681 
	`d_by32o
(
row3
,
row4
, 
x3
,
x4
,
shi
,
shi
); \

2682 }

	)

2685 
row0
 = 
	`vld1q_s16
(
p_da
 + 0*8);

2686 
row1
 = 
	`vld1q_s16
(
p_da
 + 1*8);

2687 
row2
 = 
	`vld1q_s16
(
p_da
 + 2*8);

2688 
row3
 = 
	`vld1q_s16
(
p_da
 + 3*8);

2689 
row4
 = 
	`vld1q_s16
(
p_da
 + 4*8);

2690 
row5
 = 
	`vld1q_s16
(
p_da
 + 5*8);

2691 
row6
 = 
	`vld1q_s16
(
p_da
 + 6*8);

2692 
row7
 = 
	`vld1q_s16
(
p_da
 + 7*8);

2695 
row0
 = 
	`vaddq_s16
ow0, 
	`vtq__s16
(1024, 
	`vdupq_n_s16
(0), 0));

2698 
	`d_ss
(
vrsh_n_s32
, 10);

2704 
	#d_n16
(
x
, 
y
{ 
t16x8x2_t
 
t
 = 
	`vnq_s16
(x, y); x =.
v
[0]; y =.v[1]; }

	)

2705 
	#d_n32
(
x
, 
y
{ 
t32x4x2_t
 
t
 = 
	`vnq_s32
(
	`vtq_s32_s16
(x), vtq_s32_s16(y)); x = 
	`vtq_s16_s32
.
v
[0]); y = vtq_s16_s32.v[1]); }

	)

2706 
	#d_n64
(
x
, 
y
{ 
t16x8_t
 
x0
 = x; i16x8_
y0
 = y; x = 
	`vcombe_s16
(
	`vg_low_s16
(x0), vg_low_s16(y0)); y = vcombe_s16(
	`vg_high_s16
(x0), vg_high_s16(y0)); }

	)

2709 
	`d_n16
(
row0
, 
row1
);

2710 
	`d_n16
(
row2
, 
row3
);

2711 
	`d_n16
(
row4
, 
row5
);

2712 
	`d_n16
(
row6
, 
row7
);

2715 
	`d_n32
(
row0
, 
row2
);

2716 
	`d_n32
(
row1
, 
row3
);

2717 
	`d_n32
(
row4
, 
row6
);

2718 
	`d_n32
(
row5
, 
row7
);

2721 
	`d_n64
(
row0
, 
row4
);

2722 
	`d_n64
(
row1
, 
row5
);

2723 
	`d_n64
(
row2
, 
row6
);

2724 
	`d_n64
(
row3
, 
row7
);

2726 #unde
d_n16


2727 #unde
d_n32


2728 #unde
d_n64


2735 
	`d_ss
(
vsh_n_s32
, 16);

2739 
ut8x8_t
 
p0
 = 
	`vqrshrun_n_s16
(
row0
, 1);

2740 
ut8x8_t
 
p1
 = 
	`vqrshrun_n_s16
(
row1
, 1);

2741 
ut8x8_t
 
p2
 = 
	`vqrshrun_n_s16
(
row2
, 1);

2742 
ut8x8_t
 
p3
 = 
	`vqrshrun_n_s16
(
row3
, 1);

2743 
ut8x8_t
 
p4
 = 
	`vqrshrun_n_s16
(
row4
, 1);

2744 
ut8x8_t
 
p5
 = 
	`vqrshrun_n_s16
(
row5
, 1);

2745 
ut8x8_t
 
p6
 = 
	`vqrshrun_n_s16
(
row6
, 1);

2746 
ut8x8_t
 
p7
 = 
	`vqrshrun_n_s16
(
row7
, 1);

2749 
	#d_n8_8
(
x
, 
y
{ 
ut8x8x2_t
 
t
 = 
	`vn_u8
(x, y); x =.
v
[0]; y =.v[1]; }

	)

2750 
	#d_n8_16
(
x
, 
y
{ 
ut16x4x2_t
 
t
 = 
	`vn_u16
(
	`vt_u16_u8
(x), vt_u16_u8(y)); x = 
	`vt_u8_u16
.
v
[0]); y = vt_u8_u16.v[1]); }

	)

2751 
	#d_n8_32
(
x
, 
y
{ 
ut32x2x2_t
 
t
 = 
	`vn_u32
(
	`vt_u32_u8
(x), vt_u32_u8(y)); x = 
	`vt_u8_u32
.
v
[0]); y = vt_u8_u32.v[1]); }

	)

2757 
	`d_n8_8
(
p0
, 
p1
);

2758 
	`d_n8_8
(
p2
, 
p3
);

2759 
	`d_n8_8
(
p4
, 
p5
);

2760 
	`d_n8_8
(
p6
, 
p7
);

2763 
	`d_n8_16
(
p0
, 
p2
);

2764 
	`d_n8_16
(
p1
, 
p3
);

2765 
	`d_n8_16
(
p4
, 
p6
);

2766 
	`d_n8_16
(
p5
, 
p7
);

2769 
	`d_n8_32
(
p0
, 
p4
);

2770 
	`d_n8_32
(
p1
, 
p5
);

2771 
	`d_n8_32
(
p2
, 
p6
);

2772 
	`d_n8_32
(
p3
, 
p7
);

2775 
	`v1_u8
(
out
, 
p0
); ou+
out_ride
;

2776 
	`v1_u8
(
out
, 
p1
); ou+
out_ride
;

2777 
	`v1_u8
(
out
, 
p2
); ou+
out_ride
;

2778 
	`v1_u8
(
out
, 
p3
); ou+
out_ride
;

2779 
	`v1_u8
(
out
, 
p4
); ou+
out_ride
;

2780 
	`v1_u8
(
out
, 
p5
); ou+
out_ride
;

2781 
	`v1_u8
(
out
, 
p6
); ou+
out_ride
;

2782 
	`v1_u8
(
out
, 
p7
);

2784 #unde
d_n8_8


2785 #unde
d_n8_16


2786 #unde
d_n8_32


2789 #unde
d_lg_mul


2790 #unde
d_lg_mac


2791 #unde
d_wid


2792 #unde
d_wadd


2793 #unde
d_wsub


2794 #unde
d_by32o


2795 #unde
d_ss


2796 
	}
}

2800 
	#STBI__MARKER_ne
 0xff

	)

2804 
bi_uc
 
	$bi__g_mk
(
bi__jg
 *
j
)

2806 
bi_uc
 
x
;

2807 i(
j
->
mk
 !
STBI__MARKER_ne
{ 
x
 = j->marker; j->marker = STBI__MARKER_none;  x; }

2808 
x
 = 
	`bi__g8
(
j
->
s
);

2809 i(
x
 !0xff 
STBI__MARKER_ne
;

2810 
x
 == 0xff)

2811 
x
 = 
	`bi__g8
(
j
->
s
);

2812  
x
;

2813 
	}
}

2817 
	#STBI__RESTART
(
x
((x>0xd0 && (x<0xd7)

	)

2821 
	$bi__jg_t
(
bi__jg
 *
j
)

2823 
j
->
code_bs
 = 0;

2824 
j
->
code_bufr
 = 0;

2825 
j
->
nome
 = 0;

2826 
j
->
img_comp
[0].
dc_ed
 = j->img_comp[1].dc_pred = j->img_comp[2].dc_pred = j->img_comp[3].dc_pred = 0;

2827 
j
->
mk
 = 
STBI__MARKER_ne
;

2828 
j
->
todo
 = j->
t_rv
 ? j->restart_interval : 0x7fffffff;

2829 
j
->
eob_run
 = 0;

2832 
	}
}

2834 
	$bi__r_y_coded_da
(
bi__jg
 *
z
)

2836 
	`bi__jg_t
(
z
);

2837 i(!
z
->
ogssive
) {

2838 i(
z
->
sn_n
 == 1) {

2839 
i
,
j
;

2840 
	`STBI_SIMD_ALIGN
(, 
da
[64]);

2841 
n
 = 
z
->
d
[0];

2846 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2847 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2848 
j
=0; j < 
h
; ++j) {

2849 
i
=0; i < 
w
; ++i) {

2850 
ha
 = 
z
->
img_comp
[
n
].ha;

2851 i(!
	`bi__jg_decode_block
(
z
, 
da
, z->
huff_dc
+z->
img_comp
[
n
].
hd
, z->
huff_ac
+
ha
, z->
_ac
[ha],, z->
dequt
[z->img_comp[n].
tq
]))  0;

2852 
z
->
	`id_block_kl
(z->
img_comp
[
n
].
da
+z->img_comp[n].
w2
*
j
*8+
i
*8, z->img_comp[n].w2, data);

2854 i(--
z
->
todo
 <= 0) {

2855 i(
z
->
code_bs
 < 24
	`bi__grow_bufr_un
(z);

2858 i(!
	`STBI__RESTART
(
z
->
mk
))  1;

2859 
	`bi__jg_t
(
z
);

2865 
i
,
j
,
k
,
x
,
y
;

2866 
	`STBI_SIMD_ALIGN
(, 
da
[64]);

2867 
j
=0; j < 
z
->
img_mcu_y
; ++j) {

2868 
i
=0; i < 
z
->
img_mcu_x
; ++i) {

2870 
k
=0; k < 
z
->
sn_n
; ++k) {

2871 
n
 = 
z
->
d
[
k
];

2874 
y
=0; y < 
z
->
img_comp
[
n
].
v
; ++y) {

2875 
x
=0; x < 
z
->
img_comp
[
n
].
h
; ++x) {

2876 
x2
 = (
i
*
z
->
img_comp
[
n
].
h
 + 
x
)*8;

2877 
y2
 = (
j
*
z
->
img_comp
[
n
].
v
 + 
y
)*8;

2878 
ha
 = 
z
->
img_comp
[
n
].ha;

2879 i(!
	`bi__jg_decode_block
(
z
, 
da
, z->
huff_dc
+z->
img_comp
[
n
].
hd
, z->
huff_ac
+
ha
, z->
_ac
[ha],, z->
dequt
[z->img_comp[n].
tq
]))  0;

2880 
z
->
	`id_block_kl
(z->
img_comp
[
n
].
da
+z->img_comp[n].
w2
*
y2
+
x2
, z->img_comp[n].w2, data);

2886 i(--
z
->
todo
 <= 0) {

2887 i(
z
->
code_bs
 < 24
	`bi__grow_bufr_un
(z);

2888 i(!
	`STBI__RESTART
(
z
->
mk
))  1;

2889 
	`bi__jg_t
(
z
);

2896 i(
z
->
sn_n
 == 1) {

2897 
i
,
j
;

2898 
n
 = 
z
->
d
[0];

2903 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2904 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2905 
j
=0; j < 
h
; ++j) {

2906 
i
=0; i < 
w
; ++i) {

2907 *
da
 = 
z
->
img_comp
[
n
].
cff
 + 64 * (
i
 + 
j
 * z->img_comp[n].
cff_w
);

2908 i(
z
->
ec_t
 == 0) {

2909 i(!
	`bi__jg_decode_block_og_dc
(
z
, 
da
, &z->
huff_dc
[z->
img_comp
[
n
].
hd
],))

2912 
ha
 = 
z
->
img_comp
[
n
].ha;

2913 i(!
	`bi__jg_decode_block_og_ac
(
z
, 
da
, &z->
huff_ac
[
ha
], z->
_ac
[ha]))

2917 i(--
z
->
todo
 <= 0) {

2918 i(
z
->
code_bs
 < 24
	`bi__grow_bufr_un
(z);

2919 i(!
	`STBI__RESTART
(
z
->
mk
))  1;

2920 
	`bi__jg_t
(
z
);

2926 
i
,
j
,
k
,
x
,
y
;

2927 
j
=0; j < 
z
->
img_mcu_y
; ++j) {

2928 
i
=0; i < 
z
->
img_mcu_x
; ++i) {

2930 
k
=0; k < 
z
->
sn_n
; ++k) {

2931 
n
 = 
z
->
d
[
k
];

2934 
y
=0; y < 
z
->
img_comp
[
n
].
v
; ++y) {

2935 
x
=0; x < 
z
->
img_comp
[
n
].
h
; ++x) {

2936 
x2
 = (
i
*
z
->
img_comp
[
n
].
h
 + 
x
);

2937 
y2
 = (
j
*
z
->
img_comp
[
n
].
v
 + 
y
);

2938 *
da
 = 
z
->
img_comp
[
n
].
cff
 + 64 * (
x2
 + 
y2
 * z->img_comp[n].
cff_w
);

2939 i(!
	`bi__jg_decode_block_og_dc
(
z
, 
da
, &z->
huff_dc
[z->
img_comp
[
n
].
hd
],))

2946 i(--
z
->
todo
 <= 0) {

2947 i(
z
->
code_bs
 < 24
	`bi__grow_bufr_un
(z);

2948 i(!
	`STBI__RESTART
(
z
->
mk
))  1;

2949 
	`bi__jg_t
(
z
);

2956 
	}
}

2958 
	$bi__jg_dequtize
(*
da
, 
bi__ut16
 *
dequt
)

2960 
i
;

2961 
i
=0; i < 64; ++i)

2962 
da
[
i
] *
dequt
[i];

2963 
	}
}

2965 
	$bi__jg_fish
(
bi__jg
 *
z
)

2967 i(
z
->
ogssive
) {

2969 
i
,
j
,
n
;

2970 
n
=0; < 
z
->
s
->
img_n
; ++n) {

2971 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2972 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2973 
j
=0; j < 
h
; ++j) {

2974 
i
=0; i < 
w
; ++i) {

2975 *
da
 = 
z
->
img_comp
[
n
].
cff
 + 64 * (
i
 + 
j
 * z->img_comp[n].
cff_w
);

2976 
	`bi__jg_dequtize
(
da
, 
z
->
dequt
[z->
img_comp
[
n
].
tq
]);

2977 
z
->
	`id_block_kl
(z->
img_comp
[
n
].
da
+z->img_comp[n].
w2
*
j
*8+
i
*8, z->img_comp[n].w2, data);

2982 
	}
}

2984 
	$bi__oss_mk
(
bi__jg
 *
z
, 
m
)

2986 
L
;

2987 
m
) {

2988 
STBI__MARKER_ne
:

2989  
	`bi__r
("expected marker","Corrupt JPEG");

2992 i(
	`bi__g16be
(
z
->
s
!4 
	`bi__r
("bad DRIen","Corrupt JPEG");

2993 
z
->
t_rv
 = 
	`bi__g16be
(z->
s
);

2997 
L
 = 
	`bi__g16be
(
z
->
s
)-2;

2998 
L
 > 0) {

2999 
q
 = 
	`bi__g8
(
z
->
s
);

3000 
p
 = 
q
 >> 4, 
six
 = (p != 0);

3001 
t
 = 
q
 & 15,
i
;

3002 i(
p
 !0 && !1 
	`bi__r
("bad DQType","Corrupt JPEG");

3003 i(
t
 > 3 
	`bi__r
("bad DQTable","Corrupt JPEG");

3005 
i
=0; i < 64; ++i)

3006 
z
->
dequt
[
t
][
bi__jg_dezigzag
[
i
]] = (
bi__ut16
)(
six
 ? 
	`bi__g16be
(z->
s
: 
	`bi__g8
(z->s));

3007 
L
 -(
six
 ? 129 : 65);

3009  
L
==0;

3012 
L
 = 
	`bi__g16be
(
z
->
s
)-2;

3013 
L
 > 0) {

3014 
bi_uc
 *
v
;

3015 
sizes
[16],
i
,
n
=0;

3016 
q
 = 
	`bi__g8
(
z
->
s
);

3017 
tc
 = 
q
 >> 4;

3018 
th
 = 
q
 & 15;

3019 i(
tc
 > 1 || 
th
 > 3 
	`bi__r
("bad DHT header","Corrupt JPEG");

3020 
i
=0; i < 16; ++i) {

3021 
sizes
[
i
] = 
	`bi__g8
(
z
->
s
);

3022 
n
 +
sizes
[
i
];

3024 
L
 -= 17;

3025 i(
tc
 == 0) {

3026 i(!
	`bi__bud_huffm
(
z
->
huff_dc
+
th
, 
sizes
))  0;

3027 
v
 = 
z
->
huff_dc
[
th
].
vues
;

3029 i(!
	`bi__bud_huffm
(
z
->
huff_ac
+
th
, 
sizes
))  0;

3030 
v
 = 
z
->
huff_ac
[
th
].
vues
;

3032 
i
=0; i < 
n
; ++i)

3033 
v
[
i
] = 
	`bi__g8
(
z
->
s
);

3034 i(
tc
 != 0)

3035 
	`bi__bud__ac
(
z
->
_ac
[
th
], z->
huff_ac
 +h);

3036 
L
 -
n
;

3038  
L
==0;

3042 i((
m
 >= 0xE0 && m <= 0xEF) || m == 0xFE) {

3043 
L
 = 
	`bi__g16be
(
z
->
s
);

3044 i(
L
 < 2) {

3045 i(
m
 == 0xFE)

3046  
	`bi__r
("bad COMen","Corrupt JPEG");

3048  
	`bi__r
("bad APPen","Corrupt JPEG");

3050 
L
 -= 2;

3052 i(
m
 =0xE0 && 
L
 >= 5) {

3053 cڡ 
g
[5] = {'J','F','I','F','\0'};

3054 
ok
 = 1;

3055 
i
;

3056 
i
=0; i < 5; ++i)

3057 i(
	`bi__g8
(
z
->
s
!
g
[
i
])

3058 
ok
 = 0;

3059 
L
 -= 5;

3060 i(
ok
)

3061 
z
->
jfif
 = 1;

3062 } i(
m
 =0xEE && 
L
 >= 12) {

3063 cڡ 
g
[6] = {'A','d','o','b','e','\0'};

3064 
ok
 = 1;

3065 
i
;

3066 
i
=0; i < 6; ++i)

3067 i(
	`bi__g8
(
z
->
s
!
g
[
i
])

3068 
ok
 = 0;

3069 
L
 -= 6;

3070 i(
ok
) {

3071 
	`bi__g8
(
z
->
s
);

3072 
	`bi__g16be
(
z
->
s
);

3073 
	`bi__g16be
(
z
->
s
);

3074 
z
->
p14_c_sfm
 = 
	`bi__g8
(z->
s
);

3075 
L
 -= 6;

3079 
	`bi__sk
(
z
->
s
, 
L
);

3083  
	`bi__r
("unknown marker","Corrupt JPEG");

3084 
	}
}

3087 
	$bi__oss_sn_hd
(
bi__jg
 *
z
)

3089 
i
;

3090 
Ls
 = 
	`bi__g16be
(
z
->
s
);

3091 
z
->
sn_n
 = 
	`bi__g8
(z->
s
);

3092 i(
z
->
sn_n
 < 1 || z->sn_> 4 || z->sn_> (z->
s
->
img_n
 
	`bi__r
("bad SOS component count","Corrupt JPEG");

3093 i(
Ls
 !6+2*
z
->
sn_n
 
	`bi__r
("bad SOSen","Corrupt JPEG");

3094 
i
=0; i < 
z
->
sn_n
; ++i) {

3095 
id
 = 
	`bi__g8
(
z
->
s
), 
which
;

3096 
q
 = 
	`bi__g8
(
z
->
s
);

3097 
which
 = 0; which < 
z
->
s
->
img_n
; ++which)

3098 i(
z
->
img_comp
[
which
].
id
 == id)

3100 i(
which
 =
z
->
s
->
img_n
)  0;

3101 
z
->
img_comp
[
which
].
hd
 = 
q
 >> 4; i(z->img_comp[which].hd > 3 
	`bi__r
("bad DC huff","Corrupt JPEG");

3102 
z
->
img_comp
[
which
].
ha
 = 
q
 & 15; i(z->img_comp[which].h> 3 
	`bi__r
("bad AC huff","Corrupt JPEG");

3103 
z
->
d
[
i
] = 
which
;

3107 

;

3108 
z
->
ec_t
 = 
	`bi__g8
(z->
s
);

3109 
z
->
ec_d
 = 
	`bi__g8
(z->
s
);

3110 

 = 
	`bi__g8
(
z
->
s
);

3111 
z
->
succ_high
 = (

 >> 4);

3112 
z
->
succ_low
 = (

 & 15);

3113 i(
z
->
ogssive
) {

3114 i(
z
->
ec_t
 > 63 || z->
ec_d
 > 63 || z->ec_> z->ec_d || z->
succ_high
 > 13 || z->
succ_low
 > 13)

3115  
	`bi__r
("bad SOS", "Corrupt JPEG");

3117 i(
z
->
ec_t
 !0 
	`bi__r
("bad SOS","Corrupt JPEG");

3118 i(
z
->
succ_high
 !0 || z->
succ_low
 !0 
	`bi__r
("bad SOS","Corrupt JPEG");

3119 
z
->
ec_d
 = 63;

3124 
	}
}

3126 
	$bi___jg_compڒts
(
bi__jg
 *
z
, 
ncomp
, 
why
)

3128 
i
;

3129 
i
=0; i < 
ncomp
; ++i) {

3130 i(
z
->
img_comp
[
i
].
w_da
) {

3131 
	`STBI_FREE
(
z
->
img_comp
[
i
].
w_da
);

3132 
z
->
img_comp
[
i
].
w_da
 = 
NULL
;

3133 
z
->
img_comp
[
i
].
da
 = 
NULL
;

3135 i(
z
->
img_comp
[
i
].
w_cff
) {

3136 
	`STBI_FREE
(
z
->
img_comp
[
i
].
w_cff
);

3137 
z
->
img_comp
[
i
].
w_cff
 = 0;

3138 
z
->
img_comp
[
i
].
cff
 = 0;

3140 i(
z
->
img_comp
[
i
].
lebuf
) {

3141 
	`STBI_FREE
(
z
->
img_comp
[
i
].
lebuf
);

3142 
z
->
img_comp
[
i
].
lebuf
 = 
NULL
;

3145  
why
;

3146 
	}
}

3148 
	$bi__oss_ame_hd
(
bi__jg
 *
z
, 
sn
)

3150 
bi__cڋxt
 *
s
 = 
z
->s;

3151 
Lf
,
p
,
i
,
q
, 
h_max
=1,
v_max
=1,
c
;

3152 
Lf
 = 
	`bi__g16be
(
s
); i(L< 11 
	`bi__r
("bad SOFen","Corrupt JPEG");

3153 
p
 = 
	`bi__g8
(
s
); i !8 
	`bi__r
("only 8-bit","JPEG formatot supported: 8-bit only");

3154 
s
->
img_y
 = 
	`bi__g16be
(s); i(s->img_y =0 
	`bi__r
("no header height", "JPEG formatot supported: delayed height");

3155 
s
->
img_x
 = 
	`bi__g16be
(s); i(s->img_x =0 
	`bi__r
("0 width","Corrupt JPEG");

3156 
c
 = 
	`bi__g8
(
s
);

3157 i(
c
 !3 && c !1 && c !4 
	`bi__r
("bad component count","Corrupt JPEG");

3158 
s
->
img_n
 = 
c
;

3159 
i
=0; i < 
c
; ++i) {

3160 
z
->
img_comp
[
i
].
da
 = 
NULL
;

3161 
z
->
img_comp
[
i
].
lebuf
 = 
NULL
;

3164 i(
Lf
 !8+3*
s
->
img_n
 
	`bi__r
("bad SOFen","Corrupt JPEG");

3166 
z
->
rgb
 = 0;

3167 
i
=0; i < 
s
->
img_n
; ++i) {

3168 cڡ 
rgb
[3] = { 'R', 'G', 'B' };

3169 
z
->
img_comp
[
i
].
id
 = 
	`bi__g8
(
s
);

3170 i(
s
->
img_n
 =3 && 
z
->
img_comp
[
i
].
id
 =
rgb
[i])

3171 ++
z
->
rgb
;

3172 
q
 = 
	`bi__g8
(
s
);

3173 
z
->
img_comp
[
i
].
h
 = (
q
 >> 4); i(!z->img_comp[i].h || z->img_comp[i].h > 4 
	`bi__r
("bad H","Corrupt JPEG");

3174 
z
->
img_comp
[
i
].
v
 = 
q
 & 15; i(!z->img_comp[i].v || z->img_comp[i].v > 4 
	`bi__r
("bad V","Corrupt JPEG");

3175 
z
->
img_comp
[
i
].
tq
 = 
	`bi__g8
(
s
); i(z->img_comp[i].tq > 3 
	`bi__r
("bad TQ","Corrupt JPEG");

3178 i(
sn
 !
STBI__SCAN_ld
)  1;

3180 i(!
	`bi__mad3sizes_vid
(
s
->
img_x
, s->
img_y
, s->
img_n
, 0) 
	`bi__r
("tooarge", "Imageooargeo decode");

3182 
i
=0; i < 
s
->
img_n
; ++i) {

3183 i(
z
->
img_comp
[
i
].
h
 > 
h_max
) h_max = z->img_comp[i].h;

3184 i(
z
->
img_comp
[
i
].
v
 > 
v_max
) v_max = z->img_comp[i].v;

3188 
z
->
img_h_max
 = 
h_max
;

3189 
z
->
img_v_max
 = 
v_max
;

3190 
z
->
img_mcu_w
 = 
h_max
 * 8;

3191 
z
->
img_mcu_h
 = 
v_max
 * 8;

3193 
z
->
img_mcu_x
 = (
s
->
img_x
 + z->
img_mcu_w
-1) / z->img_mcu_w;

3194 
z
->
img_mcu_y
 = (
s
->
img_y
 + z->
img_mcu_h
-1) / z->img_mcu_h;

3196 
i
=0; i < 
s
->
img_n
; ++i) {

3198 
z
->
img_comp
[
i
].
x
 = (
s
->
img_x
 * z->img_comp[i].
h
 + 
h_max
-1) / h_max;

3199 
z
->
img_comp
[
i
].
y
 = (
s
->
img_y
 * z->img_comp[i].
v
 + 
v_max
-1) / v_max;

3207 
z
->
img_comp
[
i
].
w2
 = z->
img_mcu_x
 * z->img_comp[i].
h
 * 8;

3208 
z
->
img_comp
[
i
].
h2
 = z->
img_mcu_y
 * z->img_comp[i].
v
 * 8;

3209 
z
->
img_comp
[
i
].
cff
 = 0;

3210 
z
->
img_comp
[
i
].
w_cff
 = 0;

3211 
z
->
img_comp
[
i
].
lebuf
 = 
NULL
;

3212 
z
->
img_comp
[
i
].
w_da
 = 
	`bi__mloc_mad2
(z->img_comp[i].
w2
, z->img_comp[i].
h2
, 15);

3213 i(
z
->
img_comp
[
i
].
w_da
 =
NULL
)

3214  
	`bi___jg_compڒts
(
z
, 
i
+1, 
	`bi__r
("outofmem", "Out of memory"));

3216 
z
->
img_comp
[
i
].
da
 = (
bi_uc
*(((
size_t
z->img_comp[i].
w_da
 + 15) & ~15);

3217 i(
z
->
ogssive
) {

3219 
z
->
img_comp
[
i
].
cff_w
 = z->img_comp[i].
w2
 / 8;

3220 
z
->
img_comp
[
i
].
cff_h
 = z->img_comp[i].
h2
 / 8;

3221 
z
->
img_comp
[
i
].
w_cff
 = 
	`bi__mloc_mad3
(z->img_comp[i].
w2
, z->img_comp[i].
h2
, (), 15);

3222 i(
z
->
img_comp
[
i
].
w_cff
 =
NULL
)

3223  
	`bi___jg_compڒts
(
z
, 
i
+1, 
	`bi__r
("outofmem", "Out of memory"));

3224 
z
->
img_comp
[
i
].
cff
 = (*(((
size_t
z->img_comp[i].
w_cff
 + 15) & ~15);

3229 
	}
}

3232 
	#bi__DNL
(
x
((x=0xdc)

	)

3233 
	#bi__SOI
(
x
((x=0xd8)

	)

3234 
	#bi__EOI
(
x
((x=0xd9)

	)

3235 
	#bi__SOF
(
x
((x=0xc0 || (x=0xc1 || (x=0xc2)

	)

3236 
	#bi__SOS
(
x
((x=0xda)

	)

3238 
	#bi__SOF_ogssive
(
x
((x=0xc2)

	)

3240 
	$bi__decode_jg_hd
(
bi__jg
 *
z
, 
sn
)

3242 
m
;

3243 
z
->
jfif
 = 0;

3244 
z
->
p14_c_sfm
 = -1;

3245 
z
->
mk
 = 
STBI__MARKER_ne
;

3246 
m
 = 
	`bi__g_mk
(
z
);

3247 i(!
	`bi__SOI
(
m
) 
	`bi__r
("no SOI","Corrupt JPEG");

3248 i(
sn
 =
STBI__SCAN_ty
)  1;

3249 
m
 = 
	`bi__g_mk
(
z
);

3250 !
	`bi__SOF
(
m
)) {

3251 i(!
	`bi__oss_mk
(
z
,
m
))  0;

3252 
m
 = 
	`bi__g_mk
(
z
);

3253 
m
 =
STBI__MARKER_ne
) {

3255 i(
	`bi___eof
(
z
->
s
) 
	`bi__r
("no SOF", "Corrupt JPEG");

3256 
m
 = 
	`bi__g_mk
(
z
);

3259 
z
->
ogssive
 = 
	`bi__SOF_ogssive
(
m
);

3260 i(!
	`bi__oss_ame_hd
(
z
, 
sn
))  0;

3262 
	}
}

3265 
	$bi__decode_jg_image
(
bi__jg
 *
j
)

3267 
m
;

3268 
m
 = 0; m < 4; m++) {

3269 
j
->
img_comp
[
m
].
w_da
 = 
NULL
;

3270 
j
->
img_comp
[
m
].
w_cff
 = 
NULL
;

3272 
j
->
t_rv
 = 0;

3273 i(!
	`bi__decode_jg_hd
(
j
, 
STBI__SCAN_ld
))  0;

3274 
m
 = 
	`bi__g_mk
(
j
);

3275 !
	`bi__EOI
(
m
)) {

3276 i(
	`bi__SOS
(
m
)) {

3277 i(!
	`bi__oss_sn_hd
(
j
))  0;

3278 i(!
	`bi__r_y_coded_da
(
j
))  0;

3279 i(
j
->
mk
 =
STBI__MARKER_ne
 ) {

3281 !
	`bi___eof
(
j
->
s
)) {

3282 
x
 = 
	`bi__g8
(
j
->
s
);

3283 i(
x
 == 255) {

3284 
j
->
mk
 = 
	`bi__g8
(j->
s
);

3290 } i(
	`bi__DNL
(
m
)) {

3291 
Ld
 = 
	`bi__g16be
(
j
->
s
);

3292 
bi__ut32
 
NL
 = 
	`bi__g16be
(
j
->
s
);

3293 i(
Ld
 !4 
	`bi__r
("bad DNLen", "Corrupt JPEG");

3294 i(
NL
 !
j
->
s
->
img_y
 
	`bi__r
("bad DNL height", "Corrupt JPEG");

3296 i(!
	`bi__oss_mk
(
j
, 
m
))  0;

3298 
m
 = 
	`bi__g_mk
(
j
);

3300 i(
j
->
ogssive
)

3301 
	`bi__jg_fish
(
j
);

3303 
	}
}

3307 
	gbi_uc
 *(*
	tme_row_func
)(
	tbi_uc
 *
	tout
, stbi_u*
	t0
, stbi_u*
	t1
,

3308 
	tw
, 
	ths
);

3310 
	#bi__div4
(
x
((
bi_uc
((x>> 2))

	)

3312 
bi_uc
 *
	$me_row_1
(
bi_uc
 *
out
, stbi_u*
_ì
, stbi_u*
_r
, 
w
, 
hs
)

3314 
	`STBI_NOTUSED
(
out
);

3315 
	`STBI_NOTUSED
(
_r
);

3316 
	`STBI_NOTUSED
(
w
);

3317 
	`STBI_NOTUSED
(
hs
);

3318  
_ì
;

3319 
	}
}

3321 
bi_uc
* 
	$bi__me_row_v_2
(
bi_uc
 *
out
, stbi_u*
_ì
, stbi_u*
_r
, 
w
, 
hs
)

3324 
i
;

3325 
	`STBI_NOTUSED
(
hs
);

3326 
i
=0; i < 
w
; ++i)

3327 
out
[
i
] = 
	`bi__div4
(3*
_ì
[i] + 
_r
[i] + 2);

3328  
out
;

3329 
	}
}

3331 
bi_uc
* 
	$bi__me_row_h_2
(
bi_uc
 *
out
, stbi_u*
_ì
, stbi_u*
_r
, 
w
, 
hs
)

3334 
i
;

3335 
bi_uc
 *
put
 = 
_ì
;

3337 i(
w
 == 1) {

3339 
out
[0] = out[1] = 
put
[0];

3340  
out
;

3343 
out
[0] = 
put
[0];

3344 
out
[1] = 
	`bi__div4
(
put
[0]*3 + input[1] + 2);

3345 
i
=1; i < 
w
-1; ++i) {

3346 
n
 = 3*
put
[
i
]+2;

3347 
out
[
i
*2+0] = 
	`bi__div4
(
n
+
put
[i-1]);

3348 
out
[
i
*2+1] = 
	`bi__div4
(
n
+
put
[i+1]);

3350 
out
[
i
*2+0] = 
	`bi__div4
(
put
[
w
-2]*3 + input[w-1] + 2);

3351 
out
[
i
*2+1] = 
put
[
w
-1];

3353 
	`STBI_NOTUSED
(
_r
);

3354 
	`STBI_NOTUSED
(
hs
);

3356  
out
;

3357 
	}
}

3359 
	#bi__div16
(
x
((
bi_uc
((x>> 4))

	)

3361 
bi_uc
 *
	$bi__me_row_hv_2
(
bi_uc
 *
out
, stbi_u*
_ì
, stbi_u*
_r
, 
w
, 
hs
)

3364 
i
,
t0
,
t1
;

3365 i(
w
 == 1) {

3366 
out
[0] = out[1] = 
	`bi__div4
(3*
_ì
[0] + 
_r
[0] + 2);

3367  
out
;

3370 
t1
 = 3*
_ì
[0] + 
_r
[0];

3371 
out
[0] = 
	`bi__div4
(
t1
+2);

3372 
i
=1; i < 
w
; ++i) {

3373 
t0
 = 
t1
;

3374 
t1
 = 3*
_ì
[
i
]+
_r
[i];

3375 
out
[
i
*2-1] = 
	`bi__div16
(3*
t0
 + 
t1
 + 8);

3376 
out
[
i
*2 ] = 
	`bi__div16
(3*
t1
 + 
t0
 + 8);

3378 
out
[
w
*2-1] = 
	`bi__div4
(
t1
+2);

3380 
	`STBI_NOTUSED
(
hs
);

3382  
out
;

3383 
	}
}

3385 #i
defed
(
STBI_SSE2
|| defed(
STBI_NEON
)

3386 
bi_uc
 *
	$bi__me_row_hv_2_simd
(
bi_uc
 *
out
, stbi_u*
_ì
, stbi_u*
_r
, 
w
, 
hs
)

3389 
i
=0,
t0
,
t1
;

3391 i(
w
 == 1) {

3392 
out
[0] = out[1] = 
	`bi__div4
(3*
_ì
[0] + 
_r
[0] + 2);

3393  
out
;

3396 
t1
 = 3*
_ì
[0] + 
_r
[0];

3400 ; 
i
 < ((
w
-1) & ~7); i += 8) {

3401 #i
	`defed
(
STBI_SSE2
)

3404 
__m128i
 
zo
 = 
	`_mm_tzo_si128
();

3405 
__m128i
 
rb
 = 
	`_mm_ldl_i64
((__m128*(
_r
 + 
i
));

3406 
__m128i
 
ìb
 = 
	`_mm_ldl_i64
((__m128*(
_ì
 + 
i
));

3407 
__m128i
 
rw
 = 
	`_mm_uacklo_i8
(
rb
, 
zo
);

3408 
__m128i
 
ìw
 = 
	`_mm_uacklo_i8
(
ìb
, 
zo
);

3409 
__m128i
 
diff
 = 
	`_mm_sub_i16
(
rw
, 
ìw
);

3410 
__m128i
 
ìs
 = 
	`_mm_li_i16
(
ìw
, 2);

3411 
__m128i
 
cu
 = 
	`_mm_add_i16
(
ìs
, 
diff
);

3418 
__m128i
 
v0
 = 
	`_mm_li_si128
(
cu
, 2);

3419 
__m128i
 
nxt0
 = 
	`_mm_li_si128
(
cu
, 2);

3420 
__m128i
 
ev
 = 
	`_mm__i16
(
v0
, 
t1
, 0);

3421 
__m128i
 
xt
 = 
	`_mm__i16
(
nxt0
, 3*
_ì
[
i
+8] + 
_r
[i+8], 7);

3427 
__m128i
 
bs
 = 
	`_mm_t1_i16
(8);

3428 
__m128i
 
curs
 = 
	`_mm_li_i16
(
cu
, 2);

3429 
__m128i
 
vd
 = 
	`_mm_sub_i16
(
ev
, 
cu
);

3430 
__m128i
 
nxtd
 = 
	`_mm_sub_i16
(
xt
, 
cu
);

3431 
__m128i
 
curb
 = 
	`_mm_add_i16
(
curs
, 
bs
);

3432 
__m128i
 
ev
 = 
	`_mm_add_i16
(
vd
, 
curb
);

3433 
__m128i
 
odd
 = 
	`_mm_add_i16
(
nxtd
, 
curb
);

3436 
__m128i
 
t0
 = 
	`_mm_uacklo_i16
(
ev
, 
odd
);

3437 
__m128i
 
t1
 = 
	`_mm_uackhi_i16
(
ev
, 
odd
);

3438 
__m128i
 
de0
 = 
	`_mm_li_i16
(
t0
, 4);

3439 
__m128i
 
de1
 = 
	`_mm_li_i16
(
t1
, 4);

3442 
__m128i
 
outv
 = 
	`_mm_ckus_i16
(
de0
, 
de1
);

3443 
	`_mm_eu_si128
((
__m128i
 *(
out
 + 
i
*2), 
outv
);

3444 #i
	`defed
(
STBI_NEON
)

3447 
ut8x8_t
 
rb
 = 
	`vld1_u8
(
_r
 + 
i
);

3448 
ut8x8_t
 
ìb
 = 
	`vld1_u8
(
_ì
 + 
i
);

3449 
t16x8_t
 
diff
 = 
	`vtq_s16_u16
(
	`vsubl_u8
(
rb
, 
ìb
));

3450 
t16x8_t
 
ìs
 = 
	`vtq_s16_u16
(
	`vsh_n_u8
(
ìb
, 2));

3451 
t16x8_t
 
cu
 = 
	`vaddq_s16
(
ìs
, 
diff
);

3458 
t16x8_t
 
v0
 = 
	`vextq_s16
(
cu
, curr, 7);

3459 
t16x8_t
 
nxt0
 = 
	`vextq_s16
(
cu
, curr, 1);

3460 
t16x8_t
 
ev
 = 
	`vtq__s16
(
t1
, 
v0
, 0);

3461 
t16x8_t
 
xt
 = 
	`vtq__s16
(3*
_ì
[
i
+8] + 
_r
[i+8], 
nxt0
, 7);

3467 
t16x8_t
 
curs
 = 
	`vshlq_n_s16
(
cu
, 2);

3468 
t16x8_t
 
vd
 = 
	`vsubq_s16
(
ev
, 
cu
);

3469 
t16x8_t
 
nxtd
 = 
	`vsubq_s16
(
xt
, 
cu
);

3470 
t16x8_t
 
ev
 = 
	`vaddq_s16
(
curs
, 
vd
);

3471 
t16x8_t
 
odd
 = 
	`vaddq_s16
(
curs
, 
nxtd
);

3474 
ut8x8x2_t
 
o
;

3475 
o
.
v
[0] = 
	`vqrshrun_n_s16
(
ev
, 4);

3476 
o
.
v
[1] = 
	`vqrshrun_n_s16
(
odd
, 4);

3477 
	`v2_u8
(
out
 + 
i
*2, 
o
);

3481 
t1
 = 3*
_ì
[
i
+7] + 
_r
[i+7];

3484 
t0
 = 
t1
;

3485 
t1
 = 3*
_ì
[
i
] + 
_r
[i];

3486 
out
[
i
*2] = 
	`bi__div16
(3*
t1
 + 
t0
 + 8);

3488 ++
i
; i < 
w
; ++i) {

3489 
t0
 = 
t1
;

3490 
t1
 = 3*
_ì
[
i
]+
_r
[i];

3491 
out
[
i
*2-1] = 
	`bi__div16
(3*
t0
 + 
t1
 + 8);

3492 
out
[
i
*2 ] = 
	`bi__div16
(3*
t1
 + 
t0
 + 8);

3494 
out
[
w
*2-1] = 
	`bi__div4
(
t1
+2);

3496 
	`STBI_NOTUSED
(
hs
);

3498  
out
;

3499 
	}
}

3502 
bi_uc
 *
	$bi__me_row_gic
(
bi_uc
 *
out
, stbi_u*
_ì
, stbi_u*
_r
, 
w
, 
hs
)

3505 
i
,
j
;

3506 
	`STBI_NOTUSED
(
_r
);

3507 
i
=0; i < 
w
; ++i)

3508 
j
=0; j < 
hs
; ++j)

3509 
out
[
i
*
hs
+
j
] = 
_ì
[i];

3510  
out
;

3511 
	}
}

3515 
	#bi__t2fixed
(
x
(((((x* 4096.0+ 0.5f)<< 8)

	)

3516 
	$bi__YCbCr_to_RGB_row
(
bi_uc
 *
out
, cڡ stbi_u*
y
, cڡ stbi_u*
pcb
, cڡ stbi_u*
p
, 
cou
, 

)

3518 
i
;

3519 
i
=0; i < 
cou
; ++i) {

3520 
y_fixed
 = (
y
[
i
] << 20) + (1<<19);

3521 
r
,
g
,
b
;

3522 

 = 
p
[
i
] - 128;

3523 
cb
 = 
pcb
[
i
] - 128;

3524 
r
 = 
y_fixed
 + 

* 
	`bi__t2fixed
(1.40200f);

3525 
g
 = 
y_fixed
 + (

*-
	`bi__t2fixed
(0.71414f)+ ((
cb
*-stbi__float2fixed(0.34414f)) & 0xffff0000);

3526 
b
 = 
y_fixed
 + 
cb
* 
	`bi__t2fixed
(1.77200f);

3527 
r
 >>= 20;

3528 
g
 >>= 20;

3529 
b
 >>= 20;

3530 i((
r
 > 255) { if (r < 0) = 0; r = 255; }

3531 i((
g
 > 255) { if (g < 0) g = 0; g = 255; }

3532 i((
b
 > 255) { if (b < 0) b = 0; b = 255; }

3533 
out
[0] = (
bi_uc
)
r
;

3534 
out
[1] = (
bi_uc
)
g
;

3535 
out
[2] = (
bi_uc
)
b
;

3536 
out
[3] = 255;

3537 
out
 +

;

3539 
	}
}

3541 #i
defed
(
STBI_SSE2
|| defed(
STBI_NEON
)

3542 
	$bi__YCbCr_to_RGB_simd
(
bi_uc
 *
out
, stbi_ucڡ *
y
, stbi_ucڡ *
pcb
, stbi_ucڡ *
p
, 
cou
, 

)

3544 
i
 = 0;

3546 #ifde
STBI_SSE2


3550 i(

 == 4) {

3552 
__m128i
 
sign
 = 
	`_mm_t1_i8
(-0x80);

3553 
__m128i
 
_cڡ0
 = 
	`_mm_t1_i16
( () ( 1.40200f*4096.0f+0.5f));

3554 
__m128i
 
_cڡ1
 = 
	`_mm_t1_i16
( - () ( 0.71414f*4096.0f+0.5f));

3555 
__m128i
 
cb_cڡ0
 = 
	`_mm_t1_i16
( - () ( 0.34414f*4096.0f+0.5f));

3556 
__m128i
 
cb_cڡ1
 = 
	`_mm_t1_i16
( () ( 1.77200f*4096.0f+0.5f));

3557 
__m128i
 
y_bs
 = 
	`_mm_t1_i8
(() () 128);

3558 
__m128i
 
xw
 = 
	`_mm_t1_i16
(255);

3560 ; 
i
+7 < 
cou
; i += 8) {

3562 
__m128i
 
y_bys
 = 
	`_mm_ldl_i64
((__m128*(
y
+
i
));

3563 
__m128i
 
_bys
 = 
	`_mm_ldl_i64
((__m128*(
p
+
i
));

3564 
__m128i
 
cb_bys
 = 
	`_mm_ldl_i64
((__m128*(
pcb
+
i
));

3565 
__m128i
 
_bd
 = 
	`_mm_x_si128
(
_bys
, 
sign
);

3566 
__m128i
 
cb_bd
 = 
	`_mm_x_si128
(
cb_bys
, 
sign
);

3569 
__m128i
 
yw
 = 
	`_mm_uacklo_i8
(
y_bs
, 
y_bys
);

3570 
__m128i
 
w
 = 
	`_mm_uacklo_i8
(
	`_mm_tzo_si128
(), 
_bd
);

3571 
__m128i
 
cbw
 = 
	`_mm_uacklo_i8
(
	`_mm_tzo_si128
(), 
cb_bd
);

3574 
__m128i
 
yws
 = 
	`_mm_li_i16
(
yw
, 4);

3575 
__m128i
 
0
 = 
	`_mm_mulhi_i16
(
_cڡ0
, 
w
);

3576 
__m128i
 
cb0
 = 
	`_mm_mulhi_i16
(
cb_cڡ0
, 
cbw
);

3577 
__m128i
 
cb1
 = 
	`_mm_mulhi_i16
(
cbw
, 
cb_cڡ1
);

3578 
__m128i
 
1
 = 
	`_mm_mulhi_i16
(
w
, 
_cڡ1
);

3579 
__m128i
 
rws
 = 
	`_mm_add_i16
(
0
, 
yws
);

3580 
__m128i
 
gwt
 = 
	`_mm_add_i16
(
cb0
, 
yws
);

3581 
__m128i
 
bws
 = 
	`_mm_add_i16
(
yws
, 
cb1
);

3582 
__m128i
 
gws
 = 
	`_mm_add_i16
(
gwt
, 
1
);

3585 
__m128i
 
rw
 = 
	`_mm_ai_i16
(
rws
, 4);

3586 
__m128i
 
bw
 = 
	`_mm_ai_i16
(
bws
, 4);

3587 
__m128i
 
gw
 = 
	`_mm_ai_i16
(
gws
, 4);

3590 
__m128i
 
brb
 = 
	`_mm_ckus_i16
(
rw
, 
bw
);

3591 
__m128i
 
gxb
 = 
	`_mm_ckus_i16
(
gw
, 
xw
);

3594 
__m128i
 
t0
 = 
	`_mm_uacklo_i8
(
brb
, 
gxb
);

3595 
__m128i
 
t1
 = 
	`_mm_uackhi_i8
(
brb
, 
gxb
);

3596 
__m128i
 
o0
 = 
	`_mm_uacklo_i16
(
t0
, 
t1
);

3597 
__m128i
 
o1
 = 
	`_mm_uackhi_i16
(
t0
, 
t1
);

3600 
	`_mm_eu_si128
((
__m128i
 *(
out
 + 0), 
o0
);

3601 
	`_mm_eu_si128
((
__m128i
 *(
out
 + 16), 
o1
);

3602 
out
 += 32;

3607 #ifde
STBI_NEON


3609 i(

 == 4) {

3611 
ut8x8_t
 
sign
 = 
	`vdup_n_u8
(0x80);

3612 
t16x8_t
 
_cڡ0
 = 
	`vdupq_n_s16
( () ( 1.40200f*4096.0f+0.5f));

3613 
t16x8_t
 
_cڡ1
 = 
	`vdupq_n_s16
( - () ( 0.71414f*4096.0f+0.5f));

3614 
t16x8_t
 
cb_cڡ0
 = 
	`vdupq_n_s16
( - () ( 0.34414f*4096.0f+0.5f));

3615 
t16x8_t
 
cb_cڡ1
 = 
	`vdupq_n_s16
( () ( 1.77200f*4096.0f+0.5f));

3617 ; 
i
+7 < 
cou
; i += 8) {

3619 
ut8x8_t
 
y_bys
 = 
	`vld1_u8
(
y
 + 
i
);

3620 
ut8x8_t
 
_bys
 = 
	`vld1_u8
(
p
 + 
i
);

3621 
ut8x8_t
 
cb_bys
 = 
	`vld1_u8
(
pcb
 + 
i
);

3622 
t8x8_t
 
_bd
 = 
	`vt_s8_u8
(
	`vsub_u8
(
_bys
, 
sign
));

3623 
t8x8_t
 
cb_bd
 = 
	`vt_s8_u8
(
	`vsub_u8
(
cb_bys
, 
sign
));

3626 
t16x8_t
 
yws
 = 
	`vtq_s16_u16
(
	`vsh_n_u8
(
y_bys
, 4));

3627 
t16x8_t
 
w
 = 
	`vsh_n_s8
(
_bd
, 7);

3628 
t16x8_t
 
cbw
 = 
	`vsh_n_s8
(
cb_bd
, 7);

3631 
t16x8_t
 
0
 = 
	`vqdmulhq_s16
(
w
, 
_cڡ0
);

3632 
t16x8_t
 
cb0
 = 
	`vqdmulhq_s16
(
cbw
, 
cb_cڡ0
);

3633 
t16x8_t
 
1
 = 
	`vqdmulhq_s16
(
w
, 
_cڡ1
);

3634 
t16x8_t
 
cb1
 = 
	`vqdmulhq_s16
(
cbw
, 
cb_cڡ1
);

3635 
t16x8_t
 
rws
 = 
	`vaddq_s16
(
yws
, 
0
);

3636 
t16x8_t
 
gws
 = 
	`vaddq_s16
(vaddq_s16(
yws
, 
cb0
), 
1
);

3637 
t16x8_t
 
bws
 = 
	`vaddq_s16
(
yws
, 
cb1
);

3640 
ut8x8x4_t
 
o
;

3641 
o
.
v
[0] = 
	`vqrshrun_n_s16
(
rws
, 4);

3642 
o
.
v
[1] = 
	`vqrshrun_n_s16
(
gws
, 4);

3643 
o
.
v
[2] = 
	`vqrshrun_n_s16
(
bws
, 4);

3644 
o
.
v
[3] = 
	`vdup_n_u8
(255);

3647 
	`v4_u8
(
out
, 
o
);

3648 
out
 += 8*4;

3653 ; 
i
 < 
cou
; ++i) {

3654 
y_fixed
 = (
y
[
i
] << 20) + (1<<19);

3655 
r
,
g
,
b
;

3656 

 = 
p
[
i
] - 128;

3657 
cb
 = 
pcb
[
i
] - 128;

3658 
r
 = 
y_fixed
 + 

* 
	`bi__t2fixed
(1.40200f);

3659 
g
 = 
y_fixed
 + 

*-
	`bi__t2fixed
(0.71414f+ ((
cb
*-stbi__float2fixed(0.34414f)) & 0xffff0000);

3660 
b
 = 
y_fixed
 + 
cb
* 
	`bi__t2fixed
(1.77200f);

3661 
r
 >>= 20;

3662 
g
 >>= 20;

3663 
b
 >>= 20;

3664 i((
r
 > 255) { if (r < 0) = 0; r = 255; }

3665 i((
g
 > 255) { if (g < 0) g = 0; g = 255; }

3666 i((
b
 > 255) { if (b < 0) b = 0; b = 255; }

3667 
out
[0] = (
bi_uc
)
r
;

3668 
out
[1] = (
bi_uc
)
g
;

3669 
out
[2] = (
bi_uc
)
b
;

3670 
out
[3] = 255;

3671 
out
 +

;

3673 
	}
}

3677 
	$bi__tup_jg
(
bi__jg
 *
j
)

3679 
j
->
id_block_kl
 = 
bi__id_block
;

3680 
j
->
YCbCr_to_RGB_kl
 = 
bi__YCbCr_to_RGB_row
;

3681 
j
->
me_row_hv_2_kl
 = 
bi__me_row_hv_2
;

3683 #ifde
STBI_SSE2


3684 i(
	`bi__s2_avaab
()) {

3685 
j
->
id_block_kl
 = 
bi__id_simd
;

3686 
j
->
YCbCr_to_RGB_kl
 = 
bi__YCbCr_to_RGB_simd
;

3687 
j
->
me_row_hv_2_kl
 = 
bi__me_row_hv_2_simd
;

3691 #ifde
STBI_NEON


3692 
j
->
id_block_kl
 = 
bi__id_simd
;

3693 
j
->
YCbCr_to_RGB_kl
 = 
bi__YCbCr_to_RGB_simd
;

3694 
j
->
me_row_hv_2_kl
 = 
bi__me_row_hv_2_simd
;

3696 
	}
}

3699 
	$bi__nup_jg
(
bi__jg
 *
j
)

3701 
	`bi___jg_compڒts
(
j
, j->
s
->
img_n
, 0);

3702 
	}
}

3706 
me_row_func
 
	mme
;

3707 
bi_uc
 *
	mle0
,*
	mle1
;

3708 
	mhs
,
	mvs
;

3709 
	mw_les
;

3710 
	my
;

3711 
	mypos
;

3712 } 
	tbi__me
;

3715 
bi_uc
 
	$bi__bln_8x8
(
bi_uc
 
x
, stbi_u
y
)

3717 
t
 = 
x
*
y
 + 128;

3718  (
bi_uc
((
t
 + (t >>8)) >> 8);

3719 
	}
}

3721 
bi_uc
 *
	$ld_jg_image
(
bi__jg
 *
z
, *
out_x
, *
out_y
, *
comp
, 
q_comp
)

3723 
n
, 
decode_n
, 
is_rgb
;

3724 
z
->
s
->
img_n
 = 0;

3727 i(
q_comp
 < 0 ||eq_com> 4 
	`bi__uc
("badeq_comp", "Internalrror");

3730 i(!
	`bi__decode_jg_image
(
z
){ 
	`bi__nup_jg
(z);  
NULL
; }

3733 
n
 = 
q_comp
 ?eq_com: 
z
->
s
->
img_n
 >= 3 ? 3 : 1;

3735 
is_rgb
 = 
z
->
s
->
img_n
 =3 && (z->
rgb
 =3 || (z->
p14_c_sfm
 =0 && !z->
jfif
));

3737 i(
z
->
s
->
img_n
 =3 && 
n
 < 3 && !
is_rgb
)

3738 
decode_n
 = 1;

3740 
decode_n
 = 
z
->
s
->
img_n
;

3744 
k
;

3745 
i
,
j
;

3746 
bi_uc
 *
ouut
;

3747 
bi_uc
 *
couut
[4] = { 
NULL
, NULL, NULL, NULL };

3749 
bi__me
 
s_comp
[4];

3751 
k
=0; k < 
decode_n
; ++k) {

3752 
bi__me
 *
r
 = &
s_comp
[
k
];

3756 
z
->
img_comp
[
k
].
lebuf
 = (
bi_uc
 *
	`bi__mloc
(z->
s
->
img_x
 + 3);

3757 i(!
z
->
img_comp
[
k
].
lebuf
{ 
	`bi__nup_jg
(z);  
	`bi__uc
("outofmem", "Out of memory"); }

3759 
r
->
hs
 = 
z
->
img_h_max
 / z->
img_comp
[
k
].
h
;

3760 
r
->
vs
 = 
z
->
img_v_max
 / z->
img_comp
[
k
].
v
;

3761 
r
->
y
 =->
vs
 >> 1;

3762 
r
->
w_les
 = (
z
->
s
->
img_x
 +->
hs
-1) /->hs;

3763 
r
->
ypos
 = 0;

3764 
r
->
le0
 =->
le1
 = 
z
->
img_comp
[
k
].
da
;

3766 i(
r
->
hs
 =1 &&->
vs
 =1r->
me
 = 
me_row_1
;

3767 i(
r
->
hs
 =1 &&->
vs
 =2r->
me
 = 
bi__me_row_v_2
;

3768 i(
r
->
hs
 =2 &&->
vs
 =1r->
me
 = 
bi__me_row_h_2
;

3769 i(
r
->
hs
 =2 &&->
vs
 =2r->
me
 = 
z
->
me_row_hv_2_kl
;

3770 
r
->
me
 = 
bi__me_row_gic
;

3774 
ouut
 = (
bi_uc
 *
	`bi__mloc_mad3
(
n
, 
z
->
s
->
img_x
, z->s->
img_y
, 1);

3775 i(!
ouut
{ 
	`bi__nup_jg
(
z
);  
	`bi__uc
("outofmem", "Out of memory"); }

3778 
j
=0; j < 
z
->
s
->
img_y
; ++j) {

3779 
bi_uc
 *
out
 = 
ouut
 + 
n
 * 
z
->
s
->
img_x
 * 
j
;

3780 
k
=0; k < 
decode_n
; ++k) {

3781 
bi__me
 *
r
 = &
s_comp
[
k
];

3782 
y_b
 = 
r
->
y
 >->
vs
 >> 1);

3783 
couut
[
k
] = 
r
->
	`me
(
z
->
img_comp
[k].
lebuf
,

3784 
y_b
 ? 
r
->
le1
 :->
le0
,

3785 
y_b
 ? 
r
->
le0
 :->
le1
,

3786 
r
->
w_les
,->
hs
);

3787 i(++
r
->
y
 >r->
vs
) {

3788 
r
->
y
 = 0;

3789 
r
->
le0
 =->
le1
;

3790 i(++
r
->
ypos
 < 
z
->
img_comp
[
k
].
y
)

3791 
r
->
le1
 +
z
->
img_comp
[
k
].
w2
;

3794 i(
n
 >= 3) {

3795 
bi_uc
 *
y
 = 
couut
[0];

3796 i(
z
->
s
->
img_n
 == 3) {

3797 i(
is_rgb
) {

3798 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3799 
out
[0] = 
y
[
i
];

3800 
out
[1] = 
couut
[1][
i
];

3801 
out
[2] = 
couut
[2][
i
];

3802 
out
[3] = 255;

3803 
out
 +
n
;

3806 
z
->
	`YCbCr_to_RGB_kl
(
out
, 
y
, 
couut
[1], couut[2], z->
s
->
img_x
, 
n
);

3808 } i(
z
->
s
->
img_n
 == 4) {

3809 i(
z
->
p14_c_sfm
 == 0) {

3810 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3811 
bi_uc
 
m
 = 
couut
[3][
i
];

3812 
out
[0] = 
	`bi__bln_8x8
(
couut
[0][
i
], 
m
);

3813 
out
[1] = 
	`bi__bln_8x8
(
couut
[1][
i
], 
m
);

3814 
out
[2] = 
	`bi__bln_8x8
(
couut
[2][
i
], 
m
);

3815 
out
[3] = 255;

3816 
out
 +
n
;

3818 } i(
z
->
p14_c_sfm
 == 2) {

3819 
z
->
	`YCbCr_to_RGB_kl
(
out
, 
y
, 
couut
[1], couut[2], z->
s
->
img_x
, 
n
);

3820 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3821 
bi_uc
 
m
 = 
couut
[3][
i
];

3822 
out
[0] = 
	`bi__bln_8x8
(255 - out[0], 
m
);

3823 
out
[1] = 
	`bi__bln_8x8
(255 - out[1], 
m
);

3824 
out
[2] = 
	`bi__bln_8x8
(255 - out[2], 
m
);

3825 
out
 +
n
;

3828 
z
->
	`YCbCr_to_RGB_kl
(
out
, 
y
, 
couut
[1], couut[2], z->
s
->
img_x
, 
n
);

3831 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3832 
out
[0] = out[1] = out[2] = 
y
[
i
];

3833 
out
[3] = 255;

3834 
out
 +
n
;

3837 i(
is_rgb
) {

3838 i(
n
 == 1)

3839 
i
=0; i < 
z
->
s
->
img_x
; ++i)

3840 *
out
++ = 
	`bi__compu_y
(
couut
[0][
i
], coutput[1][i], coutput[2][i]);

3842 
i
=0; i < 
z
->
s
->
img_x
; ++i, 
out
 += 2) {

3843 
out
[0] = 
	`bi__compu_y
(
couut
[0][
i
], coutput[1][i], coutput[2][i]);

3844 
out
[1] = 255;

3847 } i(
z
->
s
->
img_n
 =4 && z->
p14_c_sfm
 == 0) {

3848 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3849 
bi_uc
 
m
 = 
couut
[3][
i
];

3850 
bi_uc
 
r
 = 
	`bi__bln_8x8
(
couut
[0][
i
], 
m
);

3851 
bi_uc
 
g
 = 
	`bi__bln_8x8
(
couut
[1][
i
], 
m
);

3852 
bi_uc
 
b
 = 
	`bi__bln_8x8
(
couut
[2][
i
], 
m
);

3853 
out
[0] = 
	`bi__compu_y
(
r
, 
g
, 
b
);

3854 
out
[1] = 255;

3855 
out
 +
n
;

3857 } i(
z
->
s
->
img_n
 =4 && z->
p14_c_sfm
 == 2) {

3858 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3859 
out
[0] = 
	`bi__bln_8x8
(255 - 
couut
[0][
i
], coutput[3][i]);

3860 
out
[1] = 255;

3861 
out
 +
n
;

3864 
bi_uc
 *
y
 = 
couut
[0];

3865 i(
n
 == 1)

3866 
i
=0; i < 
z
->
s
->
img_x
; ++i
out
[i] = 
y
[i];

3868 
i
=0; i < 
z
->
s
->
img_x
; ++i{ *
out
++ = 
y
[i]; *out++ = 255; }

3872 
	`bi__nup_jg
(
z
);

3873 *
out_x
 = 
z
->
s
->
img_x
;

3874 *
out_y
 = 
z
->
s
->
img_y
;

3875 i(
comp
*com
z
->
s
->
img_n
 >= 3 ? 3 : 1;

3876  
ouut
;

3878 
	}
}

3880 *
	$bi__jg_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
)

3882 * 
su
;

3883 
bi__jg
* 
j
 = (bi__jg*
	`bi__mloc
((stbi__jpeg));

3884 
	`STBI_NOTUSED
(
ri
);

3885 
j
->
s
 = s;

3886 
	`bi__tup_jg
(
j
);

3887 
su
 = 
	`ld_jg_image
(
j
, 
x
,
y
,
comp
,
q_comp
);

3888 
	`STBI_FREE
(
j
);

3889  
su
;

3890 
	}
}

3892 
	$bi__jg_
(
bi__cڋxt
 *
s
)

3894 
r
;

3895 
bi__jg
* 
j
 = (bi__jg*)
	`bi__mloc
((stbi__jpeg));

3896 
j
->
s
 = s;

3897 
	`bi__tup_jg
(
j
);

3898 
r
 = 
	`bi__decode_jg_hd
(
j
, 
STBI__SCAN_ty
);

3899 
	`bi__wd
(
s
);

3900 
	`STBI_FREE
(
j
);

3901  
r
;

3902 
	}
}

3904 
	$bi__jg_fo_w
(
bi__jg
 *
j
, *
x
, *
y
, *
comp
)

3906 i(!
	`bi__decode_jg_hd
(
j
, 
STBI__SCAN_hd
)) {

3907 
	`bi__wd

j
->
s
 );

3910 i(
x
*x = 
j
->
s
->
img_x
;

3911 i(
y
*y = 
j
->
s
->
img_y
;

3912 i(
comp
*com
j
->
s
->
img_n
 >= 3 ? 3 : 1;

3914 
	}
}

3916 
	$bi__jg_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

3918 
su
;

3919 
bi__jg
* 
j
 = (bi__jg*(
	`bi__mloc
((stbi__jpeg)));

3920 
j
->
s
 = s;

3921 
su
 = 
	`bi__jg_fo_w
(
j
, 
x
, 
y
, 
comp
);

3922 
	`STBI_FREE
(
j
);

3923  
su
;

3924 
	}
}

3934 #ide
STBI_NO_ZLIB


3937 
	#STBI__ZFAST_BITS
 9

3938 
	#STBI__ZFAST_MASK
 ((1 << 
STBI__ZFAST_BITS
- 1)

	)

3944 
bi__ut16
 
	m
[1 << 
STBI__ZFAST_BITS
];

3945 
bi__ut16
 
	mfcode
[16];

3946 
	mmaxcode
[17];

3947 
bi__ut16
 
	mfsymb
[16];

3948 
bi_uc
 
	msize
[288];

3949 
bi__ut16
 
	mvue
[288];

3950 } 
	tbi__zhuffm
;

3952 
bi_le
 
	$bi__bv16
(
n
)

3954 
n
 = ((n & 0xAAAA) >> 1) | ((n & 0x5555) << 1);

3955 
n
 = ((n & 0xCCCC) >> 2) | ((n & 0x3333) << 2);

3956 
n
 = ((n & 0xF0F0) >> 4) | ((n & 0x0F0F) << 4);

3957 
n
 = ((n & 0xFF00) >> 8) | ((n & 0x00FF) << 8);

3958  
n
;

3959 
	}
}

3961 
bi_le
 
	$bi__b_v
(
v
, 
bs
)

3963 
	`STBI_ASSERT
(
bs
 <= 16);

3966  
	`bi__bv16
(
v
>> (16-
bs
);

3967 
	}
}

3969 
	$bi__zbud_huffm
(
bi__zhuffm
 *
z
, cڡ 
bi_uc
 *
sizi
, 
num
)

3971 
i
,
k
=0;

3972 
code
, 
xt_code
[16], 
sizes
[17];

3975 
	`memt
(
sizes
, 0, (sizes));

3976 
	`memt
(
z
->

, 0, (z->fast));

3977 
i
=0; i < 
num
; ++i)

3978 ++
sizes
[
sizi
[
i
]];

3979 
sizes
[0] = 0;

3980 
i
=1; i < 16; ++i)

3981 i(
sizes
[
i
] > (1 << i))

3982  
	`bi__r
("bad sizes", "Corrupt PNG");

3983 
code
 = 0;

3984 
i
=1; i < 16; ++i) {

3985 
xt_code
[
i
] = 
code
;

3986 
z
->
fcode
[
i
] = (
bi__ut16

code
;

3987 
z
->
fsymb
[
i
] = (
bi__ut16

k
;

3988 
code
 = (cod+ 
sizes
[
i
]);

3989 i(
sizes
[
i
])

3990 i(
code
-1 >(1 << 
i
) 
	`bi__r
("bad codelengths","Corrupt PNG");

3991 
z
->
maxcode
[
i
] = 
code
 << (16-i);

3992 
code
 <<= 1;

3993 
k
 +
sizes
[
i
];

3995 
z
->
maxcode
[16] = 0x10000;

3996 
i
=0; i < 
num
; ++i) {

3997 
s
 = 
sizi
[
i
];

3998 i(
s
) {

3999 
c
 = 
xt_code
[
s
] - 
z
->
fcode
[s] + z->
fsymb
[s];

4000 
bi__ut16
 
v
 = (bi__ut16((
s
 << 9| 
i
);

4001 
z
->
size
 [
c
] = (
bi_uc
 ) 
s
;

4002 
z
->
vue
[
c
] = (
bi__ut16

i
;

4003 i(
s
 <
STBI__ZFAST_BITS
) {

4004 
j
 = 
	`bi__b_v
(
xt_code
[
s
],s);

4005 
j
 < (1 << 
STBI__ZFAST_BITS
)) {

4006 
z
->

[
j
] = 
v
;

4007 
j
 +(1 << 
s
);

4010 ++
xt_code
[
s
];

4014 
	}
}

4024 
bi_uc
 *
	mzbufr
, *
	mzbufr_d
;

4025 
	mnum_bs
;

4026 
bi__ut32
 
	mcode_bufr
;

4028 *
	mzout
;

4029 *
	mzout_t
;

4030 *
	mzout_d
;

4031 
	mz_exndab
;

4033 
bi__zhuffm
 
	mz_ngth
, 
	mz_di
;

4034 } 
	tbi__zbuf
;

4036 
bi_le
 
bi_uc
 
	$bi__zg8
(
bi__zbuf
 *
z
)

4038 i(
z
->
zbufr
 >z->
zbufr_d
)  0;

4039  *
z
->
zbufr
++;

4040 
	}
}

4042 
	$bi__fl_bs
(
bi__zbuf
 *
z
)

4045 
	`STBI_ASSERT
(
z
->
code_bufr
 < (1U << z->
num_bs
));

4046 
z
->
code_bufr
 |(
	`bi__zg8
(z<< z->
num_bs
;

4047 
z
->
num_bs
 += 8;

4048 } 
z
->
num_bs
 <= 24);

4049 
	}
}

4051 
bi_le
 
	$bi__zive
(
bi__zbuf
 *
z
, 
n
)

4053 
k
;

4054 i(
z
->
num_bs
 < 
n

	`bi__fl_bs
(z);

4055 
k
 = 
z
->
code_bufr
 & ((1 << 
n
) - 1);

4056 
z
->
code_bufr
 >>
n
;

4057 
z
->
num_bs
 -
n
;

4058  
k
;

4059 
	}
}

4061 
	$bi__zhuffm_decode_owth
(
bi__zbuf
 *
a
, 
bi__zhuffm
 *
z
)

4063 
b
,
s
,
k
;

4066 
k
 = 
	`bi__b_v
(
a
->
code_bufr
, 16);

4067 
s
=
STBI__ZFAST_BITS
+1; ; ++s)

4068 i(
k
 < 
z
->
maxcode
[
s
])

4070 i(
s
 == 16)  -1;

4072 
b
 = (
k
 >> (16-
s
)- 
z
->
fcode
[s] + z->
fsymb
[s];

4073 
	`STBI_ASSERT
(
z
->
size
[
b
] =
s
);

4074 
a
->
code_bufr
 >>
s
;

4075 
a
->
num_bs
 -
s
;

4076  
z
->
vue
[
b
];

4077 
	}
}

4079 
bi_le
 
	$bi__zhuffm_decode
(
bi__zbuf
 *
a
, 
bi__zhuffm
 *
z
)

4081 
b
,
s
;

4082 i(
a
->
num_bs
 < 16
	`bi__fl_bs
(a);

4083 
b
 = 
z
->

[
a
->
code_bufr
 & 
STBI__ZFAST_MASK
];

4084 i(
b
) {

4085 
s
 = 
b
 >> 9;

4086 
a
->
code_bufr
 >>
s
;

4087 
a
->
num_bs
 -
s
;

4088  
b
 & 511;

4090  
	`bi__zhuffm_decode_owth
(
a
, 
z
);

4091 
	}
}

4093 
	$bi__zexnd
(
bi__zbuf
 *
z
, *
zout
, 
n
)

4095 *
q
;

4096 
cur
, 
lim
, 
d_lim
;

4097 
z
->
zout
 = zout;

4098 i(!
z
->
z_exndab
 
	`bi__r
("output bufferimit","Corrupt PNG");

4099 
cur
 = ((
z
->
zout
 - z->
zout_t
);

4100 
lim
 = 
d_lim
 = ((
z
->
zout_d
 - z->
zout_t
);

4101 
cur
 + 
n
 > 
lim
)

4102 
lim
 *= 2;

4103 
q
 = (*
	`STBI_REALLOC_SIZED
(
z
->
zout_t
, 
d_lim
, 
lim
);

4104 
	`STBI_NOTUSED
(
d_lim
);

4105 i(
q
 =
NULL
 
	`bi__r
("outofmem", "Out of memory");

4106 
z
->
zout_t
 = 
q
;

4107 
z
->
zout
 = 
q
 + 
cur
;

4108 
z
->
zout_d
 = 
q
 + 
lim
;

4110 
	}
}

4112 cڡ 
	gbi__zngth_ba
[31] = {

4117 cڡ 
	gbi__zngth_exa
[31]=

4120 cڡ 
	gbi__zdi_ba
[32] = { 1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,

4123 cڡ 
	gbi__zdi_exa
[32] =

4126 
	$bi__r_huffm_block
(
bi__zbuf
 *
a
)

4128 *
zout
 = 
a
->zout;

4130 
z
 = 
	`bi__zhuffm_decode
(
a
, &a->
z_ngth
);

4131 i(
z
 < 256) {

4132 i(
z
 < 0 
	`bi__r
("bad huffman code","Corrupt PNG");

4133 i(
zout
 >
a
->
zout_d
) {

4134 i(!
	`bi__zexnd
(
a
, 
zout
, 1))  0;

4135 
zout
 = 
a
->zout;

4137 *
zout
++ = (
z
;

4139 
bi_uc
 *
p
;

4140 
n
,
di
;

4141 i(
z
 == 256) {

4142 
a
->
zout
 = zout;

4145 
z
 -= 257;

4146 
n
 = 
bi__zngth_ba
[
z
];

4147 i(
bi__zngth_exa
[
z
]
n
 +
	`bi__zive
(
a
, stbi__zlength_extra[z]);

4148 
z
 = 
	`bi__zhuffm_decode
(
a
, &a->
z_di
);

4149 i(
z
 < 0 
	`bi__r
("bad huffman code","Corrupt PNG");

4150 
di
 = 
bi__zdi_ba
[
z
];

4151 i(
bi__zdi_exa
[
z
]
di
 +
	`bi__zive
(
a
, stbi__zdist_extra[z]);

4152 i(
zout
 - 
a
->
zout_t
 < 
di
 
	`bi__r
("bad dist","Corrupt PNG");

4153 i(
zout
 + 
n
 > 
a
->
zout_d
) {

4154 i(!
	`bi__zexnd
(
a
, 
zout
, 
n
))  0;

4155 
zout
 = 
a
->zout;

4157 
p
 = (
bi_uc
 *(
zout
 - 
di
);

4158 i(
di
 == 1) {

4159 
bi_uc
 
v
 = *
p
;

4160 i(
n
{ d*
zout
++ = 
v
; --len); }

4162 i(
n
{ d*
zout
++ = *
p
++; --len); }

4166 
	}
}

4168 
	$bi__compu_huffm_codes
(
bi__zbuf
 *
a
)

4170 cڡ 
bi_uc
 
ngth_dezigzag
[19] = { 16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15 };

4171 
bi__zhuffm
 
z_codgth
;

4172 
bi_uc
 
ncodes
[286+32+137];

4173 
bi_uc
 
codgth_sizes
[19];

4174 
i
,
n
;

4176 
hl
 = 
	`bi__zive
(
a
,5) + 257;

4177 
hdi
 = 
	`bi__zive
(
a
,5) + 1;

4178 
h
 = 
	`bi__zive
(
a
,4) + 4;

4179 

 = 
hl
 + 
hdi
;

4181 
	`memt
(
codgth_sizes
, 0, (codelength_sizes));

4182 
i
=0; i < 
h
; ++i) {

4183 
s
 = 
	`bi__zive
(
a
,3);

4184 
codgth_sizes
[
ngth_dezigzag
[
i
]] = (
bi_uc

s
;

4186 i(!
	`bi__zbud_huffm
(&
z_codgth
, 
codgth_sizes
, 19))  0;

4188 
n
 = 0;

4189 
n
 < 

) {

4190 
c
 = 
	`bi__zhuffm_decode
(
a
, &
z_codgth
);

4191 i(
c
 < 0 || c >19 
	`bi__r
("bad codelengths", "Corrupt PNG");

4192 i(
c
 < 16)

4193 
ncodes
[
n
++] = (
bi_uc

c
;

4195 
bi_uc
 
fl
 = 0;

4196 i(
c
 == 16) {

4197 
c
 = 
	`bi__zive
(
a
,2)+3;

4198 i(
n
 =0 
	`bi__r
("bad codelengths", "Corrupt PNG");

4199 
fl
 = 
ncodes
[
n
-1];

4200 } i(
c
 == 17)

4201 
c
 = 
	`bi__zive
(
a
,3)+3;

4203 
	`STBI_ASSERT
(
c
 == 18);

4204 
c
 = 
	`bi__zive
(
a
,7)+11;

4206 i(

 - 
n
 < 
c
 
	`bi__r
("bad codelengths", "Corrupt PNG");

4207 
	`memt
(
ncodes
+
n
, 
fl
, 
c
);

4208 
n
 +
c
;

4211 i(
n
 !

 
	`bi__r
("bad codelengths","Corrupt PNG");

4212 i(!
	`bi__zbud_huffm
(&
a
->
z_ngth
, 
ncodes
, 
hl
))  0;

4213 i(!
	`bi__zbud_huffm
(&
a
->
z_di
, 
ncodes
+
hl
, 
hdi
))  0;

4215 
	}
}

4217 
	$bi__r_uncomesd_block
(
bi__zbuf
 *
a
)

4219 
bi_uc
 
hd
[4];

4220 
n
,
ƒ
,
k
;

4221 i(
a
->
num_bs
 & 7)

4222 
	`bi__zive
(
a
,->
num_bs
 & 7);

4224 
k
 = 0;

4225 
a
->
num_bs
 > 0) {

4226 
hd
[
k
++] = (
bi_uc
(
a
->
code_bufr
 & 255);

4227 
a
->
code_bufr
 >>= 8;

4228 
a
->
num_bs
 -= 8;

4230 
	`STBI_ASSERT
(
a
->
num_bs
 == 0);

4232 
k
 < 4)

4233 
hd
[
k
++] = 
	`bi__zg8
(
a
);

4234 
n
 = 
hd
[1] * 256 + header[0];

4235 
ƒ
 = 
hd
[3] * 256 + header[2];

4236 i(
ƒ
 !(
n
 ^ 0xffff) 
	`bi__r
("zlib corrupt","Corrupt PNG");

4237 i(
a
->
zbufr
 + 
n
 >->
zbufr_d
 
	`bi__r
("readast buffer","Corrupt PNG");

4238 i(
a
->
zout
 + 
n
 >->
zout_d
)

4239 i(!
	`bi__zexnd
(
a
,->
zout
, 
n
))  0;

4240 
	`memy
(
a
->
zout
,->
zbufr
, 
n
);

4241 
a
->
zbufr
 +
n
;

4242 
a
->
zout
 +
n
;

4244 
	}
}

4246 
	$bi__r_zlib_hd
(
bi__zbuf
 *
a
)

4248 
cmf
 = 
	`bi__zg8
(
a
);

4249 
cm
 = 
cmf
 & 15;

4251 
g
 = 
	`bi__zg8
(
a
);

4252 i((
cmf
*256+
g
% 31 !0 
	`bi__r
("bad zlib header","Corrupt PNG");

4253 i(
g
 & 32 
	`bi__r
("noreset dict","Corrupt PNG");

4254 i(
cm
 !8 
	`bi__r
("bad compression","Corrupt PNG");

4257 
	}
}

4259 cڡ 
bi_uc
 
	gbi__zdeu_ngth
[288] =

4271 cڡ 
bi_uc
 
	gbi__zdeu_di
[32] =

4288 
	$bi__r_zlib
(
bi__zbuf
 *
a
, 
r_hd
)

4290 
f
, 
ty
;

4291 i(
r_hd
)

4292 i(!
	`bi__r_zlib_hd
(
a
))  0;

4293 
a
->
num_bs
 = 0;

4294 
a
->
code_bufr
 = 0;

4296 
f
 = 
	`bi__zive
(
a
,1);

4297 
ty
 = 
	`bi__zive
(
a
,2);

4298 i(
ty
 == 0) {

4299 i(!
	`bi__r_uncomesd_block
(
a
))  0;

4300 } i(
ty
 == 3) {

4303 i(
ty
 == 1) {

4305 i(!
	`bi__zbud_huffm
(&
a
->
z_ngth
 , 
bi__zdeu_ngth
 , 288))  0;

4306 i(!
	`bi__zbud_huffm
(&
a
->
z_di
, 
bi__zdeu_di
, 32))  0;

4308 i(!
	`bi__compu_huffm_codes
(
a
))  0;

4310 i(!
	`bi__r_huffm_block
(
a
))  0;

4312 } !
f
);

4314 
	}
}

4316 
	$bi__do_zlib
(
bi__zbuf
 *
a
, *
obuf
, 
ޒ
, 
exp
, 
r_hd
)

4318 
a
->
zout_t
 = 
obuf
;

4319 
a
->
zout
 = 
obuf
;

4320 
a
->
zout_d
 = 
obuf
 + 
ޒ
;

4321 
a
->
z_exndab
 = 
exp
;

4323  
	`bi__r_zlib
(
a
, 
r_hd
);

4324 
	}
}

4326 
STBIDEF
 *
	$bi_zlib_decode_mloc_guesssize
(cڡ *
bufr
, 
n
, 
l_size
, *
ou
)

4328 
bi__zbuf
 
a
;

4329 *
p
 = (*
	`bi__mloc
(
l_size
);

4330 i(
p
 =
NULL
)  NULL;

4331 
a
.
zbufr
 = (
bi_uc
 *
bufr
;

4332 
a
.
zbufr_d
 = (
bi_uc
 *
bufr
 + 
n
;

4333 i(
	`bi__do_zlib
(&
a
, 
p
, 
l_size
, 1, 1)) {

4334 i(
ou
*ou = ((
a
.
zout
 -.
zout_t
);

4335  
a
.
zout_t
;

4337 
	`STBI_FREE
(
a
.
zout_t
);

4338  
NULL
;

4340 
	}
}

4342 
STBIDEF
 *
	$bi_zlib_decode_mloc
(cڡ *
bufr
, 
n
, *
ou
)

4344  
	`bi_zlib_decode_mloc_guesssize
(
bufr
, 
n
, 16384, 
ou
);

4345 
	}
}

4347 
STBIDEF
 *
	$bi_zlib_decode_mloc_guesssize_hdag
(cڡ *
bufr
, 
n
, 
l_size
, *
ou
, 
r_hd
)

4349 
bi__zbuf
 
a
;

4350 *
p
 = (*
	`bi__mloc
(
l_size
);

4351 i(
p
 =
NULL
)  NULL;

4352 
a
.
zbufr
 = (
bi_uc
 *
bufr
;

4353 
a
.
zbufr_d
 = (
bi_uc
 *
bufr
 + 
n
;

4354 i(
	`bi__do_zlib
(&
a
, 
p
, 
l_size
, 1, 
r_hd
)) {

4355 i(
ou
*ou = ((
a
.
zout
 -.
zout_t
);

4356  
a
.
zout_t
;

4358 
	`STBI_FREE
(
a
.
zout_t
);

4359  
NULL
;

4361 
	}
}

4363 
STBIDEF
 
	$bi_zlib_decode_bufr
(*
obufr
, 
ޒ
, cڡ *
ibufr
, 

)

4365 
bi__zbuf
 
a
;

4366 
a
.
zbufr
 = (
bi_uc
 *
ibufr
;

4367 
a
.
zbufr_d
 = (
bi_uc
 *
ibufr
 + 

;

4368 i(
	`bi__do_zlib
(&
a
, 
obufr
, 
ޒ
, 0, 1))

4369  ((
a
.
zout
 -.
zout_t
);

4372 
	}
}

4374 
STBIDEF
 *
	$bi_zlib_decode_nohd_mloc
(cڡ *
bufr
, 
n
, *
ou
)

4376 
bi__zbuf
 
a
;

4377 *
p
 = (*
	`bi__mloc
(16384);

4378 i(
p
 =
NULL
)  NULL;

4379 
a
.
zbufr
 = (
bi_uc
 *
bufr
;

4380 
a
.
zbufr_d
 = (
bi_uc
 *
bufr
+
n
;

4381 i(
	`bi__do_zlib
(&
a
, 
p
, 16384, 1, 0)) {

4382 i(
ou
*ou = ((
a
.
zout
 -.
zout_t
);

4383  
a
.
zout_t
;

4385 
	`STBI_FREE
(
a
.
zout_t
);

4386  
NULL
;

4388 
	}
}

4390 
STBIDEF
 
	$bi_zlib_decode_nohd_bufr
(*
obufr
, 
ޒ
, cڡ *
ibufr
, 

)

4392 
bi__zbuf
 
a
;

4393 
a
.
zbufr
 = (
bi_uc
 *
ibufr
;

4394 
a
.
zbufr_d
 = (
bi_uc
 *
ibufr
 + 

;

4395 i(
	`bi__do_zlib
(&
a
, 
obufr
, 
ޒ
, 0, 0))

4396  ((
a
.
zout
 -.
zout_t
);

4399 
	}
}

4412 #ide
STBI_NO_PNG


4415 
bi__ut32
 
	mngth
;

4416 
bi__ut32
 
	mty
;

4417 } 
	tbi__gchunk
;

4419 
bi__gchunk
 
	$bi__g_chunk_hd
(
bi__cڋxt
 *
s
)

4421 
bi__gchunk
 
c
;

4422 
c
.
ngth
 = 
	`bi__g32be
(
s
);

4423 
c
.
ty
 = 
	`bi__g32be
(
s
);

4424  
c
;

4425 
	}
}

4427 
	$bi__check_g_hd
(
bi__cڋxt
 *
s
)

4429 cڡ 
bi_uc
 
g_sig
[8] = { 137,80,78,71,13,10,26,10 };

4430 
i
;

4431 
i
=0; i < 8; ++i)

4432 i(
	`bi__g8
(
s
!
g_sig
[
i
] 
	`bi__r
("badng sig","Not PNG");

4434 
	}
}

4438 
bi__cڋxt
 *
	ms
;

4439 
bi_uc
 *
	mida
, *
	mexnded
, *
	mout
;

4440 
	mdth
;

4441 } 
	tbi__g
;

4445 
	mSTBI__F_ne
=0,

4446 
	mSTBI__F_sub
=1,

4447 
	mSTBI__F_up
=2,

4448 
	mSTBI__F_avg
=3,

4449 
	mSTBI__F_h
=4,

4451 
	mSTBI__F_avg_f
,

4452 
	mSTBI__F_h_f


4455 
bi_uc
 
	gf_row_fr
[5] =

4457 
STBI__F_ne
,

4458 
STBI__F_sub
,

4459 
STBI__F_ne
,

4460 
STBI__F_avg_f
,

4461 
STBI__F_h_f


4464 
	$bi__h
(
a
, 
b
, 
c
)

4466 
p
 = 
a
 + 
b
 - 
c
;

4467 

 = 
	`abs
(
p
-
a
);

4468 
pb
 = 
	`abs
(
p
-
b
);

4469 
pc
 = 
	`abs
(
p
-
c
);

4470 i(

 <
pb
 &&<
pc
 
a
;

4471 i(
pb
 <
pc
 
b
;

4472  
c
;

4473 
	}
}

4475 cڡ 
bi_uc
 
	gbi__dth_s_b
[9] = { 0, 0xff, 0x55, 0, 0x11, 0,0,0, 0x01 };

4478 
	$bi___g_image_w
(
bi__g
 *
a
, 
bi_uc
 *
w
, 
bi__ut32
 
w_n
, 
out_n
, stbi__ut32 
x
, stbi__ut32 
y
, 
dth
, 
c
)

4480 
bys
 = (
dth
 == 16? 2 : 1);

4481 
bi__cڋxt
 *
s
 = 
a
->s;

4482 
bi__ut32
 
i
,
j
,
ride
 = 
x
*
out_n
*
bys
;

4483 
bi__ut32
 
img_n
, 
img_width_bys
;

4484 
k
;

4485 
img_n
 = 
s
->img_n;

4487 
ouut_bys
 = 
out_n
*
bys
;

4488 
fr_bys
 = 
img_n
*
bys
;

4489 
width
 = 
x
;

4491 
	`STBI_ASSERT
(
out_n
 =
s
->
img_n
 || out_n == s->img_n+1);

4492 
a
->
out
 = (
bi_uc
 *
	`bi__mloc_mad3
(
x
, 
y
, 
ouut_bys
, 0);

4493 i(!
a
->
out
 
	`bi__r
("outofmem", "Out of memory");

4495 i(!
	`bi__mad3sizes_vid
(
img_n
, 
x
, 
dth
, 7) 
	`bi__r
("tooarge", "Corrupt PNG");

4496 
img_width_bys
 = (((
img_n
 * 
x
 * 
dth
) + 7) >> 3);

4497 
img_n
 = (
img_width_bys
 + 1* 
y
;

4502 i(
w_n
 < 
img_n
 
	`bi__r
("notnoughixels","Corrupt PNG");

4504 
j
=0; j < 
y
; ++j) {

4505 
bi_uc
 *
cur
 = 
a
->
out
 + 
ride
*
j
;

4506 
bi_uc
 *
i
;

4507 
fr
 = *
w
++;

4509 i(
fr
 > 4)

4510  
	`bi__r
("invalid filter","Corrupt PNG");

4512 i(
dth
 < 8) {

4513 
	`STBI_ASSERT
(
img_width_bys
 <
x
);

4514 
cur
 +
x
*
out_n
 - 
img_width_bys
;

4515 
fr_bys
 = 1;

4516 
width
 = 
img_width_bys
;

4518 
i
 = 
cur
 - 
ride
;

4521 i(
j
 =0
fr
 = 
f_row_fr
[filter];

4524 
k
=0; k < 
fr_bys
; ++k) {

4525 
fr
) {

4526 
STBI__F_ne
 : 
cur
[
k
] = 
w
[k]; ;

4527 
STBI__F_sub
 : 
cur
[
k
] = 
w
[k]; ;

4528 
STBI__F_up
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + 
i
[k]); ;

4529 
STBI__F_avg
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + (
i
[k]>>1)); ;

4530 
STBI__F_h
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + 
	`bi__h
(0,
i
[k],0)); ;

4531 
STBI__F_avg_f
 : 
cur
[
k
] = 
w
[k]; ;

4532 
STBI__F_h_f
: 
cur
[
k
] = 
w
[k]; ;

4536 i(
dth
 == 8) {

4537 i(
img_n
 !
out_n
)

4538 
cur
[
img_n
] = 255;

4539 
w
 +
img_n
;

4540 
cur
 +
out_n
;

4541 
i
 +
out_n
;

4542 } i(
dth
 == 16) {

4543 i(
img_n
 !
out_n
) {

4544 
cur
[
fr_bys
] = 255;

4545 
cur
[
fr_bys
+1] = 255;

4547 
w
 +
fr_bys
;

4548 
cur
 +
ouut_bys
;

4549 
i
 +
ouut_bys
;

4551 
w
 += 1;

4552 
cur
 += 1;

4553 
i
 += 1;

4557 i(
dth
 < 8 || 
img_n
 =
out_n
) {

4558 
nk
 = (
width
 - 1)*
fr_bys
;

4559 
	#STBI__CASE
(
f
) \

4560 
f
: \

4561 
k
=0; k < 
nk
; ++k)

	)

4562 
fr
) {

4564 
STBI__F_ne
: 
	`memy
(
cur
, 
w
, 
nk
); ;

4565 
	`STBI__CASE
(
STBI__F_sub
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + cur[k-
fr_bys
]); } ;

4566 
	`STBI__CASE
(
STBI__F_up
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + 
i
[k]); } ;

4567 
	`STBI__CASE
(
STBI__F_avg
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + ((
i
[k] + cur[k-
fr_bys
])>>1)); } ;

4568 
	`STBI__CASE
(
STBI__F_h
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + 
	`bi__h
(cur[k-
fr_bys
],
i
[k],prior[k-filter_bytes])); } ;

4569 
	`STBI__CASE
(
STBI__F_avg_f
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + (cur[k-
fr_bys
] >> 1)); } ;

4570 
	`STBI__CASE
(
STBI__F_h_f
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + 
	`bi__h
(cur[k-
fr_bys
],0,0)); } ;

4572 #unde
STBI__CASE


4573 
w
 +
nk
;

4575 
	`STBI_ASSERT
(
img_n
+1 =
out_n
);

4576 
	#STBI__CASE
(
f
) \

4577 
f
: \

4578 
i
=
x
-1; i >1; --i, 
cur
[
fr_bys
]=255,
w
+=fr_bys,cur+=
ouut_bys
,
i
+=output_bytes) \

4579 
k
=0; k < 
fr_bys
; ++k)

	)

4580 
fr
) {

4581 
	`STBI__CASE
(
STBI__F_ne
{ 
cur
[
k
] = 
w
[k]; } ;

4582 
	`STBI__CASE
(
STBI__F_sub
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + cur[k- 
ouut_bys
]); } ;

4583 
	`STBI__CASE
(
STBI__F_up
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + 
i
[k]); } ;

4584 
	`STBI__CASE
(
STBI__F_avg
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + ((
i
[k] + cur[k- 
ouut_bys
])>>1)); } ;

4585 
	`STBI__CASE
(
STBI__F_h
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + 
	`bi__h
(cur[k- 
ouut_bys
],
i
[k],prior[k- output_bytes])); } ;

4586 
	`STBI__CASE
(
STBI__F_avg_f
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + (cur[k- 
ouut_bys
] >> 1)); } ;

4587 
	`STBI__CASE
(
STBI__F_h_f
{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
w
[k] + 
	`bi__h
(cur[k- 
ouut_bys
],0,0)); } ;

4589 #unde
STBI__CASE


4593 i(
dth
 == 16) {

4594 
cur
 = 
a
->
out
 + 
ride
*
j
;

4595 
i
=0; i < 
x
; ++i,
cur
+=
ouut_bys
) {

4596 
cur
[
fr_bys
+1] = 255;

4605 i(
dth
 < 8) {

4606 
j
=0; j < 
y
; ++j) {

4607 
bi_uc
 *
cur
 = 
a
->
out
 + 
ride
*
j
;

4608 
bi_uc
 *

 = 
a
->
out
 + 
ride
*
j
 + 
x
*
out_n
 - 
img_width_bys
;

4611 
bi_uc
 
s
 = (
c
 =0? 
bi__dth_s_b
[
dth
] : 1;

4619 i(
dth
 == 4) {

4620 
k
=
x
*
img_n
; k >2; k-=2, ++

) {

4621 *
cur
++ = 
s
 * ((*

 >> 4) );

4622 *
cur
++ = 
s
 * ((*

 ) & 0x0f);

4624 i(
k
 > 0*
cur
++ = 
s
 * ((*

 >> 4) );

4625 } i(
dth
 == 2) {

4626 
k
=
x
*
img_n
; k >4; k-=4, ++

) {

4627 *
cur
++ = 
s
 * ((*

 >> 6) );

4628 *
cur
++ = 
s
 * ((*

 >> 4) & 0x03);

4629 *
cur
++ = 
s
 * ((*

 >> 2) & 0x03);

4630 *
cur
++ = 
s
 * ((*

 ) & 0x03);

4632 i(
k
 > 0*
cur
++ = 
s
 * ((*

 >> 6) );

4633 i(
k
 > 1*
cur
++ = 
s
 * ((*

 >> 4) & 0x03);

4634 i(
k
 > 2*
cur
++ = 
s
 * ((*

 >> 2) & 0x03);

4635 } i(
dth
 == 1) {

4636 
k
=
x
*
img_n
; k >8; k-=8, ++

) {

4637 *
cur
++ = 
s
 * ((*

 >> 7) );

4638 *
cur
++ = 
s
 * ((*

 >> 6) & 0x01);

4639 *
cur
++ = 
s
 * ((*

 >> 5) & 0x01);

4640 *
cur
++ = 
s
 * ((*

 >> 4) & 0x01);

4641 *
cur
++ = 
s
 * ((*

 >> 3) & 0x01);

4642 *
cur
++ = 
s
 * ((*

 >> 2) & 0x01);

4643 *
cur
++ = 
s
 * ((*

 >> 1) & 0x01);

4644 *
cur
++ = 
s
 * ((*

 ) & 0x01);

4646 i(
k
 > 0*
cur
++ = 
s
 * ((*

 >> 7) );

4647 i(
k
 > 1*
cur
++ = 
s
 * ((*

 >> 6) & 0x01);

4648 i(
k
 > 2*
cur
++ = 
s
 * ((*

 >> 5) & 0x01);

4649 i(
k
 > 3*
cur
++ = 
s
 * ((*

 >> 4) & 0x01);

4650 i(
k
 > 4*
cur
++ = 
s
 * ((*

 >> 3) & 0x01);

4651 i(
k
 > 5*
cur
++ = 
s
 * ((*

 >> 2) & 0x01);

4652 i(
k
 > 6*
cur
++ = 
s
 * ((*

 >> 1) & 0x01);

4654 i(
img_n
 !
out_n
) {

4655 
q
;

4657 
cur
 = 
a
->
out
 + 
ride
*
j
;

4658 i(
img_n
 == 1) {

4659 
q
=
x
-1; q >= 0; --q) {

4660 
cur
[
q
*2+1] = 255;

4661 
cur
[
q
*2+0] = cur[q];

4664 
	`STBI_ASSERT
(
img_n
 == 3);

4665 
q
=
x
-1; q >= 0; --q) {

4666 
cur
[
q
*4+3] = 255;

4667 
cur
[
q
*4+2] = cur[q*3+2];

4668 
cur
[
q
*4+1] = cur[q*3+1];

4669 
cur
[
q
*4+0] = cur[q*3+0];

4674 } i(
dth
 == 16) {

4679 
bi_uc
 *
cur
 = 
a
->
out
;

4680 
bi__ut16
 *
cur16
 = (bi__ut16*)
cur
;

4682 
i
=0; i < 
x
*
y
*
out_n
; ++i,
cur16
++,
cur
+=2) {

4683 *
cur16
 = (
cur
[0] << 8) | cur[1];

4688 
	}
}

4690 
	$bi___g_image
(
bi__g
 *
a
, 
bi_uc
 *
image_da
, 
bi__ut32
 
image_da_n
, 
out_n
, 
dth
, 
c
, 
ad
)

4692 
bys
 = (
dth
 == 16 ? 2 : 1);

4693 
out_bys
 = 
out_n
 * 
bys
;

4694 
bi_uc
 *
f
;

4695 
p
;

4696 i(!
ad
)

4697  
	`bi___g_image_w
(
a
, 
image_da
, 
image_da_n
, 
out_n
,->
s
->
img_x
,->s->
img_y
, 
dth
, 
c
);

4700 
f
 = (
bi_uc
 *
	`bi__mloc_mad3
(
a
->
s
->
img_x
,->s->
img_y
, 
out_bys
, 0);

4701 
p
=0; < 7; ++p) {

4702 
xig
[] = { 0,4,0,2,0,1,0 };

4703 
yig
[] = { 0,0,4,0,2,0,1 };

4704 
xc
[] = { 8,8,4,4,2,2,1 };

4705 
yc
[] = { 8,8,8,4,4,2,2 };

4706 
i
,
j
,
x
,
y
;

4708 
x
 = (
a
->
s
->
img_x
 - 
xig
[
p
] + 
xc
[p]-1) / xspc[p];

4709 
y
 = (
a
->
s
->
img_y
 - 
yig
[
p
] + 
yc
[p]-1) / yspc[p];

4710 i(
x
 && 
y
) {

4711 
bi__ut32
 
img_n
 = ((((
a
->
s
->
img_n
 * 
x
 * 
dth
+ 7>> 3+ 1* 
y
;

4712 i(!
	`bi___g_image_w
(
a
, 
image_da
, 
image_da_n
, 
out_n
, 
x
, 
y
, 
dth
, 
c
)) {

4713 
	`STBI_FREE
(
f
);

4716 
j
=0; j < 
y
; ++j) {

4717 
i
=0; i < 
x
; ++i) {

4718 
out_y
 = 
j
*
yc
[
p
]+
yig
[p];

4719 
out_x
 = 
i
*
xc
[
p
]+
xig
[p];

4720 
	`memy
(
f
 + 
out_y
*
a
->
s
->
img_x
*
out_bys
 + 
out_x
*out_bytes,

4721 
a
->
out
 + (
j
*
x
+
i
)*
out_bys
, out_bytes);

4724 
	`STBI_FREE
(
a
->
out
);

4725 
image_da
 +
img_n
;

4726 
image_da_n
 -
img_n
;

4729 
a
->
out
 = 
f
;

4732 
	}
}

4734 
	$bi__compu_cy
(
bi__g
 *
z
, 
bi_uc
 
tc
[3], 
out_n
)

4736 
bi__cڋxt
 *
s
 = 
z
->s;

4737 
bi__ut32
 
i
, 
pix_cou
 = 
s
->
img_x
 * s->
img_y
;

4738 
bi_uc
 *
p
 = 
z
->
out
;

4742 
	`STBI_ASSERT
(
out_n
 == 2 || out_n == 4);

4744 i(
out_n
 == 2) {

4745 
i
=0; i < 
pix_cou
; ++i) {

4746 
p
[1] = (p[0] =
tc
[0] ? 0 : 255);

4747 
p
 += 2;

4750 
i
=0; i < 
pix_cou
; ++i) {

4751 i(
p
[0] =
tc
[0] &&[1] ==c[1] &&[2] ==c[2])

4752 
p
[3] = 0;

4753 
p
 += 4;

4757 
	}
}

4759 
	$bi__compu_cy16
(
bi__g
 *
z
, 
bi__ut16
 
tc
[3], 
out_n
)

4761 
bi__cڋxt
 *
s
 = 
z
->s;

4762 
bi__ut32
 
i
, 
pix_cou
 = 
s
->
img_x
 * s->
img_y
;

4763 
bi__ut16
 *
p
 = (bi__ut16*
z
->
out
;

4767 
	`STBI_ASSERT
(
out_n
 == 2 || out_n == 4);

4769 i(
out_n
 == 2) {

4770 
i
 = 0; i < 
pix_cou
; ++i) {

4771 
p
[1] = (p[0] =
tc
[0] ? 0 : 65535);

4772 
p
 += 2;

4775 
i
 = 0; i < 
pix_cou
; ++i) {

4776 i(
p
[0] =
tc
[0] &&[1] ==c[1] &&[2] ==c[2])

4777 
p
[3] = 0;

4778 
p
 += 4;

4782 
	}
}

4784 
	$bi__exnd_g_ˉe
(
bi__g
 *
a
, 
bi_uc
 *
ˉe
, 
n
, 
l_img_n
)

4786 
bi__ut32
 
i
, 
pix_cou
 = 
a
->
s
->
img_x
 *->s->
img_y
;

4787 
bi_uc
 *
p
, *
mp_out
, *
ig
 = 
a
->
out
;

4789 
p
 = (
bi_uc
 *
	`bi__mloc_mad2
(
pix_cou
, 
l_img_n
, 0);

4790 i(
p
 =
NULL
 
	`bi__r
("outofmem", "Out of memory");

4793 
mp_out
 = 
p
;

4795 i(
l_img_n
 == 3) {

4796 
i
=0; i < 
pix_cou
; ++i) {

4797 
n
 = 
ig
[
i
]*4;

4798 
p
[0] = 
ˉe
[
n
 ];

4799 
p
[1] = 
ˉe
[
n
+1];

4800 
p
[2] = 
ˉe
[
n
+2];

4801 
p
 += 3;

4804 
i
=0; i < 
pix_cou
; ++i) {

4805 
n
 = 
ig
[
i
]*4;

4806 
p
[0] = 
ˉe
[
n
 ];

4807 
p
[1] = 
ˉe
[
n
+1];

4808 
p
[2] = 
ˉe
[
n
+2];

4809 
p
[3] = 
ˉe
[
n
+3];

4810 
p
 += 4;

4813 
	`STBI_FREE
(
a
->
out
);

4814 
a
->
out
 = 
mp_out
;

4816 
	`STBI_NOTUSED
(
n
);

4819 
	}
}

4821 
	gbi__uŻmuɝly__ld
 = 0;

4822 
	gbi__de_he_ag
 = 0;

4824 
STBIDEF
 
	$bi_t_uŻmuɝly__ld
(
ag_ue_if_should_uŻmuɝly
)

4826 
bi__uŻmuɝly__ld
 = 
ag_ue_if_should_uŻmuɝly
;

4827 
	}
}

4829 
STBIDEF
 
	$bi_cvt_he_g_to_rgb
(
ag_ue_if_should_cvt
)

4831 
bi__de_he_ag
 = 
ag_ue_if_should_cvt
;

4832 
	}
}

4834 
	$bi__de_he
(
bi__g
 *
z
)

4836 
bi__cڋxt
 *
s
 = 
z
->s;

4837 
bi__ut32
 
i
, 
pix_cou
 = 
s
->
img_x
 * s->
img_y
;

4838 
bi_uc
 *
p
 = 
z
->
out
;

4840 i(
s
->
img_out_n
 == 3) {

4841 
i
=0; i < 
pix_cou
; ++i) {

4842 
bi_uc
 
t
 = 
p
[0];

4843 
p
[0] =[2];

4844 
p
[2] = 
t
;

4845 
p
 += 3;

4848 
	`STBI_ASSERT
(
s
->
img_out_n
 == 4);

4849 i(
bi__uŻmuɝly__ld
) {

4851 
i
=0; i < 
pix_cou
; ++i) {

4852 
bi_uc
 
a
 = 
p
[3];

4853 
bi_uc
 
t
 = 
p
[0];

4854 i(
a
) {

4855 
bi_uc
 
hf
 = 
a
 / 2;

4856 
p
[0] = (p[2] * 255 + 
hf
/ 
a
;

4857 
p
[1] = (p[1] * 255 + 
hf
/ 
a
;

4858 
p
[2] = ( 
t
 * 255 + 
hf
/ 
a
;

4860 
p
[0] =[2];

4861 
p
[2] = 
t
;

4863 
p
 += 4;

4867 
i
=0; i < 
pix_cou
; ++i) {

4868 
bi_uc
 
t
 = 
p
[0];

4869 
p
[0] =[2];

4870 
p
[2] = 
t
;

4871 
p
 += 4;

4875 
	}
}

4877 
	#STBI__PNG_TYPE
(
a
,
b
,
c
,
d
(((<< 24+ (((b<< 16+ (((c<< 8+ ((d))

	)

4879 
	$bi__r_g_fe
(
bi__g
 *
z
, 
sn
, 
q_comp
)

4881 
bi_uc
 
ˉe
[1024], 
l_img_n
=0;

4882 
bi_uc
 
has_s
=0, 
tc
[3]={0};

4883 
bi__ut16
 
tc16
[3];

4884 
bi__ut32
 
ioff
=0, 
ida_lim
=0, 
i
, 
l_n
=0;

4885 
f
=1,
k
,
a
=0, 
c
=0, 
is_he
=0;

4886 
bi__cڋxt
 *
s
 = 
z
->s;

4888 
z
->
exnded
 = 
NULL
;

4889 
z
->
ida
 = 
NULL
;

4890 
z
->
out
 = 
NULL
;

4892 i(!
	`bi__check_g_hd
(
s
))  0;

4894 i(
sn
 =
STBI__SCAN_ty
)  1;

4897 
bi__gchunk
 
c
 = 
	`bi__g_chunk_hd
(
s
);

4898 
c
.
ty
) {

4899 
	`STBI__PNG_TYPE
('C','g','B','I'):

4900 
is_he
 = 1;

4901 
	`bi__sk
(
s
, 
c
.
ngth
);

4903 
	`STBI__PNG_TYPE
('I','H','D','R'): {

4904 
comp
,
fr
;

4905 i(!
f
 
	`bi__r
("multiple IHDR","Corrupt PNG");

4906 
f
 = 0;

4907 i(
c
.
ngth
 !13 
	`bi__r
("bad IHDRen","Corrupt PNG");

4908 
s
->
img_x
 = 
	`bi__g32be
(s); i(s->img_x > (1 << 24) 
	`bi__r
("tooarge","Veryarge image (corrupt?)");

4909 
s
->
img_y
 = 
	`bi__g32be
(s); i(s->img_y > (1 << 24) 
	`bi__r
("tooarge","Veryarge image (corrupt?)");

4910 
z
->
dth
 = 
	`bi__g8
(
s
); i(z->dth !1 && z->dth !2 && z->dth !4 && z->dth !8 && z->dth !16 
	`bi__r
("1/2/4/8/16-bit only","PNGot supported: 1/2/4/8/16-bit only");

4911 
c
 = 
	`bi__g8
(
s
); i(c > 6 
	`bi__r
("bad ctype","Corrupt PNG");

4912 i(
c
 =3 && 
z
->
dth
 =16 
	`bi__r
("bad ctype","Corrupt PNG");

4913 i(
c
 =3
l_img_n
 = 3; i(c & 1 
	`bi__r
("bad ctype","Corrupt PNG");

4914 
comp
 = 
	`bi__g8
(
s
); i(comp 
	`bi__r
("bad comp method","Corrupt PNG");

4915 
fr

	`bi__g8
(
s
); i(fr 
	`bi__r
("bad filter method","Corrupt PNG");

4916 
a
 = 
	`bi__g8
(
s
); i(a>1 
	`bi__r
("bad interlace method","Corrupt PNG");

4917 i(!
s
->
img_x
 || !s->
img_y
 
	`bi__r
("0-pixel image","Corrupt PNG");

4918 i(!
l_img_n
) {

4919 
s
->
img_n
 = (
c
 & 2 ? 3 : 1) + (color & 4 ? 1 : 0);

4920 i((1 << 30/ 
s
->
img_x
 / s->
img_n
 < s->
img_y
 
	`bi__r
("tooarge", "Imageooargeo decode");

4921 i(
sn
 =
STBI__SCAN_hd
)  1;

4925 
s
->
img_n
 = 1;

4926 i((1 << 30/ 
s
->
img_x
 / 4 < s->
img_y
 
	`bi__r
("tooarge","Corrupt PNG");

4932 
	`STBI__PNG_TYPE
('P','L','T','E'): {

4933 i(
f
 
	`bi__r
("firstot IHDR", "Corrupt PNG");

4934 i(
c
.
ngth
 > 256*3 
	`bi__r
("invalid PLTE","Corrupt PNG");

4935 
l_n
 = 
c
.
ngth
 / 3;

4936 i(
l_n
 * 3 !
c
.
ngth
 
	`bi__r
("invalid PLTE","Corrupt PNG");

4937 
i
=0; i < 
l_n
; ++i) {

4938 
ˉe
[
i
*4+0] = 
	`bi__g8
(
s
);

4939 
ˉe
[
i
*4+1] = 
	`bi__g8
(
s
);

4940 
ˉe
[
i
*4+2] = 
	`bi__g8
(
s
);

4941 
ˉe
[
i
*4+3] = 255;

4946 
	`STBI__PNG_TYPE
('t','R','N','S'): {

4947 i(
f
 
	`bi__r
("firstot IHDR", "Corrupt PNG");

4948 i(
z
->
ida
 
	`bi__r
("tRNSfter IDAT","Corrupt PNG");

4949 i(
l_img_n
) {

4950 i(
sn
 =
STBI__SCAN_hd
{ 
s
->
img_n
 = 4;  1; }

4951 i(
l_n
 =0 
	`bi__r
("tRNS before PLTE","Corrupt PNG");

4952 i(
c
.
ngth
 > 
l_n
 
	`bi__r
("badRNSen","Corrupt PNG");

4953 
l_img_n
 = 4;

4954 
i
=0; i < 
c
.
ngth
; ++i)

4955 
ˉe
[
i
*4+3] = 
	`bi__g8
(
s
);

4957 i(!(
s
->
img_n
 & 1) 
	`bi__r
("tRNS withlpha","Corrupt PNG");

4958 i(
c
.
ngth
 !(
bi__ut32

s
->
img_n
*2 
	`bi__r
("badRNSen","Corrupt PNG");

4959 
has_s
 = 1;

4960 i(
z
->
dth
 == 16) {

4961 
k
 = 0; k < 
s
->
img_n
; ++k
tc16
[k] = (
bi__ut16
)
	`bi__g16be
(s);

4963 
k
 = 0; k < 
s
->
img_n
; ++k
tc
[k] = (
bi_uc
)(
	`bi__g16be
(s& 255* 
bi__dth_s_b
[
z
->
dth
];

4969 
	`STBI__PNG_TYPE
('I','D','A','T'): {

4970 i(
f
 
	`bi__r
("firstot IHDR", "Corrupt PNG");

4971 i(
l_img_n
 && !
l_n
 
	`bi__r
("no PLTE","Corrupt PNG");

4972 i(
sn
 =
STBI__SCAN_hd
{ 
s
->
img_n
 = 
l_img_n
;  1; }

4973 i(()(
ioff
 + 
c
.
ngth
) < ()ioff)  0;

4974 i(
ioff
 + 
c
.
ngth
 > 
ida_lim
) {

4975 
bi__ut32
 
ida_lim_d
 = 
ida_lim
;

4976 
bi_uc
 *
p
;

4977 i(
ida_lim
 =0ida_lim = 
c
.
ngth
 > 4096 ? c.length : 4096;

4978 
ioff
 + 
c
.
ngth
 > 
ida_lim
)

4979 
ida_lim
 *= 2;

4980 
	`STBI_NOTUSED
(
ida_lim_d
);

4981 
p
 = (
bi_uc
 *
	`STBI_REALLOC_SIZED
(
z
->
ida
, 
ida_lim_d
, 
ida_lim
); i =
NULL
 
	`bi__r
("outofmem", "Out of memory");

4982 
z
->
ida
 = 
p
;

4984 i(!
	`bi__gn
(
s
, 
z
->
ida
+
ioff
,
c
.
ngth
) 
	`bi__r
("outofdata","Corrupt PNG");

4985 
ioff
 +
c
.
ngth
;

4989 
	`STBI__PNG_TYPE
('I','E','N','D'): {

4990 
bi__ut32
 
w_n
, 
b
;

4991 i(
f
 
	`bi__r
("firstot IHDR", "Corrupt PNG");

4992 i(
sn
 !
STBI__SCAN_ld
)  1;

4993 i(
z
->
ida
 =
NULL
 
	`bi__r
("no IDAT","Corrupt PNG");

4995 
b
 = (
s
->
img_x
 * 
z
->
dth
 + 7) / 8;

4996 
w_n
 = 
b
 * 
s
->
img_y
 * s->
img_n
 + s->img_y ;

4997 
z
->
exnded
 = (
bi_uc
 *
	`bi_zlib_decode_mloc_guesssize_hdag
((*z->
ida
, 
ioff
, 
w_n
, (*&w_n, !
is_he
);

4998 i(
z
->
exnded
 =
NULL
)  0;

4999 
	`STBI_FREE
(
z
->
ida
); z->id
NULL
;

5000 i((
q_comp
 =
s
->
img_n
+1 &&eq_com!3 && !
l_img_n
|| 
has_s
)

5001 
s
->
img_out_n
 = s->
img_n
+1;

5003 
s
->
img_out_n
 = s->
img_n
;

5004 i(!
	`bi___g_image
(
z
, z->
exnded
, 
w_n
, 
s
->
img_out_n
, z->
dth
, 
c
, 
a
))  0;

5005 i(
has_s
) {

5006 i(
z
->
dth
 == 16) {

5007 i(!
	`bi__compu_cy16
(
z
, 
tc16
, 
s
->
img_out_n
))  0;

5009 i(!
	`bi__compu_cy
(
z
, 
tc
, 
s
->
img_out_n
))  0;

5012 i(
is_he
 && 
bi__de_he_ag
 && 
s
->
img_out_n
 > 2)

5013 
	`bi__de_he
(
z
);

5014 i(
l_img_n
) {

5016 
s
->
img_n
 = 
l_img_n
;

5017 
s
->
img_out_n
 = 
l_img_n
;

5018 i(
q_comp
 >3
s
->
img_out_n
 =eq_comp;

5019 i(!
	`bi__exnd_g_ˉe
(
z
, 
ˉe
, 
l_n
, 
s
->
img_out_n
))

5021 } i(
has_s
) {

5023 ++
s
->
img_n
;

5025 
	`STBI_FREE
(
z
->
exnded
); z->exnded = 
NULL
;

5027 
	`bi__g32be
(
s
);

5033 i(
f
 
	`bi__r
("firstot IHDR", "Corrupt PNG");

5034 i((
c
.
ty
 & (1 << 29)) == 0) {

5035 #ide
STBI_NO_FAILURE_STRINGS


5037 
vid_chunk
[] = "XXXX PNG chunkot known";

5038 
vid_chunk
[0] = 
	`STBI__BYTECAST
(
c
.
ty
 >> 24);

5039 
vid_chunk
[1] = 
	`STBI__BYTECAST
(
c
.
ty
 >> 16);

5040 
vid_chunk
[2] = 
	`STBI__BYTECAST
(
c
.
ty
 >> 8);

5041 
vid_chunk
[3] = 
	`STBI__BYTECAST
(
c
.
ty
 >> 0);

5043  
	`bi__r
(
vid_chunk
, "PNGot supported: unknown PNG chunkype");

5045 
	`bi__sk
(
s
, 
c
.
ngth
);

5049 
	`bi__g32be
(
s
);

5051 
	}
}

5053 *
	$bi__do_g
(
bi__g
 *
p
, *
x
, *
y
, *
n
, 
q_comp
, 
bi__su_fo
 *
ri
)

5055 *
su
=
NULL
;

5056 i(
q_comp
 < 0 ||eq_com> 4 
	`bi__uc
("badeq_comp", "Internalrror");

5057 i(
	`bi__r_g_fe
(
p
, 
STBI__SCAN_ld
, 
q_comp
)) {

5058 i(
p
->
dth
 < 8)

5059 
ri
->
bs_r_chl
 = 8;

5061 
ri
->
bs_r_chl
 = 
p
->
dth
;

5062 
su
 = 
p
->
out
;

5063 
p
->
out
 = 
NULL
;

5064 i(
q_comp
 &&eq_com!
p
->
s
->
img_out_n
) {

5065 i(
ri
->
bs_r_chl
 == 8)

5066 
su
 = 
	`bi__cvt_fm
((*su, 
p
->
s
->
img_out_n
, 
q_comp
,->s->
img_x
,->s->
img_y
);

5068 
su
 = 
	`bi__cvt_fm16
((
bi__ut16
 *su, 
p
->
s
->
img_out_n
, 
q_comp
,->s->
img_x
,->s->
img_y
);

5069 
p
->
s
->
img_out_n
 = 
q_comp
;

5070 i(
su
 =
NULL
) esult;

5072 *
x
 = 
p
->
s
->
img_x
;

5073 *
y
 = 
p
->
s
->
img_y
;

5074 i(
n
*
p
->
s
->
img_n
;

5076 
	`STBI_FREE
(
p
->
out
);->ou
NULL
;

5077 
	`STBI_FREE
(
p
->
exnded
);->exnded = 
NULL
;

5078 
	`STBI_FREE
(
p
->
ida
);->id
NULL
;

5080  
su
;

5081 
	}
}

5083 *
	$bi__g_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
)

5085 
bi__g
 
p
;

5086 
p
.
s
 = s;

5087  
	`bi__do_g
(&
p
, 
x
,
y
,
comp
,
q_comp
, 
ri
);

5088 
	}
}

5090 
	$bi__g_
(
bi__cڋxt
 *
s
)

5092 
r
;

5093 
r
 = 
	`bi__check_g_hd
(
s
);

5094 
	`bi__wd
(
s
);

5095  
r
;

5096 
	}
}

5098 
	$bi__g_fo_w
(
bi__g
 *
p
, *
x
, *
y
, *
comp
)

5100 i(!
	`bi__r_g_fe
(
p
, 
STBI__SCAN_hd
, 0)) {

5101 
	`bi__wd

p
->
s
 );

5104 i(
x
*x = 
p
->
s
->
img_x
;

5105 i(
y
*y = 
p
->
s
->
img_y
;

5106 i(
comp
*com
p
->
s
->
img_n
;

5108 
	}
}

5110 
	$bi__g_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

5112 
bi__g
 
p
;

5113 
p
.
s
 = s;

5114  
	`bi__g_fo_w
(&
p
, 
x
, 
y
, 
comp
);

5115 
	}
}

5117 
	$bi__g_is16
(
bi__cڋxt
 *
s
)

5119 
bi__g
 
p
;

5120 
p
.
s
 = s;

5121 i(!
	`bi__g_fo_w
(&
p
, 
NULL
, NULL, NULL))

5123 i(
p
.
dth
 != 16) {

5124 
	`bi__wd
(
p
.
s
);

5128 
	}
}

5133 #ide
STBI_NO_BMP


5134 
	$bi__bmp__w
(
bi__cڋxt
 *
s
)

5136 
r
;

5137 
sz
;

5138 i(
	`bi__g8
(
s
) != 'B')  0;

5139 i(
	`bi__g8
(
s
) != 'M')  0;

5140 
	`bi__g32
(
s
);

5141 
	`bi__g16
(
s
);

5142 
	`bi__g16
(
s
);

5143 
	`bi__g32
(
s
);

5144 
sz
 = 
	`bi__g32
(
s
);

5145 
r
 = (
sz
 == 12 || sz == 40 || sz == 56 || sz == 108 || sz == 124);

5146  
r
;

5147 
	}
}

5149 
	$bi__bmp_
(
bi__cڋxt
 *
s
)

5151 
r
 = 
	`bi__bmp__w
(
s
);

5152 
	`bi__wd
(
s
);

5153  
r
;

5154 
	}
}

5158 
	$bi__high_b
(
z
)

5160 
n
=0;

5161 i(
z
 == 0)  -1;

5162 i(
z
 >0x10000{ 
n
 += 16; z >>= 16; }

5163 i(
z
 >0x00100{ 
n
 += 8; z >>= 8; }

5164 i(
z
 >0x00010{ 
n
 += 4; z >>= 4; }

5165 i(
z
 >0x00004{ 
n
 += 2; z >>= 2; }

5166 i(
z
 >0x00002{ 
n
 += 1; }

5167  
n
;

5168 
	}
}

5170 
	$bi__bcou
(
a
)

5172 
a
 = (a & 0x55555555) + ((a >> 1) & 0x55555555);

5173 
a
 = (a & 0x33333333) + ((a >> 2) & 0x33333333);

5174 
a
 = (a + (a >> 4)) & 0x0f0f0f0f;

5175 
a
 = (a + (a >> 8));

5176 
a
 = (a + (a >> 16));

5177  
a
 & 0xff;

5178 
	}
}

5183 
	$bi__shisigd
(
v
, 
shi
, 
bs
)

5185 
mul_b
[9] = {

5190 
shi_b
[9] = {

5193 i(
shi
 < 0)

5194 
v
 <<-
shi
;

5196 
v
 >>
shi
;

5197 
	`STBI_ASSERT
(
v
 < 256);

5198 
v
 >>(8-
bs
);

5199 
	`STBI_ASSERT
(
bs
 >= 0 && bits <= 8);

5200  (((
v
 * 
mul_b
[
bs
]>> 
shi_b
[bits];

5201 
	}
}

5205 
	mb
, 
	mofft
, 
	mhsz
;

5206 
	mmr
,
	mmg
,
	mmb
,
	mma
, 
	ml_a
;

5207 
	mexa_ad
;

5208 } 
	tbi__bmp_da
;

5210 *
	$bi__bmp_r_hd
(
bi__cڋxt
 *
s
, 
bi__bmp_da
 *
fo
)

5212 
hsz
;

5213 i(
	`bi__g8
(
s
!'B' || stbi__g8(s!'M' 
	`bi__uc
("not BMP", "Corrupt BMP");

5214 
	`bi__g32
(
s
);

5215 
	`bi__g16
(
s
);

5216 
	`bi__g16
(
s
);

5217 
fo
->
offt
 = 
	`bi__g32
(
s
);

5218 
fo
->
hsz
 = hsz = 
	`bi__g32
(
s
);

5219 
fo
->
mr
 = info->
mg
 = info->
mb
 = info->
ma
 = 0;

5220 
fo
->
exa_ad
 = 14;

5222 i(
hsz
 !12 && hsz !40 && hsz !56 && hsz !108 && hsz !124 
	`bi__uc
("unknown BMP", "BMPypeot supported: unknown");

5223 i(
hsz
 == 12) {

5224 
s
->
img_x
 = 
	`bi__g16
(s);

5225 
s
->
img_y
 = 
	`bi__g16
(s);

5227 
s
->
img_x
 = 
	`bi__g32
(s);

5228 
s
->
img_y
 = 
	`bi__g32
(s);

5230 i(
	`bi__g16
(
s
!1 
	`bi__uc
("bad BMP", "bad BMP");

5231 
fo
->
b
 = 
	`bi__g16
(
s
);

5232 i(
hsz
 != 12) {

5233 
comess
 = 
	`bi__g32
(
s
);

5234 i(
comess
 =1 || comes=2 
	`bi__uc
("BMP RLE", "BMPypeot supported: RLE");

5235 
	`bi__g32
(
s
);

5236 
	`bi__g32
(
s
);

5237 
	`bi__g32
(
s
);

5238 
	`bi__g32
(
s
);

5239 
	`bi__g32
(
s
);

5240 i(
hsz
 == 40 || hsz == 56) {

5241 i(
hsz
 == 56) {

5242 
	`bi__g32
(
s
);

5243 
	`bi__g32
(
s
);

5244 
	`bi__g32
(
s
);

5245 
	`bi__g32
(
s
);

5247 i(
fo
->
b
 == 16 || info->bpp == 32) {

5248 i(
comess
 == 0) {

5249 i(
fo
->
b
 == 32) {

5250 
fo
->
mr
 = 0xffu << 16;

5251 
fo
->
mg
 = 0xffu << 8;

5252 
fo
->
mb
 = 0xffu << 0;

5253 
fo
->
ma
 = 0xffu << 24;

5254 
fo
->
l_a
 = 0;

5256 
fo
->
mr
 = 31u << 10;

5257 
fo
->
mg
 = 31u << 5;

5258 
fo
->
mb
 = 31u << 0;

5260 } i(
comess
 == 3) {

5261 
fo
->
mr
 = 
	`bi__g32
(
s
);

5262 
fo
->
mg
 = 
	`bi__g32
(
s
);

5263 
fo
->
mb
 = 
	`bi__g32
(
s
);

5264 
fo
->
exa_ad
 += 12;

5266 i(
fo
->
mr
 =fo->
mg
 && info->mg =fo->
mb
) {

5268  
	`bi__uc
("bad BMP", "bad BMP");

5271  
	`bi__uc
("bad BMP", "bad BMP");

5274 
i
;

5275 i(
hsz
 != 108 && hsz != 124)

5276  
	`bi__uc
("bad BMP", "bad BMP");

5277 
fo
->
mr
 = 
	`bi__g32
(
s
);

5278 
fo
->
mg
 = 
	`bi__g32
(
s
);

5279 
fo
->
mb
 = 
	`bi__g32
(
s
);

5280 
fo
->
ma
 = 
	`bi__g32
(
s
);

5281 
	`bi__g32
(
s
);

5282 
i
=0; i < 12; ++i)

5283 
	`bi__g32
(
s
);

5284 i(
hsz
 == 124) {

5285 
	`bi__g32
(
s
);

5286 
	`bi__g32
(
s
);

5287 
	`bi__g32
(
s
);

5288 
	`bi__g32
(
s
);

5293 
	}
}

5296 *
	$bi__bmp_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
)

5298 
bi_uc
 *
out
;

5299 
mr
=0,
mg
=0,
mb
=0,
ma
=0, 
l_a
;

5300 
bi_uc
 
l
[256][4];

5301 
psize
=0,
i
,
j
,
width
;

5302 
_vtiy
, 
d
, 
rg
;

5303 
bi__bmp_da
 
fo
;

5304 
	`STBI_NOTUSED
(
ri
);

5306 
fo
.
l_a
 = 255;

5307 i(
	`bi__bmp_r_hd
(
s
, &
fo
=
NULL
)

5308  
NULL
;

5310 
_vtiy
 = ((
s
->
img_y
) > 0;

5311 
s
->
img_y
 = 
	`abs
(() s->img_y);

5313 
mr
 = 
fo
.mr;

5314 
mg
 = 
fo
.mg;

5315 
mb
 = 
fo
.mb;

5316 
ma
 = 
fo
.ma;

5317 
l_a
 = 
fo
.all_a;

5319 i(
fo
.
hsz
 == 12) {

5320 i(
fo
.
b
 < 24)

5321 
psize
 = (
fo
.
offt
 - info.
exa_ad
 - 24) / 3;

5323 i(
fo
.
b
 < 16)

5324 
psize
 = (
fo
.
offt
 - info.
exa_ad
 - info.
hsz
) >> 2;

5326 i(
psize
 == 0) {

5327 
	`STBI_ASSERT
(
fo
.
offt
 =(
s
->
img_bufr
 - s->
bufr_t
));

5330 i(
fo
.
b
 =24 && 
ma
 == 0xff000000)

5331 
s
->
img_n
 = 3;

5333 
s
->
img_n
 = 
ma
 ? 4 : 3;

5334 i(
q_comp
 &&eq_comp >= 3)

5335 
rg
 = 
q_comp
;

5337 
rg
 = 
s
->
img_n
;

5340 i(!
	`bi__mad3sizes_vid
(
rg
, 
s
->
img_x
, s->
img_y
, 0))

5341  
	`bi__uc
("tooarge", "Corrupt BMP");

5343 
out
 = (
bi_uc
 *
	`bi__mloc_mad3
(
rg
, 
s
->
img_x
, s->
img_y
, 0);

5344 i(!
out
 
	`bi__uc
("outofmem", "Out of memory");

5345 i(
fo
.
b
 < 16) {

5346 
z
=0;

5347 i(
psize
 =0 ||siz> 256{ 
	`STBI_FREE
(
out
);  
	`bi__uc
("invalid", "Corrupt BMP"); }

5348 
i
=0; i < 
psize
; ++i) {

5349 
l
[
i
][2] = 
	`bi__g8
(
s
);

5350 
l
[
i
][1] = 
	`bi__g8
(
s
);

5351 
l
[
i
][0] = 
	`bi__g8
(
s
);

5352 i(
fo
.
hsz
 !12
	`bi__g8
(
s
);

5353 
l
[
i
][3] = 255;

5355 
	`bi__sk
(
s
, 
fo
.
offt
 - info.
exa_ad
 - info.
hsz
 - 
psize
 * (info.hsz == 12 ? 3 : 4));

5356 i(
fo
.
b
 =1
width
 = (
s
->
img_x
 + 7) >> 3;

5357 i(
fo
.
b
 =4
width
 = (
s
->
img_x
 + 1) >> 1;

5358 i(
fo
.
b
 =8
width
 = 
s
->
img_x
;

5359 { 
	`STBI_FREE
(
out
);  
	`bi__uc
("bad bpp", "Corrupt BMP"); }

5360 
d
 = (-
width
)&3;

5361 i(
fo
.
b
 == 1) {

5362 
j
=0; j < (
s
->
img_y
; ++j) {

5363 
b_offt
 = 7, 
v
 = 
	`bi__g8
(
s
);

5364 
i
=0; i < (
s
->
img_x
; ++i) {

5365 
c
 = (
v
>>
b_offt
)&0x1;

5366 
out
[
z
++] = 
l
[
c
][0];

5367 
out
[
z
++] = 
l
[
c
][1];

5368 
out
[
z
++] = 
l
[
c
][2];

5369 i(
rg
 =4
out
[
z
++] = 255;

5370 i(
i
+1 =(
s
->
img_x
) ;

5371 if((--
b_offt
) < 0) {

5372 
b_offt
 = 7;

5373 
v
 = 
	`bi__g8
(
s
);

5376 
	`bi__sk
(
s
, 
d
);

5379 
j
=0; j < (
s
->
img_y
; ++j) {

5380 
i
=0; i < (
s
->
img_x
; i += 2) {

5381 
v
=
	`bi__g8
(
s
),
v2
=0;

5382 i(
fo
.
b
 == 4) {

5383 
v2
 = 
v
 & 15;

5384 
v
 >>= 4;

5386 
out
[
z
++] = 
l
[
v
][0];

5387 
out
[
z
++] = 
l
[
v
][1];

5388 
out
[
z
++] = 
l
[
v
][2];

5389 i(
rg
 =4
out
[
z
++] = 255;

5390 i(
i
+1 =(
s
->
img_x
) ;

5391 
v
 = (
fo
.
b
 =8? 
	`bi__g8
(
s
: 
v2
;

5392 
out
[
z
++] = 
l
[
v
][0];

5393 
out
[
z
++] = 
l
[
v
][1];

5394 
out
[
z
++] = 
l
[
v
][2];

5395 i(
rg
 =4
out
[
z
++] = 255;

5397 
	`bi__sk
(
s
, 
d
);

5401 
rshi
=0,
gshi
=0,
bshi
=0,
ashi
=0,
rcou
=0,
gcou
=0,
bcou
=0,
acou
=0;

5402 
z
 = 0;

5403 
sy
=0;

5404 
	`bi__sk
(
s
, 
fo
.
offt
 - info.
exa_ad
 - info.
hsz
);

5405 i(
fo
.
b
 =24
width
 = 3 * 
s
->
img_x
;

5406 i(
fo
.
b
 =16
width
 = 2*
s
->
img_x
;

5407 
width
=0;

5408 
d
 = (-
width
) & 3;

5409 i(
fo
.
b
 == 24) {

5410 
sy
 = 1;

5411 } i(
fo
.
b
 == 32) {

5412 i(
mb
 =0xf&& 
mg
 =0xff00 && 
mr
 =0x00ff0000 && 
ma
 == 0xff000000)

5413 
sy
 = 2;

5415 i(!
sy
) {

5416 i(!
mr
 || !
mg
 || !
mb
{ 
	`STBI_FREE
(
out
);  
	`bi__uc
("bad masks", "Corrupt BMP"); }

5418 
rshi
 = 
	`bi__high_b
(
mr
)-7; 
rcou
 = 
	`bi__bcou
(mr);

5419 
gshi
 = 
	`bi__high_b
(
mg
)-7; 
gcou
 = 
	`bi__bcou
(mg);

5420 
bshi
 = 
	`bi__high_b
(
mb
)-7; 
bcou
 = 
	`bi__bcou
(mb);

5421 
ashi
 = 
	`bi__high_b
(
ma
)-7; 
acou
 = 
	`bi__bcou
(ma);

5423 
j
=0; j < (
s
->
img_y
; ++j) {

5424 i(
sy
) {

5425 
i
=0; i < (
s
->
img_x
; ++i) {

5426 
a
;

5427 
out
[
z
+2] = 
	`bi__g8
(
s
);

5428 
out
[
z
+1] = 
	`bi__g8
(
s
);

5429 
out
[
z
+0] = 
	`bi__g8
(
s
);

5430 
z
 += 3;

5431 
a
 = (
sy
 =2 ? 
	`bi__g8
(
s
) : 255);

5432 
l_a
 |
a
;

5433 i(
rg
 =4
out
[
z
++] = 
a
;

5436 
b
 = 
fo
.bpp;

5437 
i
=0; i < (
s
->
img_x
; ++i) {

5438 
bi__ut32
 
v
 = (
b
 =16 ? (bi__ut32
	`bi__g16
(
s
: 
	`bi__g32
(s));

5439 
a
;

5440 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`bi__shisigd
(
v
 & 
mr
, 
rshi
, 
rcou
));

5441 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`bi__shisigd
(
v
 & 
mg
, 
gshi
, 
gcou
));

5442 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`bi__shisigd
(
v
 & 
mb
, 
bshi
, 
bcou
));

5443 
a
 = (
ma
 ? 
	`bi__shisigd
(
v
 & ma, 
ashi
, 
acou
) : 255);

5444 
l_a
 |
a
;

5445 i(
rg
 =4
out
[
z
++] = 
	`STBI__BYTECAST
(
a
);

5448 
	`bi__sk
(
s
, 
d
);

5453 i(
rg
 =4 && 
l_a
 == 0)

5454 
i
=4*
s
->
img_x
*s->
img_y
-1; i >= 0; i -= 4)

5455 
out
[
i
] = 255;

5457 i(
_vtiy
) {

5458 
bi_uc
 
t
;

5459 
j
=0; j < (
s
->
img_y
>>1; ++j) {

5460 
bi_uc
 *
p1
 = 
out
 + 
j
 *
s
->
img_x
*
rg
;

5461 
bi_uc
 *
p2
 = 
out
 + (
s
->
img_y
-1-
j
)*s->
img_x
*
rg
;

5462 
i
=0; i < (
s
->
img_x
*
rg
; ++i) {

5463 
t
 = 
p1
[
i
];1[i] = 
p2
[i];2[i] =;

5468 i(
q_comp
 &&eq_com!
rg
) {

5469 
out
 = 
	`bi__cvt_fm
(out, 
rg
, 
q_comp
, 
s
->
img_x
, s->
img_y
);

5470 i(
out
 =
NULL
)  out;

5473 *
x
 = 
s
->
img_x
;

5474 *
y
 = 
s
->
img_y
;

5475 i(
comp
*com
s
->
img_n
;

5476  
out
;

5477 
	}
}

5482 #ide
STBI_NO_TGA


5484 
	$bi__tga_g_comp
(
bs_r_pix
, 
is_gy
, * 
is_rgb16
)

5487 i(
is_rgb16
) *is_rgb16 = 0;

5488 
bs_r_pix
) {

5489 8:  
STBI_gy
;

5490 16: if(
is_gy
 
STBI_gy_pha
;

5492 15: if(
is_rgb16
) *is_rgb16 = 1;

5493  
STBI_rgb
;

5495 32:  
bs_r_pix
/8;

5498 
	}
}

5500 
	$bi__tga_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

5502 
tga_w
, 
tga_h
, 
tga_comp
, 
tga_image_ty
, 
tga_bs_r_pix
, 
tga_cm_b
;

5503 
sz
, 
tga_cm_ty
;

5504 
	`bi__g8
(
s
);

5505 
tga_cm_ty
 = 
	`bi__g8
(
s
);

5506 if
tga_cm_ty
 > 1 ) {

5507 
	`bi__wd
(
s
);

5510 
tga_image_ty
 = 
	`bi__g8
(
s
);

5511 i
tga_cm_ty
 == 1 ) {

5512 i(
tga_image_ty
 != 1 &&ga_image_type != 9) {

5513 
	`bi__wd
(
s
);

5516 
	`bi__sk
(
s
,4);

5517 
sz
 = 
	`bi__g8
(
s
);

5518 i(
sz
 != 8) && (sz != 15) && (sz != 16) && (sz != 24) && (sz != 32) ) {

5519 
	`bi__wd
(
s
);

5522 
	`bi__sk
(
s
,4);

5523 
tga_cm_b
 = 
sz
;

5525 i(
tga_image_ty
 != 2) && (tga_image_type != 3) && (tga_image_type != 10) && (tga_image_type != 11) ) {

5526 
	`bi__wd
(
s
);

5529 
	`bi__sk
(
s
,9);

5530 
tga_cm_b
 = 0;

5532 
tga_w
 = 
	`bi__g16
(
s
);

5533 if
tga_w
 < 1 ) {

5534 
	`bi__wd
(
s
);

5537 
tga_h
 = 
	`bi__g16
(
s
);

5538 if
tga_h
 < 1 ) {

5539 
	`bi__wd
(
s
);

5542 
tga_bs_r_pix
 = 
	`bi__g8
(
s
);

5543 
	`bi__g8
(
s
);

5544 i(
tga_cm_b
 != 0) {

5545 if((
tga_bs_r_pix
 != 8) && (tga_bits_per_pixel != 16)) {

5548 
	`bi__wd
(
s
);

5551 
tga_comp
 = 
	`bi__tga_g_comp
(
tga_cm_b
, 0, 
NULL
);

5553 
tga_comp
 = 
	`bi__tga_g_comp
(
tga_bs_r_pix
, (
tga_image_ty
 =3|| (tga_image_ty =11), 
NULL
);

5555 if(!
tga_comp
) {

5556 
	`bi__wd
(
s
);

5559 i(
x
*x = 
tga_w
;

5560 i(
y
*y = 
tga_h
;

5561 i(
comp
*com
tga_comp
;

5563 
	}
}

5565 
	$bi__tga_
(
bi__cڋxt
 *
s
)

5567 
s
 = 0;

5568 
sz
, 
tga_c_ty
;

5569 
	`bi__g8
(
s
);

5570 
tga_c_ty
 = 
	`bi__g8
(
s
);

5571 i
tga_c_ty
 > 1 ) 
rEnd
;

5572 
sz
 = 
	`bi__g8
(
s
);

5573 i
tga_c_ty
 == 1 ) {

5574 i(
sz
 !1 && sz !9
rEnd
;

5575 
	`bi__sk
(
s
,4);

5576 
sz
 = 
	`bi__g8
(
s
);

5577 i(
sz
 !8&& (sz !15&& (sz !16&& (sz !24&& (sz !32
rEnd
;

5578 
	`bi__sk
(
s
,4);

5580 i(
sz
 !2&& (sz !3&& (sz !10&& (sz !11
rEnd
;

5581 
	`bi__sk
(
s
,9);

5583 i
	`bi__g16
(
s
< 1 ) 
rEnd
;

5584 i
	`bi__g16
(
s
< 1 ) 
rEnd
;

5585 
sz
 = 
	`bi__g8
(
s
);

5586 i(
tga_c_ty
 =1&& (
sz
 !8&& (sz !16
rEnd
;

5587 i(
sz
 !8&& (sz !15&& (sz !16&& (sz !24&& (sz !32
rEnd
;

5589 
s
 = 1;

5591 
rEnd
:

5592 
	`bi__wd
(
s
);

5593  
s
;

5594 
	}
}

5597 
	$bi__tga_ad_rgb16
(
bi__cڋxt
 *
s
, 
bi_uc
* 
out
)

5599 
bi__ut16
 
px
 = (bi__ut16)
	`bi__g16
(
s
);

5600 
bi__ut16
 
fiveBMask
 = 31;

5602 
r
 = (
px
 >> 10& 
fiveBMask
;

5603 
g
 = (
px
 >> 5& 
fiveBMask
;

5604 
b
 = 
px
 & 
fiveBMask
;

5606 
out
[0] = (
bi_uc
)((
r
 * 255)/31);

5607 
out
[1] = (
bi_uc
)((
g
 * 255)/31);

5608 
out
[2] = (
bi_uc
)((
b
 * 255)/31);

5614 
	}
}

5616 *
	$bi__tga_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
)

5619 
tga_offt
 = 
	`bi__g8
(
s
);

5620 
tga_dexed
 = 
	`bi__g8
(
s
);

5621 
tga_image_ty
 = 
	`bi__g8
(
s
);

5622 
tga_is_RLE
 = 0;

5623 
tga_ˉe_t
 = 
	`bi__g16
(
s
);

5624 
tga_ˉe_n
 = 
	`bi__g16
(
s
);

5625 
tga_ˉe_bs
 = 
	`bi__g8
(
s
);

5626 
tga_x_ig
 = 
	`bi__g16
(
s
);

5627 
tga_y_ig
 = 
	`bi__g16
(
s
);

5628 
tga_width
 = 
	`bi__g16
(
s
);

5629 
tga_height
 = 
	`bi__g16
(
s
);

5630 
tga_bs_r_pix
 = 
	`bi__g8
(
s
);

5631 
tga_comp
, 
tga_rgb16
=0;

5632 
tga_vd
 = 
	`bi__g8
(
s
);

5635 *
tga_da
;

5636 *
tga_ˉe
 = 
NULL
;

5637 
i
, 
j
;

5638 
w_da
[4] = {0};

5639 
RLE_cou
 = 0;

5640 
RLE_g
 = 0;

5641 
ad_xt_pix
 = 1;

5642 
	`STBI_NOTUSED
(
ri
);

5643 
	`STBI_NOTUSED
(
tga_x_ig
);

5644 
	`STBI_NOTUSED
(
tga_y_ig
);

5647 i
tga_image_ty
 >= 8 )

5649 
tga_image_ty
 -= 8;

5650 
tga_is_RLE
 = 1;

5652 
tga_vd
 = 1 - ((tga_inverted >> 5) & 1);

5655 i
tga_dexed
 ) 
tga_comp
 = 
	`bi__tga_g_comp
(
tga_ˉe_bs
, 0, &
tga_rgb16
);

5656 
tga_comp
 = 
	`bi__tga_g_comp
(
tga_bs_r_pix
, (
tga_image_ty
 =3), &
tga_rgb16
);

5658 if(!
tga_comp
)

5659  
	`bi__uc
("bad format", "Can't find out TGAixelformat");

5662 *
x
 = 
tga_width
;

5663 *
y
 = 
tga_height
;

5664 i(
comp
*com
tga_comp
;

5666 i(!
	`bi__mad3sizes_vid
(
tga_width
, 
tga_height
, 
tga_comp
, 0))

5667  
	`bi__uc
("tooarge", "Corrupt TGA");

5669 
tga_da
 = (*)
	`bi__mloc_mad3
(
tga_width
, 
tga_height
, 
tga_comp
, 0);

5670 i(!
tga_da
 
	`bi__uc
("outofmem", "Out of memory");

5673 
	`bi__sk
(
s
, 
tga_offt
 );

5675 i!
tga_dexed
 && !
tga_is_RLE
 && !
tga_rgb16
 ) {

5676 
i
=0; i < 
tga_height
; ++i) {

5677 
row
 = 
tga_vd
 ? 
tga_height
 -
i
 - 1 : i;

5678 
bi_uc
 *
tga_row
 = 
tga_da
 + 
row
*
tga_width
*
tga_comp
;

5679 
	`bi__gn
(
s
, 
tga_row
, 
tga_width
 * 
tga_comp
);

5683 i
tga_dexed
)

5686 
	`bi__sk
(
s
, 
tga_ˉe_t
 );

5688 
tga_ˉe
 = (*)
	`bi__mloc_mad2
(
tga_ˉe_n
, 
tga_comp
, 0);

5689 i(!
tga_ˉe
) {

5690 
	`STBI_FREE
(
tga_da
);

5691  
	`bi__uc
("outofmem", "Out of memory");

5693 i(
tga_rgb16
) {

5694 
bi_uc
 *
l_y
 = 
tga_ˉe
;

5695 
	`STBI_ASSERT
(
tga_comp
 =
STBI_rgb
);

5696 
i
=0; i < 
tga_ˉe_n
; ++i) {

5697 
	`bi__tga_ad_rgb16
(
s
, 
l_y
);

5698 
l_y
 +
tga_comp
;

5700 } i(!
	`bi__gn
(
s
, 
tga_ˉe
, 
tga_ˉe_n
 * 
tga_comp
)) {

5701 
	`STBI_FREE
(
tga_da
);

5702 
	`STBI_FREE
(
tga_ˉe
);

5703  
	`bi__uc
("badalette", "Corrupt TGA");

5707 
i
=0; i < 
tga_width
 * 
tga_height
; ++i)

5710 i
tga_is_RLE
 )

5712 i
RLE_cou
 == 0 )

5715 
RLE_cmd
 = 
	`bi__g8
(
s
);

5716 
RLE_cou
 = 1 + (
RLE_cmd
 & 127);

5717 
RLE_g
 = 
RLE_cmd
 >> 7;

5718 
ad_xt_pix
 = 1;

5719 } i!
RLE_g
 )

5721 
ad_xt_pix
 = 1;

5725 
ad_xt_pix
 = 1;

5728 i
ad_xt_pix
 )

5731 i
tga_dexed
 )

5734 
l_idx
 = (
tga_bs_r_pix
 =8? 
	`bi__g8
(
s
: 
	`bi__g16
(s);

5735 i
l_idx
 >
tga_ˉe_n
 ) {

5737 
l_idx
 = 0;

5739 
l_idx
 *
tga_comp
;

5740 
j
 = 0; j < 
tga_comp
; ++j) {

5741 
w_da
[
j
] = 
tga_ˉe
[
l_idx
+j];

5743 } if(
tga_rgb16
) {

5744 
	`STBI_ASSERT
(
tga_comp
 =
STBI_rgb
);

5745 
	`bi__tga_ad_rgb16
(
s
, 
w_da
);

5748 
j
 = 0; j < 
tga_comp
; ++j) {

5749 
w_da
[
j
] = 
	`bi__g8
(
s
);

5753 
ad_xt_pix
 = 0;

5757 
j
 = 0; j < 
tga_comp
; ++j)

5758 
tga_da
[
i
*
tga_comp
+
j
] = 
w_da
[j];

5761 --
RLE_cou
;

5764 i
tga_vd
 )

5766 
j
 = 0; j*2 < 
tga_height
; ++j)

5768 
dex1
 = 
j
 * 
tga_width
 * 
tga_comp
;

5769 
dex2
 = (
tga_height
 - 1 - 
j
* 
tga_width
 * 
tga_comp
;

5770 
i
 = 
tga_width
 * 
tga_comp
; i > 0; --i)

5772 
mp
 = 
tga_da
[
dex1
];

5773 
tga_da
[
dex1
] =ga_da[
dex2
];

5774 
tga_da
[
dex2
] = 
mp
;

5775 ++
dex1
;

5776 ++
dex2
;

5781 i
tga_ˉe
 !
NULL
 )

5783 
	`STBI_FREE

tga_ˉe
 );

5788 i(
tga_comp
 >3 && !
tga_rgb16
)

5790 * 
tga_pix
 = 
tga_da
;

5791 
i
=0; i < 
tga_width
 * 
tga_height
; ++i)

5793 
mp
 = 
tga_pix
[0];

5794 
tga_pix
[0] =ga_pixel[2];

5795 
tga_pix
[2] = 
mp
;

5796 
tga_pix
 +
tga_comp
;

5801 i(
q_comp
 &&eq_com!
tga_comp
)

5802 
tga_da
 = 
	`bi__cvt_fm
ga_da, 
tga_comp
, 
q_comp
, 
tga_width
, 
tga_height
);

5806 
tga_ˉe_t
 = 
tga_ˉe_n
 = 
tga_ˉe_bs
 =

5807 
tga_x_ig
 = 
tga_y_ig
 = 0;

5808 
	`STBI_NOTUSED
(
tga_ˉe_t
);

5810  
tga_da
;

5811 
	}
}

5817 #ide
STBI_NO_PSD


5818 
	$bi__psd_
(
bi__cڋxt
 *
s
)

5820 
r
 = (
	`bi__g32be
(
s
) == 0x38425053);

5821 
	`bi__wd
(
s
);

5822  
r
;

5823 
	}
}

5825 
	$bi__psd_decode_e
(
bi__cڋxt
 *
s
, 
bi_uc
 *
p
, 
pixCou
)

5827 
cou
, 
e
, 
n
;

5829 
cou
 = 0;

5830 (
e
 = 
pixCou
 - 
cou
) > 0) {

5831 
n
 = 
	`bi__g8
(
s
);

5832 i(
n
 == 128) {

5834 } i(
n
 < 128) {

5836 
n
++;

5837 i(
n
 > 
e
)  0;

5838 
cou
 +
n
;

5839 
n
) {

5840 *
p
 = 
	`bi__g8
(
s
);

5841 
p
 += 4;

5842 
n
--;

5844 } i(
n
 > 128) {

5845 
bi_uc
 
v
;

5848 
n
 = 257 -en;

5849 i(
n
 > 
e
)  0;

5850 
v
 = 
	`bi__g8
(
s
);

5851 
cou
 +
n
;

5852 
n
) {

5853 *
p
 = 
v
;

5854 
p
 += 4;

5855 
n
--;

5861 
	}
}

5863 *
	$bi__psd_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
, 
bpc
)

5865 
pixCou
;

5866 
chlCou
, 
comessi
;

5867 
chl
, 
i
;

5868 
bdth
;

5869 
w
,
h
;

5870 
bi_uc
 *
out
;

5871 
	`STBI_NOTUSED
(
ri
);

5874 i(
	`bi__g32be
(
s
) != 0x38425053)

5875  
	`bi__uc
("not PSD", "Corrupt PSD image");

5878 i(
	`bi__g16be
(
s
) != 1)

5879  
	`bi__uc
("wrong version", "Unsupported version of PSD image");

5882 
	`bi__sk
(
s
, 6 );

5885 
chlCou
 = 
	`bi__g16be
(
s
);

5886 i(
chlCou
 < 0 || channelCount > 16)

5887  
	`bi__uc
("wrong channel count", "Unsupportedumber of channels in PSD image");

5890 
h
 = 
	`bi__g32be
(
s
);

5891 
w
 = 
	`bi__g32be
(
s
);

5894 
bdth
 = 
	`bi__g16be
(
s
);

5895 i(
bdth
 != 8 && bitdepth != 16)

5896  
	`bi__uc
("unsupported bit depth", "PSD bit depth isot 8 or 16 bit");

5908 i(
	`bi__g16be
(
s
) != 3)

5909  
	`bi__uc
("wrong color format", "PSD isot in RGB color format");

5912 
	`bi__sk
(
s
,
	`bi__g32be
(s) );

5915 
	`bi__sk
(
s
, 
	`bi__g32be
(s) );

5918 
	`bi__sk
(
s
, 
	`bi__g32be
(s) );

5924 
comessi
 = 
	`bi__g16be
(
s
);

5925 i(
comessi
 > 1)

5926  
	`bi__uc
("bad compression", "PSD hasn unknown compression format");

5929 i(!
	`bi__mad3sizes_vid
(4, 
w
, 
h
, 0))

5930  
	`bi__uc
("tooarge", "Corrupt PSD");

5934 i(!
comessi
 && 
bdth
 =16 && 
bpc
 == 16) {

5935 
out
 = (
bi_uc
 *
	`bi__mloc_mad3
(8, 
w
, 
h
, 0);

5936 
ri
->
bs_r_chl
 = 16;

5938 
out
 = (
bi_uc
 *
	`bi__mloc
(4 * 
w
*
h
);

5940 i(!
out
 
	`bi__uc
("outofmem", "Out of memory");

5941 
pixCou
 = 
w
*
h
;

5947 i(
comessi
) {

5958 
	`bi__sk
(
s
, 
h
 * 
chlCou
 * 2 );

5961 
chl
 = 0; channel < 4; channel++) {

5962 
bi_uc
 *
p
;

5964 
p
 = 
out
+
chl
;

5965 i(
chl
 >
chlCou
) {

5967 
i
 = 0; i < 
pixCou
; i++, 
p
 += 4)

5968 *
p
 = (
chl
 == 3 ? 255 : 0);

5971 i(!
	`bi__psd_decode_e
(
s
, 
p
, 
pixCou
)) {

5972 
	`STBI_FREE
(
out
);

5973  
	`bi__uc
("corrupt", "bad RLEiece_data");

5983 
chl
 = 0; channel < 4; channel++) {

5984 i(
chl
 >
chlCou
) {

5986 i(
bdth
 =16 && 
bpc
 == 16) {

5987 
bi__ut16
 *
q
 = ((bi__ut16 *
out
+ 
chl
;

5988 
bi__ut16
 
v
 = 
chl
 == 3 ? 65535 : 0;

5989 
i
 = 0; i < 
pixCou
; i++, 
q
 += 4)

5990 *
q
 = 
v
;

5992 
bi_uc
 *
p
 = 
out
+
chl
;

5993 
bi_uc
 
v
 = 
chl
 == 3 ? 255 : 0;

5994 
i
 = 0; i < 
pixCou
; i++, 
p
 += 4)

5995 *
p
 = 
v
;

5998 i(
ri
->
bs_r_chl
 == 16) {

5999 
bi__ut16
 *
q
 = ((bi__ut16 *
out
+ 
chl
;

6000 
i
 = 0; i < 
pixCou
; i++, 
q
 += 4)

6001 *
q
 = (
bi__ut16

	`bi__g16be
(
s
);

6003 
bi_uc
 *
p
 = 
out
+
chl
;

6004 i(
bdth
 == 16) {

6005 
i
 = 0; i < 
pixCou
; i++, 
p
 += 4)

6006 *
p
 = (
bi_uc
(
	`bi__g16be
(
s
) >> 8);

6008 
i
 = 0; i < 
pixCou
; i++, 
p
 += 4)

6009 *
p
 = 
	`bi__g8
(
s
);

6017 i(
chlCou
 >= 4) {

6018 i(
ri
->
bs_r_chl
 == 16) {

6019 
i
=0; i < 
w
*
h
; ++i) {

6020 
bi__ut16
 *
pix
 = (bi__ut16 *
out
 + 4*
i
;

6021 i(
pix
[3] != 0 &&ixel[3] != 65535) {

6022 
a
 = 
pix
[3] / 65535.0f;

6023 

 = 1.0/ 
a
;

6024 
v_a
 = 65535.0* (1 - 

);

6025 
pix
[0] = (
bi__ut16
ix[0]*

 + 
v_a
);

6026 
pix
[1] = (
bi__ut16
ix[1]*

 + 
v_a
);

6027 
pix
[2] = (
bi__ut16
ix[2]*

 + 
v_a
);

6031 
i
=0; i < 
w
*
h
; ++i) {

6032 *
pix
 = 
out
 + 4*
i
;

6033 i(
pix
[3] != 0 &&ixel[3] != 255) {

6034 
a
 = 
pix
[3] / 255.0f;

6035 

 = 1.0/ 
a
;

6036 
v_a
 = 255.0* (1 - 

);

6037 
pix
[0] = (ix[0]*

 + 
v_a
);

6038 
pix
[1] = (ix[1]*

 + 
v_a
);

6039 
pix
[2] = (ix[2]*

 + 
v_a
);

6046 i(
q_comp
 &&eq_comp != 4) {

6047 i(
ri
->
bs_r_chl
 == 16)

6048 
out
 = (
bi_uc
 *
	`bi__cvt_fm16
((
bi__ut16
 *out, 4, 
q_comp
, 
w
, 
h
);

6050 
out
 = 
	`bi__cvt_fm
(out, 4, 
q_comp
, 
w
, 
h
);

6051 i(
out
 =
NULL
)  out;

6054 i(
comp
) *comp = 4;

6055 *
y
 = 
h
;

6056 *
x
 = 
w
;

6058  
out
;

6059 
	}
}

6069 #ide
STBI_NO_PIC


6070 
	$bi__pic_is4
(
bi__cڋxt
 *
s
,cڡ *
r
)

6072 
i
;

6073 
i
=0; i<4; ++i)

6074 i(
	`bi__g8
(
s
!(
bi_uc
)
r
[
i
])

6078 
	}
}

6080 
	$bi__pic__ce
(
bi__cڋxt
 *
s
)

6082 
i
;

6084 i(!
	`bi__pic_is4
(
s
,"\x53\x80\xF6\x34"))

6087 
i
=0;i<84;++i)

6088 
	`bi__g8
(
s
);

6090 i(!
	`bi__pic_is4
(
s
,"PICT"))

6094 
	}
}

6098 
bi_uc
 
	msize
,
	mty
,
	mchl
;

6099 } 
	tbi__pic_ck
;

6101 
bi_uc
 *
	$bi__adv
(
bi__cڋxt
 *
s
, 
chl
, 
bi_uc
 *
de
)

6103 
mask
=0x80, 
i
;

6105 
i
=0; i<4; ++i, 
mask
>>=1) {

6106 i(
chl
 & 
mask
) {

6107 i(
	`bi___eof
(
s
) 
	`bi__uc
("bad file","PIC fileoo short");

6108 
de
[
i
]=
	`bi__g8
(
s
);

6112  
de
;

6113 
	}
}

6115 
	$bi__cyv
(
chl
,
bi_uc
 *
de
,cڡ stbi_u*
c
)

6117 
mask
=0x80,
i
;

6119 
i
=0;i<4; ++i, 
mask
>>=1)

6120 i(
chl
&
mask
)

6121 
de
[
i
]=
c
[i];

6122 
	}
}

6124 
bi_uc
 *
	$bi__pic_ld_ce
(
bi__cڋxt
 *
s
,
width
,
height
,*
comp
, 
bi_uc
 *
su
)

6126 
a_comp
=0,
num_cks
=0,
y
,
chaed
;

6127 
bi__pic_ck
 
cks
[10];

6132 
bi__pic_ck
 *
ck
;

6134 i(
num_cks
==(
cks
)/(packets[0]))

6135  
	`bi__uc
("bad format","too manyackets");

6137 
ck
 = &
cks
[
num_cks
++];

6139 
chaed
 = 
	`bi__g8
(
s
);

6140 
ck
->
size
 = 
	`bi__g8
(
s
);

6141 
ck
->
ty
 = 
	`bi__g8
(
s
);

6142 
ck
->
chl
 = 
	`bi__g8
(
s
);

6144 
a_comp
 |
ck
->
chl
;

6146 i(
	`bi___eof
(
s
) 
	`bi__uc
("bad file","fileoo short (readingackets)");

6147 i(
ck
->
size
 !8 
	`bi__uc
("bad format","packet isn't 8bpp");

6148 } 
chaed
);

6150 *
comp
 = (
a_comp
 & 0x10 ? 4 : 3);

6152 
y
=0; y<
height
; ++y) {

6153 
ck_idx
;

6155 
ck_idx
=0;ack_idx < 
num_cks
; ++packet_idx) {

6156 
bi__pic_ck
 *
ck
 = &
cks
[
ck_idx
];

6157 
bi_uc
 *
de
 = 
su
+
y
*
width
*4;

6159 
ck
->
ty
) {

6161  
	`bi__uc
("bad format","packet has bad compressionype");

6164 
x
;

6166 
x
=0;x<
width
;++x, 
de
+=4)

6167 i(!
	`bi__adv
(
s
,
ck
->
chl
,
de
))

6174 

=
width
, 
i
;

6176 

>0) {

6177 
bi_uc
 
cou
,
vue
[4];

6179 
cou
=
	`bi__g8
(
s
);

6180 i(
	`bi___eof
(
s
) 
	`bi__uc
("bad file","fileoo short (pureead count)");

6182 i(
cou
 > 

)

6183 
cou
 = (
bi_uc


;

6185 i(!
	`bi__adv
(
s
,
ck
->
chl
,
vue
))  0;

6187 
i
=0; i<
cou
; ++i,
de
+=4)

6188 
	`bi__cyv
(
ck
->
chl
,
de
,
vue
);

6189 

 -
cou
;

6195 

=
width
;

6196 

>0) {

6197 
cou
 = 
	`bi__g8
(
s
), 
i
;

6198 i(
	`bi___eof
(
s
) 
	`bi__uc
("bad file","fileoo short (mixedead count)");

6200 i(
cou
 >= 128) {

6201 
bi_uc
 
vue
[4];

6203 i(
cou
==128)

6204 
cou
 = 
	`bi__g16be
(
s
);

6206 
cou
 -= 127;

6207 i(
cou
 > 

)

6208  
	`bi__uc
("bad file","scanline overrun");

6210 i(!
	`bi__adv
(
s
,
ck
->
chl
,
vue
))

6213 
i
=0;i<
cou
;++i, 
de
 += 4)

6214 
	`bi__cyv
(
ck
->
chl
,
de
,
vue
);

6216 ++
cou
;

6217 i(
cou
>

 
	`bi__uc
("bad file","scanline overrun");

6219 
i
=0;i<
cou
;++i, 
de
+=4)

6220 i(!
	`bi__adv
(
s
,
ck
->
chl
,
de
))

6223 

-=
cou
;

6231  
su
;

6232 
	}
}

6234 *
	$bi__pic_ld
(
bi__cڋxt
 *
s
,*
px
,*
py
,*
comp
,
q_comp
, 
bi__su_fo
 *
ri
)

6236 
bi_uc
 *
su
;

6237 
i
, 
x
,
y
, 
_comp
;

6238 
	`STBI_NOTUSED
(
ri
);

6240 i(!
comp
com&
_comp
;

6242 
i
=0; i<92; ++i)

6243 
	`bi__g8
(
s
);

6245 
x
 = 
	`bi__g16be
(
s
);

6246 
y
 = 
	`bi__g16be
(
s
);

6247 i(
	`bi___eof
(
s
) 
	`bi__uc
("bad file","fileoo short (pic header)");

6248 i(!
	`bi__mad3sizes_vid
(
x
, 
y
, 4, 0) 
	`bi__uc
("tooarge", "PIC imageooargeo decode");

6250 
	`bi__g32be
(
s
);

6251 
	`bi__g16be
(
s
);

6252 
	`bi__g16be
(
s
);

6255 
su
 = (
bi_uc
 *
	`bi__mloc_mad3
(
x
, 
y
, 4, 0);

6256 
	`memt
(
su
, 0xff, 
x
*
y
*4);

6258 i(!
	`bi__pic_ld_ce
(
s
,
x
,
y
,
comp
, 
su
)) {

6259 
	`STBI_FREE
(
su
);

6260 
su
=0;

6262 *
px
 = 
x
;

6263 *
py
 = 
y
;

6264 i(
q_comp
 =0q_com*
comp
;

6265 
su
=
	`bi__cvt_fm
esu,4,
q_comp
,
x
,
y
);

6267  
su
;

6268 
	}
}

6270 
	$bi__pic_
(
bi__cڋxt
 *
s
)

6272 
r
 = 
	`bi__pic__ce
(
s
);

6273 
	`bi__wd
(
s
);

6274  
r
;

6275 
	}
}

6281 #ide
STBI_NO_GIF


6284 
bi__t16
 
	mefix
;

6285 
bi_uc
 
	mf
;

6286 
bi_uc
 
	msuffix
;

6287 } 
	tbi__gif_lzw
;

6291 
	mw
,
	mh
;

6292 
bi_uc
 *
	mout
;

6293 
bi_uc
 *
	mbackground
;

6294 
bi_uc
 *
	mhiy
;

6295 
	mags
, 
	mbgdex
, 
	mtio
, 
	mt
, 
	meags
;

6296 
bi_uc
 
	ml
[256][4];

6297 
bi_uc
 
	mͮ
[256][4];

6298 
bi__gif_lzw
 
	mcodes
[8192];

6299 
bi_uc
 *
	mc_b
;

6300 
	mr
, 
	m
;

6301 
	mlags
;

6302 
	mt_x
, 
	mt_y
;

6303 
	mmax_x
, 
	mmax_y
;

6304 
	mcur_x
, 
	mcur_y
;

6305 
	mle_size
;

6306 
	mday
;

6307 } 
	tbi__gif
;

6309 
	$bi__gif__w
(
bi__cڋxt
 *
s
)

6311 
sz
;

6312 i(
	`bi__g8
(
s
) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')  0;

6313 
sz
 = 
	`bi__g8
(
s
);

6314 i(
sz
 != '9' && sz != '7')  0;

6315 i(
	`bi__g8
(
s
) != 'a')  0;

6317 
	}
}

6319 
	$bi__gif_
(
bi__cڋxt
 *
s
)

6321 
r
 = 
	`bi__gif__w
(
s
);

6322 
	`bi__wd
(
s
);

6323  
r
;

6324 
	}
}

6326 
	$bi__gif_r_c܏b
(
bi__cڋxt
 *
s
, 
bi_uc
 
l
[256][4], 
num_s
, 

)

6328 
i
;

6329 
i
=0; i < 
num_s
; ++i) {

6330 
l
[
i
][2] = 
	`bi__g8
(
s
);

6331 
l
[
i
][1] = 
	`bi__g8
(
s
);

6332 
l
[
i
][0] = 
	`bi__g8
(
s
);

6333 
l
[
i
][3] = 

 == i ? 0 : 255;

6335 
	}
}

6337 
	$bi__gif_hd
(
bi__cڋxt
 *
s
, 
bi__gif
 *
g
, *
comp
, 
is_fo
)

6339 
bi_uc
 
vsi
;

6340 i(
	`bi__g8
(
s
) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')

6341  
	`bi__r
("not GIF", "Corrupt GIF");

6343 
vsi
 = 
	`bi__g8
(
s
);

6344 i(
vsi
 !'7' && vsi !'9' 
	`bi__r
("not GIF", "Corrupt GIF");

6345 i(
	`bi__g8
(
s
!'a' 
	`bi__r
("not GIF", "Corrupt GIF");

6347 
bi__g_u_as
 = "";

6348 
g
->
w
 = 
	`bi__g16
(
s
);

6349 
g
->
h
 = 
	`bi__g16
(
s
);

6350 
g
->
ags
 = 
	`bi__g8
(
s
);

6351 
g
->
bgdex
 = 
	`bi__g8
(
s
);

6352 
g
->
tio
 = 
	`bi__g8
(
s
);

6353 
g
->
t
 = -1;

6355 i(
comp
 != 0) *comp = 4;

6357 i(
is_fo
)  1;

6359 i(
g
->
ags
 & 0x80)

6360 
	`bi__gif_r_c܏b
(
s
,
g
->
l
, 2 << (g->
ags
 & 7), -1);

6363 
	}
}

6365 
	$bi__gif_fo_w
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

6367 
bi__gif
* 
g
 = (bi__gif*
	`bi__mloc
((stbi__gif));

6368 i(!
	`bi__gif_hd
(
s
, 
g
, 
comp
, 1)) {

6369 
	`STBI_FREE
(
g
);

6370 
	`bi__wd

s
 );

6373 i(
x
*x = 
g
->
w
;

6374 i(
y
*y = 
g
->
h
;

6375 
	`STBI_FREE
(
g
);

6377 
	}
}

6379 
	$bi__out_gif_code
(
bi__gif
 *
g
, 
bi__ut16
 
code
)

6381 
bi_uc
 *
p
, *
c
;

6382 
idx
;

6386 i(
g
->
codes
[
code
].
efix
 >= 0)

6387 
	`bi__out_gif_code
(
g
, g->
codes
[
code
].
efix
);

6389 i(
g
->
cur_y
 >g->
max_y
) ;

6391 
idx
 = 
g
->
cur_x
 + g->
cur_y
;

6392 
p
 = &
g
->
out
[
idx
];

6393 
g
->
hiy
[
idx
 / 4] = 1;

6395 
c
 = &
g
->
c_b
[g->
codes
[
code
].
suffix
 * 4];

6396 i(
c
[3] > 128) {

6397 
p
[0] = 
c
[2];

6398 
p
[1] = 
c
[1];

6399 
p
[2] = 
c
[0];

6400 
p
[3] = 
c
[3];

6402 
g
->
cur_x
 += 4;

6404 i(
g
->
cur_x
 >g->
max_x
) {

6405 
g
->
cur_x
 = g->
t_x
;

6406 
g
->
cur_y
 +g->

;

6408 
g
->
cur_y
 >g->
max_y
 && g->
r
 > 0) {

6409 
g
->

 = (1 << g->
r
* g->
le_size
;

6410 
g
->
cur_y
 = g->
t_y
 + (g->

 >> 1);

6411 --
g
->
r
;

6414 
	}
}

6416 
bi_uc
 *
	$bi__oss_gif_
(
bi__cڋxt
 *
s
, 
bi__gif
 *
g
)

6418 
bi_uc
 
lzw_cs
;

6419 
bi__t32
 
n
, 
_code
;

6420 
bi__ut32
 
f
;

6421 
bi__t32
 
codesize
, 
codemask
, 
ava
, 
dcode
, 
bs
, 
vid_bs
, 
r
;

6422 
bi__gif_lzw
 *
p
;

6424 
lzw_cs
 = 
	`bi__g8
(
s
);

6425 i(
lzw_cs
 > 12 
NULL
;

6426 
r
 = 1 << 
lzw_cs
;

6427 
f
 = 1;

6428 
codesize
 = 
lzw_cs
 + 1;

6429 
codemask
 = (1 << 
codesize
) - 1;

6430 
bs
 = 0;

6431 
vid_bs
 = 0;

6432 
_code
 = 0; in_cod< 
r
; init_code++) {

6433 
g
->
codes
[
_code
].
efix
 = -1;

6434 
g
->
codes
[
_code
].
f
 = (
bi_uc
) init_code;

6435 
g
->
codes
[
_code
].
suffix
 = (
bi_uc
) init_code;

6439 
ava
 = 
r
+2;

6440 
dcode
 = -1;

6442 
n
 = 0;

6444 i(
vid_bs
 < 
codesize
) {

6445 i(
n
 == 0) {

6446 
n
 = 
	`bi__g8
(
s
);

6447 i(
n
 == 0)

6448  
g
->
out
;

6450 --
n
;

6451 
bs
 |(
bi__t32

	`bi__g8
(
s
<< 
vid_bs
;

6452 
vid_bs
 += 8;

6454 
bi__t32
 
code
 = 
bs
 & 
codemask
;

6455 
bs
 >>
codesize
;

6456 
vid_bs
 -
codesize
;

6458 i(
code
 =
r
) {

6459 
codesize
 = 
lzw_cs
 + 1;

6460 
codemask
 = (1 << 
codesize
) - 1;

6461 
ava
 = 
r
 + 2;

6462 
dcode
 = -1;

6463 
f
 = 0;

6464 } i(
code
 =
r
 + 1) {

6465 
	`bi__sk
(
s
, 
n
);

6466 (
n
 = 
	`bi__g8
(
s
)) > 0)

6467 
	`bi__sk
(
s
,
n
);

6468  
g
->
out
;

6469 } i(
code
 <
ava
) {

6470 i(
f
) {

6471  
	`bi__uc
("no clear code", "Corrupt GIF");

6474 i(
dcode
 >= 0) {

6475 
p
 = &
g
->
codes
[
ava
++];

6476 i(
ava
 > 8192) {

6477  
	`bi__uc
("too many codes", "Corrupt GIF");

6480 
p
->
efix
 = (
bi__t16

dcode
;

6481 
p
->
f
 = 
g
->
codes
[
dcode
].first;

6482 
p
->
suffix
 = (
code
 =
ava
?->
f
 : 
g
->
codes
[code].first;

6483 } i(
code
 =
ava
)

6484  
	`bi__uc
("illegal code inaster", "Corrupt GIF");

6486 
	`bi__out_gif_code
(
g
, (
bi__ut16

code
);

6488 i((
ava
 & 
codemask
) == 0 &&vail <= 0x0FFF) {

6489 
codesize
++;

6490 
codemask
 = (1 << 
codesize
) - 1;

6493 
dcode
 = 
code
;

6495  
	`bi__uc
("illegal code inaster", "Corrupt GIF");

6499 
	}
}

6503 
bi_uc
 *
	$bi__gif_ld_xt
(
bi__cڋxt
 *
s
, 
bi__gif
 *
g
, *
comp
, 
q_comp
, 
bi_uc
 *
two_back
)

6505 
dio
;

6506 
f_ame
;

6507 
pi
;

6508 
pcou
;

6509 
	`STBI_NOTUSED
(
q_comp
);

6512 
f_ame
 = 0;

6513 i(
g
->
out
 == 0) {

6514 i(!
	`bi__gif_hd
(
s
, 
g
, 
comp
,0))  0;

6515 i(!
	`bi__mad3sizes_vid
(4, 
g
->
w
, g->
h
, 0))

6516  
	`bi__uc
("tooarge", "GIF image isooarge");

6517 
pcou
 = 
g
->
w
 * g->
h
;

6518 
g
->
out
 = (
bi_uc
 *
	`bi__mloc
(4 * 
pcou
);

6519 
g
->
background
 = (
bi_uc
 *
	`bi__mloc
(4 * 
pcou
);

6520 
g
->
hiy
 = (
bi_uc
 *
	`bi__mloc
(
pcou
);

6521 i(!
g
->
out
 || !g->
background
 || !g->
hiy
)

6522  
	`bi__uc
("outofmem", "Out of memory");

6527 
	`memt
(
g
->
out
, 0x00, 4 * 
pcou
);

6528 
	`memt
(
g
->
background
, 0x00, 4 * 
pcou
);

6529 
	`memt
(
g
->
hiy
, 0x00, 
pcou
);

6530 
f_ame
 = 1;

6533 
dio
 = (
g
->
eags
 & 0x1C) >> 2;

6534 
pcou
 = 
g
->
w
 * g->
h
;

6536 i((
dio
 =3&& (
two_back
 == 0)) {

6537 
dio
 = 2;

6540 i(
dio
 == 3) {

6541 
pi
 = 0;< 
pcou
; ++pi) {

6542 i(
g
->
hiy
[
pi
]) {

6543 
	`memy
&
g
->
out
[
pi
 * 4], &
two_back
[pi * 4], 4 );

6546 } i(
dio
 == 2) {

6548 
pi
 = 0;< 
pcou
; ++pi) {

6549 i(
g
->
hiy
[
pi
]) {

6550 
	`memy
&
g
->
out
[
pi
 * 4], &g->
background
[pi * 4], 4 );

6561 
	`memy

g
->
background
, g->
out
, 4 * g->
w
 * g->
h
 );

6565 
	`memt

g
->
hiy
, 0x00, g->
w
 * g->
h
 );

6568 
g
 = 
	`bi__g8
(
s
);

6569 
g
) {

6572 
bi__t32
 
x
, 
y
, 
w
, 
h
;

6573 
bi_uc
 *
o
;

6575 
x
 = 
	`bi__g16
(
s
);

6576 
y
 = 
	`bi__g16
(
s
);

6577 
w
 = 
	`bi__g16
(
s
);

6578 
h
 = 
	`bi__g16
(
s
);

6579 i(((
x
 + 
w
> (
g
->w)|| ((
y
 + 
h
) > (g->h)))

6580  
	`bi__uc
("bad Image Descriptor", "Corrupt GIF");

6582 
g
->
le_size
 = g->
w
 * 4;

6583 
g
->
t_x
 = 
x
 * 4;

6584 
g
->
t_y
 = 
y
 * g->
le_size
;

6585 
g
->
max_x
 = g->
t_x
 + 
w
 * 4;

6586 
g
->
max_y
 = g->
t_y
 + 
h
 * g->
le_size
;

6587 
g
->
cur_x
 = g->
t_x
;

6588 
g
->
cur_y
 = g->
t_y
;

6594 i(
w
 == 0)

6595 
g
->
cur_y
 = g->
max_y
;

6597 
g
->
lags
 = 
	`bi__g8
(
s
);

6599 i(
g
->
lags
 & 0x40) {

6600 
g
->

 = 8 * g->
le_size
;

6601 
g
->
r
 = 3;

6603 
g
->

 = g->
le_size
;

6604 
g
->
r
 = 0;

6607 i(
g
->
lags
 & 0x80) {

6608 
	`bi__gif_r_c܏b
(
s
,
g
->
ͮ
, 2 << (g->
lags
 & 7), g->
eags
 & 0x01 ? g->
t
 : -1);

6609 
g
->
c_b
 = (
bi_uc
 *g->
ͮ
;

6610 } i(
g
->
ags
 & 0x80) {

6611 
g
->
c_b
 = (
bi_uc
 *g->
l
;

6613  
	`bi__uc
("missing colorable", "Corrupt GIF");

6615 
o
 = 
	`bi__oss_gif_
(
s
, 
g
);

6616 i(!
o
 
NULL
;

6619 
pcou
 = 
g
->
w
 * g->
h
;

6620 i(
f_ame
 && (
g
->
bgdex
 > 0)) {

6622 
pi
 = 0;< 
pcou
; ++pi) {

6623 i(
g
->
hiy
[
pi
] == 0) {

6624 
g
->
l
[g->
bgdex
][3] = 255;

6625 
	`memy
&
g
->
out
[
pi
 * 4], &g->
l
[g->
bgdex
], 4 );

6630  
o
;

6635 
n
;

6636 
ext
 = 
	`bi__g8
(
s
);

6637 i(
ext
 == 0xF9) {

6638 
n
 = 
	`bi__g8
(
s
);

6639 i(
n
 == 4) {

6640 
g
->
eags
 = 
	`bi__g8
(
s
);

6641 
g
->
day
 = 10 * 
	`bi__g16
(
s
);

6644 i(
g
->
t
 >= 0) {

6645 
g
->
l
[g->
t
][3] = 255;

6647 i(
g
->
eags
 & 0x01) {

6648 
g
->
t
 = 
	`bi__g8
(
s
);

6649 i(
g
->
t
 >= 0) {

6650 
g
->
l
[g->
t
][3] = 0;

6654 
	`bi__sk
(
s
, 1);

6655 
g
->
t
 = -1;

6658 
	`bi__sk
(
s
, 
n
);

6662 (
n
 = 
	`bi__g8
(
s
)) != 0) {

6663 
	`bi__sk
(
s
, 
n
);

6669  (
bi_uc
 *
s
;

6672  
	`bi__uc
("unknown code", "Corrupt GIF");

6675 
	}
}

6677 *
	$bi__ld_gif_ma
(
bi__cڋxt
 *
s
, **
days
, *
x
, *
y
, *
z
, *
comp
, 
q_comp
)

6679 i(
	`bi__gif_
(
s
)) {

6680 
ys
 = 0;

6681 
bi_uc
 *
u
 = 0;

6682 
bi_uc
 *
out
 = 0;

6683 
bi_uc
 *
two_back
 = 0;

6684 
bi__gif
 
g
;

6685 
ride
;

6686 
	`memt
(&
g
, 0, (g));

6687 i(
days
) {

6688 *
days
 = 0;

6692 
u
 = 
	`bi__gif_ld_xt
(
s
, &
g
, 
comp
, 
q_comp
, 
two_back
);

6693 i(
u
 =(
bi_uc
 *
s
) u = 0;

6695 i(
u
) {

6696 *
x
 = 
g
.
w
;

6697 *
y
 = 
g
.
h
;

6698 ++
ys
;

6699 
ride
 = 
g
.
w
 * g.
h
 * 4;

6701 i(
out
) {

6702 *
tmp
 = (
bi_uc
*
	`STBI_REALLOC

out
, 
ys
 * 
ride
 );

6703 i(
NULL
 =
tmp
) {

6704 
	`STBI_FREE
(
g
.
out
);

6705 
	`STBI_FREE
(
g
.
hiy
);

6706 
	`STBI_FREE
(
g
.
background
);

6707  
	`bi__uc
("outofmem", "Out of memory");

6710 
out
 = (
bi_uc
*
tmp
;

6711 i(
days
) {

6712 *
days
 = (*
	`STBI_REALLOC
*days, (* 
ys
 );

6715 
out
 = (
bi_uc
*)
	`bi__mloc

ys
 * 
ride
 );

6716 i(
days
) {

6717 *
days
 = (*
	`bi__mloc

ys
 * () );

6720 
	`memy

out
 + ((
ys
 - 1* 
ride
), 
u
, stride );

6721 i(
ys
 >= 2) {

6722 
two_back
 = 
out
 - 2 * 
ride
;

6725 i(
days
) {

6726 (*
days
)[
ys
 - 1U] = 
g
.
day
;

6729 } 
u
 != 0);

6732 
	`STBI_FREE
(
g
.
out
);

6733 
	`STBI_FREE
(
g
.
hiy
);

6734 
	`STBI_FREE
(
g
.
background
);

6737 i(
q_comp
 &&eq_comp != 4)

6738 
out
 = 
	`bi__cvt_fm
(out, 4, 
q_comp
, 
ys
 * 
g
.
w
, g.
h
);

6740 *
z
 = 
ys
;

6741  
out
;

6743  
	`bi__uc
("not GIF", "Image wasots gifype.");

6745 
	}
}

6747 *
	$bi__gif_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
)

6749 
bi_uc
 *
u
 = 0;

6750 
bi__gif
 
g
;

6751 
	`memt
(&
g
, 0, (g));

6752 
	`STBI_NOTUSED
(
ri
);

6754 
u
 = 
	`bi__gif_ld_xt
(
s
, &
g
, 
comp
, 
q_comp
, 0);

6755 i(
u
 =(
bi_uc
 *
s
) u = 0;

6756 i(
u
) {

6757 *
x
 = 
g
.
w
;

6758 *
y
 = 
g
.
h
;

6762 i(
q_comp
 &&eq_comp != 4)

6763 
u
 = 
	`bi__cvt_fm
(u, 4, 
q_comp
, 
g
.
w
, g.
h
);

6764 } i(
g
.
out
) {

6766 
	`STBI_FREE
(
g
.
out
);

6770 
	`STBI_FREE
(
g
.
hiy
);

6771 
	`STBI_FREE
(
g
.
background
);

6773  
u
;

6774 
	}
}

6776 
	$bi__gif_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

6778  
	`bi__gif_fo_w
(
s
,
x
,
y
,
comp
);

6779 
	}
}

6785 #ide
STBI_NO_HDR


6786 
	$bi__hdr__ce
(
bi__cڋxt
 *
s
, cڡ *
sigtu
)

6788 
i
;

6789 
i
=0; 
sigtu
[i]; ++i)

6790 i(
	`bi__g8
(
s
!
sigtu
[
i
])

6792 
	`bi__wd
(
s
);

6794 
	}
}

6796 
	$bi__hdr_
(
bi__cڋxt
* 
s
)

6798 
r
 = 
	`bi__hdr__ce
(
s
, "#?RADIANCE\n");

6799 
	`bi__wd
(
s
);

6800 if(!
r
) {

6801 
r
 = 
	`bi__hdr__ce
(
s
, "#?RGBE\n");

6802 
	`bi__wd
(
s
);

6804  
r
;

6805 
	}
}

6807 
	#STBI__HDR_BUFLEN
 1024

	)

6808 *
	$bi__hdr_gtok
(
bi__cڋxt
 *
z
, *
bufr
)

6810 
n
=0;

6811 
c
 = '\0';

6813 
c
 = (
	`bi__g8
(
z
);

6815 !
	`bi___eof
(
z
&& 
c
 != '\n') {

6816 
bufr
[
n
++] = 
c
;

6817 i(
n
 =
STBI__HDR_BUFLEN
-1) {

6819 !
	`bi___eof
(
z
&& 
	`bi__g8
(z) != '\n')

6823 
c
 = (
	`bi__g8
(
z
);

6826 
bufr
[
n
] = 0;

6827  
bufr
;

6828 
	}
}

6830 
	$bi__hdr_cvt
(*
ouut
, 
bi_uc
 *
put
, 
q_comp
)

6832 i
put
[3] != 0 ) {

6833 
f1
;

6835 
f1
 = (
	`ldexp
(1.0f, 
put
[3] - ()(128 + 8));

6836 i(
q_comp
 <= 2)

6837 
ouut
[0] = (
put
[0] + iut[1] + iut[2]* 
f1
 / 3;

6839 
ouut
[0] = 
put
[0] * 
f1
;

6840 
ouut
[1] = 
put
[1] * 
f1
;

6841 
ouut
[2] = 
put
[2] * 
f1
;

6843 i(
q_comp
 =2
ouut
[1] = 1;

6844 i(
q_comp
 =4
ouut
[3] = 1;

6846 
q_comp
) {

6847 4: 
ouut
[3] = 1;

6848 3: 
ouut
[0] = output[1] = output[2] = 0;

6850 2: 
ouut
[1] = 1;

6851 1: 
ouut
[0] = 0;

6855 
	}
}

6857 *
	$bi__hdr_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
)

6859 
bufr
[
STBI__HDR_BUFLEN
];

6860 *
tok
;

6861 
vid
 = 0;

6862 
width
, 
height
;

6863 
bi_uc
 *
sƚe
;

6864 *
hdr_da
;

6865 
n
;

6866 
cou
, 
vue
;

6867 
i
, 
j
, 
k
, 
c1
,
c2
, 
z
;

6868 cڡ *
hdTok
;

6869 
	`STBI_NOTUSED
(
ri
);

6872 
hdTok
 = 
	`bi__hdr_gtok
(
s
,
bufr
);

6873 i(
	`rcmp
(
hdTok
, "#?RADIANCE") != 0 && strcmp(headerToken, "#?RGBE") != 0)

6874  
	`bi__f
("not HDR", "Corrupt HDR image");

6878 
tok
 = 
	`bi__hdr_gtok
(
s
,
bufr
);

6879 i(
tok
[0] == 0) ;

6880 i(
	`rcmp
(
tok
, "FORMAT=32-b_e_rgbe"=0
vid
 = 1;

6883 i(!
vid
 
	`bi__f
("unsupported format", "Unsupported HDR format");

6887 
tok
 = 
	`bi__hdr_gtok
(
s
,
bufr
);

6888 i(
	`cmp
(
tok
, "-Y ", 3) 
	`bi__f
("unsupportediece_dataayout", "Unsupported HDR format");

6889 
tok
 += 3;

6890 
height
 = (
	`
(
tok
, &token, 10);

6891 *
tok
 == ' ') ++token;

6892 i(
	`cmp
(
tok
, "+X ", 3) 
	`bi__f
("unsupportediece_dataayout", "Unsupported HDR format");

6893 
tok
 += 3;

6894 
width
 = (
	`
(
tok
, 
NULL
, 10);

6896 *
x
 = 
width
;

6897 *
y
 = 
height
;

6899 i(
comp
) *comp = 3;

6900 i(
q_comp
 == 0)eq_comp = 3;

6902 i(!
	`bi__mad4sizes_vid
(
width
, 
height
, 
q_comp
, (), 0))

6903  
	`bi__f
("tooarge", "HDR image isooarge");

6906 
hdr_da
 = (*
	`bi__mloc_mad4
(
width
, 
height
, 
q_comp
, (), 0);

6907 i(!
hdr_da
)

6908  
	`bi__f
("outofmem", "Out of memory");

6912 i
width
 < 8 || width >= 32768) {

6914 
j
=0; j < 
height
; ++j) {

6915 
i
=0; i < 
width
; ++i) {

6916 
bi_uc
 
rgbe
[4];

6917 
ma_decode_lo
:

6918 
	`bi__gn
(
s
, 
rgbe
, 4);

6919 
	`bi__hdr_cvt
(
hdr_da
 + 
j
 * 
width
 * 
q_comp
 + 
i
 *eq_comp, 
rgbe
,eq_comp);

6924 
sƚe
 = 
NULL
;

6926 
j
 = 0; j < 
height
; ++j) {

6927 
c1
 = 
	`bi__g8
(
s
);

6928 
c2
 = 
	`bi__g8
(
s
);

6929 
n
 = 
	`bi__g8
(
s
);

6930 i(
c1
 !2 || 
c2
 !2 || (
n
 & 0x80)) {

6933 
bi_uc
 
rgbe
[4];

6934 
rgbe
[0] = (
bi_uc

c1
;

6935 
rgbe
[1] = (
bi_uc

c2
;

6936 
rgbe
[2] = (
bi_uc

n
;

6937 
rgbe
[3] = (
bi_uc

	`bi__g8
(
s
);

6938 
	`bi__hdr_cvt
(
hdr_da
, 
rgbe
, 
q_comp
);

6939 
i
 = 1;

6940 
j
 = 0;

6941 
	`STBI_FREE
(
sƚe
);

6942 
ma_decode_lo
;

6944 
n
 <<= 8;

6945 
n
 |
	`bi__g8
(
s
);

6946 i(
n
 !
width
{ 
	`STBI_FREE
(
hdr_da
); STBI_FREE(
sƚe
);  
	`bi__f
("invalid decoded scanlineength", "corrupt HDR"); }

6947 i(
sƚe
 =
NULL
) {

6948 
sƚe
 = (
bi_uc
 *
	`bi__mloc_mad2
(
width
, 4, 0);

6949 i(!
sƚe
) {

6950 
	`STBI_FREE
(
hdr_da
);

6951  
	`bi__f
("outofmem", "Out of memory");

6955 
k
 = 0; k < 4; ++k) {

6956 
e
;

6957 
i
 = 0;

6958 (
e
 = 
width
 - 
i
) > 0) {

6959 
cou
 = 
	`bi__g8
(
s
);

6960 i(
cou
 > 128) {

6962 
vue
 = 
	`bi__g8
(
s
);

6963 
cou
 -= 128;

6964 i(
cou
 > 
e
{ 
	`STBI_FREE
(
hdr_da
); STBI_FREE(
sƚe
);  
	`bi__f
("corrupt", "bad RLEiece_data in HDR"); }

6965 
z
 = 0; z < 
cou
; ++z)

6966 
sƚe
[
i
++ * 4 + 
k
] = 
vue
;

6969 i(
cou
 > 
e
{ 
	`STBI_FREE
(
hdr_da
); STBI_FREE(
sƚe
);  
	`bi__f
("corrupt", "bad RLEiece_data in HDR"); }

6970 
z
 = 0; z < 
cou
; ++z)

6971 
sƚe
[
i
++ * 4 + 
k
] = 
	`bi__g8
(
s
);

6975 
i
=0; i < 
width
; ++i)

6976 
	`bi__hdr_cvt
(
hdr_da
+(
j
*
width
 + 
i
)*
q_comp
, 
sƚe
 + i*4,eq_comp);

6978 i(
sƚe
)

6979 
	`STBI_FREE
(
sƚe
);

6982  
hdr_da
;

6983 
	}
}

6985 
	$bi__hdr_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

6987 
bufr
[
STBI__HDR_BUFLEN
];

6988 *
tok
;

6989 
vid
 = 0;

6990 
dummy
;

6992 i(!
x
x = &
dummy
;

6993 i(!
y
y = &
dummy
;

6994 i(!
comp
com&
dummy
;

6996 i(
	`bi__hdr_
(
s
) == 0) {

6997 
	`bi__wd

s
 );

7002 
tok
 = 
	`bi__hdr_gtok
(
s
,
bufr
);

7003 i(
tok
[0] == 0) ;

7004 i(
	`rcmp
(
tok
, "FORMAT=32-b_e_rgbe"=0
vid
 = 1;

7007 i(!
vid
) {

7008 
	`bi__wd

s
 );

7011 
tok
 = 
	`bi__hdr_gtok
(
s
,
bufr
);

7012 i(
	`cmp
(
tok
, "-Y ", 3)) {

7013 
	`bi__wd

s
 );

7016 
tok
 += 3;

7017 *
y
 = (
	`
(
tok
, &token, 10);

7018 *
tok
 == ' ') ++token;

7019 i(
	`cmp
(
tok
, "+X ", 3)) {

7020 
	`bi__wd

s
 );

7023 
tok
 += 3;

7024 *
x
 = (
	`
(
tok
, 
NULL
, 10);

7025 *
comp
 = 3;

7027 
	}
}

7030 #ide
STBI_NO_BMP


7031 
	$bi__bmp_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

7033 *
p
;

7034 
bi__bmp_da
 
fo
;

7036 
fo
.
l_a
 = 255;

7037 
p
 = 
	`bi__bmp_r_hd
(
s
, &
fo
);

7038 
	`bi__wd

s
 );

7039 i(
p
 =
NULL
)

7041 i(
x
*x = 
s
->
img_x
;

7042 i(
y
*y = 
s
->
img_y
;

7043 i(
comp
) {

7044 i(
fo
.
b
 =24 && info.
ma
 == 0xff000000)

7045 *
comp
 = 3;

7047 *
comp
 = 
fo
.
ma
 ? 4 : 3;

7050 
	}
}

7053 #ide
STBI_NO_PSD


7054 
	$bi__psd_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

7056 
chlCou
, 
dummy
, 
dth
;

7057 i(!
x
x = &
dummy
;

7058 i(!
y
y = &
dummy
;

7059 i(!
comp
com&
dummy
;

7060 i(
	`bi__g32be
(
s
) != 0x38425053) {

7061 
	`bi__wd

s
 );

7064 i(
	`bi__g16be
(
s
) != 1) {

7065 
	`bi__wd

s
 );

7068 
	`bi__sk
(
s
, 6);

7069 
chlCou
 = 
	`bi__g16be
(
s
);

7070 i(
chlCou
 < 0 || channelCount > 16) {

7071 
	`bi__wd

s
 );

7074 *
y
 = 
	`bi__g32be
(
s
);

7075 *
x
 = 
	`bi__g32be
(
s
);

7076 
dth
 = 
	`bi__g16be
(
s
);

7077 i(
dth
 != 8 && depth != 16) {

7078 
	`bi__wd

s
 );

7081 i(
	`bi__g16be
(
s
) != 3) {

7082 
	`bi__wd

s
 );

7085 *
comp
 = 4;

7087 
	}
}

7089 
	$bi__psd_is16
(
bi__cڋxt
 *
s
)

7091 
chlCou
, 
dth
;

7092 i(
	`bi__g32be
(
s
) != 0x38425053) {

7093 
	`bi__wd

s
 );

7096 i(
	`bi__g16be
(
s
) != 1) {

7097 
	`bi__wd

s
 );

7100 
	`bi__sk
(
s
, 6);

7101 
chlCou
 = 
	`bi__g16be
(
s
);

7102 i(
chlCou
 < 0 || channelCount > 16) {

7103 
	`bi__wd

s
 );

7106 (
	`bi__g32be
(
s
);

7107 (
	`bi__g32be
(
s
);

7108 
dth
 = 
	`bi__g16be
(
s
);

7109 i(
dth
 != 16) {

7110 
	`bi__wd

s
 );

7114 
	}
}

7117 #ide
STBI_NO_PIC


7118 
	$bi__pic_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

7120 
a_comp
=0,
num_cks
=0,
chaed
,
dummy
;

7121 
bi__pic_ck
 
cks
[10];

7123 i(!
x
x = &
dummy
;

7124 i(!
y
y = &
dummy
;

7125 i(!
comp
com&
dummy
;

7127 i(!
	`bi__pic_is4
(
s
,"\x53\x80\xF6\x34")) {

7128 
	`bi__wd
(
s
);

7132 
	`bi__sk
(
s
, 88);

7134 *
x
 = 
	`bi__g16be
(
s
);

7135 *
y
 = 
	`bi__g16be
(
s
);

7136 i(
	`bi___eof
(
s
)) {

7137 
	`bi__wd

s
);

7140 i(*
x
!0 && (1 << 28/ (*x< (*
y
)) {

7141 
	`bi__wd

s
 );

7145 
	`bi__sk
(
s
, 8);

7148 
bi__pic_ck
 *
ck
;

7150 i(
num_cks
==(
cks
)/(packets[0]))

7153 
ck
 = &
cks
[
num_cks
++];

7154 
chaed
 = 
	`bi__g8
(
s
);

7155 
ck
->
size
 = 
	`bi__g8
(
s
);

7156 
ck
->
ty
 = 
	`bi__g8
(
s
);

7157 
ck
->
chl
 = 
	`bi__g8
(
s
);

7158 
a_comp
 |
ck
->
chl
;

7160 i(
	`bi___eof
(
s
)) {

7161 
	`bi__wd

s
 );

7164 i(
ck
->
size
 != 8) {

7165 
	`bi__wd

s
 );

7168 } 
chaed
);

7170 *
comp
 = (
a_comp
 & 0x10 ? 4 : 3);

7173 
	}
}

7188 #ide
STBI_NO_PNM


7190 
	$bi__m_
(
bi__cڋxt
 *
s
)

7192 
p
, 
t
;

7193 
p
 = (
	`bi__g8
(
s
);

7194 
t
 = (
	`bi__g8
(
s
);

7195 i(
p
 !'P' || (
t
 != '5' && != '6')) {

7196 
	`bi__wd

s
 );

7200 
	}
}

7202 *
	$bi__m_ld
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
, 
q_comp
, 
bi__su_fo
 *
ri
)

7204 
bi_uc
 *
out
;

7205 
	`STBI_NOTUSED
(
ri
);

7207 i(!
	`bi__m_fo
(
s
, (*)&s->
img_x
, (*)&s->
img_y
, (*)&s->
img_n
))

7210 *
x
 = 
s
->
img_x
;

7211 *
y
 = 
s
->
img_y
;

7212 i(
comp
*com
s
->
img_n
;

7214 i(!
	`bi__mad3sizes_vid
(
s
->
img_n
, s->
img_x
, s->
img_y
, 0))

7215  
	`bi__uc
("tooarge", "PNMooarge");

7217 
out
 = (
bi_uc
 *
	`bi__mloc_mad3
(
s
->
img_n
, s->
img_x
, s->
img_y
, 0);

7218 i(!
out
 
	`bi__uc
("outofmem", "Out of memory");

7219 
	`bi__gn
(
s
, 
out
, s->
img_n
 * s->
img_x
 * s->
img_y
);

7221 i(
q_comp
 &&eq_com!
s
->
img_n
) {

7222 
out
 = 
	`bi__cvt_fm
(out, 
s
->
img_n
, 
q_comp
, s->
img_x
, s->
img_y
);

7223 i(
out
 =
NULL
)  out;

7225  
out
;

7226 
	}
}

7228 
	$bi__m_isa
(
c
)

7230  
c
 == ' ' || c == '\t' || c == '\n' || c == '\v' || c == '\f' || c == '\r';

7231 
	}
}

7233 
	$bi__m_sk_whea
(
bi__cڋxt
 *
s
, *
c
)

7236 !
	`bi___eof
(
s
&& 
	`bi__m_isa
(*
c
))

7237 *
c
 = (
	`bi__g8
(
s
);

7239 i(
	`bi___eof
(
s
|| *
c
 != '#')

7242 !
	`bi___eof
(
s
&& *
c
 != '\n' && *c != '\r' )

7243 *
c
 = (
	`bi__g8
(
s
);

7245 
	}
}

7247 
	$bi__m_isdig
(
c
)

7249  
c
 >= '0' && c <= '9';

7250 
	}
}

7252 
	$bi__m_gg
(
bi__cڋxt
 *
s
, *
c
)

7254 
vue
 = 0;

7256 !
	`bi___eof
(
s
&& 
	`bi__m_isdig
(*
c
)) {

7257 
vue
 = vue*10 + (*
c
 - '0');

7258 *
c
 = (
	`bi__g8
(
s
);

7261  
vue
;

7262 
	}
}

7264 
	$bi__m_fo
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

7266 
maxv
, 
dummy
;

7267 
c
, 
p
, 
t
;

7269 i(!
x
x = &
dummy
;

7270 i(!
y
y = &
dummy
;

7271 i(!
comp
com&
dummy
;

7273 
	`bi__wd
(
s
);

7276 
p
 = (
	`bi__g8
(
s
);

7277 
t
 = (
	`bi__g8
(
s
);

7278 i(
p
 !'P' || (
t
 != '5' && != '6')) {

7279 
	`bi__wd
(
s
);

7283 *
comp
 = (
t
 == '6') ? 3 : 1;

7285 
c
 = (
	`bi__g8
(
s
);

7286 
	`bi__m_sk_whea
(
s
, &
c
);

7288 *
x
 = 
	`bi__m_gg
(
s
, &
c
);

7289 
	`bi__m_sk_whea
(
s
, &
c
);

7291 *
y
 = 
	`bi__m_gg
(
s
, &
c
);

7292 
	`bi__m_sk_whea
(
s
, &
c
);

7294 
maxv
 = 
	`bi__m_gg
(
s
, &
c
);

7296 i(
maxv
 > 255)

7297  
	`bi__r
("maxi value > 255", "PPM imageot 8-bit");

7300 
	}
}

7303 
	$bi__fo_ma
(
bi__cڋxt
 *
s
, *
x
, *
y
, *
comp
)

7305 #ide
STBI_NO_JPEG


7306 i(
	`bi__jg_fo
(
s
, 
x
, 
y
, 
comp
))  1;

7309 #ide
STBI_NO_PNG


7310 i(
	`bi__g_fo
(
s
, 
x
, 
y
, 
comp
))  1;

7313 #ide
STBI_NO_GIF


7314 i(
	`bi__gif_fo
(
s
, 
x
, 
y
, 
comp
))  1;

7317 #ide
STBI_NO_BMP


7318 i(
	`bi__bmp_fo
(
s
, 
x
, 
y
, 
comp
))  1;

7321 #ide
STBI_NO_PSD


7322 i(
	`bi__psd_fo
(
s
, 
x
, 
y
, 
comp
))  1;

7325 #ide
STBI_NO_PIC


7326 i(
	`bi__pic_fo
(
s
, 
x
, 
y
, 
comp
))  1;

7329 #ide
STBI_NO_PNM


7330 i(
	`bi__m_fo
(
s
, 
x
, 
y
, 
comp
))  1;

7333 #ide
STBI_NO_HDR


7334 i(
	`bi__hdr_fo
(
s
, 
x
, 
y
, 
comp
))  1;

7338 #ide
STBI_NO_TGA


7339 i(
	`bi__tga_fo
(
s
, 
x
, 
y
, 
comp
))

7342  
	`bi__r
("unknown imageype", "Imageot ofny knownype, or corrupt");

7343 
	}
}

7345 
	$bi__is_16_ma
(
bi__cڋxt
 *
s
)

7347 #ide
STBI_NO_PNG


7348 i(
	`bi__g_is16
(
s
))  1;

7351 #ide
STBI_NO_PSD


7352 i(
	`bi__psd_is16
(
s
))  1;

7356 
	}
}

7358 #ide
STBI_NO_STDIO


7359 
STBIDEF
 
	$bi_fo
(cڡ *
fame
, *
x
, *
y
, *
comp
)

7361 
FILE
 *
f
 = 
	`bi__fݒ
(
fame
, "rb");

7362 
su
;

7363 i(!
f
 
	`bi__r
("can't fopen", "Unableo open file");

7364 
su
 = 
	`bi_fo_om_fe
(
f
, 
x
, 
y
, 
comp
);

7365 
	`fo
(
f
);

7366  
su
;

7367 
	}
}

7369 
STBIDEF
 
	$bi_fo_om_fe
(
FILE
 *
f
, *
x
, *
y
, *
comp
)

7371 
r
;

7372 
bi__cڋxt
 
s
;

7373 
pos
 = 
	`l
(
f
);

7374 
	`bi__t_fe
(&
s
, 
f
);

7375 
r
 = 
	`bi__fo_ma
(&
s
,
x
,
y
,
comp
);

7376 
	`fek
(
f
,
pos
,
SEEK_SET
);

7377  
r
;

7378 
	}
}

7380 
STBIDEF
 
	$bi_is_16_b
(cڡ *
fame
)

7382 
FILE
 *
f
 = 
	`bi__fݒ
(
fame
, "rb");

7383 
su
;

7384 i(!
f
 
	`bi__r
("can't fopen", "Unableo open file");

7385 
su
 = 
	`bi_is_16_b_om_fe
(
f
);

7386 
	`fo
(
f
);

7387  
su
;

7388 
	}
}

7390 
STBIDEF
 
	$bi_is_16_b_om_fe
(
FILE
 *
f
)

7392 
r
;

7393 
bi__cڋxt
 
s
;

7394 
pos
 = 
	`l
(
f
);

7395 
	`bi__t_fe
(&
s
, 
f
);

7396 
r
 = 
	`bi__is_16_ma
(&
s
);

7397 
	`fek
(
f
,
pos
,
SEEK_SET
);

7398  
r
;

7399 
	}
}

7402 
STBIDEF
 
	$bi_fo_om_memy
(
bi_uc
 cڡ *
bufr
, 
n
, *
x
, *
y
, *
comp
)

7404 
bi__cڋxt
 
s
;

7405 
	`bi__t_mem
(&
s
,
bufr
,
n
);

7406  
	`bi__fo_ma
(&
s
,
x
,
y
,
comp
);

7407 
	}
}

7409 
STBIDEF
 
	$bi_fo_om_backs
(
bi_io_backs
 cڡ *
c
, *
ur
, *
x
, *
y
, *
comp
)

7411 
bi__cڋxt
 
s
;

7412 
	`bi__t_backs
(&
s
, (
bi_io_backs
 *
c
, 
ur
);

7413  
	`bi__fo_ma
(&
s
,
x
,
y
,
comp
);

7414 
	}
}

7416 
STBIDEF
 
	$bi_is_16_b_om_memy
(
bi_uc
 cڡ *
bufr
, 
n
)

7418 
bi__cڋxt
 
s
;

7419 
	`bi__t_mem
(&
s
,
bufr
,
n
);

7420  
	`bi__is_16_ma
(&
s
);

7421 
	}
}

7423 
STBIDEF
 
	$bi_is_16_b_om_backs
(
bi_io_backs
 cڡ *
c
, *
ur
)

7425 
bi__cڋxt
 
s
;

7426 
	`bi__t_backs
(&
s
, (
bi_io_backs
 *
c
, 
ur
);

7427  
	`bi__is_16_ma
(&
s
);

7428 
	}
}

	@textureAssets.cpp

1 
	~"Memy.h
"

2 
	~"xtuAsts.h
"

4 
	gglm
::
vec4
* 
xtuAsts
::
	$FLOOR_posis
(
Memy
* 
memy
) {

5 
glm
::
vec4
* 
su
 = (glm::vec4*
	`memy_loc
(
memy
,(glm::vec4) * 11);

6 
su
[0] = 
glm
::
	`vec4
(0.000977,0.000977,0.063477,0.063477);

7 
su
[1] = 
glm
::
	`vec4
(0.065430,0.000977,0.127930,0.063477);

8 
su
[2] = 
glm
::
	`vec4
(0.129883,0.000977,0.192383,0.063477);

9 
su
[3] = 
glm
::
	`vec4
(0.194336,0.000977,0.256836,0.063477);

10 
su
[4] = 
glm
::
	`vec4
(0.258789,0.000977,0.321289,0.063477);

11 
su
[5] = 
glm
::
	`vec4
(0.323242,0.000977,0.385742,0.063477);

12 
su
[6] = 
glm
::
	`vec4
(0.387695,0.000977,0.450195,0.063477);

13 
su
[7] = 
glm
::
	`vec4
(0.452148,0.000977,0.514648,0.063477);

14 
su
[8] = 
glm
::
	`vec4
(0.516602,0.000977,0.579102,0.063477);

15 
su
[9] = 
glm
::
	`vec4
(0.581055,0.000977,0.643555,0.063477);

16 
su
[10] = 
glm
::
	`vec4
(0.645508,0.000977,0.708008,0.063477);esult;

17 
	}
}

19 
	gglm
::
vec4
* 
xtuAsts
::
	$PIECE_posis
(
Memy
* 
memy
) {

20 
glm
::
vec4
* 
su
 = (glm::vec4*
	`memy_loc
(
memy
,(glm::vec4) * 14);

21 
su
[0] = 
glm
::
	`vec4
(0.000977,0.000977,0.063477,0.063477);

22 
su
[1] = 
glm
::
	`vec4
(0.065430,0.000977,0.127930,0.063477);

23 
su
[2] = 
glm
::
	`vec4
(0.129883,0.000977,0.192383,0.063477);

24 
su
[3] = 
glm
::
	`vec4
(0.194336,0.000977,0.256836,0.063477);

25 
su
[4] = 
glm
::
	`vec4
(0.258789,0.000977,0.321289,0.063477);

26 
su
[5] = 
glm
::
	`vec4
(0.323242,0.000977,0.385742,0.063477);

27 
su
[6] = 
glm
::
	`vec4
(0.387695,0.000977,0.450195,0.063477);

28 
su
[7] = 
glm
::
	`vec4
(0.452148,0.000977,0.514648,0.063477);

29 
su
[8] = 
glm
::
	`vec4
(0.516602,0.000977,0.579102,0.063477);

30 
su
[9] = 
glm
::
	`vec4
(0.581055,0.000977,0.643555,0.063477);

31 
su
[10] = 
glm
::
	`vec4
(0.645508,0.000977,0.708008,0.063477);

32 
su
[11] = 
glm
::
	`vec4
(0.709961,0.000977,0.772461,0.063477);

33 
su
[12] = 
glm
::
	`vec4
(0.774414,0.000977,0.836914,0.063477);

34 
su
[13] = 
glm
::
	`vec4
(0.838867,0.000977,0.901367,0.063477);esult;

35 
	}
}

37 
	gglm
::
vec4
* 
xtuAsts
::
	$SYMBOLS_posis
(
Memy
* 
memy
) {

38 
glm
::
vec4
* 
su
 = (glm::vec4*
	`memy_loc
(
memy
,(glm::vec4) * 5);

39 
su
[0] = 
glm
::
	`vec4
(0.000977,0.000977,0.063477,0.063477);

40 
su
[1] = 
glm
::
	`vec4
(0.065430,0.000977,0.127930,0.063477);

41 
su
[2] = 
glm
::
	`vec4
(0.129883,0.000977,0.192383,0.063477);

42 
su
[3] = 
glm
::
	`vec4
(0.194336,0.000977,0.256836,0.063477);

43 
su
[4] = 
glm
::
	`vec4
(0.258789,0.000977,0.321289,0.063477);esult;

44 
	}
}

46 
	gglm
::
vec4
* 
xtuAsts
::
	$UI_posis
(
Memy
* 
memy
) {

47 
glm
::
vec4
* 
su
 = (glm::vec4*
	`memy_loc
(
memy
,(glm::vec4) * 7);

48 
su
[0] = 
glm
::
	`vec4
(0.000977,0.000977,0.032227,0.063477);

49 
su
[1] = 
glm
::
	`vec4
(0.034180,0.000977,0.065430,0.063477);

50 
su
[2] = 
glm
::
	`vec4
(0.067383,0.000977,0.098633,0.063477);

51 
su
[3] = 
glm
::
	`vec4
(0.100586,0.000977,0.163086,0.063477);

52 
su
[4] = 
glm
::
	`vec4
(0.165039,0.000977,0.227539,0.063477);

53 
su
[5] = 
glm
::
	`vec4
(0.229492,0.000977,0.291992,0.063477);

54 
su
[6] = 
glm
::
	`vec4
(0.293945,0.000977,0.356445,0.063477);esult;

55 
	}
}

	@textureAssets.h

1 #agm



2 
	~"Mh.h
"

3 
mea
 
	gxtuAsts
 {

4 
	eFLOOR


6 
	gFlo
,

7 
	gGrlC
,

8 
	gGrlH
,

9 
	gOue
,

10 
	gS
,

11 
	gS
,

12 
	gS
,

13 
	gTg
,

14 
	gTick
,

15 
	gZBck
,

16 
	gZBZ


19 
	gglm
::
vec4
* 
FLOOR_posis
(
Memy
* 
memy
);

20 
	ePIECE


22 
	gC
,

23 
	gCrumb
,

24 
	gCurdC
,

25 
	gCurdPy
,

26 
	gCurdPuC
,

27 
	gEmy
,

28 
	gPy
,

29 
	gPuC
,

30 
	gStD
,

31 
	gStL
,

32 
	gStR
,

33 
	gStU
,

34 
	gWl
,

35 
	gWlA


38 
	gglm
::
vec4
* 
PIECE_posis
(
Memy
* 
memy
);

39 
	eSYMBOLS


41 
	gCe
,

42 
	gHfCe
,

43 
	gPlus
,

44 
	gSque
,

45 
	gTrng


48 
	gglm
::
vec4
* 
SYMBOLS_posis
(
Memy
* 
memy
);

49 
	eUI


51 
	gBuCr
,

52 
	gBuLeHf
,

53 
	gBuRightHf
,

54 
	gDownAow
,

55 
	gLeAow
,

56 
	gRightAow
,

57 
	gUpAow


60 
	gglm
::
vec4
* 
UI_posis
(
Memy
* 
memy
);

	@tinyfiledialogs.c

98 #ide
__sun


99 
	#_POSIX_C_SOURCE
 2

	)

102 
	~<dio.h
>

103 
	~<dlib.h
>

104 
	~<rg.h
>

105 
	~<y.h
>

106 
	~<sys/.h
>

108 #ifde
_WIN32


109 #ifde
__BORLANDC__


110 
	#_gch
 
gch


	)

112 #ide
_WIN32_WINNT


113 
	#_WIN32_WINNT
 0x0500

	)

115 #ide
TINYFD_NOLIB


116 
	~<wdows.h
>

117 
	~<commdlg.h
>

118 
	~<shlobj.h
>

120 
	~<cio.h
>

121 
	~<de.h
>

122 
	#TINYFD_NOCCSUNICODE


	)

123 
	#SLASH
 "\\"

	)

125 
	~<lims.h
>

126 
	~<unid.h
>

127 
	~<dt.h
>

128 
	~<rmios.h
>

129 
	~<sys/utame.h
>

130 
	~<sigl.h
>

131 
	#SLASH
 "/"

	)

134 
	~"tyfedlogs.h
"

136 
	#MAX_PATH_OR_CMD
 1024

	)

138 #ide
MAX_MULTIPLE_FILES


139 
	#MAX_MULTIPLE_FILES
 1024

	)

141 
	#LOW_MULTIPLE_FILES
 32

	)

143 cڡ 
	gtyfd_vsi
[8] = "3.6.3";

148 #ifde
_WIN32


151 
	gtyfd_wUtf8
 = 1;

158 
	gtyfd_vbo
 = 0 ;

159 
	gtyfd_st
 = 1 ;

160 cڡ 
	gtyfd_lowCursDlogs
 = 0 ;

162 #i
defed
(
TINYFD_NOLIB
&& defed(
_WIN32
)

163 
	gtyfd_fCse
 = 1 ;

165 
	gtyfd_fCse
 = 0 ;

173 
	gtyfd_ڣ
[1024];

187 #i
defed
(
TINYFD_NOLIB
&& defed(
_WIN32
)

188 
	ggWngDiyed
 = 1 ;

190 
	ggWngDiyed
 = 0 ;

193 cڡ 
	ggT
[]="missing software! (we willry basic console input)";

195 #ifde
_WIN32


196 cڡ 
	gtyfd_eds
[] = "\
___________\n\
/ \\ \n\
|iny file |\n\
| dialogs |\n\
\\_____ ____/\n\
\\|\
\ntiny file dialogs on Windowseeds:\
\n graphic display\
\nor dialog.exe (enhanced console mode)\
\nor console for basic input";

208 cڡ 
	gtyfd_eds
[] = "\
___________\n\
/ \\ \n\
|iny file |\n\
| dialogs |\n\
\\_____ ____/\n\
\\|\
\ntiny file dialogs on UNIXeeds:\
\npplescript\
\nor kdialog\
\nor zenity (or matedialog or qarma)\
\norython (2 or 3)\
\n +kinter +ython-dbus (optional)\
\nor dialog (opens console ifeeded)\
\nor xterm + bash\
\n (opens console for basic input)\
\norxisting console for basic input";

227 #ifde
_MSC_VER


228 #agm
wng
(
dib
:4996)

229 #agm
wng
(
dib
:4100)

230 #agm
wng
(
dib
:4706)

233 * 
	$gCurD
()

235 
lCurD
 [
MAX_PATH_OR_CMD
];

236  
	`gcwd
(
lCurD
, (lCurDir));

237 
	}
}

239 * 
	$gPhWhoutFSsh
(

240 * 
aoDei
,

241 cڡ * 
aSour
)

243 cڡ * 
lTmp
 ;

244 i
aSour
 )

246 
lTmp
 = 
	`chr
(
aSour
, '/');

247 i(!
lTmp
)

249 
lTmp
 = 
	`chr
(
aSour
, '\\');

251 i(
lTmp
)

253 
	`y
(
aoDei
, 
aSour
, 
lTmp
 -Source );

254 
aoDei
[
lTmp
 - 
aSour
] = '\0';

258 * 
aoDei
 = '\0';

263 * 
aoDei
 = '\0';

265  
aoDei
;

266 
	}
}

269 * 
	$gLaName
(

270 * 
aoDei
,

271 cڡ * 
aSour
)

274 cڡ * 
lTmp
 ;

275 i
aSour
 )

277 
lTmp
 = 
	`chr
(
aSour
, '/');

278 i(!
lTmp
)

280 
lTmp
 = 
	`chr
(
aSour
, '\\');

282 i(
lTmp
)

284 
	`ry
(
aoDei
, 
lTmp
 + 1);

288 
	`ry
(
aoDei
, 
aSour
);

293 * 
aoDei
 = '\0';

295  
aoDei
;

296 
	}
}

299 
	$suFSsh
* 
aioSg
 )

301 i
aioSg
 && 
	`
(ioString ) )

303 * 
ϡr
 = 
aioSg
 + 
	`
(ioString ) - 1 ;

304 i
	`cmp

ϡr
 , 
SLASH
 , 1 ) )

306 
	`rt

ϡr
 , 
SLASH
 ) ;

309 
	}
}

312 
	$Hex2RGB
cڡ 
aHexRGB
 [8] ,

313 
aoResuRGB
 [3] )

315 
lCChl
 [8] ;

316 i
aoResuRGB
 )

318 i
aHexRGB
 )

320 
	`ry
(
lCChl
, 
aHexRGB
 ) ;

321 
aoResuRGB
[2] = ()
	`oul
(
lCChl
+5,
NULL
,16);

322 
lCChl
[5] = '\0';

323 
aoResuRGB
[1] = ()
	`oul
(
lCChl
+3,
NULL
,16);

324 
lCChl
[3] = '\0';

325 
aoResuRGB
[0] = ()
	`oul
(
lCChl
+1,
NULL
,16);

330 
aoResuRGB
[0]=0;

331 
aoResuRGB
[1]=0;

332 
aoResuRGB
[2]=0;

335 
	}
}

337 
	$RGB2Hex
cڡ 
aRGB
 [3] ,

338 
aoResuHexRGB
 [8] )

340 i
aoResuHexRGB
 )

342 i
aRGB
 )

344 #i(
	`defed
(
__lulus
 ) && __lulu>201103L|| (defed(
__STDC_VERSION__
&& __STDC_VERSION__ >199901L|| defed(
__g__
)

345 
	`rtf
(
aoResuHexRGB
, "#%02hhx%02hhx%02hhx", 
aRGB
[0],RGB[1],RGB[2]);

347 
	`rtf
(
aoResuHexRGB
, "#%02hx%02hx%02hx", 
aRGB
[0],RGB[1],RGB[2]);

353 
aoResuHexRGB
[0]=0;

354 
aoResuHexRGB
[1]=0;

355 
aoResuHexRGB
[2]=0;

358 
	}
}

361 
	$aSubS
cڡ * 
aSour
 ,

362 cڡ * 
aOldSubS
 ,

363 cڡ * 
aNewSubS
 ,

364 * 
aoDei
 )

366 cڡ * 
pOccun
 ;

367 cڡ * 
p
 ;

368 cڡ * 
lNewSubS
 = "" ;

369 
size_t
 
lOldSubL
 = 
	`

aOldSubS
 ) ;

371 i! 
aSour
 )

373 * 
aoDei
 = '\0' ;

376 i! 
aOldSubS
 )

378 
	`ry

aoDei
 , 
aSour
 ) ;

381 i
aNewSubS
 )

383 
lNewSubS
 = 
aNewSubS
 ;

385 
p
 = 
aSour
 ;

386 * 
aoDei
 = '\0' ;

387  ( 
pOccun
 = 
	`rr

p
 , 
aOldSubS
 ) ) !
NULL
 )

389 
	`t

aoDei
 , 
p
 , 
pOccun
 - ) ;

390 
	`rt

aoDei
 , 
lNewSubS
 ) ;

391 
p
 = 
pOccun
 + 
lOldSubL
 ;

393 
	`rt

aoDei
 , 
p
 ) ;

394 
	}
}

397 
	$fameVid
cڡ * 
aFeNameWhoutPh
 )

399 i! 
aFeNameWhoutPh


400 || ! 
	`
(
aFeNameWhoutPh
)

401 || 
	`brk
(
aFeNameWhoutPh
 , "\\/:*?\"<>|") )

406 
	}
}

408 #ide
_WIN32


410 
	$feExis
cڡ * 
aFePhAndName
 )

412 
FILE
 * 
lIn
 ;

413 i! 
aFePhAndName
 || ! 
	`
(aFilePathAndName) )

417 
lIn
 = 
	`fݒ

aFePhAndName
 , "r" ) ;

418 i! 
lIn
 )

422 
	`fo

lIn
 ) ;

424 
	}
}

426 #i
defed
(
TINYFD_NOLIB
)

428 
	$feExis
cڡ * 
aFePhAndName
 )

430 
FILE
 * 
lIn
 ;

431 i! 
aFePhAndName
 || ! 
	`
(aFilePathAndName) )

436 i
tyfd_wUtf8
 )

439 
lIn
 = 
	`fݒ

aFePhAndName
 , "r" ) ;

440 i! 
lIn
 )

444 
	`fo

lIn
 ) ;

446 
	}
}

451 
	$wefe
(cڡ * 
aFame
)

453 
i
;

454 

 

;

455 
FILE
 * 
lIn
;

457 i(
	`
(
aFame
, &

) == 0)

459 i((
lIn
 = 
	`fݒ
(
aFame
, "w")))

461 
i
 = 0; i < 

.
_size
; i++)

463 
	`utc
('A', 
lIn
);

466 
	`fo
(
lIn
);

468 
	}
}

471 #ifde
_WIN32


474 
	$tyfd_tWUtf8
(
aIsUtf8
)

476 
tyfd_wUtf8
 = 
aIsUtf8
;

477 
	}
}

480 
	$aChr
* 
aSg
 ,

481 
aOldChr
 ,

482 
aNewChr
 )

484 * 
p
 ;

485 
lRes
 = 0 ;

487 i! 
aSg
 )

492 i
aOldChr
 =
aNewChr
 )

497 
p
 = 
aSg
 ;

498  (
p
 = 
	`rchr
а, 
aOldChr
 )) )

500 * 
p
 = 
aNewChr
 ;

501 
p
 ++ ;

502 
lRes
 = 1 ;

504  
lRes
 ;

505 
	}
}

508 #i!
defed
(
WC_ERR_INVALID_CHARS
)

510 
	#WC_ERR_INVALID_CHARS
 0x00000080

	)

513 
	$sizeUtf16From8
(cڡ * 
aUtf8rg
)

515  
	`MuiByToWideCh
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
,

516 
aUtf8rg
, -1, 
NULL
, 0);

517 
	}
}

520 
	$sizeUtf16FromMbcs
(cڡ * 
aMbcsSg
)

522  
	`MuiByToWideCh
(
CP_ACP
, 
MB_ERR_INVALID_CHARS
,

523 
aMbcsSg
, -1, 
NULL
, 0);

524 
	}
}

527 
	$sizeUtf8
(
wch_t
 cڡ * 
aUtf16rg
)

529  
	`WideChToMuiBy
(
CP_UTF8
, 
WC_ERR_INVALID_CHARS
,

530 
aUtf16rg
, -1, 
NULL
, 0, NULL, NULL);

531 
	}
}

534 
	$sizeMbcs
(
wch_t
 cڡ * 
aMbcsSg
)

536 
lRes
 = 
	`WideChToMuiBy
(
CP_ACP
, 0,

537 
aMbcsSg
, -1, 
NULL
, 0, NULL, NULL);

539  
lRes
;

540 
	}
}

543 
wch_t
 * 
	$tyfd_utf8to16
(cڡ * 
aUtf8rg
)

545 
wch_t
 * 
lUtf16rg
 = 
NULL
;

546 
lSize
;

548 
	`
(
lUtf16rg
);

549 i(!
aUtf8rg
{
lUtf16rg
 = 
NULL
;  NULL;}

550 
lSize
 = 
	`sizeUtf16From8
(
aUtf8rg
);

551 
lUtf16rg
 = (
wch_t
 *)
	`mloc
(
lSize
 * (wchar_t));

552 
lSize
 = 
	`MuiByToWideCh
(
CP_UTF8
, 
MB_ERR_INVALID_CHARS
,

553 
aUtf8rg
, -1, 
lUtf16rg
, 
lSize
);

554 i(
lSize
 == 0)

556 
	`
(
lUtf16rg
);

557 
lUtf16rg
 = 
NULL
;

559  
lUtf16rg
;

560 
	}
}

563 * 
	$utf16toMbcs
(
wch_t
 cڡ * 
aUtf16rg
)

565 * 
lMbcsSg
 = 
NULL
;

566 
lSize
;

568 
	`
(
lMbcsSg
);

569 i(!
aUtf16rg
{ 
lMbcsSg
 = 
NULL
;  NULL; }

570 
lSize
 = 
	`sizeMbcs
(
aUtf16rg
);

571 
lMbcsSg
 = (*)
	`mloc
(
lSize
);

572 
lSize
 = 
	`WideChToMuiBy
(
CP_ACP
, 0,

573 
aUtf16rg
, -1, 
lMbcsSg
, 
lSize
, 
NULL
, NULL);

574 i(
lSize
 == 0)

576 
	`
(
lMbcsSg
);

577 
lMbcsSg
 = 
NULL
;

579  
lMbcsSg
;

580 
	}
}

583 * 
	$tyfd_utf8toMbcs
(cڡ * 
aUtf8rg
)

585 
wch_t
 cڡ * 
lUtf16rg
;

586 
lUtf16rg
 = 
	`tyfd_utf8to16
(
aUtf8rg
);

587  
	`utf16toMbcs
(
lUtf16rg
);

588 
	}
}

590 
wch_t
 * 
	$mbcsTo16
(cڡ * 
aMbcsSg
)

592 
wch_t
 * 
lMbcsSg
 = 
NULL
;

593 
lSize
;

595 
	`
(
lMbcsSg
);

596 i(!
aMbcsSg
{ 
lMbcsSg
 = 
NULL
;  NULL; }

597 
lSize
 = 
	`sizeUtf16FromMbcs
(
aMbcsSg
);

598 
lMbcsSg
 = (
wch_t
 *)
	`mloc
(
lSize
 * (wchar_t));

599 
lSize
 = 
	`MuiByToWideCh
(
CP_ACP
, 0,

600 
aMbcsSg
, -1, 
lMbcsSg
, 
lSize
);

601 i(
lSize
 == 0)

603 
	`
(
lMbcsSg
);

604 
lMbcsSg
 = 
NULL
;

606  
lMbcsSg
;

607 
	}
}

610 * 
	$tyfd_utf16to8
(
wch_t
 cڡ * 
aUtf16rg
)

612 * 
lUtf8rg
 = 
NULL
;

613 
lSize
;

615 
	`
(
lUtf8rg
);

616 i(!
aUtf16rg
{ 
lUtf8rg
 = 
NULL
;  NULL; }

617 
lSize
 = 
	`sizeUtf8
(
aUtf16rg
);

618 
lUtf8rg
 = (*)
	`mloc
(
lSize
);

619 
lSize
 = 
	`WideChToMuiBy
(
CP_UTF8
, 
WC_ERR_INVALID_CHARS
,

620 
aUtf16rg
, -1, 
lUtf8rg
, 
lSize
, 
NULL
, NULL);

621 i(
lSize
 == 0)

623 
	`
(
lUtf8rg
);

624 
lUtf8rg
 = 
NULL
;

626  
lUtf8rg
;

627 
	}
}

630 * 
	$mbcsTo8
(cڡ * 
aMbcsSg
)

632 
wch_t
 cڡ * 
lUtf16rg
;

633 
lUtf16rg
 = 
	`mbcsTo16
(
aMbcsSg
);

634  
	`tyfd_utf16to8
(
lUtf16rg
);

635 
	}
}

638 #ifde
TINYFD_NOLIB


640 
	$dExis
(cڡ * 
aDPh
)

642 

 
lInfo
;

644 i(!
aDPh
 || !
	`
(aDirPath))

646 i(
	`
(
aDPh
, &
lInfo
) != 0)

648 i
tyfd_wUtf8
 )

650 i(
lInfo
.
_mode
 & 
S_IFDIR
)

654 
	}
}

657 
	$tyfd_bp
()

659 
	`tf
("\a");

660 
	}
}

664 
	$tyfd_bp
()

666 
	`Bp
(440,300);

667 
	}
}

670 
	$wefeW
(
wch_t
 cڡ * 
aFame
)

672 
i
;

673 
_
 

;

674 
FILE
 * 
lIn
;

676 i(
	`_w
(
aFame
, &

) == 0)

678 i((
lIn
 = 
	`_wfݒ
(
aFame
, 
L
"w")))

680 
i
 = 0; i < 

.
_size
; i++)

682 
	`utc
('A', 
lIn
);

685 
	`fo
(
lIn
);

687 
	}
}

690 
wch_t
 * 
	$gPhWhoutFSshW
(

691 
wch_t
 * 
aoDei
,

692 
wch_t
 cڡ * 
aSour
)

694 
wch_t
 cڡ * 
lTmp
;

695 i(
aSour
)

697 
lTmp
 = 
	`wcchr
(
aSour
, 
L
'/');

698 i(!
lTmp
)

700 
lTmp
 = 
	`wcchr
(
aSour
, 
L
'\\');

702 i(
lTmp
)

704 
	`wcy
(
aoDei
, 
aSour
, 
lTmp
 -Source);

705 
aoDei
[
lTmp
 - 
aSour
] = 
L
'\0';

709 *
aoDei
 = 
L
'\0';

714 *
aoDei
 = 
L
'\0';

716  
aoDei
;

717 
	}
}

720 
wch_t
 * 
	$gLaNameW
(

721 
wch_t
 * 
aoDei
,

722 
wch_t
 cڡ * 
aSour
)

725 
wch_t
 cڡ * 
lTmp
;

726 i(
aSour
)

728 
lTmp
 = 
	`wcchr
(
aSour
, 
L
'/');

729 i(!
lTmp
)

731 
lTmp
 = 
	`wcchr
(
aSour
, 
L
'\\');

733 i(
lTmp
)

735 
	`wcsy
(
aoDei
, 
lTmp
 + 1);

739 
	`wcsy
(
aoDei
, 
aSour
);

744 *
aoDei
 = 
L
'\0';

746  
aoDei
;

747 
	}
}

750 
	$Hex2RGBW
(
wch_t
 cڡ 
aHexRGB
[8],

751 
aoResuRGB
[3])

753 
wch_t
 
lCChl
[8];

754 i(
aoResuRGB
)

756 i(
aHexRGB
)

758 
	`wcsy
(
lCChl
, 
aHexRGB
);

759 
aoResuRGB
[2] = ()
	`wcoul
(
lCChl
 + 5, 
NULL
, 16);

760 
lCChl
[5] = '\0';

761 
aoResuRGB
[1] = ()
	`wcoul
(
lCChl
 + 3, 
NULL
, 16);

762 
lCChl
[3] = '\0';

763 
aoResuRGB
[0] = ()
	`wcoul
(
lCChl
 + 1, 
NULL
, 16);

768 
aoResuRGB
[0] = 0;

769 
aoResuRGB
[1] = 0;

770 
aoResuRGB
[2] = 0;

773 
	}
}

776 
	$RGB2HexW
(

777 cڡ 
aRGB
[3],

778 
wch_t
 
aoResuHexRGB
[8])

780 i(
aoResuHexRGB
)

782 i(
aRGB
)

785 
	`swtf
(
aoResuHexRGB
,

786 #i!
	`defed
(
__BORLANDC__
&& !defed(
__TINYC__
&& ( !defed(
__GNUC__
) || (__GNUC__) >= 5 )

790 #i(
	`defed
(
__lulus
 ) && __lulu>201103L|| (defed(
__STDC_VERSION__
&& __STDC_VERSION__ >199901L|| defed(
__g__
)

791 
L
"#%02hhx%02hhx%02hhx", 
aRGB
[0],RGB[1],RGB[2]);

793 
L
"#%02hx%02hx%02hx", 
aRGB
[0],RGB[1],RGB[2]);

798 
aoResuHexRGB
[0] = 0;

799 
aoResuHexRGB
[1] = 0;

800 
aoResuHexRGB
[2] = 0;

803 
	}
}

806 
	$dExis
(cڡ * 
aDPh
)

808 
_
 
lInfo
;

809 
wch_t
 * 
lTmpWCh
;

810 
lStR
;

811 
lDL
;

813 i(!
aDPh
)

815 
lDL
 = 
	`
(
aDPh
);

816 i(!
lDL
)

818 i(
lDL
 =2&& (
aDPh
[1] == ':') )

821 i(
tyfd_wUtf8
)

823 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aDPh
);

824 
lStR
 = 
	`_w
(
lTmpWCh
, &
lInfo
);

825 i(
lStR
 != 0)

827 i(
lInfo
.
_mode
 & 
S_IFDIR
)

832 i(
	`_
(
aDPh
, &
lInfo
) != 0)

834 i(
lInfo
.
_mode
 & 
S_IFDIR
)

838 
	}
}

841 
	$feExis
(cڡ * 
aFePhAndName
)

843 
_
 
lInfo
;

844 
wch_t
 * 
lTmpWCh
;

845 
lStR
;

846 
FILE
 * 
lIn
;

848 i(!
aFePhAndName
 || !
	`
(aFilePathAndName))

853 i(
tyfd_wUtf8
)

855 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aFePhAndName
);

856 
lStR
 = 
	`_w
(
lTmpWCh
, &
lInfo
);

857 i(
lStR
 != 0)

859 i(
lInfo
.
_mode
 & 
_S_IFREG
)

866 
lIn
 = 
	`fݒ
(
aFePhAndName
, "r");

867 i(!
lIn
)

871 
	`fo
(
lIn
);

874 
	}
}

876 
	$aWch
(
wch_t
 * 
aSg
,

877 
wch_t
 
aOldChr
,

878 
wch_t
 
aNewChr
)

880 
wch_t
 * 
p
;

881 
lRes
 = 0;

883 i(!
aSg
)

888 i(
aOldChr
 =
aNewChr
)

893 
p
 = 
aSg
;

894 (
p
 = 
	`wcchr
, 
aOldChr
)))

896 *
p
 = 
aNewChr
;

897 #ifde
TINYFD_NOCCSUNICODE


898 
p
++;

900 
p
++;

901 
lRes
 = 1;

903  
lRes
;

904 
	}
}

910 * 
	$suFesExi
(* 
aDei
,

911 cڡ * 
aSourPhsAndNames
)

913 * 
lDei
 = 
aDei
;

914 cڡ * 
p
;

915 cڡ * 
p2
;

916 
size_t
 
lL
;

918 i(!
aSourPhsAndNames
)

920  
NULL
;

922 
lL
 = 
	`
(
aSourPhsAndNames
);

923 i(!
lL
)

925  
NULL
;

928 
p
 = 
aSourPhsAndNames
;

929 (
p2
 = 
	`rchr
(
p
, '|')!
NULL
)

931 
lL
 = 
p2
 - 
p
;

932 
	`memmove
(
lDei
, 
p
, 
lL
);

933 
lDei
[
lL
] = '\0';

934 i(
	`feExis
(
lDei
))

936 
lDei
 +
lL
;

937 *
lDei
 = '|';

938 
lDei
++;

940 
p
 = 
p2
 + 1;

942 i(
	`feExis
(
p
))

944 
lL
 = 
	`
(
p
);

945 
	`memmove
(
lDei
, 
p
, 
lL
);

946 
lDei
[
lL
] = '\0';

950 *(
lDei
 - 1) = '\0';

952  
aDei
;

953 
	}
}

955 #ifde
_WIN32


956 #ide
TINYFD_NOLIB


958 
__d
 
	$EnumThadWndProc
(
HWND
 
hwnd
, 
LPARAM
 
lPam
)

960 
wch_t
 
lTName
[
MAX_PATH
];

961 
	`GWdowTextW
(
hwnd
, 
lTName
, 
MAX_PATH
);

963 i(
	`wcscmp
(
L
"tyfedlogsTWdow", 
lTName
) == 0)

965 
	`SWdowPos
(
hwnd
, 
HWND_TOPMOST
, 0, 0, 0, 0, 
SWP_NOMOVE
 | 
SWP_NOSIZE
);

969 
	}
}

972 
	$hiddCseW
(
wch_t
 cڡ * 
aSg
, wch_cڡ * 
aDlogT
, 
aInFrt
)

974 
STARTUPINFOW
 
SupInfo
;

975 
PROCESS_INFORMATION
 
ProssInfo
;

977 i(!
aSg
 || !
	`wc
(aString) ) ;

979 
	`memt
(&
SupInfo
, 0, (StartupInfo));

980 
SupInfo
.
cb
 = (
STARTUPINFOW
);

981 
SupInfo
.
dwFgs
 = 
STARTF_USESHOWWINDOW
;

982 
SupInfo
.
wShowWdow
 = 
SW_HIDE
;

984 i(!
	`CeProssW
(
NULL
, (
LPWSTR
)
aSg
, NULL, NULL, 
FALSE
,

985 
CREATE_NEW_CONSOLE
, 
NULL
, NULL,

986 &
SupInfo
, &
ProssInfo
))

991 
	`WaFIutId
(
ProssInfo
.
hPross
, 
INFINITE
);

992 i(
aInFrt
)

994 
	`EnumWdows
(
EnumThadWndProc
, (
LPARAM
)
NULL
)) {}

995 
	`SWdowTextW
(
	`GFegroundWdow
(), 
aDlogT
);

997 
	`WaFSgObje
(
ProssInfo
.
hPross
, 
INFINITE
);

998 
	`CloHd
(
ProssInfo
.
hThad
);

999 
	`CloHd
(
ProssInfo
.
hPross
);

1000 
	}
}

1003 
	$tyfd_mesgeBoxW
(

1004 
wch_t
 cڡ * 
aT
,

1005 
wch_t
 cڡ * 
aMesge
,

1006 
wch_t
 cڡ * 
aDlogTy
,

1007 
wch_t
 cڡ * 
aIcTy
,

1008 
aDeuBu
)

1010 
lBoxRuVue
;

1011 
UINT
 
aCode
;

1013 i(
aT
&&!
	`wcscmp
T, 
L
"tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "windows_wchar");  1; }

1015 i(
aIcTy
 && !
	`wcscmp
(
L
"warning",IconType))

1017 
aCode
 = 
MB_ICONWARNING
;

1019 i(
aIcTy
 && !
	`wcscmp
(
L
"error",IconType))

1021 
aCode
 = 
MB_ICONERROR
;

1023 i(
aIcTy
 && !
	`wcscmp
(
L
"question",IconType))

1025 
aCode
 = 
MB_ICONQUESTION
;

1029 
aCode
 = 
MB_ICONINFORMATION
;

1032 i(
aDlogTy
 && !
	`wcscmp
(
L
"okcancel",DialogType))

1034 
aCode
 +
MB_OKCANCEL
;

1035 i(!
aDeuBu
)

1037 
aCode
 +
MB_DEFBUTTON2
;

1040 i(
aDlogTy
 && !
	`wcscmp
(
L
"yesno",DialogType))

1042 
aCode
 +
MB_YESNO
;

1043 i(!
aDeuBu
)

1045 
aCode
 +
MB_DEFBUTTON2
;

1050 
aCode
 +
MB_OK
;

1053 
aCode
 +
MB_TOPMOST
;

1055 
lBoxRuVue
 = 
	`MesgeBoxW
(
	`GFegroundWdow
(), 
aMesge
, 
aT
, 
aCode
);

1056 i(((
aDlogTy


1057 && 
	`wcscmp
(
L
"oknl", 
aDlogTy
)

1058 && 
	`wcscmp
(
L
"yeo", 
aDlogTy
)))

1059 || (
lBoxRuVue
 =
IDOK
)

1060 || (
lBoxRuVue
 =
IDYES
))

1068 
	}
}

1071 
	$mesgeBoxWGui8
(

1072 cڡ * 
aT
,

1073 cڡ * 
aMesge
,

1074 cڡ * 
aDlogTy
,

1075 cڡ * 
aIcTy
,

1076 
aDeuBu
)

1078 
lIRV
;

1079 
wch_t
 
lT
 [128] = 
L
"";

1080 
wch_t
 * 
lMesge
 = 
NULL
;

1081 
wch_t
 
lDlogTy
 [16] = 
L
"";

1082 
wch_t
 
lIcTy
 [16] = 
L
"";

1083 
wch_t
 * 
lTmpWCh
;

1085 i(
aT
)

1087 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aT
);

1088 
	`wcsy
(
lT
, 
lTmpWCh
);

1090 i(
aMesge
)

1092 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aMesge
);

1093 
lMesge
 = 
	`mloc
((
	`wc
(
lTmpWCh
+ 1)* (
wch_t
));

1094 
	`wcsy
(
lMesge
, 
lTmpWCh
);

1096 i(
aDlogTy
)

1098 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aDlogTy
);

1099 
	`wcsy
(
lDlogTy
, 
lTmpWCh
);

1101 i(
aIcTy
)

1103 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aIcTy
);

1104 
	`wcsy
(
lIcTy
, 
lTmpWCh
);

1107 
lIRV
 = 
	`tyfd_mesgeBoxW
(
lT
, 
lMesge
,
lDlogTy
, 
lIcTy
, 
aDeuBu
 );

1109 
	`
(
lMesge
);

1111  
lIRV
 ;

1112 
	}
}

1116 
	$tyfd_nifyPupW
(

1117 
wch_t
 cڡ * 
aT
,

1118 
wch_t
 cڡ * 
aMesge
,

1119 
wch_t
 cڡ * 
aIcTy
)

1121 
wch_t
 * 
lDlogSg
;

1122 
size_t
 
lTL
;

1123 
size_t
 
lMesgeL
;

1124 
size_t
 
lDlogSgL
;

1126 i(
aT
&&!
	`wcscmp
T, 
L
"tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "windows_wchar");  1; }

1128 
lTL
 = 
aT
 ? 
	`wc
(aTitle) : 0;

1129 
lMesgeL
 = 
aMesge
 ? 
	`wc
(aMessage) : 0;

1130 
lDlogSgL
 = 3 * 
MAX_PATH_OR_CMD
 + 
lTL
 + 
lMesgeL
;

1131 
lDlogSg
 = (
wch_t
 *)
	`mloc
(2 * 
lDlogSgL
);

1133 
	`wcsy
(
lDlogSg
, 
L
"powershell.exe -command \"\
 Show-BalloonTip {\
[cmdletbinding()] \
( \
[string]$Title = ' ', \
[string]$Message = ' ', \
[ValidateSet('info', 'warning', 'error')] \
[string]$IconType = 'info');\
[system.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms') | Out-Null ; \
$balloon = New-Object System.Windows.Forms.NotifyIcon ; \
$path = Get-Process -id $pid | Select-Object -ExpandProperty Path ; \
$icon = [System.Drawing.Icon]::ExtractAssociatedIcon($path) ;");

1146 
	`wcst
(
lDlogSg
, 
L
"\
$balloon.Icon = $icon ; \
$balloon.BalloonTipIcon = $IconType ; \
$balloon.BalloonTipText = $Message ; \
$balloon.BalloonTipTitle = $Title ; \
$balloon.Text = 'lalala' ; \
$balloon.Visible = $true ; \
$balloon.ShowBalloonTip(5000)};\
-BalloonTip");

1156 i(
aT
 && 
	`wc
(aTitle))

1158 
	`wcst
(
lDlogSg
, 
L
" -Title '");

1159 
	`wcst
(
lDlogSg
, 
aT
);

1160 
	`wcst
(
lDlogSg
, 
L
"'");

1162 i(
aMesge
 && 
	`wc
(aMessage))

1164 
	`wcst
(
lDlogSg
, 
L
" -Message '");

1165 
	`wcst
(
lDlogSg
, 
aMesge
);

1166 
	`wcst
(
lDlogSg
, 
L
"'");

1168 i(
aMesge
 && 
	`wc
(
aIcTy
))

1170 
	`wcst
(
lDlogSg
, 
L
" -IconType '");

1171 
	`wcst
(
lDlogSg
, 
aIcTy
);

1172 
	`wcst
(
lDlogSg
, 
L
"'");

1174 
	`wcst
(
lDlogSg
, 
L
"\"");

1178 
	`hiddCseW
(
lDlogSg
, 
aT
, 0);

1179 
	`
(
lDlogSg
);

1181 
	}
}

1184 
	$nifyWGui
(

1185 cڡ * 
aT
,

1186 cڡ * 
aMesge
,

1187 cڡ * 
aIcTy
)

1189 
wch_t
 
lT
 [128] = 
L
"";

1190 
wch_t
 * 
lMesge
 = 
NULL
;

1191 
wch_t
 
lIcTy
[16] = 
L
"";

1192 
wch_t
 * 
lTmpWCh
;

1194 i(
tyfd_wUtf8
)

1196 i(
aT
)

1198 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aT
);

1199 
	`wcsy
(
lT
, 
lTmpWCh
);

1201 i(
aMesge
)

1203 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aMesge
);

1204 
lMesge
 = 
	`mloc
((
	`wc
(
lTmpWCh
+ 1)* (
wch_t
));

1205 
	`wcsy
(
lMesge
, 
lTmpWCh
);

1207 i(
aIcTy
)

1209 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aIcTy
);

1210 
	`wcsy
(
lIcTy
, 
lTmpWCh
);

1215 i(
aT
)

1217 
lTmpWCh
 = 
	`mbcsTo16
(
aT
);

1218 
	`wcsy
(
lT
, 
lTmpWCh
);

1220 i(
aMesge
)

1222 
lTmpWCh
 = 
	`mbcsTo16
(
aMesge
);

1223 
lMesge
 = 
	`mloc
((
	`wc
(
lTmpWCh
+ 1)* (
wch_t
));

1224 
	`wcsy
(
lMesge
, 
lTmpWCh
);

1226 i(
aIcTy
)

1228 
lTmpWCh
 = 
	`mbcsTo16
(
aIcTy
);

1229 
	`wcsy
(
lIcTy
, 
lTmpWCh
);

1233 
	`tyfd_nifyPupW

lT
, 
lMesge
, 
lIcTy
);

1235 
	`
(
lMesge
);

1238 
	}
}

1241 
wch_t
 * 
	$tyfd_putBoxW
(

1242 
wch_t
 cڡ * 
aT
,

1243 
wch_t
 cڡ * 
aMesge
,

1244 
wch_t
 cڡ * 
aDeuIut
)

1246 
wch_t
 
lBuff
[
MAX_PATH_OR_CMD
];

1247 
wch_t
 * 
lDlogSg
;

1248 
FILE
 * 
lIn
;

1249 
FILE
 * 
lFe
;

1250 
lResu
;

1251 
size_t
 
lTL
;

1252 
size_t
 
lMesgeL
;

1253 
size_t
 
lDlogSgL
;

1255 i(
aT
&&!
	`wcscmp
T, 
L
"tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "wdows_wch");  (
wch_t
 *)1; }

1257 
lTL
 = 
aT
 ? 
	`wc
(aTitle) : 0 ;

1258 
lMesgeL
 = 
aMesge
 ? 
	`wc
(aMessage) : 0 ;

1259 
lDlogSgL
 = 3 * 
MAX_PATH_OR_CMD
 + 
lTL
 + 
lMesgeL
;

1260 
lDlogSg
 = (
wch_t
 *)
	`mloc
(2 * 
lDlogSgL
);

1262 i(
aDeuIut
)

1264 
	`swtf
(
lDlogSg
,

1265 #i!
	`defed
(
__BORLANDC__
&& !defed(
__TINYC__
&& ( !defed(
__GNUC__
) || (__GNUC__) >= 5 )

1266 
lDlogSgL
,

1268 
L
"%ls\\ADa\\Lol\\Temp\\tyfd.vbs", 
	`_wgv
(L"USERPROFILE"));

1272 
	`swtf
(
lDlogSg
,

1273 #i!
	`defed
(
__BORLANDC__
&& !defed(
__TINYC__
&& ( !defed(
__GNUC__
) || (__GNUC__) >= 5 )

1274 
lDlogSgL
,

1276 
L
"%ls\\ADa\\Lol\\Temp\\tyfd.h", 
	`_wgv
(L"USERPROFILE"));

1278 
lIn
 = 
	`_wfݒ
(
lDlogSg
, 
L
"w");

1279 i(!
lIn
)

1281 
	`
(
lDlogSg
);

1282  
NULL
;

1285 i
aDeuIut
 )

1287 
	`wcsy
(
lDlogSg
, 
L
"Dimesult:result=InputBox(\"");

1288 i(
aMesge
 && 
	`wc
(aMessage))

1290 
	`wcsy
(
lBuff
, 
aMesge
);

1291 
	`aWch
(
lBuff
, 
L
'\n', L' ');

1292 
	`wcst
(
lDlogSg
, 
lBuff
);

1294 
	`wcst
(
lDlogSg
, 
L
"\",\"tinyfiledialogsTopWindow\",\"");

1295 i(
aDeuIut
 && 
	`wc
(aDefaultInput))

1297 
	`wcsy
(
lBuff
, 
aDeuIut
);

1298 
	`aWch
(
lBuff
, 
L
'\n', L' ');

1299 
	`wcst
(
lDlogSg
, 
lBuff
);

1301 
	`wcst
(
lDlogSg
, 
L
"\"):If IsEmpty(result)hen:WScript.Echo 0");

1302 
	`wcst
(
lDlogSg
, 
L
":Else: WScript.Echo \"1\" &esult : End If");

1306 
	`wcsy
(
lDlogSg
, 
L
"\n\
<html>\n\
<head>\n\
<title>");

1311 
	`wcst
(
lDlogSg
, 
L
"tinyfiledialogsTopWindow");

1312 
	`wcst
(
lDlogSg
, 
L
"</title>\n\
<HTA:APPLICATION\n\
 = 'tinyfdHTA'\n\
 = 'tinyfd_inputBox'\n\
 = 'no'\n\
 = 'no'\n\
 = 'dialog'\n\
 = 'no'\n\
 = 'yes'\n\
 = 'hidden'>\n\
\n\
<scriptanguage = 'VBScript'>\n\
\n\
 = Screen.Width/4\n\
 = Screen.Height/6\n\
 intWidth, intHeight\n\
((Screen.Width/2)-(intWidth/2)),((Screen.Height/2)-(intHeight/2))\n\
 = 0\n\
\n\
 Window_onLoad\n\
_input.Focus\n\
 Sub\n\
\n");

1336 
	`wcst
(
lDlogSg
, 
L
"\
 Window_onUnload\n\
 objFSO = CreateObject(\"Scripting.FileSystemObject\")\n\
 oShell = CreateObject(\"WScript.Shell\")\n\
 = oShell.ExpandEnvironmentStrings(\"%USERPROFILE%\")\n\
 objFile = objFSO.CreateTextFile(strHomeFolder & \"\\AppData\\Local\\Temp\\tinyfd.txt\",True,True)\n\
esult = 1 Then\n\
.Write 1 &xt_input.Value\n\
\n\
.Write 0\n\
 If\n\
.Close\n\
 Sub\n\
\n\
 Run_ProgramOK\n\
 = 1\n\
.Close\n\
 Sub\n\
\n\
 Run_ProgramCancel\n\
.Close\n\
 Sub\n\
\n");

1360 
	`wcst
(
lDlogSg
, 
L
"Sub Default_Buttons\n\
 Window.Event.KeyCode = 13 Then\n\
_OK.Click\n\
 Window.Event.KeyCode = 27 Then\n\
_Cancel.Click\n\
 If\n\
 Sub\n\
\n\
</script>\n\
</head>\n\
<body style = 'background-color:#EEEEEE' onkeypress = 'vbs:Default_Buttons'lign = 'top'>\n\
<table width = '100%' height = '80%'lign = 'center' border = '0'>\n\
<tr border = '0'>\n\
<tdlign = 'left' valign = 'middle' style='Font-Family:Arial'>\n");

1375 
	`wcst
(
lDlogSg
, 
aMesge
 ?Mesg: 
L
"");

1377 
	`wcst
(
lDlogSg
, 
L
"\n\
</td>\n\
<tdlign = 'right' valign = 'middle' style = 'margin-top: 0em'>\n\
<tablelign = 'right' style = 'margin-right: 0em;'>\n\
<trlign = 'right' style = 'margin-top: 5em;'>\n\
<inputype = 'button' value = 'OK'ame = 'btn_OK' onClick = 'vbs:Run_ProgramOK' style = 'width: 5em; margin-top: 2em;'><br>\n\
<inputype = 'button' value = 'Cancel'ame = 'btn_Cancel' onClick = 'vbs:Run_ProgramCancel' style = 'width: 5em;'><br><br>\n\
</tr>\n\
</table>\n\
</td>\n\
</tr>\n\
</table>\n");

1390 
	`wcst
(
lDlogSg
, 
L
"<table width = '100%' height = '100%'lign = 'center' border = '0'>\n\
<tr>\n\
<tdlign = 'left' valign = 'top'>\n\
<inputype = 'password' id = 'txt_input'\n\
 = 'txt_input' value = '' style = 'float:left;width:100%' ><BR>\n\
</td>\n\
</tr>\n\
</table>\n\
</body>\n\
</html>\n\
" ) ;

1402 
	`utws
(
lDlogSg
, 
lIn
);

1403 
	`fo
(
lIn
);

1405 i(
aDeuIut
)

1407 
	`swtf
(
lDlogSg
,

1408 #i!
	`defed
(
__BORLANDC__
&& !defed(
__TINYC__
&& ( !defed(
__GNUC__
) || (__GNUC__) >= 5 )

1409 
lDlogSgL
,

1411 
L
"%ls\\ADa\\Lol\\Temp\\tyfd.txt",
	`_wgv
(L"USERPROFILE"));

1413 #ifde
TINYFD_NOCCSUNICODE


1414 
lFe
 = 
	`_wfݒ
(
lDlogSg
, 
L
"w");

1415 
	`utc
(0xFF, 
lFe
);

1416 
	`utc
(0xFE, 
lFe
);

1418 
lFe
 = 
	`_wfݒ
(
lDlogSg
, 
L
"wt, ccs=UNICODE");

1420 
	`fo
(
lFe
);

1422 
	`wcsy
(
lDlogSg
, 
L
"cmd.exe /c cscript.exe //U //Nologo ");

1423 
	`wcst
(
lDlogSg
, 
L
"\"%USERPROFILE%\\AppData\\Local\\Temp\\tinyfd.vbs\" ");

1424 
	`wcst
(
lDlogSg
, 
L
">> \"%USERPROFILE%\\AppData\\Local\\Temp\\tinyfd.txt\"");

1428 
	`wcsy
(
lDlogSg
,

1429 
L
"cmd.exe /c mshta.exe \"%USERPROFILE%\\AppData\\Local\\Temp\\tinyfd.hta\"");

1434 
	`hiddCseW
(
lDlogSg
, 
aT
, 1);

1436 
	`swtf
(
lDlogSg
,

1437 #i!
	`defed
(
__BORLANDC__
&& !defed(
__TINYC__
&& ( !defed(
__GNUC__
) || (__GNUC__) >= 5 )

1438 
lDlogSgL
,

1440 
L
"%ls\\ADa\\Lol\\Temp\\tyfd.txt", 
	`_wgv
(L"USERPROFILE"));

1442 #ifde
TINYFD_NOCCSUNICODE


1443 i(!(
lIn
 = 
	`_wfݒ
(
lDlogSg
, 
L
"r")))

1445 i(!(
lIn
 = 
	`_wfݒ
(
lDlogSg
, 
L
"rt, ccs=UNICODE")))

1448 
	`_wmove
(
lDlogSg
);

1449 
	`
(
lDlogSg
);

1450  
NULL
;

1453 
	`memt
(
lBuff
, 0, 
MAX_PATH_OR_CMD
 * (
wch_t
) );

1455 #ifde
TINYFD_NOCCSUNICODE


1456 
	`fgs
((*)
lBuff
, 2*
MAX_PATH_OR_CMD
, 
lIn
);

1458 
	`fgws
(
lBuff
, 
MAX_PATH_OR_CMD
, 
lIn
);

1460 
	`fo
(
lIn
);

1461 
	`wefeW
(
lDlogSg
);

1462 
	`_wmove
(
lDlogSg
);

1464 i(
aDeuIut
)

1466 
	`swtf
(
lDlogSg
,

1467 #i!
	`defed
(
__BORLANDC__
&& !defed(
__TINYC__
&& ( !defed(
__GNUC__
) || (__GNUC__) >= 5 )

1468 
lDlogSgL
,

1470 
L
"%ls\\AppData\\Local\\Temp\\tinyfd.vbs",

1471 
	`_wgv
(
L
"USERPROFILE"));

1475 
	`swtf
(
lDlogSg
,

1476 #i!
	`defed
(
__BORLANDC__
&& !defed(
__TINYC__
&& ( !defed(
__GNUC__
) || (__GNUC__) >= 5 )

1477 
lDlogSgL
,

1479 
L
"%ls\\AppData\\Local\\Temp\\tinyfd.hta",

1480 
	`_wgv
(
L
"USERPROFILE"));

1482 
	`_wmove
(
lDlogSg
);

1483 
	`
(
lDlogSg
);

1485 #ifde
TINYFD_NOCCSUNICODE


1486 
lResu
 = !
	`wccmp
(
lBuff
+1, 
L
"1", 1);

1488 
lResu
 = !
	`wccmp
(
lBuff
, 
L
"1", 1);

1492 i(!
lResu
)

1494  
NULL
 ;

1499 #ifde
TINYFD_NOCCSUNICODE


1500 i(
aDeuIut
)

1502 
lDlogSgL
 = 
	`wc
(
lBuff
) ;

1503 
lBuff
[
lDlogSgL
 - 1] = 
L
'\0';

1504 
lBuff
[
lDlogSgL
 - 2] = 
L
'\0';

1506  
lBuff
 + 2;

1508 i(
aDeuIut

lBuff
[
	`wc
Buff- 1] = 
L
'\0';

1509  
lBuff
 + 1;

1511 
	}
}

1514 
	$putBoxWGui
(

1515 * 
aoBuff
,

1516 cڡ * 
aT
,

1517 cڡ * 
aMesge
,

1518 cڡ * 
aDeuIut
)

1520 
wch_t
 
lT
 [128] = 
L
"";

1521 
wch_t
 * 
lMesge
 = 
NULL
;

1522 
wch_t
 
lDeuIut
[
MAX_PATH_OR_CMD
] = 
L
"";

1523 
wch_t
 * 
lTmpWCh
;

1524 * 
lTmpCh
;

1526 i(
tyfd_wUtf8
)

1528 i(
aT
)

1530 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aT
);

1531 
	`wcsy
(
lT
, 
lTmpWCh
);

1533 i(
aMesge
)

1535 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aMesge
);

1536 
lMesge
 = 
	`mloc
((
	`wc
(
lTmpWCh
+ 1)* (
wch_t
));

1537 
	`wcsy
(
lMesge
, 
lTmpWCh
);

1539 i(
aDeuIut
)

1541 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aDeuIut
);

1542 
	`wcsy
(
lDeuIut
, 
lTmpWCh
);

1547 i(
aT
)

1549 
lTmpWCh
 = 
	`mbcsTo16
(
aT
);

1550 
	`wcsy
(
lT
, 
lTmpWCh
);

1552 i(
aMesge
)

1554 
lTmpWCh
 = 
	`mbcsTo16
(
aMesge
);

1555 
lMesge
 = 
	`mloc
((
	`wc
(
lTmpWCh
+ 1)* (
wch_t
));

1556 
	`wcsy
(
lMesge
, 
lTmpWCh
);

1558 i(
aDeuIut
)

1560 
lTmpWCh
 = 
	`mbcsTo16
(
aDeuIut
);

1561 
	`wcsy
(
lDeuIut
, 
lTmpWCh
);

1565 
lTmpWCh
 = 
	`tyfd_putBoxW

lT
, 
lMesge
, 
lDeuIut
);

1567 
	`
(
lMesge
);

1569 i(!
lTmpWCh
)

1571 
aoBuff
[0] = '\0';

1575 i(
tyfd_wUtf8
)

1577 
lTmpCh
 = 
	`tyfd_utf16to8
(
lTmpWCh
);

1581 
lTmpCh
 = 
	`utf16toMbcs
(
lTmpWCh
);

1583 
	`ry
(
aoBuff
, 
lTmpCh
);

1586 
	}
}

1589 
wch_t
 * 
	$tyfd_veFeDlogW
(

1590 
wch_t
 cڡ * 
aT
,

1591 
wch_t
 cڡ * 
aDeuPhAndFe
,

1592 
aNumOfFrPs
,

1593 
wch_t
 cڡ * cڡ * 
aFrPs
,

1594 
wch_t
 cڡ * 
aSgFrDesti
)

1596 
wch_t
 
lBuff
[
MAX_PATH_OR_CMD
];

1597 
wch_t
 
lDme
[
MAX_PATH_OR_CMD
];

1598 
wch_t
 
lDlogSg
[
MAX_PATH_OR_CMD
];

1599 
wch_t
 
lFrPs
[
MAX_PATH_OR_CMD
] = 
L
"";

1600 
wch_t
 * 
p
;

1601 
wch_t
 * 
lRv
;

1602 
wch_t
 cڡ * 
ldefExt
 = 
NULL
;

1603 
i
;

1604 
HRESULT
 
lHResu
;

1605 
OPENFILENAMEW
 
o
 = {0};

1607 i(
aT
&&!
	`wcscmp
T, 
L
"tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "wdows_wch");  (
wch_t
 *)1; }

1609 
lHResu
 = 
	`CoInlizeEx
(
NULL
, 0);

1611 
	`gPhWhoutFSshW
(
lDme
, 
aDeuPhAndFe
);

1612 
	`gLaNameW
(
lBuff
, 
aDeuPhAndFe
);

1614 i(
aNumOfFrPs
 > 0)

1616 
ldefExt
 = 
aFrPs
[0];

1618 i(
aSgFrDesti
 && 
	`wc
(aSingleFilterDescription))

1620 
	`wcsy
(
lFrPs
, 
aSgFrDesti
);

1621 
	`wcst
(
lFrPs
, 
L
"\n");

1623 
	`wcst
(
lFrPs
, 
aFrPs
[0]);

1624 
i
 = 1; i < 
aNumOfFrPs
; i++)

1626 
	`wcst
(
lFrPs
, 
L
";");

1627 
	`wcst
(
lFrPs
, 
aFrPs
[
i
]);

1629 
	`wcst
(
lFrPs
, 
L
"\n");

1630 i(!(
aSgFrDesti
 && 
	`wc
(aSingleFilterDescription)))

1632 
	`wcsy
(
lDlogSg
, 
lFrPs
);

1633 
	`wcst
(
lFrPs
, 
lDlogSg
);

1635 
	`wcst
(
lFrPs
, 
L
"All Files\n*.*\n");

1636 
p
 = 
lFrPs
;

1637 (
p
 = 
	`wcschr
, 
L
'\n')!
NULL
)

1639 *
p
 = 
L
'\0';

1640 
p
++;

1644 
o
.
lSuSize
 = (
OPENFILENAMEW
);

1645 
o
.
hwndOwr
 = 
	`GFegroundWdow
();

1646 
o
.
hIn
 = 0;

1647 
o
.
͡rFr
 = 
	`wc
(
lFrPs
?FrP: 
NULL
;

1648 
o
.
͡rCuomFr
 = 
NULL
;

1649 
o
.
nMaxCuFr
 = 0;

1650 
o
.
nFrIndex
 = 1;

1651 
o
.
͡rFe
 = 
lBuff
;

1653 
o
.
nMaxFe
 = 
MAX_PATH_OR_CMD
;

1654 
o
.
͡rFeT
 = 
NULL
;

1655 
o
.
nMaxFeT
 = 
MAX_PATH_OR_CMD
/2;

1656 
o
.
͡rInlD
 = 
	`wc
(
lDme
?Dm: 
NULL
;

1657 
o
.
͡rT
 = 
aT
 && 
	`wc
T?T : 
NULL
;

1658 
o
.
Fgs
 = 
OFN_OVERWRITEPROMPT
 | 
OFN_NOCHANGEDIR
 | 
OFN_PATHMUSTEXIST
 ;

1659 
o
.
nFeOfft
 = 0;

1660 
o
.
nFeExnsi
 = 0;

1661 
o
.
͡rDefExt
 = 
ldefExt
;

1662 
o
.
lCuDa
 = 0L;

1663 
o
.
Hook
 = 
NULL
;

1664 
o
.
TemeName
 = 
NULL
;

1666 i(
	`GSaveFeNameW
(&
o
) == 0)

1668 
lRv
 = 
NULL
;

1672 
lRv
 = 
lBuff
;

1675 i(
lHResu
 =
S_OK
 ||HResu =
S_FALSE
)

1677 
	`CoUnlize
();

1679  
lRv
;

1680 
	}
}

1683 * 
	$veFeDlogWGui8
(

1684 * 
aoBuff
,

1685 cڡ * 
aT
,

1686 cڡ * 
aDeuPhAndFe
,

1687 
aNumOfFrPs
,

1688 cڡ * cڡ * 
aFrPs
,

1689 cڡ * 
aSgFrDesti
)

1691 
wch_t
 
lT
 [128] = 
L
"";

1692 
wch_t
 
lDeuPhAndFe
 [
MAX_PATH_OR_CMD
] = 
L
"";

1693 
wch_t
 
lSgFrDesti
 [128] = 
L
"";

1694 
wch_t
 * * 
lFrPs
;

1695 
wch_t
 * 
lTmpWCh
;

1696 * 
lTmpCh
;

1697 
i
 ;

1699 
lFrPs
 = (
wch_t
 **
	`mloc
(
aNumOfFrPs
*(wchar_t *));

1700 
i
 = 0; i < 
aNumOfFrPs
; i++)

1702 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aFrPs
[
i
]);

1703 
lFrPs
[
i
] = (
wch_t
 *)
	`mloc
(
	`wc
(
lTmpWCh
)+1) * (wchar_t *));

1704 
	`wcsy
(
lFrPs
[
i
], 
lTmpWCh
);

1707 i(
aT
)

1709 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aT
);

1710 
	`wcsy
(
lT
, 
lTmpWCh
);

1713 i(
aDeuPhAndFe
)

1715 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aDeuPhAndFe
);

1716 
	`wcsy
(
lDeuPhAndFe
, 
lTmpWCh
);

1719 i(
aSgFrDesti
)

1721 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aSgFrDesti
);

1722 
	`wcsy
(
lSgFrDesti
, 
lTmpWCh
);

1725 
lTmpWCh
 = 
	`tyfd_veFeDlogW
(

1726 
lT
,

1727 
lDeuPhAndFe
,

1728 
aNumOfFrPs
,

1729 (
wch_t
 const** )

1730 
lFrPs
,

1731 
lSgFrDesti
);

1733 
i
 = 0; i < 
aNumOfFrPs
; i++)

1735 
	`
(
lFrPs
[
i
]);

1737 
	`
(
lFrPs
);

1739 i(!
lTmpWCh
)

1741  
NULL
;

1744 
lTmpCh
 = 
	`tyfd_utf16to8
(
lTmpWCh
);

1745 
	`ry
(
aoBuff
, 
lTmpCh
);

1746 (
	`tyfd_utf16to8
(
NULL
);

1748  
aoBuff
;

1749 
	}
}

1752 
wch_t
 * 
	$tyfd_ݒFeDlogW
(

1753 
wch_t
 cڡ * 
aT
,

1754 
wch_t
 cڡ * 
aDeuPhAndFe
,

1755 
aNumOfFrPs
,

1756 
wch_t
 cڡ * cڡ * 
aFrPs
,

1757 
wch_t
 cڡ * 
aSgFrDesti
,

1758 
aAowMuɝSes
)

1760 
size_t
 
lLgths
[
MAX_MULTIPLE_FILES
];

1761 
wch_t
 
lDme
[
MAX_PATH_OR_CMD
];

1762 
wch_t
 
lFrPs
[
MAX_PATH_OR_CMD
] = 
L
"";

1763 
wch_t
 
lDlogSg
[
MAX_PATH_OR_CMD
];

1764 
wch_t
 * 
lPors
[
MAX_MULTIPLE_FILES
+1];

1765 
wch_t
 * 
p
;

1766 
i
, 
j
;

1767 
size_t
 
lBuffL
, 
lFuBuffL
;

1768 
HRESULT
 
lHResu
;

1769 
OPENFILENAMEW
 
o
 = { 0 };

1770 
wch_t
 * 
lBuff
 = 
NULL
;

1772 
	`
(
lBuff
);

1773 
lBuff
 = 
NULL
;

1774 i(
aAowMuɝSes
 < 0 (
wch_t
 *)0;

1776 i(
aT
&&!
	`wcscmp
T, 
L
"tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "wdows_wch");  (
wch_t
 *)1; }

1778 i(
aAowMuɝSes
)

1780 
lFuBuffL
 = 
MAX_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

1781 
lBuff
 = (
wch_t
*)(
	`mloc
(
lFuBuffL
 * (wchar_t)));

1782 i(!
lBuff
)

1784 
lFuBuffL
 = 
LOW_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

1785 
lBuff
 = (
wch_t
*)
	`mloc

lFuBuffL
 * (wchar_t)));

1790 
lFuBuffL
 = 
MAX_PATH_OR_CMD
 + 1;

1791 
lBuff
 = (
wch_t
*)(
	`mloc
(
lFuBuffL
 * (wchar_t)));

1793 i(!
lBuff
 
NULL
;

1795 
lHResu
 = 
	`CoInlizeEx
(
NULL
, 0);

1797 
	`gPhWhoutFSshW
(
lDme
, 
aDeuPhAndFe
);

1798 
	`gLaNameW
(
lBuff
, 
aDeuPhAndFe
);

1800 i(
aNumOfFrPs
 > 0)

1802 i(
aSgFrDesti
 && 
	`wc
(aSingleFilterDescription))

1804 
	`wcsy
(
lFrPs
, 
aSgFrDesti
);

1805 
	`wcst
(
lFrPs
, 
L
"\n");

1807 
	`wcst
(
lFrPs
, 
aFrPs
[0]);

1808 
i
 = 1; i < 
aNumOfFrPs
; i++)

1810 
	`wcst
(
lFrPs
, 
L
";");

1811 
	`wcst
(
lFrPs
, 
aFrPs
[
i
]);

1813 
	`wcst
(
lFrPs
, 
L
"\n");

1814 i(!(
aSgFrDesti
 && 
	`wc
(aSingleFilterDescription)))

1816 
	`wcsy
(
lDlogSg
, 
lFrPs
);

1817 
	`wcst
(
lFrPs
, 
lDlogSg
);

1819 
	`wcst
(
lFrPs
, 
L
"All Files\n*.*\n");

1820 
p
 = 
lFrPs
;

1821 (
p
 = 
	`wcschr
, 
L
'\n')!
NULL
)

1823 *
p
 = 
L
'\0';

1824 
p
++;

1828 
o
.
lSuSize
 = (
OPENFILENAME
);

1829 
o
.
hwndOwr
 = 
	`GFegroundWdow
();

1830 
o
.
hIn
 = 0;

1831 
o
.
͡rFr
 = 
	`wc
(
lFrPs
?FrP: 
NULL
;

1832 
o
.
͡rCuomFr
 = 
NULL
;

1833 
o
.
nMaxCuFr
 = 0;

1834 
o
.
nFrIndex
 = 1;

1835 
o
.
͡rFe
 = 
lBuff
;

1836 
o
.
nMaxFe
 = 
lFuBuffL
;

1837 
o
.
͡rFeT
 = 
NULL
;

1838 
o
.
nMaxFeT
 = 
MAX_PATH_OR_CMD
 / 2;

1839 
o
.
͡rInlD
 = 
	`wc
(
lDme
?Dm: 
NULL
;

1840 
o
.
͡rT
 = 
aT
 && 
	`wc
T?T : 
NULL
;

1841 
o
.
Fgs
 = 
OFN_EXPLORER
 | 
OFN_NOCHANGEDIR
 | 
OFN_PATHMUSTEXIST
 | 
OFN_FILEMUSTEXIST
;

1842 
o
.
nFeOfft
 = 0;

1843 
o
.
nFeExnsi
 = 0;

1844 
o
.
͡rDefExt
 = 
NULL
;

1845 
o
.
lCuDa
 = 0L;

1846 
o
.
Hook
 = 
NULL
;

1847 
o
.
TemeName
 = 
NULL
;

1849 i(
aAowMuɝSes
)

1851 
o
.
Fgs
 |
OFN_ALLOWMULTISELECT
;

1854 i(
	`GOnFeNameW
(&
o
) == 0)

1856 
	`
(
lBuff
);

1857 
lBuff
 = 
NULL
;

1861 
lBuffL
 = 
	`wc
(
lBuff
);

1862 
lPors
[0] = 
lBuff
 + 
lBuffL
 + 1;

1863 i(
aAowMuɝSes
 && (
lPors
[0][0] !
L
'\0'))

1865 
i
 = 0;

1868 
lLgths
[
i
] = 
	`wc
(
lPors
[i]);

1869 
lPors
[
i
 + 1] =Pors[i] + 
lLgths
[i] + 1;

1870 
i
++;

1871 } 
lPors
[
i
][0] !
L
'\0' && i < 
MAX_MULTIPLE_FILES
 );

1872 i(
i
 > 
MAX_MULTIPLE_FILES
)

1874 
	`
(
lBuff
);

1875 
lBuff
 = 
NULL
;

1879 
i
--;

1880 
p
 = 
lBuff
 + 
lFuBuffL
 - 1;

1881 *
p
 = 
L
'\0';

1882 
j
 = 
i
; j >= 0; j--)

1884 
p
 -
lLgths
[
j
];

1885 
	`memmove
(
p
, 
lPors
[
j
], 
lLgths
[j] * (
wch_t
));

1886 
p
--;

1887 *
p
 = 
L
'\\';

1888 
p
 -
lBuffL
;

1889 
	`memmove
(
p
, 
lBuff
, 
lBuffL
*(
wch_t
));

1890 
p
--;

1891 *
p
 = 
L
'|';

1893 
p
++;

1894 
	`wcsy
(
lBuff
, 
p
);

1895 
lBuffL
 = 
	`wc
(
lBuff
);

1898 i(
lBuff
lBuf(
wch_t
*)(
	`loc
Buff, (
lBuffL
 + 1) * (wchar_t)));

1901 i(
lHResu
 =
S_OK
 ||HResu =
S_FALSE
)

1903 
	`CoUnlize
();

1905  
lBuff
;

1906 
	}
}

1909 * 
	$ݒFeDlogWGui8
(

1910 cڡ * 
aT
,

1911 cڡ * 
aDeuPhAndFe
,

1912 
aNumOfFrPs
,

1913 cڡ * cڡ * 
aFrPs
,

1914 cڡ * 
aSgFrDesti
,

1915 
aAowMuɝSes
)

1917 
wch_t
 
lT
[128] = 
L
"";

1918 
wch_t
 
lDeuPhAndFe
[
MAX_PATH_OR_CMD
] = 
L
"";

1919 
wch_t
 
lSgFrDesti
[128] = 
L
"";

1920 
wch_t
 * * 
lFrPs
;

1921 
wch_t
 * 
lTmpWCh
;

1922 * 
lTmpCh
;

1923 
i
;

1925 
lFrPs
 = (
wch_t
 * *
	`mloc
(
aNumOfFrPs
*(wchar_t *));

1926 
i
 = 0; i < 
aNumOfFrPs
; i++)

1928 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aFrPs
[
i
]);

1929 
lFrPs
[
i
] = (
wch_t
 *)
	`mloc
((
	`wc
(
lTmpWCh
)+1)*(wchar_t *));

1930 
	`wcsy
(
lFrPs
[
i
], 
lTmpWCh
);

1933 i(
aT
)

1935 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aT
);

1936 
	`wcsy
(
lT
, 
lTmpWCh
);

1938 i(
aDeuPhAndFe
)

1940 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aDeuPhAndFe
);

1941 
	`wcsy
(
lDeuPhAndFe
, 
lTmpWCh
);

1943 i(
aSgFrDesti
)

1945 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aSgFrDesti
);

1946 
	`wcsy
(
lSgFrDesti
, 
lTmpWCh
);

1949 
lTmpWCh
 = 
	`tyfd_ݒFeDlogW
(

1950 
lT
,

1951 
lDeuPhAndFe
,

1952 
aNumOfFrPs
,

1953 (
wch_t
 const**)

1954 
lFrPs
,

1955 
lSgFrDesti
,

1956 
aAowMuɝSes
);

1958 
i
 = 0; i < 
aNumOfFrPs
; i++)

1960 
	`
(
lFrPs
[
i
]);

1962 
	`
(
lFrPs
);

1964 i(!
lTmpWCh
 
NULL
;

1966 
lTmpCh
 = 
	`tyfd_utf16to8
(
lTmpWCh
);

1967 (
	`tyfd_ݒFeDlogW
(
NULL
,NULL,0,NULL,NULL,-1);

1969  
lTmpCh
;

1970 
	}
}

1973 
BOOL
 
CALLBACK
 
	$BrowClbackProc_um
(
HWND
 
hWndChd
, 
LPARAM
 
lPam
)

1975 
buf
[255];

1976 
	`GCssNameA
(
hWndChd
, 
buf
, (buf));

1977 i(
	`rcmp
(
buf
, "SysTreeView32") == 0) {

1978 
HTREEITEM
 
hNode
 = 
	`TeVw_GSei
(
hWndChd
);

1979 
	`TeVw_EnsuVisib
(
hWndChd
, 
hNode
);

1980  
FALSE
;

1982  
TRUE
;

1983 
	}
}

1987 
BOOL
 
CALLBACK
 
	$BrowClbackProcW_um
(
HWND
 
hWndChd
, 
LPARAM
 
lPam
)

1989 
wch_t
 
buf
[255];

1990 
	`GCssNameW
(
hWndChd
, 
buf
, (buf));

1991 i(
	`wcscmp
(
buf
, 
L
"SysTreeView32") == 0) {

1992 
HTREEITEM
 
hNode
 = 
	`TeVw_GSei
(
hWndChd
);

1993 
	`TeVw_EnsuVisib
(
hWndChd
, 
hNode
);

1994  
FALSE
;

1996  
TRUE
;

1997 
	}
}

1999 
__d
 
	$BrowClbackProc
(
HWND
 
hwnd
, 
UINT
 
uMsg
, 
LPARAM
 

, LPARAM 
pDa
)

2001 
uMsg
) {

2002 
BFFM_INITIALIZED
:

2003 
	`SdMesge
(
hwnd
, 
BFFM_SETSELECTION
, 
TRUE
, 
pDa
);

2005 
BFFM_SELCHANGED
:

2006 
	`EnumChdWdows
(
hwnd
, 
BrowClbackProc_um
, 0);

2009 
	}
}

2012 
__d
 
	$BrowClbackProcW
(
HWND
 
hwnd
, 
UINT
 
uMsg
, 
LPARAM
 

, LPARAM 
pDa
)

2014 
uMsg
) {

2015 
BFFM_INITIALIZED
:

2016 
	`SdMesge
(
hwnd
, 
BFFM_SETSELECTIONW
, 
TRUE
, (
LPARAM
)
pDa
);

2018 
BFFM_SELCHANGED
:

2019 
	`EnumChdWdows
(
hwnd
, 
BrowClbackProcW_um
, 0);

2022 
	}
}

2024 
wch_t
 * 
	$tyfd_FdDlogW
(

2025 
wch_t
 cڡ * 
aT
,

2026 
wch_t
 cڡ * 
aDeuPh
)

2028 
wch_t
 
lBuff
[
MAX_PATH_OR_CMD
];

2029 
wch_t
 * 
lRv
;

2031 
BROWSEINFOW
 
bInfo
;

2032 
LPITEMIDLIST
 
Im
;

2033 
HRESULT
 
lHResu
;

2035 i(
aT
&&!
	`wcscmp
T, 
L
"tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "wdows_wch");  (
wch_t
 *)1; }

2037 
lHResu
 = 
	`CoInlizeEx
(
NULL
, 
COINIT_APARTMENTTHREADED
);

2039 
bInfo
.
hwndOwr
 = 
	`GFegroundWdow
();

2040 
bInfo
.
pidlRo
 = 
NULL
;

2041 
bInfo
.
pszDiyName
 = 
lBuff
;

2042 
bInfo
.
szT
 = 
aT
 && 
	`wc
T?T : 
NULL
;

2043 i(
lHResu
 =
S_OK
 ||HResu =
S_FALSE
)

2045 
bInfo
.
ulFgs
 = 
BIF_USENEWUI
;

2047 
bInfo
.

 = 
BrowClbackProcW
;

2048 
bInfo
.
lPam
 = (
LPARAM
)
aDeuPh
;

2049 
bInfo
.
iImage
 = -1;

2051 
Im
 = 
	`SHBrowFFdW
(&
bInfo
);

2052 i(!
Im
)

2054 
lRv
 = 
NULL
;

2058 
	`SHGPhFromIDLiW
(
Im
, 
lBuff
);

2059 
lRv
 = 
lBuff
 ;

2062 i(
lHResu
 =
S_OK
 ||HResu =
S_FALSE
)

2064 
	`CoUnlize
();

2066  
lRv
;

2067 
	}
}

2070 * 
	$FdDlogWGui8
(

2071 * 
aoBuff
 ,

2072 cڡ * 
aT
 ,

2073 cڡ * 
aDeuPh
 )

2075 
wch_t
 
lT
 [128] = 
L
"";

2076 
wch_t
 
lDeuPh
[
MAX_PATH_OR_CMD
] = 
L
"";

2077 
wch_t
 * 
lTmpWCh
;

2078 * 
lTmpCh
;

2080 i(
aT
)

2082 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aT
);

2083 
	`wcsy
(
lT
, 
lTmpWCh
);

2085 i(
aDeuPh
)

2087 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aDeuPh
);

2088 
	`wcsy
(
lDeuPh
, 
lTmpWCh
);

2091 
lTmpWCh
 = 
	`tyfd_FdDlogW
(

2092 
lT
,

2093 
lDeuPh
);

2095 i(!
lTmpWCh
)

2097  
NULL
;

2100 
lTmpCh
 = 
	`tyfd_utf16to8
(
lTmpWCh
);

2101 
	`ry
(
aoBuff
, 
lTmpCh
);

2103  
aoBuff
;

2104 
	}
}

2107 
wch_t
 * 
	$tyfd_cChoorW
(

2108 
wch_t
 cڡ * 
aT
,

2109 
wch_t
 cڡ * 
aDeuHexRGB
,

2110 cڡ 
aDeuRGB
[3],

2111 
aoResuRGB
[3])

2113 
wch_t
 
lResuHexRGB
[8];

2114 
CHOOSECOLORW
 
cc
;

2115 
COLORREF
 
CuCs
[16];

2116 
lDeuRGB
[3];

2117 
lR
;

2119 
HRESULT
 
lHResu
;

2121 i(
aT
&&!
	`wcscmp
T, 
L
"tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "wdows_wch");  (
wch_t
 *)1; }

2123 
lHResu
 = 
	`CoInlizeEx
(
NULL
, 0);

2125 i
aDeuHexRGB
 )

2127 
	`Hex2RGBW
(
aDeuHexRGB
, 
lDeuRGB
);

2131 
lDeuRGB
[0] = 
aDeuRGB
[0];

2132 
lDeuRGB
[1] = 
aDeuRGB
[1];

2133 
lDeuRGB
[2] = 
aDeuRGB
[2];

2137 
cc
.
lSuSize
 = (
CHOOSECOLOR
);

2138 
cc
.
hwndOwr
 = 
	`GFegroundWdow
();

2139 
cc
.
hIn
 = 
NULL
;

2140 
cc
.
rgbResu
 = 
	`RGB
(
lDeuRGB
[0],DefaultRGB[1],DefaultRGB[2]);

2141 
cc
.
CuCs
 = 
CuCs
;

2142 
cc
.
Fgs
 = 
CC_RGBINIT
 | 
CC_FULLOPEN
 | 
CC_ANYCOLOR
 ;

2143 
cc
.
lCuDa
 = 0;

2144 
cc
.
Hook
 = 
NULL
;

2145 
cc
.
TemeName
 = 
NULL
;

2147 
lR
 = 
	`ChooCW
(&
cc
);

2149 i(!
lR
)

2151  
NULL
;

2154 
aoResuRGB
[0] = 
	`GRVue
(
cc
.
rgbResu
);

2155 
aoResuRGB
[1] = 
	`GGVue
(
cc
.
rgbResu
);

2156 
aoResuRGB
[2] = 
	`GBVue
(
cc
.
rgbResu
);

2158 
	`RGB2HexW
(
aoResuRGB
, 
lResuHexRGB
);

2160 i(
lHResu
 =
S_OK
 ||HResu =
S_FALSE
)

2162 
	`CoUnlize
();

2165  
lResuHexRGB
;

2166 
	}
}

2169 * 
	$cChoorWGui8
(

2170 cڡ * 
aT
,

2171 cڡ * 
aDeuHexRGB
,

2172 cڡ 
aDeuRGB
[3],

2173 
aoResuRGB
[3])

2175 
lResuHexRGB
[8];

2177 
wch_t
 
lT
[128];

2178 
wch_t
 
lDeuHexRGB
[16];

2179 
wch_t
 * 
lTmpWCh
;

2180 * 
lTmpCh
;

2182 i(
aT
)

2184 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aT
);

2185 
	`wcsy
(
lT
, 
lTmpWCh
);

2187 i(
aDeuHexRGB
)

2189 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aDeuHexRGB
);

2190 
	`wcsy
(
lDeuHexRGB
, 
lTmpWCh
);

2193 
lTmpWCh
 = 
	`tyfd_cChoorW
(

2194 
lT
,

2195 
lDeuHexRGB
,

2196 
aDeuRGB
,

2197 
aoResuRGB
 );

2199 i(!
lTmpWCh
)

2201  
NULL
;

2204 
lTmpCh
 = 
	`tyfd_utf16to8
(
lTmpWCh
);

2205 
	`ry
(
lResuHexRGB
, 
lTmpCh
);

2207  
lResuHexRGB
;

2208 
	}
}

2211 
	$mesgeBoxWGuiA
(

2212 cڡ * 
aT
 ,

2213 cڡ * 
aMesge
 ,

2214 cڡ * 
aDlogTy
 ,

2215 cڡ * 
aIcTy
 ,

2216 
aDeuBu
 )

2218 
lBoxRuVue
;

2219 
UINT
 
aCode
 ;

2221 i
aIcTy
 && ! 
	`rcmp
( "warning" ,IconType ) )

2223 
aCode
 = 
MB_ICONWARNING
 ;

2225 i
aIcTy
 && ! 
	`rcmp
("error",IconType))

2227 
aCode
 = 
MB_ICONERROR
 ;

2229 i
aIcTy
 && ! 
	`rcmp
("question",IconType))

2231 
aCode
 = 
MB_ICONQUESTION
 ;

2235 
aCode
 = 
MB_ICONINFORMATION
 ;

2238 i
aDlogTy
 && ! 
	`rcmp
( "okcancel" ,DialogType ) )

2240 
aCode
 +
MB_OKCANCEL
 ;

2241 i! 
aDeuBu
 )

2243 
aCode
 +
MB_DEFBUTTON2
 ;

2246 i
aDlogTy
 && ! 
	`rcmp
( "yesno" ,DialogType ) )

2248 
aCode
 +
MB_YESNO
 ;

2249 i! 
aDeuBu
 )

2251 
aCode
 +
MB_DEFBUTTON2
 ;

2254 i(
aDlogTy
 && !
	`rcmp
("yesnocancel",DialogType))

2256 
aCode
 +
MB_YESNOCANCEL
;

2257 i(!
aDeuBu
)

2259 
aCode
 +
MB_DEFBUTTON3
;

2261 i(
aDeuBu
 == 2)

2263 
aCode
 +
MB_DEFBUTTON2
;

2268 
aCode
 +
MB_OK
 ;

2271 
aCode
 +
MB_TOPMOST
;

2273 
lBoxRuVue
 = 
	`MesgeBoxA
(
	`GFegroundWdow
(), 
aMesge
, 
aT
, 
aCode
);

2275 i(((
aDlogTy
 && !
	`rcmp
("yesnocancel",DialogType))

2276 && (
lBoxRuVue
 =
IDNO
)))

2281 i
aDlogTy


2282 && 
	`rcmp
("yeonl", 
aDlogTy
)

2283 && 
	`rcmp
("oknl", 
aDlogTy
)

2284 && 
	`rcmp
("yeo", 
aDlogTy
)))

2285 || (
lBoxRuVue
 =
IDOK
)

2286 || (
lBoxRuVue
 =
IDYES
) )

2294 
	}
}

2297 * 
	$veFeDlogWGuiA
(

2298 * 
aoBuff
 ,

2299 cڡ * 
aT
 ,

2300 cڡ * 
aDeuPhAndFe
 ,

2301 
aNumOfFrPs
 ,

2302 cڡ * cڡ * 
aFrPs
 ,

2303 cڡ * 
aSgFrDesti
 )

2305 
lDme
 [
MAX_PATH_OR_CMD
] ;

2306 
lDlogSg
[
MAX_PATH_OR_CMD
];

2307 
lFrPs
[
MAX_PATH_OR_CMD
] = "";

2308 
i
 ;

2309 * 
p
;

2310 * 
lRv
;

2311 
HRESULT
 
lHResu
;

2312 cڡ * 
ldefExt
 = 
NULL
;

2313 
OPENFILENAMEA
 
o
 = { 0 };

2315 
lHResu
 = 
	`CoInlizeEx
(
NULL
,0);

2317 
	`gPhWhoutFSsh
(
lDme
, 
aDeuPhAndFe
);

2318 
	`gLaName
(
aoBuff
, 
aDeuPhAndFe
);

2320 i(
aNumOfFrPs
 > 0)

2322 
ldefExt
 = 
aFrPs
[0];

2324 i
aSgFrDesti
 && 
	`
(aSingleFilterDescription) )

2326 
	`ry
(
lFrPs
, 
aSgFrDesti
);

2327 
	`rt
(
lFrPs
, "\n");

2329 
	`rt
(
lFrPs
, 
aFrPs
[0]);

2330 
i
 = 1; i < 
aNumOfFrPs
; i++)

2332 
	`rt
(
lFrPs
, ";");

2333 
	`rt
(
lFrPs
, 
aFrPs
[
i
]);

2335 
	`rt
(
lFrPs
, "\n");

2336 i! (
aSgFrDesti
 && 
	`
(aSingleFilterDescription) ) )

2338 
	`ry
(
lDlogSg
, 
lFrPs
);

2339 
	`rt
(
lFrPs
, 
lDlogSg
);

2341 
	`rt
(
lFrPs
, "All Files\n*.*\n");

2342 
p
 = 
lFrPs
;

2343 (
p
 = 
	`rchr
, '\n')!
NULL
)

2345 *
p
 = '\0';

2346 
p
 ++ ;

2350 
o
.
lSuSize
 = (
OPENFILENAME
) ;

2351 
o
.
hwndOwr
 = 
	`GFegroundWdow
();

2352 
o
.
hIn
 = 0 ;

2353 
o
.
͡rFr
 = 
	`
(
lFrPs
?FrP: 
NULL
;

2354 
o
.
͡rCuomFr
 = 
NULL
 ;

2355 
o
.
nMaxCuFr
 = 0 ;

2356 
o
.
nFrIndex
 = 1 ;

2357 
o
.
͡rFe
 = 
aoBuff
;

2359 
o
.
nMaxFe
 = 
MAX_PATH_OR_CMD
 ;

2360 
o
.
͡rFeT
 = 
NULL
 ;

2361 
o
.
nMaxFeT
 = 
MAX_PATH_OR_CMD
 / 2;

2362 
o
.
͡rInlD
 = 
	`
(
lDme
?Dm: 
NULL
;

2363 
o
.
͡rT
 = 
aT
 && 
	`
T?T : 
NULL
;

2364 
o
.
Fgs
 = 
OFN_OVERWRITEPROMPT
 | 
OFN_NOCHANGEDIR
 ;

2365 
o
.
nFeOfft
 = 0 ;

2366 
o
.
nFeExnsi
 = 0 ;

2367 
o
.
͡rDefExt
 = 
ldefExt
;

2368 
o
.
lCuDa
 = 0L ;

2369 
o
.
Hook
 = 
NULL
 ;

2370 
o
.
TemeName
 = 
NULL
 ;

2372 i
	`GSaveFeNameA
 ( & 
o
 ) == 0 )

2374 
lRv
 = 
NULL
 ;

2378 
lRv
 = 
aoBuff
 ;

2381 i(
lHResu
==
S_OK
 ||HResu==
S_FALSE
)

2383 
	`CoUnlize
();

2385  
lRv
 ;

2386 
	}
}

2389 * 
	$ݒFeDlogWGuiA
(

2390 cڡ * 
aT
 ,

2391 cڡ * 
aDeuPhAndFe
 ,

2392 
aNumOfFrPs
 ,

2393 cڡ * cڡ * 
aFrPs
 ,

2394 cڡ * 
aSgFrDesti
 ,

2395 
aAowMuɝSes
 )

2397 
lDme
 [
MAX_PATH_OR_CMD
] ;

2398 
lFrPs
[
MAX_PATH_OR_CMD
] = "";

2399 
lDlogSg
[
MAX_PATH_OR_CMD
] ;

2400 * 
lPors
[
MAX_MULTIPLE_FILES
+1];

2401 
size_t
 
lLgths
[
MAX_MULTIPLE_FILES
];

2402 
i
 , 
j
 ;

2403 * 
p
;

2404 
size_t
 
lBuffL
, 
lFuBuffL
;

2405 
HRESULT
 
lHResu
;

2406 
OPENFILENAMEA
 
o
 = {0};

2407 * 
lBuff
 = 
NULL
;

2409 
	`
(
lBuff
);

2410 
lBuff
 = 
NULL
;

2411 i(
aAowMuɝSes
)

2413 
lFuBuffL
 = 
MAX_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

2414 
lBuff
 = (*)(
	`mloc
(
lFuBuffL
 * ()));

2415 i(!
lBuff
)

2417 
lFuBuffL
 = 
LOW_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

2418 
lBuff
 = (*)(
	`mloc
(
lFuBuffL
 * ()));

2423 
lFuBuffL
 = 
MAX_PATH_OR_CMD
 + 1;

2424 
lBuff
 = (*)(
	`mloc
(
lFuBuffL
 * ()));

2426 i(!
lBuff
 
NULL
;

2428 
lHResu
 = 
	`CoInlizeEx
(
NULL
,0);

2430 
	`gPhWhoutFSsh
(
lDme
, 
aDeuPhAndFe
);

2431 
	`gLaName
(
lBuff
, 
aDeuPhAndFe
);

2433 i(
aNumOfFrPs
 > 0)

2435 i
aSgFrDesti
 && 
	`
(aSingleFilterDescription) )

2437 
	`ry
(
lFrPs
, 
aSgFrDesti
);

2438 
	`rt
(
lFrPs
, "\n");

2440 
	`rt
(
lFrPs
, 
aFrPs
[0]);

2441 
i
 = 1; i < 
aNumOfFrPs
; i++)

2443 
	`rt
(
lFrPs
, ";");

2444 
	`rt
(
lFrPs
, 
aFrPs
[
i
]);

2446 
	`rt
(
lFrPs
, "\n");

2447 i! (
aSgFrDesti
 && 
	`
(aSingleFilterDescription) ) )

2449 
	`ry
(
lDlogSg
, 
lFrPs
);

2450 
	`rt
(
lFrPs
, 
lDlogSg
);

2452 
	`rt
(
lFrPs
, "All Files\n*.*\n");

2453 
p
 = 
lFrPs
;

2454 (
p
 = 
	`rchr
, '\n')!
NULL
)

2456 *
p
 = '\0';

2457 
p
 ++ ;

2461 
o
.
lSuSize
 = 
OPENFILENAME
 ) ;

2462 
o
.
hwndOwr
 = 
	`GFegroundWdow
();

2463 
o
.
hIn
 = 0 ;

2464 
o
.
͡rFr
 = 
	`
(
lFrPs
?FrP: 
NULL
;

2465 
o
.
͡rCuomFr
 = 
NULL
 ;

2466 
o
.
nMaxCuFr
 = 0 ;

2467 
o
.
nFrIndex
 = 1 ;

2468 
o
.
͡rFe
 = 
lBuff
;

2469 
o
.
nMaxFe
 = 
lFuBuffL
;

2470 
o
.
͡rFeT
 = 
NULL
 ;

2471 
o
.
nMaxFeT
 = 
MAX_PATH_OR_CMD
 / 2;

2472 
o
.
͡rInlD
 = 
	`
(
lDme
?Dm: 
NULL
;

2473 
o
.
͡rT
 = 
aT
 && 
	`
T?T : 
NULL
;

2474 
o
.
Fgs
 = 
OFN_EXPLORER
 | 
OFN_NOCHANGEDIR
 ;

2475 
o
.
nFeOfft
 = 0 ;

2476 
o
.
nFeExnsi
 = 0 ;

2477 
o
.
͡rDefExt
 = 
NULL
 ;

2478 
o
.
lCuDa
 = 0L ;

2479 
o
.
Hook
 = 
NULL
 ;

2480 
o
.
TemeName
 = 
NULL
 ;

2482 i
aAowMuɝSes
 )

2484 
o
.
Fgs
 |
OFN_ALLOWMULTISELECT
;

2487 i
	`GOnFeNameA
& 
o
 ) == 0 )

2489 
	`
(
lBuff
);

2490 
lBuff
 = 
NULL
 ;

2494 
lBuffL
 = 
	`
(
lBuff
);

2495 
lPors
[0] = 
lBuff
 + 
lBuffL
 + 1;

2496 i
aAowMuɝSes
 && (
lPors
[0][0] != '\0') )

2498 
i
 = 0 ;

2501 
lLgths
[
i
] = 
	`
(
lPors
[i]);

2502 
lPors
[
i
+1] =Pors[i] + 
lLgths
[i] + 1 ;

2503 
i
 ++ ;

2504 } 
lPors
[
i
][0] !
L
'\0' && i < 
MAX_MULTIPLE_FILES
);

2505 i(
i
 > 
MAX_MULTIPLE_FILES
)

2507 
	`
(
lBuff
);

2508 
lBuff
 = 
NULL
;

2512 
i
--;

2513 
p
 = 
lBuff
 + 
MAX_MULTIPLE_FILES
*
MAX_PATH_OR_CMD
 - 1;

2514 *
p
 = '\0';

2515 
j
 = 
i
; j >= 0; j--)

2517 
p
 -
lLgths
[
j
];

2518 
	`memmove
(
p
, 
lPors
[
j
], 
lLgths
[j]);

2519 
p
--;

2520 *
p
 = '\\';

2521 
p
 -
lBuffL
;

2522 
	`memmove
(
p
, 
lBuff
, 
lBuffL
);

2523 
p
--;

2524 *
p
 = '|';

2526 
p
++;

2527 
	`ry
(
lBuff
, 
p
);

2528 
lBuffL
 = 
	`
(
lBuff
);

2531 i(
lBuff
lBuf(*)(
	`loc
Buff, (
lBuffL
 + 1) * ()));

2534 i(
lHResu
==
S_OK
 ||HResu==
S_FALSE
)

2536 
	`CoUnlize
();

2538  
lBuff
;

2539 
	}
}

2542 * 
	$FdDlogWGuiA
(

2543 * 
aoBuff
 ,

2544 cڡ * 
aT
 ,

2545 cڡ * 
aDeuPh
 )

2547 
BROWSEINFOA
 
bInfo
 ;

2548 
LPITEMIDLIST
 
Im
 ;

2549 
HRESULT
 
lHResu
 ;

2550 * 
lRv
 = 
NULL
 ;

2552 
lHResu
 = 
	`CoInlizeEx
(
NULL
, 
COINIT_APARTMENTTHREADED
);

2555 
bInfo
.
hwndOwr
 = 
	`GFegroundWdow
();

2556 
bInfo
.
pidlRo
 = 
NULL
 ;

2557 
bInfo
.
pszDiyName
 = 
aoBuff
 ;

2558 
bInfo
.
szT
 = 
aT
 && 
	`
T?T : 
NULL
;

2559 i(
lHResu
 =
S_OK
 ||HResu =
S_FALSE
)

2561 
bInfo
.
ulFgs
 = 
BIF_USENEWUI
;

2563 
bInfo
.

 = 
BrowClbackProc
;

2564 
bInfo
.
lPam
 = (
LPARAM
)
aDeuPh
;

2565 
bInfo
.
iImage
 = -1 ;

2567 
Im
 = 
	`SHBrowFFdA
& 
bInfo
 ) ;

2568 i
Im
 )

2570 
	`SHGPhFromIDLiA

Im
 , 
aoBuff
 ) ;

2571 
lRv
 = 
aoBuff
;

2574 i(
lHResu
==
S_OK
 ||HResu==
S_FALSE
)

2576 
	`CoUnlize
();

2578  
lRv
;

2579 
	}
}

2582 * 
	$cChoorWGuiA
(

2583 cڡ * 
aT
,

2584 cڡ * 
aDeuHexRGB
,

2585 cڡ 
aDeuRGB
[3],

2586 
aoResuRGB
[3])

2588 
lResuHexRGB
[8];

2590 
CHOOSECOLORA
 
cc
;

2591 
COLORREF
 
CuCs
[16];

2592 
lDeuRGB
[3];

2593 
lR
;

2595 i
aDeuHexRGB
 )

2597 
	`Hex2RGB
(
aDeuHexRGB
, 
lDeuRGB
);

2601 
lDeuRGB
[0]=
aDeuRGB
[0];

2602 
lDeuRGB
[1]=
aDeuRGB
[1];

2603 
lDeuRGB
[2]=
aDeuRGB
[2];

2607 
cc
.
lSuSize
 = 
CHOOSECOLOR
 ) ;

2608 
cc
.
hwndOwr
 = 
	`GFegroundWdow
();

2609 
cc
.
hIn
 = 
NULL
 ;

2610 
cc
.
rgbResu
 = 
	`RGB
(
lDeuRGB
[0],DefaultRGB[1],DefaultRGB[2]);

2611 
cc
.
CuCs
 = 
CuCs
;

2612 
cc
.
Fgs
 = 
CC_RGBINIT
 | 
CC_FULLOPEN
;

2613 
cc
.
lCuDa
 = 0;

2614 
cc
.
Hook
 = 
NULL
;

2615 
cc
.
TemeName
 = 
NULL
;

2617 
lR
 = 
	`ChooCA
(&
cc
);

2619 i! 
lR
 )

2621  
NULL
;

2624 
aoResuRGB
[0] = 
	`GRVue
(
cc
.
rgbResu
);

2625 
aoResuRGB
[1] = 
	`GGVue
(
cc
.
rgbResu
);

2626 
aoResuRGB
[2] = 
	`GBVue
(
cc
.
rgbResu
);

2628 
	`RGB2Hex
(
aoResuRGB
, 
lResuHexRGB
);

2630  
lResuHexRGB
;

2631 
	}
}

2635 
	$dlogP
()

2637 
lDlogP
 = -1 ;

2638 
lBuff
 [
MAX_PATH_OR_CMD
] ;

2639 
FILE
 * 
lIn
 ;

2640 cڡ * 
lSg
 = "dialog.exe";

2641 i(!
tyfd_lowCursDlogs
)  0;

2642 i(
lDlogP
 < 0)

2644 i(!(
lIn
 = 
	`_pݒ
("where dialog.exe","r")))

2646 
lDlogP
 = 0 ;

2649  
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

2651 
	`_po

lIn
 ) ;

2652 i
lBuff
[
	`
(Buff ) -1] == '\n' )

2654 
lBuff
[
	`
(Buff ) -1] = '\0' ;

2656 i
	`rcmp
(
lBuff
+
	`
Buff)-(
lSg
),lString) )

2658 
lDlogP
 = 0 ;

2662 
lDlogP
 = 1 ;

2665  
lDlogP
;

2666 
	}
}

2669 
	$mesgeBoxWCse
(

2670 cڡ * 
aT
 ,

2671 cڡ * 
aMesge
 ,

2672 cڡ * 
aDlogTy
 ,

2673 cڡ * 
aIcTy
 ,

2674 
aDeuBu
 )

2676 
lDlogSg
[
MAX_PATH_OR_CMD
];

2677 
lDlogFe
[
MAX_PATH_OR_CMD
];

2678 
FILE
 * 
lIn
;

2679 
lBuff
 [
MAX_PATH_OR_CMD
] = "";

2681 
	`ry
(
lDlogSg
, "dialog ");

2682 i(
aT
 && 
	`
(aTitle))

2684 
	`rt
(
lDlogSg
, "--title \"") ;

2685 
	`rt
(
lDlogSg
, 
aT
) ;

2686 
	`rt
(
lDlogSg
, "\" ") ;

2689 i
aDlogTy
 && ( !
	`rcmp
( "okcancel" ,DialogType )

2690 || !
	`rcmp
("yeo", 
aDlogTy
) || !strcmp("yesnocancel",DialogType) ) )

2692 
	`rt
(
lDlogSg
, "--backtitle \"") ;

2693 
	`rt
(
lDlogSg
, "tab: move focus") ;

2694 
	`rt
(
lDlogSg
, "\" ") ;

2697 i
aDlogTy
 && ! 
	`rcmp
( "okcancel" ,DialogType ) )

2699 i! 
aDeuBu
 )

2701 
	`rt

lDlogSg
 , "--defaultno " ) ;

2703 
	`rt

lDlogSg
 ,

2706 i
aDlogTy
 && ! 
	`rcmp
( "yesno" ,DialogType ) )

2708 i! 
aDeuBu
 )

2710 
	`rt

lDlogSg
 , "--defaultno " ) ;

2712 
	`rt

lDlogSg
 , "--yesno " ) ;

2714 i(
aDlogTy
 && !
	`rcmp
("yesnocancel",DialogType))

2716 i(!
aDeuBu
)

2718 
	`rt
(
lDlogSg
, "--defaultno ");

2720 
	`rt
(
lDlogSg
, "--menu ");

2724 
	`rt

lDlogSg
 , "--msgbox " ) ;

2727 
	`rt

lDlogSg
 , "\"" ) ;

2728 i
aMesge
 && 
	`
(aMessage) )

2730 
	`aSubS

aMesge
 , "\n" , "\\n" , 
lBuff
 ) ;

2731 
	`rt
(
lDlogSg
, 
lBuff
) ;

2732 
lBuff
[0]='\0';

2734 
	`rt
(
lDlogSg
, "\" ");

2736 i(
aDlogTy
 && !
	`rcmp
("yesnocancel",DialogType))

2738 
	`rt
(
lDlogSg
, "0 60 0 Yes \"\" No \"\"");

2739 
	`rt
(
lDlogSg
, "2>>");

2743 
	`rt
(
lDlogSg
, "10 60");

2744 
	`rt
(
lDlogSg
, " &&cho 1 > ");

2747 
	`ry
(
lDlogFe
, 
	`gv
("USERPROFILE"));

2748 
	`rt
(
lDlogFe
, "\\AppData\\Local\\Temp\\tinyfd.txt");

2749 
	`rt
(
lDlogSg
, 
lDlogFe
);

2752 
	`syem

lDlogSg
 ) ;

2754 i(!(
lIn
 = 
	`fݒ
(
lDlogFe
, "r")))

2756 
	`move
(
lDlogFe
);

2759 
	`fgs
(
lBuff
, Buff), 
lIn
!
NULL
)

2761 
	`fo
(
lIn
);

2762 
	`move
(
lDlogFe
);

2763 i
lBuff
[
	`
(Buff ) -1] == '\n' )

2765 
lBuff
[
	`
(Buff ) -1] = '\0' ;

2769 i! 
	`
(
lBuff
) )

2774 i(
aDlogTy
 && !
	`rcmp
("yesnocancel",DialogType))

2776 i(
lBuff
[0] == 'Y')  1;

2781 
	}
}

2784 
	$putBoxWCse
(

2785 * 
aoBuff
 ,

2786 cڡ * 
aT
 ,

2787 cڡ * 
aMesge
 ,

2788 cڡ * 
aDeuIut
 )

2790 
lDlogSg
[
MAX_PATH_OR_CMD
];

2791 
lDlogFe
[
MAX_PATH_OR_CMD
];

2792 
FILE
 * 
lIn
;

2793 
lResu
;

2795 
	`ry
(
lDlogFe
, 
	`gv
("USERPROFILE"));

2796 
	`rt
(
lDlogFe
, "\\AppData\\Local\\Temp\\tinyfd.txt");

2797 
	`ry
(
lDlogSg
 , "echo|set /p=1 >" ) ;

2798 
	`rt
(
lDlogSg
, 
lDlogFe
);

2799 
	`rt

lDlogSg
 , " & " ) ;

2801 
	`rt

lDlogSg
 , "dialog " ) ;

2802 i
aT
 && 
	`
(aTitle) )

2804 
	`rt
(
lDlogSg
, "--title \"") ;

2805 
	`rt
(
lDlogSg
, 
aT
) ;

2806 
	`rt
(
lDlogSg
, "\" ") ;

2809 
	`rt
(
lDlogSg
, "--backtitle \"") ;

2810 
	`rt
(
lDlogSg
, "tab: move focus") ;

2811 i! 
aDeuIut
 )

2813 
	`rt
(
lDlogSg
, " (sometimesothing,o blinkor star, is shown inext field)") ;

2816 
	`rt
(
lDlogSg
, "\" ") ;

2818 i! 
aDeuIut
 )

2820 
	`rt

lDlogSg
 , "--insecure --passwordbox" ) ;

2824 
	`rt

lDlogSg
 , "--inputbox" ) ;

2826 
	`rt

lDlogSg
 , " \"" ) ;

2827 i
aMesge
 && 
	`
(aMessage) )

2829 
	`rt
(
lDlogSg
, 
aMesge
) ;

2831 
	`rt
(
lDlogSg
,"\" 10 60 ") ;

2832 i
aDeuIut
 && 
	`
(aDefaultInput) )

2834 
	`rt
(
lDlogSg
, "\"") ;

2835 
	`rt
(
lDlogSg
, 
aDeuIut
) ;

2836 
	`rt
(
lDlogSg
, "\" ") ;

2839 
	`rt
(
lDlogSg
, "2>>");

2840 
	`ry
(
lDlogFe
, 
	`gv
("USERPROFILE"));

2841 
	`rt
(
lDlogFe
, "\\AppData\\Local\\Temp\\tinyfd.txt");

2842 
	`rt
(
lDlogSg
, 
lDlogFe
);

2843 
	`rt
(
lDlogSg
, " ||cho 0 > ");

2844 
	`rt
(
lDlogSg
, 
lDlogFe
);

2847 
	`syem

lDlogSg
 ) ;

2849 i(!(
lIn
 = 
	`fݒ
(
lDlogFe
, "r")))

2851 
	`move
(
lDlogFe
);

2852 
aoBuff
[0] = '\0';

2855 
	`fgs
(
aoBuff
, 
MAX_PATH_OR_CMD
, 
lIn
!
NULL
)

2857 
	`fo
(
lIn
);

2859 
	`wefe
(
lDlogFe
);

2860 
	`move
(
lDlogFe
);

2861 i
aoBuff
[
	`
(oBuff ) -1] == '\n' )

2863 
aoBuff
[
	`
(oBuff ) -1] = '\0' ;

2868 
lResu
 = 
	`cmp

aoBuff
 , "1" , 1) ? 0 : 1 ;

2870 i! 
lResu
 )

2872 
aoBuff
[0] = '\0';

2876 
	`ry
(
aoBuff
,oBuff+3);

2878 
	}
}

2881 * 
	$veFeDlogWCse
(

2882 * 
aoBuff
 ,

2883 cڡ * 
aT
 ,

2884 cڡ * 
aDeuPhAndFe
 )

2886 
lDlogSg
[
MAX_PATH_OR_CMD
];

2887 
lPhAndFe
[
MAX_PATH_OR_CMD
] = "";

2888 
FILE
 * 
lIn
;

2890 
	`ry

lDlogSg
 , "dialog " ) ;

2891 i
aT
 && 
	`
(aTitle) )

2893 
	`rt
(
lDlogSg
, "--title \"") ;

2894 
	`rt
(
lDlogSg
, 
aT
) ;

2895 
	`rt
(
lDlogSg
, "\" ") ;

2898 
	`rt
(
lDlogSg
, "--backtitle \"") ;

2899 
	`rt
(
lDlogSg
,

2901 
	`rt
(
lDlogSg
, "\" ") ;

2903 
	`rt

lDlogSg
 , "--fselect \"" ) ;

2904 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

2907 
	`ry
(
lPhAndFe
, 
aDeuPhAndFe
);

2908 
	`aChr

lPhAndFe
 , '\\' , '/' ) ;

2912 i! 
	`rchr
(
lPhAndFe
, '/') )

2914 
	`rt
(
lDlogSg
, "./") ;

2916 
	`rt
(
lDlogSg
, 
lPhAndFe
) ;

2917 
	`rt
(
lDlogSg
, "\" 0 60 2>");

2918 
	`ry
(
lPhAndFe
, 
	`gv
("USERPROFILE"));

2919 
	`rt
(
lPhAndFe
, "\\AppData\\Local\\Temp\\tinyfd.txt");

2920 
	`rt
(
lDlogSg
, 
lPhAndFe
);

2923 
	`syem

lDlogSg
 ) ;

2925 i(!(
lIn
 = 
	`fݒ
(
lPhAndFe
, "r")))

2927 
	`move
(
lPhAndFe
);

2928  
NULL
;

2930 
	`fgs
(
aoBuff
, 
MAX_PATH_OR_CMD
, 
lIn
!
NULL
)

2932 
	`fo
(
lIn
);

2933 
	`move
(
lPhAndFe
);

2934 
	`aChr

aoBuff
 , '/' , '\\' ) ;

2936 
	`gLaName
(
lDlogSg
,
aoBuff
);

2937 i! 
	`
(
lDlogSg
) )

2939  
NULL
;

2941  
aoBuff
;

2942 
	}
}

2945 * 
	$ݒFeDlogWCse
(

2946 cڡ * 
aT
 ,

2947 cڡ * 
aDeuPhAndFe
 )

2949 
lFrPs
[
MAX_PATH_OR_CMD
] = "";

2950 
lDlogSg
[
MAX_PATH_OR_CMD
] ;

2951 
FILE
 * 
lIn
;

2953 
aoBuff
[
MAX_PATH_OR_CMD
];

2955 
	`ry

lDlogSg
 , "dialog " ) ;

2956 i
aT
 && 
	`
(aTitle) )

2958 
	`rt
(
lDlogSg
, "--title \"") ;

2959 
	`rt
(
lDlogSg
, 
aT
) ;

2960 
	`rt
(
lDlogSg
, "\" ") ;

2963 
	`rt
(
lDlogSg
, "--backtitle \"") ;

2964 
	`rt
(
lDlogSg
,

2966 
	`rt
(
lDlogSg
, "\" ") ;

2968 
	`rt

lDlogSg
 , "--fselect \"" ) ;

2969 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

2972 
	`ry
(
lFrPs
, 
aDeuPhAndFe
);

2973 
	`aChr

lFrPs
 , '\\' , '/' ) ;

2977 i! 
	`rchr
(
lFrPs
, '/') )

2979 
	`rt
(
lDlogSg
, "./") ;

2981 
	`rt
(
lDlogSg
, 
lFrPs
) ;

2982 
	`rt
(
lDlogSg
, "\" 0 60 2>");

2983 
	`ry
(
lFrPs
, 
	`gv
("USERPROFILE"));

2984 
	`rt
(
lFrPs
, "\\AppData\\Local\\Temp\\tinyfd.txt");

2985 
	`rt
(
lDlogSg
, 
lFrPs
);

2988 
	`syem

lDlogSg
 ) ;

2990 i(!(
lIn
 = 
	`fݒ
(
lFrPs
, "r")))

2992 
	`move
(
lFrPs
);

2993  
NULL
;

2995 
	`fgs
(
aoBuff
, 
MAX_PATH_OR_CMD
, 
lIn
!
NULL
)

2997 
	`fo
(
lIn
);

2998 
	`move
(
lFrPs
);

2999 
	`aChr

aoBuff
 , '/' , '\\' ) ;

3001  
aoBuff
;

3002 
	}
}

3005 * 
	$FdDlogWCse
(

3006 * 
aoBuff
 ,

3007 cڡ * 
aT
 ,

3008 cڡ * 
aDeuPh
 )

3010 
lDlogSg
 [
MAX_PATH_OR_CMD
] ;

3011 
lSg
 [
MAX_PATH_OR_CMD
] ;

3012 
FILE
 * 
lIn
 ;

3014 
	`ry

lDlogSg
 , "dialog " ) ;

3015 i
aT
 && 
	`
(aTitle) )

3017 
	`rt
(
lDlogSg
, "--title \"") ;

3018 
	`rt
(
lDlogSg
, 
aT
) ;

3019 
	`rt
(
lDlogSg
, "\" ") ;

3022 
	`rt
(
lDlogSg
, "--backtitle \"") ;

3023 
	`rt
(
lDlogSg
,

3025 
	`rt
(
lDlogSg
, "\" ") ;

3027 
	`rt

lDlogSg
 , "--dselect \"" ) ;

3028 i
aDeuPh
 && 
	`
(aDefaultPath) )

3031 
	`ry
(
lSg
, 
aDeuPh
) ;

3032 
	`suFSsh
(
lSg
);

3033 
	`aChr

lSg
 , '\\' , '/' ) ;

3034 
	`rt
(
lDlogSg
, 
lSg
) ;

3039 
	`rt
(
lDlogSg
, "./") ;

3041 
	`rt
(
lDlogSg
, "\" 0 60 2>");

3042 
	`ry
(
lSg
, 
	`gv
("USERPROFILE"));

3043 
	`rt
(
lSg
, "\\AppData\\Local\\Temp\\tinyfd.txt");

3044 
	`rt
(
lDlogSg
, 
lSg
);

3047 
	`syem

lDlogSg
 ) ;

3049 i(!(
lIn
 = 
	`fݒ
(
lSg
, "r")))

3051 
	`move
(
lSg
);

3052  
NULL
;

3054 
	`fgs
(
aoBuff
, 
MAX_PATH_OR_CMD
, 
lIn
!
NULL
)

3056 
	`fo
(
lIn
);

3057 
	`move
(
lSg
);

3058 
	`aChr

aoBuff
 , '/' , '\\' ) ;

3060  
aoBuff
;

3061 
	}
}

3063 
	$wreUtf8
cڡ * 
aUtf8Sg
 )

3065 
lNum
;

3066 * 
lCseHd
;

3067 
wch_t
 * 
lTmpWCh
;

3069 
lCseHd
 = 
	`GStdHd
(
STD_OUTPUT_HANDLE
);

3070 
lTmpWCh
 = 
	`tyfd_utf8to16
(
aUtf8Sg
);

3071 ()
	`WreCseW
(
lCseHd
, 
lTmpWCh
, 
	`wc
TmpWCh), &
lNum
, 
NULL
);

3072 
	}
}

3075 
	$tyfd_mesgeBox
(

3076 cڡ * 
aT
 ,

3077 cڡ * 
aMesge
 ,

3078 cڡ * 
aDlogTy
 ,

3079 cڡ * 
aIcTy
 ,

3080 
aDeuBu
 )

3082 
lCh
 ;

3083 
UINT
 
lOrigCP
;

3084 
UINT
 
lOrigOuutCP
;

3086 #ide
TINYFD_NOLIB


3087 i((!
tyfd_fCse
 || !(
	`GCseWdow
(|| 
	`dlogP
()))

3088 && (!
	`gv
("SSH_CLIENT") || getenv("DISPLAY")))

3090 i(
aT
&&!
	`rcmp
T, "tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "windows");  1; }

3091 i(
tyfd_wUtf8
)

3093  
	`mesgeBoxWGui8
(

3094 
aT
, 
aMesge
, 
aDlogTy
, 
aIcTy
, 
aDeuBu
);

3098  
	`mesgeBoxWGuiA
(

3099 
aT
, 
aMesge
, 
aDlogTy
, 
aIcTy
, 
aDeuBu
);

3104 i
	`dlogP
() )

3106 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"dialog"); 0;}

3107  
	`mesgeBoxWCse
(

3108 
aT
,
aMesge
,
aDlogTy
,
aIcTy
,
aDeuBu
);

3112 i(!
tyfd_wUtf8
)

3114 
lOrigCP
 = 
	`GCseCP
();

3115 
lOrigOuutCP
 = 
	`GCseOuutCP
();

3116 ()
	`SCseCP
(
	`GACP
());

3117 ()
	`SCseOuutCP
(
	`GACP
());

3120 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"basicinput"); 0;}

3121 i(!
gWngDiyed
 && !
tyfd_fCse
 )

3123 
gWngDiyed
 = 1;

3124 
	`tf
("\n\n%s\n", 
gT
);

3125 
	`tf
("%s\n\n", 
tyfd_eds
);

3128 i
aT
 && 
	`
(aTitle) )

3130 
	`tf
("\n");

3131 i(
tyfd_wUtf8

	`wreUtf8
(
aT
);

3132 
	`tf
("%s", 
aT
);

3133 
	`tf
("\n\n");

3135 i
aDlogTy
 && !
	`rcmp
("yesno",aDialogType) )

3139 i
aMesge
 && 
	`
(aMessage) )

3141 i(
tyfd_wUtf8

	`wreUtf8
(
aMesge
);

3142 
	`tf
("%s",
aMesge
);

3143 
	`tf
("\n");

3145 
	`tf
("y/n: ");

3146 
lCh
 = (
	`tow

	`_gch
() ) ;

3147 
	`tf
("\n\n");

3149  
lCh
 != 'y' &&Char != 'n' ) ;

3150 i(!
tyfd_wUtf8
{ ()
	`SCseCP
(
lOrigCP
); ()
	`SCseOuutCP
(
lOrigOuutCP
); }

3151  
lCh
 == 'y' ? 1 : 0 ;

3153 i
aDlogTy
 && !
	`rcmp
("okcancel",aDialogType) )

3157 i
aMesge
 && 
	`
(aMessage) )

3159 i(
tyfd_wUtf8

	`wreUtf8
(
aMesge
);

3160 
	`tf
("%s", 
aMesge
);

3161 
	`tf
("\n");

3163 
	`tf
("[O]kay/[C]ancel: ");

3164 
lCh
 = (
	`tow

	`_gch
() ) ;

3165 
	`tf
("\n\n");

3167  
lCh
 != 'o' &&Char != 'c' ) ;

3168 i(!
tyfd_wUtf8
{ ()
	`SCseCP
(
lOrigCP
); ()
	`SCseOuutCP
(
lOrigOuutCP
); }

3169  
lCh
 == 'o' ? 1 : 0 ;

3171 i(
aDlogTy
 && !
	`rcmp
("yesnocancel",DialogType))

3175 i(
aMesge
 && 
	`
(aMessage))

3177 i(
tyfd_wUtf8

	`wreUtf8
(
aMesge
);

3178 
	`tf
("%s", 
aMesge
);

3179 
	`tf
("\n");

3181 
	`tf
("[Y]es/[N]o/[C]ancel: ");

3182 
lCh
 = ()
	`tow
(
	`_gch
());

3183 
	`tf
("\n\n");

3184 } 
lCh
 != 'y' &&Char != 'n' &&Char != 'c');

3185 i(!
tyfd_wUtf8
{ ()
	`SCseCP
(
lOrigCP
); ()
	`SCseOuutCP
(
lOrigOuutCP
); }

3186  (
lCh
 == 'y') ? 1 : (lChar == 'n') ? 2 : 0 ;

3190 i
aMesge
 && 
	`
(aMessage) )

3192 i(
tyfd_wUtf8

	`wreUtf8
(
aMesge
);

3193 
	`tf
("%s", 
aMesge
);

3194 
	`tf
("\n\n");

3196 
	`tf
("pressntero continue ");

3197 
lCh
 = (
	`_gch
() ;

3198 
	`tf
("\n\n");

3199 i(!
tyfd_wUtf8
{ ()
	`SCseCP
(
lOrigCP
); ()
	`SCseOuutCP
(
lOrigOuutCP
); }

3203 
	}
}

3207 
	$tyfd_nifyPup
(

3208 cڡ * 
aT
 ,

3209 cڡ * 
aMesge
 ,

3210 cڡ * 
aIcTy
 )

3212 #ide
TINYFD_NOLIB


3213 i((!
tyfd_fCse
 || !(

3214 
	`GCseWdow
() ||

3215 
	`dlogP
()))

3216 && ( !
	`gv
("SSH_CLIENT") || getenv("DISPLAY") ) )

3218 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"windows"); 1;}

3219  
	`nifyWGui
(
aT
, 
aMesge
, 
aIcTy
);

3223  
	`tyfd_mesgeBox
(
aT
, 
aMesge
, "ok" , 
aIcTy
, 0);

3224 
	}
}

3228 * 
	$tyfd_putBox
(

3229 cڡ * 
aT
 ,

3230 cڡ * 
aMesge
 ,

3231 cڡ * 
aDeuIut
 )

3233 
lBuff
[
MAX_PATH_OR_CMD
] = "";

3234 * 
lEOF
;

3236 
DWORD
 
mode
 = 0;

3237 
HANDLE
 
hStd
 = 
	`GStdHd
(
STD_INPUT_HANDLE
);

3239 
lNum
;

3240 * 
lCseHd
;

3241 * 
lTmpCh
;

3242 
wch_t
 
lBuffW
[1024];

3244 
UINT
 
lOrigCP
;

3245 
UINT
 
lOrigOuutCP
;

3248 i(!
aT
 && !
aMesge
 && !
aDeuIut
 
lBuff
;

3250 #ide
TINYFD_NOLIB


3251 
mode
 = 0;

3252 
hStd
 = 
	`GStdHd
(
STD_INPUT_HANDLE
);

3254 i((!
tyfd_fCse
 || !(

3255 
	`GCseWdow
() ||

3256 
	`dlogP
()))

3257 && ( !
	`gv
("SSH_CLIENT") || getenv("DISPLAY") ) )

3259 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"windows"); (*)1;}

3260 
lBuff
[0]='\0';

3261 i(
	`putBoxWGui
(
lBuff
, 
aT
, 
aMesge
, 
aDeuIut
)) Buff;

3262  
NULL
;

3266 i
	`dlogP
() )

3268 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"dialog"); (*)0;}

3269 
lBuff
[0]='\0';

3270 i(
	`putBoxWCse
(
lBuff
, 
aT
, 
aMesge
, 
aDeuIut
) ) Buff;

3271  
NULL
;

3275 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"basicinput"); (*)0;}

3276 
lBuff
[0]='\0';

3277 i(!
gWngDiyed
 && !
tyfd_fCse
)

3279 
gWngDiyed
 = 1 ;

3280 
	`tf
("\n\n%s\n", 
gT
);

3281 
	`tf
("%s\n\n", 
tyfd_eds
);

3284 i(!
tyfd_wUtf8
)

3286 
lOrigCP
 = 
	`GCseCP
();

3287 
lOrigOuutCP
 = 
	`GCseOuutCP
();

3288 ()
	`SCseCP
(
	`GACP
());

3289 ()
	`SCseOuutCP
(
	`GACP
());

3292 i(
aT
 && 
	`
(aTitle))

3294 
	`tf
("\n");

3295 i(
tyfd_wUtf8

	`wreUtf8
(
aT
);

3296 
	`tf
("%s", 
aT
);

3297 
	`tf
("\n\n");

3299 i
aMesge
 && 
	`
(aMessage) )

3301 i(
tyfd_wUtf8

	`wreUtf8
(
aMesge
);

3302 
	`tf
("%s", 
aMesge
);

3303 
	`tf
("\n");

3305 
	`tf
("(ctrl-Z +ntero cancel): ");

3306 i! 
aDeuIut
 )

3308 (
	`GCseMode
(
hStd
, &
mode
);

3309 (
	`SCseMode
(
hStd
, 
mode
 & (~
ENABLE_ECHO_INPUT
));

3311 i(
tyfd_wUtf8
)

3313 
lCseHd
 = 
	`GStdHd
(
STD_INPUT_HANDLE
);

3314 (
	`RdCseW
(
lCseHd
, 
lBuffW
, 
MAX_PATH_OR_CMD
, &
lNum
, 
NULL
);

3315 i(!
aDeuIut
)

3317 ()
	`SCseMode
(
hStd
, 
mode
);

3318 
	`tf
("\n");

3320 
lBuffW
[
lNum
] = '\0';

3321 i(
lBuffW
[
	`wc
(lBuffW) - 1] == '\n')BuffW[wcslen(lBuffW) - 1] = '\0';

3322 i(
lBuffW
[
	`wc
(lBuffW) - 1] == '\r')BuffW[wcslen(lBuffW) - 1] = '\0';

3323 
lTmpCh
 = 
	`tyfd_utf16to8
(
lBuffW
);

3324 i(
lTmpCh
)

3326 
	`ry
(
lBuff
, 
lTmpCh
);

3327  
lBuff
;

3330  
NULL
;

3334 
lEOF
 = 
	`fgs
(
lBuff
, 
MAX_PATH_OR_CMD
, 
d
);

3335 i(!
aDeuIut
)

3337 ()
	`SCseMode
(
hStd
, 
mode
);

3338 
	`tf
("\n");

3341 i(!
tyfd_wUtf8
)

3343 ()
	`SCseCP
(
lOrigCP
);

3344 ()
	`SCseOuutCP
(
lOrigOuutCP
);

3347 i(!
lEOF
)

3349  
NULL
;

3351 
	`tf
("\n");

3352 i(
	`rchr
(
lBuff
, 27))

3354  
NULL
;

3356 i(
lBuff
[
	`
(lBuff) - 1] == '\n')

3358 
lBuff
[
	`
(lBuff) - 1] = '\0';

3360  
lBuff
;

3363 
	}
}

3366 * 
	$tyfd_veFeDlog
(

3367 cڡ * 
aT
 ,

3368 cڡ * 
aDeuPhAndFe
 ,

3369 
aNumOfFrPs
 ,

3370 cڡ * cڡ * 
aFrPs
 ,

3371 cڡ * 
aSgFrDesti
 )

3373 
lBuff
 [
MAX_PATH_OR_CMD
] ;

3374 
lSg
[
MAX_PATH_OR_CMD
] ;

3375 * 
p
 ;

3376 * 
lPorIutBox
;

3377 
lBuff
[0]='\0';

3378 #ide
TINYFD_NOLIB


3379 i!
tyfd_fCse
 || !
	`GCseWdow
(|| 
	`dlogP
() ) )

3380 && ( !
	`gv
("SSH_CLIENT") || getenv("DISPLAY") ) )

3382 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"windows"); (*)1;}

3383 i(
tyfd_wUtf8
)

3385 
p
 = 
	`veFeDlogWGui8
(
lBuff
,

3386 
aT
, 
aDeuPhAndFe
, 
aNumOfFrPs
, 
aFrPs
, 
aSgFrDesti
);

3390 
p
 = 
	`veFeDlogWGuiA
(
lBuff
,

3391 
aT
, 
aDeuPhAndFe
, 
aNumOfFrPs
, 
aFrPs
, 
aSgFrDesti
);

3396 i(
	`dlogP
())

3398 i(
aT
&&!
	`rcmp
T, "tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "dialog");  (*)0; }

3399 
p
 = 
	`veFeDlogWCse
(
lBuff
, 
aT
, 
aDeuPhAndFe
);

3403 i(
aT
&&!
	`rcmp
T, "tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "basicinput");  (*)0; }

3404 
	`ry
(
lBuff
, "Save file in ");

3405 
	`rt
(
lBuff
, 
	`gCurD
());

3407 
lPorIutBox
 = 
	`tyfd_putBox
(
NULL
,NULL,NULL);

3408 i(
lPorIutBox

	`ry
(
lSg
,PointerInputBox);

3409 
p
 = 
	`tyfd_putBox
(
aT
, 
lBuff
, "");

3410 i(
p

	`ry
(
lBuff
,); lBuff[0] = '\0';

3411 i(
lPorIutBox

	`ry
PorIutBox, 
lSg
);

3412 
p
 = 
lBuff
;

3416 i! 
p
 || ! 
	`
( ) )

3418  
NULL
;

3420 
	`gPhWhoutFSsh

lSg
 , 
p
 ) ;

3421 i
	`

lSg
 ) && ! 
	`dExis
(String ) )

3423  
NULL
 ;

3425 
	`gLaName
(
lSg
,
p
);

3426 i! 
	`fameVid
(
lSg
) )

3428  
NULL
;

3430  
p
 ;

3431 
	}
}

3435 * 
	$tyfd_ݒFeDlog
(

3436 cڡ * 
aT
 ,

3437 cڡ * 
aDeuPhAndFe
 ,

3438 
aNumOfFrPs
 ,

3439 cڡ * cڡ * 
aFrPs
 ,

3440 cڡ * 
aSgFrDesti
 ,

3441 
aAowMuɝSes
 )

3443 
lSg
[
MAX_PATH_OR_CMD
];

3444 
lBuff
[
MAX_PATH_OR_CMD
];

3445 * 
p
;

3446 * 
lPorIutBox
;

3448 #ide
TINYFD_NOLIB


3449 i!
tyfd_fCse
 || !
	`GCseWdow
(|| 
	`dlogP
() ) )

3450 && ( !
	`gv
("SSH_CLIENT") || getenv("DISPLAY") ) )

3452 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"windows"); (*)1;}

3453 i(
tyfd_wUtf8
)

3455 
p
 = 
	`ݒFeDlogWGui8

aT
, 
aDeuPhAndFe
, 
aNumOfFrPs
,

3456 
aFrPs
, 
aSgFrDesti
, 
aAowMuɝSes
);

3460 
p
 = 
	`ݒFeDlogWGuiA

aT
, 
aDeuPhAndFe
, 
aNumOfFrPs
,

3461 
aFrPs
, 
aSgFrDesti
, 
aAowMuɝSes
);

3466 i(
	`dlogP
())

3468 i(
aT
&&!
	`rcmp
T, "tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "dialog");  (*)0; }

3469 
p
 = 
	`ݒFeDlogWCse
(
aT
, 
aDeuPhAndFe
);

3473 i(
aT
&&!
	`rcmp
T, "tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "basicinput");  (*)0; }

3474 
	`ry
(
lBuff
, "Open file from ");

3475 
	`rt
(
lBuff
, 
	`gCurD
());

3476 
lPorIutBox
 = 
	`tyfd_putBox
(
NULL
, NULL, NULL);

3477 i(
lPorIutBox

	`ry
(
lSg
,PointerInputBox);

3478 
p
 = 
	`tyfd_putBox
(
aT
, 
lBuff
, "");

3479 i(
p

	`ry
(
lBuff
,); lBuff[0] = '\0';

3480 i(
lPorIutBox

	`ry
PorIutBox, 
lSg
);

3481 
p
 = 
lBuff
;

3484 i! 
p
 || ! 
	`
( ) )

3486  
NULL
;

3488 i
aAowMuɝSes
 && 
	`rchr
(
p
, '|') )

3490 
p
 = 
	`suFesExi
( (*) , ) ;

3492 i! 
	`feExis
(
p
) )

3494  
NULL
 ;

3497  
p
 ;

3498 
	}
}

3501 * 
	$tyfd_FdDlog
(

3502 cڡ * 
aT
 ,

3503 cڡ * 
aDeuPh
 )

3505 
lBuff
[
MAX_PATH_OR_CMD
];

3506 * 
p
;

3507 * 
lPorIutBox
;

3508 
lSg
[
MAX_PATH_OR_CMD
];

3510 #ide
TINYFD_NOLIB


3511 i!
tyfd_fCse
 || !
	`GCseWdow
(|| 
	`dlogP
() ) )

3512 && ( !
	`gv
("SSH_CLIENT") || getenv("DISPLAY") ) )

3514 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"windows"); (*)1;}

3515 i(
tyfd_wUtf8
)

3517 
p
 = 
	`FdDlogWGui8
(
lBuff
, 
aT
, 
aDeuPh
);

3521 
p
 = 
	`FdDlogWGuiA
(
lBuff
, 
aT
, 
aDeuPh
);

3526 i(
	`dlogP
())

3528 i(
aT
&&!
	`rcmp
T, "tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "dialog");  (*)0; }

3529 
p
 = 
	`FdDlogWCse
(
lBuff
, 
aT
, 
aDeuPh
);

3533 i(
aT
&&!
	`rcmp
T, "tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "basicinput");  (*)0; }

3534 
	`ry
(
lBuff
, "Select folder from ");

3535 
	`rt
(
lBuff
, 
	`gCurD
());

3536 
lPorIutBox
 = 
	`tyfd_putBox
(
NULL
, NULL, NULL);

3537 i(
lPorIutBox

	`ry
(
lSg
,PointerInputBox);

3538 
p
 = 
	`tyfd_putBox
(
aT
, 
lBuff
, "");

3539 i(
p

	`ry
(
lBuff
,); lBuff[0] = '\0';

3540 i(
lPorIutBox

	`ry
PorIutBox, 
lSg
);

3541 
p
 = 
lBuff
;

3544 i! 
p
 || ! 
	`
а|| ! 
	`dExis
( ) )

3546  
NULL
 ;

3548  
p
 ;

3549 
	}
}

3556 * 
	$tyfd_cChoor
(

3557 cڡ * 
aT
,

3558 cڡ * 
aDeuHexRGB
,

3559 cڡ 
aDeuRGB
[3],

3560 
aoResuRGB
[3])

3562 
lDeuHexRGB
[16];

3563 
i
;

3564 * 
p
 ;

3565 * 
lPorIutBox
;

3566 
lSg
[
MAX_PATH_OR_CMD
];

3568 
lDeuHexRGB
[0] = '\0';

3570 #ide
TINYFD_NOLIB


3571 i(!
tyfd_fCse
 || !
	`GCseWdow
(|| 
	`dlogP
()) )

3572 && (!
	`gv
("SSH_CLIENT") || getenv("DISPLAY")) )

3574 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"windows"); (*)1;}

3575 i(
tyfd_wUtf8
)

3577 
p
 = 
	`cChoorWGui8
(

3578 
aT
, 
aDeuHexRGB
, 
aDeuRGB
, 
aoResuRGB
);

3579 
	`ry
(
lDeuHexRGB
, 
p
);

3583 
p
 = 
	`cChoorWGuiA
(

3584 
aT
, 
aDeuHexRGB
, 
aDeuRGB
, 
aoResuRGB
);

3585 
	`ry
(
lDeuHexRGB
, 
p
);

3587  
lDeuHexRGB
;

3592 i(
	`dlogP
())

3594 i(
aT
&&!
	`rcmp
T, "tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "dialog");  (*)0; }

3598 i(
aT
&&!
	`rcmp
T, "tyfd_quy")){ 
	`ry
(
tyfd_ڣ
, "basicinput");  (*)0; }

3601 i(
aDeuHexRGB
)

3603 
	`y
(
lDeuHexRGB
, 
aDeuHexRGB
,7);

3604 
lDeuHexRGB
[7]='\0';

3608 
	`RGB2Hex
(
aDeuRGB
, 
lDeuHexRGB
);

3611 
lPorIutBox
 = 
	`tyfd_putBox
(
NULL
, NULL, NULL);

3612 i(
lPorIutBox

	`ry
(
lSg
,PointerInputBox);

3613 
p
 = 
	`tyfd_putBox
(
aT
, "E hexgb c (i.e. #f520)", 
lDeuHexRGB
);

3615 i!
p
 || (
	`
(p) != 7) || (p[0] != '#') )

3617  
NULL
 ;

3619  
i
 = 1 ; i < 7 ; i ++ )

3621 i! 
	`isxdig
(
p
[
i
] ) )

3623  
NULL
 ;

3626 
	`Hex2RGB
(
p
,
aoResuRGB
);

3628 
	`ry
(
lDeuHexRGB
, 
p
);

3630 i(
lPorIutBox

	`ry
PorIutBox, 
lSg
);

3632  
lDeuHexRGB
;

3633 
	}
}

3638 
	ggPyth2Name
[16];

3639 
	ggPyth3Name
[16];

3640 
	ggPythName
[16];

3642 
	$isDw
()

3644 
lsIsDw
 = -1 ;

3645 
utame
 
lUtame
 ;

3646 i
lsIsDw
 < 0 )

3648 
lsIsDw
 = !
	`ume
(&
lUtame
&& !
	`rcmp
Utame.
syame
,"Darwin") ;

3650  
lsIsDw
 ;

3651 
	}
}

3654 
	$dExis
cڡ * 
aDPh
 )

3656 
DIR
 * 
lD
 ;

3657 i! 
aDPh
 || ! 
	`
(DirPath ) )

3659 
lD
 = 
	`ݒd

aDPh
 ) ;

3660 i! 
lD
 )

3664 
	`od

lD
 ) ;

3666 
	}
}

3669 
	$dePn
cڡ * 
aExecub
 )

3671 
lBuff
 [
MAX_PATH_OR_CMD
] ;

3672 
lTeedSg
 [
MAX_PATH_OR_CMD
] = "which " ;

3673 
FILE
 * 
lIn
 ;

3675 
	`rt

lTeedSg
 , 
aExecub
 ) ;

3676 
	`rt

lTeedSg
, " 2>/dev/null ");

3677 
lIn
 = 
	`pݒ

lTeedSg
 , "r" ) ;

3678 i
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

3679 && ( ! 
	`rchr

lBuff
 , ':' ) )

3680 && ( 
	`cmp
(
lBuff
, "no ", 3) ) )

3682 
	`po

lIn
 ) ;

3683 i(
tyfd_vbo

	`tf
("dePn %%d\n", 
aExecub
, 1);

3688 
	`po

lIn
 ) ;

3689 i(
tyfd_vbo

	`tf
("dePn %%d\n", 
aExecub
, 0);

3692 
	}
}

3695 * 
	$gVsi
cڡ * 
aExecub
 )

3697 
lBuff
 [
MAX_PATH_OR_CMD
] ;

3698 
lTeedSg
 [
MAX_PATH_OR_CMD
] ;

3699 
FILE
 * 
lIn
 ;

3700 * 
lTmp
 ;

3702 
	`ry

lTeedSg
 , 
aExecub
 ) ;

3703 
	`rt

lTeedSg
 , " --version" ) ;

3705 
lIn
 = 
	`pݒ

lTeedSg
 , "r" ) ;

3706 
lTmp
 = 
	`fgs

lBuff
 , lBuf, 
lIn
 ) ;

3707 
	`po

lIn
 ) ;

3709 
lTmp
 +
	`rcn
(lTmp,"0123456789");

3711  
lTmp
 ;

3712 
	}
}

3715 * 
	$gMajMPch
cڡ * 
aExecub
 )

3717 
lAay
 [3] ;

3718 * 
lTmp
 ;

3720 
lTmp
 = (*
	`gVsi
(
aExecub
);

3721 
lAay
[0] = 
	`oi

	`ok
(
lTmp
," ,.-") ) ;

3723 
lAay
[1] = 
	`oi

	`ok
(0," ,.-") ) ;

3725 
lAay
[2] = 
	`oi

	`ok
(0," ,.-") ) ;

3728 i!
lAay
[0] && !lAay[1] && !lAay[2] )  
NULL
;

3729  
lAay
 ;

3730 
	}
}

3733 
	$yCommd
cڡ * 
aCommd
 )

3735 
lBuff
 [
MAX_PATH_OR_CMD
] ;

3736 
FILE
 * 
lIn
 ;

3738 
lIn
 = 
	`pݒ

aCommd
 , "r" ) ;

3739 i
	`fgs

lBuff
 , lBuf, 
lIn
 ) =
NULL
 )

3741 
	`po

lIn
 ) ;

3746 
	`po

lIn
 ) ;

3750 
	}
}

3753 
	$isTmRug
()

3755 
lIsTmRug
 = -1 ;

3756 i
lIsTmRug
 < 0 )

3758 
lIsTmRug
 = 
	`iy
(1);

3759 i(
tyfd_vbo

	`tf
("isTmRug %d\n", 
lIsTmRug
 );

3761  
lIsTmRug
;

3762 
	}
}

3765 * 
	$dlogNameOy
()

3767 
lDlogName
[128] = "*" ;

3768 i
lDlogName
[0] == '*' )

3770 i(!
tyfd_lowCursDlogs
)

3772 
	`ry
(
lDlogName
 , "" );

3774 i
	`isDw
(&& * 
	`ry
(
lDlogName
 , "/opt/local/bin/dialog" )

3775 && 
	`dePn

lDlogName
 ) )

3777 i* 
	`ry
(
lDlogName
 , "dialog" )

3778 && 
	`dePn

lDlogName
 ) )

3782 
	`ry
(
lDlogName
 , "" );

3785  
lDlogName
 ;

3786 
	}
}

3789 
	$isDlogVsiBr09b
()

3791 cڡ * 
lDlogName
 ;

3792 * 
lVsi
 ;

3793 
lMaj
 ;

3794 
lM
 ;

3795 
lDe
 ;

3796 
lResu
 ;

3797 * 
lMP
 ;

3798 * 
lLr
 ;

3799 
lBuff
[128] ;

3803 
lDlogName
 = 
	`dlogNameOy
() ;

3804 i! 
	`
(
lDlogName
|| !(
lVsi
 = (*
	`gVsi
(lDialogName)) )  0 ;

3807 
	`ry
(
lBuff
,
lVsi
);

3808 
lMaj
 = 
	`oi

	`ok
(
lVsi
," ,.-") ) ;

3810 
lMP
 = 
	`ok
(0," ,.-abcdefghijklmnopqrstuvxyz");

3811 
lM
 = 
	`oi

lMP
 ) ;

3813 
lDe
 = 
	`oi

	`ok
(0," ,.-") ) ;

3814 i(
lDe
<0)Date = -Date;

3816 
lLr
 = 
lMP
 + 
	`
(lMinorP) ;

3817 
	`ry
(
lVsi
,
lBuff
);

3818 
	`ok
(
lLr
," ,.-");

3820 
lResu
 = (
lMaj
 > 0|| ( ( 
lM
 =9 ) && (*
lLr
 ='b'&& (
lDe
 >= 20031126) );

3822  
lResu
;

3823 
	}
}

3826 
	$whPOy
()

3828 
lWhP
 = -1 ;

3829 i(!
tyfd_lowCursDlogs
)  0;

3830 i
lWhP
 < 0 )

3832 
lWhP
 = 
	`dePn
( "whiptail" ) ;

3834  
lWhP
 ;

3835 
	}
}

3838 * 
	$rmName
()

3840 
lTmName
[128] = "*" ;

3841 
lShlName
[64] = "*" ;

3842 * 
lAay
;

3844 i
lTmName
[0] == '*' )

3846 i
	`dePn
( "bash" ) )

3848 
	`ry
(
lShlName
 , "bash -c " ) ;

3850 i
	`
(
	`dlogNameOy
()|| 
	`whPOy
() )

3852 
	`ry
(
lShlName
 , "sh -c " ) ;

3856 
	`ry
(
lTmName
 , "" ) ;

3857  
NULL
 ;

3860 i
	`isDw
() )

3862 i* 
	`ry
(
lTmName
 , "/opt/X11/bin/xterm" )

3863 && 
	`dePn

lTmName
 ) )

3865 
	`rt
(
lTmName
 , " -fa 'DejaVu Sans Mono' -fs 10 -titleinyfiledialogs -e " ) ;

3866 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3870 
	`ry
(
lTmName
 , "" ) ;

3873 i* 
	`ry
(
lTmName
,"xterm")

3874 && 
	`dePn
(
lTmName
) )

3876 
	`rt
(
lTmName
 , " -fa 'DejaVu Sans Mono' -fs 10 -titleinyfiledialogs -e " ) ;

3877 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3879 i* 
	`ry
(
lTmName
,"terminator")

3880 && 
	`dePn
(
lTmName
) )

3882 
	`rt
(
lTmName
 , " -x " ) ;

3883 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3885 i* 
	`ry
(
lTmName
,"lxterminal")

3886 && 
	`dePn
(
lTmName
) )

3888 
	`rt
(
lTmName
 , " -e " ) ;

3889 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3891 i* 
	`ry
(
lTmName
,"konsole")

3892 && 
	`dePn
(
lTmName
) )

3894 
	`rt
(
lTmName
 , " -e " ) ;

3895 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3897 i* 
	`ry
(
lTmName
,"kterm")

3898 && 
	`dePn
(
lTmName
) )

3900 
	`rt
(
lTmName
 , " -e " ) ;

3901 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3903 i* 
	`ry
(
lTmName
,"tilix")

3904 && 
	`dePn
(
lTmName
) )

3906 
	`rt
(
lTmName
 , " -e " ) ;

3907 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3909 i* 
	`ry
(
lTmName
,"xfce4-terminal")

3910 && 
	`dePn
(
lTmName
) )

3912 
	`rt
(
lTmName
 , " -x " ) ;

3913 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3915 i* 
	`ry
(
lTmName
,"mate-terminal")

3916 && 
	`dePn
(
lTmName
) )

3918 
	`rt
(
lTmName
 , " -x " ) ;

3919 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3921 i* 
	`ry
(
lTmName
,"Eterm")

3922 && 
	`dePn
(
lTmName
) )

3924 
	`rt
(
lTmName
 , " -e " ) ;

3925 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3927 i* 
	`ry
(
lTmName
,"evilvte")

3928 && 
	`dePn
(
lTmName
) )

3930 
	`rt
(
lTmName
 , " -e " ) ;

3931 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3933 i* 
	`ry
(
lTmName
,"pterm")

3934 && 
	`dePn
(
lTmName
) )

3936 
	`rt
(
lTmName
 , " -e " ) ;

3937 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3939 i* 
	`ry
(
lTmName
,"gnome-terminal")

3940 && 
	`dePn
(
lTmName
&& (
lAay
 = 
	`gMajMPch
(lTerminalName))

3941 && ((
lAay
[0]<3) || (lArray[0]==3 &&Array[1]<=6)) )

3943 
	`rt
(
lTmName
 , " --disable-factory -x " ) ;

3944 
	`rt
(
lTmName
 , 
lShlName
 ) ;

3948 
	`ry
(
lTmName
 , "" ) ;

3954 i
	`
(
lTmName
) )

3956  
lTmName
 ;

3960  
NULL
 ;

3962 
	}
}

3965 * 
	$dlogName
()

3967 * 
lDlogName
 ;

3968 
lDlogName
 = 
	`dlogNameOy
( ) ;

3969 i
	`
(
lDlogName
&& ( 
	`isTmRug
(|| 
	`rmName
() ) )

3971  
lDlogName
 ;

3975  
NULL
 ;

3977 
	}
}

3980 
	$whP
()

3982 
lWhP
 ;

3983 
lWhP
 = 
	`whPOy
( ) ;

3984 i
lWhP
 && ( 
	`isTmRug
(|| 
	`rmName
() ) )

3986  
lWhP
 ;

3992 
	}
}

3996 
	$gphicMode
()

3998  !
tyfd_fCse
 && (
	`isTmRug
(|| 
	`rmName
()) )

3999 && ( 
	`gv
("DISPLAY")

4000 || (
	`isDw
(&& (!
	`gv
("SSH_TTY") || getenv("DISPLAY") ) ) ) ;

4001 
	}
}

4004 
	$lP
()

4006 
lPalP
 = -1 ;

4007 i
lPalP
 < 0 )

4009 
lPalP
 = 
	`dePn
("pactl") ;

4011  
lPalP
 ;

4012 
	}
}

4015 
	$kP
()

4017 
lSakP
 = -1 ;

4018 i
lSakP
 < 0 )

4020 
lSakP
 = 
	`dePn
("speaker-test") ;

4022  
lSakP
 ;

4023 
	}
}

4026 
	$bxeP
()

4028 
lBxeP
 = -1 ;

4029 i
lBxeP
 < 0 )

4031 
lBxeP
 = 
	`dePn
("beep.exe") ;

4033  
lBxeP
 ;

4034 
	}
}

4037 
	$xmesgeP
()

4039 
lXmesgeP
 = -1 ;

4040 i
lXmesgeP
 < 0 )

4042 
lXmesgeP
 = 
	`dePn
("xmessage");

4044  
lXmesgeP
 && 
	`gphicMode
( ) ;

4045 
	}
}

4048 
	$gxmesgeP
()

4050 
lGxmesgeP
 = -1 ;

4051 i
lGxmesgeP
 < 0 )

4053 
lGxmesgeP
 = 
	`dePn
("gxmessage") ;

4055  
lGxmesgeP
 && 
	`gphicMode
( ) ;

4056 
	}
}

4059 
	$gmesgeP
()

4061 
lGmesgeP
 = -1 ;

4062 i
lGmesgeP
 < 0 )

4064 
lGmesgeP
 = 
	`dePn
("gmessage") ;

4066  
lGmesgeP
 && 
	`gphicMode
( ) ;

4067 
	}
}

4070 
	$nifyndP
()

4072 
lNifyndP
 = -1 ;

4073 i
lNifyndP
 < 0 )

4075 
lNifyndP
 = 
	`dePn
("notify-send") ;

4077  
lNifyndP
 && 
	`gphicMode
( ) ;

4078 
	}
}

4081 
	$P
()

4083 
lPlP
 = -1 ;

4084 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4085 
FILE
 * 
lIn
 ;

4087 i
lPlP
 < 0 )

4089 
lPlP
 = 
	`dePn
("perl") ;

4090 i
lPlP
 )

4092 
lIn
 = 
	`pݒ
( "perl -MNet::DBus -e \"Net::DBus->session->get_service('org.freedesktop.Notifications')\" 2>&1" , "r" ) ;

4093 i
	`fgs

lBuff
 , lBuf, 
lIn
 ) =
NULL
 )

4095 
lPlP
 = 2 ;

4097 
	`po

lIn
 ) ;

4098 i(
tyfd_vbo

	`tf
("-dbu%d\n", 
lPlP
);

4101  
	`gphicMode
(? 
lPlP
 : 0 ;

4102 
	}
}

4105 
	$ayP
()

4107 
lAyP
 = -1 ;

4108 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4109 
FILE
 * 
lIn
 ;

4111 i
lAyP
 < 0 )

4113 
lAyP
 = 
	`dePn
("afplay") ;

4114 i
lAyP
 )

4116 
lIn
 = 
	`pݒ
( "test -e /System/Library/Sounds/Ping.aiff ||cho Ping" , "r" ) ;

4117 i
	`fgs

lBuff
 , lBuf, 
lIn
 ) =
NULL
 )

4119 
lAyP
 = 2 ;

4121 
	`po

lIn
 ) ;

4122 i(
tyfd_vbo

	`tf
("ay %d\n", 
lAyP
);

4125  
	`gphicMode
(? 
lAyP
 : 0 ;

4126 
	}
}

4129 
	$xdlogP
()

4131 
lXdlogP
 = -1 ;

4132 i
lXdlogP
 < 0 )

4134 
lXdlogP
 = 
	`dePn
("Xdialog") ;

4136  
lXdlogP
 && 
	`gphicMode
( ) ;

4137 
	}
}

4140 
	$gdlogP
()

4142 
lGdloglP
 = -1 ;

4143 i
lGdloglP
 < 0 )

4145 
lGdloglP
 = 
	`dePn
( "gdialog" ) ;

4147  
lGdloglP
 && 
	`gphicMode
( ) ;

4148 
	}
}

4151 
	$ostP
()

4153 
lOstP
 = -1 ;

4154 i
lOstP
 < 0 )

4156 
gWngDiyed
 |!!
	`gv
("SSH_TTY");

4157 
lOstP
 = 
	`dePn
( "osascript" ) ;

4159  
lOstP
 && 
	`gphicMode
(&& !
	`gv
("SSH_TTY") ;

4160 
	}
}

4163 
	$qmaP
()

4165 
lQmaP
 = -1 ;

4166 i
lQmaP
 < 0 )

4168 
lQmaP
 = 
	`dePn
("qarma") ;

4170  
lQmaP
 && 
	`gphicMode
( ) ;

4171 
	}
}

4174 
	$medlogP
()

4176 
lMedlogP
 = -1 ;

4177 i
lMedlogP
 < 0 )

4179 
lMedlogP
 = 
	`dePn
("matedialog") ;

4181  
lMedlogP
 && 
	`gphicMode
( ) ;

4182 
	}
}

4185 
	$shmryP
()

4187 
lShmryP
 = -1 ;

4188 i
lShmryP
 < 0 )

4190 
lShmryP
 = 0 ;

4192  
lShmryP
 && 
	`gphicMode
( ) ;

4193 
	}
}

4196 
	$zyP
()

4198 
lZyP
 = -1 ;

4199 i
lZyP
 < 0 )

4201 
lZyP
 = 
	`dePn
("zenity") ;

4203  
lZyP
 && 
	`gphicMode
( ) ;

4204 
	}
}

4207 
	$zy3P
()

4209 
lZy3P
 = -1 ;

4210 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4211 
FILE
 * 
lIn
 ;

4212 
lITmp
 ;

4214 i
lZy3P
 < 0 )

4216 
lZy3P
 = 0 ;

4217 i
	`zyP
() )

4219 
lIn
 = 
	`pݒ
( "zenity --version" , "r" ) ;

4220 i
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

4222 i
	`oi
(
lBuff
) >= 3 )

4224 
lZy3P
 = 3 ;

4225 
lITmp
 = 
	`oi
(
	`ok
(
lBuff
,".")+2 ) ;

4226 i
lITmp
 >= 18 )

4228 
lZy3P
 = 5 ;

4230 i
lITmp
 >= 10 )

4232 
lZy3P
 = 4 ;

4235 i
	`oi
(
lBuff
=2 ) && (toi(
	`ok
(lBuff,".")+2 ) >= 32 ) )

4237 
lZy3P
 = 2 ;

4239 i(
tyfd_vbo

	`tf
("zy %d\n", 
lZy3P
);

4241 
	`po

lIn
 ) ;

4244  
	`gphicMode
(? 
lZy3P
 : 0 ;

4245 
	}
}

4248 
	$kdlogP
()

4250 
lKdlogP
 = -1 ;

4251 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4252 
FILE
 * 
lIn
 ;

4253 * 
lDeskt
;

4255 i
lKdlogP
 < 0 )

4257 i
	`zyP
() )

4259 
lDeskt
 = 
	`gv
("XDG_SESSION_DESKTOP");

4260 i!
lDeskt
 || ( 
	`rcmp
(lDesktop, "KDE") && strcmp(lDesktop, "lxqt") ) )

4262 
lKdlogP
 = 0 ;

4263  
lKdlogP
 ;

4267 
lKdlogP
 = 
	`dePn
("kdialog") ;

4268 i
lKdlogP
 && !
	`gv
("SSH_TTY") )

4270 
lIn
 = 
	`pݒ
( "kdialog --attach 2>&1" , "r" ) ;

4271 i
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

4273 i! 
	`rr
"Unknown" , 
lBuff
 ) )

4275 
lKdlogP
 = 2 ;

4276 i(
tyfd_vbo

	`tf
("kdlog-ch %d\n", 
lKdlogP
);

4279 
	`po

lIn
 ) ;

4281 i(
lKdlogP
 == 2)

4283 
lKdlogP
 = 1 ;

4284 
lIn
 = 
	`pݒ
( "kdialog --passivepopup 2>&1" , "r" ) ;

4285 i
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

4287 i! 
	`rr
"Unknown" , 
lBuff
 ) )

4289 
lKdlogP
 = 2 ;

4290 i(
tyfd_vbo

	`tf
("kdlog-pu%d\n", 
lKdlogP
);

4293 
	`po

lIn
 ) ;

4297  
	`gphicMode
(? 
lKdlogP
 : 0 ;

4298 
	}
}

4301 
	$osx9Br
()

4303 
lOsx9Br
 = -1 ;

4304 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4305 
FILE
 * 
lIn
 ;

4306 
V
,
v
;

4308 i
lOsx9Br
 < 0 )

4310 
lOsx9Br
 = 0 ;

4311 
lIn
 = 
	`pݒ
( "osascript -e 'set osvero system version of (system info)'" , "r" ) ;

4312 i
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

4313 && ( 2 =
	`ssnf
(
lBuff
, "%d.%d", &
V
, &
v
) ) )

4315 
V
 = V * 100 + 
v
;

4316 i
V
 >= 1009 )

4318 
lOsx9Br
 = 1 ;

4321 
	`po

lIn
 ) ;

4322 i(
tyfd_vbo

	`tf
("Osx10 = %d, %d = %s\n", 
lOsx9Br
, 
V
, 
lBuff
) ;

4324  
lOsx9Br
 ;

4325 
	}
}

4328 
	$pyth3P
()

4330 
lPyth3P
 = -1 ;

4331 
i
;

4333 i
lPyth3P
 < 0 )

4335 
lPyth3P
 = 0 ;

4336 
	`ry
(
gPyth3Name
 , "python3" ) ;

4337 i
	`dePn
(
gPyth3Name

lPyth3P
 = 1;

4340  
i
 = 9 ; i >= 0 ; i -- )

4342 
	`rtf

gPyth3Name
 , "pyth3.%d" , 
i
 ) ;

4343 i
	`dePn
(
gPyth3Name
) )

4345 
lPyth3P
 = 1;

4350 i(
tyfd_vbo

	`tf
("lPyth3P %d\n", 
lPyth3P
) ;

4351 i(
tyfd_vbo

	`tf
("gPyth3Nam%s\n", 
gPyth3Name
) ;

4353  
lPyth3P
 ;

4354 
	}
}

4357 
	$pyth2P
()

4359 
lPyth2P
 = -1 ;

4360 
i
;

4362 i
lPyth2P
 < 0 )

4364 
lPyth2P
 = 0 ;

4365 
	`ry
(
gPyth2Name
 , "python2" ) ;

4366 i
	`dePn
(
gPyth2Name

lPyth2P
 = 1;

4369  
i
 = 9 ; i >= 0 ; i -- )

4371 
	`rtf

gPyth2Name
 , "pyth2.%d" , 
i
 ) ;

4372 i
	`dePn
(
gPyth2Name
) )

4374 
lPyth2P
 = 1;

4379 i(
tyfd_vbo

	`tf
("lPyth2P %d\n", 
lPyth2P
) ;

4380 i(
tyfd_vbo

	`tf
("gPyth2Nam%s\n", 
gPyth2Name
) ;

4382  
lPyth2P
 ;

4383 
	}
}

4386 
	$tkr3P
()

4388 
lTkr3P
 = -1 ;

4389 
lPythCommd
[256];

4390 
lPythPams
[128] =

4393 i
lTkr3P
 < 0 )

4395 
lTkr3P
 = 0 ;

4396 i
	`pyth3P
() )

4398 
	`rtf

lPythCommd
 , "%%s" , 
gPyth3Name
 , 
lPythPams
 ) ;

4399 
lTkr3P
 = 
	`yCommd
(
lPythCommd
) ;

4401 i(
tyfd_vbo

	`tf
("lTkr3P %d\n", 
lTkr3P
) ;

4403  
lTkr3P
 && 
	`gphicMode
(&& !(
	`isDw
(&& 
	`gv
("SSH_TTY") );

4404 
	}
}

4407 
	$tkr2P
()

4409 
lTkr2P
 = -1 ;

4410 
lPythCommd
[256];

4411 
lPythPams
[128] =

4414 i
lTkr2P
 < 0 )

4416 
lTkr2P
 = 0 ;

4417 i
	`pyth2P
() )

4419 
	`rtf

lPythCommd
 , "%%s" , 
gPyth2Name
 , 
lPythPams
 ) ;

4420 
lTkr2P
 = 
	`yCommd
(
lPythCommd
) ;

4422 i(
tyfd_vbo

	`tf
("lTkr2P %d\n", 
lTkr2P
) ;

4424  
lTkr2P
 && 
	`gphicMode
(&& !(
	`isDw
(&& 
	`gv
("SSH_TTY") );

4425 
	}
}

4428 
	$pythDbusP
()

4430 
lDbusP
 = -1 ;

4431 
lPythCommd
[384];

4432 
lPythPams
[256] =

4437 i
lDbusP
 < 0 )

4439 
lDbusP
 = 0 ;

4440 i
	`pyth2P
() )

4442 
	`ry
(
gPythName
 , 
gPyth2Name
 ) ;

4443 
	`rtf

lPythCommd
 , "%%s" , 
gPythName
 , 
lPythPams
 ) ;

4444 
lDbusP
 = 
	`yCommd
(
lPythCommd
) ;

4447 i! 
lDbusP
 && 
	`pyth3P
() )

4449 
	`ry
(
gPythName
 , 
gPyth3Name
 ) ;

4450 
	`rtf

lPythCommd
 , "%%s" , 
gPythName
 , 
lPythPams
 ) ;

4451 
lDbusP
 = 
	`yCommd
(
lPythCommd
) ;

4454 i(
tyfd_vbo

	`tf
("lDbusP %d\n", 
lDbusP
) ;

4455 i(
tyfd_vbo

	`tf
("gPythNam%s\n", 
gPythName
) ;

4457  
lDbusP
 && 
	`gphicMode
(&& !(
	`isDw
(&& 
	`gv
("SSH_TTY") );

4458 
	}
}

4461 
	$sigHdr
(
sig
)

4463 
FILE
 * 
lIn
 ;

4464 i
lIn
 = 
	`pݒ
( "pactl unload-module module-sine" , "r" ) ) )

4466 
	`po

lIn
 ) ;

4468 
	}
}

4470 
	$tyfd_bp
()

4472 
lDlogSg
 [256] ;

4473 
FILE
 * 
lIn
 ;

4475 i
	`ostP
() )

4477 i
	`ayP
() >= 2 )

4479 
	`ry

lDlogSg
 , "afplay /System/Library/Sounds/Ping.aiff") ;

4483 
	`ry

lDlogSg
 , "osascript -e 'tellpplication \"System Events\"o beep'") ;

4486 i
	`lP
() )

4488 
	`sigl
(
SIGINT
, 
sigHdr
);

4490 
	`ry

lDlogSg
 , "thnum=$(pactload-module module-sine frequency=440);sleep .3;pactl unload-module $thnum" ) ;

4492 i
	`kP
() )

4495 
	`ry

lDlogSg
 , "( speaker-test -t sine -f 440 > /dev/tty )&id=$!;sleep .3; kill -9 $pid" ) ;

4497 i
	`bxeP
() )

4499 
	`ry

lDlogSg
 , "beep.exe 440 300" ) ;

4503 
	`ry

lDlogSg
 , "printf '\a' > /dev/tty" ) ;

4506 i(
tyfd_vbo

	`tf
"lDlogSg: %s\n" , 
lDlogSg
 ) ;

4508 i
lIn
 = 
	`pݒ

lDlogSg
 , "r" ) ) )

4510 
	`po

lIn
 ) ;

4513 i
	`lP
() )

4515 
	`sigl
(
SIGINT
, 
SIG_DFL
);

4517 
	}
}

4520 
	$tyfd_mesgeBox
(

4521 cڡ * 
aT
 ,

4522 cڡ * 
aMesge
 ,

4523 cڡ * 
aDlogTy
 ,

4524 cڡ * 
aIcTy
 ,

4525 
aDeuBu
 )

4527 
lBuff
 [
MAX_PATH_OR_CMD
] ;

4528 * 
lDlogSg
 = 
NULL
 ;

4529 * 
DlogSg
;

4530 
FILE
 * 
lIn
 ;

4531 
lWasGphicDlog
 = 0 ;

4532 
lWasXrm
 = 0 ;

4533 
lResu
 ;

4534 
lCh
 ;

4535 
rmios
 
foOri
;

4536 
rmios
 
fo
;

4537 
size_t
 
lTL
 ;

4538 
size_t
 
lMesgeL
 ;

4540 
lBuff
[0]='\0';

4542 
lTL
 = 
aT
 ? 
	`
(aTitle) : 0 ;

4543 
lMesgeL
 = 
aMesge
 ? 
	`
(aMessage) : 0 ;

4544 i!
aT
 || 
	`rcmp
(aTitle,"tinyfd_query") )

4546 
lDlogSg
 = (*
	`mloc

MAX_PATH_OR_CMD
 + 
lTL
 + 
lMesgeL
 );

4549 i
	`ostP
( ) )

4551 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"applescript"); 1;}

4553 
	`ry

lDlogSg
 , "osascript ");

4554 i! 
	`osx9Br
(
	`rt

lDlogSg
 , " -e 'tellpplication \"System Events\"' -e 'Activate'");

4555 
	`rt

lDlogSg
 , " -e 'try' -e 'set {vButton}o {buttoneturned} of ( display dialog \"") ;

4556 i
aMesge
 && 
	`
(aMessage) )

4558 
	`rt
(
lDlogSg
, 
aMesge
) ;

4560 
	`rt
(
lDlogSg
, "\" ") ;

4561 i
aT
 && 
	`
(aTitle) )

4563 
	`rt
(
lDlogSg
, "withitle \"") ;

4564 
	`rt
(
lDlogSg
, 
aT
) ;

4565 
	`rt
(
lDlogSg
, "\" ") ;

4567 
	`rt
(
lDlogSg
, "with icon ") ;

4568 i
aIcTy
 && ! 
	`rcmp
( "error" ,IconType ) )

4570 
	`rt
(
lDlogSg
, "stop " ) ;

4572 i
aIcTy
 && ! 
	`rcmp
( "warning" ,IconType ) )

4574 
	`rt
(
lDlogSg
, "caution " ) ;

4578 
	`rt
(
lDlogSg
, "note " ) ;

4580 i
aDlogTy
 && ! 
	`rcmp
( "okcancel" ,DialogType ) )

4582 i! 
aDeuBu
 )

4584 
	`rt

lDlogSg
 ,"default button \"Cancel\" " ) ;

4587 i
aDlogTy
 && ! 
	`rcmp
( "yesno" ,DialogType ) )

4589 
	`rt

lDlogSg
 ,"buttons {\"No\", \"Yes\"} " ) ;

4590 i(
aDeuBu
)

4592 
	`rt

lDlogSg
 ,"default button \"Yes\" " ) ;

4596 
	`rt

lDlogSg
 ,"default button \"No\" " ) ;

4598 
	`rt

lDlogSg
 ,"cancel button \"No\"" ) ;

4600 i
aDlogTy
 && ! 
	`rcmp
( "yesnocancel" ,DialogType ) )

4602 
	`rt

lDlogSg
 ,"buttons {\"No\", \"Yes\", \"Cancel\"} " ) ;

4603 
aDeuBu
)

4605 1: 
	`rt

lDlogSg
 ,"default button \"Yes\" " ) ; ;

4606 2: 
	`rt

lDlogSg
 ,"default button \"No\" " ) ; ;

4607 0: 
	`rt

lDlogSg
 ,"default button \"Cancel\" " ) ; ;

4609 
	`rt

lDlogSg
 ,"cancel button \"Cancel\"" ) ;

4613 
	`rt

lDlogSg
 ,"buttons {\"OK\"} " ) ;

4614 
	`rt

lDlogSg
 ,"default button \"OK\" " ) ;

4616 
	`rt

lDlogSg
, ")' ") ;

4618 
	`rt

lDlogSg
,

4624 
	`rt

lDlogSg
, "-e 'onrrorumber -128' " ) ;

4625 
	`rt

lDlogSg
, "-e '0' " );

4627 
	`rt

lDlogSg
, "-e 'endry'") ;

4628 i! 
	`osx9Br
(
	`rt

lDlogSg
, " -e 'endell'") ;

4630 i
	`kdlogP
() )

4632 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"kdialog"); 1;}

4634 
	`ry

lDlogSg
 , "kdialog" ) ;

4635 i
	`kdlogP
() == 2 )

4637 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

4640 
	`rt

lDlogSg
 , " --" ) ;

4641 i
aDlogTy
 && ( ! 
	`rcmp
( "okcancel" ,DialogType )

4642 || ! 
	`rcmp
"yeo" , 
aDlogTy
 ) || ! strcmp( "yesnocancel" ,DialogType ) ) )

4644 i
aIcTy
 && ( ! 
	`rcmp
( "warning" ,IconType )

4645 || ! 
	`rcmp
"r" , 
aIcTy
 ) ) )

4647 
	`rt

lDlogSg
 , "warning" ) ;

4649 i! 
	`rcmp
"yeonl" , 
aDlogTy
 ) )

4651 
	`rt

lDlogSg
 , "yesnocancel" ) ;

4655 
	`rt

lDlogSg
 , "yesno" ) ;

4658 i
aIcTy
 && ! 
	`rcmp
( "error" ,IconType ) )

4660 
	`rt

lDlogSg
 , "error" ) ;

4662 i
aIcTy
 && ! 
	`rcmp
( "warning" ,IconType ) )

4664 
	`rt

lDlogSg
 , "sorry" ) ;

4668 
	`rt

lDlogSg
 , "msgbox" ) ;

4670 
	`rt

lDlogSg
 , " \"" ) ;

4671 i
aMesge
 )

4673 
	`rt

lDlogSg
 , 
aMesge
 ) ;

4675 
	`rt

lDlogSg
 , "\"" ) ;

4676 i
aDlogTy
 && ! 
	`rcmp
( "okcancel" ,DialogType ) )

4678 
	`rt

lDlogSg
 ,

4681 i
aT
 && 
	`
(aTitle) )

4683 
	`rt
(
lDlogSg
, " --title \"") ;

4684 
	`rt
(
lDlogSg
, 
aT
) ;

4685 
	`rt
(
lDlogSg
, "\"") ;

4688 i! 
	`rcmp
"yeonl" , 
aDlogTy
 ) )

4690 
	`rt

lDlogSg
 , "; x=$? ;if [ $x = 0 ] ;thencho 1;elif [ $x = 1 ] ;thencho 2;elsecho 0;fi");

4694 
	`rt

lDlogSg
 , ";if [ $? = 0 ];thencho 1;elsecho 0;fi");

4697 i
	`zyP
(|| 
	`medlogP
(|| 
	`shmryP
(|| 
	`qmaP
() )

4699 i
	`zyP
() )

4701 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"zenity"); 1;}

4702 
	`ry

lDlogSg
 , "szAnswer=$(zenity" ) ;

4703 i(
	`zy3P
(>4&& !
	`gv
("SSH_TTY") )

4705 
	`rt
(
lDlogSg
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

4708 i
	`medlogP
() )

4710 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"matedialog"); 1;}

4711 
	`ry

lDlogSg
 , "szAnswer=$(matedialog" ) ;

4713 i
	`shmryP
() )

4715 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"shellementary"); 1;}

4716 
	`ry

lDlogSg
 , "szAnswer=$(shellementary" ) ;

4720 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"qarma"); 1;}

4721 
	`ry

lDlogSg
 , "szAnswer=$(qarma" ) ;

4722 i!
	`gv
("SSH_TTY") )

4724 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

4727 
	`rt
(
lDlogSg
, " --");

4729 i
aDlogTy
 && ! 
	`rcmp
( "okcancel" ,DialogType ) )

4731 
	`rt

lDlogSg
 ,

4734 i
aDlogTy
 && ! 
	`rcmp
( "yesno" ,DialogType ) )

4736 
	`rt

lDlogSg
 , "question" ) ;

4738 i
aDlogTy
 && ! 
	`rcmp
( "yesnocancel" ,DialogType ) )

4740 
	`rt

lDlogSg
 , "list --column \"\" --hide-header \"Yes\" \"No\"" ) ;

4742 i
aIcTy
 && ! 
	`rcmp
( "error" ,IconType ) )

4744 
	`rt

lDlogSg
 , "error" ) ;

4746 i
aIcTy
 && ! 
	`rcmp
( "warning" ,IconType ) )

4748 
	`rt

lDlogSg
 , "warning" ) ;

4752 
	`rt

lDlogSg
 , "info" ) ;

4754 i
aT
 && 
	`
(aTitle) )

4756 
	`rt
(
lDlogSg
, " --title=\"") ;

4757 
	`rt
(
lDlogSg
, 
aT
) ;

4758 
	`rt
(
lDlogSg
, "\"") ;

4760 i
aMesge
 && 
	`
(aMessage) )

4762 
	`rt
(
lDlogSg
, " --no-wrap --text=\"") ;

4763 
	`rt
(
lDlogSg
, 
aMesge
) ;

4764 
	`rt
(
lDlogSg
, "\"") ;

4766 i(
	`zy3P
(>3|| (!
	`zyP
(&& (
	`shmryP
(|| 
	`qmaP
()) ) )

4768 
	`rt

lDlogSg
 , " --icon-name=dialog-" ) ;

4769 i
aIcTy
 && (! 
	`rcmp
( "question" ,IconType )

4770 || ! 
	`rcmp
"r" , 
aIcTy
 )

4771 || ! 
	`rcmp
"wng" , 
aIcTy
 ) ) )

4773 
	`rt

lDlogSg
 , 
aIcTy
 ) ;

4777 
	`rt

lDlogSg
 , "information" ) ;

4781 i(
tyfd_st

	`rt

lDlogSg
 , " 2>/dev/null ");

4783 i! 
	`rcmp
"yeonl" , 
aDlogTy
 ) )

4785 
	`rt

lDlogSg
 ,

4790 
	`rt

lDlogSg
 , ");if [ $? = 0 ];thencho 1;elsecho 0;fi");

4793 i!
	`gxmesgeP
(&& !
	`gmesgeP
(&& !
	`gdlogP
(&& !
	`xdlogP
(&& 
	`tkr3P
() )

4795 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python3-tkinter"); 1;}

4797 
	`ry

lDlogSg
 , 
gPyth3Name
 ) ;

4798 
	`rt

lDlogSg
 ,

4801 
	`rt

lDlogSg
 ,"res=messagebox." ) ;

4802 i
aDlogTy
 && ! 
	`rcmp
( "okcancel" ,DialogType ) )

4804 
	`rt

lDlogSg
 , "askokcancel(" ) ;

4805 i
aDeuBu
 )

4807 
	`rt

lDlogSg
 , "default=messagebox.OK," ) ;

4811 
	`rt

lDlogSg
 , "default=messagebox.CANCEL," ) ;

4814 i
aDlogTy
 && ! 
	`rcmp
( "yesno" ,DialogType ) )

4816 
	`rt

lDlogSg
 , "askyesno(" ) ;

4817 i
aDeuBu
 )

4819 
	`rt

lDlogSg
 , "default=messagebox.YES," ) ;

4823 
	`rt

lDlogSg
 , "default=messagebox.NO," ) ;

4826 i
aDlogTy
 && ! 
	`rcmp
( "yesnocancel" ,DialogType ) )

4828 
	`rt

lDlogSg
 , "askyesnocancel(" ) ;

4829  
aDeuBu
 )

4831 1: 
	`rt

lDlogSg
 , "default=messagebox.YES," ); ;

4832 2: 
	`rt

lDlogSg
 , "default=messagebox.NO," ); ;

4833 0: 
	`rt

lDlogSg
 , "default=messagebox.CANCEL," ); ;

4838 
	`rt

lDlogSg
 , "showinfo(" ) ;

4841 
	`rt

lDlogSg
 , "icon='" ) ;

4842 i
aIcTy
 && (! 
	`rcmp
( "question" ,IconType )

4843 || ! 
	`rcmp
"r" , 
aIcTy
 )

4844 || ! 
	`rcmp
"wng" , 
aIcTy
 ) ) )

4846 
	`rt

lDlogSg
 , 
aIcTy
 ) ;

4850 
	`rt

lDlogSg
 , "info" ) ;

4853 
	`rt
(
lDlogSg
, "',") ;

4854 i
aT
 && 
	`
(aTitle) )

4856 
	`rt
(
lDlogSg
, "title='") ;

4857 
	`rt
(
lDlogSg
, 
aT
) ;

4858 
	`rt
(
lDlogSg
, "',") ;

4860 i
aMesge
 && 
	`
(aMessage) )

4862 
	`rt
(
lDlogSg
, "message='") ;

4863 
DlogSg
 = 
lDlogSg
 + 
	`
(lDialogString);

4864 
	`aSubS

aMesge
 , "\n" , "\\n" , 
DlogSg
 ) ;

4865 
	`rt
(
lDlogSg
, "'") ;

4868 i
aDlogTy
 && ! 
	`rcmp
( "yesnocancel" ,DialogType ) )

4870 
	`rt
(
lDlogSg
, ");\n\
es is None :\n\tprint(0)\n\
es is False :\n\tprint(2)\n\
 :\n\tprint 1\n\"" ) ;

4877 
	`rt
(
lDlogSg
, ");\n\
es is False :\n\tprint(0)\n\
 :\n\tprint(1)\n\"" ) ;

4882 i!
	`gxmesgeP
(&& !
	`gmesgeP
(&& !
	`gdlogP
(&& !
	`xdlogP
(&& 
	`tkr2P
() )

4884 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python2-tkinter"); 1;}

4885 
	`ry

lDlogSg
 , "export PYTHONIOENCODING=utf-8;" ) ;

4886 
	`rt

lDlogSg
 , 
gPyth2Name
 ) ;

4887 i! 
	`isTmRug
&& 
	`isDw
( ) )

4889 
	`rt

lDlogSg
 , " -i" ) ;

4892 
	`rt

lDlogSg
 ,

4895 i
	`isDw
( ) )

4897 
	`rt

lDlogSg
 ,

4902 
	`rt

lDlogSg
 ,"res=tkMessageBox." ) ;

4903 i
aDlogTy
 && ! 
	`rcmp
( "okcancel" ,DialogType ) )

4905 
	`rt

lDlogSg
 , "askokcancel(" ) ;

4906 i
aDeuBu
 )

4908 
	`rt

lDlogSg
 , "default=tkMessageBox.OK," ) ;

4912 
	`rt

lDlogSg
 , "default=tkMessageBox.CANCEL," ) ;

4915 i
aDlogTy
 && ! 
	`rcmp
( "yesno" ,DialogType ) )

4917 
	`rt

lDlogSg
 , "askyesno(" ) ;

4918 i
aDeuBu
 )

4920 
	`rt

lDlogSg
 , "default=tkMessageBox.YES," ) ;

4924 
	`rt

lDlogSg
 , "default=tkMessageBox.NO," ) ;

4927 i
aDlogTy
 && ! 
	`rcmp
( "yesnocancel" ,DialogType ) )

4929 
	`rt

lDlogSg
 , "askyesnocancel(" ) ;

4930  
aDeuBu
 )

4932 1: 
	`rt

lDlogSg
 , "default=tkMessageBox.YES," ); ;

4933 2: 
	`rt

lDlogSg
 , "default=tkMessageBox.NO," ); ;

4934 0: 
	`rt

lDlogSg
 , "default=tkMessageBox.CANCEL," ); ;

4939 
	`rt

lDlogSg
 , "showinfo(" ) ;

4942 
	`rt

lDlogSg
 , "icon='" ) ;

4943 i
aIcTy
 && (! 
	`rcmp
( "question" ,IconType )

4944 || ! 
	`rcmp
"r" , 
aIcTy
 )

4945 || ! 
	`rcmp
"wng" , 
aIcTy
 ) ) )

4947 
	`rt

lDlogSg
 , 
aIcTy
 ) ;

4951 
	`rt

lDlogSg
 , "info" ) ;

4954 
	`rt
(
lDlogSg
, "',") ;

4955 i
aT
 && 
	`
(aTitle) )

4957 
	`rt
(
lDlogSg
, "title='") ;

4958 
	`rt
(
lDlogSg
, 
aT
) ;

4959 
	`rt
(
lDlogSg
, "',") ;

4961 i
aMesge
 && 
	`
(aMessage) )

4963 
	`rt
(
lDlogSg
, "message='") ;

4964 
DlogSg
 = 
lDlogSg
 + 
	`
(lDialogString);

4965 
	`aSubS

aMesge
 , "\n" , "\\n" , 
DlogSg
 ) ;

4966 
	`rt
(
lDlogSg
, "'") ;

4969 i
aDlogTy
 && ! 
	`rcmp
( "yesnocancel" ,DialogType ) )

4971 
	`rt
(
lDlogSg
, ");\n\
es is None :\n\tprint 0\n\
es is False :\n\tprint 2\n\
 :\n\tprint 1\n\"" ) ;

4978 
	`rt
(
lDlogSg
, ");\n\
es is False :\n\tprint 0\n\
 :\n\tprint 1\n\"" ) ;

4983 i
	`gxmesgeP
(|| 
	`gmesgeP
(|| (!
	`gdlogP
(&& !
	`xdlogP
(&& 
	`xmesgeP
()) )

4985 i
	`gxmesgeP
() )

4987 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"gxmessage"); 1;}

4988 
	`ry

lDlogSg
 , "gxmessage");

4990 i
	`gmesgeP
() )

4992 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"gmessage"); 1;}

4993 
	`ry

lDlogSg
 , "gmessage");

4997 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"xmessage"); 1;}

4998 
	`ry

lDlogSg
 , "xmessage");

5001 i
aDlogTy
 && ! 
	`rcmp
("okcancel" ,DialogType) )

5003 
	`rt

lDlogSg
 , " -buttons Ok:1,Cancel:0");

5004  
aDeuBu
 )

5006 1: 
	`rt

lDlogSg
 , " -default Ok"); ;

5007 0: 
	`rt

lDlogSg
 , " -default Cancel"); ;

5010 i
aDlogTy
 && ! 
	`rcmp
("yesno" ,DialogType) )

5012 
	`rt

lDlogSg
 , " -buttons Yes:1,No:0");

5013  
aDeuBu
 )

5015 1: 
	`rt

lDlogSg
 , " -default Yes"); ;

5016 0: 
	`rt

lDlogSg
 , " -default No"); ;

5019 i
aDlogTy
 && ! 
	`rcmp
("yesnocancel" ,DialogType) )

5021 
	`rt

lDlogSg
 , " -buttons Yes:1,No:2,Cancel:0");

5022  
aDeuBu
 )

5024 1: 
	`rt

lDlogSg
 , " -default Yes"); ;

5025 2: 
	`rt

lDlogSg
 , " -default No"); ;

5026 0: 
	`rt

lDlogSg
 , " -default Cancel"); ;

5031 
	`rt

lDlogSg
 , " -buttons Ok:1");

5032 
	`rt

lDlogSg
 , " -default Ok");

5035 
	`rt

lDlogSg
 , " -center \"");

5036 i
aMesge
 && 
	`
(aMessage) )

5038 
	`rt

lDlogSg
 , 
aMesge
 ) ;

5040 
	`rt
(
lDlogSg
, "\"" ) ;

5041 i
aT
 && 
	`
(aTitle) )

5043 
	`rt

lDlogSg
 , " -title \"");

5044 
	`rt

lDlogSg
 , 
aT
 ) ;

5045 
	`rt

lDlogSg
, "\"" ) ;

5047 
	`rt

lDlogSg
 , " ;cho $? ");

5049 i
	`xdlogP
(|| 
	`gdlogP
(|| 
	`dlogName
(|| 
	`whP
() )

5051 i
	`gdlogP
( ) )

5053 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"gdialog"); 1;}

5054 
lWasGphicDlog
 = 1 ;

5055 
	`ry

lDlogSg
 , "(gdialog " ) ;

5057 i
	`xdlogP
( ) )

5059 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"xdialog"); 1;}

5060 
lWasGphicDlog
 = 1 ;

5061 
	`ry

lDlogSg
 , "(Xdialog " ) ;

5063 i
	`dlogName
( ) )

5065 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"dialog"); 0;}

5066 i
	`isTmRug
( ) )

5068 
	`ry

lDlogSg
 , "(dialog " ) ;

5072 
lWasXrm
 = 1 ;

5073 
	`ry

lDlogSg
 , 
	`rmName
() ) ;

5074 
	`rt

lDlogSg
 , "'(" ) ;

5075 
	`rt

lDlogSg
 , 
	`dlogName
() ) ;

5076 
	`rt

lDlogSg
 , " " ) ;

5079 i
	`isTmRug
( ) )

5081 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"whiptail"); 0;}

5082 
	`ry

lDlogSg
 , "(whiptail " ) ;

5086 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"whiptail"); 0;}

5087 
lWasXrm
 = 1 ;

5088 
	`ry

lDlogSg
 , 
	`rmName
() ) ;

5089 
	`rt

lDlogSg
 , "'(whiptail " ) ;

5092 i
aT
 && 
	`
(aTitle) )

5094 
	`rt
(
lDlogSg
, "--title \"") ;

5095 
	`rt
(
lDlogSg
, 
aT
) ;

5096 
	`rt
(
lDlogSg
, "\" ") ;

5099 i!
	`xdlogP
(&& !
	`gdlogP
() )

5101 i
aDlogTy
 && ( !
	`rcmp
( "okcancel" ,DialogType ) || !strcmp( "yesno" ,DialogType )

5102 || !
	`rcmp
"yeonl" , 
aDlogTy
 ) ) )

5104 
	`rt
(
lDlogSg
, "--backtitle \"") ;

5105 
	`rt
(
lDlogSg
, "tab: move focus") ;

5106 
	`rt
(
lDlogSg
, "\" ") ;

5110 i
aDlogTy
 && ! 
	`rcmp
( "okcancel" ,DialogType ) )

5112 i! 
aDeuBu
 )

5114 
	`rt

lDlogSg
 , "--defaultno " ) ;

5116 
	`rt

lDlogSg
 ,

5119 i
aDlogTy
 && ! 
	`rcmp
( "yesno" ,DialogType ) )

5121 i! 
aDeuBu
 )

5123 
	`rt

lDlogSg
 , "--defaultno " ) ;

5125 
	`rt

lDlogSg
 , "--yesno " ) ;

5127 i(
aDlogTy
 && !
	`rcmp
("yesnocancel",DialogType))

5129 i(!
aDeuBu
)

5131 
	`rt
(
lDlogSg
, "--defaultno ");

5133 
	`rt
(
lDlogSg
, "--menu ");

5137 
	`rt

lDlogSg
 , "--msgbox " ) ;

5140 
	`rt

lDlogSg
 , "\"" ) ;

5141 i
aMesge
 && 
	`
(aMessage) )

5143 
	`rt
(
lDlogSg
, 
aMesge
) ;

5145 
	`rt
(
lDlogSg
, "\" ");

5147 i
lWasGphicDlog
 )

5149 i(
aDlogTy
 && !
	`rcmp
("yesnocancel",DialogType))

5151 
	`rt
(
lDlogSg
,"0 60 0 Yes \"\" No \"\") 2>/tmp/tinyfd.txt;\
 [ $? = 0 ];theninyfdBool=1;elseinyfdBool=0;fi;\
=$(cat /tmp/tinyfd.txt);echo $tinyfdBool$tinyfdRes") ;

5157 
	`rt
(
lDlogSg
,

5163 i(
aDlogTy
 && !
	`rcmp
("yesnocancel",DialogType))

5165 
	`rt
(
lDlogSg
,"0 60 0 Yes \"\" No \"\" >/dev/tty ) 2>/tmp/tinyfd.txt;\
 [ $? = 0 ];theninyfdBool=1;elseinyfdBool=0;fi;\
=$(cat /tmp/tinyfd.txt);echo $tinyfdBool$tinyfdRes") ;

5169 i
lWasXrm
 )

5171 
	`rt
(
lDlogSg
," >/tmp/tinyfd0.txt';cat /tmp/tinyfd0.txt");

5175 
	`rt
(
lDlogSg
, "; clear >/dev/tty") ;

5180 
	`rt
(
lDlogSg
, "10 60 >/dev/tty) 2>&1;if [ $? = 0 ];");

5181 i
lWasXrm
 )

5183 
	`rt

lDlogSg
 ,

5188 
	`rt
(
lDlogSg
,

5194 i!
	`isTmRug
(&& 
	`rmName
() )

5196 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"basicinput"); 0;}

5197 
	`ry

lDlogSg
 , 
	`rmName
() ) ;

5198 
	`rt

lDlogSg
 , "'" ) ;

5199 i!
gWngDiyed
 && !
tyfd_fCse
)

5201 
gWngDiyed
 = 1 ;

5202 
	`rt

lDlogSg
 , "echo \"" ) ;

5203 
	`rt

lDlogSg
, 
gT
) ;

5204 
	`rt

lDlogSg
 , "\";" ) ;

5205 
	`rt

lDlogSg
 , "echo \"" ) ;

5206 
	`rt

lDlogSg
, 
tyfd_eds
) ;

5207 
	`rt

lDlogSg
 , "\";echo;echo;" ) ;

5209 i
aT
 && 
	`
(aTitle) )

5211 
	`rt

lDlogSg
 , "echo \"" ) ;

5212 
	`rt

lDlogSg
, 
aT
) ;

5213 
	`rt

lDlogSg
 , "\";echo;" ) ;

5215 i
aMesge
 && 
	`
(aMessage) )

5217 
	`rt

lDlogSg
 , "echo \"" ) ;

5218 
	`rt

lDlogSg
, 
aMesge
) ;

5219 
	`rt

lDlogSg
 , "\"; " ) ;

5221 i
aDlogTy
 && !
	`rcmp
("yesno",aDialogType) )

5223 
	`rt

lDlogSg
 , "echo -n \"y/n: \"; " ) ;

5224 
	`rt

lDlogSg
 , "stty sane -echo;" ) ;

5225 
	`rt

lDlogSg
 ,

5227 
	`rt

lDlogSg
 ,

5229 
	`rt

lDlogSg
 , "\techo 1\nelse\n\techo 0\nfi" ) ;

5231 i
aDlogTy
 && !
	`rcmp
("okcancel",aDialogType) )

5233 
	`rt

lDlogSg
 , "echo -n \"[O]kay/[C]ancel: \"; " ) ;

5234 
	`rt

lDlogSg
 , "stty sane -echo;" ) ;

5235 
	`rt

lDlogSg
 ,

5237 
	`rt

lDlogSg
 ,

5239 
	`rt

lDlogSg
 , "\techo 1\nelse\n\techo 0\nfi" ) ;

5241 i
aDlogTy
 && !
	`rcmp
("yesnocancel",aDialogType) )

5243 
	`rt

lDlogSg
 , "echo -n \"[Y]es/[N]o/[C]ancel: \"; " ) ;

5244 
	`rt

lDlogSg
 , "stty sane -echo;" ) ;

5245 
	`rt

lDlogSg
 ,

5247 
	`rt

lDlogSg
 ,

5249 
	`rt

lDlogSg
 , "elifcho \"$answer\" | grep -iq \"^n\";then\n\techo 2\n" ) ;

5250 
	`rt

lDlogSg
 , "else\n\techo 0\nfi" ) ;

5254 
	`rt
(
lDlogSg
 , "echo -n \"pressntero continue \"; ");

5255 
	`rt

lDlogSg
 , "stty sane -echo;" ) ;

5256 
	`rt

lDlogSg
 ,

5259 
	`rt

lDlogSg
 ,

5262 i!
	`isTmRug
(&& 
	`pythDbusP
(&& !
	`rcmp
("ok" , 
aDlogTy
) )

5264 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python-dbus"); 1;}

5265 
	`ry

lDlogSg
 , 
gPythName
 ) ;

5266 
	`rt

lDlogSg
 ," -c \"import dbus;bus=dbus.SessionBus();");

5267 
	`rt

lDlogSg
 ,"notif=bus.get_object('org.freedesktop.Notifications','/org/freedesktop/Notifications');" ) ;

5268 
	`rt

lDlogSg
 ,"notify=dbus.Interface(notif,'org.freedesktop.Notifications');" ) ;

5269 
	`rt

lDlogSg
 ,"notify.Notify('',0,'" ) ;

5270 i
aIcTy
 && 
	`
(aIconType) )

5272 
	`rt

lDlogSg
 , 
aIcTy
 ) ;

5274 
	`rt
(
lDlogSg
, "','") ;

5275 i
aT
 && 
	`
(aTitle) )

5277 
	`rt
(
lDlogSg
, 
aT
) ;

5279 
	`rt
(
lDlogSg
, "','") ;

5280 i
aMesge
 && 
	`
(aMessage) )

5282 
DlogSg
 = 
lDlogSg
 + 
	`
(lDialogString);

5283 
	`aSubS

aMesge
 , "\n" , "\\n" , 
DlogSg
 ) ;

5285 
	`rt
(
lDlogSg
, "','','',5000)\"") ;

5287 i!
	`isTmRug
(&& (
	`P
(>2&& !
	`rcmp
("ok" , 
aDlogTy
) )

5289 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"perl-dbus"); 1;}

5291 
	`ry

lDlogSg
 , "perl -e \"use Net::DBus;\
 \\$sessionBus = Net::DBus->session;\
 \\$notificationsService = \\$sessionBus->get_service('org.freedesktop.Notifications');\
 \\$notificationsObject = \\$notificationsService->get_object('/org/freedesktop/Notifications',\
'org.freedesktop.Notifications');");

5297 
	`rtf

lDlogSg
 + 
	`
(lDialogString),

5299 
aIcTy
?aIcTy:"", 
aT
?aT:"", 
aMesge
?aMessage:"" ) ;

5301 i!
	`isTmRug
(&& 
	`nifyndP
(&& !
	`rcmp
("ok" , 
aDlogTy
) )

5304 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"notifysend"); 1;}

5305 
	`ry

lDlogSg
 , "notify-send" ) ;

5306 i
aIcTy
 && 
	`
(aIconType) )

5308 
	`rt

lDlogSg
 , " -i '" ) ;

5309 
	`rt

lDlogSg
 , 
aIcTy
 ) ;

5310 
	`rt

lDlogSg
 , "'" ) ;

5312 
	`rt

lDlogSg
 , " \"" ) ;

5313 i
aT
 && 
	`
(aTitle) )

5315 
	`rt
(
lDlogSg
, 
aT
) ;

5316 
	`rt

lDlogSg
 , " | " ) ;

5318 i
aMesge
 && 
	`
(aMessage) )

5320 
	`aSubS

aMesge
 , "\n\t" , " | " , 
lBuff
 ) ;

5321 
	`aSubS

aMesge
 , "\n" , " | " , 
lBuff
 ) ;

5322 
	`aSubS

aMesge
 , "\t" , " " , 
lBuff
 ) ;

5323 
	`rt
(
lDlogSg
, 
lBuff
) ;

5325 
	`rt

lDlogSg
 , "\"" ) ;

5329 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"basicinput"); 0;}

5330 i!
gWngDiyed
 && !
tyfd_fCse
)

5332 
gWngDiyed
 = 1 ;

5333 
	`tf
("\n\n%s\n", 
gT
);

5334 
	`tf
("%s\n\n", 
tyfd_eds
);

5336 i
aT
 && 
	`
(aTitle) )

5338 
	`tf
("\n%s\n", 
aT
);

5341 
	`tcg
(0, &
foOri
);

5342 
	`tcg
(0, &
fo
);

5343 
fo
.
c_lag
 &~
ICANON
;

5344 
fo
.
c_cc
[
VMIN
] = 1;

5345 
fo
.
c_cc
[
VTIME
] = 0;

5346 
	`tcr
(0, 
TCSANOW
, &
fo
);

5347 i
aDlogTy
 && !
	`rcmp
("yesno",aDialogType) )

5351 i
aMesge
 && 
	`
(aMessage) )

5353 
	`tf
("\n%s\n",
aMesge
);

5355 
	`tf
("y/n: "); 
	`fush
(
dout
);

5356 
lCh
 = 
	`tow

	`gch
() ) ;

5357 
	`tf
("\n\n");

5359  
lCh
 != 'y' &&Char != 'n' );

5360 
lResu
 = 
lCh
 == 'y' ? 1 : 0 ;

5362 i
aDlogTy
 && !
	`rcmp
("okcancel",aDialogType) )

5366 i
aMesge
 && 
	`
(aMessage) )

5368 
	`tf
("\n%s\n",
aMesge
);

5370 
	`tf
("[O]kay/[C]l: "); 
	`fush
(
dout
);

5371 
lCh
 = 
	`tow

	`gch
() ) ;

5372 
	`tf
("\n\n");

5374  
lCh
 != 'o' &&Char != 'c' );

5375 
lResu
 = 
lCh
 == 'o' ? 1 : 0 ;

5377 i
aDlogTy
 && !
	`rcmp
("yesnocancel",aDialogType) )

5381 i
aMesge
 && 
	`
(aMessage) )

5383 
	`tf
("\n%s\n",
aMesge
);

5385 
	`tf
("[Y]es/[N]o/[C]l: "); 
	`fush
(
dout
);

5386 
lCh
 = 
	`tow

	`gch
() ) ;

5387 
	`tf
("\n\n");

5389  
lCh
 != 'y' &&Char != 'n' &&Char != 'c' );

5390 
lResu
 = (
lCh
 == 'y') ? 1 : (lChar == 'n') ? 2 : 0 ;

5394 i
aMesge
 && 
	`
(aMessage) )

5396 
	`tf
("\n%s\n\n",
aMesge
);

5398 
	`tf
("estctu"); 
	`fush
(
dout
);

5399 
	`gch
() ;

5400 
	`tf
("\n\n");

5401 
lResu
 = 1 ;

5403 
	`tcr
(0, 
TCSANOW
, &
foOri
);

5404 
	`
(
lDlogSg
);

5405  
lResu
 ;

5408 i(
tyfd_vbo

	`tf
"lDlogSg: %s\n" , 
lDlogSg
 ) ;

5410 i! ( 
lIn
 = 
	`pݒ

lDlogSg
 , "r" ) ) )

5412 
	`
(
lDlogSg
);

5415  
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

5418 
	`po

lIn
 ) ;

5421 i
lBuff
[
	`
(Buff ) -1] == '\n' )

5423 
lBuff
[
	`
(Buff ) -1] = '\0' ;

5427 i(
aDlogTy
 && !
	`rcmp
("yesnocancel",DialogType))

5429 i
lBuff
[0]=='1' )

5431 i!
	`rcmp

lBuff
+1 , "Yes" )
	`ry
(lBuff,"1");

5432 i!
	`rcmp

lBuff
+1 , "No" )
	`ry
(lBuff,"2");

5437 
lResu
 = !
	`rcmp

lBuff
 , "2" ) ? 2 : !strcmp(Buff , "1" ) ? 1 : 0;

5440 
	`
(
lDlogSg
);

5441  
lResu
 ;

5442 
	}
}

5446 
	$tyfd_nifyPup
(

5447 cڡ * 
aT
 ,

5448 cڡ * 
aMesge
 ,

5449 cڡ * 
aIcTy
 )

5451 
lBuff
[
MAX_PATH_OR_CMD
];

5452 * 
lDlogSg
 = 
NULL
 ;

5453 * 
DlogSg
 ;

5454 
FILE
 * 
lIn
 ;

5455 
size_t
 
lTL
 ;

5456 
size_t
 
lMesgeL
 ;

5458 i
	`gv
("SSH_TTY") )

5460  
	`tyfd_mesgeBox
(
aT
, 
aMesge
, "ok", 
aIcTy
, 0);

5463 
lTL
 = 
aT
 ? 
	`
(aTitle) : 0 ;

5464 
lMesgeL
 = 
aMesge
 ? 
	`
(aMessage) : 0 ;

5465 i!
aT
 || 
	`rcmp
(aTitle,"tinyfd_query") )

5467 
lDlogSg
 = (*
	`mloc

MAX_PATH_OR_CMD
 + 
lTL
 + 
lMesgeL
 );

5470 i
	`ostP
( ) )

5472 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"applescript"); 1;}

5474 
	`ry

lDlogSg
 , "osascript ");

5475 i! 
	`osx9Br
(
	`rt

lDlogSg
 , " -e 'tellpplication \"System Events\"' -e 'Activate'");

5476 
	`rt

lDlogSg
 , " -e 'try' -e 'displayotification \"") ;

5477 i
aMesge
 && 
	`
(aMessage) )

5479 
	`rt
(
lDlogSg
, 
aMesge
) ;

5481 
	`rt
(
lDlogSg
, " \" ") ;

5482 i
aT
 && 
	`
(aTitle) )

5484 
	`rt
(
lDlogSg
, "withitle \"") ;

5485 
	`rt
(
lDlogSg
, 
aT
) ;

5486 
	`rt
(
lDlogSg
, "\" ") ;

5489 
	`rt

lDlogSg
, "' -e 'endry'") ;

5490 i! 
	`osx9Br
(
	`rt

lDlogSg
, " -e 'endell'") ;

5492 i
	`kdlogP
() )

5494 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"kdialog"); 1;}

5495 
	`ry

lDlogSg
 , "kdialog" ) ;

5497 i
aIcTy
 && 
	`
(aIconType) )

5499 
	`rt

lDlogSg
 , " --icon '" ) ;

5500 
	`rt

lDlogSg
 , 
aIcTy
 ) ;

5501 
	`rt

lDlogSg
 , "'" ) ;

5503 i
aT
 && 
	`
(aTitle) )

5505 
	`rt

lDlogSg
 , " --title \"" ) ;

5506 
	`rt

lDlogSg
 , 
aT
 ) ;

5507 
	`rt

lDlogSg
 , "\"" ) ;

5510 
	`rt

lDlogSg
 , " --passivepopup" ) ;

5511 
	`rt

lDlogSg
 , " \"" ) ;

5512 i
aMesge
 )

5514 
	`rt

lDlogSg
 , 
aMesge
 ) ;

5516 
	`rt

lDlogSg
 , " \" 5" ) ;

5518 i(
	`zy3P
()>=5|| 
	`medlogP
(|| 
	`shmryP
(|| 
	`qmaP
() )

5522 i
	`zy3P
()>=5 )

5524 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"zenity"); 1;}

5525 
	`ry

lDlogSg
 , "zenity" ) ;

5527 i
	`medlogP
() )

5529 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"matedialog"); 1;}

5530 
	`ry

lDlogSg
 , "matedialog" ) ;

5532 i
	`shmryP
() )

5534 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"shellementary"); 1;}

5535 
	`ry

lDlogSg
 , "shellementary" ) ;

5539 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"qarma"); 1;}

5540 
	`ry

lDlogSg
 , "qarma" ) ;

5543 
	`rt

lDlogSg
 , " --notification");

5545 i
aIcTy
 && 
	`
(IconType ) )

5547 
	`rt

lDlogSg
 , " --window-icon '");

5548 
	`rt

lDlogSg
 , 
aIcTy
 ) ;

5549 
	`rt

lDlogSg
 , "'" ) ;

5552 
	`rt

lDlogSg
 , " --text \"" ) ;

5553 i
aT
 && 
	`
(aTitle) )

5555 
	`rt
(
lDlogSg
, 
aT
) ;

5556 
	`rt
(
lDlogSg
, "\n") ;

5558 i
aMesge
 && 
	`
(Message ) )

5560 
	`rt

lDlogSg
 , 
aMesge
 ) ;

5562 
	`rt

lDlogSg
 , " \"" ) ;

5564 i
	`P
() >= 2 )

5566 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"perl-dbus"); 1;}

5568 
	`ry

lDlogSg
 , "perl -e \"use Net::DBus;\
 \\$sessionBus = Net::DBus->session;\
 \\$notificationsService = \\$sessionBus->get_service('org.freedesktop.Notifications');\
 \\$notificationsObject = \\$notificationsService->get_object('/org/freedesktop/Notifications',\
'org.freedesktop.Notifications');");

5574 
	`rtf

lDlogSg
 + 
	`
(lDialogString) ,

5576 
aIcTy
?aIcTy:"", 
aT
?aT:"", 
aMesge
?aMessage:"" ) ;

5578 i
	`pythDbusP
( ) )

5580 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python-dbus"); 1;}

5581 
	`ry

lDlogSg
 , 
gPythName
 ) ;

5582 
	`rt

lDlogSg
 ," -c \"import dbus;bus=dbus.SessionBus();");

5583 
	`rt

lDlogSg
 ,"notif=bus.get_object('org.freedesktop.Notifications','/org/freedesktop/Notifications');" ) ;

5584 
	`rt

lDlogSg
 ,"notify=dbus.Interface(notif,'org.freedesktop.Notifications');" ) ;

5585 
	`rt

lDlogSg
 ,"notify.Notify('',0,'" ) ;

5586 i
aIcTy
 && 
	`
(aIconType) )

5588 
	`rt

lDlogSg
 , 
aIcTy
 ) ;

5590 
	`rt
(
lDlogSg
, "','") ;

5591 i
aT
 && 
	`
(aTitle) )

5593 
	`rt
(
lDlogSg
, 
aT
) ;

5595 
	`rt
(
lDlogSg
, "','") ;

5596 i
aMesge
 && 
	`
(aMessage) )

5598 
DlogSg
 = 
lDlogSg
 + 
	`
(lDialogString);

5599 
	`aSubS

aMesge
 , "\n" , "\\n" , 
DlogSg
 ) ;

5601 
	`rt
(
lDlogSg
, "','','',5000)\"") ;

5603 i
	`nifyndP
() )

5605 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"notifysend"); 1;}

5606 
	`ry

lDlogSg
 , "notify-send" ) ;

5607 i
aIcTy
 && 
	`
(aIconType) )

5609 
	`rt

lDlogSg
 , " -i '" ) ;

5610 
	`rt

lDlogSg
 , 
aIcTy
 ) ;

5611 
	`rt

lDlogSg
 , "'" ) ;

5613 
	`rt

lDlogSg
 , " \"" ) ;

5614 i
aT
 && 
	`
(aTitle) )

5616 
	`rt
(
lDlogSg
, 
aT
) ;

5617 
	`rt

lDlogSg
 , " | " ) ;

5619 i
aMesge
 && 
	`
(aMessage) )

5621 
	`aSubS

aMesge
 , "\n\t" , " | " , 
lBuff
 ) ;

5622 
	`aSubS

aMesge
 , "\n" , " | " , 
lBuff
 ) ;

5623 
	`aSubS

aMesge
 , "\t" , " " , 
lBuff
 ) ;

5624 
	`rt
(
lDlogSg
, 
lBuff
) ;

5626 
	`rt

lDlogSg
 , "\"" ) ;

5630  
	`tyfd_mesgeBox
(
aT
, 
aMesge
, "ok", 
aIcTy
, 0);

5633 i(
tyfd_vbo

	`tf
"lDlogSg: %s\n" , 
lDlogSg
 ) ;

5635 i! ( 
lIn
 = 
	`pݒ

lDlogSg
 , "r" ) ) )

5637 
	`
(
lDlogSg
);

5641 
	`po

lIn
 ) ;

5642 
	`
(
lDlogSg
);

5644 
	}
}

5648 * 
	$tyfd_putBox
(

5649 cڡ * 
aT
 ,

5650 cڡ * 
aMesge
 ,

5651 cڡ * 
aDeuIut
 )

5653 
lBuff
[
MAX_PATH_OR_CMD
];

5654 * 
lDlogSg
 = 
NULL
;

5655 * 
DlogSg
;

5656 
FILE
 * 
lIn
 ;

5657 
lResu
 ;

5658 
lWasGdlog
 = 0 ;

5659 
lWasGphicDlog
 = 0 ;

5660 
lWasXrm
 = 0 ;

5661 
lWasBasicXrm
 = 0 ;

5662 
rmios
 
dt
 ;

5663 
rmios
 
wt
 ;

5664 * 
lEOF
;

5665 
size_t
 
lTL
 ;

5666 
size_t
 
lMesgeL
 ;

5668 i(!
aT
 && !
aMesge
 && !
aDeuIut
 
lBuff
;

5670 
lBuff
[0]='\0';

5672 
lTL
 = 
aT
 ? 
	`
(aTitle) : 0 ;

5673 
lMesgeL
 = 
aMesge
 ? 
	`
(aMessage) : 0 ;

5674 i!
aT
 || 
	`rcmp
(aTitle,"tinyfd_query") )

5676 
lDlogSg
 = (*
	`mloc

MAX_PATH_OR_CMD
 + 
lTL
 + 
lMesgeL
 );

5679 i
	`ostP
( ) )

5681 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"applescript"); (*)1;}

5682 
	`ry

lDlogSg
 , "osascript ");

5683 i! 
	`osx9Br
(
	`rt

lDlogSg
 , " -e 'tellpplication \"System Events\"' -e 'Activate'");

5684 
	`rt

lDlogSg
 , " -e 'try' -e 'display dialog \"") ;

5685 i
aMesge
 && 
	`
(aMessage) )

5687 
	`rt
(
lDlogSg
, 
aMesge
) ;

5689 
	`rt
(
lDlogSg
, "\" ") ;

5690 
	`rt
(
lDlogSg
, "defaultnswer \"") ;

5691 i
aDeuIut
 && 
	`
(aDefaultInput) )

5693 
	`rt
(
lDlogSg
, 
aDeuIut
) ;

5695 
	`rt
(
lDlogSg
, "\" ") ;

5696 i! 
aDeuIut
 )

5698 
	`rt
(
lDlogSg
, "hiddennswerrue ") ;

5700 i
aT
 && 
	`
(aTitle) )

5702 
	`rt
(
lDlogSg
, "withitle \"") ;

5703 
	`rt
(
lDlogSg
, 
aT
) ;

5704 
	`rt
(
lDlogSg
, "\" ") ;

5706 
	`rt
(
lDlogSg
, "with iconote' ") ;

5707 
	`rt
(
lDlogSg
, "-e '\"1\" &exteturned ofesult' " );

5708 
	`rt
(
lDlogSg
, "-e 'onrrorumber -128' " ) ;

5709 
	`rt
(
lDlogSg
, "-e '0' " );

5710 
	`rt
(
lDlogSg
, "-e 'endry'") ;

5711 i! 
	`osx9Br
(
	`rt
(
lDlogSg
, " -e 'endell'") ;

5713 i
	`kdlogP
() )

5715 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"kdialog"); (*)1;}

5716 
	`ry

lDlogSg
 , "szAnswer=$(kdialog" ) ;

5718 i
	`kdlogP
() == 2 )

5720 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

5723 i! 
aDeuIut
 )

5725 
	`rt
(
lDlogSg
, " --password ") ;

5729 
	`rt
(
lDlogSg
, " --inputbox ") ;

5732 
	`rt
(
lDlogSg
, "\"") ;

5733 i
aMesge
 && 
	`
(aMessage) )

5735 
	`rt
(
lDlogSg
, 
aMesge
 ) ;

5737 
	`rt
(
lDlogSg
 , "\" \"" ) ;

5738 i
aDeuIut
 && 
	`
(aDefaultInput) )

5740 
	`rt
(
lDlogSg
, 
aDeuIut
 ) ;

5742 
	`rt
(
lDlogSg
 , "\"" ) ;

5743 i
aT
 && 
	`
(aTitle) )

5745 
	`rt
(
lDlogSg
, " --title \"") ;

5746 
	`rt
(
lDlogSg
, 
aT
) ;

5747 
	`rt
(
lDlogSg
, "\"") ;

5749 
	`rt

lDlogSg
 ,

5752 i
	`zyP
(|| 
	`medlogP
(|| 
	`shmryP
(|| 
	`qmaP
() )

5754 i
	`zyP
() )

5756 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"zenity"); (*)1;}

5757 
	`ry

lDlogSg
 , "szAnswer=$(zenity" ) ;

5758 i(
	`zy3P
(>4&& !
	`gv
("SSH_TTY") )

5760 
	`rt

lDlogSg
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

5763 i
	`medlogP
() )

5765 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"matedialog"); (*)1;}

5766 
	`ry

lDlogSg
 , "szAnswer=$(matedialog" ) ;

5768 i
	`shmryP
() )

5770 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"shellementary"); (*)1;}

5771 
	`ry

lDlogSg
 , "szAnswer=$(shellementary" ) ;

5775 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"qarma"); (*)1;}

5776 
	`ry

lDlogSg
 , "szAnswer=$(qarma" ) ;

5777 i!
	`gv
("SSH_TTY") )

5779 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

5782 
	`rt

lDlogSg
 ," --entry" ) ;

5784 i
aT
 && 
	`
(aTitle) )

5786 
	`rt
(
lDlogSg
, " --title=\"") ;

5787 
	`rt
(
lDlogSg
, 
aT
) ;

5788 
	`rt
(
lDlogSg
, "\"") ;

5790 i
aMesge
 && 
	`
(aMessage) )

5792 
	`rt
(
lDlogSg
, " --text=\"") ;

5793 
	`rt
(
lDlogSg
, 
aMesge
) ;

5794 
	`rt
(
lDlogSg
, "\"") ;

5796 i
aDeuIut
 && 
	`
(aDefaultInput) )

5798 
	`rt
(
lDlogSg
, " --entry-text=\"") ;

5799 
	`rt
(
lDlogSg
, 
aDeuIut
) ;

5800 
	`rt
(
lDlogSg
, "\"") ;

5804 
	`rt
(
lDlogSg
, " --hide-text") ;

5806 i(
tyfd_st

	`rt

lDlogSg
 , " 2>/dev/null ");

5807 
	`rt

lDlogSg
 ,

5810 i
	`gxmesgeP
(|| 
	`gmesgeP
() )

5812 i
	`gxmesgeP
() ) {

5813 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"gxmessage"); (*)1;}

5814 
	`ry

lDlogSg
 , "szAnswer=$(gxmessage -buttons Ok:1,Cancel:0 -center \"");

5818 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"gmessage"); (*)1;}

5819 
	`ry

lDlogSg
 , "szAnswer=$(gmessage -buttons Ok:1,Cancel:0 -center \"");

5822 i
aMesge
 && 
	`
(aMessage) )

5824 
	`rt

lDlogSg
 , 
aMesge
 ) ;

5826 
	`rt
(
lDlogSg
, "\"" ) ;

5827 i
aT
 && 
	`
(aTitle) )

5829 
	`rt

lDlogSg
 , " -title \"");

5830 
	`rt

lDlogSg
 , 
aT
 ) ;

5831 
	`rt
(
lDlogSg
, "\" " ) ;

5833 
	`rt
(
lDlogSg
, " -entrytext \"" ) ;

5834 i
aDeuIut
 && 
	`
(aDefaultInput) )

5836 
	`rt

lDlogSg
 , 
aDeuIut
 ) ;

5838 
	`rt
(
lDlogSg
, "\"" ) ;

5839 
	`rt

lDlogSg
 , ");echo $?$szAnswer");

5841 i!
	`gdlogP
(&& !
	`xdlogP
(&& 
	`tkr3P
( ) )

5843 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python3-tkinter"); (*)1;}

5844 
	`ry

lDlogSg
 , 
gPyth3Name
 ) ;

5845 
	`rt

lDlogSg
 ,

5847 
	`rt

lDlogSg
 ,"res=simpledialog.askstring(" ) ;

5848 i
aT
 && 
	`
(aTitle) )

5850 
	`rt
(
lDlogSg
, "title='") ;

5851 
	`rt
(
lDlogSg
, 
aT
) ;

5852 
	`rt
(
lDlogSg
, "',") ;

5854 i
aMesge
 && 
	`
(aMessage) )

5857 
	`rt
(
lDlogSg
, "prompt='") ;

5858 
DlogSg
 = 
lDlogSg
 + 
	`
(lDialogString);

5859 
	`aSubS

aMesge
 , "\n" , "\\n" , 
DlogSg
 ) ;

5860 
	`rt
(
lDlogSg
, "',") ;

5862 i
aDeuIut
 )

5864 i
	`
(
aDeuIut
) )

5866 
	`rt
(
lDlogSg
, "initialvalue='") ;

5867 
	`rt
(
lDlogSg
, 
aDeuIut
) ;

5868 
	`rt
(
lDlogSg
, "',") ;

5873 
	`rt
(
lDlogSg
, "show='*'") ;

5875 
	`rt
(
lDlogSg
, ");\nifes is None :\n\tprint(0)");

5876 
	`rt
(
lDlogSg
, "\nelse :\n\tprint('1'+res)\n\"" ) ;

5878 i!
	`gdlogP
(&& !
	`xdlogP
(&& 
	`tkr2P
( ) )

5880 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python2-tkinter"); (*)1;}

5881 
	`ry

lDlogSg
 , "export PYTHONIOENCODING=utf-8;" ) ;

5882 
	`rt

lDlogSg
 , 
gPyth2Name
 ) ;

5883 i! 
	`isTmRug
&& 
	`isDw
( ) )

5885 
	`rt

lDlogSg
 , " -i" ) ;

5888 
	`rt

lDlogSg
 ,

5891 i
	`isDw
( ) )

5893 
	`rt

lDlogSg
 ,

5898 
	`rt

lDlogSg
 ,"res=tkSimpleDialog.askstring(" ) ;

5899 i
aT
 && 
	`
(aTitle) )

5901 
	`rt
(
lDlogSg
, "title='") ;

5902 
	`rt
(
lDlogSg
, 
aT
) ;

5903 
	`rt
(
lDlogSg
, "',") ;

5905 i
aMesge
 && 
	`
(aMessage) )

5908 
	`rt
(
lDlogSg
, "prompt='") ;

5909 
DlogSg
 = 
lDlogSg
 + 
	`
(lDialogString);

5910 
	`aSubS

aMesge
 , "\n" , "\\n" , 
DlogSg
 ) ;

5911 
	`rt
(
lDlogSg
, "',") ;

5913 i
aDeuIut
 )

5915 i
	`
(
aDeuIut
) )

5917 
	`rt
(
lDlogSg
, "initialvalue='") ;

5918 
	`rt
(
lDlogSg
, 
aDeuIut
) ;

5919 
	`rt
(
lDlogSg
, "',") ;

5924 
	`rt
(
lDlogSg
, "show='*'") ;

5926 
	`rt
(
lDlogSg
, ");\nifes is None :\n\tprint 0");

5927 
	`rt
(
lDlogSg
, "\nelse :\n\tprint '1'+res\n\"" ) ;

5929 i
	`gdlogP
(|| 
	`xdlogP
(|| 
	`dlogName
(|| 
	`whP
() )

5931 i
	`gdlogP
( ) )

5933 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"gdialog"); (*)1;}

5934 
lWasGphicDlog
 = 1 ;

5935 
lWasGdlog
 = 1 ;

5936 
	`ry

lDlogSg
 , "(gdialog " ) ;

5938 i
	`xdlogP
( ) )

5940 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"xdialog"); (*)1;}

5941 
lWasGphicDlog
 = 1 ;

5942 
	`ry

lDlogSg
 , "(Xdialog " ) ;

5944 i
	`dlogName
( ) )

5946 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"dialog"); (*)0;}

5947 i
	`isTmRug
( ) )

5949 
	`ry

lDlogSg
 , "(dialog " ) ;

5953 
lWasXrm
 = 1 ;

5954 
	`ry

lDlogSg
 , 
	`rmName
() ) ;

5955 
	`rt

lDlogSg
 , "'(" ) ;

5956 
	`rt

lDlogSg
 , 
	`dlogName
() ) ;

5957 
	`rt

lDlogSg
 , " " ) ;

5960 i
	`isTmRug
( ) )

5962 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"whiptail"); (*)0;}

5963 
	`ry

lDlogSg
 , "(whiptail " ) ;

5967 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"whiptail"); (*)0;}

5968 
lWasXrm
 = 1 ;

5969 
	`ry

lDlogSg
 , 
	`rmName
() ) ;

5970 
	`rt

lDlogSg
 , "'(whiptail " ) ;

5973 i
aT
 && 
	`
(aTitle) )

5975 
	`rt
(
lDlogSg
, "--title \"") ;

5976 
	`rt
(
lDlogSg
, 
aT
) ;

5977 
	`rt
(
lDlogSg
, "\" ") ;

5980 i!
	`xdlogP
(&& !
	`gdlogP
() )

5982 
	`rt
(
lDlogSg
, "--backtitle \"") ;

5983 
	`rt
(
lDlogSg
, "tab: move focus") ;

5984 i! 
aDeuIut
 && !
lWasGdlog
 )

5986 
	`rt
(
lDlogSg
, " (sometimesothing,o blinkor star, is shown inext field)") ;

5988 
	`rt
(
lDlogSg
, "\" ") ;

5991 i
aDeuIut
 || 
lWasGdlog
 )

5993 
	`rt

lDlogSg
 , "--inputbox" ) ;

5997 i!
lWasGphicDlog
 && 
	`dlogName
(&& 
	`isDlogVsiBr09b
() )

5999 
	`rt

lDlogSg
 , "--insecure " ) ;

6001 
	`rt

lDlogSg
 , "--passwordbox" ) ;

6003 
	`rt

lDlogSg
 , " \"" ) ;

6004 i
aMesge
 && 
	`
(aMessage) )

6006 
	`rt
(
lDlogSg
, 
aMesge
) ;

6008 
	`rt
(
lDlogSg
,"\" 10 60 ") ;

6009 i
aDeuIut
 && 
	`
(aDefaultInput) )

6011 
	`rt
(
lDlogSg
, "\"") ;

6012 
	`rt
(
lDlogSg
, 
aDeuIut
) ;

6013 
	`rt
(
lDlogSg
, "\" ") ;

6015 i
lWasGphicDlog
 )

6017 
	`rt
(
lDlogSg
,") 2>/tmp/tinyfd.txt;\
 [ $? = 0 ];theninyfdBool=1;elseinyfdBool=0;fi;\
=$(cat /tmp/tinyfd.txt);echo $tinyfdBool$tinyfdRes") ;

6023 
	`rt
(
lDlogSg
,">/dev/tty ) 2>/tmp/tinyfd.txt;\
 [ $? = 0 ];theninyfdBool=1;elseinyfdBool=0;fi;\
=$(cat /tmp/tinyfd.txt);echo $tinyfdBool$tinyfdRes") ;

6027 i
lWasXrm
 )

6029 
	`rt
(
lDlogSg
," >/tmp/tinyfd0.txt';cat /tmp/tinyfd0.txt");

6033 
	`rt
(
lDlogSg
, "; clear >/dev/tty") ;

6037 i! 
	`isTmRug
&& 
	`rmName
() )

6039 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"basicinput"); (*)0;}

6040 
lWasBasicXrm
 = 1 ;

6041 
	`ry

lDlogSg
 , 
	`rmName
() ) ;

6042 
	`rt

lDlogSg
 , "'" ) ;

6043 i!
gWngDiyed
 && !
tyfd_fCse
)

6045 
gWngDiyed
 = 1 ;

6046 
	`tyfd_mesgeBox
(
gT
,
tyfd_eds
,"ok","warning",0);

6048 i
aT
 && 
	`
T&& !
tyfd_fCse
)

6050 
	`rt

lDlogSg
 , "echo \"" ) ;

6051 
	`rt

lDlogSg
, 
aT
) ;

6052 
	`rt

lDlogSg
 , "\";echo;" ) ;

6055 
	`rt

lDlogSg
 , "echo \"" ) ;

6056 i
aMesge
 && 
	`
(aMessage) )

6058 
	`rt

lDlogSg
, 
aMesge
) ;

6060 
	`rt

lDlogSg
 , "\";read " ) ;

6061 i! 
aDeuIut
 )

6063 
	`rt

lDlogSg
 , "-s " ) ;

6065 
	`rt

lDlogSg
 , "-p \"" ) ;

6066 
	`rt

lDlogSg
 , "(esc+entero cancel): \" ANSWER " ) ;

6067 
	`rt

lDlogSg
 , ";echo 1$ANSWER >/tmp/tinyfd.txt';" ) ;

6068 
	`rt

lDlogSg
 , "cat -v /tmp/tinyfd.txt");

6070 i!
gWngDiyed
 && ! 
	`isTmRug
&& ! 
	`rmName
() ) {

6071 
gWngDiyed
 = 1 ;

6072 
	`tyfd_mesgeBox
(
gT
,
tyfd_eds
,"ok","warning",0);

6073 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"no_solution"); (*)0;}

6074 
	`
(
lDlogSg
);

6075  
NULL
;

6079 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"basicinput"); (*)0;}

6080 i!
gWngDiyed
 && !
tyfd_fCse
)

6082 
gWngDiyed
 = 1 ;

6083 
	`tyfd_mesgeBox
(
gT
,
tyfd_eds
,"ok","warning",0);

6085 i
aT
 && 
	`
(aTitle) )

6087 
	`tf
("\n%s\n", 
aT
);

6089 i
aMesge
 && 
	`
(aMessage) )

6091 
	`tf
("\n%s\n",
aMesge
);

6093 
	`tf
("sc+tnl): "); 
	`fush
(
dout
);

6094 i! 
aDeuIut
 )

6096 
	`tcg
(
STDIN_FILENO
, & 
dt
) ;

6097 
wt
 = 
dt
 ;

6098 
wt
.
c_lag
 &~
ECHO
 ;

6099 
	`tcr
(
STDIN_FILENO
, 
TCSANOW
, & 
wt
);

6102 
lEOF
 = 
	`fgs
(
lBuff
, 
MAX_PATH_OR_CMD
, 
d
);

6104 i! 
lEOF
 || (
lBuff
[0] == '\0') )

6106 
	`
(
lDlogSg
);

6107  
NULL
;

6110 i
lBuff
[0] == '\n' )

6112 
lEOF
 = 
	`fgs
(
lBuff
, 
MAX_PATH_OR_CMD
, 
d
);

6114 i! 
lEOF
 || (
lBuff
[0] == '\0') )

6116 
	`
(
lDlogSg
);

6117  
NULL
;

6121 i! 
aDeuIut
 )

6123 
	`tcr
(
STDIN_FILENO
, 
TCSANOW
, & 
dt
);

6124 
	`tf
("\n");

6126 
	`tf
("\n");

6127 i
	`rchr
(
lBuff
,27) )

6129 
	`
(
lDlogSg
);

6130  
NULL
 ;

6132 i
lBuff
[
	`
(Buff ) -1] == '\n' )

6134 
lBuff
[
	`
(Buff ) -1] = '\0' ;

6136 
	`
(
lDlogSg
);

6137  
lBuff
 ;

6140 i(
tyfd_vbo

	`tf
"lDlogSg: %s\n" , 
lDlogSg
 ) ;

6141 
lIn
 = 
	`pݒ

lDlogSg
 , "r" );

6142 i! 
lIn
 )

6144 i
	`feExis
("/tmp/tinyfd.txt") )

6146 
	`wefe
("/tmp/tinyfd.txt");

6147 
	`move
("/tmp/tinyfd.txt");

6149 i
	`feExis
("/tmp/tinyfd0.txt") )

6151 
	`wefe
("/tmp/tinyfd0.txt");

6152 
	`move
("/tmp/tinyfd0.txt");

6154 
	`
(
lDlogSg
);

6155  
NULL
 ;

6157  
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

6160 
	`po

lIn
 ) ;

6162 i
	`feExis
("/tmp/tinyfd.txt") )

6164 
	`wefe
("/tmp/tinyfd.txt");

6165 
	`move
("/tmp/tinyfd.txt");

6167 i
	`feExis
("/tmp/tinyfd0.txt") )

6169 
	`wefe
("/tmp/tinyfd0.txt");

6170 
	`move
("/tmp/tinyfd0.txt");

6175 i
lBuff
[
	`
(Buff ) -1] == '\n' )

6177 
lBuff
[
	`
(Buff ) -1] = '\0' ;

6180 i
lWasBasicXrm
 )

6182 i
	`rr
(
lBuff
,"^[") )

6184 
	`
(
lDlogSg
);

6185  
NULL
 ;

6189 
lResu
 = 
	`cmp

lBuff
 , "1" , 1) ? 0 : 1 ;

6191 i! 
lResu
 )

6193 
	`
(
lDlogSg
);

6194  
NULL
 ;

6198 
	`
(
lDlogSg
);

6199  
lBuff
+1 ;

6200 
	}
}

6203 * 
	$tyfd_veFeDlog
(

6204 cڡ * 
aT
 ,

6205 cڡ * 
aDeuPhAndFe
 ,

6206 
aNumOfFrPs
 ,

6207 cڡ * cڡ * 
aFrPs
 ,

6208 cڡ * 
aSgFrDesti
 )

6210 
lBuff
 [
MAX_PATH_OR_CMD
] ;

6211 
lDlogSg
 [
MAX_PATH_OR_CMD
] ;

6212 
lSg
 [
MAX_PATH_OR_CMD
] ;

6213 
i
 ;

6214 
lWasGphicDlog
 = 0 ;

6215 
lWasXrm
 = 0 ;

6216 * 
p
 ;

6217 * 
lPorIutBox
 ;

6218 
FILE
 * 
lIn
 ;

6219 
lBuff
[0]='\0';

6221 i
	`ostP
( ) )

6223 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"applescript"); (*)1;}

6224 
	`ry

lDlogSg
 , "osascript ");

6225 i! 
	`osx9Br
(
	`rt

lDlogSg
 , " -e 'tellpplication \"Finder\"' -e 'Activate'");

6226 
	`rt

lDlogSg
 , " -e 'try' -e 'POSIXath of ( choose fileame " );

6227 i
aT
 && 
	`
(aTitle) )

6229 
	`rt
(
lDlogSg
, "withrompt \"") ;

6230 
	`rt
(
lDlogSg
, 
aT
) ;

6231 
	`rt
(
lDlogSg
, "\" ") ;

6233 
	`gPhWhoutFSsh

lSg
 , 
aDeuPhAndFe
 ) ;

6234 i
	`
(
lSg
) )

6236 
	`rt
(
lDlogSg
, "defaultocation \"") ;

6237 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6238 
	`rt
(
lDlogSg
 , "\" " ) ;

6240 
	`gLaName

lSg
 , 
aDeuPhAndFe
 ) ;

6241 i
	`
(
lSg
) )

6243 
	`rt
(
lDlogSg
, "defaultame \"") ;

6244 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6245 
	`rt
(
lDlogSg
 , "\" " ) ;

6247 
	`rt

lDlogSg
 , ")' " ) ;

6248 
	`rt
(
lDlogSg
, "-e 'onrrorumber -128' " ) ;

6249 
	`rt
(
lDlogSg
, "-e 'endry'") ;

6250 i! 
	`osx9Br
(
	`rt

lDlogSg
, " -e 'endell'") ;

6252 i
	`kdlogP
() )

6254 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"kdialog"); (*)1;}

6256 
	`ry

lDlogSg
 , "kdialog" ) ;

6257 i
	`kdlogP
() == 2 )

6259 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6261 
	`rt

lDlogSg
 , " --getsavefilename " ) ;

6263 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

6265 i
aDeuPhAndFe
[0] != '/' )

6267 
	`rt
(
lDlogSg
, "$PWD/") ;

6269 
	`rt
(
lDlogSg
, "\"") ;

6270 
	`rt
(
lDlogSg
, 
aDeuPhAndFe
 ) ;

6271 
	`rt
(
lDlogSg
 , "\"" ) ;

6275 
	`rt
(
lDlogSg
, "$PWD/") ;

6278 i
aNumOfFrPs
 > 0 )

6280 
	`rt
(
lDlogSg
 , " \"" ) ;

6281  
i
 = 0 ; i < 
aNumOfFrPs
 ; i ++ )

6283 
	`rt

lDlogSg
 , 
aFrPs
 [
i
] ) ;

6284 
	`rt

lDlogSg
 , " " ) ;

6286 i
aSgFrDesti
 && 
	`
(aSingleFilterDescription) )

6288 
	`rt

lDlogSg
 , " | " ) ;

6289 
	`rt

lDlogSg
 , 
aSgFrDesti
 ) ;

6291 
	`rt

lDlogSg
 , "\"" ) ;

6293 i
aT
 && 
	`
(aTitle) )

6295 
	`rt
(
lDlogSg
, " --title \"") ;

6296 
	`rt
(
lDlogSg
, 
aT
) ;

6297 
	`rt
(
lDlogSg
, "\"") ;

6300 i
	`zyP
(|| 
	`medlogP
(|| 
	`shmryP
(|| 
	`qmaP
() )

6302 i
	`zyP
() )

6304 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"zenity"); (*)1;}

6305 
	`ry

lDlogSg
 , "zenity" ) ;

6306 i(
	`zy3P
(>4&& !
	`gv
("SSH_TTY") )

6308 
	`rt

lDlogSg
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6311 i
	`medlogP
() )

6313 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"matedialog"); (*)1;}

6314 
	`ry

lDlogSg
 , "matedialog" ) ;

6316 i
	`shmryP
() )

6318 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"shellementary"); (*)1;}

6319 
	`ry

lDlogSg
 , "shellementary" ) ;

6323 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"qarma"); (*)1;}

6324 
	`ry

lDlogSg
 , "qarma" ) ;

6325 i!
	`gv
("SSH_TTY") )

6327 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6330 
	`rt
(
lDlogSg
, " --file-selection --save --confirm-overwrite" ) ;

6332 i
aT
 && 
	`
(aTitle) )

6334 
	`rt
(
lDlogSg
, " --title=\"") ;

6335 
	`rt
(
lDlogSg
, 
aT
) ;

6336 
	`rt
(
lDlogSg
, "\"") ;

6338 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

6340 
	`rt
(
lDlogSg
, " --filename=\"") ;

6341 
	`rt
(
lDlogSg
, 
aDeuPhAndFe
) ;

6342 
	`rt
(
lDlogSg
, "\"") ;

6344 i
aNumOfFrPs
 > 0 )

6346 
	`rt

lDlogSg
 , " --file-filter='" ) ;

6347 i
aSgFrDesti
 && 
	`
(aSingleFilterDescription) )

6349 
	`rt

lDlogSg
 , 
aSgFrDesti
 ) ;

6350 
	`rt

lDlogSg
 , " | " ) ;

6352  
i
 = 0 ; i < 
aNumOfFrPs
 ; i ++ )

6354 
	`rt

lDlogSg
 , 
aFrPs
 [
i
] ) ;

6355 
	`rt

lDlogSg
 , " " ) ;

6357 
	`rt

lDlogSg
 , "' --file-filter='All files | *'" ) ;

6359 i(
tyfd_st

	`rt

lDlogSg
 , " 2>/dev/null ");

6361 i!
	`xdlogP
(&& 
	`tkr3P
( ) )

6363 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python3-tkinter"); (*)1;}

6364 
	`ry

lDlogSg
 , 
gPyth3Name
 ) ;

6365 
	`rt

lDlogSg
 ,

6367 
	`rt

lDlogSg
 , "res=filedialog.asksaveasfilename(");

6368 i
aT
 && 
	`
(aTitle) )

6370 
	`rt
(
lDlogSg
, "title='") ;

6371 
	`rt
(
lDlogSg
, 
aT
) ;

6372 
	`rt
(
lDlogSg
, "',") ;

6374 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

6376 
	`gPhWhoutFSsh

lSg
 , 
aDeuPhAndFe
 ) ;

6377 i
	`
(
lSg
) )

6379 
	`rt
(
lDlogSg
, "initialdir='") ;

6380 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6381 
	`rt
(
lDlogSg
 , "'," ) ;

6383 
	`gLaName

lSg
 , 
aDeuPhAndFe
 ) ;

6384 i
	`
(
lSg
) )

6386 
	`rt
(
lDlogSg
, "initialfile='") ;

6387 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6388 
	`rt
(
lDlogSg
 , "'," ) ;

6391 i
aNumOfFrPs
 > 1 )

6392 || ( (
aNumOfFrPs
 == 1)

6393 && ( 
aFrPs
[0][
	`
(aFilterPatterns[0])-1] != '*' ) ) )

6395 
	`rt
(
lDlogSg
 , "filetypes=(" ) ;

6396 
	`rt

lDlogSg
 , "('" ) ;

6397 i
aSgFrDesti
 && 
	`
(aSingleFilterDescription) )

6399 
	`rt

lDlogSg
 , 
aSgFrDesti
 ) ;

6401 
	`rt

lDlogSg
 , "',(" ) ;

6402  
i
 = 0 ; i < 
aNumOfFrPs
 ; i ++ )

6404 
	`rt

lDlogSg
 , "'" ) ;

6405 
	`rt

lDlogSg
 , 
aFrPs
 [
i
] ) ;

6406 
	`rt

lDlogSg
 , "'," ) ;

6408 
	`rt

lDlogSg
 , "))," ) ;

6409 
	`rt

lDlogSg
 , "('All files','*'))" ) ;

6411 
	`rt

lDlogSg
, ");\nifot isinstance(res,uple):\n\tprint(res)\n\"" ) ;

6413 i!
	`xdlogP
(&& 
	`tkr2P
( ) )

6415 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python2-tkinter"); (*)1;}

6416 
	`ry

lDlogSg
 , "export PYTHONIOENCODING=utf-8;" ) ;

6417 
	`rt

lDlogSg
 , 
gPyth2Name
 ) ;

6418 i! 
	`isTmRug
&& 
	`isDw
( ))

6420 
	`rt

lDlogSg
 , " -i" ) ;

6422 
	`rt

lDlogSg
 ,

6425 i
	`isDw
( ) )

6427 
	`rt

lDlogSg
 ,

6432 
	`rt

lDlogSg
 , "res=tkFileDialog.asksaveasfilename(");

6433 i
aT
 && 
	`
(aTitle) )

6435 
	`rt
(
lDlogSg
, "title='") ;

6436 
	`rt
(
lDlogSg
, 
aT
) ;

6437 
	`rt
(
lDlogSg
, "',") ;

6439 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

6441 
	`gPhWhoutFSsh

lSg
 , 
aDeuPhAndFe
 ) ;

6442 i
	`
(
lSg
) )

6444 
	`rt
(
lDlogSg
, "initialdir='") ;

6445 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6446 
	`rt
(
lDlogSg
 , "'," ) ;

6448 
	`gLaName

lSg
 , 
aDeuPhAndFe
 ) ;

6449 i
	`
(
lSg
) )

6451 
	`rt
(
lDlogSg
, "initialfile='") ;

6452 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6453 
	`rt
(
lDlogSg
 , "'," ) ;

6456 i
aNumOfFrPs
 > 1 )

6457 || ( (
aNumOfFrPs
 == 1)

6458 && ( 
aFrPs
[0][
	`
(aFilterPatterns[0])-1] != '*' ) ) )

6460 
	`rt
(
lDlogSg
 , "filetypes=(" ) ;

6461 
	`rt

lDlogSg
 , "('" ) ;

6462 i
aSgFrDesti
 && 
	`
(aSingleFilterDescription) )

6464 
	`rt

lDlogSg
 , 
aSgFrDesti
 ) ;

6466 
	`rt

lDlogSg
 , "',(" ) ;

6467  
i
 = 0 ; i < 
aNumOfFrPs
 ; i ++ )

6469 
	`rt

lDlogSg
 , "'" ) ;

6470 
	`rt

lDlogSg
 , 
aFrPs
 [
i
] ) ;

6471 
	`rt

lDlogSg
 , "'," ) ;

6473 
	`rt

lDlogSg
 , "))," ) ;

6474 
	`rt

lDlogSg
 , "('All files','*'))" ) ;

6476 
	`rt

lDlogSg
, ");\nifot isinstance(res,uple):\n\tprintes \n\"" ) ;

6478 i
	`xdlogP
(|| 
	`dlogName
() )

6480 i
	`xdlogP
( ) )

6482 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"xdialog"); (*)1;}

6483 
lWasGphicDlog
 = 1 ;

6484 
	`ry

lDlogSg
 , "(Xdialog " ) ;

6486 i
	`isTmRug
( ) )

6488 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"dialog"); (*)0;}

6489 
	`ry

lDlogSg
 , "(dialog " ) ;

6493 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"dialog"); (*)0;}

6494 
lWasXrm
 = 1 ;

6495 
	`ry

lDlogSg
 , 
	`rmName
() ) ;

6496 
	`rt

lDlogSg
 , "'(" ) ;

6497 
	`rt

lDlogSg
 , 
	`dlogName
() ) ;

6498 
	`rt

lDlogSg
 , " " ) ;

6501 i
aT
 && 
	`
(aTitle) )

6503 
	`rt
(
lDlogSg
, "--title \"") ;

6504 
	`rt
(
lDlogSg
, 
aT
) ;

6505 
	`rt
(
lDlogSg
, "\" ") ;

6508 i!
	`xdlogP
(&& !
	`gdlogP
() )

6510 
	`rt
(
lDlogSg
, "--backtitle \"") ;

6511 
	`rt
(
lDlogSg
,

6513 
	`rt
(
lDlogSg
, "\" ") ;

6516 
	`rt

lDlogSg
 , "--fselect \"" ) ;

6517 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

6519 i! 
	`rchr
(
aDeuPhAndFe
, '/') )

6521 
	`rt
(
lDlogSg
, "./") ;

6523 
	`rt
(
lDlogSg
, 
aDeuPhAndFe
) ;

6525 i! 
	`isTmRug
&& !
lWasGphicDlog
 )

6527 
	`rt
(
lDlogSg
, 
	`gv
("HOME")) ;

6528 
	`rt
(
lDlogSg
, "/") ;

6532 
	`rt
(
lDlogSg
, "./") ;

6535 i
lWasGphicDlog
 )

6537 
	`rt
(
lDlogSg
, "\" 0 60 ) 2>&1 ") ;

6541 
	`rt
(
lDlogSg
, "\" 0 60 >/dev/tty) ") ;

6542 i
lWasXrm
 )

6544 
	`rt

lDlogSg
 ,

6549 
	`rt
(
lDlogSg
, "2>&1 ; clear >/dev/tty") ;

6555 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){ 
	`tyfd_putBox
T,
NULL
,NULL);}

6556 
	`ry
(
lBuff
, "Save file in ");

6557 
	`rt
(
lBuff
, 
	`gCurD
());

6558 
lPorIutBox
 = 
	`tyfd_putBox
(
NULL
, NULL, NULL);

6559 i(
lPorIutBox

	`ry
(
lSg
,PointerInputBox);

6560 
p
 = 
	`tyfd_putBox
(
aT
, 
lBuff
, "");

6561 i(
p

	`ry
(
lBuff
,); lBuff[0] = '\0';

6562 i(
lPorIutBox

	`ry
PorIutBox, 
lSg
);

6563 
p
 = 
lBuff
;

6565 
	`gPhWhoutFSsh

lSg
 , 
p
 ) ;

6566 i
	`

lSg
 ) && ! 
	`dExis
(String ) )

6568  
NULL
 ;

6570 
	`gLaName
(
lSg
,
p
);

6571 i! 
	`
(
lSg
) )

6573  
NULL
;

6575  
p
 ;

6578 i(
tyfd_vbo

	`tf
"lDlogSg: %s\n" , 
lDlogSg
 ) ;

6579 i! ( 
lIn
 = 
	`pݒ

lDlogSg
 , "r" ) ) )

6581  
NULL
 ;

6583  
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

6585 
	`po

lIn
 ) ;

6586 i
lBuff
[
	`
(Buff ) -1] == '\n' )

6588 
lBuff
[
	`
(Buff ) -1] = '\0' ;

6591 i! 
	`
(
lBuff
) )

6593  
NULL
;

6595 
	`gPhWhoutFSsh

lSg
 , 
lBuff
 ) ;

6596 i
	`

lSg
 ) && ! 
	`dExis
(String ) )

6598  
NULL
 ;

6600 
	`gLaName
(
lSg
,
lBuff
);

6601 i! 
	`fameVid
(
lSg
) )

6603  
NULL
;

6605  
lBuff
 ;

6606 
	}
}

6610 * 
	$tyfd_ݒFeDlog
(

6611 cڡ * 
aT
 ,

6612 cڡ * 
aDeuPhAndFe
 ,

6613 
aNumOfFrPs
 ,

6614 cڡ * cڡ * 
aFrPs
 ,

6615 cڡ * 
aSgFrDesti
 ,

6616 
aAowMuɝSes
 )

6618 
lDlogSg
 [
MAX_PATH_OR_CMD
] ;

6619 
lSg
 [
MAX_PATH_OR_CMD
] ;

6620 
i
 ;

6621 
FILE
 * 
lIn
 ;

6622 * 
p
 ;

6623 * 
p2
 ;

6624 * 
lPorIutBox
 ;

6625 
lWasKdlog
 = 0 ;

6626 
lWasGphicDlog
 = 0 ;

6627 
lWasXrm
 = 0 ;

6628 
size_t
 
lFuBuffL
 ;

6629 * 
lBuff
 = 
NULL
;

6631 
	`
(
lBuff
);

6632 i(
aT
&&!
	`rcmp
(aTitle,"tinyfd_query"))

6634 
lBuff
 = 
NULL
;

6638 i(
aAowMuɝSes
)

6640 
lFuBuffL
 = 
MAX_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

6641 
lBuff
 = (*)(
	`mloc
(
lFuBuffL
 * ()));

6642 i(!
lBuff
)

6644 
lFuBuffL
 = 
LOW_MULTIPLE_FILES
 * 
MAX_PATH_OR_CMD
 + 1;

6645 
lBuff
 = (*)
	`mloc

lFuBuffL
 * ()));

6650 
lFuBuffL
 = 
MAX_PATH_OR_CMD
 + 1;

6651 
lBuff
 = (*)(
	`mloc
(
lFuBuffL
 * ()));

6653 i(!
lBuff
 
NULL
;

6654 
lBuff
[0]='\0';

6657 i
	`ostP
( ) )

6659 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"applescript"); (*)1;}

6660 
	`ry

lDlogSg
 , "osascript ");

6661 i! 
	`osx9Br
(
	`rt

lDlogSg
 , " -e 'tellpplication \"System Events\"' -e 'Activate'");

6662 
	`rt

lDlogSg
 , " -e 'try' -e '" );

6663 i! 
aAowMuɝSes
 )

6667 
	`rt

lDlogSg
 , "POSIXath of ( " );

6671 
	`rt

lDlogSg
 , "set mylisto " );

6673 
	`rt

lDlogSg
 , "choose file " );

6674 i
aT
 && 
	`
(aTitle) )

6676 
	`rt
(
lDlogSg
, "withrompt \"") ;

6677 
	`rt
(
lDlogSg
, 
aT
) ;

6678 
	`rt
(
lDlogSg
, "\" ") ;

6680 
	`gPhWhoutFSsh

lSg
 , 
aDeuPhAndFe
 ) ;

6681 i
	`
(
lSg
) )

6683 
	`rt
(
lDlogSg
, "defaultocation \"") ;

6684 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6685 
	`rt
(
lDlogSg
 , "\" " ) ;

6687 i
aNumOfFrPs
 > 0 )

6689 
	`rt
(
lDlogSg
 , "ofype {\"" );

6690 
	`rt

lDlogSg
 , 
aFrPs
 [0] + 2 ) ;

6691 
	`rt

lDlogSg
 , "\"" ) ;

6692  
i
 = 1 ; i < 
aNumOfFrPs
 ; i ++ )

6694 
	`rt

lDlogSg
 , ",\"" ) ;

6695 
	`rt

lDlogSg
 , 
aFrPs
 [
i
] + 2) ;

6696 
	`rt

lDlogSg
 , "\"" ) ;

6698 
	`rt

lDlogSg
 , "} " ) ;

6700 i
aAowMuɝSes
 )

6702 
	`rt

lDlogSg
 , "multiple selectionsllowedrue ' " ) ;

6703 
	`rt

lDlogSg
 ,

6705 
	`rt

lDlogSg
 ,

6707 
	`rt

lDlogSg
 , "-e 'set mystringo mystring & \"|\"' " );

6708 
	`rt

lDlogSg
 ,

6710 
	`rt

lDlogSg
 , "-e 'endepeat' " );

6711 
	`rt

lDlogSg
 , "-e 'mystring' " );

6715 
	`rt

lDlogSg
 , ")' " ) ;

6717 
	`rt
(
lDlogSg
, "-e 'onrrorumber -128' " ) ;

6718 
	`rt
(
lDlogSg
, "-e 'endry'") ;

6719 i! 
	`osx9Br
(
	`rt

lDlogSg
, " -e 'endell'") ;

6721 i
	`kdlogP
() )

6723 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"kdialog"); (*)1;}

6724 
lWasKdlog
 = 1 ;

6726 
	`ry

lDlogSg
 , "kdialog" ) ;

6727 i
	`kdlogP
() == 2 )

6729 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6731 
	`rt

lDlogSg
 , " --getopenfilename " ) ;

6733 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

6735 i
aDeuPhAndFe
[0] != '/' )

6737 
	`rt
(
lDlogSg
, "$PWD/") ;

6739 
	`rt
(
lDlogSg
, "\"") ;

6740 
	`rt
(
lDlogSg
, 
aDeuPhAndFe
 ) ;

6741 
	`rt
(
lDlogSg
 , "\"" ) ;

6745 
	`rt
(
lDlogSg
, "$PWD/") ;

6748 i
aNumOfFrPs
 > 0 )

6750 
	`rt
(
lDlogSg
 , " \"" ) ;

6751  
i
 = 0 ; i < 
aNumOfFrPs
 ; i ++ )

6753 
	`rt

lDlogSg
 , 
aFrPs
 [
i
] ) ;

6754 
	`rt

lDlogSg
 , " " ) ;

6756 i
aSgFrDesti
 && 
	`
(aSingleFilterDescription) )

6758 
	`rt

lDlogSg
 , " | " ) ;

6759 
	`rt

lDlogSg
 , 
aSgFrDesti
 ) ;

6761 
	`rt

lDlogSg
 , "\"" ) ;

6763 i
aAowMuɝSes
 )

6765 
	`rt

lDlogSg
 , " --multiple --separate-output" ) ;

6767 i
aT
 && 
	`
(aTitle) )

6769 
	`rt
(
lDlogSg
, " --title \"") ;

6770 
	`rt
(
lDlogSg
, 
aT
) ;

6771 
	`rt
(
lDlogSg
, "\"") ;

6774 i
	`zyP
(|| 
	`medlogP
(|| 
	`shmryP
(|| 
	`qmaP
() )

6776 i
	`zyP
() )

6778 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"zenity"); (*)1;}

6779 
	`ry

lDlogSg
 , "zenity" ) ;

6780 i(
	`zy3P
(>4&& !
	`gv
("SSH_TTY") )

6782 
	`rt

lDlogSg
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6785 i
	`medlogP
() )

6787 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"matedialog"); (*)1;}

6788 
	`ry

lDlogSg
 , "matedialog" ) ;

6790 i
	`shmryP
() )

6792 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"shellementary"); (*)1;}

6793 
	`ry

lDlogSg
 , "shellementary" ) ;

6797 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"qarma"); (*)1;}

6798 
	`ry

lDlogSg
 , "qarma" ) ;

6799 i!
	`gv
("SSH_TTY") )

6801 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

6804 
	`rt

lDlogSg
 , " --file-selection" ) ;

6806 i
aAowMuɝSes
 )

6808 
	`rt

lDlogSg
 , " --multiple" ) ;

6810 i
aT
 && 
	`
(aTitle) )

6812 
	`rt
(
lDlogSg
, " --title=\"") ;

6813 
	`rt
(
lDlogSg
, 
aT
) ;

6814 
	`rt
(
lDlogSg
, "\"") ;

6816 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

6818 
	`rt
(
lDlogSg
, " --filename=\"") ;

6819 
	`rt
(
lDlogSg
, 
aDeuPhAndFe
) ;

6820 
	`rt
(
lDlogSg
, "\"") ;

6822 i
aNumOfFrPs
 > 0 )

6824 
	`rt

lDlogSg
 , " --file-filter='" ) ;

6825 i
aSgFrDesti
 && 
	`
(aSingleFilterDescription) )

6827 
	`rt

lDlogSg
 , 
aSgFrDesti
 ) ;

6828 
	`rt

lDlogSg
 , " | " ) ;

6830  
i
 = 0 ; i < 
aNumOfFrPs
 ; i ++ )

6832 
	`rt

lDlogSg
 , 
aFrPs
 [
i
] ) ;

6833 
	`rt

lDlogSg
 , " " ) ;

6835 
	`rt

lDlogSg
 , "' --file-filter='All files | *'" ) ;

6837 i(
tyfd_st

	`rt

lDlogSg
 , " 2>/dev/null ");

6839 i
	`tkr3P
( ) )

6841 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python3-tkinter"); (*)1;}

6842 
	`ry

lDlogSg
 , 
gPyth3Name
 ) ;

6843 
	`rt

lDlogSg
 ,

6845 
	`rt

lDlogSg
 , "lFiles=filedialog.askopenfilename(");

6846 i
aAowMuɝSes
 )

6848 
	`rt

lDlogSg
 , "multiple=1," ) ;

6850 i
aT
 && 
	`
(aTitle) )

6852 
	`rt
(
lDlogSg
, "title='") ;

6853 
	`rt
(
lDlogSg
, 
aT
) ;

6854 
	`rt
(
lDlogSg
, "',") ;

6856 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

6858 
	`gPhWhoutFSsh

lSg
 , 
aDeuPhAndFe
 ) ;

6859 i
	`
(
lSg
) )

6861 
	`rt
(
lDlogSg
, "initialdir='") ;

6862 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6863 
	`rt
(
lDlogSg
 , "'," ) ;

6865 
	`gLaName

lSg
 , 
aDeuPhAndFe
 ) ;

6866 i
	`
(
lSg
) )

6868 
	`rt
(
lDlogSg
, "initialfile='") ;

6869 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6870 
	`rt
(
lDlogSg
 , "'," ) ;

6873 i
aNumOfFrPs
 > 1 )

6874 || ( ( 
aNumOfFrPs
 == 1 )

6875 && ( 
aFrPs
[0][
	`
(aFilterPatterns[0])-1] != '*' ) ) )

6877 
	`rt
(
lDlogSg
 , "filetypes=(" ) ;

6878 
	`rt

lDlogSg
 , "('" ) ;

6879 i
aSgFrDesti
 && 
	`
(aSingleFilterDescription) )

6881 
	`rt

lDlogSg
 , 
aSgFrDesti
 ) ;

6883 
	`rt

lDlogSg
 , "',(" ) ;

6884  
i
 = 0 ; i < 
aNumOfFrPs
 ; i ++ )

6886 
	`rt

lDlogSg
 , "'" ) ;

6887 
	`rt

lDlogSg
 , 
aFrPs
 [
i
] ) ;

6888 
	`rt

lDlogSg
 , "'," ) ;

6890 
	`rt

lDlogSg
 , "))," ) ;

6891 
	`rt

lDlogSg
 , "('All files','*'))" ) ;

6893 
	`rt

lDlogSg
 , ");\
\nifot isinstance(lFiles,uple):\n\tprint(lFiles)\nelse:\
\n\tlFilesString=''\n\tforFile inFiles:\n\t\tlFilesString+=str(lFile)+'|'\
\n\tprint(lFilesString[:-1])\n\"" ) ;

6898 i
	`tkr2P
( ) )

6900 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python2-tkinter"); (*)1;}

6901 
	`ry

lDlogSg
 , "export PYTHONIOENCODING=utf-8;" ) ;

6902 
	`rt

lDlogSg
 , 
gPyth2Name
 ) ;

6903 i! 
	`isTmRug
&& 
	`isDw
( ) )

6905 
	`rt

lDlogSg
 , " -i" ) ;

6907 
	`rt

lDlogSg
 ,

6910 i
	`isDw
( ) )

6912 
	`rt

lDlogSg
 ,

6916 
	`rt

lDlogSg
 , "lFiles=tkFileDialog.askopenfilename(");

6917 i
aAowMuɝSes
 )

6919 
	`rt

lDlogSg
 , "multiple=1," ) ;

6921 i
aT
 && 
	`
(aTitle) )

6923 
	`rt
(
lDlogSg
, "title='") ;

6924 
	`rt
(
lDlogSg
, 
aT
) ;

6925 
	`rt
(
lDlogSg
, "',") ;

6927 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

6929 
	`gPhWhoutFSsh

lSg
 , 
aDeuPhAndFe
 ) ;

6930 i
	`
(
lSg
) )

6932 
	`rt
(
lDlogSg
, "initialdir='") ;

6933 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6934 
	`rt
(
lDlogSg
 , "'," ) ;

6936 
	`gLaName

lSg
 , 
aDeuPhAndFe
 ) ;

6937 i
	`
(
lSg
) )

6939 
	`rt
(
lDlogSg
, "initialfile='") ;

6940 
	`rt
(
lDlogSg
, 
lSg
 ) ;

6941 
	`rt
(
lDlogSg
 , "'," ) ;

6944 i
aNumOfFrPs
 > 1 )

6945 || ( ( 
aNumOfFrPs
 == 1 )

6946 && ( 
aFrPs
[0][
	`
(aFilterPatterns[0])-1] != '*' ) ) )

6948 
	`rt
(
lDlogSg
 , "filetypes=(" ) ;

6949 
	`rt

lDlogSg
 , "('" ) ;

6950 i
aSgFrDesti
 && 
	`
(aSingleFilterDescription) )

6952 
	`rt

lDlogSg
 , 
aSgFrDesti
 ) ;

6954 
	`rt

lDlogSg
 , "',(" ) ;

6955  
i
 = 0 ; i < 
aNumOfFrPs
 ; i ++ )

6957 
	`rt

lDlogSg
 , "'" ) ;

6958 
	`rt

lDlogSg
 , 
aFrPs
 [
i
] ) ;

6959 
	`rt

lDlogSg
 , "'," ) ;

6961 
	`rt

lDlogSg
 , "))," ) ;

6962 
	`rt

lDlogSg
 , "('All files','*'))" ) ;

6964 
	`rt

lDlogSg
 , ");\
\nifot isinstance(lFiles,uple):\n\tprintFiles\nelse:\
\n\tlFilesString=''\n\tforFile inFiles:\n\t\tlFilesString+=str(lFile)+'|'\
\n\tprintFilesString[:-1]\n\"" ) ;

6969 i
	`xdlogP
(|| 
	`dlogName
() )

6971 i
	`xdlogP
( ) )

6973 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"xdialog"); (*)1;}

6974 
lWasGphicDlog
 = 1 ;

6975 
	`ry

lDlogSg
 , "(Xdialog " ) ;

6977 i
	`isTmRug
( ) )

6979 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"dialog"); (*)0;}

6980 
	`ry

lDlogSg
 , "(dialog " ) ;

6984 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"dialog"); (*)0;}

6985 
lWasXrm
 = 1 ;

6986 
	`ry

lDlogSg
 , 
	`rmName
() ) ;

6987 
	`rt

lDlogSg
 , "'(" ) ;

6988 
	`rt

lDlogSg
 , 
	`dlogName
() ) ;

6989 
	`rt

lDlogSg
 , " " ) ;

6992 i
aT
 && 
	`
(aTitle) )

6994 
	`rt
(
lDlogSg
, "--title \"") ;

6995 
	`rt
(
lDlogSg
, 
aT
) ;

6996 
	`rt
(
lDlogSg
, "\" ") ;

6999 i!
	`xdlogP
(&& !
	`gdlogP
() )

7001 
	`rt
(
lDlogSg
, "--backtitle \"") ;

7002 
	`rt
(
lDlogSg
,

7004 
	`rt
(
lDlogSg
, "\" ") ;

7007 
	`rt

lDlogSg
 , "--fselect \"" ) ;

7008 i
aDeuPhAndFe
 && 
	`
(aDefaultPathAndFile) )

7010 i! 
	`rchr
(
aDeuPhAndFe
, '/') )

7012 
	`rt
(
lDlogSg
, "./") ;

7014 
	`rt
(
lDlogSg
, 
aDeuPhAndFe
) ;

7016 i! 
	`isTmRug
&& !
lWasGphicDlog
 )

7018 
	`rt
(
lDlogSg
, 
	`gv
("HOME")) ;

7019 
	`rt
(
lDlogSg
, "/");

7023 
	`rt
(
lDlogSg
, "./") ;

7026 i
lWasGphicDlog
 )

7028 
	`rt
(
lDlogSg
, "\" 0 60 ) 2>&1 ") ;

7032 
	`rt
(
lDlogSg
, "\" 0 60 >/dev/tty) ") ;

7033 i
lWasXrm
 )

7035 
	`rt

lDlogSg
 ,

7040 
	`rt
(
lDlogSg
, "2>&1 ; clear >/dev/tty") ;

7046 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){ 
	`tyfd_putBox
T,
NULL
,NULL);}

7047 
	`ry
(
lBuff
, "Open file from ");

7048 
	`rt
(
lBuff
, 
	`gCurD
());

7049 
lPorIutBox
 = 
	`tyfd_putBox
(
NULL
, NULL, NULL);

7050 i(
lPorIutBox

	`ry
(
lDlogSg
,PointerInputBox);

7051 
p2
 = 
	`tyfd_putBox
(
aT
, 
lBuff
, "");

7052 i(
p2

	`ry
(
lBuff
,2); lBuff[0] = '\0';

7053 i(
lPorIutBox

	`ry
PorIutBox, 
lDlogSg
);

7054 
p2
 = 
lBuff
;

7056 i! 
	`feExis
(
p2
) )

7058 
	`
(
lBuff
);

7059 
lBuff
 = 
NULL
;

7063 
	`ry
(
lBuff
, 
p2
);

7064 
lBuff
 = (*)
	`loc
lBuff, (
	`
(lBuff)+1) * ()));

7066  
lBuff
 ;

7069 i(
tyfd_vbo

	`tf
"lDlogSg: %s\n" , 
lDlogSg
 ) ;

7070 i! ( 
lIn
 = 
	`pݒ

lDlogSg
 , "r" ) ) )

7072 
	`
(
lBuff
);

7073 
lBuff
 = 
NULL
;

7074  
NULL
 ;

7076 
lBuff
[0]='\0';

7077 
p
=
lBuff
;

7078  
	`fgs

p
 , 
lBuff
 ) , 
lIn
 ) !
NULL
 )

7080 
p
 +
	`
( );

7082 
	`po

lIn
 ) ;

7083 i
lBuff
[
	`
(Buff ) -1] == '\n' )

7085 
lBuff
[
	`
(Buff ) -1] = '\0' ;

7088 i
lWasKdlog
 && 
aAowMuɝSes
 )

7090 
p
 = 
lBuff
 ;

7091  ( 
p
 = 
	`rchr
( , '\n' ) ) )

7092 * 
p
 = '|' ;

7095 i! 
	`

lBuff
 ) )

7097 
	`
(
lBuff
);

7098 
lBuff
 = 
NULL
;

7099  
NULL
;

7101 i
aAowMuɝSes
 && 
	`rchr
(
lBuff
, '|') )

7103 if! 
	`suFesExi

lBuff
 ,Buff ) )

7105 
	`
(
lBuff
);

7106 
lBuff
 = 
NULL
;

7107  
NULL
;

7110 i!
	`feExis
(
lBuff
) )

7112 
	`
(
lBuff
);

7113 
lBuff
 = 
NULL
;

7114  
NULL
;

7117 
lBuff
 = (*)
	`loc
lBuff, (
	`
(lBuff)+1) * ()));

7120  
lBuff
 ;

7121 
	}
}

7124 * 
	$tyfd_FdDlog
(

7125 cڡ * 
aT
 ,

7126 cڡ * 
aDeuPh
 )

7128 
lBuff
 [
MAX_PATH_OR_CMD
] ;

7129 
lDlogSg
 [
MAX_PATH_OR_CMD
] ;

7130 
FILE
 * 
lIn
 ;

7131 * 
p
 ;

7132 * 
lPorIutBox
 ;

7133 
lWasGphicDlog
 = 0 ;

7134 
lWasXrm
 = 0 ;

7135 
lBuff
[0]='\0';

7137 i
	`ostP
( ))

7139 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"applescript"); (*)1;}

7140 
	`ry

lDlogSg
 , "osascript ");

7141 i! 
	`osx9Br
(
	`rt

lDlogSg
 , " -e 'tellpplication \"System Events\"' -e 'Activate'");

7142 
	`rt

lDlogSg
 , " -e 'try' -e 'POSIXath of ( choose folder ");

7143 i
aT
 && 
	`
(aTitle) )

7145 
	`rt
(
lDlogSg
, "withrompt \"") ;

7146 
	`rt
(
lDlogSg
, 
aT
) ;

7147 
	`rt
(
lDlogSg
, "\" ") ;

7149 i
aDeuPh
 && 
	`
(aDefaultPath) )

7151 
	`rt
(
lDlogSg
, "defaultocation \"") ;

7152 
	`rt
(
lDlogSg
, 
aDeuPh
 ) ;

7153 
	`rt
(
lDlogSg
 , "\" " ) ;

7155 
	`rt

lDlogSg
 , ")' " ) ;

7156 
	`rt
(
lDlogSg
, "-e 'onrrorumber -128' " ) ;

7157 
	`rt
(
lDlogSg
, "-e 'endry'") ;

7158 i! 
	`osx9Br
(
	`rt

lDlogSg
, " -e 'endell'") ;

7160 i
	`kdlogP
() )

7162 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"kdialog"); (*)1;}

7163 
	`ry

lDlogSg
 , "kdialog" ) ;

7164 i
	`kdlogP
() == 2 )

7166 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7168 
	`rt

lDlogSg
 , " --getexistingdirectory " ) ;

7170 i
aDeuPh
 && 
	`
(aDefaultPath) )

7172 i
aDeuPh
[0] != '/' )

7174 
	`rt
(
lDlogSg
, "$PWD/") ;

7176 
	`rt
(
lDlogSg
, "\"") ;

7177 
	`rt
(
lDlogSg
, 
aDeuPh
 ) ;

7178 
	`rt
(
lDlogSg
 , "\"" ) ;

7182 
	`rt
(
lDlogSg
, "$PWD/") ;

7185 i
aT
 && 
	`
(aTitle) )

7187 
	`rt
(
lDlogSg
, " --title \"") ;

7188 
	`rt
(
lDlogSg
, 
aT
) ;

7189 
	`rt
(
lDlogSg
, "\"") ;

7192 i
	`zyP
(|| 
	`medlogP
(|| 
	`shmryP
(|| 
	`qmaP
() )

7194 i
	`zyP
() )

7196 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"zenity"); (*)1;}

7197 
	`ry

lDlogSg
 , "zenity" ) ;

7198 i(
	`zy3P
(>4&& !
	`gv
("SSH_TTY") )

7200 
	`rt

lDlogSg
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7203 i
	`medlogP
() )

7205 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"matedialog"); (*)1;}

7206 
	`ry

lDlogSg
 , "matedialog" ) ;

7208 i
	`shmryP
() )

7210 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"shellementary"); (*)1;}

7211 
	`ry

lDlogSg
 , "shellementary" ) ;

7215 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"qarma"); (*)1;}

7216 
	`ry

lDlogSg
 , "qarma" ) ;

7217 i!
	`gv
("SSH_TTY") )

7219 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7222 
	`rt

lDlogSg
 , " --file-selection --directory" ) ;

7224 i
aT
 && 
	`
(aTitle) )

7226 
	`rt
(
lDlogSg
, " --title=\"") ;

7227 
	`rt
(
lDlogSg
, 
aT
) ;

7228 
	`rt
(
lDlogSg
, "\"") ;

7230 i
aDeuPh
 && 
	`
(aDefaultPath) )

7232 
	`rt
(
lDlogSg
, " --filename=\"") ;

7233 
	`rt
(
lDlogSg
, 
aDeuPh
) ;

7234 
	`rt
(
lDlogSg
, "\"") ;

7236 i(
tyfd_st

	`rt

lDlogSg
 , " 2>/dev/null ");

7238 i!
	`xdlogP
(&& 
	`tkr3P
( ) )

7240 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python3-tkinter"); (*)1;}

7241 
	`ry

lDlogSg
 , 
gPyth3Name
 ) ;

7242 
	`rt

lDlogSg
 ,

7244 
	`rt

lDlogSg
 , "res=filedialog.askdirectory(");

7245 i
aT
 && 
	`
(aTitle) )

7247 
	`rt
(
lDlogSg
, "title='") ;

7248 
	`rt
(
lDlogSg
, 
aT
) ;

7249 
	`rt
(
lDlogSg
, "',") ;

7251 i
aDeuPh
 && 
	`
(aDefaultPath) )

7253 
	`rt
(
lDlogSg
, "initialdir='") ;

7254 
	`rt
(
lDlogSg
, 
aDeuPh
 ) ;

7255 
	`rt
(
lDlogSg
 , "'" ) ;

7257 
	`rt

lDlogSg
, ");\nifot isinstance(res,uple):\n\tprint(res)\n\"" ) ;

7259 i!
	`xdlogP
(&& 
	`tkr2P
( ) )

7261 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python2-tkinter"); (*)1;}

7262 
	`ry

lDlogSg
 , "export PYTHONIOENCODING=utf-8;" ) ;

7263 
	`rt

lDlogSg
 , 
gPyth2Name
 ) ;

7264 i! 
	`isTmRug
&& 
	`isDw
( ) )

7266 
	`rt

lDlogSg
 , " -i" ) ;

7268 
	`rt

lDlogSg
 ,

7271 i
	`isDw
( ) )

7273 
	`rt

lDlogSg
 ,

7278 
	`rt

lDlogSg
 , "printkFileDialog.askdirectory(");

7279 i
aT
 && 
	`
(aTitle) )

7281 
	`rt
(
lDlogSg
, "title='") ;

7282 
	`rt
(
lDlogSg
, 
aT
) ;

7283 
	`rt
(
lDlogSg
, "',") ;

7285 i
aDeuPh
 && 
	`
(aDefaultPath) )

7287 
	`rt
(
lDlogSg
, "initialdir='") ;

7288 
	`rt
(
lDlogSg
, 
aDeuPh
 ) ;

7289 
	`rt
(
lDlogSg
 , "'" ) ;

7291 
	`rt

lDlogSg
 , ")\"" ) ;

7293 i
	`xdlogP
(|| 
	`dlogName
() )

7295 i
	`xdlogP
( ) )

7297 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"xdialog"); (*)1;}

7298 
lWasGphicDlog
 = 1 ;

7299 
	`ry

lDlogSg
 , "(Xdialog " ) ;

7301 i
	`isTmRug
( ) )

7303 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"dialog"); (*)0;}

7304 
	`ry

lDlogSg
 , "(dialog " ) ;

7308 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"dialog"); (*)0;}

7309 
lWasXrm
 = 1 ;

7310 
	`ry

lDlogSg
 , 
	`rmName
() ) ;

7311 
	`rt

lDlogSg
 , "'(" ) ;

7312 
	`rt

lDlogSg
 , 
	`dlogName
() ) ;

7313 
	`rt

lDlogSg
 , " " ) ;

7316 i
aT
 && 
	`
(aTitle) )

7318 
	`rt
(
lDlogSg
, "--title \"") ;

7319 
	`rt
(
lDlogSg
, 
aT
) ;

7320 
	`rt
(
lDlogSg
, "\" ") ;

7323 i!
	`xdlogP
(&& !
	`gdlogP
() )

7325 
	`rt
(
lDlogSg
, "--backtitle \"") ;

7326 
	`rt
(
lDlogSg
,

7328 
	`rt
(
lDlogSg
, "\" ") ;

7331 
	`rt

lDlogSg
 , "--dselect \"" ) ;

7332 i
aDeuPh
 && 
	`
(aDefaultPath) )

7334 
	`rt
(
lDlogSg
, 
aDeuPh
) ;

7335 
	`suFSsh
(
lDlogSg
);

7337 i! 
	`isTmRug
&& !
lWasGphicDlog
 )

7339 
	`rt
(
lDlogSg
, 
	`gv
("HOME")) ;

7340 
	`rt
(
lDlogSg
, "/");

7344 
	`rt
(
lDlogSg
, "./") ;

7347 i
lWasGphicDlog
 )

7349 
	`rt
(
lDlogSg
, "\" 0 60 ) 2>&1 ") ;

7353 
	`rt
(
lDlogSg
, "\" 0 60 >/dev/tty) ") ;

7354 i
lWasXrm
 )

7356 
	`rt

lDlogSg
 ,

7361 
	`rt
(
lDlogSg
, "2>&1 ; clear >/dev/tty") ;

7367 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){ 
	`tyfd_putBox
T,
NULL
,NULL);}

7368 
	`ry
(
lBuff
, "Select folder from ");

7369 
	`rt
(
lBuff
, 
	`gCurD
());

7370 
lPorIutBox
 = 
	`tyfd_putBox
(
NULL
, NULL, NULL);

7371 i(
lPorIutBox

	`ry
(
lDlogSg
,PointerInputBox);

7372 
p
 = 
	`tyfd_putBox
(
aT
, 
lBuff
, "");

7373 i(
p

	`ry
(
lBuff
,); lBuff[0] = '\0';

7374 i(
lPorIutBox

	`ry
PorIutBox, 
lDlogSg
);

7375 
p
 = 
lBuff
;

7377 i!
p
 || ! 
	`
а|| ! 
	`dExis
( ) )

7379  
NULL
 ;

7381  
p
 ;

7383 i(
tyfd_vbo

	`tf
"lDlogSg: %s\n" , 
lDlogSg
 ) ;

7384 i! ( 
lIn
 = 
	`pݒ

lDlogSg
 , "r" ) ) )

7386  
NULL
 ;

7388  
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

7390 
	`po

lIn
 ) ;

7391 i
lBuff
[
	`
(Buff ) -1] == '\n' )

7393 
lBuff
[
	`
(Buff ) -1] = '\0' ;

7396 i! 
	`

lBuff
 ) || ! 
	`dExis
(Buff ) )

7398  
NULL
 ;

7400  
lBuff
 ;

7401 
	}
}

7408 * 
	$tyfd_cChoor
(

7409 cڡ * 
aT
 ,

7410 cڡ * 
aDeuHexRGB
 ,

7411 cڡ 
aDeuRGB
[3] ,

7412 
aoResuRGB
[3] )

7414 
lDeuHexRGB
[16];

7415 
lBuff
 [128] ;

7417 
lTmp
 [128] ;

7418 #i!((
	`defed
(
__lulus
 ) && __lulu>201103L|| (defed(
__STDC_VERSION__
&& __STDC_VERSION__ >199901L|| defed(
__g__
))

7419 * 
lTmp2
 ;

7421 
lDlogSg
 [
MAX_PATH_OR_CMD
] ;

7422 
lDeuRGB
[3];

7423 * 
p
;

7424 * 
lPorIutBox
;

7425 
FILE
 * 
lIn
 ;

7426 
i
 ;

7427 
lWasZy3
 = 0 ;

7428 
lWasOst
 = 0 ;

7429 
lWasXdlog
 = 0 ;

7430 
lBuff
[0]='\0';

7432 i(
aDeuHexRGB
)

7434 
	`Hex2RGB
(
aDeuHexRGB
, 
lDeuRGB
);

7438 
lDeuRGB
[0] = 
aDeuRGB
[0];

7439 
lDeuRGB
[1] = 
aDeuRGB
[1];

7440 
lDeuRGB
[2] = 
aDeuRGB
[2];

7443 i
	`ostP
( ) )

7445 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"applescript"); (*)1;}

7446 
lWasOst
 = 1 ;

7447 
	`ry

lDlogSg
 , "osascript");

7449 i! 
	`osx9Br
() )

7451 
	`rt

lDlogSg
 , " -e 'tellpplication \"System Events\"' -e 'Activate'");

7452 
	`rt

lDlogSg
 , " -e 'try' -e 'set mycoloro choose color default color {");

7456 
	`rt

lDlogSg
 ,

7461 
	`rtf
(
lTmp
, "%d", 256 * 
lDeuRGB
[0] ) ;

7462 
	`rt
(
lDlogSg
, 
lTmp
 ) ;

7463 
	`rt
(
lDlogSg
, "," ) ;

7464 
	`rtf
(
lTmp
, "%d", 256 * 
lDeuRGB
[1] ) ;

7465 
	`rt
(
lDlogSg
, 
lTmp
 ) ;

7466 
	`rt
(
lDlogSg
, "," ) ;

7467 
	`rtf
(
lTmp
, "%d", 256 * 
lDeuRGB
[2] ) ;

7468 
	`rt
(
lDlogSg
, 
lTmp
 ) ;

7469 
	`rt
(
lDlogSg
, "}' " ) ;

7470 
	`rt

lDlogSg
 ,

7472 
	`rt

lDlogSg
 ,

7474 
	`rt

lDlogSg
 ,

7476 
	`rt

lDlogSg
 , "-e 'endepeat' " );

7477 
	`rt

lDlogSg
 , "-e 'mystring' ");

7478 
	`rt
(
lDlogSg
, "-e 'onrrorumber -128' " ) ;

7479 
	`rt
(
lDlogSg
, "-e 'endry'") ;

7480 i! 
	`osx9Br
(
	`rt

lDlogSg
, " -e 'endell'") ;

7482 i
	`kdlogP
() )

7484 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"kdialog"); (*)1;}

7485 
	`ry

lDlogSg
 , "kdialog" ) ;

7486 i
	`kdlogP
() == 2 )

7488 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7490 
	`rtf

lDlogSg
 + 
	`
DlogSg, " --gc --deu '%s'" , 
lDeuHexRGB
 ) ;

7492 i
aT
 && 
	`
(aTitle) )

7494 
	`rt
(
lDlogSg
, " --title \"") ;

7495 
	`rt
(
lDlogSg
, 
aT
) ;

7496 
	`rt
(
lDlogSg
, "\"") ;

7499 i
	`zy3P
(|| 
	`medlogP
(|| 
	`shmryP
(|| 
	`qmaP
() )

7501 
lWasZy3
 = 1 ;

7502 i
	`zy3P
() )

7504 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"zenity3"); (*)1;}

7505 
	`ry

lDlogSg
 , "zenity" );

7506 i(
	`zy3P
(>4&& !
	`gv
("SSH_TTY") )

7508 
	`rt

lDlogSg
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7511 i
	`medlogP
() )

7513 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"matedialog"); (*)1;}

7514 
	`ry

lDlogSg
 , "matedialog" ) ;

7516 i
	`shmryP
() )

7518 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"shellementary"); (*)1;}

7519 
	`ry

lDlogSg
 , "shellementary" ) ;

7523 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"qarma"); (*)1;}

7524 
	`ry

lDlogSg
 , "qarma" ) ;

7525 i!
	`gv
("SSH_TTY") )

7527 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7530 
	`rt

lDlogSg
 , " --color-selection --show-palette" ) ;

7531 
	`rtf

lDlogSg
 + 
	`
DlogSg), " --c=%s" , 
lDeuHexRGB
 ) ;

7533 i
aT
 && 
	`
(aTitle) )

7535 
	`rt
(
lDlogSg
, " --title=\"") ;

7536 
	`rt
(
lDlogSg
, 
aT
) ;

7537 
	`rt
(
lDlogSg
, "\"") ;

7539 i(
tyfd_st

	`rt

lDlogSg
 , " 2>/dev/null ");

7541 i
	`xdlogP
() )

7543 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"xdialog"); (*)1;}

7544 
lWasXdlog
 = 1 ;

7545 
	`ry

lDlogSg
 , "Xdialog --colorsel \"" ) ;

7546 i
aT
 && 
	`
(aTitle) )

7548 
	`rt
(
lDlogSg
, 
aT
) ;

7550 
	`rt
(
lDlogSg
, "\" 0 60 ") ;

7551 #i(
	`defed
(
__lulus
 ) && __lulu>201103L|| (defed(
__STDC_VERSION__
&& __STDC_VERSION__ >199901L|| defed(
__g__
)

7552 
	`rtf
(
lTmp
,"%hhu %hhu %hhu",
lDeuRGB
[0],lDefaultRGB[1],lDefaultRGB[2]);

7554 
	`rtf
(
lTmp
,"%hu %hu %hu",
lDeuRGB
[0],lDefaultRGB[1],lDefaultRGB[2]);

7556 
	`rt
(
lDlogSg
, 
lTmp
) ;

7557 
	`rt
(
lDlogSg
, " 2>&1");

7559 i
	`tkr3P
( ) )

7561 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python3-tkinter"); (*)1;}

7562 
	`ry

lDlogSg
 , 
gPyth3Name
 ) ;

7563 
	`rt

lDlogSg
 ,

7565 
	`rt

lDlogSg
 , "res=colorchooser.askcolor(color='" ) ;

7566 
	`rt
(
lDlogSg
, 
lDeuHexRGB
 ) ;

7567 
	`rt
(
lDlogSg
, "'") ;

7569 i
aT
 && 
	`
(aTitle) )

7571 
	`rt
(
lDlogSg
, ",title='") ;

7572 
	`rt
(
lDlogSg
, 
aT
) ;

7573 
	`rt
(
lDlogSg
, "'") ;

7575 
	`rt

lDlogSg
 , ");\
\nifes[1] isot None:\n\tprint(res[1])\"" ) ;

7578 i
	`tkr2P
( ) )

7580 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"python2-tkinter"); (*)1;}

7581 
	`ry

lDlogSg
 , "export PYTHONIOENCODING=utf-8;" ) ;

7582 
	`rt

lDlogSg
 , 
gPyth2Name
 ) ;

7583 i! 
	`isTmRug
&& 
	`isDw
( ) )

7585 
	`rt

lDlogSg
 , " -i" ) ;

7588 
	`rt

lDlogSg
 ,

7591 i
	`isDw
( ) )

7593 
	`rt

lDlogSg
 ,

7598 
	`rt

lDlogSg
 , "res=tkColorChooser.askcolor(color='" ) ;

7599 
	`rt
(
lDlogSg
, 
lDeuHexRGB
 ) ;

7600 
	`rt
(
lDlogSg
, "'") ;

7603 i
aT
 && 
	`
(aTitle) )

7605 
	`rt
(
lDlogSg
, ",title='") ;

7606 
	`rt
(
lDlogSg
, 
aT
) ;

7607 
	`rt
(
lDlogSg
, "'") ;

7609 
	`rt

lDlogSg
 , ");\
\nifes[1] isot None:\n\tprintes[1]\"" ) ;

7614 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){ 
	`tyfd_putBox
T,
NULL
,NULL);}

7615 
lPorIutBox
 = 
	`tyfd_putBox
(
NULL
, NULL, NULL);

7616 i(
lPorIutBox

	`ry
(
lDlogSg
,PointerInputBox);

7617 
p
 = 
	`tyfd_putBox
(
aT
, "E hexgb c (i.e. #f520)", 
lDeuHexRGB
);

7619 i!
p
 || (
	`
(p) != 7) || (p[0] != '#') )

7621  
NULL
 ;

7623  
i
 = 1 ; i < 7 ; i ++ )

7625 i! 
	`isxdig
(
p
[
i
] ) )

7627  
NULL
 ;

7630 
	`Hex2RGB
(
p
,
aoResuRGB
);

7631 
	`ry
(
lDeuHexRGB
, 
p
);

7632 i(
lPorIutBox

	`ry
PorIutBox, 
lDlogSg
);

7633  
lDeuHexRGB
;

7636 i(
tyfd_vbo

	`tf
"lDlogSg: %s\n" , 
lDlogSg
 ) ;

7637 i! ( 
lIn
 = 
	`pݒ

lDlogSg
 , "r" ) ) )

7639  
NULL
 ;

7641  
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

7644 
	`po

lIn
 ) ;

7645 i! 
	`

lBuff
 ) )

7647  
NULL
 ;

7651 i
lBuff
[
	`
(Buff ) -1] == '\n' )

7653 
lBuff
[
	`
(Buff ) -1] = '\0' ;

7656 i
lWasZy3
 )

7658 i
lBuff
[0] == '#' )

7660 i
	`
(
lBuff
)>7 )

7662 
lBuff
[3]=lBuff[5];

7663 
lBuff
[4]=lBuff[6];

7664 
lBuff
[5]=lBuff[9];

7665 
lBuff
[6]=lBuff[10];

7666 
lBuff
[7]='\0';

7668 
	`Hex2RGB
(
lBuff
,
aoResuRGB
);

7670 i
lBuff
[3] == '(' ) {

7671 #i(
	`defed
(
__lulus
 ) && __lulu>201103L|| (defed(
__STDC_VERSION__
&& __STDC_VERSION__ >199901L|| defed(
__g__
)

7672 
	`ssnf
(
lBuff
,"rgb(%hhu,%hhu,%hhu", & 
aoResuRGB
[0], &oResultRGB[1],&oResultRGB[2]);

7674 
aoResuRGB
[0] = 
	`
(
lBuff
+4, & 
lTmp2
, 10 );

7675 
aoResuRGB
[1] = 
	`
(
lTmp2
+1, &Tmp2, 10 );

7676 
aoResuRGB
[2] = 
	`
(
lTmp2
+1, 
NULL
, 10 );

7678 
	`RGB2Hex
(
aoResuRGB
,
lBuff
);

7680 i
lBuff
[4] == '(' ) {

7681 #i(
	`defed
(
__lulus
 ) && __lulu>201103L|| (defed(
__STDC_VERSION__
&& __STDC_VERSION__ >199901L|| defed(
__g__
)

7682 
	`ssnf
(
lBuff
,"rgba(%hhu,%hhu,%hhu", & 
aoResuRGB
[0], &oResultRGB[1],&oResultRGB[2]);

7684 
aoResuRGB
[0] = 
	`
(
lBuff
+5, & 
lTmp2
, 10 );

7685 
aoResuRGB
[1] = 
	`
(
lTmp2
+1, &Tmp2, 10 );

7686 
aoResuRGB
[2] = 
	`
(
lTmp2
+1, 
NULL
, 10 );

7688 
	`RGB2Hex
(
aoResuRGB
,
lBuff
);

7691 i
lWasOst
 || 
lWasXdlog
 )

7694 #i(
	`defed
(
__lulus
 ) && __lulu>201103L|| (defed(
__STDC_VERSION__
&& __STDC_VERSION__ >199901L|| defed(
__g__
)

7695 
	`ssnf
(
lBuff
,"%hhu %hhu %hhu", & 
aoResuRGB
[0], &oResultRGB[1],&oResultRGB[2]);

7697 
aoResuRGB
[0] = 
	`
(
lBuff
, & 
lTmp2
, 10 );

7698 
aoResuRGB
[1] = 
	`
(
lTmp2
+1, &Tmp2, 10 );

7699 
aoResuRGB
[2] = 
	`
(
lTmp2
+1, 
NULL
, 10 );

7701 
	`RGB2Hex
(
aoResuRGB
,
lBuff
);

7705 
	`Hex2RGB
(
lBuff
,
aoResuRGB
);

7710 
	`ry
(
lDeuHexRGB
,
lBuff
);

7711  
lDeuHexRGB
 ;

7712 
	}
}

7717 * 
	$tyfd_yDlog
(

7718 cڡ * 
aT
 ,

7719 
aNumOfCumns
 ,

7720 cڡ * cڡ * 
aCumns
 ,

7721 
aNumOfRows
 ,

7722 cڡ * cڡ * 
aCls
 )

7725 
lBuff
 [
MAX_PATH_OR_CMD
] ;

7726 
lDlogSg
 [
MAX_PATH_OR_CMD
] ;

7727 
FILE
 * 
lIn
 ;

7728 
i
 ;

7730 
lBuff
[0]='\0';

7732 i
	`zyP
(|| 
	`medlogP
(|| 
	`shmryP
(|| 
	`qmaP
() )

7734 i
	`zyP
() )

7736 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"zenity"); (*)1;}

7737 
	`ry

lDlogSg
 , "zenity" ) ;

7738 i(
	`zy3P
(>4&& !
	`gv
("SSH_TTY") )

7740 
	`rt

lDlogSg
, " --attach=$(sleep .01;xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7743 i
	`medlogP
() )

7745 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"matedialog"); (*)1;}

7746 
	`ry

lDlogSg
 , "matedialog" ) ;

7748 i
	`shmryP
() )

7750 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"shellementary"); (*)1;}

7751 
	`ry

lDlogSg
 , "shellementary" ) ;

7755 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,"qarma"); (*)1;}

7756 
	`ry

lDlogSg
 , "qarma" ) ;

7757 i!
	`gv
("SSH_TTY") )

7759 
	`rt
(
lDlogSg
, " --attach=$(xprop -root 32x '\t$0' _NET_ACTIVE_WINDOW | cut -f 2)");

7762 
	`rt

lDlogSg
 , " --list --print-column=ALL" ) ;

7764 i
aT
 && 
	`
(aTitle) )

7766 
	`rt
(
lDlogSg
, " --title=\"") ;

7767 
	`rt
(
lDlogSg
, 
aT
) ;

7768 
	`rt
(
lDlogSg
, "\"") ;

7771 i
aCumns
 && (
aNumOfCumns
 > 0) )

7773  
i
 = 0 ; i < 
aNumOfCumns
 ; i ++ )

7775 
	`rt

lDlogSg
 , " --column=\"" ) ;

7776 
	`rt

lDlogSg
 , 
aCumns
 [
i
] ) ;

7777 
	`rt

lDlogSg
 , "\"" ) ;

7781 i
aCls
 && (
aNumOfRows
 > 0) )

7783 
	`rt

lDlogSg
 , " " ) ;

7784  
i
 = 0 ; i < 
aNumOfRows
*
aNumOfCumns
 ; i ++ )

7786 
	`rt

lDlogSg
 , "\"" ) ;

7787 
	`rt

lDlogSg
 , 
aCls
 [
i
] ) ;

7788 
	`rt

lDlogSg
 , "\" " ) ;

7794 i(
aT
&&!
	`rcmp
T,"tyfd_quy")){
	`ry
(
tyfd_ڣ
,""); (*)0;}

7795  
NULL
 ;

7798 i(
tyfd_vbo

	`tf
"lDlogSg: %s\n" , 
lDlogSg
 ) ;

7799 i! ( 
lIn
 = 
	`pݒ

lDlogSg
 , "r" ) ) )

7801  
NULL
 ;

7803  
	`fgs

lBuff
 , lBuf, 
lIn
 ) !
NULL
 )

7805 
	`po

lIn
 ) ;

7806 i
lBuff
[
	`
(Buff ) -1] == '\n' )

7808 
lBuff
[
	`
(Buff ) -1] = '\0' ;

7811 i! 
	`

lBuff
 ) )

7813  
NULL
 ;

7815  
lBuff
 ;

7816 
	}
}

7985 #ifde
_MSC_VER


7986 #agm
wng
(:4996)

7987 #agm
wng
(:4100)

7988 #agm
wng
(:4706)

	@tinyfiledialogs.h

94 #ide
TINYFILEDIALOGS_H


95 
	#TINYFILEDIALOGS_H


	)

97 #ifdef 
__lulus


105 #ifde
_WIN32


108 
tyfd_wUtf8
;

112 * 
tyfd_utf8toMbcs
(cڡ * 
aUtf8rg
);

113 
wch_t
 * 
tyfd_utf8to16
(cڡ * 
aUtf8rg
);

114 * 
tyfd_utf16to8
(
wch_t
 cڡ * 
aUtf16rg
);

115 
tyfd_tWUtf8
(
aIsUtf8
);

121 cڡ 
tyfd_vsi
[8];

122 cڡ 
tyfd_eds
[];

123 
tyfd_vbo
;

124 
tyfd_st
;

129 
tyfd_fCse
;

136 
tyfd_ڣ
[1024];

150 
tyfd_bp
();

152 
tyfd_nifyPup
(

153 cڡ * 
aT
,

154 cڡ * 
aMesge
,

155 cڡ * 
aIcTy
);

158 
tyfd_mesgeBox
(

159 cڡ * 
aT
 ,

160 cڡ * 
aMesge
 ,

161 cڡ * 
aDlogTy
 ,

162 cڡ * 
aIcTy
 ,

163 
aDeuBu
 ) ;

166 * 
tyfd_putBox
(

167 cڡ * 
aT
 ,

168 cڡ * 
aMesge
 ,

169 cڡ * 
aDeuIut
 ) ;

172 * 
tyfd_veFeDlog
(

173 cڡ * 
aT
 ,

174 cڡ * 
aDeuPhAndFe
 ,

175 
aNumOfFrPs
 ,

176 cڡ * cڡ * 
aFrPs
 ,

177 cڡ * 
aSgFrDesti
 ) ;

180 * 
tyfd_ݒFeDlog
(

181 cڡ * 
aT
 ,

182 cڡ * 
aDeuPhAndFe
 ,

183 
aNumOfFrPs
 ,

184 cڡ * cڡ * 
aFrPs
 ,

185 cڡ * 
aSgFrDesti
 ,

186 
aAowMuɝSes
 ) ;

190 * 
tyfd_FdDlog
(

191 cڡ * 
aT
 ,

192 cڡ * 
aDeuPh
 ) ;

195 * 
tyfd_cChoor
(

196 cڡ * 
aT
 ,

197 cڡ * 
aDeuHexRGB
 ,

198 cڡ 
aDeuRGB
[3] ,

199 
aoResuRGB
[3] ) ;

208 #ifde
_WIN32


211 
tyfd_nifyPupW
(

212 
wch_t
 cڡ * 
aT
,

213 
wch_t
 cڡ * 
aMesge
,

214 
wch_t
 cڡ * 
aIcTy
);

217 
tyfd_mesgeBoxW
(

218 
wch_t
 cڡ * 
aT
 ,

219 
wch_t
 cڡ * 
aMesge
,

220 
wch_t
 cڡ * 
aDlogTy
,

221 
wch_t
 cڡ * 
aIcTy
,

222 
aDeuBu
 );

226 
wch_t
 * 
tyfd_putBoxW
(

227 
wch_t
 cڡ * 
aT
,

228 
wch_t
 cڡ * 
aMesge
,

229 
wch_t
 cڡ * 
aDeuIut
 );

232 
wch_t
 * 
tyfd_veFeDlogW
(

233 
wch_t
 cڡ * 
aT
,

234 
wch_t
 cڡ * 
aDeuPhAndFe
,

235 
aNumOfFrPs
,

236 
wch_t
 cڡ * cڡ * 
aFrPs
,

237 
wch_t
 cڡ * 
aSgFrDesti
);

241 
wch_t
 * 
tyfd_ݒFeDlogW
(

242 
wch_t
 cڡ * 
aT
,

243 
wch_t
 cڡ * 
aDeuPhAndFe
,

244 
aNumOfFrPs
 ,

245 
wch_t
 cڡ * cڡ * 
aFrPs
,

246 
wch_t
 cڡ * 
aSgFrDesti
,

247 
aAowMuɝSes
 ) ;

252 
wch_t
 * 
tyfd_FdDlogW
(

253 
wch_t
 cڡ * 
aT
,

254 
wch_t
 cڡ * 
aDeuPh
);

258 
wch_t
 * 
tyfd_cChoorW
(

259 
wch_t
 cڡ * 
aT
,

260 
wch_t
 cڡ * 
aDeuHexRGB
,

261 cڡ 
aDeuRGB
[3] ,

262 
aoResuRGB
[3] ) ;

272 * 
tyfd_yDlog
(

273 cڡ * 
aT
 ,

274 
aNumOfCumns
 ,

275 cڡ * cڡ * 
aCumns
,

276 
aNumOfRows
,

277 cڡ * cڡ * 
aCls
);

282 #ifdef 
__lulus


	@win32_platform.cpp

1 
	~"MaHrs.h
"

2 
	~<ioam
>

3 
	~<sam
>

4 
	~"rg.h
"

5 
	~"SaveLd.h
"

6 
	~"TextS.h
"

7 
	~"MuS.h
"

8 
	~"EdS.h
"

9 
	~"re.h
"

11 
	$HdShedEvts
(
EdUIS
* 
ui_e
, 
GameSCama
* 
ma_game
, 
glm
::
m4
* 
ma
, 
bo
 
mou_moved_this_ame
, 
SCENE_TYPE
 
s
)

13 
bo
 
_ick_ai_sved
 = 
l
;

14 i(
ui_e
->
whl_move
 !0 && (
s
 =
SCENE_TYPE
::
ST_EDITOR
 || s =SCENE_TYPE::
ST_EDIT_LEVEL
))

17 
d
::
cout
 << "begrtg zoom info" << std::
dl
;

18 
game_height_d
 = 
ui_e
->
game_height_cut
;

19 
ui_e
->
game_height_cut
 -ui_e->
whl_move
;

20 
ui_e
->
game_height_cut
 = 
	`maxf
(
MAX_ZOOM
, ui_state->game_height_current);

21 
tio
 = 
ui_e
->
game_height_cut
 / 
game_height_d
;

22 
ma__x
 = (
ma_game
->

 + cama_game->
right
) / 2.0f;

23 
ma__y
 = (
ma_game
->
up
 + cama_game->
down
) / 2.0f;

24 
ma_width
 = (
ma_game
->
right
 - cama_game->

);

25 
ma_height
 = (
ma_game
->
up
 - cama_game->
down
);

26 
w_ma_hf_width
 = (
ma_width
 / 2.0f* 
tio
;

27 
w_ma_hf_height
 = (
ma_height
 / 2.0f* 
tio
;

29 
ma_game
->

 = 
ma__x
 - 
w_ma_hf_width
;

30 
ma_game
->
right
 = 
ma__x
 + 
w_ma_hf_width
;

31 
ma_game
->
down
 = 
ma__y
 - 
w_ma_hf_height
;

32 
ma_game
->
up
 = 
ma__y
 + 
w_ma_hf_height
;

35 i(
mou_moved_this_ame
 && 
ui_e
->
mou_right_ick_down
 && (
s
 =
SCENE_TYPE
::
ST_EDITOR
 || s =SCENE_TYPE::
ST_EDIT_LEVEL
))

37 
ui_e
->
tٮMove
 = 
	`mh_a_sub
(ui_e->
mou_ϡ_pos
, ui_e->
mouPos
);

38 
ma_game
->

 +
ui_e
->
tٮMove
.
x
 * 
CAMERA_MOVE_MULT
;

39 
ma_game
->
right
 +
ui_e
->
tٮMove
.
x
 * 
CAMERA_MOVE_MULT
;

40 
ma_game
->
down
 +
ui_e
->
tٮMove
.
y
 * 
CAMERA_MOVE_MULT
;

41 
ma_game
->
up
 +
ui_e
->
tٮMove
.
y
 * 
CAMERA_MOVE_MULT
;

43 
	}
}

45 #agm
gi
 
EMBARASSINGLY
 
GLOBAL
 
VARIABLES


49 
AWre
* 
	gl_wre
;

50 
SeWre
* 
	go_wre
;

51 
SeWre
* 
	gp_wre
;

52 
SeWre
* 
	gsymb_wre
;

53 
SeWre
* 
	gui_wre
;

55 
bo
 
	gkp_rug_fe_lo
 = 
l
;

57 
Memy
* 
	game_memy
;

58 
Memy
* 
	grmt_memy
;

59 
Memy
* 
	gmu_memy
;

60 
Memy
* 
	ged_memy
;

61 
Memy
* 
	gay_memy
;

62 
Memy
* 
	gwld_memy
;

63 
Memy
* 
	gv_memy
;

64 
Memy
* 
	gimi_memy
;

65 
Memy
* 
	gxt_memy
;

67 
SCENE_TYPE
 
	gs
;

68 
EdS
* 
	ged_s_e
;

69 
PyS
 
	gay_s_e
;

70 
WldS
* 
	gwld_s_e
;

71 
WldPyS
* 
	gwld_ay_s_e
;

72 
TextS
* 
	gxt_s_e
;

73 
MuS
* 
	gmu_s_e
;

74 
Dei
 
	gϡ_move_k
 = 
NO_DIRECTION
;

75 
	gsn_width
 = 800;

76 
	gsn_height
 = 600;

77 
	gwld_ma_˽
;

78 
SDL_Evt
 
	gevt
;

79 
bo
 
	grug
 = 
ue
;

80 
EdUIS
 
	gui_e
;

82 
GameSCama
 
	gwld_ma
;

83 
GameSCama
 
	gwld_ma_t
;

84 
GameSCama
 
	gwld_ma_gl
;

87 
GameSCama
 
	gma_game
;

88 
VwPtCama
 
	gma_vwpt
;

89 
	gglm
::
m4
 
ma
;

93 
	gglm
::
vec2
 
dggg_t_posi__gamea
 = 
glm
::vec2(0, 0);

96 
Ut32
 
	gt_time_ms
;

97 
Ut32
 
	gϡ_ame_time_ms
;

102 
Shad
 
	greShad
;

103 
Shad
 
	gfuSeShad
;

104 
Shad
 
	gdًdShad
;

105 
Shad
 
	gxtShad
;

106 
Shad
 
	grgShad
;

107 
	gglm
::
vec4
* 
ui_s_mr
;

109 
GLut
 
	gdًd_VAO
;

110 
GLut
 
	gdًd_posis_bufr
;

111 
GLut
 
	gdًd_s_bufr
;

112 
	gdًd_tٮ_dwn
;

113 
	gglm
::
vec3
* 
dًd_posis_u
;

114 
	gglm
::
vec2
* 
dًd_s_u
;

116 
GLut
 
	grg_VAO
;

117 
GLut
 
	grg_s_bufr
;

118 
GLut
 
	grg_mrix_bufr
;

119 
GLut
 
	grg_c_bufr
;

120 
TextWre
 
	gxt_dw_fo
;

123 
	grg_xtu
;

125 
SDL_Wdow
* 
	gwdow
;

127 #agm
dgi


130 
	$ld_ed_v_eful
(
d
::
rg
 
to_ld
)

132 
b
 = 3;

134 
b
 = 4;

135 
b
++;

137 
	`memy_r
(
ed_memy
);

138 
WldS
* 
s
 = 
	`r_derlize_timemache
(
to_ld
, 
ed_memy
, 
ame_memy
);

139 
ed_s_e
 = 
	`eds_tup_wh_t_e
(
ed_memy
, 
ma_vwpt
, 
s
);

140 
ed_s_e
->
timeMache
->
cut_numb_of_ais
 = 0;

141 
d
::
cout
 << "ALL DONE!" << std::
dl
;

142 
	}
}

143 
	$size_sn_eful
(
xt_width
, 
xt_height
)

145 
d_sn_width
 = (
sn_width
;

146 
d_sn_height
 = (
sn_height
;

147 
d_tio
 = 
d_sn_width
 / 
d_sn_height
;

148 
sn_width
 = 
xt_width
;

149 
sn_height
 = 
xt_height
;

150 
	`glVwpt
(0, 0, 
xt_width
, 
xt_height
);

156 
ma_vwpt
.
right
 = 
xt_width
;

157 
ma_vwpt
.
up
 = 
xt_height
;

161 
xt_tio
 = (
sn_width
 / 
sn_height
;

162 
exnd_tio
 = 
xt_tio
 / 
d_tio
;

163 

 = (
ma_game
.

 + cama_game.
right
) / 2.0f;

164 
d_di
 = 
ma_game
.
right
 - cama_game.

;

165 
xt_di
 = 
d_di
 * 
exnd_tio
;

166 
ma_game
.

 = 

 - 
xt_di
 / 2.0f;

167 
ma_game
.
right
 = 

 + 
xt_di
 / 2.0f;

173 
	}
}

174 
	$tup_wld_sn_eful
(
SCENE_TYPE
 
go_to__backa
)

176 
	`memy_r
(
wld_memy
);

177 
wld_s_e
 = 
	`tup_wld_s
(
ed_s_e
->
timeMache
, 
wld_memy
, 
go_to__backa
);

178 
s
 = 
ST_PLAY_WORLD
;

179 
ui_e
.
time_s_s_d
 = 0;

182 
cut_num
 = 
wld_s_e
->
cut_v
;

183 
GameS
* 
cut_gamee
 = 
wld_s_e
->
wld_e
.
v_e
[
cut_num
];

184 
IPa
 
gamee_pos
 = 
wld_s_e
->
wld_e
.
v_posi
[
cut_num
];

185 
wld_ma
 = 
	`mh_ma_bud_f_gamee
(
cut_gamee
, 
gamee_pos
, 
ma_vwpt
);

187 
wld_ma_t
 = 
wld_ma
;

188 
wld_ma_gl
 = 
wld_ma
;

189 
wld_ma_˽
 = 
CAMERA_LERP_TIME
;

190 
	}
}

191 
	$tup_wld_sn_ctue_eful
(
d
::
rg
 
to_ld
)

193 
	`memy_r
(
wld_memy
);

194 
wld_s_e
 = 
	`wld_derlize
(
to_ld
, 
wld_memy
, 
ame_memy
);

195 
wld_s_e
->
go_to__backa
 = 
ST_MENU
;

197 
s
 = 
ST_PLAY_WORLD
;

198 
ui_e
.
time_s_s_d
 = 0;

201 
cut_num
 = 
wld_s_e
->
cut_v
;

202 
GameS
* 
cut_gamee
 = 
wld_s_e
->
wld_e
.
v_e
[
cut_num
];

203 
IPa
 
gamee_pos
 = 
wld_s_e
->
wld_e
.
v_posi
[
cut_num
];

204 
wld_ma
 = 
	`mh_ma_bud_f_gamee
(
cut_gamee
, 
gamee_pos
, 
ma_vwpt
);

205 
wld_ma_t
 = 
wld_ma
;

206 
wld_ma_gl
 = 
wld_ma
;

207 
wld_ma_˽
 = 
CAMERA_LERP_TIME
;

209 
	}
}

211 
	$xt_s_t
()

213 
s
 = 
xt_s_e
->
s_to_vt_to
;

214 
ui_e
.
time_s_s_d
 = 0;

215 
ui_e
.
time_s_ϡ_ay_ai
 = 0;

217 i(
s
 =
SCENE_TYPE
::
ST_PLAY_LEVEL
)

219 
cut_v
 = 
wld_s_e
->current_level;

220 
GameS
* 
cut_gamee
 = 
wld_s_e
->
wld_e
.
v_e
[
cut_v
];

221 
IPa
 
gamee_pos
 = 
wld_s_e
->
wld_e
.
v_posi
[
cut_v
];

222 
wld_ma_gl
 = 
	`mh_ma_bud_f_gamee
(
cut_gamee
, 
gamee_pos
, 
ma_vwpt
);

223 
wld_ma_t
 = 
wld_ma
;

225 
	}
}

226 
	$mu_ai_w_game
()

231 
d
::
rg
 
to_ld
 = 
	`sour_ld_puzz_fe
("world3");

232 
	`ld_ed_v_eful
(
to_ld
);

233 
	`tup_wld_sn_eful
(
SCENE_TYPE
::
ST_MENU
);

234 
d
::
cout
 << "TRIGGERING NEW GAME" << std::
dl
;

235 
	}
}

236 
	$mu_ai_ctue_game
()

240 
d
::
rg
 
to_ld
 = 
	`g_ctue_fe
(
ame_memy
);

241 
	`tup_wld_sn_ctue_eful
(
to_ld
);

242 
d
::
cout
 << "TRIGGERING COUNTINUE GAME" << std::
dl
;

243 
	}
}

244 
	$mu_ai_v_ed
()

247 
d
::
cout
 << "TRIGGERING LEVEL EDITOR" << std::
dl
;

248 
s
 = 
SCENE_TYPE
::
ST_EDITOR
;

249 
ed_s_e
 = 
	`eds_tup
(
ed_memy
, 
ma_vwpt
);

250 
	}
}

254 
Ai
 
	$lcuϋ_wh_ai_to_ke_xt_eful
()

257 
ˉ_iܙy
 = 
ui_e
.
mo_ly_esd_dei
;

261 
bu_mes
[4] = { 'w', 'a', 's', 'd' };

262 
Dei
 
bu_ais
[4] = { 
U
, 
L
, 
D
, 
R
 };

263 
bo
 
bu_esd
 = 
l
;

264 
bu_ess_dex
 = -1;

265 
time_bu_esd
 = -1;

266 
i
 = 0; i < 4; i++)

268 i(
ui_e
.
ˉs
[
bu_mes
[
i
] - 'a'].
esd
)

269 i(
ui_e
.
ˉs
[
bu_mes
[
i
] - 'a'].
time_esd
 > 
time_bu_esd
 || !
bu_esd
)

271 
bu_esd
 = 
ue
;

272 
bu_ess_dex
 = 
i
;

273 
time_bu_esd
 = 
ui_e
.
ˉs
[
bu_mes
[
i
] - 'a'].
time_esd
;

276 i(
bu_esd
)

278 i(
ui_e
.
time_tl_ay_n_move
 <0 || 
bu_ais
[
bu_ess_dex
] !
ϡ_move_k
)

280 
ϡ_move_k
 = (
Dei
)
bu_ais
[
bu_ess_dex
];

281  (
Ai

bu_ais
[
bu_ess_dex
];

285 i(
ui_e
.
ˉs
['z' - 'a'].
esd_this_ame
 ||

286 (
ui_e
.
ˉs
['z' - 'a'].
esd
 && ui_e.
time_tl_ay_n_move
 <= 0))

288 
ϡ_move_k
 = 
Dei
::
NO_DIRECTION
;

289  (
Ai

A_UNDO
;

292 i(
ui_e
.
ˉs
['r' - 'a'].
esd_this_ame
)

294 
ϡ_move_k
 = 
Dei
::
NO_DIRECTION
;

295  (
Ai
)
A_RESET
;

297  (
Ai

A_NONE
;

298 
	}
}

299 
	$hd_xt_ai_eful
(
GameeTimeMache
* 
maybe_time_mache
, 
IPa
 
dw_posi
)

301 
Ai
 
xt_ai
 = 
	`lcuϋ_wh_ai_to_ke_xt_eful
();

303 
Dei
 
to_ke
 = 
	`ai_to_dei
(
xt_ai
);

305 i(
to_ke
 !
NO_DIRECTION
)

306 
	`ke_ay_ai
(

307 
maybe_time_mache
,

308 
dw_posi
,

309 &
ui_e
,

310 
to_ke
,

311 
v_memy
,

312 
ame_memy
,

313 
imi_memy
);

316 i(
xt_ai
 =
A_UNDO
)

319 * 
memy_d
 = 
	`gamee_timemache_undo
(
maybe_time_mache
);

320 
	`memy_p_ack
(
v_memy
, 
memy_d
);

321 
ui_e
.
time_tl_ay_n_move
 = 
WAIT_BETWEEN_PLAYER_MOVE_REPEAT
;

323 i(
xt_ai
 =
A_RESET
)

325 
	`gamee_timemache_t
(
maybe_time_mache
, 
v_memy
);

327 
	}
}

329 
	$hd_ed_put
()

332 
	}
}

333 
	$malofuni
()

335 #agm
gi
 
Lo
 
Sup


338 
i
 = 0; i < 
NUM_LETTERS_ON_KEYBOARD
; i++)

340 
ui_e
.
ˉs
[
i
].
esd_this_ame
 = 
l
;

341 
ui_e
.
ˉs
[
i
].
ad_this_ame
 = 
l
;

343 
i
 = 0; i < 
NUM_SDLK_KEYCODES
; i++)

345 
ui_e
.
key_vues
[
i
].
esd_this_ame
 = 
l
;

346 
ui_e
.
key_vues
[
i
].
ad_this_ame
 = 
l
;

348 
ui_e
.
upde_au_sn_size
 = 
l
;

349 
ui_e
.
mou_ϡ_pos
 = ui_e.
mouPos
;

350 
ui_e
.
shi_key_down_this_ame
 = 
l
;

351 
ui_e
.
ick__down_this_ame
 = 
l
;

352 
ui_e
.
ick__up_this_ame
 = 
l
;

353 
ui_e
.
whl_move
 = 0;

354 
ui_e
.
tٮMove
 = 
	`mh_a_
(0, 0);

355 
ui_e
.
z_key_down_this_ame
 = 
l
;

356 
ui_e
.
backa_key_down_this_ame
 = 
l
;

357 
ui_e
.
right
.
esd_this_ame
 = 
l
;

358 
ui_e
.
up
.
esd_this_ame
 = 
l
;

359 
ui_e
.
down
.
esd_this_ame
 = 
l
;

360 
ui_e
.

.
esd_this_ame
 = 
l
;

361 
ui_e
.
ab
.
esd_this_ame
 = 
l
;

362 
ui_e
.
r
.
esd_this_ame
 = 
l
;

366 
	`SDL_PlEvt
(&
evt
))

368 i(
evt
.
ty
 =
SDL_WINDOWEVENT
)

370 i(
evt
.
wdow
.ev=
SDL_WINDOWEVENT_RESIZED
)

372 
ui_e
.
upde_au_sn_size
 = 
ue
;

373 
ui_e
.
xt_ma_size
 = 
glm
::
	`ivec2
(
evt
.
wdow
.
da1
,vt.wdow.
da2
);

376 i(
evt
.
ty
 =
SDL_KEYDOWN
)

378 
i
 = 0; i < 
NUM_LETTERS_ON_KEYBOARD
; i++)

380 i(
evt
.
key
.
keysym
.
sym
 =(
SDLK_a
 + 
i
))

382 
ui_e
.
ˉs
[
i
].
esd
 = 
ue
;

383 i(
ui_e
.
ˉs
[
i
].
ad_s_esd_ϡ
)

385 
ui_e
.
ˉs
[
i
].
esd_this_ame
 = 
ue
;

386 
ui_e
.
ˉs
[
i
].
time_esd
 = ui_e.
tٮ_time_sd
;

388 
ui_e
.
ˉs
[
i
].
ad_s_esd_ϡ
 = 
l
;

391 
i
 = 0; i < 
NUM_SDLK_KEYCODES
; i++)

393 
dex
 = 
	`ick_sdl_keycode_to_dex_posi
(
evt
.
key
.
keysym
.
sym
);

395 
ui_e
.
key_vues
[
dex
].
esd
 = 
ue
;

396 i(
ui_e
.
key_vues
[
dex
].
ad_s_esd_ϡ
)

398 
ui_e
.
key_vues
[
dex
].
esd_this_ame
 = 
ue
;

399 
ui_e
.
key_vues
[
dex
].
time_esd
 = ui_e.
tٮ_time_sd
;

401 
ui_e
.
key_vues
[
dex
].
ad_s_esd_ϡ
 = 
l
;

403 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_LSHIFT
)

405 
ui_e
.
shi_key_down_this_ame
 = 
ue
;

406 
ui_e
.
shi_key_down
 = 
ue
;

408 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_LALT
)

410 
ui_e
.
t_key_down
 = 
ue
;

412 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_LCTRL
)

414 
ui_e
.
cڌ_key_down
 = 
ue
;

416 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_z
)

418 
ui_e
.
z_key_down_this_ame
 = 
ue
;

420 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_BACKSPACE
)

422 
ui_e
.
backa_key_down_this_ame
 = 
ue
;

424 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_d
)

426 
ui_e
.
right
.
esd
 = 
ue
;

427 
ui_e
.
right
.
esd_this_ame
 = 
ue
;

429 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_w
)

431 
ui_e
.
up
.
esd
 = 
ue
;

432 
ui_e
.
up
.
esd_this_ame
 = 
ue
;

434 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_a
)

436 
ui_e
.

.
esd
 = 
ue
;

437 
ui_e
.

.
esd_this_ame
 = 
ue
;

439 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_s
)

441 
ui_e
.
down
.
esd
 = 
ue
;

442 
ui_e
.
down
.
esd_this_ame
 = 
ue
;

444 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_SPACE
)

446 
ui_e
.
ab
.
esd
 = 
ue
;

447 
ui_e
.
ab
.
esd_this_ame
 = 
ue
;

449 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_RETURN
)

451 
ui_e
.
r
.
esd
 = 
ue
;

452 
ui_e
.
r
.
esd_this_ame
 = 
ue
;

455 i(
evt
.
ty
 =
SDL_KEYUP
)

457 
i
 = 0; i < 
NUM_LETTERS_ON_KEYBOARD
; i++)

459 i(
evt
.
key
.
keysym
.
sym
 =(
SDLK_a
 + 
i
))

461 
ui_e
.
ˉs
[
i
].
esd
 = 
l
;

462 
ui_e
.
ˉs
[
i
].
ad_this_ame
 = 
ue
;

463 
ui_e
.
ˉs
[
i
].
ad_s_esd_ϡ
 = 
ue
;

466 
i
 = 0; i < 
NUM_SDLK_KEYCODES
; i++)

468 
dex
 = 
	`ick_sdl_keycode_to_dex_posi
(
evt
.
key
.
keysym
.
sym
);

470 
ui_e
.
ˉs
[
dex
].
esd
 = 
l
;

471 
ui_e
.
ˉs
[
dex
].
ad_this_ame
 = 
ue
;

472 
ui_e
.
ˉs
[
dex
].
ad_s_esd_ϡ
 = 
ue
;

474 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_LSHIFT
)

476 
ui_e
.
shi_key_down
 = 
l
;

478 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_LALT
)

480 
ui_e
.
t_key_down
 = 
l
;

482 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_LCTRL
)

484 
ui_e
.
cڌ_key_down
 = 
l
;

486 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_d
)

488 
ui_e
.
right
.
esd
 = 
l
;

490 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_w
)

492 
ui_e
.
up
.
esd
 = 
l
;

494 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_a
)

496 
ui_e
.

.
esd
 = 
l
;

498 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_s
)

500 
ui_e
.
down
.
esd
 = 
l
;

502 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_SPACE
)

504 
ui_e
.
ab
.
esd
 = 
l
;

506 i(
evt
.
key
.
keysym
.
sym
 =
SDLK_RETURN
)

508 
ui_e
.
r
.
esd
 = 
l
;

509 
ui_e
.
r
.
ad_this_ame
 = 
ue
;

510 
ui_e
.
r
.
ad_s_esd_ϡ
 = 
ue
;

513 i(
evt
.
ty
 =
SDL_MOUSEMOTION
 ||vt.ty =
SDL_MOUSEBUTTONDOWN
 ||vt.ty =
SDL_MOUSEBUTTONUP
)

517 
mouX
;

518 
mouY
;

519 
	`SDL_GMouS
(&
mouX
, &
mouY
);

520 
mouY
 = 
ma_vwpt
.
up
 - mouseY;

521 
ui_e
.
mouPos
 = 
	`mh_a_
(
mouX
, 
mouY
);

522 
ui_e
.
mouGamePos
 = 
	`mh_sna_to_gamea
(ui_e.
mouPos
, 
ma_game
, 
ma_vwpt
, ui_e.
game_height_cut
);

526 i(
evt
.
ty
 =
SDL_MOUSEBUTTONDOWN
)

528 i(
evt
.
bu
.bu =
SDL_BUTTON_RIGHT
)

529 
ui_e
.
mou_right_ick_down
 = 
ue
;

530 i(
evt
.
bu
.bu =
SDL_BUTTON_LEFT
)

532 
ui_e
.
ick__down_this_ame
 = 
ue
;

533 
ui_e
.
mou__ick_down
 = 
ue
;

537 i(
evt
.
ty
 =
SDL_MOUSEBUTTONUP
)

539 i(
evt
.
bu
.bu =
SDL_BUTTON_RIGHT
)

540 
ui_e
.
mou_right_ick_down
 = 
l
;

541 i(
evt
.
bu
.bu =
SDL_BUTTON_LEFT
)

543 
ui_e
.
ick__up_this_ame
 = 
ue
;

544 
ui_e
.
mou__ick_down
 = 
l
;

548 i(
evt
.
ty
 =
SDL_QUIT
)

550 
rug
 = 
l
;

552 i(
evt
.
ty
 =
SDL_MOUSEWHEEL
)

554 i(
evt
.
whl
.
y
 != 0)

556 
ui_e
.
whl_move
 = (
evt
.
whl
.
y
;

557 #ifde
EMSCRIPTEN


559 
ui_e
.
whl_move
 /= 100.0f;

565 
bo
 
mou_moved_this_ame
 = 
ui_e
.
mouPos
.
x
 !ui_e.
mou_ϡ_pos
.x || ui_e.mouPos.
y
 != ui_state.mouse_last_pos.y;

566 
bo
 
_ick_ai_sved
 = 
l
;

568 
	`HdShedEvts
(&
ui_e
, &
ma_game
, &
ma
, 
mou_moved_this_ame
, 
s
);

570 i(
ui_e
.
ick__down_this_ame
 && !ui_e.
shi_key_down
 && !
_ick_ai_sved
 && 
s
 =
SCENE_TYPE
::
ST_EDITOR
)

572 
glm
::
vec2
 
ˋ_gamea_t
 = 
	`mh_sna_to_gamea
(
ed_s_e
->
ˋ_sn_t
, 
ma_game
, 
ma_vwpt
, 
ui_e
.
game_height_cut
);

573 
bo
 
ickedPe
 = 
	`mh_ick_is_side_AABB
(

574 
ˋ_gamea_t
.
x
,

575 
ˋ_gamea_t
.
y
,

576 
ˋ_gamea_t
.
x
 + 
ˋ_ngth
,

577 
ˋ_gamea_t
.
y
 + 1,

578 
ui_e
.
mouGamePos
.
x
,

579 
ui_e
.
mouGamePos
.
y
);

580 i(
ickedPe
)

583 
rageX
 = 
	`r_bwn_two_pots
(
ui_e
.
mouGamePos
.
x
, 
ˋ_gamea_t
.x,e_gamea_t.x + 
ˋ_ngth
);

584 
ˋ__icked
 = ()(
rageX
 * 
ˋ_ngth
);

585 
ed_s_e
->
cutBrush
 = 
ˋ__icked
;

587 
_ick_ai_sved
 = 
ue
;

593 #agm
dgi


594 #agm
gi
 
GLCˬ
 
And
 
Upde
 
D
 
Time


595 
	`glCˬ
(
GL_COLOR_BUFFER_BIT
 | 
GL_DEPTH_BUFFER_BIT
);

596 
	`glCˬC
(0.1f, 0.1f, 0.1f, 1.0f);

598 
d
 = 0;

599 
tٮ_time
;

601 
cut_time_ms
 = 
	`SDL_GTicks
();

602 
d_ms
 = ((
cut_time_ms
 - 
ϡ_ame_time_ms
);

603 
ϡ_ame_time_ms
 = 
cut_time_ms
;

604 
d
 = 
d_ms
 / 1000.0f;

605 
tٮ_time
 = (
cut_time_ms
 - 
t_time_ms
) / 1000.0f;

607 
ui_e
.
time_tl_ay_n_move
 = 
	`maxf
(0, ui_e.time_tl_ay_n_mov- 
d
);

608 
ui_e
.
time_s_ϡ_ay_ai
 +
d
;

609 
ui_e
.
time_s_s_d
 +
d
;

610 
ui_e
.
tٮ_time_sd
 = 
tٮ_time
;

612 #agm
dgi


614 i(
s
 =
ST_EDITOR
)

616 #agm
gi
 
hd_evts


618 
bo
 
mou_moved_this_ame
 = 
ui_e
.
mouPos
.
x
 !ui_e.
mou_ϡ_pos
.x || ui_e.mouPos.
y
 != ui_state.mouse_last_pos.y;

619 i(
ui_e
.
backa_key_down_this_ame
)

621 
s
 = 
SCENE_TYPE
::
ST_MENU
;

622 
ui_e
.
time_s_s_d
 = 0;

623 
ui_e
.
time_s_ϡ_ay_ai
 = 0;

625 i(
ui_e
.
upde_au_sn_size
)

628 
	`size_sn_eful
(
ui_e
.
xt_ma_size
.
x
, ui_e.xt_ma_size.
y
);

630 i(
ui_e
.
ˉs
['k' - 'a'].
esd_this_ame
)

632 
	`SDL_SWdowSize
(
wdow
,1200, 900);

633 
	`size_sn_eful
(1200, 900);

636 i(
ui_e
.
ty
 =
ECS_BRUSH
)

638 i(
ui_e
.
mou__ick_down
)

639 
	`MaybeAlyBrush
(
ed_s_e
->
ˋ
,ed_s_e->
cutBrush
, &
ui_e
,ed_s_e->
timeMache
, ui_e.
mouGamePos
);

641 
ui_e
.
ty
 = 
ECS_NEUTRAL
;

643 i(
ui_e
.
ty
 =
ECS_NEUTRAL
)

646 i(
ui_e
.
ˉs
['y' - 'a'].
esd_this_ame
)

648 
dex_icked
 = 
	`gamee_timemache_g_ick_clisi_gamee
(
ed_s_e
->
timeMache
, 
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
);

649 i(
dex_icked
 >= 0)

652 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi__chge_v_mode
(
dex_icked
,
LevMode
::
Crumb
);

653 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

656 i(
ui_e
.
ˉs
['u' - 'a'].
esd_this_ame
)

658 
dex_icked
 = 
	`gamee_timemache_g_ick_clisi_gamee
(
ed_s_e
->
timeMache
, 
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
);

659 i(
dex_icked
 >= 0)

662 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi__chge_v_mode
(
dex_icked
,
LevMode
::
Rt
);

663 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

666 i(
ui_e
.
ˉs
['i' - 'a'].
esd_this_ame
)

668 
dex_icked
 = 
	`gamee_timemache_g_ick_clisi_gamee
(
ed_s_e
->
timeMache
, 
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
);

669 i(
dex_icked
 >= 0)

672 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi__chge_v_mode
(
dex_icked
,
LevMode
::
Ovwld
);

673 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

677 i(
ui_e
.
ˉs
['m' - 'a'].
esd_this_ame
)

679 
	`tup_wld_sn_eful
(
SCENE_TYPE
::
ST_EDITOR
);

682 i(
ui_e
.
ˉs
['o' - 'a'].
esd_this_ame
)

684 
d
::
rg
 
to_ld
 = 
	`ld_puzz_fe
();

685 i(
to_ld
 == "")

687 
d
::
cout
 << "uh oh, ouroad of game didn't work,othings happened!";

691 
	`ld_ed_v_eful
(
to_ld
);

695 i(
ui_e
.
ˉs
['p' - 'a'].
esd_this_ame
)

698 
d
::
rg
 
to_t
 = 
	`r_rlize_timemache
(&(
ed_s_e
->
timeMache
->
wld_e
), 
ame_memy
, frame_memory);

699 
	`ve_puzz_fe
(
to_t
);

700 
d
::
cout
 << 
to_t
 << std::
dl
;

708 i(
ui_e
.
ˉs
['w' - 'a'].
esd_this_ame
)

710 
WldPosi
 
posi_icked
 = 
	`gamee_timemache_g_ick_clisi_fu
(
ed_s_e
->
timeMache
, 
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
);

711 i(
posi_icked
.
v_dex
 >0 &&osi_icked.
v_posi_1d
 >= 0)

713 
GameS
* 
e
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
posi_icked
.
v_dex
];

715 
GameS
* 
xt
 = 
	`gamee_add_row
(
e
, 
ed_s_e
->
timeMache
->
gamee_memy
, 
posi_icked
.
v_posi
.
x
,osi_icked.v_posi.
y
);

716 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi__upde_gamee
(
xt
, 
posi_icked
.
v_dex
, 
ed_s_e
->
timeMache
->
wld_e
.
v_mes
[position_clicked.level_index]);

717 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

722 i(
ui_e
.
ˉs
['h' - 'a'].
esd_this_ame
)

725 
WldPosi
 
posi_icked
 = 
	`gamee_timemache_g_ick_clisi_fu
(
ed_s_e
->
timeMache
, 
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
);

726 
dex_icked
 = 
posi_icked
.
v_dex
;

727 
IPa
 
grid_icked
 = 
posi_icked
.
v_posi
;

728 i(
dex_icked
 >= 0)

730 
GameS
* 
e
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
dex_icked
];

732 
GameS
* 
xt
 = 
	`gamee_add_cumn
(
e
, 
rmt_memy
, 
grid_icked
.
x
, grid_icked.
y
);

733 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi__upde_gamee
(
xt
, 
dex_icked
, 
ed_s_e
->
timeMache
->
wld_e
.
v_mes
[index_clicked]);

734 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

738 i(
ui_e
.
ˉs
['c' - 'a'].
esd_this_ame
)

740 
dex_icked
 = 
	`gamee_timemache_g_ick_clisi_gamee
(
ed_s_e
->
timeMache
, 
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
);

741 i(
dex_icked
 >= 0)

743 
GameS
* 
e
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
dex_icked
];

744 
GameS
* 
xt
 = 
	`gamee_suound_wh_wls
(
e
, 
rmt_memy
);

745 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi__upde_gamee
(
xt
, 
dex_icked
, 
ed_s_e
->
timeMache
->
wld_e
.
v_mes
[index_clicked ]);

746 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

750 i(
ui_e
.
ick__down_this_ame
 && ui_e.
cڌ_key_down
)

752 
dex_icked
 = 
	`gamee_timemache_g_ick_clisi_gamee
(
ed_s_e
->
timeMache
, 
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
);

753 i(
dex_icked
 >= 0)

755 
GameS
* 
cutS
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
dex_icked
];

756 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi__de_gamee
(
dex_icked
);

757 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

758 
_ick_ai_sved
 = 
ue
;

762 i(
ui_e
.
ick__down_this_ame
 && ui_e.
t_key_down
 && !
_ick_ai_sved
)

764 
dex_icked
 = 
	`gamee_timemache_g_ick_clisi_gamee
(
ed_s_e
->
timeMache
, 
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
);

765 i(
dex_icked
 >= 0)

768 
GameS
* 
t_e
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
dex_icked
];

771 
ay_s_e
.
timeMache
 = 
	`gamee_timemache_
(
t_e
, 
ay_memy
, 
max_ais__puzz
);

772 
ay_s_e
.
timeMache_ed
 = 
	`gamee_timemache_
(
t_e
, 
ay_memy
, 
max_ais__puzz
);

773 
ay_s_e
.
loc
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_posi
[
dex_icked
];

774 
ay_s_e
.
loc_ed
 =y_s_e.
loc
;

775 
ay_s_e
.
loc_ed
.
x
 +(
t_e
->
w
 + 2);

776 
ay_s_e
.
ed_posi__time_mache
 = 
dex_icked
;

777 
i
 = 0; i < 
GAME_LEVEL_NAME_MAX_SIZE
; i++)

779 
ay_s_e
.
game_me
[
i
] = 0;

781 
ay_s_e
.
game_me_ngth
 = 0;

783 
i
 = 0; i < 
GAME_LEVEL_NAME_MAX_SIZE
; i++)

784 
ay_s_e
.
game_me
[
i
] = 
ed_s_e
->
timeMache
->
wld_e
.
v_mes
[
dex_icked
].
me
[i];

785 
ay_s_e
.
game_me_ngth
 = (
	`
(
ed_s_e
->
timeMache
->
wld_e
.
v_mes
[
dex_icked
].
me
);

787 
s
 = 
ST_EDIT_LEVEL
;

788 
ui_e
.
time_s_s_d
 = 0;

793 i(
ui_e
.
ick__down_this_ame
 && !ui_e.
shi_key_down
 && !
_ick_ai_sved
)

795 
_ick_ai_sved
 = 
	`MaybeAlyBrush
(
ed_s_e
->
ˋ
,d_s_e->
cutBrush
, &
ui_e
,d_s_e->
timeMache
, ui_e.
mouGamePos
);

798 i(
ui_e
.
mou__ick_down
 && !ui_e.
shi_key_down
 && !
_ick_ai_sved
)

801 
i
 = 0; i < 
ed_s_e
->
timeMache
->
wld_e
.
num_v
; i++)

803 
box_
 = ()
ed_s_e
->
timeMache
->
wld_e
.
v_posi
[
i
].
x
;

804 
box_width
 = ()
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
i
]->
w
;

805 
box_right
 = 
box_
 + 
box_width
;

806 
box_down
 = ()
ed_s_e
->
timeMache
->
wld_e
.
v_posi
[
i
].
y
;

807 
box_height
 = ()
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
i
]->
h
;

808 
box_up
 = 
box_down
 + 
box_height
;

809 
AABB
 

 = 
	`mh_AABB_
(
box_
 - 
OUTLINE_DRAW_SIZE
,

810 
box_down
 - 
OUTLINE_DRAW_SIZE
,

811 
OUTLINE_DRAW_SIZE
,

812 
box_height
 + 
OUTLINE_DRAW_SIZE
 * 2);

813 
AABB
 
right
 = 
	`mh_AABB_
(
box_right
,

814 
box_down
 - 
OUTLINE_DRAW_SIZE
,

815 
OUTLINE_DRAW_SIZE
,

816 
box_height
 + 
OUTLINE_DRAW_SIZE
 * 2);

817 
AABB
 
up
 = 
	`mh_AABB_
(
box_
 - 
OUTLINE_DRAW_SIZE
,

818 
box_up
,

819 
box_width
 + 
OUTLINE_DRAW_SIZE
 * 2,

820 
OUTLINE_DRAW_SIZE
);

821 
AABB
 
down
 = 
	`mh_AABB_
(
box_
 - 
OUTLINE_DRAW_SIZE
,

822 
box_down
 - 
OUTLINE_DRAW_SIZE
,

823 
box_width
 + 
OUTLINE_DRAW_SIZE
 * 2,

824 
OUTLINE_DRAW_SIZE
);

826 
bo
 
ick_
 = 
	`mh_ick_is_side_AABB
(
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
, 

);

827 
bo
 
ick_right
 = 
	`mh_ick_is_side_AABB
(
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
, 
right
);

828 
bo
 
ick_up
 = 
	`mh_ick_is_side_AABB
(
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
, 
up
);

829 
bo
 
ick_down
 = 
	`mh_ick_is_side_AABB
(
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
, 
down
);

830 i(
ick_
 || 
ick_right
 || 
ick_up
 || 
ick_down
)

832 
ui_e
.
ty
 = 
ECS_RESIZE_GAMESTATE
;

833 
ui_e
.
un
.
size
.
dggg_
 = 
l
;

834 
ui_e
.
un
.
size
.
dggg_right
 = 
l
;

835 
ui_e
.
un
.
size
.
dggg_up
 = 
l
;

836 
ui_e
.
un
.
size
.
dggg_down
 = 
l
;

837 i(
ick_
)

838 
ui_e
.
un
.
size
.
dggg_
 = 
ue
;

839 i(
ick_right
)

840 
ui_e
.
un
.
size
.
dggg_right
 = 
ue
;

841 i(
ick_up
)

842 
ui_e
.
un
.
size
.
dggg_up
 = 
ue
;

843 i(
ick_down
)

844 
ui_e
.
un
.
size
.
dggg_down
 = 
ue
;

846 
ui_e
.
un
.
size
.
dggg_gamee_dex
 = 
i
;

847 
_ick_ai_sved
 = 
ue
;

848 
dggg_t_posi__gamea
 = 
ui_e
.
mouGamePos
;

853 i(
ui_e
.
mou__ick_down
 && ui_e.
shi_key_down
)

855 
dex_icked
 = 
	`gamee_timemache_g_ick_clisi_gamee
(
ed_s_e
->
timeMache
, 
ui_e
.
mouGamePos
.
x
, ui_e.mouGamePos.
y
);

856 i(
dex_icked
 >= 0)

858 
ui_e
.
ty
 = 
ECS_MOVE_GAMESTATE
;

859 
ui_e
.
un
.
move
.
movg_gamee_dex
 = 
dex_icked
;

860 
ui_e
.
un
.
move
.
move_t_posi
 = ui_e.
mouGamePos
;

861 
_ick_ai_sved
 = 
ue
;

865 i(
ui_e
.
ick__down_this_ame
 && !ui_e.
shi_key_down
 && !
_ick_ai_sved
)

868 
IPa
 
game_wld_ick
 = 
	`mh_a_
((
	`o
(
ui_e
.
mouGamePos
.
x
),(o(ui_e.mouGamePos.
y
));

869 
ui_e
.
ty
 = 
ECS_CREATE_GAMESTATE
;

870 
ui_e
.
un
.

.
gamewld_t_pos
 = 
game_wld_ick
;

872 i(
ui_e
.
z_key_down_this_ame
 && !
_ick_ai_sved
)

874 
TimeMacheEdAi
 
ai
;

875 
ai
.ai = 
TM_UNDO
;

876 
ai
.
u
.
move
.
gamee_dex
 = -1;

877 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
,d_s_e->
time_mache_t_e
, 
ai
);

878 
_ick_ai_sved
 = 
ue
;

882 i(
ui_e
.
ty
 =
ECS_RESIZE_GAMESTATE
)

885 i(
ui_e
.
ick__up_this_ame
)

888 
glm
::
vec2
 
offt
 = 
ui_e
.
mouGamePos
 - 
dggg_t_posi__gamea
;

890 
IPa
 
rgd_gamee_posi
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_posi
[
ui_e
.
un
.
size
.
dggg_gamee_dex
];

891 
GameS
* 
rgd_gamee
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
ui_e
.
un
.
size
.
dggg_gamee_dex
];

892 
rgd_gamee_width
 = 
rgd_gamee
->
w
;

893 
rgd_gamee_height
 = 
rgd_gamee
->
h
;

895 
AABB
 
d
 = 
	`mh_AABB_
((
rgd_gamee_posi
.
x
,

896 (
rgd_gamee_posi
.
y
,

897 (
rgd_gamee_width
,

898 (
rgd_gamee_height
);

899 
AABB
 
xt
 = 
d
;

905 
offt_x
 = 
	`sign
(
offt
.
x
) * 0.5f;

906 
offt_y
 = 
	`sign
(
offt
.
y
) * 0.5f;

907 i(
ui_e
.
un
.
size
.
dggg_
)

909 
_movemt
 = ()(
ui_e
.
mouGamePos
.
x
 - (()
xt
.x+ 
offt_x
);

910 i(
_movemt
 != 0)

912 
xt
.
x
 +
_movemt
;

913 
xt
.
w
 -
_movemt
;

916 i(
ui_e
.
un
.
size
.
dggg_right
)

918 
right_movemt
 = ()(
ui_e
.
mouGamePos
.
x
 - (()
xt
.x +ext.
w
+ 
offt_x
);

919 i(
right_movemt
 != 0)

920 
xt
.
w
 +
right_movemt
;

922 i(
ui_e
.
un
.
size
.
dggg_down
)

924 
down_movemt
 = ()(
ui_e
.
mouGamePos
.
y
 - (()
xt
.y+ 
offt_y
);

925 i(
down_movemt
 != 0)

927 
xt
.
y
 +
down_movemt
;

928 
xt
.
h
 -
down_movemt
;

931 i(
ui_e
.
un
.
size
.
dggg_up
)

933 
up_movemt
 = ()(
ui_e
.
mouGamePos
.
y
 - (()
xt
.y +ext.
h
+ 
offt_y
);

934 i(
up_movemt
 != 0)

935 
xt
.
h
 +
up_movemt
;

938 
bo
 
chgeOccud
 = 
xt
.
x
 !
rgd_gamee_posi
.x

939 || 
xt
.
y
 !
rgd_gamee_posi
.y

940 || 
xt
.
w
 !
rgd_gamee
->w

941 || 
xt
.
h
 !
rgd_gamee
->h;

944 i(
xt
.
w
 <= 0)

946 
go_back
 = (
xt
.
w
 - 1;

947 
xt
.
w
 = 1;

948 i(
ui_e
.
un
.
size
.
dggg_
)

950 
xt
.
x
 +
go_back
;

954 i(
xt
.
h
 <= 0)

956 
go_back
 = (
xt
.
h
 - 1;

957 
xt
.
h
 = 1;

958 i(
ui_e
.
un
.
size
.
dggg_down
)

960 
xt
.
y
 +
go_back
;

965 i(
chgeOccud
)

967 
AABB
* 
boxes
 = 
	`gamee__clids
(
ame_memy
,

968 
ed_s_e
->
timeMache
->
wld_e
.
v_e
,

969 
ed_s_e
->
timeMache
->
wld_e
.
v_posi
,

970 
ed_s_e
->
timeMache
->
wld_e
.
num_v
,

971 
ui_e
.
un
.
size
.
dggg_gamee_dex
);

972 
bo
 
chgeVid
 = !
	`mh_AABB_is_clidg
(
xt
, 
boxes
, 
ed_s_e
->
timeMache
->
wld_e
.
num_v
 - 1);

973 i(
chgeVid
)

975 
IPa
 
xt_size
;

976 
xt_size
.
x
 = (
xt
.
w
;

977 
xt_size
.
y
 = (
xt
.
h
;

978 
IPa
 
dimt
;

979 
dimt
.
x
 = ((-
xt
.x + 
rgd_gamee_posi
.x);

980 
dimt
.
y
 = ((-
xt
.y + 
rgd_gamee_posi
.y);

981 
TimeMacheEdAi
 
ai
 =

982 
	`gamee_timemachi__size_game
(
ui_e
.
un
.
size
.
dggg_gamee_dex
, 
xt
, 
dimt
);

983 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

988 
ui_e
.
ty
 = 
ECS_NEUTRAL
;

991 i(
ui_e
.
ty
 =
ECS_MOVE_GAMESTATE
 && ui_e.
ick__up_this_ame
)

994 
AABB
 
xt
 = 
	`lcuϋ_oue_om_move_fo
(
ame_memy
, 
ed_s_e
->
timeMache
, 
ui_e
);

995 
AABB
* 
boxes
 = 
	`gamee__clids
(
ame_memy
,

996 
ed_s_e
->
timeMache
->
wld_e
.
v_e
,

997 
ed_s_e
->
timeMache
->
wld_e
.
v_posi
,

998 
ed_s_e
->
timeMache
->
wld_e
.
num_v
,

999 
ui_e
.
un
.
move
.
movg_gamee_dex
);

1000 
bo
 
chgeVid
 = !
	`mh_AABB_is_clidg
(
xt
, 
boxes
, 
ed_s_e
->
timeMache
->
wld_e
.
num_v
 - 1);

1001 i(
chgeVid
)

1004 
glm
::
vec2
 
di
 = 
ui_e
.
mouGamePos
 - ui_e.
un
.
move
.
move_t_posi
;

1006 
IPa
 
offt
 = 
	`mh_a_
(()
di
.
x
, ()di.
y
);

1008 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi__move_gamee
(
ui_e
.
un
.
move
.
movg_gamee_dex
, 
offt
);

1009 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

1013 
ui_e
.
ty
 = 
ECS_NEUTRAL
;

1015 i(
ui_e
.
ty
 =
ECS_CREATE_GAMESTATE
 && !ui_e.
ick__down_this_ame
)

1018 i(
ui_e
.
ick__up_this_ame
)

1021 
AABB
 
xt
 = 
	`lcuϋ_oue_om__fo
(
ame_memy
, 
ed_s_e
->
timeMache
, 
ui_e
);

1022 
AABB
* 
boxes
 = 
	`gamee__clids
(
ame_memy
,

1023 
ed_s_e
->
timeMache
->
wld_e
.
v_e
,

1024 
ed_s_e
->
timeMache
->
wld_e
.
v_posi
,

1025 
ed_s_e
->
timeMache
->
wld_e
.
num_v
);

1026 
bo
 
sucssful_t
 = !
	`mh_AABB_is_clidg
(
xt
, 
boxes
, 
ed_s_e
->
timeMache
->
wld_e
.
num_v
);

1027 i(
sucssful_t
)

1029 
AABB
 
cut_oue
 = 
	`lcuϋ_oue_om__fo
(
ame_memy
, 
ed_s_e
->
timeMache
, 
ui_e
);

1030 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi___ai
((
cut_oue
.
x
, (cut_oue.
y
, (cut_oue.
w
, (cut_oue.
h
);

1031 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

1033 
ui_e
.
ty
 = 
ECS_NEUTRAL
;

1038 #agm
dgi


1040 i(
s
 =
ST_EDIT_LEVEL
)

1042 #agm
gi
 
hd_evts


1043 i(
ui_e
.
ty
 =
ECS_BRUSH
)

1045 i(
ui_e
.
mou__ick_down
)

1046 
bo
 
_ick_ai_sved
 = 
	`MaybeAlyBrushInPyMode
(
ay_memy
, 
ed_s_e
->
ˋ
,d_s_e->
cutBrush
, &
ui_e
, 
ay_s_e
.
timeMache_ed
,y_s_e.
loc_ed
, ui_e.
mouGamePos
);

1048 
ui_e
.
ty
 = 
ECS_NEUTRAL
;

1050 i(
ui_e
.
ty
 =
ECS_NEUTRAL
)

1052 
	`hd_xt_ai_eful
(
ay_s_e
.
timeMache
,y_s_e.
loc
);

1053 i(
ui_e
.
ab
.
esd_this_ame
)

1055 
GameS
* 
cut_ed_e
 = &
ay_s_e
.
timeMache_ed
->
e_y
[ay_s_e.timeMache_ed->
num_gamees_ed
 - 1];

1056 
ay_s_e
.
timeMache
 = 
	`gamee_timemache_
(
cut_ed_e
, 
ay_memy
, 
MAX_NUMBER_GAMESTATES
);

1059 i(
ui_e
.
mou__ick_down
)

1061 
bo
 
_ick_ai_sved
 = 
	`MaybeAlyBrushInPyMode
(
ay_memy
, 
ed_s_e
->
ˋ
,d_s_e->
cutBrush
, &
ui_e
, 
ay_s_e
.
timeMache_ed
,y_s_e.
loc_ed
, ui_e.
mouGamePos
);

1062 i(
_ick_ai_sved
)

1063 
ui_e
.
ty
 = 
ECS_BRUSH
;

1065 i(
ui_e
.
backa_key_down_this_ame
)

1067 
s
 = 
ST_EDITOR
;

1068 
ui_e
.
time_s_s_d
 = 0;

1069 
num_es
 = 
ay_s_e
.
timeMache_ed
->
num_gamees_ed
;

1070 
GameS
* 
e_to_
 = 
	`gamee_e
(&
ay_s_e
.
timeMache_ed
->
e_y
[
num_es
 - 1], 
rmt_memy
);

1071 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi__a_gamee
(
e_to_
, 
ay_s_e
.
ed_posi__time_mache
,y_s_e.
game_me
);

1072 
	`gamee_timemache_ed_ke_ai
(
ed_s_e
->
timeMache
, 
NULL
, 
ai
);

1074 i(
ui_e
.
shi_key_down_this_ame
)

1076 
ui_e
.
ty
 = 
ECS_EDIT_NAME
;

1078 i(
ui_e
.
z_key_down_this_ame
)

1080 
	`gamee_timemache_undo
(
ay_s_e
.
timeMache
);

1083 i(
ui_e
.
ty
 =
ECS_EDIT_NAME
)

1085 i(
ay_s_e
.
game_me_ngth
 < 
GAME_LEVEL_NAME_MAX_SIZE
)

1087 
i
 = 0; i < 
NUM_LETTERS_ON_KEYBOARD
 - 1; i++)

1089 i(
ui_e
.
ˉs
[
i
].
esd_this_ame
)

1092 
ngth
 = 
ay_s_e
.
game_me_ngth
;

1093 
ay_s_e
.
game_me
[
ngth
] = ('a' + (
i
);

1094 
ay_s_e
.
game_me
[
ngth
 + 1] = 0;

1095 
ay_s_e
.
game_me_ngth
++;

1098 i(
ui_e
.
ab
.
esd_this_ame
)

1100 
ngth
 = 
ay_s_e
.
game_me_ngth
;

1101 
ay_s_e
.
game_me
[
ngth
] = ' ';

1102 
ay_s_e
.
game_me
[
ngth
 + 1] = 0;

1103 
ay_s_e
.
game_me_ngth
++;

1106 i(
ay_s_e
.
game_me_ngth
 > 0)

1108 i(
ui_e
.
backa_key_down_this_ame
)

1110 
ngth
 = 
ay_s_e
.
game_me_ngth
;

1111 
ay_s_e
.
game_me
[
ngth
 - 1] = 0;

1112 
ay_s_e
.
game_me_ngth
--;

1115 i(
ui_e
.
r
.
esd_this_ame
)

1117 
ui_e
.
ty
 = 
ECS_NEUTRAL
;

1121 #agm
dgi


1124 i(
s
 =
ST_PLAY_WORLD
)

1126 #agm
gi
 
ve
 
e
 
fo
 
befe
 
evts


1127 
d_gamee_num_ay_dg_
 = 
wld_s_e
->
cut_v
;

1128 #agm
dgi


1129 #agm
gi
 
hd_evts


1130 
bo
 
wld_ai_k
 = 
l
;

1131 
Ai
 
ai
 = 
	`lcuϋ_wh_ai_to_ke_xt_eful
();

1132 
Dei
 
to_ke
 = 
	`ai_to_dei
(
ai
);

1133 i(
to_ke
 !
Dei
::
NO_DIRECTION
)

1135 
wld_ay_s_e
 = 
	`wld_ay_ai
(
wld_s_e
, 
to_ke
, 
v_memy
);

1136 
ui_e
.
time_tl_ay_n_move
 = 
WAIT_BETWEEN_PLAYER_MOVE_REPEAT
;

1137 
ui_e
.
time_s_ϡ_ay_ai
 = 0;

1139 i(
ui_e
.
backa_key_down_this_ame
)

1141 
s
 = 
wld_s_e
->
go_to__backa
;

1142 
ui_e
.
time_s_s_d
 = 0;

1143 
ui_e
.
time_s_ϡ_ay_ai
 = 0;

1145 i(
ui_e
.
ˉs
['p' - 'a'].
esd_this_ame
)

1148 
d
::
rg
 
rd
 = 
	`r_rlize_timemache
(&
wld_s_e
->
wld_e
, 
rmt_memy
, 
ame_memy
);

1149 
	`ve_ctue_fe
(
rd
);

1154 i(!
	`y_vs__aive
(
wld_s_e
))

1156 
s
 = 
SCENE_TYPE
::
ST_SHOW_TEXT
;

1157 
ui_e
.
time_s_s_d
 = 0;

1158 
ui_e
.
time_s_ϡ_ay_ai
 = 0;

1159 
xt_s_e
 = 
	`bud_xt_s
("Wr! Thkf܅yg.", 
SCENE_TYPE
::
ST_MENU
, 
xt_memy
, 
ui_e
.
tٮ_time_sd
, 5.0f);

1162 i(
wld_ay_s_e
 !
NULL
)

1164 
s
 = 
SCENE_TYPE
::
ST_PLAY_LEVEL
;

1165 
ui_e
.
time_s_s_d
 = 0;

1166 
ui_e
.
time_s_ϡ_ay_ai
 = 0;

1171 #agm
dgi


1172 #agm
gi
 
hd_e_upde


1175 
cut_num_ay_dg_
 = 
wld_s_e
->
cut_v
;

1176 i(
d_gamee_num_ay_dg_
 !
cut_num_ay_dg_
)

1178 
wld_ma_˽
 = 0;

1179 
GameS
* 
cut_gamee
 = 
wld_s_e
->
wld_e
.
v_e
[
cut_num_ay_dg_
];

1180 
IPa
 
gamee_pos
 = 
wld_s_e
->
wld_e
.
v_posi
[
cut_num_ay_dg_
];

1181 
wld_ma_gl
 = 
	`mh_ma_bud_f_gamee
(
cut_gamee
, 
gamee_pos
, 
ma_vwpt
);

1183 i(
wld_s_e
->
ϡ_ai_was_pt
)

1184 
wld_ma_t
 = 
wld_ma_gl
;

1186 
wld_ma_t
 = 
wld_ma
;

1190 
wld_ma_˽
 +
d
;

1192 
wld_ma
 = 
	`mh_ma_move_towds_˽
(
wld_ma_t
, 
wld_ma_gl
, 
wld_ma_˽
, 
CAMERA_LERP_TIME
);

1194 #agm
dgi


1197 i(
s
 =
ST_PLAY_LEVEL
)

1199 #agm
gi
 
ve
 
e
 
fo
 
befe
 
evts


1200 
d_gamee_num_ay_dg_
 = 
wld_s_e
->
cut_v
;

1201 #agm
dgi


1202 #agm
gi
 
hd
 
evts


1204 
	`hd_xt_ai_eful
(
wld_ay_s_e
->
time_mache
,wld_ay_s_e->
dw_posi
);

1207 #agm
dgi


1208 #agm
gi
 
hd_e_upde


1210 i(
	`gamee_is__w_cdi
(&
wld_ay_s_e
->
time_mache
->
e_y
[wld_ay_s_e->time_mache->
num_gamees_ed
 - 1]))

1212 
wld_s_e
->
wld_e
.
v_sved
[wld_s_e->
cut_v
] = 
ue
;

1213 i(
wld_s_e
->
wld_e
.
v_modes
[wld_s_e->
cut_v
] =
LevMode
::
Crumb
)

1215 
num_es
 = 
wld_ay_s_e
->
time_mache
->
num_gamees_ed
;

1216 
GameS
* 
cut_e
 = &
wld_ay_s_e
->
time_mache
->
e_y
[
num_es
 - 1];

1217 
GameS
* 
ed_e
 = 
	`gamee_e
(
cut_e
, 
wld_memy
);

1218 
	`gamee_umb
(
ed_e
);

1219 
wld_s_e
->
wld_e
.
v_e
[wld_s_e->
cut_v
] = 
ed_e
;

1222 i(
wld_s_e
->
wld_e
.
v_modes
[wld_s_e->
cut_v
] =
LevMode
::
Rt
)

1224 
	`wld_y_vsg_a
(
wld_s_e
);

1226 i(
wld_s_e
->
wld_e
.
v_modes
[wld_s_e->
cut_v
] =
LevMode
::
Ovwld
)

1230 
wld_s_e
->
a_we_d_v_om
.
v_dex
 = -1;

1231 
wld_ay_s_e
->
time_mache
 = 
NULL
;

1235 
cut_num_ay_dg_
 = 
wld_s_e
->
cut_v
;

1236 i(
d_gamee_num_ay_dg_
 !
cut_num_ay_dg_
)

1238 
wld_ma_˽
 = 0;

1239 
GameS
* 
cut_gamee
 = 
wld_s_e
->
wld_e
.
v_e
[
cut_num_ay_dg_
];

1240 
IPa
 
gamee_pos
 = 
wld_s_e
->
wld_e
.
v_posi
[
cut_num_ay_dg_
];

1241 
wld_ma_gl
 = 
	`mh_ma_bud_f_gamee
(
cut_gamee
, 
gamee_pos
, 
ma_vwpt
);

1242 
wld_ma_t
 = 
wld_ma_gl
;

1247 
wld_ma_˽
 +
d
;

1251 
wld_ma
 = 
	`mh_ma_move_towds_˽
(
wld_ma_t
, 
wld_ma_gl
, 
wld_ma_˽
, 
CAMERA_LERP_TIME
);

1255 i(
ui_e
.
backa_key_down_this_ame
)

1257 
	`wld_y_vsg_a
(
wld_s_e
);

1258 
wld_ay_s_e
->
time_mache
 = 
NULL
;

1261 i(!
wld_ay_s_e
->
time_mache
)

1263 
s
 = 
SCENE_TYPE
::
ST_PLAY_WORLD
;

1264 
wld_ay_s_e
 = 
NULL
;

1265 
ui_e
.
time_s_s_d
 = 0;

1267 #agm
dgi


1269 i(
s
 =
ST_SHOW_TEXT
)

1271 #agm
gi
 
upde


1272 i(
xt_s_e
->
d_time
 <
ui_e
.
tٮ_time_sd
)

1274 
	`xt_s_t
();

1277 #agm
dgi


1278 #agm
gi
 
hd_evts


1279 i(
ui_e
.
ˉs
['x' - 'a'].
esd_this_ame
)

1281 
	`xt_s_t
();

1283 #agm
dgi


1285 i(
s
 =
ST_MENU
)

1287 #agm
gi
 
hd_evts


1289 i(
ui_e
.
ˉs
['w' - 'a'].
esd_this_ame
)

1291 
mu_s_e
->
cut_highlighd_bu
 += 1;

1292 
mu_s_e
->
cut_highlighd_bu
 = 
	`mi
(mu_s_e->cut_highlighd_bu, mu_s_e->
num_bus
 - 1);

1296 i(
ui_e
.
ˉs
['s' - 'a'].
esd_this_ame
)

1298 
mu_s_e
->
cut_highlighd_bu
 -= 1;

1299 
mu_s_e
->
cut_highlighd_bu
 = 
	`maxi
(menu_scene_state->current_highlighted_button, 0);

1301 i(
ui_e
.
ˉs
['x' - 'a'].
esd_this_ame
)

1303 
cut_bu
 = 
mu_s_e
->
cut_highlighd_bu
;

1304 
mu_s_e
->
bus
[
cut_bu
].
	`back
();

1306 #agm
dgi


1309 i(
s
 =
ST_EDITOR
)

1311 #agm
gi
 
nd
 
dw
 
da
 
to
 
gpu


1313 
sk_dex
 = -1;

1314 
AABB
 
oue
 = 
	`mh_AABB_
(0, 0, 0, 0);

1316 i(
ui_e
.
ty
 =
ECS_RESIZE_GAMESTATE
)

1318 
sk_dex
 = 
ui_e
.
un
.
size
.
dggg_gamee_dex
;

1319 
oue
 = 
	`lcuϋ_oue_posi_om_dg_fo
(
ame_memy
, 
ed_s_e
->
timeMache
, 
ui_e
, 
dggg_t_posi__gamea
);

1321 i(
ui_e
.
ty
 =
ECS_MOVE_GAMESTATE
)

1323 
oue
 = 
	`lcuϋ_oue_om_move_fo
(
ame_memy
, 
ed_s_e
->
timeMache
, 
ui_e
);

1324 
sk_dex
 = 
ui_e
.
un
.
move
.
movg_gamee_dex
;

1326 i(
ui_e
.
ty
 =
ECS_CREATE_GAMESTATE
)

1328 
oue
 = 
	`lcuϋ_oue_om__fo
(
ame_memy
, 
ed_s_e
->
timeMache
, 
ui_e
);

1330 i(
sk_dex
 >0 || 
ui_e
.
ty
 =
ECS_CREATE_GAMESTATE
)

1332 
oue
.
x
 -= 0.1f;

1333 
oue
.
y
 -= 0.1f;

1334 
oue
.
w
 += 0.2f;

1335 
oue
.
h
 += 0.2f;

1336 
AABB
* 
oues_brok
 = (AABB*)
	`memy_loc
(
ame_memy
, (AABB) * 4);

1337 
	`mh_AABB_bak_to_bds
(
oue
, 
oues_brok
, 0.2f);

1338 
	`dw_oue_to_gamea
(
oues_brok
[0], 
o_wre
);

1339 
	`dw_oue_to_gamea
(
oues_brok
[1], 
o_wre
);

1340 
	`dw_oue_to_gamea
(
oues_brok
[2], 
o_wre
);

1341 
	`dw_oue_to_gamea
(
oues_brok
[3], 
o_wre
);

1346 
	`dw_gamees_oues_to_gamea
(

1347 
ed_s_e
->
timeMache
->
wld_e
.
v_e
,

1348 
ed_s_e
->
timeMache
->
wld_e
.
v_posi
,

1349 
ed_s_e
->
timeMache
->
wld_e
.
num_v
,

1350 
o_wre
,

1351 
sk_dex
);

1356 
	`gamee_t_a__vue
(
ed_s_e
->
timeMache
->
wld_e
.
v_e
,ed_s_e->timeMache->wld_e.
num_v
);

1357 
	`dw_gamea
(

1358 
ed_s_e
->
timeMache
->
wld_e
.
v_e
,

1359 
ed_s_e
->
timeMache
->
wld_e
.
v_posi
,

1360 
ed_s_e
->
timeMache
->
wld_e
.
num_v
,

1361 
l_wre
);

1364 
	`dw_ˉe
(
ed_s_e
->
ˋ_sn_t
, 
ma_game
, 
ma_vwpt
, &
ui_e
, 
ˋ_ngth
,d_s_e->
ˋ
, 
l_wre
);

1367 
z
 = 0; z < 
sk_dex
; z++)

1369 
w
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
z
]->w;

1370 
h
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
z
]->h;

1371 
IPa
 
tPos
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_posi
[
z
];

1372 
dًd_posis_u
[
dًd_tٮ_dwn
] = 
glm
::
	`vec3
(
tPos
.
x
 - 0.15f, sPos.
y
 - 0.15f, 8);

1373 
dًd_s_u
[
dًd_tٮ_dwn
] = 
glm
::
	`vec2
(
w
 + 0.30f, 
h
 + 0.30f);

1374 
dًd_tٮ_dwn
++;

1376 
z
 = 
sk_dex
 + 1; z < 
ed_s_e
->
timeMache
->
wld_e
.
num_v
; z++)

1378 
w
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
z
]->w;

1379 
h
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_e
[
z
]->h;

1380 
IPa
 
tPos
 = 
ed_s_e
->
timeMache
->
wld_e
.
v_posi
[
z
];

1381 
dًd_posis_u
[
dًd_tٮ_dwn
] = 
glm
::
	`vec3
(
tPos
.
x
 - 0.15f, sPos.
y
 - 0.15f, 8);

1382 
dًd_s_u
[
dًd_tٮ_dwn
] = 
glm
::
	`vec2
(
w
 + 0.30f, 
h
 + 0.30f);

1383 
dًd_tٮ_dwn
++;

1389 
n
 = 
ed_s_e
->
timeMache
->
wld_e
.
num_v
;

1390 
i
 = 0; i < 
n
; i++)

1392 * 
me
 = &
ed_s_e
->
timeMache
->
wld_e
.
v_mes
[
i
].name[0];

1393 
x_pos
 = ()
ed_s_e
->
timeMache
->
wld_e
.
v_posi
[
i
].
x
;

1394 
y_pos
 = ()(
ed_s_e
->
timeMache
->
wld_e
.
v_posi
[
i
].
y
 +d_s_e->timeMache->wld_e.
v_e
[i]->
h
) + 0.2f;

1395 
glm
::
vec3
 
dw_pos
 = glm::
	`vec3
(
x_pos
, 
y_pos
, 0);

1397 
	`dw_xt_to_sn
(
dw_pos
, 
glm
::
	`vec2
(1, 1), 
me
, &
xt_dw_fo
);

1400 #agm
dgi


1402 i(
s
 =
ST_EDIT_LEVEL
)

1404 #agm
gi
 
nd
 
dw
 
da
 
to
 
gpu


1406 
	`dw_ˉe
(
ed_s_e
->
ˋ_sn_t
, 
ma_game
, 
ma_vwpt
, &
ui_e
, 
ˋ_ngth
,d_s_e->
ˋ
, 
l_wre
);

1408 
GameS
* 
ay_dw
 = &
ay_s_e
.
timeMache
->
e_y
[ay_s_e.timeMache->
num_gamees_ed
 - 1];

1409 
GameS
* 
ed_dw
 = &
ay_s_e
.
timeMache_ed
->
e_y
[ay_s_e.timeMache_ed->
num_gamees_ed
 - 1];

1410 
IPa
 
t_posi
 = 
ay_s_e
.
loc
;

1411 
IPa
 
xt_posi
 = 
ay_s_e
.
loc_ed
;

1412 
	`dw_gamea
(

1413 &(
ay_dw
),

1414 &(
ay_s_e
.
loc
),

1416 
l_wre
);

1417 
	`dw_gamea
(

1418 &(
ed_dw
),

1419 &(
xt_posi
),

1421 
l_wre
);

1422 
glm
::
vec3
 
xt_t_pos
 = glm::
	`vec3
(
xt_posi
.
x
,ext_posi.
y
 + 
ed_dw
->
h
, 0);

1423 
	`dw_xt_to_sn
(
xt_t_pos
, 
glm
::
	`vec2
(1, 1), 
ay_s_e
.
game_me
, &
xt_dw_fo
);

1426 #agm
dgi


1428 i(
s
 =
ST_PLAY_WORLD
)

1430 #agm
gi
 
nd
 
dw
 
da
 
to
 
gpu


1431 
	`dw_gamea
(

1432 
wld_s_e
->
wld_e
.
v_e
,

1433 
wld_s_e
->
wld_e
.
v_posi
,

1434 
wld_s_e
->
wld_e
.
num_v
,

1435 
l_wre
);

1436 #agm
dgi


1438 i(
s
 =
ST_PLAY_LEVEL
)

1440 #agm
gi
 
nd
 
dw
 
da
 
to
 
gpu


1441 
wld_dex_to_dw
 = 
wld_s_e
->
cut_v
;

1444 
gamee_dex_to_dw
 = 
wld_ay_s_e
->
time_mache
->
num_gamees_ed
;

1445 
GameS
* 
to_dw
 = &
wld_ay_s_e
->
time_mache
->
e_y
[
gamee_dex_to_dw
 - 1];

1446 
cut_v
 = 
wld_s_e
->current_level;

1447 
IPa
* 
to_dw_posi
 = &
wld_ay_s_e
->
dw_posi
;

1449 
	`dw_gamea
(

1450 &
to_dw
,

1451 
to_dw_posi
,

1453 
l_wre
);

1455 #agm
dgi


1457 i(
s
 =
ST_SHOW_TEXT
)

1459 #agm
gi
 
nd
 
dw
 
da
 
to
 
gpu


1460 
	`dw_xt_maximized_ed_to_sn
(
wld_ma
, 
xt_s_e
->
to_diy
, &
xt_dw_fo
);

1461 
	`dw_bck_box_ov_sn
(
wld_ma
, 
o_wre
);

1462 #agm
dgi


1464 i(
s
 =
ST_MENU
)

1466 #agm
gi
 
nd
 
dw
 
da
 
to
 
gpu


1468 
GameSCama
 
ma_fih
;

1469 
fih_w
 = (
ma_game
.

 + cama_game.
right
) / 5.0f;

1470 
ma_fih
.

 = 
ma_game
. + 
fih_w
;

1471 
ma_fih
.
right
 = 
ma_game
.righ- 
fih_w
;

1472 
fih_h
 = (
ma_game
.
up
 - cama_game.
down
) / 5.0f;

1473 
ma_fih
.
down
 = 
ma_game
.dow+ 
fih_h
;

1474 
ma_fih
.
up
 = cama_fih.
down
 + 
fih_h
;

1478 
GameSCama
 
btom_fih
 = 
ma_game
;

1479 
ma_width
 = 
ma_game
.
right
 - cama_game.

;

1480 
ma_height
 = 
ma_game
.
up
 - cama_game.
down
;

1481 
btom_fih
.
right
 = btom_fih.

 + 
ma_width
 / 5.0f;

1482 
btom_fih
.
up
 = btom_fih.
down
 + 
ma_height
 / 5.0f;

1484 
w
 = 
btom_fih
.
right
 - btom_fih.

;

1485 
h
 = 
btom_fih
.
up
 - btom_fih.
down
;

1487 
gl_w
 = (
h
 * 5.0f) / 4.0f;

1489 i(
gl_w
 > 
w
)

1491 
	`ash_r
("foolish mortal, you have madenssumption in your code base (namely,hat you will onlyeedoeducehe width, butevereducehe height),ndhatssumption has failed. Now were crashingo save youeally mean debug session.");

1493 
width_adjumt
 = (
w
 - 
gl_w
);

1494 
btom_fih
.
right
 -
width_adjumt
;

1498 
GameSCama
 
mp_pos
 = 
	`_g_grid_emt
(1, 1, 5, 4, 
btom_fih
);

1499 
	`dw_xt_maximized_ed_to_sn
(
mp_pos
, "A", &
xt_dw_fo
);

1502 
GameSCama
 
mp_pos
 = 
	`_g_grid_emt
(0, 1, 5, 4, 
btom_fih
);

1503 
	`dw_ui_to_gamea
(
mp_pos
, 
xtuAsts
::
UI
::
LeAow
, 
ui_wre
);

1507 
GameSCama
 
mp_pos
 = 
	`_g_grid_emt
(2, 2, 5, 4, 
btom_fih
);

1508 
	`dw_xt_maximized_ed_to_sn
(
mp_pos
, "W", &
xt_dw_fo
);

1511 
GameSCama
 
mp_pos
 = 
	`_g_grid_emt
(2, 3, 5, 4, 
btom_fih
);

1512 
	`dw_ui_to_gamea
(
mp_pos
, 
xtuAsts
::
UI
::
UpAow
, 
ui_wre
);

1516 
GameSCama
 
mp_pos
 = 
	`_g_grid_emt
(2, 1, 5, 4, 
btom_fih
);

1517 
	`dw_xt_maximized_ed_to_sn
(
mp_pos
, "S", &
xt_dw_fo
);

1520 
GameSCama
 
mp_pos
 = 
	`_g_grid_emt
(2, 0, 5, 4, 
btom_fih
);

1521 
	`dw_ui_to_gamea
(
mp_pos
, 
xtuAsts
::
UI
::
DownAow
, 
ui_wre
);

1525 
GameSCama
 
mp_pos
 = 
	`_g_grid_emt
(3, 1, 5, 4, 
btom_fih
);

1526 
	`dw_xt_maximized_ed_to_sn
(
mp_pos
, "D", &
xt_dw_fo
);

1529 
GameSCama
 
mp_pos
 = 
	`_g_grid_emt
(4, 1, 5, 4, 
btom_fih
);

1530 
	`dw_ui_to_gamea
(
mp_pos
, 
xtuAsts
::
UI
::
RightAow
, 
ui_wre
);

1534 
i
 = 0; i < 
mu_s_e
->
num_bus
; i++)

1536 
GameSCama
 
ma_fih_smr
 = 
ma_fih
;

1537 
width
 = 
ma_fih_smr
.
right
 - cama_fih_smr.

;

1538 
height
 = 
ma_fih_smr
.
up
 - cama_fih_smr.
down
;

1539 
ma_fih_smr
.

 +(
width
 / 5.0f);

1540 
ma_fih_smr
.
right
 -(
width
 / 5.0f);

1541 
ma_fih_smr
.
up
 -(
height
 / 10.0f);

1542 
ma_fih_smr
.
down
 +(
height
 / 10.0f);

1543 i(
i
 =
mu_s_e
->
cut_highlighd_bu
)

1544 
	`dw_bu_to_gamea
(
ma_fih
, 
ui_wre
, 
glm
::
	`vec4
(0.7, 0.7, 1, 1));

1546 
	`dw_bu_to_gamea
(
ma_fih
, 
ui_wre
);

1547 
	`dw_xt_maximized_ed_to_sn
(
ma_fih_smr
, 
mu_s_e
->
bus
[
i
].
bu_xt
, &
xt_dw_fo
);

1548 
ma_fih
.
down
 +
fih_h
;

1549 
ma_fih
.
up
 +
fih_h
;

1551 #agm
dgi


1553 #agm
gi
 
dw
 
gpu
 
da


1557 i(
s
 =
ST_PLAY_WORLD
 || s =
ST_PLAY_LEVEL
 || s =
ST_SHOW_TEXT
)

1558 
ma
 = 
	`ma_make_mrix
(
wld_ma
);

1559 i(
s
 =
ST_EDITOR
 || s =
ST_EDIT_LEVEL
 || s =
ST_MENU
)

1560 
ma
 = 
	`ma_make_mrix
(
ma_game
);

1561 
	`glUProgm
(
reShad
);

1562 
	`shad_t_unifm_m4
(
reShad
, "vwProjeiMrix", 
ma
);

1563 
	`glUProgm
(
fuSeShad
);

1564 
	`shad_t_unifm_m4
(
fuSeShad
, "vwProjeiMrix", 
ma
);

1565 
	`glUProgm
(
dًdShad
);

1566 
	`shad_t_unifm_m4
(
dًdShad
, "vwProjeiMrix", 
ma
);

1567 
	`shad_t_unifm_t
(
dًdShad
, "time", 
tٮ_time
);

1568 
	`glUProgm
(
rgShad
);

1569 
	`shad_t_unifm_m4
(
rgShad
, "vwProjeiMrix", 
ma
);

1573 
	`re_wre_out
(
o_wre
, 
ma
);

1574 
	`re_wre_out
(
p_wre
, 
ma
);

1575 
	`re_wre_out
(
symb_wre
, 
ma
);

1576 
	`re_wre_out
(
ui_wre
, 
ma
);

1581 
	`glUProgm
(
dًdShad
);

1582 
	`glBdVxAay
(
dًd_VAO
);

1583 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
dًd_posis_bufr
);

1584 
	`glBufrSubDa
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec3
* 
dًd_tٮ_dwn
, 
dًd_posis_u
);

1585 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
dًd_s_bufr
);

1586 
	`glBufrSubDa
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec2
* 
dًd_tٮ_dwn
, 
dًd_s_u
);

1588 
	`glDwEmtsInd
(
GL_TRIANGLES
, 6, 
GL_UNSIGNED_INT
, 0, 
dًd_tٮ_dwn
);

1593 
	`glUProgm
(
rgShad
);

1595 
	`glBdVxAay
(
rg_VAO
);

1597 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
rg_s_bufr
);

1598 
	`glBufrSubDa
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec4
* *
xt_dw_fo
.
cut_numb_dwn
,ext_dw_fo.
rg_s_u
);

1599 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
rg_mrix_bufr
);

1600 
	`glBufrSubDa
(
GL_ARRAY_BUFFER
, 0, (
glm
::
m4
* *
xt_dw_fo
.
cut_numb_dwn
,ext_dw_fo.
rg_mrix_u
);

1601 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
rg_c_bufr
);

1602 
	`glBufrSubDa
(
GL_ARRAY_BUFFER
, 0, (
glm
::
vec4
)** 
xt_dw_fo
.
cut_numb_dwn
,ext_dw_fo.
rg_c_u
);

1603 
	`glBdTextu
(
GL_TEXTURE_2D
, 
rg_xtu
);

1604 
	`glDwEmtsInd
(
GL_TRIANGLES
, 6, 
GL_UNSIGNED_INT
, 0, *
xt_dw_fo
.
cut_numb_dwn
);

1608 #agm
dgi


1609 #agm
gi
 
Fish
 
d
 
t
 
xt
 
ame
.

1610 
	`SDL_GL_SwWdow
(
wdow
);

1612 
dًd_tٮ_dwn
 = 0;

1613 *
xt_dw_fo
.
cut_numb_dwn
 = 0;

1615 
o_wre
->
num_dw
 = 0;

1616 
p_wre
->
num_dw
 = 0;

1617 
symb_wre
->
num_dw
 = 0;

1618 
ui_wre
->
num_dw
 = 0;

1619 
	`memy_r
(
ame_memy
);

1620 #agm
dgi


1622 
kp_rug_fe_lo
 = 
rug
;

1623 
	}
}

1625 
	$ma
(
gc
, *
gv
[])

1627 #agm
gi
 
SDL_Sup


1629 
	`SDL_In
(
SDL_INIT_AUDIO
 | 
SDL_INIT_VIDEO
 | 
SDL_INIT_TIMER
 | 
SDL_WINDOW_RESIZABLE
);

1631 
	`SDL_GL_SAribu
(
SDL_GL_CONTEXT_MAJOR_VERSION
, 3);

1632 
	`SDL_GL_SAribu
(
SDL_GL_CONTEXT_MINOR_VERSION
, 0);

1635 
	`SDL_GL_SAribu
(
SDL_GL_DOUBLEBUFFER
, 1);

1636 
	`SDL_GL_SAribu
(
SDL_GL_DEPTH_SIZE
, 24);

1646 
SDL_GLCڋxt
 
maCڋxt
;

1647 
wdow
 = 
	`SDL_CeWdow
("Ca Elwhe", 
SDL_WINDOWPOS_CENTERED
,SDL_WINDOWPOS_CENTERED, 
SCREEN_STARTING_WIDTH
, 
SCREEN_STARTING_HEIGHT
, 
SDL_WINDOW_OPENGL
 | 
SDL_WINDOW_SHOWN
);

1648 
maCڋxt
 = 
	`SDL_GL_CeCڋxt
(
wdow
);

1649 i(
maCڋxt
 =
NULL
)

1651 
	`tf
("we have failedo initialisehe gl context");

1653 aut
rdr
 = 
	`SDL_CeRd
(

1654 
wdow
, -1, 
SDL_RENDERER_ACCELERATED
 | 
SDL_RENDERER_TARGETTEXTURE
);

1655 #ide
EMSCRIPTEN


1656 i(!
	`gdLdGLLd
((
GLADldoc
)
SDL_GL_GProcAddss
))

1662 #agm
dgi


1664 #agm
gi
 
Memy_AND_TimeMache_AND_Clock_Sup


1665 
	`tf
("Hello worldbc\n");

1666 
ame_memy
 = 
	`memy_
(3000000);

1667 
rmt_memy
 = 
	`memy_
(30000000);

1668 
mu_memy
 = 
	`memy_
(3000000);

1669 
ed_memy
 = 
	`memy_
(30000000);

1670 
ay_memy
 = 
	`memy_
(3000000);

1671 
wld_memy
 = 
	`memy_
(30000000);

1672 
v_memy
 = 
	`memy_
(30000000);

1673 
imi_memy
 = 
	`memy_
(3000000);

1674 
xt_memy
 = 
	`memy_
(300000);

1677 #agm
dgi


1678 #agm
gi
 
Need
 
GPU
 
Sup


1680 #agm
gi
 
Basic
 
Sup


1681 
vtis
[] = {

1687 
posis
[] = {

1695 
s
[] = {

1703 
dis
[] = {

1708 
	`tf
("Hellloooo?\n/n)");

1709 
	`glEb
(
GL_DEPTH_TEST
);

1710 
	`tf
("HELL YEAH!\n/n");

1711 
	`glDthFunc
(
GL_LESS
);

1712 
	`glEb
(
GL_BLEND
);

1713 
	`glBndFunc
(
GL_SRC_ALPHA
, 
GL_ONE_MINUS_SRC_ALPHA
);

1715 
reShad
 = 
	`shad_compe_ogm
("movesprite.vs", "movesprite.f");

1716 
fuSeShad
 = 
	`shad_compe_ogm
("fullsprite.vs", "color_sprite.f");

1717 
dًdShad
 = 
	`shad_compe_ogm
("dottedlines.vs", "dottedlines.f");

1718 
xtShad
 = 
	`shad_compe_ogm
("text.vs", "sprite.f");

1719 
rgShad
 = 
	`shad_compe_ogm
("string.vs", "string.f");

1721 
o_s_2
 = 
	`sour_ld_image_om_fe_to_gpu
("floor.png");

1722 
p_s_2
 = 
	`sour_ld_image_om_fe_to_gpu
("piece.png");

1723 
symb_s_2
 = 
	`sour_ld_image_om_fe_to_gpu
("symbols.png");

1724 
ui_s_2
 = 
	`sour_ld_image_om_fe_to_gpu
("ui.png");

1729 
	`glUProgm
(
reShad
);

1731 
vtis_VBO
;

1732 
vtis_EBO
;

1735 
	`glGBufrs
(1, &
vtis_VBO
);

1736 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
vtis_VBO
);

1737 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (
vtis
), vtis, 
GL_STATIC_DRAW
);

1739 
	`glGBufrs
(1, &
vtis_EBO
);

1740 
	`glBdBufr
(
GL_ELEMENT_ARRAY_BUFFER
, 
vtis_EBO
);

1741 
	`glBufrDa
(
GL_ELEMENT_ARRAY_BUFFER
, (
dis
), indis, 
GL_STATIC_DRAW
);

1746 
o_wre
 = 
re_wre_make


1748 
o_s_2
,

1749 
fuSeShad
,

1750 
rmt_memy
,

1752 
vtis_VBO
,

1753 
vtis_EBO
,

1754 
xtuAsts
::
	`FLOOR_posis
(
rmt_memy
)

1756 
p_wre
 = 
re_wre_make


1758 
p_s_2
,

1759 
fuSeShad
,

1760 
rmt_memy
,

1762 
vtis_VBO
,

1763 
vtis_EBO
,

1764 
xtuAsts
::
	`PIECE_posis
(
rmt_memy
)

1766 
symb_wre
 = 
re_wre_make


1768 
symb_s_2
,

1769 
fuSeShad
,

1770 
rmt_memy
,

1772 
vtis_VBO
,

1773 
vtis_EBO
,

1774 
xtuAsts
::
	`SYMBOLS_posis
(
rmt_memy
)

1776 
ui_wre
 = 
re_wre_make


1778 
ui_s_2
,

1779 
fuSeShad
,

1780 
rmt_memy
,

1782 
vtis_VBO
,

1783 
vtis_EBO
,

1784 
xtuAsts
::
	`UI_posis
(
rmt_memy
)

1786 
l_wre
 = (
AWre
*
	`memy_loc
(
rmt_memy
, (AllWrite));

1787 
l_wre
->
o
 = 
o_wre
;

1788 
l_wre
->
p
 = 
p_wre
;

1789 
l_wre
->
symb
 = 
symb_wre
;

1790 
l_wre
->
ui
 = 
ui_wre
;

1791 
l_wre
->
xt
 = &
xt_dw_fo
;

1795 #agm
dgi


1796 #agm
gi
 
dًd
 
GPU
 
tup


1797 
dًd_VAO
;

1798 
dًd_posis_bufr
;

1799 
dًd_s_bufr
;

1800 
dًd_tٮ_dwn
 = 0;

1801 
dًd_posis_u
 = (
glm
::
vec3
*
	`memy_loc
(
rmt_memy
, 
MAX_NUM_DOTTED_SPRITES
 * (glm::vec3));

1802 
dًd_s_u
 = (
glm
::
vec2
*
	`memy_loc
(
rmt_memy
, 
MAX_NUM_DOTTED_SPRITES
 * (glm::vec2));

1804 
	`glGVxAays
(1, &
dًd_VAO
);

1805 
	`glBdVxAay
(
dًd_VAO
);

1807 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
vtis_VBO
);

1808 
	`glBdBufr
(
GL_ELEMENT_ARRAY_BUFFER
, 
vtis_EBO
);

1810 
posi
 = 
	`glGAribLoti
(
dًdShad
, "pos");

1811 
	`glVxAribPor
(
posi
, 3, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)0);

1812 
	`glEbVxAribAay
(
posi
);

1814 
	`glGBufrs
(1, &
dًd_posis_bufr
);

1815 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
dًd_posis_bufr
);

1816 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (
glm
::
vec3
)* 
MAX_NUM_DOTTED_SPRITES
, 
NULL
, 
GL_DYNAMIC_DRAW
);

1818 
posi_offt
 = 
	`glGAribLoti
(
dًdShad
, "positionOffset");

1819 
	`glVxAribPor
(
posi_offt
, 3, 
GL_FLOAT
, 
GL_FALSE
, 3 * (), (*)0);

1820 
	`glEbVxAribAay
(
posi_offt
);

1821 
	`glVxAribDivis
(
posi_offt
, 1);

1822 
d
::
cout
 << "pow stuff" << std::
dl
;

1823 
	`glGBufrs
(1, &
dًd_s_bufr
);

1824 
d
::
cout
 << 
	`glGE
(<< std::
dl
;

1825 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
dًd_s_bufr
);

1826 
d
::
cout
 << 
	`glGE
(<< std::
dl
;

1827 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (
glm
::
vec2
)* 
MAX_NUM_DOTTED_SPRITES
, 
NULL
, 
GL_DYNAMIC_DRAW
);

1828 
d
::
cout
 << 
	`glGE
(<< std::
dl
;

1830 
s
 = 
	`glGAribLoti
(
dًdShad
, "scale");

1831 
d
::
cout
 << 
	`glGE
(<< std::
dl
;

1832 
	`glVxAribPor
(
s
, 2, 
GL_FLOAT
, 
GL_FALSE
, 2 * (), (*)0);

1833 
d
::
cout
 << 
	`glGE
(<< std::
dl
;

1834 
	`glEbVxAribAay
(
s
);

1835 
d
::
cout
 << 
	`glGE
(<< std::
dl
;

1836 
	`glVxAribDivis
(
s
, 1);

1837 
d
::
cout
 << 
	`glGE
(<< std::
dl
;

1840 #agm
dgi


1841 #agm
gi
 
rg
 
GPU
 
tup


1842 
	`shad_u
(
rgShad
);

1844 
xt_dw_fo
.
cut_numb_dwn
 = (*
	`memy_loc
(
rmt_memy
,());

1845 *
xt_dw_fo
.
cut_numb_dwn
 = 0;

1846 
xt_dw_fo
.
rg_s_u
 = (
glm
::
vec4
*
	`memy_loc
(
rmt_memy
, 
MAX_NUM_CHARACTERS
 * (glm::vec4));

1847 
xt_dw_fo
.
rg_mrix_u
 = (
glm
::
m4
*
	`memy_loc
(
rmt_memy
, 
MAX_NUM_CHARACTERS
 * (glm::mat4));

1848 
xt_dw_fo
.
rg_c_u
 = (
glm
::
vec4
*
	`memy_loc
(
rmt_memy
, 
MAX_NUM_CHARACTERS
 * (glm::vec4));

1850 
	`glGVxAays
(1, &
rg_VAO
);

1851 
d
::
cout
 << 
	`glGE
(<< ":261" << std::
dl
;

1852 
	`glBdVxAay
(
rg_VAO
);

1854 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
vtis_VBO
);

1855 
	`glBdBufr
(
GL_ELEMENT_ARRAY_BUFFER
, 
vtis_EBO
);

1857 
posi
 = 0;

1858 
	`glVxAribPor
(
posi
, 3, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)0);

1859 
	`glEbVxAribAay
(
posi
);

1861 
xCod
 = 1;

1862 
	`glVxAribPor
(
xCod
, 2, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)(3 * ()));

1863 
	`glEbVxAribAay
(
xCod
);

1865 
	`glGBufrs
(1, &
rg_mrix_bufr
);

1866 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
rg_mrix_bufr
);

1867 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (
glm
::
m4
)* 
MAX_NUM_CHARACTERS
, 
NULL
, 
GL_DYNAMIC_DRAW
);

1869 
mrixOfft
 = 4;

1870 
	`glVxAribPor
(
mrixOfft
, 4, 
GL_FLOAT
, 
l
, 16 * (), (*)0);

1871 
	`glVxAribPor
(
mrixOfft
 + 1, 4, 
GL_FLOAT
, 
l
, 16 * (), (*)(4 * ()));

1873 
	`glVxAribPor
(
mrixOfft
 + 2, 4, 
GL_FLOAT
, 
l
, 16 * (), (*)(8 * ()));

1874 
	`glVxAribPor
(
mrixOfft
 + 3, 4, 
GL_FLOAT
, 
l
, 16 * (), (*)(12 * ()));

1875 
	`glEbVxAribAay
(
mrixOfft
);

1876 
	`glEbVxAribAay
(
mrixOfft
 + 1);

1877 
	`glEbVxAribAay
(
mrixOfft
 + 2);

1878 
	`glEbVxAribAay
(
mrixOfft
 + 3);

1879 
	`glVxAribDivis
(
mrixOfft
, 1);

1880 
	`glVxAribDivis
(
mrixOfft
 + 1, 1);

1881 
	`glVxAribDivis
(
mrixOfft
 + 2, 1);

1882 
	`glVxAribDivis
(
mrixOfft
 + 3, 1);

1884 
sOfft
 = 2;

1886 
	`glGBufrs
(1, &
rg_s_bufr
);

1887 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
rg_s_bufr
);

1888 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (
glm
::
vec4
)* 
MAX_NUM_CHARACTERS
, 
NULL
, 
GL_DYNAMIC_DRAW
);

1890 
	`glVxAribPor
(
sOfft
, 4, 
GL_FLOAT
, 
l
, 4 * (), (*)(0));

1891 
	`glEbVxAribAay
(
sOfft
);

1892 
	`glVxAribDivis
(
sOfft
, 1);

1894 
xtC
 = 3;

1896 
	`glGBufrs
(1, &
rg_c_bufr
);

1897 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
rg_c_bufr
);

1898 
	`glBufrDa
(
GL_ARRAY_BUFFER
, (
glm
::
vec4
)* 
MAX_NUM_CHARACTERS
, 
NULL
, 
GL_DYNAMIC_DRAW
);

1900 
	`glVxAribPor
(
xtC
, 4, 
GL_FLOAT
, 
l
, 4 * (), (*)(0));

1901 
	`glEbVxAribAay
(
xtC
);

1903 #agm
dgi


1904 #agm
gi
 
Cama
 
Sup
 
And
 
UtSus


1910 
ma__x
 = 0;

1911 
ma_btom_y
 = 0;

1912 
ma_right_x
;

1913 
ma_t_y
;

1916 
ma_width
 = 
sn_width
;

1917 
ma_height
 = 
sn_height
;

1918 
tio
 = ()
ma_width
 / ()
ma_height
;

1919 
ma_right_x
 = 
GAME_HEIGHT_START
 * 
tio
;

1920 
ma_t_y
 = 
GAME_HEIGHT_START
;

1923 
ma_game
.

 = 
ma__x
;

1924 
ma_game
.
right
 = 
ma_right_x
;

1925 
ma_game
.
up
 = 
ma_t_y
;

1926 
ma_game
.
down
 = 
ma_btom_y
;

1927 
ma_game
.
oPot
 = -20;

1928 
ma_game
.
rPot
 = 20.0f;

1930 
ma_vwpt
.

 = 0;

1931 
ma_vwpt
.
right
 = 
sn_width
;

1932 
ma_vwpt
.
down
 = 0;

1933 
ma_vwpt
.
up
 = 
sn_height
;

1936 
ma
 = 
	`ma_make_mrix
(
ma_game
);

1938 #agm
dgi


1939 #agm
gi
 
TTF
 
ft
 
tup


1941 
FT_Libry
 

;

1942 if(
	`FT_In_FeTy
(&

))

1943 
d
::
cout
 << "ERROR - fyibryd faed.s." << std::
dl
;

1945 
d
::
cout
 << "sucssfuyded fyibry" << std::
dl
;

1946 
FT_Fa
 

;

1947 i(
	`FT_New_Fa
(

, "asts/l.f", 0, &

))

1948 
d
::
cout
 << "ERROR - fy faedld ft." << std::
dl
;

1950 
d
::
cout
 << "sucssfuyded fy ft." << std::
dl
;

1951 
	`FT_S_Pix_Sizes
(

, 0, 
FONT_CHARACTER_HEIGHT
);

1953 
GLut
 
xt_VAO
;

1955 
	`glGVxAays
(1, &
xt_VAO
);

1956 
	`glBdVxAay
(
xt_VAO
);

1958 
	`glBdBufr
(
GL_ARRAY_BUFFER
, 
vtis_VBO
);

1959 
	`glBdBufr
(
GL_ELEMENT_ARRAY_BUFFER
, 
vtis_EBO
);

1961 
GLt
 
posi
 = 
	`glGAribLoti
(
xtShad
, "pos");

1962 
	`glVxAribPor
(
posi
, 3, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)0);

1963 
	`glEbVxAribAay
(
posi
);

1965 
GLt
 
xCod
 = 
	`glGAribLoti
(
xtShad
, "texCoords");

1966 
	`glVxAribPor
(
xCod
, 2, 
GL_FLOAT
, 
GL_FALSE
, 5 * (), (*)(3 * ()));

1967 
	`glEbVxAribAay
(
xCod
);

1970 
rg_xtu
;

1971 
xt_dw_fo
.
xt_posis
 = (
AABB
*
	`memy_loc
(
rmt_memy
, (AABB* 
FONT_NUM_CHARACTERS
);

1972 
xt_dw_fo
.
xt_posis_nmized
 = (
AABB
*
	`memy_loc
(
rmt_memy
, (AABB* 
FONT_NUM_CHARACTERS
);

1973 * 
ch_xtu
 = (*)
	`memy_loc
(
rmt_memy
, (* 
FONT_NUM_CHARACTERS
);

1974 
xt_dw_fo
.
ue_ft_n
 = (
TTF_Cha
*)
	`memy_loc
(
rmt_memy
, (TTF_Cha* 
FONT_NUM_CHARACTERS
);

1976 
cut_width_wrn
 = 0;

1977 
cut_height_wrn
 = 0;

1978 
xt_FBO
;

1979 
	`glGFmebufrs
(1, &
xt_FBO
);

1980 
	`glBdFmebufr
(
GL_FRAMEBUFFER
, 
xt_FBO
);

1982 
	`glGTextus
(1,&
rg_xtu
);

1983 
	`glBdTextu
(
GL_TEXTURE_2D
, 
rg_xtu
);

1984 
	`glTexImage2D
(
GL_TEXTURE_2D
, 0, 
GL_RGB
, 
FONT_ATLAS_WIDTH
, 
FONT_ATLAS_HEIGHT
, 0, GL_RGB, 
GL_UNSIGNED_BYTE
, 
NULL
);

1985 
	`glTexPami
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR
);

1986 
	`glTexPami
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_LINEAR
);

1988 
	`glFmebufrTextu2D
(
GL_FRAMEBUFFER
, 
GL_COLOR_ATTACHMENT0
, 
GL_TEXTURE_2D
, 
rg_xtu
, 0);

1990 
	`glGTextus
(
FONT_NUM_CHARACTERS
, 
ch_xtu
);

1991 
	`glBdVxAay
(
xt_VAO
);

1992 
	`glUProgm
(
xtShad
);

1994 
	`FT_S_Pix_Sizes
(

, 0, 
FONT_CHARACTER_HEIGHT
);

1995 
	`glPixStei
(
GL_UNPACK_ALIGNMENT
, 1);

1997 
	`glVwpt
(0, 0, 
FONT_ATLAS_WIDTH
, 
FONT_ATLAS_HEIGHT
);

1998 i(
	`glCheckFmebufrStus
(
GL_FRAMEBUFFER
!
GL_FRAMEBUFFER_COMPLETE
)

1999 
d
::
cout
 << "ERROR - Fmebufin come!" << std::
dl
;

2001 
d
::
cout
 << "amebufcome!" << std::
dl
;

2003 
c
 = 0; c < 
FONT_NUM_CHARACTERS
; c++)

2005 i(
	`FT_Ld_Ch
(

, 
c
, 
FT_LOAD_RENDER
))

2007 
d
::
cout
 << "ERROR - uh oh, faedld cha glyph" << std::
dl
;

2012 
_width
 = 

->
glyph
->
bm
.
width
;

2013 
_height
 = 

->
glyph
->
bm
.
rows
;

2015 
xtuID
 = 
ch_xtu
[
c
];

2016 
	`glBdTextu
(
GL_TEXTURE_2D
, 
ch_xtu
[
c
]);

2017 
	`glTexImage2D
(

2018 
GL_TEXTURE_2D
,

2020 
GL_R8
,

2021 

->
glyph
->
bm
.
width
,

2022 

->
glyph
->
bm
.
rows
,

2024 
GL_RED
,

2025 
GL_UNSIGNED_BYTE
,

2026 

->
glyph
->
bm
.
bufr
);

2027 
d
::
cout
 << 
	`glGE
(<< std::
dl
;

2028 
	`glTexPami
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_S
, 
GL_CLAMP_TO_EDGE
);

2029 
	`glTexPami
(
GL_TEXTURE_2D
, 
GL_TEXTURE_WRAP_T
, 
GL_CLAMP_TO_EDGE
);

2030 
	`glTexPami
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR
);

2031 
	`glTexPami
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MAG_FILTER
, 
GL_LINEAR
);

2036 
wre_width
 = 
_width
 + 2;

2037 
bo
 
room_to_wre
 = 
wre_width
 + 
cut_width_wrn
 < 
FONT_ATLAS_WIDTH
;

2038 i(!
room_to_wre
)

2040 
cut_width_wrn
 = 0;

2041 
cut_height_wrn
 +
FONT_CHARACTER_HEIGHT
 + 2;

2045 
AABB
 
mp
 = 
	`mh_AABB_
(((
cut_width_wrn
 + 1), ((
cut_height_wrn
 + 1), (
_width
, (
_height
);

2046 
xt_dw_fo
.
xt_posis
[
c
] = 
mp
;

2047 
xt_dw_fo
.
xt_posis_nmized
[
c
] =ext_dw_fo.
xt_posis
[c];

2048 
xt_dw_fo
.
xt_posis_nmized
[
c
].
x
 =ext_dw_fo.
xt_posis
[c].x / 
FONT_ATLAS_WIDTH
;

2049 
xt_dw_fo
.
xt_posis_nmized
[
c
].
y
 =ext_dw_fo.
xt_posis
[c].y / 
FONT_ATLAS_HEIGHT
;

2050 
xt_dw_fo
.
xt_posis_nmized
[
c
].
w
 =ext_dw_fo.
xt_posis
[c].w / 
FONT_ATLAS_WIDTH
;

2051 
xt_dw_fo
.
xt_posis_nmized
[
c
].
h
 =ext_dw_fo.
xt_posis
[c].h / 
FONT_ATLAS_HEIGHT
;

2054 
AABB
 
mp2
 = 
xt_dw_fo
.
xt_posis_nmized
[
c
];

2055 
glm
::
vec4
 
mp3
 = *(glm::vec4*& 
mp2
;

2056 
	`shad_t_unifm_vec4
(
xtShad
, "offt", 
mp3
);

2057 
cut_width_wrn
 +
wre_width
;

2058 
	`glDwEmts
(
GL_TRIANGLES
, 6, 
GL_UNSIGNED_INT
, 0);

2060 
xt_dw_fo
.
ue_ft_n
[
c
].
Size
 = 
glm
::
	`ivec2
(

->
glyph
->
bm
.
width
, fa->glyph->bm.
rows
);

2061 
xt_dw_fo
.
ue_ft_n
[
c
].
Brg
 = 
glm
::
	`ivec2
(

->
glyph
->
bm_
, fa->glyph->
bm_t
);

2062 
xt_dw_fo
.
ue_ft_n
[
c
].
adv
 = (

->
glyph
->adv.
x
);

2064 
	`glBdTextu
(
GL_TEXTURE_2D
, 0);

2068 
	`glDeFmebufrs
(1,&
xt_FBO
);

2069 
	`glBdFmebufr
(
GL_FRAMEBUFFER
, 0);

2070 
	`glVwpt
(0, 0, 
sn_width
, 
sn_height
);

2072 #agm
dgi


2074 #agm
dgi


2075 #agm
gi
 
MAIN_LOOP_INIT


2076 
s
 = 
ST_MENU
;

2077 
mu_s_e
 = 
	`tup_ma_mu
(
mu_memy
, 
mu_ai_w_game
, 
mu_ai_ctue_game
, 
mu_ai_v_ed
);

2079 
ui_e
 = 
	`ick_ui_
(
rmt_memy
);

2080 #agm
dgi


2082 #ifde
EMSCRIPTEN


2084 
	`emsn_t_ma_lo
(
malofuni
, 0, 0);

2086 
ue
)

2088 
	`malofuni
();

2089 i(!
kp_rug_fe_lo
)

2094 
	`tf
("%s\n", 
	`glGSg
(
GL_VERSION
));

2095 
	`SDL_DeroyWdow
(
wdow
);

2096 
	`SDL_Qu
();

2100 
	}
}

2102 
	$ke_ay_ai
(
GameeTimeMache
* 
maybe_time_mache
, 
IPa
 
dw_posi
, 
EdUIS
* 
ui_e
, 
Dei
 
ai
, 
Memy
* 
v_memy
, Memy* 
ame_memy
, Memy* 
imi_memy
)

2104 
GameAiJou
* 
jou
 = 
	`gamee_timemache_ke_ai
(
maybe_time_mache
, 
ai
, 
v_memy
, 
ame_memy
);

2105 
GameSAnimi
* 
imi
 = 
jou
->
maybe_imi
;

2106 
ui_e
->
time_tl_ay_n_move
 = 
WAIT_BETWEEN_PLAYER_MOVE_REPEAT
;

2107 
ui_e
->
time_s_ϡ_ay_ai
 = 0;

2108 
	}
}

2160 
AABB
 
	$lcuϋ_oue_om__fo
(
Memy
* 
ame_memy
, 
TimeMacheEd
* 
timeMache
, 
EdUIS
 
ui_e
)

2162 
IPa
 
cut_posi
 = 
	`mh_a_
((
	`o
(
ui_e
.
mouGamePos
.
x
), (o(ui_e.mouGamePos.
y
));

2163 
IPa
 
btom_
 = 
	`mh_a_
(
	`mi
(
cut_posi
.
x
, 
ui_e
.
un
.

.
gamewld_t_pos
.x),

2164 
	`mi
(
cut_posi
.
y
, 
ui_e
.
un
.

.
gamewld_t_pos
.y));

2165 
IPa
 
t_right
 = 
	`mh_a_
(
	`maxi
(
cut_posi
.
x
, 
ui_e
.
un
.

.
gamewld_t_pos
.x),

2166 
	`maxi
(
cut_posi
.
y
, 
ui_e
.
un
.

.
gamewld_t_pos
.y));

2167 
w
 = 
t_right
.
x
 - 
btom_
.x + 1;

2168 
h
 = 
t_right
.
y
 - 
btom_
.y + 1;

2169 
AABB
 
xt_size
 = 
	`mh_AABB_
((
btom_
.
x
, (btom_.
y
, (
w
, (
h
);

2170  
xt_size
;

2171 
	}
}

2172 
AABB
 
	$lcuϋ_oue_om_move_fo
(
Memy
* 
ame_memy
, 
TimeMacheEd
* 
timeMache
, 
EdUIS
 
ui_e
)

2175 
glm
::
vec2
 
di
 = 
ui_e
.
mouGamePos
 - ui_e.
un
.
move
.
move_t_posi
;

2177 
IPa
 
offt
 = 
	`mh_a_
(()
di
.
x
, ()di.
y
);

2178 
gamee_dex
 = 
ui_e
.
un
.
move
.
movg_gamee_dex
;

2179 
GameS
* 
cut_gamee
 = 
timeMache
->
wld_e
.
v_e
[
gamee_dex
];

2180 
IPa
 
tPosi
 = 
timeMache
->
wld_e
.
v_posi
[
gamee_dex
];

2181 
AABB
 
oue
 = 
	`mh_AABB_
(((
tPosi
.
x
 + 
offt
.x), ((tPosi.
y
 + offt.y), (
cut_gamee
->
w
, (cut_gamee->
h
);

2182  
oue
;

2183 
	}
}

2184 
AABB
 
	$lcuϋ_oue_posi_om_dg_fo
(
Memy
* 
ame_memy
,

2185 
TimeMacheEd
* 
timeMache
,

2186 
EdUIS
 
ui_e
,

2187 
glm
::
vec2
 
dggg_t_posi__gamea
)

2190 
glm
::
vec2
 
offt
 = 
ui_e
.
mouGamePos
 - 
dggg_t_posi__gamea
;

2192 
IPa
 
rgd_gamee_posi
 = 
timeMache
->
wld_e
.
v_posi
[
ui_e
.
un
.
size
.
dggg_gamee_dex
];

2193 
GameS
* 
rgd_gamee
 = 
timeMache
->
wld_e
.
v_e
[
ui_e
.
un
.
size
.
dggg_gamee_dex
];

2194 
rgd_gamee_width
 = 
rgd_gamee
->
w
;

2195 
rgd_gamee_height
 = 
rgd_gamee
->
h
;

2197 
AABB
 
d
 = 
	`mh_AABB__t
(
rgd_gamee_posi
.
x
,

2198 
rgd_gamee_posi
.
y
,

2199 
rgd_gamee_width
,

2200 
rgd_gamee_height
);

2201 
AABB
 
xt
 = 
d
;

2203 
offt_x
 = 
	`sign
(
offt
.
x
) * 0.5f;

2204 
offt_y
 = 
	`sign
(
offt
.
y
) * 0.5f;

2205 i(
ui_e
.
un
.
size
.
dggg_
)

2207 
_movemt
 = ()(
ui_e
.
mouGamePos
.
x
 - (()
xt
.x+ 
offt_x
);

2208 i(
_movemt
 != 0)

2210 
xt
.
x
 +
_movemt
;

2211 
xt
.
w
 -
_movemt
;

2214 i(
ui_e
.
un
.
size
.
dggg_right
)

2216 
right_movemt
 = ()(
ui_e
.
mouGamePos
.
x
 - (()
xt
.x +ext.
w
+ 
offt_x
);

2217 i(
right_movemt
 != 0)

2218 
xt
.
w
 +
right_movemt
;

2220 i(
ui_e
.
un
.
size
.
dggg_down
)

2222 
down_movemt
 = ()(
ui_e
.
mouGamePos
.
y
 - (()
xt
.y+ 
offt_y
);

2223 i(
down_movemt
 != 0)

2225 
xt
.
y
 +
down_movemt
;

2226 
xt
.
h
 -
down_movemt
;

2229 i(
ui_e
.
un
.
size
.
dggg_up
)

2231 
up_movemt
 = ()(
ui_e
.
mouGamePos
.
y
 - (()
xt
.y +ext.
h
+ 
offt_y
);

2232 i(
up_movemt
 != 0)

2233 
xt
.
h
 +
up_movemt
;

2236 
bo
 
chgeOccud
 = 
xt
.
x
 !
rgd_gamee_posi
.x

2237 || 
xt
.
y
 !
rgd_gamee_posi
.y

2238 || 
xt
.
w
 !
rgd_gamee
->w

2239 || 
xt
.
h
 !
rgd_gamee
->h;

2242 i(
xt
.
w
 <= 0)

2244 
go_back
 = (
xt
.
w
 - 1;

2245 
xt
.
w
 = 1;

2246 i(
ui_e
.
un
.
size
.
dggg_
)

2248 
xt
.
x
 +
go_back
;

2252 i(
xt
.
h
 <= 0)

2254 
go_back
 = (
xt
.
h
 - 1;

2255 
xt
.
h
 = 1;

2256 i(
ui_e
.
un
.
size
.
dggg_down
)

2258 
xt
.
y
 +
go_back
;

2261  
xt
;

2262 
	}
}

2265 
bo
 
	$MaybeAlyBrush
(
GameeBrush
* 
ˋ
,
cutBrush
, 
EdUIS
* 
ui_e
, 
TimeMacheEd
* 
timeMache
,
glm
::
vec2
 
mouGamePos
)

2267 
i
 = 0; i < 
timeMache
->
wld_e
.
num_v
; i++)

2269 
GameS
* 
cutS
 = 
timeMache
->
wld_e
.
v_e
[
i
];

2270 

 = (
timeMache
->
wld_e
.
v_posi
[
i
].
x
;

2271 
right
 = ((
timeMache
->
wld_e
.
v_posi
[
i
].
x
 + 
cutS
->
w
);

2272 
down
 = (
timeMache
->
wld_e
.
v_posi
[
i
].
y
;

2273 
up
 = ((
timeMache
->
wld_e
.
v_posi
[
i
].
y
 + 
cutS
->
h
);

2274 
bo
 
ickedFlo
 = 
	`mh_ick_is_side_AABB
(

, 
down
, 
right
, 
up
, 
mouGamePos
.
x
, mouGamePos.
y
);

2275 i(
ickedFlo
)

2278 
rageX
 = 
	`r_bwn_two_pots
(
mouGamePos
.
x
, 

, 
right
);

2279 
rageY
 = 
	`r_bwn_two_pots
(
mouGamePos
.
y
, 
down
, 
up
);

2280 
x_o__icked
 = ()(
rageX
 * 
cutS
->
w
);

2281 
y_o__icked
 = ()(
rageY
 * 
cutS
->
h
);

2283 
IPa
 
rg_sque
 = 
	`mh_a_
(
x_o__icked
, 
y_o__icked
);

2284 
rg_sque_1d
 = 
	`f2D
(
rg_sque
.
x
,g_sque.
y
, 
timeMache
->
wld_e
.
v_e
[
i
]->
w
,imeMache->wld_e.v_e[i]->
h
);

2285 
TimeMacheEdAi
 
ai
 = 
	`gamee_timemachi__y_brush
(
ˋ
[
cutBrush
], 
i
, 
rg_sque
);

2287 
	`gamee_timemache_ed_ke_ai
(
timeMache
, 
NULL
, 
ai
);

2288 
ui_e
->
ty
 = 
ECS_BRUSH
;

2289  
ue
;

2292  
l
;

2293 
	}
}

2295 
GameSCama
 
	$mh_ma_bud_f_gamee
(
GameS
* 
gamee
, 
IPa
 
posi
, 
VwPtCama
 
vwpt
, 
x_ddg
, 
y_ddg
)

2297 
tio
 = 
	`ma_tio
(
vwpt
);

2298 
t_x
 = (
posi
.
x
;

2299 
t_y
 = (
posi
.
y
;

2300 
_x
 = 
t_x
 + ((
gamee
->
w
) / 2.0f);

2301 
_y
 = 
t_y
 + ((
gamee
->
h
) / 2.0f);

2302 
x_que
 = (
gamee
->
w
 + 
x_ddg
/ 
tio
;

2303 
y_que
 = 
gamee
->
h
 + 
y_ddg
;

2304 
ma_height
 = 
	`maxf
(
x_que
, 
y_que
);

2305  
	`mh_ma_bud
(
ma_height
, 
_x
, 
_y
, 
vwpt
);

2306 
	}
}

2307 
bo
 
	$MaybeAlyBrushInPyMode
(
Memy
* 
memy
, 
GameeBrush
* 
ˋ
,
cut_brush
, 
EdUIS
* 
ui_e
, 
GameeTimeMache
* 
time_mache
, 
IPa
 
cut_e_pos
, 
glm
::
vec2
 
mouGamePos
)

2309 
GameS
* 
cut_e
 = &
time_mache
->
e_y
[time_mache->
num_gamees_ed
 - 1];

2310 
GameS
* 
xt_e
 = &
time_mache
->
e_y
[time_mache->
num_gamees_ed
];

2311 

 = (
cut_e_pos
.
x
;

2312 
right
 = ((
cut_e_pos
.
x
 + 
cut_e
->
w
);

2313 
down
 = (
cut_e_pos
.
y
;

2314 
up
 = ((
cut_e_pos
.
y
 + 
cut_e
->
h
);

2315 
bo
 
ickedFlo
 = 
	`mh_ick_is_side_AABB
(

, 
down
, 
right
, 
up
, 
mouGamePos
.
x
, mouGamePos.
y
);

2316 i(
ickedFlo
)

2319 
rageX
 = 
	`r_bwn_two_pots
(
mouGamePos
.
x
, 

, 
right
);

2320 
rageY
 = 
	`r_bwn_two_pots
(
mouGamePos
.
y
, 
down
, 
up
);

2321 
x_o__icked
 = ()(
rageX
 * 
cut_e
->
w
);

2322 
y_o__icked
 = ()(
rageY
 * 
cut_e
->
h
);

2324 
IPa
 
rg_sque
 = 
	`mh_a_
(
x_o__icked
, 
y_o__icked
);

2326 
	`gamee_e_to_unlized
(
cut_e
, 
xt_e
,
memy
);

2327 
	`gamee_y_brush
(
xt_e
, 
ˋ
[
cut_brush
], 
x_o__icked
, 
y_o__icked
);

2328 
time_mache
->
num_gamees_ed
++;

2329 
ui_e
->
ty
 = 
ECS_BRUSH
;

2330  
ue
;

2332  
l
;

2333 
	}
}

	@
1
.
0
63
748
AABB.cpp
Animation.cpp
Animation.h
Camera.cpp
Click.cpp
Click.h
Clock.h
Constants.cpp
Constants.h
Editor.h
EditorScene.h
EditorThree.h
EditorTimeMachine.cpp
Fonts.h
GameState.cpp
GameState.h
GamestateAI.h
GenericUtil.h
Grid.cpp
HelperGL.cpp
HelperGL.h
IntPair.cpp
MainHelpers.h
Math.h
Maths.h
Memory.cpp
Memory.h
MenuScene.h
Parse.cpp
Parse.h
ParticleSystem.h
PreludeIncludes.h
Regex.cpp
Regex.h
Resource.h
ResourceLoadText.cpp
SaveLoad.cpp
SaveLoad.h
Scratch.h
Shader.cpp
Shader.h
Side.h
Source.cpp
Sprites.cpp
Sprites.h
TextDraw.cpp
TextDraw.h
TextScene.h
TrueFontCharacter.h
Walk.cpp
World.cpp
World.h
draw.cpp
draw.h
gui.h
sprite.cpp
sprite.h
stb_image.h
textureAssets.cpp
textureAssets.h
tinyfiledialogs.c
tinyfiledialogs.h
win32_platform.cpp
